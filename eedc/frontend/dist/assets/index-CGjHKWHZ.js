var la=Object.defineProperty;var da=(t,r,s)=>r in t?la(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var os=(t,r,s)=>da(t,typeof r!="symbol"?r+"":r,s);import{r as d,a as ca,u as Ls,N as Ir,O as oa,b as $t,d as ga,e as ha,L as xa,H as ma,f as ua,h as ge,i as $e,R as pa}from"./vendor--Y_1AvlA.js";import{R as se,B as Se,C as ce,X as oe,Y as le,T as ae,L as je,a as U,b as We,c as Ge,d as Ae,P as ct,e as ot,A as ft,f as Te,g as rr,h as ba}from"./charts-B-fldClV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&n(x)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var Ds={exports:{}},jr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ja=d,ka=Symbol.for("react.element"),ya=Symbol.for("react.fragment"),fa=Object.prototype.hasOwnProperty,wa=ja.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,va={key:!0,ref:!0,__self:!0,__source:!0};function Vs(t,r,s){var n,a={},i=null,x=null;s!==void 0&&(i=""+s),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(x=r.ref);for(n in r)fa.call(r,n)&&!va.hasOwnProperty(n)&&(a[n]=r[n]);if(t&&t.defaultProps)for(n in r=t.defaultProps,r)a[n]===void 0&&(a[n]=r[n]);return{$$typeof:ka,type:t,key:i,ref:x,props:a,_owner:wa.current}}jr.Fragment=ya;jr.jsx=Vs;jr.jsxs=Vs;Ds.exports=jr;var e=Ds.exports,Pr={},gs=ca;Pr.createRoot=gs.createRoot,Pr.hydrateRoot=gs.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Na={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),R=(t,r)=>{const s=d.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:x,className:o="",children:c,...u},l)=>d.createElement("svg",{ref:l,...Na,width:a,height:a,stroke:n,strokeWidth:x?Number(i)*24/Number(a):i,className:["lucide",`lucide-${_a(t)}`,o].join(" "),...u},[...r.map(([j,h])=>d.createElement(j,h)),...Array.isArray(c)?c:[c]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=R("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=R("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=R("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=R("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=R("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=R("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=R("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=R("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=R("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=R("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=R("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=R("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=R("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=R("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=R("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=R("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=R("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=R("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=R("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=R("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=R("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=R("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=R("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=R("CloudSnow",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=R("CloudSun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=R("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=R("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=R("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=R("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=R("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=R("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=R("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=R("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=R("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=R("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=R("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=R("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=R("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=R("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=R("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=R("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=R("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=R("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=R("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=R("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=R("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=R("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=R("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=R("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=R("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=R("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=R("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=R("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=R("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ia=R("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=R("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pa=R("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=R("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=R("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const La=R("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=R("PlugZap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=R("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=R("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=R("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=R("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=R("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=R("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ka=R("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=R("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=R("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=R("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=R("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=R("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=R("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=R("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=R("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=R("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=R("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=R("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=R("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=R("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=R("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=R("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=R("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=R("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Qs=d.createContext(void 0);function Ta({children:t}){const[r,s]=d.useState(()=>localStorage.getItem("eedc-theme")||"system"),[n,a]=d.useState(!1);return d.useEffect(()=>{localStorage.setItem("eedc-theme",r);const i=window.document.documentElement;if(r==="system"){const x=window.matchMedia("(prefers-color-scheme: dark)").matches;a(x),i.classList.toggle("dark",x)}else a(r==="dark"),i.classList.toggle("dark",r==="dark")},[r]),d.useEffect(()=>{if(r!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),x=o=>{a(o.matches),document.documentElement.classList.toggle("dark",o.matches)};return i.addEventListener("change",x),()=>i.removeEventListener("change",x)},[r]),e.jsx(Qs.Provider,{value:{theme:r,setTheme:s,isDark:n},children:t})}function Xs(){const t=d.useContext(Qs);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const ea="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgODAgODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImczIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzA2YjZkNCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMzNGQzOTkiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8c3R5bGU+CiAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PU91dGZpdDp3Z2h0QDMwMDs3MDAmYW1wO2Rpc3BsYXk9c3dhcCcpOwogICAgPC9zdHlsZT4KICA8L2RlZnM+CgogIDxyZWN0IHg9IjIiIHk9IjIiIHdpZHRoPSI3NiIgaGVpZ2h0PSI3NiIgcng9IjE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuOCIvPgogIDx0ZXh0IHg9IjEyIiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjcwMCIgZm9udC1zaXplPSIzNiIgZmlsbD0idXJsKCNnMykiPmVlPC90ZXh0PgogIDx0ZXh0IHg9IjQ1IiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjMwMCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY0NzQ4YiI+ZGM8L3RleHQ+CiAgPHBhdGggZD0iTTE2IDE2IFE0MCAzIDYyIDE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGNpcmNsZSBjeD0iNjIiIGN5PSIxNiIgcj0iMi44IiBmaWxsPSIjMzRkMzk5Ii8+Cjwvc3ZnPgo=",Ra=[{name:"Cockpit",basePath:"/cockpit",icon:Tr},{name:"Auswertungen",basePath:"/auswertungen",icon:Br},{name:"Aussichten",basePath:"/aussichten",icon:ke}],Ha=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Monatsabschluss",href:"/einstellungen/monatsabschluss"},{name:"Import",href:"/einstellungen/import"},{name:"Datenerfassung",href:"/einstellungen/datenerfassung"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"Solarprognose",href:"/einstellungen/solarprognose"},{name:"Allgemein",href:"/einstellungen/allgemein"}]},{category:"Home Assistant",items:[{name:"Sensor-Zuordnung",href:"/einstellungen/sensor-mapping"},{name:"MQTT-Export",href:"/einstellungen/ha-export"}]}];function Ga(){const{theme:t,setTheme:r}=Xs(),s=Ls(),[n,a]=d.useState(!1),i=d.useRef(null),o=s.pathname.startsWith("/cockpit")?"Cockpit":s.pathname.startsWith("/auswertungen")?"Auswertungen":s.pathname.startsWith("/aussichten")?"Aussichten":s.pathname.startsWith("/einstellungen")?null:"Cockpit";d.useEffect(()=>{const l=j=>{i.current&&!i.current.contains(j.target)&&a(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const c=()=>{r(t==="light"?"dark":t==="dark"?"system":"light")},u=l=>s.pathname===l;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-14",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:ea,alt:"eedc",className:"h-10 w-10"}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"}),e.jsx("nav",{className:"ml-8 flex space-x-1",children:Ra.map(l=>{const j=l.icon;return e.jsxs(Ir,{to:l.basePath,className:()=>`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o===l.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(j,{className:"h-4 w-4"}),l.name]},l.name)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:c,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(re,{className:"h-5 w-5"}),t==="dark"&&e.jsx(Zs,{className:"h-5 w-5"}),t==="system"&&e.jsx(Js,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>a(!n),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${s.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(Rr,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(ht,{className:`h-4 w-4 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:Ha.map((l,j)=>e.jsxs("div",{children:[j>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:l.category})}),l.items.map(h=>e.jsx(Ir,{to:h.href,onClick:()=>a(!1),className:`block px-4 py-2 text-sm transition-colors ${u(h.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:h.name},h.href))]},l.category))})]})]})]})})})}const Ja="./api";class Za{constructor(r=Ja){os(this,"baseUrl");this.baseUrl=r}async request(r,s={}){const n=`${this.baseUrl}${r}`,a={headers:{"Content-Type":"application/json",...s.headers},...s},i=await fetch(n,a);if(!i.ok){const x={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const o=await i.json();x.detail=o.detail||x.detail}catch{}throw x}if(i.status!==204)return i.json()}async get(r){return this.request(r,{method:"GET"})}async post(r,s){return this.request(r,{method:"POST",body:s?JSON.stringify(s):void 0})}async put(r,s){return this.request(r,{method:"PUT",body:JSON.stringify(s)})}async delete(r){return this.request(r,{method:"DELETE"})}async patch(r,s){return this.request(r,{method:"PATCH",body:JSON.stringify(s)})}async upload(r,s,n="file"){const a=new FormData;return a.append(n,s),this.request(r,{method:"POST",headers:{},body:a})}}const J=new Za,et={async list(){return J.get("/anlagen/")},async get(t){return J.get(`/anlagen/${t}`)},async create(t){return J.post("/anlagen/",t)},async update(t,r){return J.put(`/anlagen/${t}`,r)},async delete(t){return J.delete(`/anlagen/${t}`)},async getSensorConfig(t){return J.get(`/anlagen/${t}/sensors`)},async updateSensorConfig(t,r){return J.patch(`/anlagen/${t}/sensors`,r)},async geocode(t,r){const s=new URLSearchParams({plz:t});return r&&s.append("ort",r),J.get(`/anlagen/geocode/lookup?${s}`)}},_t={async list(t,r){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("jahr",r.toString());const n=s.toString();return J.get(`/monatsdaten/${n?"?"+n:""}`)},async get(t){return J.get(`/monatsdaten/${t}`)},async create(t){return J.post("/monatsdaten/",t)},async update(t,r){return J.put(`/monatsdaten/${t}`,r)},async delete(t){return J.delete(`/monatsdaten/${t}`)},async listAggregiert(t,r){const s=r?`?jahr=${r}`:"";return J.get(`/monatsdaten/aggregiert/${t}${s}`)}},Fe={async getTypen(){return J.get("/investitionen/typen")},async list(t,r,s){const n=new URLSearchParams;t&&n.append("anlage_id",t.toString()),r&&n.append("typ",r),s!==void 0&&n.append("aktiv",s.toString());const a=n.toString();return J.get(`/investitionen/${a?"?"+a:""}`)},async get(t){return J.get(`/investitionen/${t}`)},async create(t){return J.post("/investitionen/",t)},async update(t,r){return J.put(`/investitionen/${t}`,r)},async delete(t){return J.delete(`/investitionen/${t}`)},async getROIDashboard(t,r,s,n,a){const i=new URLSearchParams;r&&i.append("strompreis_cent",r.toString()),s&&i.append("einspeiseverguetung_cent",s.toString()),n&&i.append("benzinpreis_euro",n.toString()),a&&a!=="all"&&i.append("jahr",a.toString());const x=i.toString();return J.get(`/investitionen/roi/${t}${x?"?"+x:""}`)},async getEAutoDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("benzinpreis_euro",s.toString());const a=n.toString();return J.get(`/investitionen/dashboard/e-auto/${t}${a?"?"+a:""}`)},async getWaermepumpeDashboard(t,r){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString());const n=s.toString();return J.get(`/investitionen/dashboard/waermepumpe/${t}${n?"?"+n:""}`)},async getSpeicherDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("einspeiseverguetung_cent",s.toString());const a=n.toString();return J.get(`/investitionen/dashboard/speicher/${t}${a?"?"+a:""}`)},async getWallboxDashboard(t){return J.get(`/investitionen/dashboard/wallbox/${t}`)},async getBalkonkraftwerkDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("einspeiseverguetung_cent",s.toString());const a=n.toString();return J.get(`/investitionen/dashboard/balkonkraftwerk/${t}${a?"?"+a:""}`)},async getSonstigesDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("einspeiseverguetung_cent",s.toString());const a=n.toString();return J.get(`/investitionen/dashboard/sonstiges/${t}${a?"?"+a:""}`)},async getMonatsdatenByMonth(t,r,s){return J.get(`/investitionen/monatsdaten/${t}/${r}/${s}`)}},Vt={async list(t,r){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("aktuell","true");const n=s.toString();return J.get(`/strompreise/${n?"?"+n:""}`)},async getAktuell(t){return J.get(`/strompreise/aktuell/${t}`)},async get(t){return J.get(`/strompreise/${t}`)},async create(t){return J.post("/strompreise/",t)},async update(t,r){return J.put(`/strompreise/${t}`,r)},async delete(t){return J.delete(`/strompreise/${t}`)}},at="./api",gt={async getTemplateInfo(t){const r=await fetch(`${at}/import/template/${t}`);if(!r.ok)throw new Error("Fehler beim Laden des Templates");return r.json()},getTemplateDownloadUrl(t){return`${at}/import/template/${t}/download`},async importCSV(t,r,s=!1){const n=new FormData;n.append("file",r);const a=new URLSearchParams;s&&a.append("ueberschreiben","true");const i=await fetch(`${at}/import/csv/${t}?${a.toString()}`,{method:"POST",body:n});if(!i.ok){const x=await i.json();throw new Error(x.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(t,r){const s=new URLSearchParams;r&&s.append("jahr",r.toString());const n=s.toString();return`${at}/import/export/${t}${n?"?"+n:""}`},async createDemoData(){const t=await fetch(`${at}/import/demo`,{method:"POST"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${at}/import/demo`,{method:"DELETE"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht gel√∂scht werden")}return t.json()},getFullExportUrl(t){return`${at}/import/export/${t}/full`},async importJSON(t,r=!1){const s=new FormData;s.append("file",t);const n=new URLSearchParams;r&&n.append("ueberschreiben","true");const a=await fetch(`${at}/import/json?${n.toString()}`,{method:"POST",body:s});if(!a.ok){const i=await a.json();throw new Error(i.detail||"JSON-Import fehlgeschlagen")}return a.json()},getPdfExportUrl(t,r){return r?`${at}/import/pdf/${t}?jahr=${r}`:`${at}/import/pdf/${t}`}},ps={async health(){return J.get("/health")},async getSettings(){return J.get("/settings")},async getStats(){return J.get("/stats")}},Ue={async getPrognose(t,r={}){const s=new URLSearchParams;r.system_losses!==void 0&&s.set("system_losses",r.system_losses.toString());const n=s.toString();return J.get(`/pvgis/prognose/${t}${n?`?${n}`:""}`)},async getModulPrognose(t,r={}){const s=new URLSearchParams;r.system_losses!==void 0&&s.set("system_losses",r.system_losses.toString());const n=s.toString();return J.get(`/pvgis/modul/${t}${n?`?${n}`:""}`)},async speicherePrognose(t,r={}){const s=new URLSearchParams;r.system_losses!==void 0&&s.set("system_losses",r.system_losses.toString());const n=s.toString();return J.post(`/pvgis/prognose/${t}/speichern${n?`?${n}`:""}`)},async listeGespeichertePrognosen(t){return J.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return J.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return J.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return J.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return J.get(`/pvgis/optimum/${t}`)}},pt={async getStatus(){return J.get("/ha/status")},async getSensors(){return J.get("/ha/sensors")},async getMapping(){return J.get("/ha/mapping")},async getMqttConfig(){return J.get("/ha/export/mqtt/config")},async getExportSensors(){return J.get("/ha/export/sensors")},async getAnlageSensors(t){return J.get(`/ha/export/sensors/${t}`)},async getYamlSnippet(t){return J.get(`/ha/export/yaml/${t}`)},async getSensorDefinitions(){return J.get("/ha/export/definitions")},async testMqtt(t){return J.post("/ha/export/mqtt/test",t||{})},async publishMqtt(t,r){return J.post(`/ha/export/mqtt/publish/${t}`,r||{})},async removeMqtt(t,r){return J.delete(`/ha/export/mqtt/remove/${t}`)}},Ct={async getUebersicht(t,r){const s=r?`?jahr=${r}`:"";return J.get(`/cockpit/uebersicht/${t}${s}`)},async getPrognoseVsIst(t,r){return J.get(`/cockpit/prognose-vs-ist/${t}?jahr=${r}`)},async getNachhaltigkeit(t){return J.get(`/cockpit/nachhaltigkeit/${t}`)},async getKomponentenZeitreihe(t,r){const s=r?`?jahr=${r}`:"";return J.get(`/cockpit/komponenten-zeitreihe/${t}${s}`)},async getPVStrings(t,r){const s=r?`?jahr=${r}`:"";return J.get(`/cockpit/pv-strings/${t}${s}`)}},fr={async getMonatsdaten(t,r,s,n="auto"){return J.get(`/wetter/monat/${t}/${r}/${s}?provider=${n}`)},async getMonatsdatenByCoords(t,r,s,n,a="auto"){return J.get(`/wetter/monat/koordinaten/${t}/${r}/${s}/${n}?provider=${a}`)},async getProvider(t){return J.get(`/wetter/provider/${t}`)},async getVergleich(t,r,s){return J.get(`/wetter/vergleich/${t}/${r}/${s}`)},async getSolarPrognose(t,r=7,s=!1){const n=await J.get(`/solar-prognose/${t}?tage=${r}&pro_string=${s}`);return{...n,tage:n.tageswerte,anlage:{id:n.anlage_id,name:n.anlagenname,leistung_kwp:n.kwp_gesamt,neigung:n.neigung,azimut:n.ausrichtung}}}},ir={async getMapping(t){return J.get(`/sensor-mapping/${t}`)},async getAvailableSensors(t,r=!0){const s=new URLSearchParams;r||s.set("filter_energy","false");const n=s.toString()?`?${s.toString()}`:"";return J.get(`/sensor-mapping/${t}/available-sensors${n}`)},async saveMapping(t,r){return J.post(`/sensor-mapping/${t}`,r)},async deleteMapping(t){await J.delete(`/sensor-mapping/${t}`)},async getStatus(t){return J.get(`/sensor-mapping/${t}/status`)},async initStartValues(t){return J.post(`/sensor-mapping/${t}/init-start-values`,{})}},Nr={async getStatus(t,r,s){return J.get(`/monatsabschluss/${t}/${r}/${s}`)},async save(t,r,s,n){return J.post(`/monatsabschluss/${t}/${r}/${s}`,n)},async getNaechsterMonat(t){try{return await J.get(`/monatsabschluss/naechster/${t}`)}catch{return null}},async getHistorie(t,r=12){return J.get(`/monatsabschluss/historie/${t}?limit=${r}`)}};function Ce(){const[t,r]=d.useState([]),[s,n]=d.useState(!0),[a,i]=d.useState(null),x=d.useCallback(async()=>{try{n(!0),i(null);const l=await et.list();r(l)}catch(l){i(l instanceof Error?l.message:"Fehler beim Laden der Anlagen")}finally{n(!1)}},[]);d.useEffect(()=>{x()},[x]);const o=d.useCallback(async l=>{const j=await et.create(l);return r(h=>[...h,j]),j},[]),c=d.useCallback(async(l,j)=>{const h=await et.update(l,j);return r(p=>p.map(m=>m.id===l?h:m)),h},[]),u=d.useCallback(async l=>{await et.delete(l),r(j=>j.filter(h=>h.id!==l))},[]);return{anlagen:t,loading:s,error:a,refresh:x,createAnlage:o,updateAnlage:c,deleteAnlage:u}}function ta(t,r){const[s,n]=d.useState([]),[a,i]=d.useState(!0),[x,o]=d.useState(null),c=d.useCallback(async()=>{try{i(!0),o(null);const h=await _t.list(t,r);n(h)}catch(h){o(h instanceof Error?h.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[t,r]);d.useEffect(()=>{c()},[c]);const u=d.useCallback(async h=>{const p=await _t.create(h);return n(m=>[p,...m]),p},[]),l=d.useCallback(async(h,p)=>{const m=await _t.update(h,p);return n(g=>g.map(v=>v.id===h?m:v)),m},[]),j=d.useCallback(async h=>{await _t.delete(h),n(p=>p.filter(m=>m.id!==h))},[]);return{monatsdaten:s,loading:a,error:x,refresh:c,createMonatsdaten:u,updateMonatsdaten:l,deleteMonatsdaten:j}}function qa(t){return{gesamtErzeugung:t.reduce((r,s)=>r+(s.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((r,s)=>r+s.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((r,s)=>r+s.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((r,s)=>r+(s.eigenverbrauch_kwh||0),0),durchschnittAutarkie:t.length>0?t.reduce((r,s)=>{const n=s.eigenverbrauch_kwh||0,a=(s.eigenverbrauch_kwh||0)+s.netzbezug_kwh;return r+(a>0?n/a*100:0)},0)/t.length:0,anzahlMonate:t.length}}function Ot(t,r){const[s,n]=d.useState([]),[a,i]=d.useState(!0),[x,o]=d.useState(null),c=d.useCallback(async()=>{try{i(!0),o(null);const h=await Fe.list(t,r);n(h)}catch(h){o(h instanceof Error?h.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[t,r]);d.useEffect(()=>{c()},[c]);const u=d.useCallback(async h=>{const p=await Fe.create(h);return n(m=>[...m,p]),p},[]),l=d.useCallback(async(h,p)=>{const m=await Fe.update(h,p);return n(g=>g.map(v=>v.id===h?m:v)),m},[]),j=d.useCallback(async h=>{await Fe.delete(h),n(p=>p.filter(m=>m.id!==h))},[]);return{investitionen:s,loading:a,error:x,refresh:c,createInvestition:u,updateInvestition:l,deleteInvestition:j}}function Ua(t){return t.reduce((s,n)=>(s[n.typ]||(s[n.typ]=[]),s[n.typ].push(n),s),{})}function Ya(t){const[r,s]=d.useState([]),[n,a]=d.useState(!0),[i,x]=d.useState(null),o=d.useCallback(async()=>{try{a(!0),x(null);const j=await Vt.list(t);s(j)}catch(j){x(j instanceof Error?j.message:"Fehler beim Laden der Strompreise")}finally{a(!1)}},[t]);d.useEffect(()=>{o()},[o]);const c=d.useCallback(async j=>{const h=await Vt.create(j);return s(p=>[h,...p]),h},[]),u=d.useCallback(async(j,h)=>{const p=await Vt.update(j,h);return s(m=>m.map(g=>g.id===j?p:g)),p},[]),l=d.useCallback(async j=>{await Vt.delete(j),s(h=>h.filter(p=>p.id!==j))},[]);return{strompreise:r,loading:n,error:i,refresh:o,createStrompreis:c,updateStrompreis:u,deleteStrompreis:l}}function ra(t){const[r,s]=d.useState(null),[n,a]=d.useState(!1),[i,x]=d.useState(null);return d.useEffect(()=>{if(t===null){s(null);return}(async()=>{try{a(!0),x(null);const c=await Vt.getAktuell(t);s(c)}catch{s(null)}finally{a(!1)}})()},[t]),{strompreis:r,loading:n,error:i}}const Nt={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function sa(t){return t<=10?8.2:t<=40?7.1:5.8}const _r="eedc_setup_wizard_state",bs={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},wt=["welcome","anlage","strompreise","investitionen","summary","complete"],aa=["wechselrichter","pv-module","speicher","balkonkraftwerk","waermepumpe","e-auto","wallbox","sonstiges"],Qe={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"W√§rmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},Qa={"pv-module":"wechselrichter",speicher:"wechselrichter"},Xa=["pv-module"];function en(){const[t,r]=d.useState(()=>{try{const G=localStorage.getItem(_r);if(G)return JSON.parse(G)}catch{}return bs}),[s,n]=d.useState(t.currentStep),[a,i]=d.useState(!1),[x,o]=d.useState(null),[c,u]=d.useState(null),[l,j]=d.useState(null),[h,p]=d.useState([]),[m,g]=d.useState(null),[v,w]=d.useState(null),k=d.useRef(new Map);d.useEffect(()=>{localStorage.setItem(_r,JSON.stringify({...t,currentStep:s}))},[t,s]),d.useEffect(()=>{t.anlageId&&!c&&et.get(t.anlageId).then(u).catch(()=>{})},[t.anlageId,c]);const N=d.useCallback(async()=>{if(t.anlageId)try{const G=await Fe.list(t.anlageId);p(G)}catch{}},[t.anlageId]);d.useEffect(()=>{N()},[N]);const S=d.useCallback(G=>{n(G),o(null)},[]),y=d.useCallback(async()=>{const G=k.current;if(G.size===0)return;const B=[];G.forEach(({data:he,timer:Ne},_e)=>{clearTimeout(Ne),B.push(Fe.update(_e,he).catch(ie=>{console.error(`Fehler beim Update von Investition ${_e}:`,ie)}))}),G.clear(),await Promise.all(B),await N()},[N]),b=d.useCallback(async()=>{await y();const G=wt.indexOf(s);G<wt.length-1&&S(wt[G+1])},[s,S,y]),W=d.useCallback(()=>{const G=wt.indexOf(s);G>0&&S(wt[G-1])},[s,S]),H=d.useCallback(()=>{r(G=>({...G,skippedSteps:[...G.skippedSteps,s]})),b()},[s,b]),P=d.useCallback(async(G,B)=>{try{const he=await et.geocode(G,B);return{latitude:he.latitude,longitude:he.longitude}}catch{return null}},[]),Z=d.useCallback(async G=>{i(!0),o(null);try{const B=await et.create(G);u(B),r(he=>({...he,anlageId:B.id})),b()}catch(B){o(B instanceof Error?B.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[b]),C=d.useCallback(async G=>{if(!t.anlageId){o("Keine Anlage vorhanden");return}i(!0),o(null);try{const B=await Vt.create({anlage_id:t.anlageId,...G});j(B),r(he=>({...he,strompreisId:B.id})),b()}catch(B){o(B instanceof Error?B.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[t.anlageId,b]),f=d.useCallback(async()=>{if(!t.anlageId||!c){o("Keine Anlage vorhanden");return}const G=sa(c.leistung_kwp);await C({netzbezug_arbeitspreis_cent_kwh:Nt.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:G,grundpreis_euro_monat:Nt.grundpreis_euro_monat,gueltig_ab:c.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,c,C]),$=d.useCallback(async(G,B)=>{p(ie=>ie.map(D=>D.id!==G?D:{...D,...B,parameter:B.parameter?{...D.parameter||{},...B.parameter}:D.parameter}));const he=k.current.get(G);he!=null&&he.timer&&clearTimeout(he.timer);const Ne=he!=null&&he.data?{...he.data,...B,parameter:B.parameter?{...he.data.parameter||{},...B.parameter}:he.data.parameter}:B,_e=setTimeout(async()=>{k.current.delete(G);try{await Fe.update(G,Ne)}catch(ie){o(ie instanceof Error?ie.message:"Fehler beim Aktualisieren"),await N()}},500);k.current.set(G,{data:Ne,timer:_e})},[N]),K=d.useCallback(async G=>{try{await Fe.delete(G),await N()}catch(B){o(B instanceof Error?B.message:"Fehler beim L√∂schen")}},[N]),O=d.useCallback(async G=>{if(!t.anlageId)throw new Error("Keine Anlage vorhanden");o(null);try{const B=await Fe.create({anlage_id:t.anlageId,typ:G,bezeichnung:`Neue ${Qe[G]}`,aktiv:!0});return await N(),B}catch(B){const he=B instanceof Error?B.message:"Fehler beim Hinzuf√ºgen";throw o(he),B}},[t.anlageId,N]),X=d.useCallback(async()=>{if(!t.anlageId||!c){o("Keine Anlage vorhanden");return}i(!0),o(null);try{const G=await Fe.create({anlage_id:t.anlageId,typ:"wechselrichter",bezeichnung:"Wechselrichter",aktiv:!0,anschaffungsdatum:c.installationsdatum});await Fe.create({anlage_id:t.anlageId,typ:"pv-module",bezeichnung:"PV-Module",leistung_kwp:c.leistung_kwp,ausrichtung:c.ausrichtung,neigung_grad:c.neigung_grad,parent_investition_id:G.id,aktiv:!0,anschaffungsdatum:c.installationsdatum}),r(B=>({...B,createdInvestitionen:[...B.createdInvestitionen,G.id]})),await N()}catch(G){o(G instanceof Error?G.message:"Fehler beim Erstellen des PV-Systems")}finally{i(!1)}},[t.anlageId,c,N]),Q=d.useCallback(async()=>{if(!t.anlageId||!c)return;if(!c.latitude||!c.longitude){w("Keine Koordinaten vorhanden");return}if(!h.some(B=>B.typ==="pv-module")){w("Keine PV-Module vorhanden");return}i(!0),w(null);try{const B=await Ue.speicherePrognose(t.anlageId);g(B)}catch(B){const he=B instanceof Error?B.message:"Fehler beim Abrufen der PVGIS-Prognose";w(he)}finally{i(!1)}},[t.anlageId,c,h]),_=d.useCallback(()=>{r(G=>({...G,completed:!0,currentStep:"complete"})),n("complete")},[]),F=d.useCallback(()=>{localStorage.removeItem(_r),r(bs),n("welcome"),u(null),j(null),p([]),o(null)},[]),I=(()=>{switch(s){case"welcome":return!0;case"anlage":return!!t.anlageId;case"strompreise":return!!t.strompreisId;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),q=Math.round(wt.indexOf(s)/(wt.length-1)*100),ne=!!(c!=null&&c.latitude&&(c!=null&&c.longitude)&&h.some(G=>G.typ==="pv-module"));return{step:s,wizardState:t,isLoading:a,error:x,anlage:c,strompreis:l,pvgisPrognose:m,pvgisError:v,investitionen:h,refreshInvestitionen:N,goToStep:S,nextStep:b,prevStep:W,skipStep:H,createAnlage:Z,geocodeAddress:P,createStrompreis:C,useDefaultStrompreise:f,updateInvestition:$,deleteInvestition:K,addInvestition:O,createDefaultPVSystem:X,fetchPvgisPrognose:Q,completeWizard:_,resetWizard:F,canProceed:I,progress:q,canFetchPvgis:ne}}const tn=[],rn=[{name:"Anlage",href:"/einstellungen/anlage",icon:lt},{name:"Strompreise",href:"/einstellungen/strompreise",icon:xe},{name:"Investitionen",href:"/einstellungen/investitionen",icon:Ft},{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:Rs},{name:"Import/Export",href:"/einstellungen/import",icon:tr},{name:"Solarprognose",href:"/einstellungen/solarprognose",icon:re},{name:"Allgemein",href:"/einstellungen/allgemein",icon:Rr}];function sn(){var j;const{anlagen:t}=Ce(),r=(j=t[0])==null?void 0:j.id,{investitionen:s}=Ot(r),n=[{name:"√úbersicht",href:"/cockpit",icon:Tr,exact:!0}];return s.some(h=>h.typ==="wechselrichter"||h.typ==="pv-module")&&n.push({name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:re}),s.some(h=>h.typ==="e-auto")&&n.push({name:"E-Auto",href:"/cockpit/e-auto",icon:ve}),s.some(h=>h.typ==="waermepumpe")&&n.push({name:"W√§rmepumpe",href:"/cockpit/waermepumpe",icon:Ee}),s.some(h=>h.typ==="speicher")&&n.push({name:"Speicher",href:"/cockpit/speicher",icon:fe}),s.some(h=>h.typ==="wallbox")&&n.push({name:"Wallbox",href:"/cockpit/wallbox",icon:xt}),s.some(h=>h.typ==="balkonkraftwerk")&&n.push({name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:re}),s.some(h=>h.typ==="sonstiges")&&n.push({name:"Sonstiges",href:"/cockpit/sonstiges",icon:br}),n}function an(){const t=Ls(),r=sn(),n=t.pathname.startsWith("/cockpit")?r:t.pathname.startsWith("/auswertungen")?tn:t.pathname.startsWith("/einstellungen")?rn:null;return!n||n.length===0?null:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:n.map(a=>e.jsxs(Ir,{to:a.href,end:a.exact,className:({isActive:i})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${i?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(a.icon,{className:"h-4 w-4"}),a.name]},a.href))})})})}const nn="1.1.0-beta.4",ln="eedc",dn="Energie Effizienz Data Center",cn=`${ln} v${nn} ‚Äì ${dn}`;function on(){return e.jsxs("div",{className:"h-screen bg-gray-50 dark:bg-gray-900 flex flex-col overflow-hidden",children:[e.jsx(Ga,{}),e.jsx(an,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(oa,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:cn})})]})}const ee=d.forwardRef(({className:t="",variant:r="primary",size:s="md",loading:n,disabled:a,children:i,...x},o)=>{const c="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",u={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},l={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:o,className:`${c} ${u[r]} ${l[s]} ${t}`,disabled:a||n,...x,children:[n&&e.jsx(Oe,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});ee.displayName="Button";const L=d.forwardRef(({className:t="",label:r,error:s,hint:n,id:a,...i},x)=>{const o=a||i.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:x,id:o,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${s?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...i}),n&&!s&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n}),s&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s})]})});L.displayName="Input";const Je=d.forwardRef(({className:t="",label:r,error:s,options:n,placeholder:a,id:i,...x},o)=>{const c=i||x.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,x.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:o,id:c,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${s?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...x,children:[a&&e.jsx("option",{value:"",children:a}),n.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]}),s&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s})]})});Je.displayName="Select";function tt({isOpen:t,onClose:r,title:s,children:n,size:a="md"}){if(d.useEffect(()=>{const x=o=>{o.key==="Escape"&&r()};return t&&(document.addEventListener("keydown",x),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",x),document.body.style.overflow=""}},[t,r]),!t)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:r}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[a]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s}),e.jsx("button",{onClick:r,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Mt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:n})]})})]})}function M({children:t,className:r="",padding:s="md"}){const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${n[s]}
        ${r}
      `,children:t})}function js({title:t,subtitle:r,action:s}){return e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),r&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r})]}),s&&e.jsx("div",{children:s})]})}function Y({type:t,title:r,children:s,onClose:n,className:a=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:Le},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:Xe},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:Ie},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:Gr}},{bg:x,border:o,text:c,icon:u}=i[t];return e.jsx("div",{className:`${x} ${o} border rounded-lg p-4 relative ${a}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(u,{className:`w-5 h-5 ${c} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[r&&e.jsx("h4",{className:`text-sm font-medium ${c}`,children:r}),e.jsx("div",{className:`text-sm ${c} ${r?"mt-1":""}`,children:s})]}),n&&e.jsx("button",{onClick:n,className:`ml-3 ${c} hover:opacity-70 transition-opacity`,children:e.jsx(Mt,{className:"w-4 h-4"})})]})})}function Jr({children:t,className:r=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${r}`,children:t})})}function Zr({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function qr({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function Kt({children:t,onClick:r,className:s=""}){return e.jsx("tr",{className:`${r?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${s}`,onClick:r,children:t})}function De({children:t,className:r=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${r}`,children:t})}function Ve({children:t,className:r=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${r}`,children:t})}function Bt({icon:t,title:r,description:s,action:n}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:s}),n&&e.jsx("div",{children:n})]})}function pe({size:t="md",text:r}){const s={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Oe,{className:`${s[t]} text-primary-600 animate-spin`}),r&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:r})]})}function bt({children:t,formel:r,berechnung:s,ergebnis:n,className:a="",showIcon:i=!0}){const[x,o]=d.useState(!1),[c,u]=d.useState("top"),l=d.useRef(null);return d.useEffect(()=>{if(x&&l.current){const j=l.current.getBoundingClientRect();u(j.top<120?"bottom":"top")}},[x]),e.jsxs("span",{ref:l,className:`relative inline-block cursor-help ${a}`,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[t,i&&e.jsx(Le,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),x&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${c==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${c==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:r}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:s})]}),n&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:n})]})]})]})}function z(t,r=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r})}const gn={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function be({title:t,value:r,unit:s,subtitle:n,icon:a,color:i="blue",trend:x,formel:o,berechnung:c,ergebnis:u}){const l=gn[i],j=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof r=="number"?r.toLocaleString("de-DE"):r,s&&e.jsx("span",{className:"text-sm font-normal ml-1",children:s}),x==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"‚Üë"}),x==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"‚Üì"})]});return e.jsx(M,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:o?e.jsx(bt,{formel:o,berechnung:c,ergebnis:u,children:j}):j}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${l.bg} ml-3 flex-shrink-0`,children:e.jsx(a,{className:`h-6 w-6 ${l.icon}`})})]})})}function hn(){var g,v,w,k,N,S,y;const t=$t(),{anlagen:r,loading:s}=Ce(),[n,a]=d.useState(null),[i,x]=d.useState(!1),[o,c]=d.useState(null),[u,l]=d.useState(void 0),[j,h]=d.useState([]),p=(g=r[0])==null?void 0:g.id;if(d.useEffect(()=>{if(!p)return;(async()=>{x(!0),c(null);try{const W=await Ct.getUebersicht(p,u);if(a(W),W.zeitraum_von&&W.zeitraum_bis){const H=parseInt(W.zeitraum_von.split("-")[0]),P=parseInt(W.zeitraum_bis.split("-")[0]),Z=[];for(let C=H;C<=P;C++)Z.push(C);h(Z)}}catch(W){c("Fehler beim Laden der Daten"),console.error(W)}finally{x(!1)}})()},[p,u]),s||i)return e.jsx(pe,{text:"Lade Dashboard..."});if(r.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"√úbersicht"}),e.jsx(xn,{})]});if(o||!n)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"√úbersicht"}),e.jsxs(M,{children:[e.jsx("p",{className:"text-red-500",children:o||"Keine Daten verf√ºgbar"}),e.jsx(ee,{onClick:()=>t("/einstellungen/monatsdaten"),className:"mt-4",children:"Monatsdaten erfassen"})]})]});const m=r[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{className:"h-8 w-8 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"√úbersicht"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[m.anlagenname," ‚Ä¢ ",n.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:u||"",onChange:b=>l(b.target.value?parseInt(b.target.value):void 0),className:"input py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Alle Jahre"}),j.map(b=>e.jsx("option",{value:b,children:b},b))]})]})]}),n.zeitraum_von&&n.zeitraum_bis&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Zeitraum: ",n.zeitraum_von," bis ",n.zeitraum_bis," (",n.anzahl_monate," Monate)"]}),e.jsx(lr,{title:"Energie-Bilanz",icon:xe,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"PV-Erzeugung",value:(n.pv_erzeugung_kwh/1e3).toFixed(1),unit:"MWh",icon:re,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>t("/cockpit/pv-anlage"),formel:"Œ£ PV-Erzeugung aller Monate",berechnung:`${z(n.pv_erzeugung_kwh,0)} kWh`,ergebnis:`= ${z(n.pv_erzeugung_kwh/1e3,1)} MWh`}),e.jsx(we,{title:"Gesamtverbrauch",value:(n.gesamtverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:lt,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch + Netzbezug",berechnung:`${z(n.eigenverbrauch_kwh,0)} + ${z(n.netzbezug_kwh,0)} kWh`,ergebnis:`= ${z(n.gesamtverbrauch_kwh/1e3,1)} MWh`}),e.jsx(we,{title:"Netzbezug",value:(n.netzbezug_kwh/1e3).toFixed(1),unit:"MWh",icon:hs,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Œ£ Netzbezug aller Monate",berechnung:`${z(n.netzbezug_kwh,0)} kWh`,ergebnis:`= ${z(n.netzbezug_kwh/1e3,1)} MWh`}),e.jsx(we,{title:"Einspeisung",value:(n.einspeisung_kwh/1e3).toFixed(1),unit:"MWh",icon:vr,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Œ£ Einspeisung aller Monate",berechnung:`${z(n.einspeisung_kwh,0)} kWh`,ergebnis:`= ${z(n.einspeisung_kwh/1e3,1)} MWh`})]})}),e.jsx(lr,{title:"Effizienz-Quoten",icon:er,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"Autarkie",value:n.autarkie_prozent.toFixed(1),unit:"%",subtitle:"Unabh√§ngigkeit vom Netz",icon:nr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch √∑ Gesamtverbrauch √ó 100",berechnung:`${z(n.eigenverbrauch_kwh,0)} √∑ ${z(n.gesamtverbrauch_kwh,0)} √ó 100`,ergebnis:`= ${z(n.autarkie_prozent,1)} %`}),e.jsx(we,{title:"Eigenverbrauchsquote",value:n.eigenverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Selbst genutzte PV",icon:xe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch √∑ Erzeugung √ó 100",berechnung:`${z(n.eigenverbrauch_kwh,0)} √∑ ${z(n.pv_erzeugung_kwh,0)} √ó 100`,ergebnis:`= ${z(n.eigenverbrauch_quote_prozent,1)} %`}),e.jsx(we,{title:"Direktverbrauchsquote",value:n.direktverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Ohne Speicher-Umweg",icon:ke,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Direktverbrauch √∑ Erzeugung √ó 100",berechnung:`${z(n.direktverbrauch_kwh,0)} √∑ ${z(n.pv_erzeugung_kwh,0)} √ó 100`,ergebnis:`= ${z(n.direktverbrauch_quote_prozent,1)} %`}),e.jsx(we,{title:"Spez. Ertrag",value:((v=n.spezifischer_ertrag_kwh_kwp)==null?void 0:v.toFixed(0))||"---",unit:"kWh/kWp",subtitle:"Anlageneffizienz",icon:re,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Erzeugung √∑ Anlagenleistung",berechnung:`${z(n.pv_erzeugung_kwh,0)} kWh √∑ ${z(n.anlagenleistung_kwp,2)} kWp`,ergebnis:`= ${z(n.spezifischer_ertrag_kwh_kwp||0,0)} kWh/kWp`})]})}),n.hat_speicher&&e.jsx(zr,{title:"Speicher",icon:fe,onClick:()=>t("/cockpit/speicher"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"Ladung gesamt",value:(n.speicher_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:hs,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Œ£ Speicher-Ladung",berechnung:`${z(n.speicher_ladung_kwh,0)} kWh`,ergebnis:`= ${z(n.speicher_ladung_kwh/1e3,2)} MWh`}),e.jsx(we,{title:"Entladung gesamt",value:(n.speicher_entladung_kwh/1e3).toFixed(2),unit:"MWh",icon:vr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ Speicher-Entladung",berechnung:`${z(n.speicher_entladung_kwh,0)} kWh`,ergebnis:`= ${z(n.speicher_entladung_kwh/1e3,2)} MWh`}),e.jsx(we,{title:"√ò Effizienz",value:((w=n.speicher_effizienz_prozent)==null?void 0:w.toFixed(1))||"---",unit:"%",icon:nr,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"Entladung √∑ Ladung √ó 100",berechnung:`${z(n.speicher_entladung_kwh,0)} √∑ ${z(n.speicher_ladung_kwh,0)} √ó 100`,ergebnis:`= ${z(n.speicher_effizienz_prozent||0,1)} %`}),e.jsx(we,{title:"Vollzyklen",value:((k=n.speicher_vollzyklen)==null?void 0:k.toFixed(0))||"---",unit:"",subtitle:`${n.speicher_kapazitaet_kwh.toFixed(1)} kWh Kapazit√§t`,icon:fe,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Ladung √∑ Kapazit√§t",berechnung:`${z(n.speicher_ladung_kwh,0)} kWh √∑ ${z(n.speicher_kapazitaet_kwh,1)} kWh`,ergebnis:`= ${z(n.speicher_vollzyklen||0,0)} Zyklen`})]})}),n.hat_waermepumpe&&e.jsx(zr,{title:"W√§rmepumpe",icon:Ee,onClick:()=>t("/cockpit/waermepumpe"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"W√§rme erzeugt",value:(n.wp_waerme_kwh/1e3).toFixed(2),unit:"MWh",icon:Ee,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Œ£ Heizung + Warmwasser",berechnung:`${z(n.wp_waerme_kwh,0)} kWh`,ergebnis:`= ${z(n.wp_waerme_kwh/1e3,2)} MWh`}),e.jsx(we,{title:"Strom verbraucht",value:(n.wp_strom_kwh/1e3).toFixed(2),unit:"MWh",icon:xe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Œ£ WP-Stromverbrauch",berechnung:`${z(n.wp_strom_kwh,0)} kWh`,ergebnis:`= ${z(n.wp_strom_kwh/1e3,2)} MWh`}),e.jsx(we,{title:"√ò COP",value:((N=n.wp_cop)==null?void 0:N.toFixed(1))||"---",unit:"",icon:nr,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"W√§rme √∑ Strom",berechnung:`${z(n.wp_waerme_kwh,0)} √∑ ${z(n.wp_strom_kwh,0)}`,ergebnis:`= ${z(n.wp_cop||0,1)}`}),e.jsx(we,{title:"Ersparnis vs. Gas",value:n.wp_ersparnis_euro.toFixed(0),unit:"‚Ç¨",icon:nt,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Gaskosten - Stromkosten",berechnung:`(${z(n.wp_waerme_kwh,0)} kWh √∑ 0.9 √ó 10ct) - (${z(n.wp_strom_kwh,0)} kWh √ó Strompreis)`,ergebnis:`= ${z(n.wp_ersparnis_euro,0)} ‚Ç¨`})]})}),n.hat_emobilitaet&&e.jsx(zr,{title:"E-Mobilit√§t",icon:ve,onClick:()=>t("/cockpit/e-auto"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"Gefahrene km",value:(n.emob_km/1e3).toFixed(1),unit:"Tkm",icon:ve,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Œ£ gefahrene Kilometer",berechnung:`${z(n.emob_km,0)} km`,ergebnis:`= ${z(n.emob_km/1e3,1)} Tkm`}),e.jsx(we,{title:"Ladung gesamt",value:(n.emob_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:xe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ Heim + Extern Ladung",berechnung:`${z(n.emob_ladung_kwh,0)} kWh`,ergebnis:`= ${z(n.emob_ladung_kwh/1e3,2)} MWh`}),e.jsx(we,{title:"PV-Anteil",value:((S=n.emob_pv_anteil_prozent)==null?void 0:S.toFixed(0))||"---",unit:"%",icon:re,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"PV-Ladung √∑ Heimladung √ó 100",berechnung:"PV-geladene kWh √∑ Gesamt-Ladung",ergebnis:`= ${z(n.emob_pv_anteil_prozent||0,0)} %`}),e.jsx(we,{title:"Ersparnis vs. Benzin",value:n.emob_ersparnis_euro.toFixed(0),unit:"‚Ç¨",icon:nt,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Benzinkosten - Stromkosten",berechnung:"Benzin (7L/100km √ó 1.80‚Ç¨) - Strom",ergebnis:`= ${z(n.emob_ersparnis_euro,0)} ‚Ç¨`})]})}),e.jsx(lr,{title:"Finanzen",icon:nt,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"Einspeiseerl√∂s",value:n.einspeise_erloes_euro.toFixed(0),unit:"‚Ç¨",icon:vr,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung √ó Verg√ºtung",berechnung:`${z(n.einspeisung_kwh,0)} kWh √ó 8.2 ct/kWh`,ergebnis:`= ${z(n.einspeise_erloes_euro,0)} ‚Ç¨`}),e.jsx(we,{title:"EV-Ersparnis",value:n.ev_ersparnis_euro.toFixed(0),unit:"‚Ç¨",icon:xe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch √ó Strompreis",berechnung:`${z(n.eigenverbrauch_kwh,0)} kWh √ó Strompreis`,ergebnis:`= ${z(n.ev_ersparnis_euro,0)} ‚Ç¨`}),e.jsx(we,{title:"Netto-Ertrag",value:n.netto_ertrag_euro.toFixed(0),unit:"‚Ç¨",icon:ke,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Erl√∂s + Ersparnis",berechnung:`${z(n.einspeise_erloes_euro,0)} + ${z(n.ev_ersparnis_euro,0)} ‚Ç¨`,ergebnis:`= ${z(n.netto_ertrag_euro,0)} ‚Ç¨`}),e.jsx(we,{title:"Jahres-Rendite",value:((y=n.jahres_rendite_prozent)==null?void 0:y.toFixed(1))||"---",unit:"%",subtitle:`von ${n.investition_gesamt_euro.toFixed(0)} ‚Ç¨ Invest`,icon:nr,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",onClick:()=>t("/auswertungen/roi"),formel:"Jahres-Ertrag √∑ Investition √ó 100",berechnung:`${z(n.netto_ertrag_euro,0)} ‚Ç¨ √∑ ${z(n.investition_gesamt_euro,0)} ‚Ç¨`,ergebnis:`= ${z(n.jahres_rendite_prozent||0,1)} % p.a.`})]})}),e.jsx(lr,{title:"CO‚ÇÇ-Bilanz",icon:Ke,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(we,{title:"CO‚ÇÇ PV",value:(n.co2_pv_kg/1e3).toFixed(1),unit:"t",subtitle:"Vermiedene Emissionen",icon:re,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Eigenverbrauch √ó CO‚ÇÇ-Faktor",berechnung:`${z(n.eigenverbrauch_kwh,0)} kWh √ó 0.38 kg/kWh`,ergebnis:`= ${z(n.co2_pv_kg,0)} kg`}),e.jsx(we,{title:"CO‚ÇÇ W√§rmepumpe",value:(n.co2_wp_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Gas-Heizung",icon:Ee,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO‚ÇÇ Gas - CO‚ÇÇ Strom",berechnung:"Gasverbrauch √ó 0.201 - WP-Strom √ó 0.38",ergebnis:`= ${z(n.co2_wp_kg,0)} kg`}),e.jsx(we,{title:"CO‚ÇÇ E-Mobilit√§t",value:(n.co2_emob_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Verbrenner",icon:ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"CO‚ÇÇ Benzin - CO‚ÇÇ Strom",berechnung:"Benzinverbrauch √ó 2.37 - Stromverbrauch √ó 0.38",ergebnis:`= ${z(n.co2_emob_kg,0)} kg`}),e.jsx(we,{title:"CO‚ÇÇ gesamt",value:(n.co2_gesamt_kg/1e3).toFixed(1),unit:"t",subtitle:"Gesamte Einsparung",icon:Ke,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Œ£ aller CO‚ÇÇ-Einsparungen",berechnung:`${z(n.co2_pv_kg,0)} + ${z(n.co2_wp_kg,0)} + ${z(n.co2_emob_kg,0)} kg`,ergebnis:`= ${z(n.co2_gesamt_kg/1e3,1)} t`})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Sr,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/einstellungen/monatsdaten")}),e.jsx(Sr,{title:"Auswertungen",description:"Detaillierte Analysen und Zeitverl√§ufe",onClick:()=>t("/auswertungen")}),e.jsx(Sr,{title:"Investitionen",description:"Komponenten verwalten",onClick:()=>t("/einstellungen/investitionen")})]})]})}function lr({title:t,icon:r,children:s}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),s]})}function zr({title:t,icon:r,onClick:s,children:n}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),e.jsx(rt,{className:"h-4 w-4 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),n]})}function we({title:t,value:r,unit:s,subtitle:n,icon:a,color:i,bgColor:x,onClick:o,formel:c,berechnung:u,ergebnis:l}){const j=e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:s})]}),h=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-0.5",children:c?e.jsx(bt,{formel:c,berechnung:u,ergebnis:l,children:j}):j}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate",children:n})]}),e.jsx("div",{className:`p-2 rounded-lg ${x} ml-2 flex-shrink-0`,children:e.jsx(a,{className:`h-5 w-5 ${i}`})})]});return o?e.jsx("button",{onClick:o,className:"card p-3 text-left hover:shadow-md transition-shadow w-full",children:h}):e.jsx(M,{className:"p-3",children:h})}function Sr({title:t,description:r,onClick:s}){return e.jsx("button",{onClick:s,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsx(Pe,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function xn(){const t=$t();return e.jsxs(M,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(ee,{onClick:()=>t("/einstellungen/anlage"),children:["Jetzt starten",e.jsx(Pe,{className:"h-4 w-4 ml-2"})]})]})}const ut=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function mn({anlageId:t,jahr:r}){var p;const[s,n]=d.useState(null),[a,i]=d.useState(!0),[x,o]=d.useState(null),[c,u]=d.useState(null);d.useEffect(()=>{(async()=>{i(!0),o(null);try{const g=await Ct.getPVStrings(t,r);n(g)}catch(g){const v=g&&typeof g=="object"&&"detail"in g?g.detail:"Fehler beim Laden der String-Daten";o(v),console.error("PVStringVergleich Fehler:",g)}finally{i(!1)}})()},[t,r]);const l=d.useMemo(()=>s!=null&&s.strings?s.strings.map((m,g)=>({name:m.bezeichnung.length>15?m.bezeichnung.slice(0,15)+"...":m.bezeichnung,fullName:m.bezeichnung,Prognose:m.prognose_jahr_kwh,IST:m.ist_jahr_kwh,Performance:m.performance_ratio_jahr?m.performance_ratio_jahr*100:null,color:ut[g%ut.length]})):[],[s]),j=d.useMemo(()=>{if(!(s!=null&&s.strings)||c===null)return[];const m=s.strings.find(g=>g.investition_id===c);return m?m.monatswerte.map(g=>({name:g.monat_name,Prognose:g.prognose_kwh,IST:g.ist_kwh,Abweichung:g.abweichung_kwh})):[]},[s,c]);if(a)return e.jsx(pe,{text:"Lade String-Vergleich..."});if(x)return e.jsx(Y,{type:"error",children:x});if(!s||s.strings.length===0)return e.jsxs(M,{className:"text-center py-8",children:[e.jsx(re,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen ‚Üí Investitionen anlegen."})]});if(!s.hat_prognose)return e.jsx(Y,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen ‚Üí PVGIS eine Prognose abrufen."})]})});const h=({ratio:m})=>{if(m===null)return e.jsx("span",{className:"text-gray-400",children:"-"});const g=m*100,v=g>=95,w=g<85;return e.jsxs("span",{className:`flex items-center gap-1 ${v?"text-green-600":w?"text-red-600":"text-amber-600"}`,children:[v?e.jsx(ke,{className:"h-4 w-4"}):w?e.jsx(yt,{className:"h-4 w-4"}):null,g.toFixed(0),"%"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"SOLL (Prognose)"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:[(s.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"IST (Erzeugt)"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(s.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${(s.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Abweichung"}),e.jsxs("p",{className:`text-xl font-bold ${(s.abweichung_gesamt_prozent||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(s.abweichung_gesamt_prozent||0)>=0?"+":"",((p=s.abweichung_gesamt_prozent)==null?void 0:p.toFixed(1))||0,"%"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-700 dark:text-gray-300",children:[s.anlagen_leistung_kwp.toFixed(1)," kWp"]})]})]}),(s.bester_string||s.schlechtester_string)&&s.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[s.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full",children:[e.jsx(ke,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300",children:["Beste Performance: ",e.jsx("strong",{children:s.bester_string})]})]}),s.schlechtester_string&&s.schlechtester_string!==s.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-full",children:[e.jsx(yt,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-red-700 dark:text-red-300",children:["Schw√§chster: ",e.jsx("strong",{children:s.schlechtester_string})]})]})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Vergleich: SOLL vs IST"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:l,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{type:"number",unit:" kWh"}),e.jsx(le,{type:"category",dataKey:"name",width:120,tick:{fontSize:11}}),e.jsx(ae,{formatter:(m,g)=>[`${m.toFixed(0)} kWh`,g],labelFormatter:m=>{const g=l.find(v=>v.name===m);return(g==null?void 0:g.fullName)||m}}),e.jsx(je,{}),e.jsx(U,{dataKey:"Prognose",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(U,{dataKey:"IST",name:"IST (Erzeugt)",children:l.map((m,g)=>e.jsx(We,{fill:m.color},`cell-${g}`))})]})})})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einzelne Strings / Module"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String / Modul"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abw."}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Performance"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.strings.map((m,g)=>{var v,w;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer",onClick:()=>u(c===m.investition_id?null:m.investition_id),children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c===m.investition_id?e.jsx(ht,{className:"h-4 w-4 text-gray-400"}):e.jsx(rt,{className:"h-4 w-4 text-gray-400"}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ut[g%ut.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:m.bezeichnung})]}),m.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-9",children:["‚Üí ",m.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:m.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3 text-gray-600 dark:text-gray-400",children:[m.ausrichtung||"-",m.neigung_grad&&` / ${m.neigung_grad}¬∞`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600 dark:text-blue-400",children:[m.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right font-medium",style:{color:ut[g%ut.length]},children:[m.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right ${(m.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(m.abweichung_jahr_prozent||0)>=0?"+":"",((v=m.abweichung_jahr_prozent)==null?void 0:v.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(h,{ratio:m.performance_ratio_jahr})}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:((w=m.spezifischer_ertrag_kwh_kwp)==null?void 0:w.toFixed(0))||"-"})]},m.investition_id),c===m.investition_id&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-3 py-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:["Monatsverlauf: ",m.bezeichnung]}),e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:j,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10}}),e.jsx(le,{unit:" kWh",tick:{fontSize:10}}),e.jsx(ae,{formatter:k=>[`${k.toFixed(0)} kWh`,""]}),e.jsx(je,{}),e.jsx(U,{dataKey:"Prognose",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(U,{dataKey:"IST",fill:ut[g%ut.length],name:"IST"}),e.jsx(Ae,{type:"monotone",dataKey:"Abweichung",stroke:"#ef4444",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]})},`${m.investition_id}-detail`)]})})})]})})]})]})}const un=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Ze={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"},ks=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function pn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState(null),[x,o]=d.useState([]),[c,u]=d.useState(!0);d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]);const{investitionen:l,loading:j}=Ot(s),{availableYears:h,latestYear:p}=d.useMemo(()=>{if(x.length===0)return{availableYears:[],latestYear:new Date().getFullYear()};const F=[...new Set(x.map(I=>I.jahr))].sort((I,q)=>q-I);return{availableYears:F,latestYear:F[0]}},[x]),[m,g]=d.useState(void 0);d.useEffect(()=>{p&&!m&&g(p)},[p,m]),d.useEffect(()=>{if(!s)return;(async()=>{u(!0);try{const I=await Ct.getUebersicht(s,void 0);i(I);const q=await _t.listAggregiert(s);o(q)}catch(I){console.error("Fehler beim Laden der Daten:",I)}finally{u(!1)}})()},[s]);const{pvSysteme:v,orphanModule:w}=d.useMemo(()=>{const F=[],I=[],q=l.filter(B=>B.typ==="wechselrichter"),ne=l.filter(B=>B.typ==="pv-module"),G=l.filter(B=>B.typ==="speicher");for(const B of q){const he=ne.filter(ie=>ie.parent_investition_id===B.id),Ne=G.filter(ie=>ie.parent_investition_id===B.id),_e=he.reduce((ie,D)=>ie+(D.leistung_kwp||0),0);F.push({wechselrichter:B,pvModule:he,speicher:Ne,gesamtKwp:_e})}for(const B of ne)(!B.parent_investition_id||!q.find(he=>he.id===B.parent_investition_id))&&I.push(B);return{pvSysteme:F,orphanModule:I}},[l]),k=(a==null?void 0:a.anlagenleistung_kwp)||v.reduce((F,I)=>F+I.gesamtKwp,0)+w.reduce((F,I)=>F+(I.leistung_kwp||0),0),N=(a==null?void 0:a.pv_erzeugung_kwh)||0,S=(a==null?void 0:a.eigenverbrauch_kwh)||0,y=(a==null?void 0:a.einspeisung_kwh)||0,b=(a==null?void 0:a.spezifischer_ertrag_kwh_kwp)||0,W=(a==null?void 0:a.eigenverbrauch_quote_prozent)||0,H=(a==null?void 0:a.anzahl_monate)||0,P=a==null?void 0:a.zeitraum_von,Z=a==null?void 0:a.zeitraum_bis,C=d.useMemo(()=>{if(x.length===0)return[];const F=new Map;for(const I of x){F.has(I.jahr)||F.set(I.jahr,{erzeugung:0,eigenverbrauch:0,einspeisung:0});const q=F.get(I.jahr);q.erzeugung+=I.pv_erzeugung_kwh||0,q.eigenverbrauch+=I.eigenverbrauch_kwh||0,q.einspeisung+=I.einspeisung_kwh||0}return[...F.entries()].sort((I,q)=>I[0]-q[0]).map(([I,q])=>({name:I.toString(),Erzeugung:Math.round(q.erzeugung),Eigenverbrauch:Math.round(q.eigenverbrauch),Einspeisung:Math.round(q.einspeisung)}))},[x]),f=d.useMemo(()=>x.length===0||!m?[]:x.filter(F=>F.jahr===m).sort((F,I)=>F.monat-I.monat).map(F=>({name:un[F.monat],Erzeugung:Math.round(F.pv_erzeugung_kwh||0),Eigenverbrauch:Math.round(F.eigenverbrauch_kwh||0),Einspeisung:Math.round(F.einspeisung_kwh||0)})),[x,m]),$=d.useMemo(()=>N===0?[]:[{name:"Eigenverbrauch",value:S,color:Ze.consumption},{name:"Einspeisung",value:y,color:Ze.feedin}],[N,S,y]),K=d.useMemo(()=>{const F=v.flatMap(q=>q.pvModule).concat(w),I={};for(const q of F){const ne=q.ausrichtung||"Unbekannt";I[ne]||(I[ne]={kwp:0,count:0}),I[ne].kwp+=q.leistung_kwp||0,I[ne].count+=1}return Object.entries(I).map(([q,ne],G)=>({ausrichtung:q,kwp:ne.kwp,count:ne.count,color:ks[G%ks.length]}))},[v,w]);if(r||j||c)return e.jsx(pe,{text:"Lade PV-Anlage..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]});const X=N>0,Q=v.length>0||w.length>0,_=h.length>1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),P&&Z&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Gesamtlaufzeit: ",P," bis ",Z," (",H," Monate)"]})]})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:F=>n(parseInt(F.target.value)),options:t.map(F=>({value:F.id.toString(),label:F.anlagenname}))})]}),w.length>0&&e.jsx(Y,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsxs("span",{children:[w.length," PV-Modul(e) ohne Wechselrichter-Zuordnung. Bitte unter Einstellungen ‚Üí Investitionen zuordnen."]})]})}),!Q&&e.jsx(Y,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen ‚Üí Investitionen Wechselrichter und PV-Module anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(be,{title:"Anlagenleistung",value:k>0?k.toFixed(1):"---",unit:"kWp",subtitle:`${v.length} Wechselrichter, ${v.reduce((F,I)=>F+I.pvModule.length,0)+w.length} Module`,icon:re,color:"yellow"}),e.jsx(be,{title:"Gesamterzeugung",value:N>0?(N/1e3).toFixed(1):"---",unit:"MWh",subtitle:H>0?`${H} Monate Gesamtlaufzeit`:void 0,icon:xe,color:"green"}),e.jsx(be,{title:"Spez. Ertrag",value:b>0?b.toFixed(0):"---",unit:"kWh/kWp",subtitle:"Durchschnitt Gesamtlaufzeit",icon:ke,color:"blue",formel:"Spez. Ertrag = Erzeugung √∑ Leistung",berechnung:`${z(N,0)} kWh √∑ ${z(k,1)} kWp`,ergebnis:`= ${z(b,0)} kWh/kWp`}),e.jsx(be,{title:"Eigenverbrauch",value:W>0?W.toFixed(1):"---",unit:"%",subtitle:S>0?`${(S/1e3).toFixed(1)} MWh`:void 0,icon:Ks,color:"purple",formel:"Eigenverbrauchsquote = Eigenverbrauch √∑ Erzeugung √ó 100",berechnung:`${z(S,0)} kWh √∑ ${z(N,0)} kWh √ó 100`,ergebnis:`= ${z(W,1)} %`})]}),Q&&e.jsxs(M,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsxs("div",{className:"space-y-4",children:[v.map(F=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:F.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[F.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[F.pvModule.map(I=>{var q;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(re,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:I.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(q=I.leistung_kwp)==null?void 0:q.toFixed(1)," kWp",I.ausrichtung&&` ‚Ä¢ ${I.ausrichtung}`,I.neigung_grad&&` ‚Ä¢ ${I.neigung_grad}¬∞`]})]},I.id)}),F.speicher.map(I=>{var q,ne;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(xe,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:I.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(ne=(q=I.parameter)==null?void 0:q.kapazitaet_kwh)==null?void 0:ne.toFixed(1)," kWh"]})]},I.id)}),F.pvModule.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PV-Module zugeordnet"})]})]})]},F.wechselrichter.id)),w.length>0&&e.jsxs("div",{className:"border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-amber-800 dark:text-amber-200 mb-2 flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Nicht zugeordnete PV-Module"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:w.map(F=>{var I;return e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-300",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:F.bezeichnung}),e.jsxs("span",{className:"text-amber-500",children:[(I=F.leistung_kwp)==null?void 0:I.toFixed(1)," kWp",F.ausrichtung&&` ‚Ä¢ ${F.ausrichtung}`]})]},F.id)})})]})]})]}),K.length>1&&e.jsxs(M,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Leistung nach Ausrichtung"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:K,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{type:"number",unit:" kWp"}),e.jsx(le,{type:"category",dataKey:"ausrichtung",width:100}),e.jsx(ae,{formatter:F=>[`${F.toFixed(1)} kWp`,"Leistung"]}),e.jsx(U,{dataKey:"kwp",fill:Ze.solar,radius:[0,4,4,0],children:K.map((F,I)=>e.jsx(We,{fill:F.color},`cell-${I}`))})]})})})]}),X&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(M,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:_?"Jahres√ºbersicht (Gesamtlaufzeit)":`Jahres√ºbersicht ${p}`}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:C,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",className:"text-xs"}),e.jsx(le,{unit:" kWh",className:"text-xs"}),e.jsx(ae,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:F=>[`${F.toLocaleString()} kWh`,""]}),e.jsx(je,{}),e.jsx(U,{dataKey:"Erzeugung",fill:Ze.solar}),e.jsx(U,{dataKey:"Eigenverbrauch",fill:Ze.consumption}),e.jsx(U,{dataKey:"Einspeisung",fill:Ze.feedin})]})})})]}),e.jsxs(M,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(ot,{data:$,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:F,percent:I})=>`${F}: ${(I*100).toFixed(0)}%`,labelLine:!1,children:$.map((F,I)=>e.jsx(We,{fill:F.color},`cell-${I}`))}),e.jsx(ae,{formatter:F=>[`${F.toLocaleString()} kWh`,""]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(S/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(y/1e3).toFixed(1)," MWh"]})]})]})]})]}),!X&&Q&&e.jsxs(M,{className:"text-center py-12",children:[e.jsx(Br,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]}),Q&&X&&s&&e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Dr,{className:"h-5 w-5 text-blue-500"}),"SOLL-IST Vergleich pro String"]}),h.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-gray-400"}),e.jsx("select",{value:m||"",onChange:F=>g(parseInt(F.target.value)),className:"input py-1.5 text-sm",children:h.map(F=>e.jsx("option",{value:F,children:F},F))})]})]}),f.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:["Monatlicher Verlauf ",m]}),e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:f,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",className:"text-xs"}),e.jsx(le,{unit:" kWh",className:"text-xs"}),e.jsx(ae,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:F=>[`${F.toLocaleString()} kWh`,""]}),e.jsx(je,{}),e.jsx(Te,{type:"monotone",dataKey:"Erzeugung",stroke:Ze.solar,fill:Ze.solar,fillOpacity:.3}),e.jsx(Te,{type:"monotone",dataKey:"Eigenverbrauch",stroke:Ze.consumption,fill:Ze.consumption,fillOpacity:.3}),e.jsx(Te,{type:"monotone",dataKey:"Einspeisung",stroke:Ze.feedin,fill:Ze.feedin,fillOpacity:.3})]})})})]}),e.jsx(mn,{anlageId:s,jahr:m||p})]})]})}const ys=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function bn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState([]),[x,o]=d.useState(!1),[c,u]=d.useState(null);return d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{if(!s)return;(async()=>{o(!0),u(null);try{const j=await Fe.getEAutoDashboard(s);i(j)}catch(j){u(j instanceof Error?j.message:"Fehler beim Laden")}finally{o(!1)}})()},[s]),r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:l=>n(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),c&&e.jsx(Y,{type:"error",children:c}),x?e.jsx(pe,{text:"Lade E-Auto Daten..."}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto f√ºr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'F√ºge ein E-Auto unter "Investitionen" hinzu.'})]})}):a.map(l=>e.jsx(jn,{dashboard:l},l.investition.id))]})}function jn({dashboard:t}){var c;const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(u=>({name:`${ys[u.monat]} ${u.jahr.toString().slice(2)}`,km:u.verbrauch_daten.km_gefahren||0,verbrauch:u.verbrauch_daten.verbrauch_kwh||0,pv:u.verbrauch_daten.ladung_pv_kwh||0,netz:u.verbrauch_daten.ladung_netz_kwh||0,extern:u.verbrauch_daten.ladung_extern_kwh||0,v2h:u.verbrauch_daten.v2h_entladung_kwh||0})),x=[{name:"Heim: PV",value:a.ladung_pv_kwh||0},{name:"Heim: Netz",value:a.ladung_netz_kwh||0},{name:"Extern",value:a.ladung_extern_kwh||0}].filter(u=>u.value>0),o=[{name:"E-Auto (Strom)",value:a.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:a.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(ve,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Gefahren",value:((c=a.gesamt_km)==null?void 0:c.toLocaleString("de-DE"))||"0",unit:"km",icon:ve,color:"blue",formel:"Œ£ km gefahren",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(be,{title:"Verbrauch",value:(a.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:xe,color:"yellow",formel:"Verbrauch = kWh √∑ km √ó 100",berechnung:`${(a.gesamt_verbrauch_kwh||0).toFixed(0)} kWh √∑ ${a.gesamt_km||0} km √ó 100`,ergebnis:`= ${(a.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(be,{title:"PV-Anteil (Heim)",value:(a.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(a.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:Ke,color:"green",formel:"PV-Anteil = PV-Ladung √∑ Heimladung √ó 100",berechnung:`${(a.ladung_pv_kwh||0).toFixed(0)} kWh √∑ ${(a.ladung_heim_kwh||0).toFixed(0)} kWh √ó 100`,ergebnis:`= ${(a.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(be,{title:"Ersparnis vs. Benzin",value:(a.gesamt_ersparnis_euro||0).toFixed(0),unit:"‚Ç¨",subtitle:`+ Wallbox: ${(a.wallbox_ersparnis_euro||0).toFixed(0)} ‚Ç¨`,icon:ke,color:"green",trend:(a.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten ‚àí Stromkosten",berechnung:`${(a.benzin_kosten_alternativ_euro||0).toFixed(0)} ‚Ç¨ ‚àí ${(a.strom_kosten_gesamt_euro||0).toFixed(0)} ‚Ç¨`,ergebnis:`= ${(a.ersparnis_vs_benzin_euro||0).toFixed(2)} ‚Ç¨`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsxs(ot,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:u,percent:l})=>`${u}: ${(l*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"})," ",e.jsx(We,{fill:"#f97316"})," ",e.jsx(We,{fill:"#ef4444"})," "]}),e.jsx(ae,{formatter:u=>`${u.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(a.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(a.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(a.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(a.ladung_extern_kwh||0).toFixed(0)," kWh (",(a.ladung_extern_euro||0).toFixed(2)," ‚Ç¨)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:o,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{type:"number",tickFormatter:u=>`${u}‚Ç¨`}),e.jsx(le,{type:"category",dataKey:"name",width:120}),e.jsx(ae,{formatter:u=>`${u.toFixed(2)} ‚Ç¨`}),e.jsx(U,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(a.ersparnis_vs_benzin_euro||0).toFixed(2)," ‚Ç¨"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(U,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(U,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(U,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(U,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(a.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(a.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(a.v2h_ersparnis_euro||0).toFixed(2)," ‚Ç¨"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO‚ÇÇ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(a.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:s.map(u=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[ys[u.monat]," ",u.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:u.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(u.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(u.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(u.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(u.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},u.id))})]})})]})]})}const fs=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function kn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState([]),[x,o]=d.useState(!1),[c,u]=d.useState(null);return d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{if(!s)return;(async()=>{o(!0),u(null);try{const j=await Fe.getWaermepumpeDashboard(s);i(j)}catch(j){u(j instanceof Error?j.message:"Fehler beim Laden")}finally{o(!1)}})()},[s]),r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"W√§rmepumpe Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"W√§rmepumpe Dashboard"})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:l=>n(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),c&&e.jsx(Y,{type:"error",children:c}),x?e.jsx(pe,{text:"Lade W√§rmepumpe Daten..."}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine W√§rmepumpe f√ºr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'F√ºge eine W√§rmepumpe unter "Investitionen" hinzu.'})]})}):a.map(l=>e.jsx(yn,{dashboard:l},l.investition.id))]})}function yn({dashboard:t}){const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(c=>({name:`${fs[c.monat]} ${c.jahr.toString().slice(2)}`,strom:c.verbrauch_daten.stromverbrauch_kwh||0,heizung:c.verbrauch_daten.heizenergie_kwh||0,warmwasser:c.verbrauch_daten.warmwasser_kwh||0,cop:((c.verbrauch_daten.heizenergie_kwh||0)+(c.verbrauch_daten.warmwasser_kwh||0))/(c.verbrauch_daten.stromverbrauch_kwh||1)})),x=[{name:"Heizung",value:a.gesamt_heizenergie_kwh},{name:"Warmwasser",value:a.gesamt_warmwasser_kwh}],o=[{name:"W√§rmepumpe",value:a.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/√ñl",value:a.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ee,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"√ò COP",value:a.durchschnitt_cop.toFixed(2),icon:Wt,color:"orange",formel:"COP = W√§rme √∑ Strom",berechnung:`${a.gesamt_waerme_kwh.toFixed(0)} kWh √∑ ${a.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${a.durchschnitt_cop.toFixed(2)}`}),e.jsx(be,{title:"W√§rme erzeugt",value:(a.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:Ee,color:"red",formel:"W√§rme = Heizung + Warmwasser",berechnung:`${a.gesamt_heizenergie_kwh.toFixed(0)} + ${a.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${a.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(be,{title:"Strom verbraucht",value:(a.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:xe,color:"yellow",formel:"Œ£ Stromverbrauch WP",berechnung:`${a.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(a.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(be,{title:"Ersparnis",value:a.ersparnis_euro.toFixed(0),unit:"‚Ç¨",icon:ke,color:"green",trend:a.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/√ñl-Kosten ‚àí WP-Kosten",berechnung:`${a.alte_heizung_kosten_euro.toFixed(0)} ‚Ç¨ ‚àí ${a.wp_kosten_euro.toFixed(0)} ‚Ç¨`,ergebnis:`= ${a.ersparnis_euro.toFixed(2)} ‚Ç¨`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"W√§rme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsxs(ot,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:c,percent:u})=>`${c}: ${(u*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#ef4444"}),e.jsx(We,{fill:"#3b82f6"})]}),e.jsx(ae,{formatter:c=>`${c.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",a.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",a.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/√ñl"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:o,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{type:"number",tickFormatter:c=>`${c}‚Ç¨`}),e.jsx(le,{type:"category",dataKey:"name",width:100}),e.jsx(ae,{formatter:c=>`${c.toFixed(2)} ‚Ç¨`}),e.jsx(U,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",a.ersparnis_euro.toFixed(2)," ‚Ç¨"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"W√§rmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(Te,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(Te,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{domain:[0,6]}),e.jsx(ae,{formatter:c=>c.toFixed(2)}),e.jsx(U,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ke,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO‚ÇÇ Ersparnis gegen√ºber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:s.map(c=>{const u=c.verbrauch_daten.stromverbrauch_kwh||0,l=c.verbrauch_daten.heizenergie_kwh||0,j=c.verbrauch_daten.warmwasser_kwh||0,h=u>0?(l+j)/u:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[fs[c.monat]," ",c.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:u.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:l.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:j.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:h.toFixed(2)})]},c.id)})})]})})]})]})}const fn=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function wn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState([]),[x,o]=d.useState(!1),[c,u]=d.useState(null);return d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{if(!s)return;(async()=>{o(!0),u(null);try{const j=await Fe.getSpeicherDashboard(s);i(j)}catch(j){u(j instanceof Error?j.message:"Fehler beim Laden")}finally{o(!1)}})()},[s]),r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:l=>n(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),c&&e.jsx(Y,{type:"error",children:c}),x?e.jsx(pe,{text:"Lade Speicher Daten..."}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher f√ºr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'F√ºge einen Speicher unter "Investitionen" hinzu.'})]})}):a.map(l=>e.jsx(vn,{dashboard:l},l.investition.id))]})}function vn({dashboard:t}){var x;const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(o=>{const c=o.verbrauch_daten.ladung_kwh||0,u=o.verbrauch_daten.entladung_kwh||0,l=o.verbrauch_daten.speicher_ladung_netz_kwh||0;return{name:`${fn[o.monat]} ${o.jahr.toString().slice(2)}`,ladung:c,entladung:u,arbitrage:l,pvLadung:c-l,zyklen:a.kapazitaet_kwh>0?c/a.kapazitaet_kwh:0,effizienz:c>0?u/c*100:0}});return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.kapazitaet_kwh," kWh Kapazit√§t ‚Ä¢ ",a.anzahl_monate," Monate Daten"]})]}),e.jsx(fe,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Vollzyklen",value:a.vollzyklen.toFixed(0),icon:Da,color:"blue",formel:"Vollzyklen = Ladung √∑ Kapazit√§t",berechnung:`${a.gesamt_ladung_kwh.toFixed(0)} kWh √∑ ${a.kapazitaet_kwh} kWh`,ergebnis:`= ${a.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(be,{title:"Effizienz",value:a.effizienz_prozent.toFixed(1),unit:"%",icon:Ks,color:"green",formel:"Effizienz = Entladung √∑ Ladung √ó 100",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh √∑ ${a.gesamt_ladung_kwh.toFixed(0)} kWh √ó 100`,ergebnis:`= ${a.effizienz_prozent.toFixed(1)} %`}),e.jsx(be,{title:"Durchsatz",value:(a.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:xe,color:"yellow",formel:"Durchsatz = Œ£ Entladung",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(a.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(be,{title:"Ersparnis",value:a.ersparnis_euro.toFixed(0),unit:"‚Ç¨",icon:ke,color:"green",trend:a.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung √ó Strompreis",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh √ó Strompreis`,ergebnis:`= ${a.ersparnis_euro.toFixed(2)} ‚Ç¨`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[a.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:a.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(a.gesamt_ladung_kwh-a.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),a.arbitrage_faehig&&a.arbitrage_kwh>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($a,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h3",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Arbitrage (Netzladung)"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Netzladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[a.arbitrage_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"√ò Ladepreis"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[((x=a.arbitrage_avg_preis_cent)==null?void 0:x.toFixed(1))||"-"," ct/kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Anteil an Ladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(a.arbitrage_kwh/a.gesamt_ladung_kwh*100).toFixed(0)," %"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Arbitrage-Gewinn"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:["+",a.arbitrage_gewinn_euro.toFixed(0)," ‚Ç¨"]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),a.arbitrage_faehig&&a.arbitrage_kwh>0?e.jsxs(e.Fragment,{children:[e.jsx(U,{dataKey:"pvLadung",stackId:"ladung",fill:"#3b82f6",name:"PV-Ladung"}),e.jsx(U,{dataKey:"arbitrage",stackId:"ladung",fill:"#f59e0b",name:"Netz-Ladung"})]}):e.jsx(U,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(U,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{formatter:o=>o.toFixed(1)}),e.jsx(Te,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(rr,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{domain:[80,100]}),e.jsx(ae,{formatter:o=>`${o.toFixed(1)}%`}),e.jsx(Ae,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((o,c)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:o.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:o.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:o.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:o.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[o.effizienz.toFixed(1),"%"]})]},c))})]})})]})]})}function Nn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState([]),[x,o]=d.useState(!1),[c,u]=d.useState(null);return d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{if(!s)return;(async()=>{o(!0),u(null);try{const j=await Fe.getWallboxDashboard(s);i(j)}catch(j){u(j instanceof Error?j.message:"Fehler beim Laden")}finally{o(!1)}})()},[s]),r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xt,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:l=>n(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),c&&e.jsx(Y,{type:"error",children:c}),x?e.jsx(pe,{text:"Lade Wallbox Daten..."}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(xt,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox f√ºr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'F√ºge eine Wallbox unter "Einstellungen ‚Üí Investitionen" hinzu.'})]})}):a.map(l=>e.jsx(_n,{dashboard:l},l.investition.id))]})}function _n({dashboard:t}){const{investition:r,zusammenfassung:s}=t,n=s,a=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.extern_ladung_kwh||0}].filter(c=>c.value>0),i=[{name:"Heimladung (tats√§chlich)",value:n.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:n.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],x=n.leistung_kw||11,o=(n.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[x," kW Ladeleistung ‚Ä¢ ",n.anzahl_monate||0," Monate Daten"]})]}),e.jsx(xt,{className:"h-10 w-10 text-purple-500"})]}),o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Heimladung",value:((n.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:lt,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} + ${(n.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(be,{title:"PV-Anteil",value:(n.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:Ke,color:"green",formel:"PV-Anteil = PV √∑ Heimladung √ó 100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh √∑ ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh √ó 100`,ergebnis:`= ${(n.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(be,{title:"Ersparnis vs. Extern",value:(n.ersparnis_vs_extern_euro||0).toFixed(0),unit:"‚Ç¨",subtitle:"Wallbox-ROI",icon:ke,color:"green",trend:(n.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten ‚àí Heim-Kosten",berechnung:`${(n.heim_als_extern_kosten_euro||0).toFixed(0)} ‚Ç¨ ‚àí ${(n.heim_kosten_euro||0).toFixed(0)} ‚Ç¨`,ergebnis:`= ${(n.ersparnis_vs_extern_euro||0).toFixed(2)} ‚Ç¨`}),e.jsx(be,{title:"Ladevorg√§nge",value:(n.gesamt_ladevorgaenge||0).toString(),subtitle:`√ò ${(n.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:xe,color:"blue",formel:"Œ£ Ladevorg√§nge",berechnung:`${n.anzahl_monate||0} Monate`,ergebnis:`= ${n.gesamt_ladevorgaenge||0} Vorg√§nge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsxs(ot,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:c,percent:u})=>`${c}: ${(u*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"})," ",e.jsx(We,{fill:"#f97316"})," ",e.jsx(We,{fill:"#ef4444"})," "]}),e.jsx(ae,{formatter:c=>`${c.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(n.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(yr,{className:"h-4 w-4 text-red-500"}),"Extern: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{type:"number",tickFormatter:c=>`${c}‚Ç¨`}),e.jsx(le,{type:"category",dataKey:"name",width:150}),e.jsx(ae,{formatter:c=>`${c.toFixed(2)} ‚Ç¨`}),e.jsx(je,{}),e.jsx(U,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(n.ersparnis_vs_extern_euro||0).toFixed(2)," ‚Ç¨"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erkl√§rt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(n.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(n.ladung_netz_kwh||0).toFixed(0)," kWh = ",(n.heim_kosten_euro||0).toFixed(2)," ‚Ç¨)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(n.extern_preis_kwh_euro||.5).toFixed(2)," ‚Ç¨/kWh"]})]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tats√§chliche externe Ladung: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh f√ºr ",(n.extern_kosten_euro||0).toFixed(2)," ‚Ç¨"]})]}),r.anschaffungskosten_gesamt&&r.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.anschaffungskosten_gesamt.toLocaleString("de-DE")," ‚Ç¨"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.anzahl_monate&&n.anzahl_monate>0?((n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12).toFixed(0):0," ‚Ç¨"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const c=n.anzahl_monate&&n.anzahl_monate>0?(n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12:0;return c<=0?"‚àû":`${(r.anschaffungskosten_gesamt/c).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen ‚Üí Monatsdaten".'})})]})}const zn=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Sn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState([]),[x,o]=d.useState(!1),[c,u]=d.useState(null);return d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{if(!s)return;(async()=>{o(!0),u(null);try{const j=await Fe.getBalkonkraftwerkDashboard(s);i(j)}catch(j){u(j instanceof Error?j.message:"Fehler beim Laden")}finally{o(!1)}})()},[s]),r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:l=>n(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),c&&e.jsx(Y,{type:"error",children:c}),x?e.jsx(pe,{text:"Lade Balkonkraftwerk Daten..."}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk f√ºr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'F√ºge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):a.map(l=>e.jsx(En,{dashboard:l},l.investition.id))]})}function En({dashboard:t}){const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(c=>({name:`${zn[c.monat]} ${c.jahr.toString().slice(2)}`,erzeugung:c.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:c.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:c.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:c.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:c.verbrauch_daten.speicher_entladung_kwh||0})),x=[{name:"Eigenverbrauch",value:a.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:a.gesamt_einspeisung_kwh}],o=["#22c55e","#f59e0b"];return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.leistung_wp," Wp ‚Ä¢ ",a.anzahl_module," Module ‚Ä¢ ",a.anzahl_monate," Monate Daten",a.hat_speicher&&` ‚Ä¢ ${a.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(re,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Erzeugung",value:a.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:xe,color:"yellow",formel:"Œ£ Erzeugung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${a.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(be,{title:"Eigenverbrauch",value:a.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:lt,color:"green",formel:"EV-Quote = Eigenverbrauch √∑ Erzeugung √ó 100",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh √∑ ${a.gesamt_erzeugung_kwh.toFixed(0)} kWh √ó 100`,ergebnis:`= ${a.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(be,{title:"Ersparnis",value:a.gesamt_ersparnis_euro.toFixed(0),unit:"‚Ç¨",icon:ke,color:"green",trend:a.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch √ó Strompreis",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh √ó Strompreis`,ergebnis:`= ${a.gesamt_ersparnis_euro.toFixed(2)} ‚Ç¨`}),e.jsx(be,{title:"CO‚ÇÇ gespart",value:a.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:Ke,color:"green",formel:"CO‚ÇÇ = Eigenverbrauch √ó 0.4 kg/kWh",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh √ó 0.4`,ergebnis:`= ${a.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[a.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["Einspeisung",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(unverg√ºtet)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[a.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Entgangener Erl√∂s",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(8 ct/kWh)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-500 dark:text-gray-400",children:[(a.gesamt_einspeisung_kwh*.08).toFixed(2)," ‚Ç¨"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(ot,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:c,percent:u})=>`${c}: ${(u*100).toFixed(0)}%`,children:x.map((c,u)=>e.jsx(We,{fill:o[u%o.length]},`cell-${u}`))}),e.jsx(ae,{formatter:c=>`${c.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",a.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",a.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(Te,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Te,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),a.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(fe,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",a.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(U,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(U,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ke,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO‚ÇÇ Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),a.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:i.map((c,u)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:c.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:c.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:c.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:c.einspeisung.toFixed(1)}),a.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:c.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:c.speicher_entladung.toFixed(1)})]})]},u))})]})})]})]})}const Ur=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Yr={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function Fn(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState([]),[x,o]=d.useState(!1),[c,u]=d.useState(null);return d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{if(!s)return;(async()=>{o(!0),u(null);try{const j=await Fe.getSonstigesDashboard(s);i(j)}catch(j){u(j instanceof Error?j.message:"Fehler beim Laden")}finally{o(!1)}})()},[s]),r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(br,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:l=>n(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),c&&e.jsx(Y,{type:"error",children:c}),x?e.jsx(pe,{text:"Lade Daten..."}):a.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(br,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen f√ºr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'F√ºge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):a.map(l=>e.jsx(Wn,{dashboard:l},l.investition.id))]})}function Wn({dashboard:t}){const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=a.kategorie;return i==="erzeuger"?e.jsx(Mn,{investition:r,monatsdaten:s,zusammenfassung:a}):i==="verbraucher"?e.jsx(Cn,{investition:r,monatsdaten:s,zusammenfassung:a}):e.jsx($n,{investition:r,monatsdaten:s,zusammenfassung:a})}function Mn({investition:t,monatsdaten:r,zusammenfassung:s}){const n=r.map(i=>({name:`${Ur[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0})),a=[{name:"Eigenverbrauch",value:s.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:s.gesamt_einspeisung_kwh||0}];return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:Yr[s.kategorie]})]}),s.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(xe,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Erzeugung",value:(s.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:xe,color:"yellow",formel:"Œ£ Erzeugung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(be,{title:"Eigenverbrauch",value:(s.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:lt,color:"green",formel:"EV-Quote = Eigenverbrauch √∑ Erzeugung √ó 100",berechnung:`${(s.gesamt_eigenverbrauch_kwh||0).toFixed(0)} √∑ ${(s.gesamt_erzeugung_kwh||0).toFixed(0)} √ó 100`,ergebnis:`= ${(s.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(be,{title:"Ersparnis",value:(s.gesamt_ersparnis_euro||0).toFixed(0),unit:"‚Ç¨",icon:ke,color:"green",trend:(s.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch √ó Strompreis",berechnung:`${(s.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh √ó Strompreis`,ergebnis:`= ${(s.gesamt_ersparnis_euro||0).toFixed(2)} ‚Ç¨`}),e.jsx(be,{title:"CO‚ÇÇ gespart",value:(s.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:Ke,color:"green",formel:"CO‚ÇÇ = Eigenverbrauch √ó 0.4 kg/kWh",berechnung:`${(s.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh √ó 0.4`,ergebnis:`= ${(s.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),s.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ie,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[s.sonderkosten_euro.toFixed(2)," ‚Ç¨"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsxs(ot,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:x})=>`${i}: ${(x*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"}),e.jsx(We,{fill:"#f59e0b"})]}),e.jsx(ae,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:n,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(Te,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Te,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:n.map((i,x)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)})]},x))})]})})]})]})}function Cn({investition:t,monatsdaten:r,zusammenfassung:s}){const n=r.map(i=>({name:`${Ur[i.monat]} ${i.jahr.toString().slice(2)}`,verbrauch:i.verbrauch_daten.verbrauch_kwh||0,bezug_pv:i.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:i.verbrauch_daten.bezug_netz_kwh||0})),a=[{name:"PV-Strom",value:s.bezug_pv_kwh||0},{name:"Netzstrom",value:s.bezug_netz_kwh||0}];return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:Yr[s.kategorie]})]}),s.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(xe,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Verbrauch",value:(s.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:xe,color:"blue",formel:"Œ£ Verbrauch alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(be,{title:"PV-Anteil",value:(s.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:lt,color:"green",formel:"PV-Anteil = PV-Bezug √∑ Verbrauch √ó 100",berechnung:`${(s.bezug_pv_kwh||0).toFixed(0)} √∑ ${(s.gesamt_verbrauch_kwh||0).toFixed(0)} √ó 100`,ergebnis:`= ${(s.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(be,{title:"Netzkosten",value:(s.kosten_netz_euro||0).toFixed(0),unit:"‚Ç¨",icon:ke,color:"red",formel:"Netzkosten = Netzbezug √ó Strompreis",berechnung:`${(s.bezug_netz_kwh||0).toFixed(0)} kWh √ó Strompreis`,ergebnis:`= ${(s.kosten_netz_euro||0).toFixed(2)} ‚Ç¨`}),e.jsx(be,{title:"PV-Ersparnis",value:(s.ersparnis_pv_euro||0).toFixed(0),unit:"‚Ç¨",icon:Ke,color:"green",trend:(s.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug √ó Strompreis",berechnung:`${(s.bezug_pv_kwh||0).toFixed(0)} kWh √ó Strompreis`,ergebnis:`= ${(s.ersparnis_pv_euro||0).toFixed(2)} ‚Ç¨`})]}),s.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ie,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[s.sonderkosten_euro.toFixed(2)," ‚Ç¨"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsxs(ot,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:x})=>`${i}: ${(x*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"}),e.jsx(We,{fill:"#ef4444"})]}),e.jsx(ae,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:n,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(U,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(U,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:n.map((i,x)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:i.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:i.bezug_netz.toFixed(1)})]},x))})]})})]})]})}function $n({investition:t,monatsdaten:r,zusammenfassung:s}){const n=r.map(a=>({name:`${Ur[a.monat]} ${a.jahr.toString().slice(2)}`,ladung:a.verbrauch_daten.ladung_kwh||0,entladung:a.verbrauch_daten.entladung_kwh||0}));return e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:Yr[s.kategorie]})]}),s.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(fe,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Ladung",value:(s.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:fe,color:"purple",formel:"Œ£ Ladung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(be,{title:"Entladung",value:(s.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:xe,color:"green",formel:"Œ£ Entladung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(be,{title:"Effizienz",value:(s.effizienz_prozent||0).toFixed(1),unit:"%",icon:ke,color:"blue",formel:"Effizienz = Entladung √∑ Ladung √ó 100",berechnung:`${(s.gesamt_entladung_kwh||0).toFixed(0)} √∑ ${(s.gesamt_ladung_kwh||0).toFixed(0)} √ó 100`,ergebnis:`= ${(s.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(be,{title:"Ersparnis",value:(s.ersparnis_euro||0).toFixed(0),unit:"‚Ç¨",icon:ke,color:"green",trend:(s.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung √ó Strompreis",berechnung:`${(s.gesamt_entladung_kwh||0).toFixed(0)} kWh √ó Strompreis`,ergebnis:`= ${(s.ersparnis_euro||0).toFixed(2)} ‚Ç¨`})]}),s.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ie,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[s.sonderkosten_euro.toFixed(2)," ‚Ç¨"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:n,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(ae,{}),e.jsx(je,{}),e.jsx(U,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(U,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:n.map((a,i)=>{const x=a.ladung>0?a.entladung/a.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:a.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:a.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:a.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[x.toFixed(1),"%"]})]},i)})})]})})]})]})}function An(t,r){const s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}function sr(t,r,s){const n=t.join(";"),a=r.map(o=>o.map(c=>c==null||c===""?"":typeof c=="number"?c.toString().replace(".",","):typeof c=="string"&&(c.includes(";")||c.includes('"'))?`"${c.replace(/"/g,'""')}"`:String(c)).join(";")),i=[n,...a].join(`
`),x=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8"});An(x,s)}function de({title:t,value:r,unit:s,subtitle:n,icon:a,color:i,bgColor:x,formel:o,berechnung:c,ergebnis:u}){const l=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal",children:s})]});return e.jsx(M,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:o?e.jsx(bt,{formel:o,berechnung:c,ergebnis:u,children:l}):l}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${x}`,children:e.jsx(a,{className:`h-6 w-6 ${i}`})})]})})}const na=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Ye={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},He={erzeugung:"#f59e0b",eigenverbrauch:"#8b5cf6",einspeisung:"#10b981",netzbezug:"#ef4444",autarkie:"#3b82f6",evQuote:"#a855f7",spezErtrag:"#eab308",speicherLadung:"#22c55e",speicherEntladung:"#3b82f6",speicherEffizienz:"#06b6d4",wpWaerme:"#ef4444",wpStrom:"#8b5cf6",wpCop:"#f97316",emobPvAnteil:"#10b981"},vt={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},Jt={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"W√§rmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function Qr(t,r,s){return[...t].sort((a,i)=>a.jahr!==i.jahr?a.jahr-i.jahr:a.monat-i.monat).map(a=>{const i=a.pv_erzeugung_kwh||a.einspeisung_kwh+(a.eigenverbrauch_kwh||0),x=a.eigenverbrauch_kwh||0,o=a.gesamtverbrauch_kwh||x+a.netzbezug_kwh,c=a.direktverbrauch_kwh||0,u=o>0?x/o*100:0,l=i>0?x/i*100:0,j=r!=null&&r.leistung_kwp?i/r.leistung_kwp:0,h=a.batterie_ladung_kwh||0,p=a.batterie_entladung_kwh||0,m=h>0?p/h*100:null,g=0,v=0,w=null,k=0,N=0,S=null,y=s?a.einspeisung_kwh*s.einspeiseverguetung_cent_kwh/100:0,b=s?x*s.netzbezug_arbeitspreis_cent_kwh/100:0,W=s?a.netzbezug_kwh*s.netzbezug_arbeitspreis_cent_kwh/100:0,H=y+b,Z=i*.38;return{name:`${na[a.monat]} ${a.jahr.toString().slice(-2)}`,jahr:a.jahr,monat:a.monat,erzeugung:i,eigenverbrauch:x,einspeisung:a.einspeisung_kwh,netzbezug:a.netzbezug_kwh,gesamtverbrauch:o,direktverbrauch:c,autarkie:u,evQuote:l,spezErtrag:j,speicher_ladung:h,speicher_entladung:p,speicher_effizienz:m,wp_waerme:g,wp_strom:v,wp_cop:w,eauto_km:k,eauto_ladung:N,eauto_pv_anteil:S,einspeise_erloes:y,ev_ersparnis:b,netzbezug_kosten:W,netto_ertrag:H,co2_einsparung:Z}})}function In({data:t,stats:r,anlage:s,strompreis:n,zeitraumLabel:a}){const i=d.useMemo(()=>Qr(t,s,n),[t,s,n]),x=()=>{const c=["Monat","Erzeugung (kWh)","Eigenverbrauch (kWh)","Einspeisung (kWh)","Netzbezug (kWh)","Autarkie (%)","EV-Quote (%)","Spez. Ertrag (kWh/kWp)"],u=i.map(l=>[l.name,l.erzeugung,l.eigenverbrauch,l.einspeisung,l.netzbezug,l.autarkie,l.evQuote,l.spezErtrag]);sr(c,u,`energie_${(s==null?void 0:s.anlagenname)||"export"}.csv`)},o=d.useMemo(()=>{if(!n)return null;const c=r.gesamtEinspeisung*n.einspeiseverguetung_cent_kwh/100,u=r.gesamtEigenverbrauch*n.netzbezug_arbeitspreis_cent_kwh/100;return c+u},[r,n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","‚Ä¢"," ",r.anzahlMonate," Monate"]}),e.jsxs(ee,{variant:"secondary",size:"sm",onClick:x,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"PV-Erzeugung",value:(r.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:re,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Œ£ PV-Erzeugung aller Monate",berechnung:`${z(r.gesamtErzeugung,0)} kWh`,ergebnis:`= ${z(r.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(de,{title:"Eigenverbrauch",value:r.gesamtErzeugung>0?(r.gesamtEigenverbrauch/r.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(r.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:xe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch √∑ PV-Erzeugung √ó 100",berechnung:`${z(r.gesamtEigenverbrauch,0)} kWh √∑ ${z(r.gesamtErzeugung,0)} kWh √ó 100`,ergebnis:`= ${z(r.gesamtEigenverbrauch/r.gesamtErzeugung*100,1)} %`}),e.jsx(de,{title:"Autarkie",value:r.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:ke,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch √∑ Gesamtverbrauch √ó 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${z(r.durchschnittAutarkie,1)} %`}),e.jsx(de,{title:"Spez. Ertrag",value:s!=null&&s.leistung_kwp?(r.gesamtErzeugung/s.leistung_kwp).toFixed(0):"---",unit:"kWh/kWp",subtitle:s!=null&&s.leistung_kwp?`${s.leistung_kwp} kWp`:void 0,icon:re,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"PV-Erzeugung √∑ Anlagenleistung",berechnung:s!=null&&s.leistung_kwp?`${z(r.gesamtErzeugung,0)} kWh √∑ ${s.leistung_kwp} kWp`:void 0,ergebnis:s!=null&&s.leistung_kwp?`= ${z(r.gesamtErzeugung/s.leistung_kwp,0)} kWh/kWp`:void 0})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-blue-500"}),"Energie-Bilanz pro Monat"]}),e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{tickFormatter:c=>`${c.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ae,{formatter:(c,u)=>[`${c.toFixed(0)} kWh`,u],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),e.jsx(U,{dataKey:"eigenverbrauch",name:"Eigenverbrauch",fill:He.eigenverbrauch,stackId:"pv"}),e.jsx(U,{dataKey:"einspeisung",name:"Einspeisung",fill:He.einspeisung,stackId:"pv"}),e.jsx(U,{dataKey:"netzbezug",name:"Netzbezug",fill:He.netzbezug})]})})})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-green-500"}),"Effizienz-Trends"]}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{yAxisId:"left",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(le,{yAxisId:"right",orientation:"right",tickFormatter:c=>`${c.toFixed(0)}`,unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(ae,{formatter:(c,u)=>u.includes("kWh/kWp")?[`${c.toFixed(0)} kWh/kWp`,u]:[`${c.toFixed(1)}%`,u],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),e.jsx(Ae,{yAxisId:"left",type:"monotone",dataKey:"autarkie",name:"Autarkie (%)",stroke:He.autarkie,strokeWidth:2,dot:!1}),e.jsx(Ae,{yAxisId:"left",type:"monotone",dataKey:"evQuote",name:"EV-Quote (%)",stroke:He.evQuote,strokeWidth:2,dot:!1}),e.jsx(U,{yAxisId:"right",dataKey:"spezErtrag",name:"Spez. Ertrag (kWh/kWp)",fill:He.spezErtrag,opacity:.7})]})})})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-yellow-500"}),"PV-Erzeugung Verlauf"]}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(rr,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ae,{formatter:c=>[`${c.toFixed(0)} kWh`,"Erzeugung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ae,{type:"monotone",dataKey:"erzeugung",name:"PV-Erzeugung",stroke:He.erzeugung,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[r.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(s==null?void 0:s.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Netto-Ertrag"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:o?`${o.toFixed(0)} ‚Ç¨`:"---"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(r.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function Pn({anlage:t,strompreis:r,selectedYear:s,zeitraumLabel:n}){var k,N,S;const[a,i]=d.useState(null),[x,o]=d.useState(!0),[c,u]=d.useState(null);d.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{o(!0),u(null);try{const b=s&&s!=="all"?s:void 0,W=await Ct.getKomponentenZeitreihe(t.id,b);i(W)}catch(b){u("Fehler beim Laden der Komponentendaten"),console.error(b)}finally{o(!1)}})()},[t==null?void 0:t.id,s]);const l=d.useMemo(()=>a!=null&&a.monatswerte?a.monatswerte.map(y=>({...y,name:`${na[y.monat]} ${y.jahr.toString().slice(-2)}`})):[],[a]),j=d.useMemo(()=>{if(!l.length)return{ladung:0,entladung:0,effizienz:null,arbitrage:0};const y=l.reduce((H,P)=>H+P.speicher_ladung_kwh,0),b=l.reduce((H,P)=>H+P.speicher_entladung_kwh,0),W=l.reduce((H,P)=>H+P.speicher_arbitrage_kwh,0);return{ladung:y,entladung:b,effizienz:y>0?b/y*100:null,arbitrage:W}},[l]),h=d.useMemo(()=>{if(!l.length)return{waerme:0,strom:0,cop:null,heizung:0,warmwasser:0};const y=l.reduce((P,Z)=>P+Z.wp_waerme_kwh,0),b=l.reduce((P,Z)=>P+Z.wp_strom_kwh,0),W=l.reduce((P,Z)=>P+Z.wp_heizung_kwh,0),H=l.reduce((P,Z)=>P+Z.wp_warmwasser_kwh,0);return{waerme:y,strom:b,cop:b>0?y/b:null,heizung:W,warmwasser:H}},[l]),p=d.useMemo(()=>{if(!l.length)return{km:0,ladung:0,pvAnteil:null,pvLadung:0,netzLadung:0,externLadung:0,externEuro:0,v2h:0};const y=l.reduce(($,K)=>$+K.emob_km,0),b=l.reduce(($,K)=>$+K.emob_ladung_kwh,0),W=l.reduce(($,K)=>$+K.emob_ladung_pv_kwh,0),H=l.reduce(($,K)=>$+K.emob_ladung_netz_kwh,0),P=l.reduce(($,K)=>$+K.emob_ladung_extern_kwh,0),Z=l.reduce(($,K)=>$+K.emob_ladung_extern_euro,0),C=l.reduce(($,K)=>$+K.emob_v2h_kwh,0),f=b>0?W/b*100:null;return{km:y,ladung:b,pvAnteil:f,pvLadung:W,netzLadung:H,externLadung:P,externEuro:Z,v2h:C}},[l]),m=d.useMemo(()=>l.length?{erzeugung:l.reduce((y,b)=>y+b.bkw_erzeugung_kwh,0),eigenverbrauch:l.reduce((y,b)=>y+b.bkw_eigenverbrauch_kwh,0),speicherLadung:l.reduce((y,b)=>y+b.bkw_speicher_ladung_kwh,0),speicherEntladung:l.reduce((y,b)=>y+b.bkw_speicher_entladung_kwh,0)}:{erzeugung:0,eigenverbrauch:0,speicherLadung:0,speicherEntladung:0},[l]),g=d.useMemo(()=>l.length?{erzeugung:l.reduce((y,b)=>y+b.sonstiges_erzeugung_kwh,0),verbrauch:l.reduce((y,b)=>y+b.sonstiges_verbrauch_kwh,0)}:{erzeugung:0,verbrauch:0},[l]);d.useMemo(()=>l.length?l.reduce((y,b)=>y+b.sonderkosten_euro,0):0,[l]);const v=()=>{if(!l.length)return;const y=["Monat"];a!=null&&a.hat_speicher&&y.push("Speicher Ladung (kWh)","Speicher Entladung (kWh)","Speicher Effizienz (%)"),a!=null&&a.hat_waermepumpe&&y.push("WP W√§rme (kWh)","WP Strom (kWh)","WP COP"),a!=null&&a.hat_emobilitaet&&y.push("E-Auto km","E-Auto Ladung (kWh)","E-Auto PV-Anteil (%)"),a!=null&&a.hat_balkonkraftwerk&&y.push("BKW Erzeugung (kWh)","BKW Eigenverbrauch (kWh)"),a!=null&&a.hat_sonstiges&&y.push("Sonstiges Erzeugung (kWh)","Sonstiges Verbrauch (kWh)");const b=l.map(W=>{const H=[W.name];return a!=null&&a.hat_speicher&&H.push(W.speicher_ladung_kwh,W.speicher_entladung_kwh,W.speicher_effizienz_prozent??""),a!=null&&a.hat_waermepumpe&&H.push(W.wp_waerme_kwh,W.wp_strom_kwh,W.wp_cop??""),a!=null&&a.hat_emobilitaet&&H.push(W.emob_km,W.emob_ladung_kwh,W.emob_pv_anteil_prozent??""),a!=null&&a.hat_balkonkraftwerk&&H.push(W.bkw_erzeugung_kwh,W.bkw_eigenverbrauch_kwh),a!=null&&a.hat_sonstiges&&H.push(W.sonstiges_erzeugung_kwh,W.sonstiges_verbrauch_kwh),H});sr(y,b,`komponenten_${(t==null?void 0:t.anlagenname)||"export"}.csv`)};return x?e.jsxs(M,{className:"text-center py-12",children:[e.jsx(jt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Komponentendaten..."})]}):c?e.jsxs(M,{className:"text-center py-12",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:c})]}):a&&(a.hat_speicher||a.hat_waermepumpe||a.hat_emobilitaet||a.hat_balkonkraftwerk||a.hat_sonstiges)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","‚Ä¢"," ",(a==null?void 0:a.anzahl_monate)||0," Monate"]}),e.jsxs(ee,{variant:"secondary",size:"sm",onClick:v,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),(a==null?void 0:a.hat_speicher)&&j.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(fe,{className:"h-6 w-6 text-green-500"}),"Speicher",a.hat_arbitrage&&e.jsx("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded",children:"Arbitrage"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Ladung gesamt",value:(j.ladung/1e3).toFixed(2),unit:"MWh",icon:fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Œ£ Speicher-Ladung aller Monate",berechnung:`${z(j.ladung,0)} kWh`,ergebnis:`= ${z(j.ladung/1e3,2)} MWh`}),e.jsx(de,{title:"Entladung gesamt",value:(j.entladung/1e3).toFixed(2),unit:"MWh",icon:fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ Speicher-Entladung aller Monate",berechnung:`${z(j.entladung,0)} kWh`,ergebnis:`= ${z(j.entladung/1e3,2)} MWh`}),e.jsx(de,{title:"√ò Effizienz",value:((k=j.effizienz)==null?void 0:k.toFixed(1))||"---",unit:"%",icon:fe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung √∑ Ladung √ó 100",berechnung:`${z(j.entladung,0)} kWh √∑ ${z(j.ladung,0)} kWh √ó 100`,ergebnis:j.effizienz?`= ${z(j.effizienz,1)}%`:"---"}),a.hat_arbitrage&&j.arbitrage>0?e.jsx(de,{title:"Arbitrage",value:j.arbitrage.toFixed(0),unit:"kWh",subtitle:"Netzladung",icon:fe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Œ£ Netzladung f√ºr Arbitrage"}):e.jsx(de,{title:"Verlust",value:(j.ladung-j.entladung).toFixed(0),unit:"kWh",subtitle:j.effizienz?`${(100-j.effizienz).toFixed(1)}%`:void 0,icon:fe,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Speicher pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:l.filter(y=>y.speicher_ladung_kwh>0||y.speicher_entladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{yAxisId:"left",tickFormatter:y=>`${y.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(le,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ae,{formatter:(y,b)=>b.includes("Effizienz")?[`${(y==null?void 0:y.toFixed(1))||"---"}%`,b]:[`${y.toFixed(0)} kWh`,b],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),e.jsx(U,{yAxisId:"left",dataKey:"speicher_ladung_kwh",name:"Ladung",fill:He.speicherLadung}),e.jsx(U,{yAxisId:"left",dataKey:"speicher_entladung_kwh",name:"Entladung",fill:He.speicherEntladung}),a.hat_arbitrage&&e.jsx(U,{yAxisId:"left",dataKey:"speicher_arbitrage_kwh",name:"Arbitrage (Netz)",fill:"#8b5cf6"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"speicher_effizienz_prozent",name:"Effizienz (%)",stroke:He.speicherEffizienz,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_waermepumpe)&&h.strom>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ee,{className:"h-6 w-6 text-red-500"}),"W√§rmepumpe"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"W√§rme erzeugt",value:(h.waerme/1e3).toFixed(2),unit:"MWh",icon:Ee,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Œ£ W√§rme aller Monate",berechnung:`${z(h.waerme,0)} kWh`,ergebnis:`= ${z(h.waerme/1e3,2)} MWh`}),e.jsx(de,{title:"Strom verbraucht",value:(h.strom/1e3).toFixed(2),unit:"MWh",icon:Ee,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Œ£ WP-Strom aller Monate",berechnung:`${z(h.strom,0)} kWh`,ergebnis:`= ${z(h.strom/1e3,2)} MWh`}),e.jsx(de,{title:"√ò COP",value:((N=h.cop)==null?void 0:N.toFixed(2))||"---",unit:"",subtitle:"Jahresarbeitszahl",icon:Ee,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"W√§rme √∑ Strom",berechnung:`${z(h.waerme,0)} kWh √∑ ${z(h.strom,0)} kWh`,ergebnis:h.cop?`= ${z(h.cop,2)} COP`:"---"}),e.jsx(de,{title:"Ersparnis vs. Gas",value:r?(h.waerme*.08-h.strom*r.netzbezug_arbeitspreis_cent_kwh/100).toFixed(0):"---",unit:"‚Ç¨",subtitle:"ca. 8 ct/kWh Gas",icon:Ee,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]}),(h.heizung>0||h.warmwasser>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Heizung",value:(h.heizung/1e3).toFixed(2),unit:"MWh",subtitle:h.waerme>0?`${(h.heizung/h.waerme*100).toFixed(0)}% der W√§rme`:void 0,icon:Ee,color:"text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Œ£ Heizenergie aller Monate"}),e.jsx(de,{title:"Warmwasser",value:(h.warmwasser/1e3).toFixed(2),unit:"MWh",subtitle:h.waerme>0?`${(h.warmwasser/h.waerme*100).toFixed(0)}% der W√§rme`:void 0,icon:Ee,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ Warmwasser-Energie aller Monate"})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"W√§rmepumpe pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:l.filter(y=>y.wp_waerme_kwh>0||y.wp_strom_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{yAxisId:"left",tickFormatter:y=>`${y.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(le,{yAxisId:"right",orientation:"right",domain:[0,"auto"],tick:{fontSize:11}}),e.jsx(ae,{formatter:(y,b)=>b==="COP"?[`${(y==null?void 0:y.toFixed(2))||"---"}`,b]:[`${y.toFixed(0)} kWh`,b],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),h.heizung>0||h.warmwasser>0?e.jsxs(e.Fragment,{children:[e.jsx(U,{yAxisId:"left",dataKey:"wp_heizung_kwh",name:"Heizung",stackId:"waerme",fill:"#f87171"}),e.jsx(U,{yAxisId:"left",dataKey:"wp_warmwasser_kwh",name:"Warmwasser",stackId:"waerme",fill:"#60a5fa"})]}):e.jsx(U,{yAxisId:"left",dataKey:"wp_waerme_kwh",name:"W√§rme",fill:He.wpWaerme}),e.jsx(U,{yAxisId:"left",dataKey:"wp_strom_kwh",name:"Strom",fill:He.wpStrom}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"wp_cop",name:"COP",stroke:He.wpCop,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_emobilitaet)&&p.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ve,{className:"h-6 w-6 text-purple-500"}),"E-Mobilit√§t",a.hat_v2h&&e.jsx("span",{className:"text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 px-2 py-0.5 rounded",children:"V2H"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Gefahrene km",value:(p.km/1e3).toFixed(1),unit:"Tkm",icon:ve,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Œ£ gefahrene km aller Monate",berechnung:`${z(p.km,0)} km`,ergebnis:`= ${z(p.km/1e3,1)} Tausend km`}),e.jsx(de,{title:"Ladung gesamt",value:(p.ladung/1e3).toFixed(2),unit:"MWh",icon:ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ E-Auto-Ladung aller Monate",berechnung:`${z(p.ladung,0)} kWh`,ergebnis:`= ${z(p.ladung/1e3,2)} MWh`}),e.jsx(de,{title:"√ò PV-Anteil",value:((S=p.pvAnteil)==null?void 0:S.toFixed(0))||"---",unit:"%",icon:ve,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Ladung √∑ Gesamtladung √ó 100",berechnung:`${z(p.pvLadung,0)} kWh √∑ ${z(p.ladung,0)} kWh √ó 100`,ergebnis:p.pvAnteil?`= ${z(p.pvAnteil,0)}%`:"---"}),e.jsx(de,{title:"Verbrauch",value:p.km>0?(p.ladung/p.km*100).toFixed(1):"---",unit:"kWh/100km",icon:ve,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Ladung √∑ km √ó 100",berechnung:`${z(p.ladung,0)} kWh √∑ ${z(p.km,0)} km √ó 100`,ergebnis:p.km>0?`= ${z(p.ladung/p.km*100,1)} kWh/100km`:"---"})]}),(p.pvLadung>0||p.netzLadung>0||p.externLadung>0||p.v2h>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"PV-Ladung",value:p.pvLadung.toFixed(0),unit:"kWh",subtitle:p.ladung>0?`${(p.pvLadung/p.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:re,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Œ£ Ladung aus eigener PV"}),e.jsx(de,{title:"Netz-Ladung",value:p.netzLadung.toFixed(0),unit:"kWh",subtitle:p.ladung>0?`${(p.netzLadung/p.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:xe,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Œ£ Ladung aus Netzstrom"}),p.externLadung>0&&e.jsx(de,{title:"Extern geladen",value:p.externLadung.toFixed(0),unit:"kWh",subtitle:p.externEuro>0?`${z(p.externEuro,2)} ‚Ç¨`:void 0,icon:ve,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Œ£ Ladung an √∂ffentlichen S√§ulen"}),a.hat_v2h&&p.v2h>0&&e.jsx(de,{title:"V2H Entladung",value:p.v2h.toFixed(0),unit:"kWh",subtitle:r?`‚âà ${z(p.v2h*r.netzbezug_arbeitspreis_cent_kwh/100,0)} ‚Ç¨ Ersparnis`:void 0,icon:fe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Œ£ R√ºckspeisung ins Haus (Vehicle-to-Home)"})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"E-Mobilit√§t pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:l.filter(y=>y.emob_km>0||y.emob_ladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{yAxisId:"left",tick:{fontSize:11}}),e.jsx(le,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ae,{formatter:(y,b)=>b.includes("PV-Anteil")?[`${(y==null?void 0:y.toFixed(0))||"---"}%`,b]:b.includes("km")?[`${y.toFixed(0)} km`,b]:b.includes("‚Ç¨")?[`${y.toFixed(2)} ‚Ç¨`,b]:[`${y.toFixed(0)} kWh`,b],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),e.jsx(U,{yAxisId:"left",dataKey:"emob_ladung_pv_kwh",name:"PV-Ladung",stackId:"ladung",fill:"#f59e0b"}),e.jsx(U,{yAxisId:"left",dataKey:"emob_ladung_netz_kwh",name:"Netz-Ladung",stackId:"ladung",fill:"#ef4444"}),p.externLadung>0&&e.jsx(U,{yAxisId:"left",dataKey:"emob_ladung_extern_kwh",name:"Extern",stackId:"ladung",fill:"#f97316"}),a.hat_v2h&&e.jsx(U,{yAxisId:"left",dataKey:"emob_v2h_kwh",name:"V2H",fill:"#06b6d4"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"emob_pv_anteil_prozent",name:"PV-Anteil (%)",stroke:He.emobPvAnteil,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_balkonkraftwerk)&&m.erzeugung>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(re,{className:"h-6 w-6 text-yellow-500"}),"Balkonkraftwerk",m.speicherLadung>0&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded",children:"mit Speicher"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Die BKW-Erzeugung ist in der PV-Gesamterzeugung enthalten, wird hier aber separat ausgewiesen."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Erzeugung gesamt",value:m.erzeugung.toFixed(0),unit:"kWh",icon:re,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Œ£ BKW-Erzeugung aller Monate",berechnung:`${z(m.erzeugung,0)} kWh`,ergebnis:`= ${z(m.erzeugung,0)} kWh`}),e.jsx(de,{title:"Eigenverbrauch",value:m.eigenverbrauch.toFixed(0),unit:"kWh",icon:re,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Œ£ BKW-Eigenverbrauch aller Monate",berechnung:`${z(m.eigenverbrauch,0)} kWh`,ergebnis:`= ${z(m.eigenverbrauch,0)} kWh`}),e.jsx(de,{title:"EV-Quote",value:m.erzeugung>0?(m.eigenverbrauch/m.erzeugung*100).toFixed(0):"---",unit:"%",icon:re,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch √∑ Erzeugung √ó 100",berechnung:`${z(m.eigenverbrauch,0)} kWh √∑ ${z(m.erzeugung,0)} kWh √ó 100`,ergebnis:m.erzeugung>0?`= ${z(m.eigenverbrauch/m.erzeugung*100,0)}%`:"---"}),e.jsx(de,{title:"Einspeisung",value:(m.erzeugung-m.eigenverbrauch).toFixed(0),unit:"kWh",subtitle:"gesch√§tzt",icon:re,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"})]}),m.speicherLadung>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Speicher Ladung",value:m.speicherLadung.toFixed(0),unit:"kWh",icon:fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Œ£ BKW-Speicher Ladung"}),e.jsx(de,{title:"Speicher Entladung",value:m.speicherEntladung.toFixed(0),unit:"kWh",icon:fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ BKW-Speicher Entladung"}),e.jsx(de,{title:"Speicher Effizienz",value:m.speicherLadung>0?(m.speicherEntladung/m.speicherLadung*100).toFixed(0):"---",unit:"%",icon:fe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung √∑ Ladung √ó 100"})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Balkonkraftwerk pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:l.filter(y=>y.bkw_erzeugung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ae,{formatter:(y,b)=>[`${y.toFixed(0)} kWh`,b],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),e.jsx(U,{dataKey:"bkw_erzeugung_kwh",name:"Erzeugung",fill:"#f59e0b"}),e.jsx(U,{dataKey:"bkw_eigenverbrauch_kwh",name:"Eigenverbrauch",fill:"#10b981"}),m.speicherLadung>0&&e.jsxs(e.Fragment,{children:[e.jsx(U,{dataKey:"bkw_speicher_ladung_kwh",name:"Speicher Ladung",fill:"#22c55e"}),e.jsx(U,{dataKey:"bkw_speicher_entladung_kwh",name:"Speicher Entladung",fill:"#3b82f6"})]})]})})})]})]}),(a==null?void 0:a.hat_sonstiges)&&(g.erzeugung>0||g.verbrauch>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(xe,{className:"h-6 w-6 text-gray-500"}),"Sonstige Komponenten"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:'Aggregiert alle Investitionen vom Typ "Sonstiges" (z.B. Mini-BHKW, Pool-Pumpe).'})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[g.erzeugung>0&&e.jsx(de,{title:"Erzeugung gesamt",value:g.erzeugung.toFixed(0),unit:"kWh",icon:xe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"}),g.verbrauch>0&&e.jsx(de,{title:"Verbrauch gesamt",value:g.verbrauch.toFixed(0),unit:"kWh",icon:xe,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20"}),g.erzeugung>0&&g.verbrauch>0&&e.jsx(de,{title:"Netto",value:(g.erzeugung-g.verbrauch).toFixed(0),unit:"kWh",icon:xe,color:g.erzeugung-g.verbrauch>=0?"text-green-500":"text-red-500",bgColor:g.erzeugung-g.verbrauch>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Sonstige Komponenten pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:l.filter(y=>y.sonstiges_erzeugung_kwh>0||y.sonstiges_verbrauch_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ae,{formatter:(y,b)=>[`${y.toFixed(0)} kWh`,b],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),g.erzeugung>0&&e.jsx(U,{dataKey:"sonstiges_erzeugung_kwh",name:"Erzeugung",fill:"#10b981"}),g.verbrauch>0&&e.jsx(U,{dataKey:"sonstiges_verbrauch_kwh",name:"Verbrauch",fill:"#ef4444"})]})})})]})]}),a&&(a.hat_waermepumpe&&h.strom===0||a.hat_emobilitaet&&p.ladung===0||a.hat_balkonkraftwerk&&m.erzeugung===0||a.hat_sonstiges&&g.erzeugung===0&&g.verbrauch===0)&&e.jsx(M,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Komponenten ohne Monatsdaten"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Einige Investitionen sind angelegt, haben aber noch keine Monatsdaten. Erfasse monatliche Verbrauchsdaten unter ",e.jsx("strong",{children:"Einstellungen ‚Üí Investitionen"}),"."]})]})]})})]}):e.jsxs(M,{className:"text-center py-12",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Komponentendaten vorhanden"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:["Erfasse Daten f√ºr Speicher, W√§rmepumpe, E-Auto, Balkonkraftwerk oder Sonstiges unter ",e.jsx("strong",{children:"Einstellungen ‚Üí Investitionen"})," und f√ºge Monatsdaten hinzu."]})]})}function Ln({data:t,stats:r,strompreis:s,anlageId:n,zeitraumLabel:a}){const[i,x]=d.useState(null);if(d.useEffect(()=>{n&&Ct.getKomponentenZeitreihe(n).then(x).catch(console.error)},[n]),!s)return e.jsxs(M,{className:"text-center py-8",children:[e.jsx(nt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const o=d.useMemo(()=>Qr(t,void 0,s),[t,s]),c=d.useMemo(()=>{var p;const h=new Map;return(p=i==null?void 0:i.monatswerte)==null||p.forEach(m=>{const g=`${m.jahr}-${m.monat}`;h.set(g,m.sonderkosten_euro||0)}),h},[i]),u=d.useMemo(()=>{let h=0;return o.map(p=>{const m=c.get(`${p.jahr}-${p.monat}`)||0,g=p.netto_ertrag-m;return h+=g,{...p,sonderkosten:m,netto_nach_sonderkosten:g,kumuliert_ertrag:h}})},[o,c]),l=d.useMemo(()=>{const h=r.gesamtEinspeisung*s.einspeiseverguetung_cent_kwh/100,p=r.gesamtNetzbezug*s.netzbezug_arbeitspreis_cent_kwh/100,m=r.gesamtEigenverbrauch*s.netzbezug_arbeitspreis_cent_kwh/100,g=u.reduce((k,N)=>k+(N.sonderkosten||0),0),v=h+m,w=v-g;return{einspeiseErloes:h,netzbezugKosten:p,eigenverbrauchErsparnis:m,nettoErtrag:v,sonderkosten:g,nettoNachSonderkosten:w}},[r,s,u]),j=()=>{const h=["Monat","Einspeiseerl√∂s (‚Ç¨)","EV-Ersparnis (‚Ç¨)","Netzbezug-Kosten (‚Ç¨)","Netto-Ertrag (‚Ç¨)","Sonderkosten (‚Ç¨)","Netto nach Sonderkosten (‚Ç¨)","Kumulierter Ertrag (‚Ç¨)"],p=u.map(m=>[m.name,m.einspeise_erloes,m.ev_ersparnis,m.netzbezug_kosten,m.netto_ertrag,m.sonderkosten,m.netto_nach_sonderkosten,m.kumuliert_ertrag]);sr(h,p,"finanzen_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","‚Ä¢"," ",r.anzahlMonate," Monate"]}),e.jsxs(ee,{variant:"secondary",size:"sm",onClick:j,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Einspeiseerl√∂s",value:l.einspeiseErloes.toFixed(0),unit:"‚Ç¨",subtitle:`${s.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung √ó Einspeiseverg√ºtung",berechnung:`${z(r.gesamtEinspeisung,0)} kWh √ó ${z(s.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${z(l.einspeiseErloes,2)} ‚Ç¨`}),e.jsx(de,{title:"EV-Ersparnis",value:l.eigenverbrauchErsparnis.toFixed(0),unit:"‚Ç¨",subtitle:"vermiedener Netzbezug",icon:nt,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch √ó Netzbezugspreis",berechnung:`${z(r.gesamtEigenverbrauch,0)} kWh √ó ${z(s.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${z(l.eigenverbrauchErsparnis,2)} ‚Ç¨`}),e.jsx(de,{title:"Netzbezug-Kosten",value:l.netzbezugKosten.toFixed(0),unit:"‚Ç¨",subtitle:`${s.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:nt,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug √ó Netzbezugspreis",berechnung:`${z(r.gesamtNetzbezug,0)} kWh √ó ${z(s.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${z(l.netzbezugKosten,2)} ‚Ç¨`}),e.jsx(de,{title:"Netto-Ertrag",value:l.nettoNachSonderkosten.toFixed(0),unit:"‚Ç¨",subtitle:l.sonderkosten>0?`nach ${l.sonderkosten.toFixed(0)} ‚Ç¨ Sonderkosten`:"Gesamt",icon:nt,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:l.sonderkosten>0?"Einspeiseerl√∂s + EV-Ersparnis ‚àí Sonderkosten":"Einspeiseerl√∂s + EV-Ersparnis",berechnung:l.sonderkosten>0?`${z(l.einspeiseErloes,2)} ‚Ç¨ + ${z(l.eigenverbrauchErsparnis,2)} ‚Ç¨ ‚àí ${z(l.sonderkosten,2)} ‚Ç¨`:`${z(l.einspeiseErloes,2)} ‚Ç¨ + ${z(l.eigenverbrauchErsparnis,2)} ‚Ç¨`,ergebnis:`= ${z(l.nettoNachSonderkosten,2)} ‚Ç¨`})]}),l.sonderkosten>0&&e.jsx(M,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(br,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:["Sonderkosten im Zeitraum: ",l.sonderkosten.toFixed(2)," ‚Ç¨"]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Reparaturen, Wartung und sonstige Kosten werden vom Netto-Ertrag abgezogen."})]})]})}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(nt,{className:"h-5 w-5 text-green-500"}),"Finanzielle Bilanz pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:u,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" ‚Ç¨",tick:{fontSize:11}}),e.jsx(ae,{formatter:(h,p)=>[`${h.toFixed(2)} ‚Ç¨`,p],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(je,{}),e.jsx(U,{dataKey:"einspeise_erloes",name:"Einspeiseerl√∂s",fill:Ye.feedin,stackId:"pos"}),e.jsx(U,{dataKey:"ev_ersparnis",name:"EV-Ersparnis",fill:Ye.consumption,stackId:"pos"}),e.jsx(U,{dataKey:"netzbezug_kosten",name:"Netzbezug (negativ)",fill:Ye.grid}),l.sonderkosten>0&&e.jsx(U,{dataKey:"sonderkosten",name:"Sonderkosten",fill:"#f59e0b"})]})})})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-blue-500"}),"Kumulierter Netto-Ertrag"]}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:u,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" ‚Ç¨",tick:{fontSize:11}}),e.jsx(ae,{formatter:h=>[`${h.toFixed(0)} ‚Ç¨`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Te,{type:"monotone",dataKey:"kumuliert_ertrag",name:"Kumulierter Ertrag",stroke:Ye.feedin,fill:Ye.feedin,fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[l.nettoNachSonderkosten.toFixed(0)," ‚Ç¨"]}),l.sonderkosten>0&&e.jsxs("span",{className:"text-gray-400 text-xs",children:["(nach ",l.sonderkosten.toFixed(0)," ‚Ç¨ Sonderkosten)"]})]})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Netto-Ertrag pro Monat ",l.sonderkosten>0&&"(nach Sonderkosten)"]}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:u,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" ‚Ç¨",tick:{fontSize:11}}),e.jsx(ae,{formatter:(h,p)=>[`${h.toFixed(2)} ‚Ç¨`,p],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(U,{dataKey:"netto_nach_sonderkosten",name:"Netto-Ertrag",fill:Ye.feedin,opacity:.7}),e.jsx(Ae,{type:"monotone",dataKey:"netto_nach_sonderkosten",name:"Trend",stroke:Ye.solar,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Durchschnittswerte"}),e.jsxs("div",{className:`grid grid-cols-2 gap-4 text-sm ${l.sonderkosten>0?"md:grid-cols-5":"md:grid-cols-4"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"√ò Einspeiseerl√∂s/Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(l.einspeiseErloes/r.anzahlMonate).toFixed(0)," ‚Ç¨"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"√ò EV-Ersparnis/Monat"}),e.jsxs("p",{className:"font-medium text-purple-600",children:[(l.eigenverbrauchErsparnis/r.anzahlMonate).toFixed(0)," ‚Ç¨"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"√ò Netzbezug-Kosten/Monat"}),e.jsxs("p",{className:"font-medium text-red-600",children:[(l.netzbezugKosten/r.anzahlMonate).toFixed(0)," ‚Ç¨"]})]}),l.sonderkosten>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"√ò Sonderkosten/Monat"}),e.jsxs("p",{className:"font-medium text-amber-600",children:[(l.sonderkosten/r.anzahlMonate).toFixed(0)," ‚Ç¨"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"√ò Netto-Ertrag/Monat"}),e.jsxs("p",{className:"font-medium text-blue-600",children:[(l.nettoNachSonderkosten/r.anzahlMonate).toFixed(0)," ‚Ç¨"]})]})]})]})]})}const dr=.38;function Dn({data:t,stats:r,zeitraumLabel:s}){const n=d.useMemo(()=>Qr(t),[t]),a=d.useMemo(()=>{let l=0;return n.map(j=>(l+=j.co2_einsparung,{...j,kumuliert_co2:l}))},[n]),i=r.gesamtErzeugung*dr,x=i/12.5,o=i/.12,c=i/230,u=()=>{const l=["Monat","CO2-Einsparung (kg)","Kumuliert (kg)","Kumuliert (t)"],j=a.map(h=>[h.name,h.co2_einsparung,h.kumuliert_co2,h.kumuliert_co2/1e3]);sr(l,j,"co2_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s})," ","‚Ä¢"," ",r.anzahlMonate," Monate"]}),e.jsxs(ee,{variant:"secondary",size:"sm",onClick:u,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"CO2 eingespart",value:(i/1e3).toFixed(2),unit:"t",subtitle:`${r.anzahlMonate} Monate`,icon:Ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung √ó CO2-Faktor",berechnung:`${z(r.gesamtErzeugung,0)} kWh √ó ${dr*1e3} g/kWh`,ergebnis:`= ${z(i,0)} kg = ${z(i/1e3,2)} t`}),e.jsx(de,{title:"B√§ume √§quivalent",value:x.toFixed(0),unit:"B√§ume/Jahr",subtitle:"Bindungsleistung",icon:Ke,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung √∑ 12,5 kg/Baum/Jahr",berechnung:`${z(i,0)} kg √∑ 12,5 kg/Baum`,ergebnis:`= ${z(x,0)} B√§ume`}),e.jsx(de,{title:"Auto-km vermieden",value:(o/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:Ke,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung √∑ 120 g/km",berechnung:`${z(i*1e3,0)} g √∑ 120 g/km`,ergebnis:`= ${z(o,0)} km`}),e.jsx(de,{title:"Kurzstreckenfl√ºge",value:c.toFixed(1),unit:"Fl√ºge",subtitle:"√† 1000 km",icon:Ke,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"CO2-Einsparung √∑ 230 kg/Flug",berechnung:`${z(i,0)} kg √∑ 230 kg/Flug`,ergebnis:`= ${z(c,1)} Fl√ºge vermieden`})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-green-500"}),"CO2-Einsparung pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{unit:" kg",tick:{fontSize:11}}),e.jsx(ae,{formatter:l=>[`${l.toFixed(0)} kg CO2`,"Einsparung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(U,{dataKey:"co2_einsparung",name:"CO2 eingespart",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kumulierte CO2-Einsparung"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:a,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(le,{tickFormatter:l=>`${(l/1e3).toFixed(1)}`,unit:" t",tick:{fontSize:11}}),e.jsx(ae,{formatter:l=>[`${(l/1e3).toFixed(2)} t CO2`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Te,{type:"monotone",dataKey:"kumuliert_co2",name:"Kumulierte Einsparung",stroke:"#10b981",fill:"#10b981",fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[(i/1e3).toFixed(2)," t CO2"]})]})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",e.jsxs("strong",{children:[dr*1e3," g CO2/kWh"]})," berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"√ò pro Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate).toFixed(0)," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"√ò pro kWh"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(dr*1e3).toFixed(0)," g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"√ò pro Jahr"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12/1e3).toFixed(2)," t"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Hochgerechnet 20 Jahre"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12*20/1e3).toFixed(1)," t"]})]})]})]})]})}function Vn({anlageId:t,strompreis:r,selectedYear:s="all"}){var v,w,k;const{investitionen:n,loading:a}=Ot(t),[i,x]=d.useState(null),[o,c]=d.useState(!0),[u,l]=d.useState(new Set);d.useEffect(()=>{(async()=>{try{c(!0);const S=await Fe.getROIDashboard(t,r==null?void 0:r.netzbezug_arbeitspreis_cent_kwh,r==null?void 0:r.einspeiseverguetung_cent_kwh,void 0,s);x(S)}catch(S){console.error("ROI-Dashboard Fehler:",S)}finally{c(!1)}})()},[t,r,s]);const j=d.useMemo(()=>{const N={};return n.forEach(S=>{N[S.typ]||(N[S.typ]=[]),N[S.typ].push(S)}),N},[n]),h=d.useMemo(()=>Object.entries(j).map(([N,S])=>({typ:N,label:Jt[N]||N,kosten:S.reduce((y,b)=>y+(b.anschaffungskosten_gesamt||0),0),color:vt[N]||"#6b7280"})).filter(N=>N.kosten>0).sort((N,S)=>S.kosten-N.kosten),[j]),p=d.useMemo(()=>{if(!i||!i.gesamt_jahres_einsparung)return[];const N=i.gesamt_relevante_kosten,S=i.gesamt_jahres_einsparung,y=[];for(let b=0;b<=25;b++){const W=b*S;y.push({jahr:b,investition:N,ersparnis:W,bilanz:W-N})}return y},[i]);if(a||o)return e.jsx(pe,{text:"Lade Investitionsdaten..."});if(n.length===0)return e.jsxs(M,{className:"text-center py-8",children:[e.jsx(Ft,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const m=(v=i==null?void 0:i.berechnungen.find(N=>N.investition_typ==="pv-module"))==null?void 0:v.detail_berechnung,g=m==null?void 0:m.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"Gesamtinvestition",value:((i==null?void 0:i.gesamt_relevante_kosten)||0).toFixed(0),unit:"‚Ç¨",subtitle:`${n.length} Komponenten`,icon:Oa,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ Anschaffungskosten ‚àí Alternativkosten",berechnung:i?`${z(i.gesamt_investition,0)} ‚Ç¨ ‚àí ${z(i.gesamt_investition-i.gesamt_relevante_kosten,0)} ‚Ç¨ Alternativ`:void 0,ergebnis:i?`= ${z(i.gesamt_relevante_kosten,0)} ‚Ç¨ relevante Kosten`:void 0}),e.jsx(de,{title:"Jahresersparnis",value:((i==null?void 0:i.gesamt_jahres_einsparung)||0).toFixed(0),unit:"‚Ç¨/Jahr",icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerl√∂s + Eigenverbrauch-Ersparnis",berechnung:m?`${z(m.einspeise_erloes_euro,2)} ‚Ç¨ + ${z(m.ev_ersparnis_euro,2)} ‚Ç¨`:"Œ£ aller Investitions-Einsparungen",ergebnis:g||(i?`= ${z(i.gesamt_jahres_einsparung,0)} ‚Ç¨/Jahr`:void 0)}),e.jsx(de,{title:"ROI",value:((w=i==null?void 0:i.gesamt_roi_prozent)==null?void 0:w.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:ke,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis √∑ Relevante Kosten √ó 100",berechnung:i&&i.gesamt_relevante_kosten>0?`${z(i.gesamt_jahres_einsparung,0)} ‚Ç¨ √∑ ${z(i.gesamt_relevante_kosten,0)} ‚Ç¨ √ó 100`:void 0,ergebnis:i!=null&&i.gesamt_roi_prozent?`= ${i.gesamt_roi_prozent.toFixed(1)}% ROI p.a.`:void 0}),e.jsx(de,{title:"Amortisation",value:((k=i==null?void 0:i.gesamt_amortisation_jahre)==null?void 0:k.toFixed(1))||"---",unit:"Jahre",icon:st,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten √∑ Jahresersparnis",berechnung:i&&i.gesamt_jahres_einsparung>0?`${z(i.gesamt_relevante_kosten,0)} ‚Ç¨ √∑ ${z(i.gesamt_jahres_einsparung,0)} ‚Ç¨/Jahr`:void 0,ergebnis:i!=null&&i.gesamt_amortisation_jahre?`= ${i.gesamt_amortisation_jahre.toFixed(1)} Jahre bis zur Kostendeckung`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(ot,{data:h,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:N,percent:S})=>`${N}: ${(S*100).toFixed(0)}%`,labelLine:!1,children:h.map((N,S)=>e.jsx(We,{fill:N.color},`cell-${S}`))}),e.jsx(ae,{formatter:N=>[`${N.toFixed(0)} ‚Ç¨`,""]})]})})})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:h,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{type:"number",unit:" ‚Ç¨",tick:{fontSize:11}}),e.jsx(le,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(ae,{formatter:N=>[`${N.toFixed(0)} ‚Ç¨`,""]}),e.jsx(U,{dataKey:"kosten",name:"Kosten",children:h.map((N,S)=>e.jsx(We,{fill:N.color},`cell-${S}`))})]})})})]})]}),p.length>0&&e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ft,{data:p,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(le,{unit:" ‚Ç¨",tick:{fontSize:11}}),e.jsx(ae,{formatter:N=>[`${N.toFixed(0)} ‚Ç¨`,""]}),e.jsx(je,{}),e.jsx(Te,{type:"monotone",dataKey:"investition",name:"Investition",stroke:Ye.grid,fill:Ye.grid,fillOpacity:.3}),e.jsx(Te,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:Ye.feedin,fill:Ye.feedin,fillOpacity:.3})]})})}),(i==null?void 0:i.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",i.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(i==null?void 0:i.berechnungen)&&i.berechnungen.length>0&&(()=>{const N=i.berechnungen.filter(b=>{var W;return b.investition_typ==="pv-module"&&typeof((W=b.detail_berechnung)==null?void 0:W.hinweis)=="string"&&b.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),S=i.berechnungen.filter(b=>{var W;return b.investition_typ==="wechselrichter"&&typeof((W=b.detail_berechnung)==null?void 0:W.hinweis)=="string"&&b.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),y=N.length>0||S.length>0;return e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),y&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollst√§ndig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[N.length>0&&e.jsxs("li",{children:[N.length," PV-Modul",N.length>1?"e":""," ohne Wechselrichter-Zuordnung ‚Üí Bitte unter Einstellungen ‚Üí Investitionen zuordnen"]}),S.length>0&&e.jsxs("li",{children:[S.length," Wechselrichter ohne PV-Module ‚Üí Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.berechnungen.map(b=>{var _,F;const W=b.anschaffungskosten_alternativ>0,H=W?"Anschaffung ‚àí Alternativkosten":"Anschaffungskosten (keine Alternative)",P=W?`${z(b.anschaffungskosten,0)} ‚Ç¨ ‚àí ${z(b.anschaffungskosten_alternativ,0)} ‚Ç¨`:`${z(b.anschaffungskosten,0)} ‚Ç¨`,Z=`= ${z(b.relevante_kosten,0)} ‚Ç¨ Mehrkosten`,f=(b.detail_berechnung||{}).hinweis,$=b.investition_typ==="pv-system"&&b.komponenten&&b.komponenten.length>0,K=u.has(b.investition_id),O=b.investition_typ==="pv-module"&&typeof f=="string"&&f.includes("ohne Wechselrichter"),X=b.investition_typ==="wechselrichter"&&typeof f=="string"&&f.includes("ohne zugeordnete PV-Module"),Q=()=>{l(I=>{const q=new Set(I);return q.has(b.investition_id)?q.delete(b.investition_id):q.add(b.investition_id),q})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${$?"cursor-pointer":""}`,onClick:$?Q:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[$&&(K?e.jsx(ht,{className:"h-4 w-4 text-gray-400"}):e.jsx(rt,{className:"h-4 w-4 text-gray-400"})),(O||X)&&e.jsx("span",{title:O?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(Re,{className:"h-4 w-4 text-amber-500"})}),b.investition_bezeichnung,$&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",b.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${vt[b.investition_typ]||"#6b7280"}20`,color:vt[b.investition_typ]||"#6b7280"},children:Jt[b.investition_typ]||b.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(bt,{formel:H,berechnung:P,ergebnis:Z,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[b.relevante_kosten.toFixed(0)," ‚Ç¨"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(bt,{formel:`Jahresersparnis ${Jt[b.investition_typ]||b.investition_typ}`,berechnung:f||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${z(b.jahres_einsparung,0)} ‚Ç¨/Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[b.jahres_einsparung.toFixed(0)," ‚Ç¨"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(bt,{formel:"Ersparnis √∑ Mehrkosten √ó 100",berechnung:`${z(b.jahres_einsparung,0)} ‚Ç¨ √∑ ${z(b.relevante_kosten,0)} ‚Ç¨ √ó 100`,ergebnis:b.roi_prozent?`= ${b.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((_=b.roi_prozent)==null?void 0:_.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(bt,{formel:"Mehrkosten √∑ Ersparnis",berechnung:`${z(b.relevante_kosten,0)} ‚Ç¨ √∑ ${z(b.jahres_einsparung,0)} ‚Ç¨/Jahr`,ergebnis:b.amortisation_jahre?`= ${b.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((F=b.amortisation_jahre)==null?void 0:F.toFixed(1))||"---"," J."]})})})]},b.investition_id),$&&K&&b.komponenten.map(I=>{var q,ne;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:vt[I.typ]||"#6b7280"}}),I.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${vt[I.typ]||"#6b7280"}15`,color:vt[I.typ]||"#6b7280"},children:Jt[I.typ]||I.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[I.relevante_kosten.toFixed(0)," ‚Ç¨"]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:I.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[I.einsparung.toFixed(0)," ‚Ç¨"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((q=I.detail)==null?void 0:q.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[I.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((ne=I.detail)==null?void 0:ne.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:I.detail.hinweis})]})]},`komp-${I.investition_id}`)})]})})})]})})]})})(),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(j).map(([N,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:vt[N]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Jt[N]||N}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",S.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:S.map(y=>{var b;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:y.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((b=y.anschaffungskosten_gesamt)==null?void 0:b.toFixed(0))||"0"," ‚Ç¨"]})]},y.id)})})]},N))})]})]})}const At=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function Kn({anlageId:t,selectedYear:r,verfuegbareJahre:s,zeitraumLabel:n}){var g,v;const[a,i]=d.useState(null),[x,o]=d.useState(!0),[c,u]=d.useState(null),[l,j]=d.useState(new Map);d.useEffect(()=>{(async()=>{var k,N;o(!0),u(null);try{if(r==="all"){const S=new Map;for(const y of s)try{const b=await Ct.getPVStrings(t,y);S.set(y,b)}catch(b){console.error(`Fehler beim Laden Jahr ${y}:`,b)}if(j(S),S.size>0){const y=S.get(s[0]);if(y){const b=y.strings.map(C=>{let f=0,$=0;S.forEach(X=>{const Q=X.strings.find(_=>_.investition_id===C.investition_id);Q&&(f+=Q.prognose_jahr_kwh,$+=Q.ist_jahr_kwh)});const K=f>0?($-f)/f*100:null,O=f>0?$/f:null;return{...C,prognose_jahr_kwh:f,ist_jahr_kwh:$,abweichung_jahr_prozent:K,abweichung_jahr_kwh:$-f,performance_ratio_jahr:O,spezifischer_ertrag_kwh_kwp:C.leistung_kwp>0?$/C.leistung_kwp:null,monatswerte:C.monatswerte.map((X,Q)=>{let _=0,F=0;return S.forEach(I=>{const q=I.strings.find(ne=>ne.investition_id===C.investition_id);q&&q.monatswerte[Q]&&(_+=q.monatswerte[Q].prognose_kwh,F+=q.monatswerte[Q].ist_kwh)}),{...X,prognose_kwh:_,ist_kwh:F}})}}),W=b.reduce((C,f)=>C+f.prognose_jahr_kwh,0),H=b.reduce((C,f)=>C+f.ist_jahr_kwh,0),P=[...b].filter(C=>C.performance_ratio_jahr!==null).sort((C,f)=>(f.performance_ratio_jahr||0)-(C.performance_ratio_jahr||0)),Z={...y,strings:b,prognose_gesamt_kwh:W,ist_gesamt_kwh:H,abweichung_gesamt_kwh:H-W,abweichung_gesamt_prozent:W>0?(H-W)/W*100:null,bester_string:((k=P[0])==null?void 0:k.bezeichnung)||null,schlechtester_string:((N=P[P.length-1])==null?void 0:N.bezeichnung)||null};i(Z)}}}else{const S=await Ct.getPVStrings(t,r);i(S)}}catch(S){u("Fehler beim Laden der String-Daten"),console.error(S)}finally{o(!1)}})()},[t,r,s]);const h=d.useMemo(()=>r!=="all"||l.size===0?[]:s.map(w=>{const k=l.get(w);if(!k)return null;const N={name:w.toString(),jahr:w};return k.strings.forEach(S=>{N[S.bezeichnung]=S.performance_ratio_jahr?Math.round(S.performance_ratio_jahr*100):0}),N.Gesamt=k.abweichung_gesamt_prozent?100+k.abweichung_gesamt_prozent:100,N}).filter(Boolean).reverse(),[r,l,s]),p=()=>{if(!a)return;const w=["String","kWp","Ausrichtung","SOLL (kWh)","IST (kWh)","Abweichung (%)","Performance Ratio","kWh/kWp"],k=a.strings.map(S=>[S.bezeichnung,S.leistung_kwp,S.ausrichtung||"-",S.prognose_jahr_kwh,S.ist_jahr_kwh,S.abweichung_jahr_prozent??"-",S.performance_ratio_jahr?(S.performance_ratio_jahr*100).toFixed(1)+"%":"-",S.spezifischer_ertrag_kwh_kwp??"-"]),N=r==="all"?"alle_jahre":r.toString();sr(w,k,`pv_strings_${N}.csv`)};if(x)return e.jsx(pe,{text:"Lade PV-String Daten..."});if(c)return e.jsx(Y,{type:"error",children:c});if(!a||a.strings.length===0)return e.jsxs(M,{className:"text-center py-8",children:[e.jsx(re,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen ‚Üí Investitionen anlegen."})]});if(!a.hat_prognose)return e.jsx(Y,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen ‚Üí PVGIS eine Prognose abrufen, um den SOLL-IST Vergleich zu nutzen."})]})});const m=[...a.strings].sort((w,k)=>(k.performance_ratio_jahr||0)-(w.performance_ratio_jahr||0));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","‚Ä¢"," ",a.strings.length," Strings ‚Ä¢ ",a.anlagen_leistung_kwp.toFixed(1)," kWp"]}),e.jsxs(ee,{variant:"secondary",size:"sm",onClick:p,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(de,{title:"SOLL (Prognose)",value:(a.prognose_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:"PVGIS Jahresprognose",icon:re,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ PVGIS-Prognose aller Strings",berechnung:a.strings.map(w=>`${w.bezeichnung}: ${w.prognose_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${z(a.prognose_gesamt_kwh,0)} kWh`}),e.jsx(de,{title:"IST (Erzeugt)",value:(a.ist_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:n,icon:ke,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Œ£ Erzeugung aller Strings",berechnung:a.strings.map(w=>`${w.bezeichnung}: ${w.ist_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${z(a.ist_gesamt_kwh,0)} kWh`}),e.jsx(de,{title:"Abweichung",value:`${(a.abweichung_gesamt_prozent||0)>=0?"+":""}${(a.abweichung_gesamt_prozent||0).toFixed(1)}`,unit:"%",subtitle:`${a.abweichung_gesamt_kwh>=0?"+":""}${a.abweichung_gesamt_kwh.toFixed(0)} kWh`,icon:(a.abweichung_gesamt_prozent||0)>=0?ke:yt,color:(a.abweichung_gesamt_prozent||0)>=0?"text-green-500":"text-red-500",bgColor:(a.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20",formel:"(IST - SOLL) √∑ SOLL √ó 100",berechnung:`(${z(a.ist_gesamt_kwh,0)} - ${z(a.prognose_gesamt_kwh,0)}) √∑ ${z(a.prognose_gesamt_kwh,0)} √ó 100`,ergebnis:`= ${z(a.abweichung_gesamt_prozent||0,1)} %`}),e.jsx(de,{title:"Spez. Ertrag √ò",value:(a.ist_gesamt_kwh/a.anlagen_leistung_kwp).toFixed(0),unit:"kWh/kWp",subtitle:n,icon:Dr,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"IST-Erzeugung √∑ Anlagenleistung",berechnung:`${z(a.ist_gesamt_kwh,0)} kWh √∑ ${z(a.anlagen_leistung_kwp,1)} kWp`,ergebnis:`= ${z(a.ist_gesamt_kwh/a.anlagen_leistung_kwp,0)} kWh/kWp`})]}),a.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[a.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-lg",children:[e.jsx(ke,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Beste Performance"}),e.jsx("p",{className:"font-medium text-green-700 dark:text-green-300",children:a.bester_string})]})]}),a.schlechtester_string&&a.schlechtester_string!==a.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(yt,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Schw√§chste Performance"}),e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300",children:a.schlechtester_string})]})]})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Dr,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro String"]}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:a.strings.map((w,k)=>({name:w.bezeichnung.length>12?w.bezeichnung.slice(0,12)+"...":w.bezeichnung,SOLL:w.prognose_jahr_kwh,IST:w.ist_jahr_kwh,color:At[k%At.length]})),layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{type:"number",unit:" kWh"}),e.jsx(le,{type:"category",dataKey:"name",width:100,tick:{fontSize:11}}),e.jsx(ae,{formatter:w=>[`${w.toFixed(0)} kWh`,""]}),e.jsx(je,{}),e.jsx(U,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(U,{dataKey:"IST",fill:"#f59e0b",name:"IST (Erzeugt)"})]})})})]}),e.jsxs(M,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Monatsverlauf SOLL vs IST ",r==="all"?"(Summe aller Jahre)":""]}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:((g=a.strings[0])==null?void 0:g.monatswerte.map((w,k)=>{const N={name:w.monat_name,SOLL:a.strings.reduce((S,y)=>{var b;return S+(((b=y.monatswerte[k])==null?void 0:b.prognose_kwh)||0)},0),IST:a.strings.reduce((S,y)=>{var b;return S+(((b=y.monatswerte[k])==null?void 0:b.ist_kwh)||0)},0)};return N.Abweichung=N.IST-N.SOLL,N}))||[],children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10}}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ae,{formatter:w=>[`${w.toFixed(0)} kWh`,""]}),e.jsx(je,{}),e.jsx(U,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(U,{dataKey:"IST",fill:"#f59e0b",name:"IST"}),e.jsx(Ae,{type:"monotone",dataKey:"Abweichung",stroke:"#10b981",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]}),r==="all"&&h.length>1&&e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Entwicklung √ºber Jahre"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(rr,{data:h,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name"}),e.jsx(le,{unit:"%",domain:[80,120],ticks:[80,90,100,110,120]}),e.jsx(ae,{formatter:w=>[`${w}%`,""]}),e.jsx(je,{}),a.strings.map((w,k)=>e.jsx(Ae,{type:"monotone",dataKey:w.bezeichnung,stroke:At[k%At.length],strokeWidth:2,dot:{r:4}},w.investition_id)),e.jsx(Ae,{type:"monotone",dataKey:"Gesamt",stroke:"#6b7280",strokeWidth:3,strokeDasharray:"5 5",dot:{r:4}})]})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"100% = Prognose erreicht ‚Ä¢ Werte √ºber 100% = √úberperformance"})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abweichung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:m.map(w=>{var k,N;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:At[a.strings.findIndex(S=>S.investition_id===w.investition_id)%At.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:w.bezeichnung})]}),w.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:["‚Üí ",w.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right",children:w.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3",children:[w.ausrichtung||"-",w.neigung_grad&&` / ${w.neigung_grad}¬∞`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600",children:[w.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right text-amber-600 font-medium",children:[w.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right font-medium ${(w.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(w.abweichung_jahr_prozent||0)>=0?"+":"",((k=w.abweichung_jahr_prozent)==null?void 0:k.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right text-purple-600",children:((N=w.spezifischer_ertrag_kwh_kwp)==null?void 0:N.toFixed(0))||"-"})]},w.investition_id)})}),e.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:"Gesamt"}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.anlagen_leistung_kwp.toFixed(1)}),e.jsx("td",{className:"px-3 py-2",children:"-"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-600",children:[a.prognose_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-2 text-right text-amber-600",children:[a.ist_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-2 text-right ${(a.abweichung_gesamt_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(a.abweichung_gesamt_prozent||0)>=0?"+":"",((v=a.abweichung_gesamt_prozent)==null?void 0:v.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-2 text-right text-purple-600",children:(a.ist_gesamt_kwh/a.anlagen_leistung_kwp).toFixed(0)})]})})]})})]})]})}function Bn(t,r){if(t==="all"){if(r.length===0)return"Alle Jahre";if(r.length===1)return`${r[0]}`;const s=Math.min(...r),n=Math.max(...r);return`${s}‚Äì${n}`}return`${t}`}function ws(){var S;const t=$t(),[r,s]=d.useState("energie"),[n,a]=d.useState("all"),{anlagen:i,loading:x}=Ce(),[o,c]=d.useState(null),u=o??((S=i[0])==null?void 0:S.id),l=i.find(y=>y.id===u),{monatsdaten:j,loading:h}=ta(u),{strompreis:p}=ra(u??null),m=d.useMemo(()=>[...new Set(j.map(b=>b.jahr))].sort((b,W)=>W-b),[j]),g=d.useMemo(()=>n==="all"?j:j.filter(y=>y.jahr===n),[j,n]),v=qa(g);if(x||h)return e.jsx(pe,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(Y,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(j.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(M,{className:"text-center py-12",children:[e.jsx(re,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(ee,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(Pe,{className:"h-4 w-4 ml-2"})]})]})]});const k=[{key:"energie",label:"Energie"},{key:"pv",label:"PV-Anlage"},{key:"komponenten",label:"Komponenten"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"},{key:"investitionen",label:"Investitionen"}],N=Bn(n,m);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:n,onChange:y=>a(y.target.value==="all"?"all":Number(y.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),m.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),i.length>1&&e.jsx("select",{value:u??"",onChange:y=>c(Number(y.target.value)),className:"input w-auto",children:i.map(y=>e.jsx("option",{value:y.id,children:y.anlagenname},y.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:k.map(y=>e.jsx("button",{onClick:()=>s(y.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${r===y.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:y.label},y.key))})})]}),e.jsxs("div",{children:[r==="energie"&&e.jsx(In,{data:g,stats:v,anlage:l,strompreis:p,zeitraumLabel:N}),r==="pv"&&u&&e.jsx(Kn,{anlageId:u,selectedYear:n,verfuegbareJahre:m,zeitraumLabel:N}),r==="komponenten"&&e.jsx(Pn,{anlage:l,strompreis:p,selectedYear:n,zeitraumLabel:N}),r==="finanzen"&&e.jsx(Ln,{data:g,stats:v,strompreis:p,anlageId:u,zeitraumLabel:N}),r==="co2"&&e.jsx(Dn,{data:g,stats:v,zeitraumLabel:N}),r==="investitionen"&&u&&e.jsx(Vn,{anlageId:u,strompreis:p,selectedYear:n,zeitraumLabel:N})]})]})}const On={"e-auto":ve,waermepumpe:Ee,speicher:fe,wallbox:xt,wechselrichter:kt,"pv-module":re,balkonkraftwerk:Hs,sonstiges:kt},Er={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},vs={"e-auto":"E-Auto",waermepumpe:"W√§rmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function Tn(){var y;const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(null),[a,i]=d.useState(null),[x,o]=d.useState(!1),[c,u]=d.useState(null),[l,j]=d.useState(30),[h,p]=d.useState(8.2),[m,g]=d.useState(1.85),v=s??((y=t[0])==null?void 0:y.id),{strompreis:w}=ra(v??null);d.useEffect(()=>{w&&(j(w.netzbezug_arbeitspreis_cent_kwh),p(w.einspeiseverguetung_cent_kwh))},[w]),d.useEffect(()=>{if(!v)return;(async()=>{try{o(!0),u(null);const W=await Fe.getROIDashboard(v,l,h,m);i(W)}catch(W){u(W instanceof Error?W.message:"Fehler beim Laden der ROI-Daten")}finally{o(!1)}})()},[v,l,h,m]);const k=d.useMemo(()=>{if(!a||a.gesamt_relevante_kosten<=0)return[];const b=[];let W=0;const H=Math.min(Math.ceil((a.gesamt_amortisation_jahre??20)*1.5),30);for(let P=0;P<=H;P++)b.push({jahr:P,kumulierte_einsparung:Math.round(W),investition:a.gesamt_relevante_kosten}),W+=a.gesamt_jahres_einsparung;return b},[a]),N=d.useMemo(()=>{if(!a)return[];const b={};return a.berechnungen.forEach(W=>{const H=W.investition_typ;b[H]=(b[H]||0)+W.jahres_einsparung}),Object.entries(b).map(([W,H])=>({name:vs[W]||W,value:Math.round(H),color:Er[W]||"#6b7280"})).filter(W=>W.value>0)},[a]),S=d.useMemo(()=>a?a.berechnungen.map(b=>({name:b.investition_bezeichnung.length>15?b.investition_bezeichnung.substring(0,15)+"...":b.investition_bezeichnung,fullName:b.investition_bezeichnung,kosten:b.relevante_kosten,einsparung:b.jahres_einsparung,amortisation:b.amortisation_jahre??0,typ:b.investition_typ,color:Er[b.investition_typ]||"#6b7280"})):[],[a]);return r?e.jsx(pe,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(Y,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:v??"",onChange:b=>n(Number(b.target.value)),className:"input w-auto",children:t.map(b=>e.jsx("option",{value:b.id,children:b.anlagenname},b.id))})})]}),c&&e.jsx(Y,{type:"error",onClose:()=>u(null),children:c}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(kt,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:l,onChange:b=>j(Number(b.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeiseverg√ºtung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:h,onChange:b=>p(Number(b.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:m,onChange:b=>g(Number(b.target.value)),className:"input"})]})]})]}),x&&e.jsx(pe,{text:"Berechne ROI..."}),!x&&a&&a.berechnungen.length===0&&e.jsx(Bt,{icon:Ft,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!x&&a&&a.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(cr,{icon:Ft,title:"Gesamtinvestition",value:`${a.gesamt_investition.toLocaleString("de-DE")} ‚Ç¨`,subtitle:`Relevant: ${a.gesamt_relevante_kosten.toLocaleString("de-DE")} ‚Ç¨`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Œ£ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt ‚àí Alternativkosten",ergebnis:`= ${z(a.gesamt_relevante_kosten,0)} ‚Ç¨`}),e.jsx(cr,{icon:ke,title:"J√§hrliche Einsparung",value:`${a.gesamt_jahres_einsparung.toLocaleString("de-DE")} ‚Ç¨`,subtitle:a.gesamt_roi_prozent?`ROI: ${a.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Œ£ Einsparungen aller Investitionen",berechnung:a.gesamt_relevante_kosten>0?"ROI = Einsparung √∑ Kosten √ó 100":void 0,ergebnis:a.gesamt_roi_prozent?`= ${a.gesamt_roi_prozent}% ROI`:void 0}),e.jsx(cr,{icon:Ts,title:"Amortisation",value:a.gesamt_amortisation_jahre?`${a.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten √∑ J√§hrliche Einsparung",berechnung:a.gesamt_jahres_einsparung>0?`${z(a.gesamt_relevante_kosten,0)} ‚Ç¨ √∑ ${z(a.gesamt_jahres_einsparung,0)} ‚Ç¨/Jahr`:void 0,ergebnis:a.gesamt_amortisation_jahre?`= ${a.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx(cr,{icon:Ke,title:"CO2-Einsparung",value:`${a.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Œ£ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${z(a.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(rr,{data:k,children:[e.jsx(ce,{strokeDasharray:"3 3",opacity:.3}),e.jsx(oe,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(le,{tickFormatter:b=>`${(b/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(ae,{formatter:(b,W)=>[`${b.toLocaleString("de-DE")} ‚Ç¨`,W==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:b=>`Jahr ${b}`}),e.jsx(je,{formatter:b=>b==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(Ae,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(Ae,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),a.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",a.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(ot,{data:N,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:b,percent:W})=>`${b}: ${(W*100).toFixed(0)}%`,labelLine:!0,children:N.map((b,W)=>e.jsx(We,{fill:b.color},`cell-${W}`))}),e.jsx(ae,{formatter:b=>[`${b.toLocaleString("de-DE")} ‚Ç¨/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:S,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",opacity:.3}),e.jsx(oe,{type:"number",tickFormatter:b=>`${b.toLocaleString("de-DE")}`}),e.jsx(le,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(ae,{formatter:(b,W)=>[W==="kosten"?`${b.toLocaleString("de-DE")} ‚Ç¨`:`${b.toLocaleString("de-DE")} ‚Ç¨/Jahr`,W==="kosten"?"Relevante Kosten":"J√§hrliche Einsparung"]}),e.jsx(je,{formatter:b=>b==="kosten"?"Relevante Kosten (‚Ç¨)":"J√§hrliche Einsparung (‚Ç¨)"}),e.jsx(U,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(U,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detail√ºbersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.berechnungen.map(b=>{const W=On[b.investition_typ]||kt;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4",style:{color:Er[b.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:b.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:vs[b.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[b.relevante_kosten.toLocaleString("de-DE")," ‚Ç¨"]}),b.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",b.anschaffungskosten.toLocaleString("de-DE")," ‚Ç¨ gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[b.jahres_einsparung.toLocaleString("de-DE")," ‚Ç¨"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:b.roi_prozent?e.jsxs("span",{className:b.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[b.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:b.amortisation_jahre?e.jsxs("span",{className:b.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[b.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:b.co2_einsparung_kg?`${b.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},b.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[a.gesamt_relevante_kosten.toLocaleString("de-DE")," ‚Ç¨"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[a.gesamt_jahres_einsparung.toLocaleString("de-DE")," ‚Ç¨"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:a.gesamt_roi_prozent?`${a.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:a.gesamt_amortisation_jahre?`${a.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[a.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(Y,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tats√§chlichen Einsparungen k√∂nnen je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function cr({icon:t,title:r,value:s,subtitle:n,color:a,bgColor:i,formel:x,berechnung:o,ergebnis:c}){const u=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s});return e.jsx(M,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:`h-6 w-6 ${a}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),x?e.jsx(bt,{formel:x,berechnung:o,ergebnis:c,children:u}):u,n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n})]})]})})}const Rn=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Hn(){var C;const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState(new Date().getFullYear()),[x,o]=d.useState(null),[c,u]=d.useState([]),[l,j]=d.useState(!1),[h,p]=d.useState(!1),[m,g]=d.useState(null);d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{s&&v()},[s,a]);const v=async()=>{if(s){j(!0),g(null);try{const f=await _t.list(s);u(f);const $=await Ue.getAktivePrognose(s);if($)o({jahresertrag_kwh:$.jahresertrag_kwh,monatswerte:$.monatswerte,isLive:!1});else try{const K=await Ue.getPrognose(s);o({jahresertrag_kwh:K.jahresertrag_kwh,monatswerte:K.monatsdaten.map(O=>({monat:O.monat,e_m:O.e_m})),isLive:!0,module:K.module})}catch(K){o(null),K instanceof Error&&K.message.includes("PV-Module")&&g("Keine PV-Module f√ºr diese Anlage definiert. Bitte unter Einstellungen ‚Üí Investitionen anlegen.")}}catch(f){g(f instanceof Error?f.message:"Fehler beim Laden")}finally{j(!1)}}},w=async()=>{if(s){p(!0);try{await Ue.speicherePrognose(s);const f=x==null?void 0:x.module;await v(),f&&f.length>0&&o($=>$?{...$,module:f}:null)}catch(f){g(f instanceof Error?f.message:"Fehler beim Speichern")}finally{p(!1)}}},k=[...new Set(c.map(f=>f.jahr))].sort((f,$)=>$-f);d.useEffect(()=>{k.length>0&&!k.includes(a)&&i(k[0])},[k,a]);const N=[];if(x!=null&&x.monatswerte)for(let f=1;f<=12;f++){const $=((C=x.monatswerte.find(Q=>Q.monat===f))==null?void 0:C.e_m)||0,K=c.filter(Q=>Q.jahr===a&&Q.monat===f).reduce((Q,_)=>Q+(_.pv_erzeugung_kwh||0),0),O=K-$,X=$>0?O/$*100:0;N.push({monat:f,monatName:Rn[f],prognose:$,ist:K,abweichung:O,abweichungProzent:X})}const S=N.reduce((f,$)=>f+$.prognose,0),y=N.reduce((f,$)=>f+$.ist,0),b=y-S,W=S>0?b/S*100:0,P=12-N.filter(f=>f.ist===0).length,Z=P>0?y/P*12:0;return r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ba,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:f=>n(parseInt(f.target.value)),options:t.map(f=>({value:f.id.toString(),label:f.anlagenname}))}),k.length>0&&e.jsx(Je,{value:a.toString(),onChange:f=>i(parseInt(f.target.value)),options:k.map(f=>({value:f.toString(),label:f.toString()}))}),e.jsx("button",{onClick:v,disabled:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(jt,{className:`h-5 w-5 ${l?"animate-spin":""}`})})]})]}),m&&e.jsx(Y,{type:"error",children:m}),l?e.jsx(pe,{text:"Lade Vergleichsdaten..."}):x?c.length===0?e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten f√ºr diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen ‚Üí Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[x.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(ee,{size:"sm",onClick:w,disabled:h,children:[e.jsx(qe,{className:"h-4 w-4 mr-1"}),h?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(M,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[S.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",a]})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[y.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[P," von 12 Monaten"]})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[b>=0?e.jsx(ke,{className:"h-6 w-6 text-green-500"}):e.jsx(yt,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${b>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[b>=0?"+":"",b.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${b>=0?"text-green-500":"text-red-500"}`,children:[b>=0?"+":"",W.toFixed(1),"%"]})]}),P<12&&P>0&&e.jsxs(M,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[Z.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((Z/S-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",a]}),e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:N,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"monatName"}),e.jsx(le,{yAxisId:"left",tickFormatter:f=>`${f} kWh`}),e.jsx(le,{yAxisId:"right",orientation:"right",tickFormatter:f=>`${f}%`}),e.jsx(ae,{formatter:(f,$)=>$==="Abweichung %"?`${f.toFixed(1)}%`:`${f.toFixed(0)} kWh`}),e.jsx(je,{}),e.jsx(ba,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(U,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(U,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:N.map(f=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:f.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[f.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:f.ist>0?e.jsxs("span",{className:"text-green-600",children:[f.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${f.abweichung>=0?"text-green-600":"text-red-600"}`,children:f.ist>0?`${f.abweichung>=0?"+":""}${f.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${f.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:f.ist>0?`${f.abweichungProzent>=0?"+":""}${f.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:f.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):f.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(ke,{className:"h-4 w-4"}),"√úbertroffen"]}):f.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):f.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(yt,{className:"h-4 w-4"}),"Unter Plan"]})})]},f.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[S.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[y.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${b>=0?"text-green-600":"text-red-600"}`,children:[b>=0?"+":"",b.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${W>=0?"text-green-600":"text-red-600"}`,children:[W>=0?"+":"",W.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"√úbertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (¬±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme pr√ºfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langj√§hrigen Mittelwerten. Einzelne Monate k√∂nnen stark abweichen."})]})]}):e.jsx(M,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verf√ºgbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen ‚Üí Investitionen".'})]})})]})}const wr={async getKurzfristPrognose(t,r=14){return J.get(`/aussichten/kurzfristig/${t}?tage=${r}`)},async getLangfristPrognose(t,r=12){return J.get(`/aussichten/langfristig/${t}?monate=${r}`)},async getTrendAnalyse(t,r=3){return J.get(`/aussichten/trend/${t}?jahre=${r}`)},async getWetterVorhersage(t,r=7){return J.get(`/aussichten/wetter/${t}?tage=${r}`)},async getFinanzPrognose(t,r=12){return J.get(`/aussichten/finanzen/${t}?monate=${r}`)}};function It({symbol:t,className:r="h-6 w-6"}){switch(t){case"sunny":return e.jsx(re,{className:`${r} text-yellow-500`});case"partly_cloudy":return e.jsx(St,{className:`${r} text-gray-400`});case"cloudy":return e.jsx(St,{className:`${r} text-gray-500`});case"rainy":case"drizzle":case"showers":return e.jsx(Fa,{className:`${r} text-blue-500`});case"snowy":case"snow_showers":return e.jsx(Wa,{className:`${r} text-blue-300`});case"thunderstorm":return e.jsx(Ea,{className:`${r} text-purple-500`});case"foggy":return e.jsx(St,{className:`${r} text-gray-300`});default:return e.jsx(re,{className:`${r} text-yellow-400`})}}function Pt(t){return new Date(t).toLocaleDateString("de-DE",{weekday:"short",day:"2-digit",month:"2-digit"})}function Ns(t){return new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})}function or(t){return t==null||t<20?"sunny":t<50?"partly_cloudy":(t<80,"cloudy")}function Gn({anlageId:t}){var W,H,P,Z;const[r,s]=d.useState(null),[n,a]=d.useState(null),[i,x]=d.useState(!0),[o,c]=d.useState(null),[u,l]=d.useState(14),[j,h]=d.useState("standard"),[p,m]=d.useState(!1);d.useEffect(()=>{g()},[t,u,j]);async function g(){x(!0),c(null);try{if(j==="solar-gti"){const C=await fr.getSolarPrognose(t,u,!1);a(C),s(null)}else{const C=await wr.getKurzfristPrognose(t,u);s(C),a(null)}}catch(C){c(C.message||"Fehler beim Laden der Prognose")}finally{x(!1)}}if(i)return e.jsx(pe,{text:"Lade Kurzfrist-Prognose..."});if(o)return e.jsx(Y,{type:"error",children:o});if(!r&&!n)return e.jsx(Y,{type:"warning",children:"Keine Prognose verf√ºgbar"});const v=j==="solar-gti"&&n?n.tage.map(C=>({datum:Ns(C.datum),datumFull:Pt(C.datum),pv_kwh:C.pv_ertrag_kwh,sonnenstunden:null,temperatur:C.temperatur_max_c,gti:C.gti_kwh_m2})):(r==null?void 0:r.tageswerte.map(C=>({datum:Ns(C.datum),datumFull:Pt(C.datum),pv_kwh:C.pv_prognose_kwh,sonnenstunden:C.sonnenstunden,temperatur:C.temperatur_max_c,gti:null})))||[],w=j==="solar-gti"&&n?{...n.tage[0],pv_prognose_kwh:(W=n.tage[0])==null?void 0:W.pv_ertrag_kwh,wetter_symbol:or((H=n.tage[0])==null?void 0:H.bewoelkung_prozent)}:r==null?void 0:r.tageswerte[0],k=j==="solar-gti"&&n?{...n.tage[1],pv_prognose_kwh:(P=n.tage[1])==null?void 0:P.pv_ertrag_kwh,wetter_symbol:or((Z=n.tage[1])==null?void 0:Z.bewoelkung_prozent)}:r==null?void 0:r.tageswerte[1],N=j==="solar-gti"&&n?n.tage.reduce((C,f)=>C+(f.pv_ertrag_kwh||0),0):(r==null?void 0:r.summe_kwh)||0,S=v.length>0?N/v.length:0,y=j==="solar-gti"&&n?n.anlage.leistung_kwp:(r==null?void 0:r.anlagenleistung_kwp)||0,b=j==="solar-gti"&&n?"Open-Meteo Solar (GTI)":(r==null?void 0:r.datenquelle)||"";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(kt,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Prognose-Modus:"}),e.jsxs("select",{value:j,onChange:C=>h(C.target.value),className:"input w-auto text-sm",children:[e.jsx("option",{value:"standard",children:"Standard (GHI-basiert)"}),e.jsx("option",{value:"solar-gti",children:"Solar GTI (Modulneigung)"})]}),e.jsx("button",{onClick:()=>m(!p),className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Info zum Prognose-Modus",children:e.jsx(Le,{className:"h-4 w-4"})})]})}),p&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Prognose-Modi:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Standard:"})," Basiert auf horizontaler Globalstrahlung (GHI). Guter √úberblick."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solar GTI:"})," Ber√ºcksichtigt Modulneigung und -ausrichtung f√ºr genauere Prognose. Nutzt Open-Meteo Solar API."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Summe ",v.length," Tage"]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[N.toFixed(0)," kWh"]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(re,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Durchschnitt/Tag"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[S.toFixed(1)," kWh"]})]})]})}),w&&e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(It,{symbol:w.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Heute"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(w.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})}),k&&e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(It,{symbol:k.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Morgen"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(k.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})})]}),e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:j==="solar-gti"?"Solar-Prognose (GTI)":"Wettervorhersage"}),e.jsxs("select",{value:u,onChange:C=>l(Number(C.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:7,children:"7 Tage"}),e.jsx("option",{value:14,children:"14 Tage"}),e.jsx("option",{value:16,children:"16 Tage"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 min-w-max pb-2",children:j==="solar-gti"&&n?n.tage.map((C,f)=>{var $;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${f===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:Pt(C.datum)}),e.jsx(It,{symbol:or(C.bewoelkung_prozent),className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[C.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Wt,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(($=C.temperatur_max_c)==null?void 0:$.toFixed(0))??"-","¬∞C"]})]}),C.gti_kwh_m2!==null&&C.gti_kwh_m2>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(re,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[C.gti_kwh_m2.toFixed(1)," GTI"]})]})]},C.datum)}):r?r.tageswerte.map((C,f)=>{var $;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${f===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:Pt(C.datum)}),e.jsx(It,{symbol:C.wetter_symbol,className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[C.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Wt,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[(($=C.temperatur_max_c)==null?void 0:$.toFixed(0))??"-","¬∞C"]})]}),C.sonnenstunden!==null&&C.sonnenstunden>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(re,{className:"h-3 w-3 text-yellow-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[C.sonnenstunden.toFixed(0),"h"]})]})]},C.datum)}):null})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Prognose"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:v,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"datum",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(le,{yAxisId:"left",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(le,{yAxisId:"right",orientation:"right",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"¬∞C",angle:90,position:"insideRight"}}),e.jsx(ae,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(C,f)=>f==="pv_kwh"?[`${C.toFixed(1)} kWh`,"PV-Prognose"]:f==="sonnenstunden"?[`${C.toFixed(1)} h`,"Sonnenstunden"]:f==="temperatur"?[`${C.toFixed(0)} ¬∞C`,"Temperatur"]:[C,f]}),e.jsx(je,{}),e.jsx(U,{yAxisId:"left",dataKey:"pv_kwh",name:"PV-Prognose",fill:"#eab308",radius:[4,4,0,0]}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"temperatur",name:"Temperatur",stroke:"#ef4444",strokeWidth:2,dot:{r:3}})]})})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Datum"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Wetter"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Prognose"}),e.jsx("th",{className:"text-right py-2 px-3",children:j==="solar-gti"?"GTI":"Strahlung"}),e.jsx("th",{className:"text-right py-2 px-3",children:j==="solar-gti"?"Bew√∂lkung":"Sonnenstunden"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Temperatur"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Niederschlag"})]})}),e.jsx("tbody",{children:j==="solar-gti"&&n?n.tage.map((C,f)=>{var $,K,O;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${f===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:Pt(C.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(It,{symbol:or(C.bewoelkung_prozent),className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[C.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[(($=C.gti_kwh_m2)==null?void 0:$.toFixed(2))??"-"," kWh/m¬≤"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((K=C.bewoelkung_prozent)==null?void 0:K.toFixed(0))??"-"," %"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((O=C.temperatur_max_c)==null?void 0:O.toFixed(0))??"-","¬∞C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:C.niederschlag_mm!==null&&C.niederschlag_mm!==void 0&&C.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[C.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},C.datum)}):r?r.tageswerte.map((C,f)=>{var $,K,O;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${f===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:Pt(C.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(It,{symbol:C.wetter_symbol,className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[C.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[(($=C.globalstrahlung_kwh_m2)==null?void 0:$.toFixed(1))??"-"," kWh/m¬≤"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((K=C.sonnenstunden)==null?void 0:K.toFixed(1))??"-"," h"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((O=C.temperatur_max_c)==null?void 0:O.toFixed(0))??"-","¬∞C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:C.niederschlag_mm!==null&&C.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[C.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},C.datum)}):null})]})})]}),e.jsx(M,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",y.toFixed(1)," kWp"]}),j==="solar-gti"&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Neigung: ",n.anlage.neigung,"¬∞"]}),e.jsxs("span",{children:["Ausrichtung: ",n.anlage.azimut,"¬∞"]})]}),j!=="solar-gti"&&r&&e.jsxs("span",{children:["Systemverluste: ",r.system_losses_prozent.toFixed(0),"%"]}),e.jsxs("span",{children:["Datenquelle: ",b]}),e.jsxs("span",{children:["Abgerufen: ",new Date(j==="solar-gti"&&n?n.abgerufen_am:(r==null?void 0:r.abgerufen_am)||new Date().toISOString()).toLocaleString("de-DE")]})]})})]})}function _s({richtung:t}){switch(t){case"positiv":return e.jsx(ke,{className:"h-5 w-5 text-green-500"});case"negativ":return e.jsx(yt,{className:"h-5 w-5 text-red-500"});default:return e.jsx(Vr,{className:"h-5 w-5 text-gray-400"})}}function Jn({anlageId:t}){const[r,s]=d.useState(null),[n,a]=d.useState(!0),[i,x]=d.useState(null),[o,c]=d.useState(12),[u,l]=d.useState(!0);d.useEffect(()=>{j()},[t,o]);async function j(){a(!0),x(null);try{const g=await wr.getLangfristPrognose(t,o);s(g)}catch(g){x(g.message||"Fehler beim Laden der Prognose")}finally{a(!1)}}if(n)return e.jsx(pe,{text:"Lade Langfrist-Prognose..."});if(i)return e.jsx(Y,{type:"error",children:i});if(!r)return e.jsx(Y,{type:"warning",children:"Keine Prognose verf√ºgbar"});const h=r.monatswerte.map(g=>({name:`${g.monat_name.substring(0,3)} ${g.jahr}`,monat_name:g.monat_name,jahr:g.jahr,pvgis:g.pvgis_prognose_kwh,trend:g.trend_korrigiert_kwh,min:g.konfidenz_min_kwh,max:g.konfidenz_max_kwh,konfidenz:[g.konfidenz_min_kwh,g.konfidenz_max_kwh],pr:g.historische_performance_ratio})),p=r.trend_analyse,m=(p.durchschnittliche_performance_ratio*100).toFixed(0)+"%";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahresprognose"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(st,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[o," Monate"]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_s,{richtung:p.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:m})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Le,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenbasis"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[p.datenbasis_monate," Monate"]})]})]})})]}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatsprognose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:g=>l(g.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Konfidenzband"})]}),e.jsxs("select",{value:o,onChange:g=>c(Number(g.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsx("div",{className:"h-[350px]",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:h,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60,className:"text-gray-600 dark:text-gray-400"}),e.jsx(le,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ae,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(g,v)=>v==="trend"?[`${g.toFixed(0)} kWh`,"Trend-korrigiert"]:v==="pvgis"?[`${g.toFixed(0)} kWh`,"PVGIS-Prognose"]:v==="konfidenz"&&Array.isArray(g)?[`${g[0].toFixed(0)} - ${g[1].toFixed(0)} kWh`,"Konfidenzband"]:[g,v]}),e.jsx(je,{}),u&&e.jsx(Te,{type:"monotone",dataKey:"konfidenz",name:"Konfidenzband",fill:"#3b82f6",fillOpacity:.1,stroke:"none"}),e.jsx(U,{dataKey:"pvgis",name:"PVGIS-Prognose",fill:"#9ca3af",fillOpacity:.5,radius:[4,4,0,0]}),e.jsx(U,{dataKey:"trend",name:"Trend-korrigiert",fill:"#eab308",radius:[4,4,0,0]})]})})})}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Trend-Analyse"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(_s,{richtung:p.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trend"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white capitalize",children:p.trend_richtung})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[m,e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(IST / SOLL)"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenquellen"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.datenquellen.join(", ")})]})]})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PVGIS"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Trend-korrigiert"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Min"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Max"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Hist. PR"})]})}),e.jsx("tbody",{children:r.monatswerte.map(g=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[g.monat_name," ",g.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[g.pvgis_prognose_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[g.trend_korrigiert_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[g.konfidenz_min_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[g.konfidenz_max_kwh.toFixed(0)," kWh"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:g.historische_performance_ratio!==null?e.jsxs("span",{className:g.historische_performance_ratio>1?"text-green-600":g.historische_performance_ratio<.9?"text-red-600":"text-gray-600",children:[(g.historische_performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},`${g.jahr}-${g.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[r.monatswerte.reduce((g,v)=>g+v.pvgis_prognose_kwh,0).toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{colSpan:3})]})})]})})]}),e.jsx(M,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]}),e.jsxs("span",{children:["Spez. Ertrag: ",(r.jahresprognose_kwh/r.anlagenleistung_kwp).toFixed(0)," kWh/kWp"]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function Zn({anlageId:t}){const[r,s]=d.useState(null),[n,a]=d.useState(!0),[i,x]=d.useState(null),[o,c]=d.useState(3);d.useEffect(()=>{u()},[t,o]);async function u(){a(!0),x(null);try{const g=await wr.getTrendAnalyse(t,o);s(g)}catch(g){x(g.message||"Fehler beim Laden der Trend-Analyse")}finally{a(!1)}}if(n)return e.jsx(pe,{text:"Lade Trend-Analyse..."});if(i)return e.jsx(Y,{type:"error",children:i});if(!r)return e.jsx(Y,{type:"warning",children:"Keine Trend-Daten verf√ºgbar"});if(!r.jahres_vergleich.some(g=>g.gesamt_kwh>0))return e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(Re,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine historischen Daten"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["F√ºr eine Trend-Analyse werden mindestens Daten aus einem Jahr ben√∂tigt.",e.jsx("br",{}),"Erfasse Monatsdaten, um Trends zu analysieren."]})]})});const j=r.jahres_vergleich.map(g=>({jahr:g.jahr.toString(),kwh:g.gesamt_kwh,spez_ertrag:g.spezifischer_ertrag_kwh_kwp,pr:g.performance_ratio?g.performance_ratio*100:null})),h=r.jahres_vergleich.filter(g=>g.gesamt_kwh>0),p=h.length>0?h.reduce((g,v)=>v.gesamt_kwh>g.gesamt_kwh?v:g,h[0]):null,m=r.degradation.geschaetzt_prozent_jahr;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[p&&e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(za,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bestes Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:p.jahr}),e.jsxs("p",{className:"text-sm text-green-600",children:[p.gesamt_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(st,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Analysezeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.analyse_zeitraum.von," - ",r.analyse_zeitraum.bis]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[m!==null?m>0?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(ke,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):m<-1?e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(yt,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Vr,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Vr,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Degradation/Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:m!==null?e.jsxs("span",{className:m>0?"text-green-600":m<-1?"text-red-600":"",children:[m>0?"+":"",m.toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(xe,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]})})]}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"}),e.jsxs("select",{value:o,onChange:g=>c(Number(g.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:2,children:"2 Jahre"}),e.jsx("option",{value:3,children:"3 Jahre"}),e.jsx("option",{value:5,children:"5 Jahre"}),e.jsx("option",{value:10,children:"10 Jahre"})]})]})}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresertr√§ge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:j,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(le,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ae,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:g=>[`${g.toLocaleString("de-DE")} kWh`,"Ertrag"]}),e.jsx(je,{}),e.jsx(U,{dataKey:"kwh",name:"Jahresertrag",radius:[4,4,0,0],children:j.map((g,v)=>e.jsx(We,{fill:g.kwh===(p==null?void 0:p.gesamt_kwh)?"#10b981":"#eab308"},`cell-${v}`))})]})})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(rr,{data:j,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(le,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",domain:["auto","auto"]}),e.jsx(ae,{formatter:g=>[`${g.toFixed(0)} kWh/kWp`,"Spez. Ertrag"]}),e.jsx(je,{}),e.jsx(Ae,{type:"monotone",dataKey:"spez_ertrag",name:"Spez. Ertrag",stroke:"#3b82f6",strokeWidth:2,dot:{r:5}})]})})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Saisonale Muster"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Beste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.beste_monate.map((g,v)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${v===0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-500"}`,children:g},g))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Schw√§chste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.schlechteste_monate.map((g,v)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${v===0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-orange-50 text-orange-700 dark:bg-orange-900/20 dark:text-orange-500"}`,children:g},g))})]})]})]}),e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Degradation"}),r.degradation.methode&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.degradation.methode==="vollstaendig"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:r.degradation.methode==="vollstaendig"?"Vollst√§ndige Jahre":"TMY-erg√§nzt"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:m!==null?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:m>0?e.jsxs("span",{className:"text-green-600",children:["+",m.toFixed(2),"% pro Jahr"]}):m<-1?e.jsxs("span",{className:"text-red-600",children:[m.toFixed(2),"% pro Jahr"]}):e.jsxs("span",{className:"text-gray-600",children:[m.toFixed(2),"% pro Jahr"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.degradation.hinweis}),r.degradation.methode==="tmy_ergaenzt"&&e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:"Unvollst√§ndige Jahre wurden mit PVGIS TMY-Prognosewerten erg√§nzt."}),m<-1&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-2",children:"Eine Degradation von mehr als 1% pro Jahr kann auf Probleme hinweisen. Typische Modul-Degradation liegt bei 0.3-0.5% pro Jahr."})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r.degradation.hinweis})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahres√ºbersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Jahr"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Monate"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Performance-Ratio"})]})}),e.jsx("tbody",{children:r.jahres_vergleich.map(g=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${g.gesamt_kwh===(p==null?void 0:p.gesamt_kwh)&&g.ist_vollstaendig?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[g.jahr,!g.ist_vollstaendig&&g.anzahl_monate>0&&e.jsx("span",{className:"ml-1 text-xs text-orange-500",title:"Unvollst√§ndiges Jahr",children:"*"})]}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:g.ist_vollstaendig?"text-green-600":"text-orange-500",children:[g.anzahl_monate,"/12"]})}),e.jsx("td",{className:"py-2 px-3 text-right",children:g.gesamt_kwh>0?e.jsxs("span",{className:"font-semibold text-yellow-600",children:[g.gesamt_kwh.toLocaleString("de-DE")," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:g.spezifischer_ertrag_kwh_kwp>0?`${g.spezifischer_ertrag_kwh_kwp.toFixed(0)} kWh/kWp`:e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:g.performance_ratio!==null?e.jsxs("span",{className:g.performance_ratio>1?"text-green-600":g.performance_ratio<.9?"text-red-600":"text-gray-600",children:[(g.performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},g.jahr))})]})})]}),e.jsx(M,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})})]})}const qn=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ec4899"],Un={speicher:fe,"e-auto-v2h":ve,"e-auto-ladung":ve,waermepumpe:Ee};function Yn({anlageId:t}){const[r,s]=d.useState(null),[n,a]=d.useState(!0),[i,x]=d.useState(null),[o,c]=d.useState(12);d.useEffect(()=>{u()},[t,o]);async function u(){a(!0),x(null);try{const p=await wr.getFinanzPrognose(t,o);s(p)}catch(p){x(p.message||"Fehler beim Laden der Finanzprognose")}finally{a(!1)}}if(n)return e.jsx(pe,{text:"Lade Finanzprognose..."});if(i)return e.jsx(Y,{type:"error",children:i});if(!r)return e.jsx(Y,{type:"warning",children:"Keine Prognose verf√ºgbar"});const l=r.monatswerte.map(p=>({name:`${p.monat_name.substring(0,3)} ${p.jahr}`,einspeise_erloes:p.einspeise_erloes_euro,ev_ersparnis:p.ev_ersparnis_euro,netto_ertrag:p.netto_ertrag_euro})),j=[{name:"EV-Ersparnis",value:r.jahres_ev_ersparnis_euro},{name:"Einspeise-Erl√∂s",value:r.jahres_einspeise_erloes_euro}],h=Math.min(r.amortisations_fortschritt_prozent,100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(nt,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahres-Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," ‚Ç¨"]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ke,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.amortisations_fortschritt_prozent.toFixed(1),"%"]})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[r.amortisation_erreicht?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(Xe,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(Ts,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.amortisation_erreicht?e.jsx("span",{className:"text-green-600",children:"Erreicht"}):r.amortisation_prognose_jahr?e.jsx("span",{children:r.amortisation_prognose_jahr}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(Ft,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bisherige Ertr√§ge"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," ‚Ç¨"]})]})]})})]}),e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Amortisations-Fortschritt"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," ‚Ç¨ von ",r.investition_gesamt_euro.toLocaleString("de-DE")," ‚Ç¨"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all ${r.amortisation_erreicht?"bg-green-500":h>75?"bg-blue-500":h>50?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${h}%`}})}),!r.amortisation_erreicht&&r.restlaufzeit_bis_amortisation_monate&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Noch ca. ",r.restlaufzeit_bis_amortisation_monate," Monate bis zur Amortisation (voraussichtlich ",r.amortisation_prognose_jahr,")"]})]}),e.jsx(M,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatliche Ertrags-Prognose"}),e.jsxs("select",{value:o,onChange:p=>c(Number(p.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(M,{className:"p-4 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatliche Ertr√§ge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:l,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60}),e.jsx(le,{tick:{fontSize:12},label:{value:"‚Ç¨",angle:-90,position:"insideLeft"}}),e.jsx(ae,{formatter:(p,m)=>{const g={einspeise_erloes:"Einspeise-Erl√∂s",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"};return[`${p.toFixed(2)} ‚Ç¨`,g[m]||m]}}),e.jsx(je,{formatter:p=>({einspeise_erloes:"Einspeise-Erl√∂s",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"})[p]||p}),e.jsx(U,{dataKey:"einspeise_erloes",stackId:"a",fill:"#3b82f6",name:"einspeise_erloes"}),e.jsx(U,{dataKey:"ev_ersparnis",stackId:"a",fill:"#10b981",name:"ev_ersparnis"}),e.jsx(Ae,{type:"monotone",dataKey:"netto_ertrag",stroke:"#f59e0b",strokeWidth:2,dot:{r:3},name:"netto_ertrag"})]})})})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Ertrags-Zusammensetzung"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(ot,{data:j,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({percent:p})=>`${(p*100).toFixed(0)}%`,children:j.map((p,m)=>e.jsx(We,{fill:qn[m]},`cell-${m}`))}),e.jsx(ae,{formatter:p=>`${p.toFixed(2)} ‚Ç¨`}),e.jsx(je,{})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"EV-Quote:"}),e.jsxs("span",{className:"font-medium",children:[r.eigenverbrauchsquote_prozent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]})]})]})]})]}),r.komponenten_beitraege&&r.komponenten_beitraege.length>0&&e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Komponenten-Beitr√§ge zur Finanzierung"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.komponenten_beitraege.map((p,m)=>{const g=Un[p.typ]||fe;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(g,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:p.bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500",children:p.beschreibung})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[p.beitrag_kwh_jahr.toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",p.beitrag_euro_jahr.toFixed(0)," ‚Ç¨/Jahr"]})]})]},m)})}),(r.speicher_ev_erhoehung_kwh>0||r.v2h_rueckspeisung_kwh>0||r.wp_pv_anteil_kwh>0)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.speicher_ev_erhoehung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Speicher EV+"}),e.jsxs("p",{className:"font-semibold",children:[r.speicher_ev_erhoehung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.speicher_ev_erhoehung_euro.toFixed(0)," ‚Ç¨"]})]}),r.v2h_rueckspeisung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"V2H-R√ºckspeisung"}),e.jsxs("p",{className:"font-semibold",children:[r.v2h_rueckspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.v2h_ersparnis_euro.toFixed(0)," ‚Ç¨"]})]}),r.eauto_ladung_pv_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"E-Auto PV-Ladung"}),e.jsxs("p",{className:"font-semibold",children:[r.eauto_ladung_pv_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.eauto_ersparnis_euro.toFixed(0)," ‚Ç¨"]})]}),r.wp_pv_anteil_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"WP PV-Direkt"}),e.jsxs("p",{className:"font-semibold",children:[r.wp_pv_anteil_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.wp_pv_ersparnis_euro.toFixed(0)," ‚Ç¨"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Strompreise"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Einspeiseverg√ºtung"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Netzbezugspreis"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:[r.netzbezug_preis_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ersparnis durch EV"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[(r.netzbezug_preis_cent_kwh-r.einspeiseverguetung_cent_kwh).toFixed(2)," ct/kWh"]})]})]})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Investition & ROI"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Investition gesamt"}),e.jsxs("span",{className:"font-semibold",children:[r.investition_gesamt_euro.toLocaleString("de-DE")," ‚Ç¨"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Bisherige Ertr√§ge"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," ‚Ç¨"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Prognose Jahres-Ertrag"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE")," ‚Ç¨/Jahr"]})]})]})]})]}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeisung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeise-Erl√∂s"}),e.jsx("th",{className:"text-right py-2 px-3",children:"EV-Ersparnis"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold",children:"Netto-Ertrag"})]})}),e.jsx("tbody",{children:r.monatswerte.map(p=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[p.monat_name," ",p.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[p.pv_erzeugung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[p.eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[p.einspeisung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[p.einspeise_erloes_euro.toFixed(2)," ‚Ç¨"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[p.ev_ersparnis_euro.toFixed(2)," ‚Ç¨"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[p.netto_ertrag_euro.toFixed(2)," ‚Ç¨"]})]},`${p.jahr}-${p.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_erzeugung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[r.jahres_einspeise_erloes_euro.toFixed(2)," ‚Ç¨"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[r.jahres_ev_ersparnis_euro.toFixed(2)," ‚Ç¨"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahres_netto_ertrag_euro.toFixed(2)," ‚Ç¨"]})]})})]})})]}),e.jsx(M,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function Qn(){var j;const t=$t(),[r,s]=d.useState("kurzfristig"),{anlagen:n,loading:a}=Ce(),[i,x]=d.useState(null),o=i??((j=n[0])==null?void 0:j.id);if(a)return e.jsx(pe,{text:"Lade Aussichten..."});if(n.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx(Y,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});const c=n.find(h=>h.id===o);if(!((c==null?void 0:c.latitude)&&(c==null?void 0:c.longitude)))return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsxs(M,{className:"text-center py-12",children:[e.jsx(re,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Standort nicht konfiguriert"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["F√ºr Prognosen werden die Koordinaten der Anlage ben√∂tigt.",e.jsx("br",{}),"Bitte konfiguriere den Standort in den Anlagen-Einstellungen."]}),e.jsxs(ee,{onClick:()=>t("/einstellungen/anlage"),children:["Anlage konfigurieren",e.jsx(Pe,{className:"h-4 w-4 ml-2"})]})]})]});const l=[{key:"kurzfristig",label:"Kurzfristig",icon:re},{key:"langfristig",label:"Langfristig",icon:st},{key:"trend",label:"Trend",icon:ke},{key:"finanzen",label:"Finanzen",icon:nt}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx("div",{className:"flex items-center gap-3",children:n.length>1&&e.jsx("select",{value:o??"",onChange:h=>x(Number(h.target.value)),className:"input w-auto",children:n.map(h=>e.jsx("option",{value:h.id,children:h.anlagenname},h.id))})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:l.map(h=>{const p=h.icon;return e.jsxs("button",{onClick:()=>s(h.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 ${r===h.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(p,{className:"h-4 w-4"}),h.label]},h.key)})})})]}),o&&e.jsxs(e.Fragment,{children:[r==="kurzfristig"&&e.jsx(Gn,{anlageId:o}),r==="langfristig"&&e.jsx(Jn,{anlageId:o}),r==="trend"&&e.jsx(Zn,{anlageId:o}),r==="finanzen"&&e.jsx(Yn,{anlageId:o})]})]})}const Xn=[{key:"strom",label:"Strom",icon:"‚ö°"},{key:"gas",label:"Gas",icon:"üî•"},{key:"wasser",label:"Wasser",icon:"üíß"}],Zt=()=>({name:"",kundennummer:"",portal_url:"",notizen:"",zaehler:[]}),ei=()=>({bezeichnung:"",nummer:"",notizen:""});function ti({value:t,onChange:r}){const[s,n]=d.useState({}),a=h=>{n(p=>({...p,[h]:!p[h]}))},i=(h,p)=>{const m={...t};p?m[h]=p:delete m[h],r(m)},x=h=>{i(h,Zt()),n(p=>({...p,[h]:!0}))},o=h=>{i(h,void 0)},c=(h,p,m)=>{const g=t[h]||Zt();i(h,{...g,[p]:m})},u=h=>{const p=t[h]||Zt();i(h,{...p,zaehler:[...p.zaehler,ei()]})},l=(h,p,m)=>{const g=t[h]||Zt(),v=[...g.zaehler];v[p]=m,i(h,{...g,zaehler:v})},j=(h,p)=>{const m=t[h]||Zt(),g=m.zaehler.filter((v,w)=>w!==p);i(h,{...m,zaehler:g})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Versorger & Z√§hler"}),e.jsx("div",{className:"space-y-3",children:Xn.map(({key:h,label:p,icon:m})=>{const g=t[h],v=s[h];return g?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer",onClick:()=>a(h),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v?e.jsx(ht,{className:"w-4 h-4 text-gray-500"}):e.jsx(rt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-lg",children:m}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:g.name||p}),g.zaehler.length>0&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",g.zaehler.length," Z√§hler)"]})]}),e.jsx("button",{type:"button",onClick:w=>{w.stopPropagation(),o(h)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Versorger entfernen",children:e.jsx(dt,{className:"w-4 h-4"})})]}),v&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Versorger-Name",value:g.name,onChange:w=>c(h,"name",w.target.value),placeholder:`z.B. Stadtwerke ${p}`}),e.jsx(L,{label:"Kundennummer",value:g.kundennummer,onChange:w=>c(h,"kundennummer",w.target.value),placeholder:"z.B. 12345678"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(L,{label:"Kundenportal-URL",value:g.portal_url||"",onChange:w=>c(h,"portal_url",w.target.value),placeholder:"https://kundenportal.beispiel.de"}),g.portal_url&&e.jsxs("a",{href:g.portal_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Xt,{className:"w-3 h-3"}),"Portal √∂ffnen"]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(L,{label:"Notizen",value:g.notizen||"",onChange:w=>c(h,"notizen",w.target.value),placeholder:"Optionale Anmerkungen..."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Z√§hler"}),e.jsxs(ee,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(h),children:[e.jsx(mt,{className:"w-4 h-4 mr-1"}),"Z√§hler"]})]}),g.zaehler.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Noch keine Z√§hler erfasst"}):e.jsx("div",{className:"space-y-2",children:g.zaehler.map((w,k)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(L,{label:"Bezeichnung",value:w.bezeichnung,onChange:N=>l(h,k,{...w,bezeichnung:N.target.value}),placeholder:h==="strom"?"z.B. Einspeisung":"z.B. Hauptz√§hler"}),e.jsx(L,{label:"Z√§hlernummer",value:w.nummer,onChange:N=>l(h,k,{...w,nummer:N.target.value}),placeholder:"z.B. 1EMH0012345678"}),e.jsx(L,{label:"Notizen",value:w.notizen||"",onChange:N=>l(h,k,{...w,notizen:N.target.value}),placeholder:"Optional..."})]}),e.jsx("button",{type:"button",onClick:()=>j(h,k),className:"p-2 text-gray-400 hover:text-red-500 transition-colors mt-6",title:"Z√§hler entfernen",children:e.jsx(dt,{className:"w-4 h-4"})})]},k))})]})]})]},h):e.jsxs("button",{type:"button",onClick:()=>x(h),className:"w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-400 hover:text-blue-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),e.jsxs("span",{children:[m," ",p,"-Versorger hinzuf√ºgen"]})]},h)})})]})}function zs({anlage:t,onSubmit:r,onCancel:s}){var w,k,N;const[n,a]=d.useState(!1),[i,x]=d.useState(null),[o,c]=d.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((w=t==null?void 0:t.leistung_kwp)==null?void 0:w.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((k=t==null?void 0:t.latitude)==null?void 0:k.toString())||"",longitude:((N=t==null?void 0:t.longitude)==null?void 0:N.toString())||"",mastr_id:(t==null?void 0:t.mastr_id)||"",wetter_provider:(t==null?void 0:t.wetter_provider)||"auto"}),[u,l]=d.useState((t==null?void 0:t.versorger_daten)||{}),[j,h]=d.useState([]),[p,m]=d.useState(!1);d.useEffect(()=>{t!=null&&t.id&&t.latitude&&t.longitude&&(m(!0),fr.getProvider(t.id).then(S=>h(S.provider)).catch(S=>console.warn("Wetter-Provider laden fehlgeschlagen:",S)).finally(()=>m(!1)))},[t==null?void 0:t.id,t==null?void 0:t.latitude,t==null?void 0:t.longitude]);const g=S=>{const{name:y,value:b}=S.target;c(W=>({...W,[y]:b}))},v=async S=>{if(S.preventDefault(),x(null),!o.anlagenname.trim()){x("Bitte einen Namen eingeben");return}if(!o.leistung_kwp||parseFloat(o.leistung_kwp)<=0){x("Bitte eine g√ºltige Leistung eingeben");return}try{a(!0),await r({anlagenname:o.anlagenname.trim(),leistung_kwp:parseFloat(o.leistung_kwp),installationsdatum:o.installationsdatum||void 0,standort_plz:o.standort_plz||void 0,standort_ort:o.standort_ort||void 0,standort_strasse:o.standort_strasse||void 0,latitude:o.latitude?parseFloat(o.latitude):void 0,longitude:o.longitude?parseFloat(o.longitude):void 0,mastr_id:o.mastr_id||void 0,versorger_daten:Object.keys(u).length>0?u:void 0,wetter_provider:o.wetter_provider})}catch(y){x(y instanceof Error?y.message:"Fehler beim Speichern")}finally{a(!1)}};return e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[i&&e.jsx(Y,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Anlagenname",name:"anlagenname",value:o.anlagenname,onChange:g,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(L,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:o.leistung_kwp,onChange:g,placeholder:"z.B. 10.5",required:!0}),e.jsx(L,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:o.installationsdatum,onChange:g})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen ‚Üí Investitionen"})," gepflegt. So k√∂nnen auch Anlagen mit mehreren Dachfl√§chen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(L,{label:"PLZ",name:"standort_plz",value:o.standort_plz,onChange:g,placeholder:"z.B. 12345"}),e.jsx(L,{label:"Ort",name:"standort_ort",value:o.standort_ort,onChange:g,placeholder:"z.B. Berlin"}),e.jsx(L,{label:"Stra√üe",name:"standort_strasse",value:o.standort_strasse,onChange:g,placeholder:"z.B. Musterstra√üe 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(f√ºr PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:o.latitude,onChange:g,placeholder:"z.B. 52.520008",hint:"N√∂rdliche Breite (positiv)"}),e.jsx(L,{label:"L√§ngengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:o.longitude,onChange:g,placeholder:"z.B. 13.404954",hint:"√ñstliche L√§nge (positiv)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Erweiterte Stammdaten"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(L,{label:"MaStR-ID",name:"mastr_id",value:o.mastr_id,onChange:g,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID der Anlage"}),o.mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${o.mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Xt,{className:"w-3 h-3"}),"Im MaStR √∂ffnen"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(St,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten-Quelle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"wetter_provider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bevorzugter Provider"}),e.jsx("select",{id:"wetter_provider",name:"wetter_provider",value:o.wetter_provider,onChange:g,disabled:p,className:"w-full px-3 py-2 rounded-lg border bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed border-gray-300 dark:border-gray-600",children:j.length>0?j.map(S=>e.jsxs("option",{value:S.id,disabled:!S.verfuegbar,children:[S.name,S.empfohlen?" (empfohlen)":"",S.verfuegbar?"":" (nicht verf√ºgbar)"]},S.id)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"auto",children:"Automatisch (empfohlen)"}),e.jsx("option",{value:"open-meteo",children:"Open-Meteo"}),e.jsx("option",{value:"brightsky",children:"Bright Sky (DWD)"}),e.jsx("option",{value:"open-meteo-solar",children:"Open-Meteo Solar"})]})})]}),e.jsx("div",{className:"flex items-end pb-1",children:e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o.wetter_provider==="auto"&&e.jsx("span",{children:"Automatische Auswahl: Bright Sky f√ºr DE, Open-Meteo sonst"}),o.wetter_provider==="brightsky"&&e.jsx("span",{children:"DWD-Daten √ºber Bright Sky API (nur Deutschland)"}),o.wetter_provider==="open-meteo"&&e.jsx("span",{children:"Open-Meteo Archive API (weltweit verf√ºgbar)"}),o.wetter_provider==="open-meteo-solar"&&e.jsx("span",{children:"GTI-Berechnung f√ºr geneigte PV-Module"})]})})]}),!(t!=null&&t.latitude)&&!(t!=null&&t.longitude)&&e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg flex gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Bitte zuerst Geokoordinaten eintragen, um die verf√ºgbaren Provider zu sehen."})]})]}),e.jsx(ti,{value:u,onChange:l}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(ee,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(ee,{type:"submit",loading:n,children:t?"Speichern":"Anlage erstellen"})]})]})}function ri(){const{anlagen:t,loading:r,error:s,createAnlage:n,updateAnlage:a,deleteAnlage:i}=Ce(),[x,o]=d.useState(!1),[c,u]=d.useState(null),[l,j]=d.useState(null),h=async g=>{await n(g),o(!1)},p=async g=>{c&&(await a(c.id,g),u(null))},m=async()=>{l&&(await i(l.id),j(null))};return r?e.jsx(pe,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(ee,{onClick:()=>o(!0),children:[e.jsx(mt,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),s&&e.jsx(Y,{type:"error",children:s}),t.length===0?e.jsx(M,{children:e.jsx(Bt,{icon:re,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(ee,{onClick:()=>o(!0),children:"Erste Anlage anlegen"})})}):e.jsx(M,{padding:"none",children:e.jsxs(Jr,{children:[e.jsx(Zr,{children:e.jsxs(Kt,{children:[e.jsx(De,{children:"Name"}),e.jsx(De,{children:"Leistung"}),e.jsx(De,{children:"Standort"}),e.jsx(De,{children:"Ausrichtung"}),e.jsx(De,{children:"Installation"}),e.jsx(De,{className:"text-right",children:"Aktionen"})]})}),e.jsx(qr,{children:t.map(g=>e.jsxs(Kt,{children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:g.anlagenname})]})}),e.jsxs(Ve,{children:[e.jsx("span",{className:"font-mono",children:g.leistung_kwp})," kWp"]}),e.jsx(Ve,{children:g.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(yr,{className:"h-4 w-4"}),g.standort_plz," ",g.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(Ve,{children:[g.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),g.neigung_grad&&` / ${g.neigung_grad}¬∞`]}),e.jsx(Ve,{children:g.installationsdatum?new Date(g.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(Ve,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=gt.getPdfExportUrl(g.id)},title:"PDF-Dokumentation (Gesamtzeitraum)",children:e.jsx(kr,{className:"h-4 w-4 text-orange-500"})}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=gt.getFullExportUrl(g.id)},title:"Export (JSON)",children:e.jsx(qe,{className:"h-4 w-4 text-blue-500"})}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>u(g),children:e.jsx(Hr,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>j(g),children:e.jsx(dt,{className:"h-4 w-4 text-red-500"})})]})})]},g.id))})]})}),e.jsx(tt,{isOpen:x,onClose:()=>o(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(zs,{onSubmit:h,onCancel:()=>o(!1)})}),e.jsx(tt,{isOpen:!!c,onClose:()=>u(null),title:"Anlage bearbeiten",size:"lg",children:c&&e.jsx(zs,{anlage:c,onSubmit:p,onCancel:()=>u(null)})}),e.jsx(tt,{isOpen:!!l,onClose:()=>j(null),title:"Anlage l√∂schen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["M√∂chtest du die Anlage ",e.jsxs("strong",{children:['"',l==null?void 0:l.anlagenname,'"']})," wirklich l√∂schen?"]}),e.jsx(Y,{type:"warning",children:"Alle zugeh√∂rigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gel√∂scht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(ee,{variant:"secondary",onClick:()=>j(null),children:"Abbrechen"}),e.jsx(ee,{variant:"danger",onClick:m,children:"L√∂schen"})]})]})})]})}function si(){var H;const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(null),a=s??((H=t[0])==null?void 0:H.id),{strompreise:i,loading:x,error:o,createStrompreis:c,updateStrompreis:u,deleteStrompreis:l}=Ya(a),[j,h]=d.useState(!1),[p,m]=d.useState(null),[g,v]=d.useState(null),[w,k]=d.useState(null),N=async P=>{try{k(null),await c(P),h(!1)}catch(Z){k(Z instanceof Error?Z.message:"Fehler beim Erstellen")}},S=async P=>{if(p)try{k(null),await u(p.id,P),m(null)}catch(Z){k(Z instanceof Error?Z.message:"Fehler beim Aktualisieren")}},y=async()=>{if(g)try{await l(g.id),v(null)}catch(P){k(P instanceof Error?P.message:"Fehler beim L√∂schen")}},b=P=>{const Z=new Date().toISOString().split("T")[0],C=P.gueltig_ab<=Z,f=!P.gueltig_bis||P.gueltig_bis>=Z;return C&&f};if(r||x)return e.jsx(pe,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(Y,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const W=[...i].sort((P,Z)=>{const C=b(P),f=b(Z);return C!==f?C?-1:1:Z.gueltig_ab.localeCompare(P.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:a??"",onChange:P=>n(Number(P.target.value)),className:"input w-auto",children:t.map(P=>e.jsx("option",{value:P.id,children:P.anlagenname},P.id))}),e.jsxs(ee,{onClick:()=>h(!0),children:[e.jsx(mt,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),o&&e.jsx(Y,{type:"error",children:o}),W.length>0&&b(W[0])&&e.jsx(M,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(it,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",W[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[W[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," ¬∑ ","Einspeisung: ",e.jsxs("strong",{children:[W[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),W[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" ¬∑ Grundpreis: ",e.jsxs("strong",{children:[W[0].grundpreis_euro_monat.toFixed(2)," ‚Ç¨/Monat"]})]})]})]})]})}),i.length===0?e.jsx(M,{children:e.jsx(Bt,{icon:xe,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(ee,{onClick:()=>h(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(M,{padding:"none",children:e.jsxs(Jr,{children:[e.jsx(Zr,{children:e.jsxs(Kt,{children:[e.jsx(De,{children:"Tarif"}),e.jsx(De,{children:"Netzbezug"}),e.jsx(De,{children:"Einspeisung"}),e.jsx(De,{children:"Grundpreis"}),e.jsx(De,{children:"G√ºltigkeit"}),e.jsx(De,{className:"text-right",children:"Aktionen"})]})}),e.jsx(qr,{children:W.map(P=>{const Z=b(P);return e.jsxs(Kt,{className:Z?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:`h-5 w-5 ${Z?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:P.tarifname||"Standard"}),Z&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),P.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:P.anbieter})]})]})}),e.jsxs(Ve,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:P.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(Ve,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:P.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(Ve,{children:P.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:P.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ‚Ç¨/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(st,{className:"h-4 w-4"}),new Date(P.gueltig_ab).toLocaleDateString("de-DE"),P.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(P.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(Ve,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>m(P),children:e.jsx(Hr,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>v(P),children:e.jsx(dt,{className:"h-4 w-4 text-red-500"})})]})})]},P.id)})})]})}),e.jsxs(M,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell g√ºltige Tarif wird automatisch f√ºr Berechnungen verwendet"}),e.jsx("li",{children:"F√ºr historische Auswertungen werden die zum jeweiligen Zeitpunkt g√ºltigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und G√ºltigkeitszeitraum korrekt setzen"})]})]}),e.jsx(tt,{isOpen:j,onClose:()=>{h(!1),k(null)},title:"Neuen Tarif anlegen",size:"lg",children:a&&e.jsx(Ss,{anlageId:a,onCreate:N,onCancel:()=>{h(!1),k(null)},error:w})}),e.jsx(tt,{isOpen:!!p,onClose:()=>{m(null),k(null)},title:"Tarif bearbeiten",size:"lg",children:p&&e.jsx(Ss,{strompreis:p,anlageId:p.anlage_id,onUpdate:S,onCancel:()=>{m(null),k(null)},error:w})}),e.jsx(tt,{isOpen:!!g,onClose:()=>v(null),title:"Tarif l√∂schen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["M√∂chtest du den Tarif ",e.jsxs("strong",{children:['"',(g==null?void 0:g.tarifname)||"Standard",'"']})," wirklich l√∂schen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(ee,{variant:"secondary",onClick:()=>v(null),children:"Abbrechen"}),e.jsx(ee,{variant:"danger",onClick:y,children:"L√∂schen"})]})]})})]})}function Ss({strompreis:t,anlageId:r,onCreate:s,onUpdate:n,onCancel:a,error:i}){var h,p,m;const[x,o]=d.useState(!1),[c,u]=d.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((h=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:h.toString())||"30",einspeiseverguetung_cent_kwh:((p=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:p.toString())||"8.2",grundpreis_euro_monat:((m=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:m.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||""}),l=g=>{const{name:v,value:w}=g.target;u(k=>({...k,[v]:w}))},j=async g=>{g.preventDefault(),o(!0);try{const v={netzbezug_arbeitspreis_cent_kwh:parseFloat(c.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(c.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:c.grundpreis_euro_monat?parseFloat(c.grundpreis_euro_monat):void 0,gueltig_ab:c.gueltig_ab,gueltig_bis:c.gueltig_bis||void 0,tarifname:c.tarifname||void 0,anbieter:c.anbieter||void 0,vertragsart:c.vertragsart||void 0};t&&n?await n(v):s&&await s({...v,anlage_id:r})}finally{o(!1)}};return e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[i&&e.jsx(Y,{type:"error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Tarifname",name:"tarifname",value:c.tarifname,onChange:l,placeholder:"z.B. Grundversorgung, √ñko-Strom"}),e.jsx(L,{label:"Anbieter",name:"anbieter",value:c.anbieter,onChange:l,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(L,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:c.netzbezug_arbeitspreis_cent_kwh,onChange:l,required:!0,hint:"Arbeitspreis f√ºr Strombezug"}),e.jsx(L,{label:"Einspeiseverg√ºtung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:c.einspeiseverguetung_cent_kwh,onChange:l,required:!0,hint:"EEG-Verg√ºtung oder PPA-Preis"}),e.jsx(L,{label:"Grundpreis (‚Ç¨/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:c.grundpreis_euro_monat,onChange:l,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"G√ºltigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"G√ºltig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:c.gueltig_ab,onChange:l,required:!0}),e.jsx(L,{label:"G√ºltig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:c.gueltig_bis,onChange:l,hint:"Leer lassen f√ºr unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:c.vertragsart,onChange:l,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte w√§hlen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"√ñkostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(ee,{type:"button",variant:"secondary",onClick:a,children:"Abbrechen"}),e.jsx(ee,{type:"submit",loading:x,children:t?"Speichern":"Anlegen"})]})]})}function ai({typ:t,paramData:r,onChange:s,anlage:n,hasParent:a}){const[i,x]=d.useState(!1),[o,c]=d.useState(!1),u=a,l="Wechselrichter";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ger√§tedaten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Hersteller",name:"param_stamm_hersteller",value:r.stamm_hersteller||"",onChange:s,placeholder:"z.B. Fronius, BYD, Longi"}),e.jsx(L,{label:"Modell",name:"param_stamm_modell",value:r.stamm_modell||"",onChange:s,placeholder:"z.B. Symo GEN24 10.0"}),e.jsx(L,{label:"Seriennummer",name:"param_stamm_seriennummer",value:r.stamm_seriennummer||"",onChange:s,placeholder:t==="pv-module"?"z.B. SN001-SN020":"z.B. ABC123456"}),e.jsx(L,{label:"Garantie bis",name:"param_stamm_garantie_bis",type:"date",value:r.stamm_garantie_bis||"",onChange:s}),t==="wechselrichter"&&e.jsxs("div",{children:[e.jsx(L,{label:"MaStR-ID",name:"param_stamm_mastr_id",value:r.stamm_mastr_id||"",onChange:s,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID des Wechselrichters"}),r.stamm_mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${r.stamm_mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Xt,{className:"w-3 h-3"}),"Im MaStR √∂ffnen"]})]}),t==="speicher"&&e.jsx(L,{label:"Garantie-Zyklen",name:"param_stamm_garantie_zyklen",type:"number",value:r.stamm_garantie_zyklen||"",onChange:s,placeholder:"z.B. 6000",hint:"Garantierte Ladezyklen"}),t==="pv-module"&&e.jsx(L,{label:"Leistungsgarantie (%)",name:"param_stamm_garantie_leistung_prozent",type:"number",min:"0",max:"100",value:r.stamm_garantie_leistung_prozent||"",onChange:s,placeholder:"z.B. 80",hint:"Garantierte Mindestleistung nach 25 Jahren"}),t==="e-auto"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{label:"Kennzeichen",name:"param_stamm_kennzeichen",value:r.stamm_kennzeichen||"",onChange:s,placeholder:"z.B. M-EE 1234"}),e.jsx(L,{label:"Fahrgestellnummer (VIN)",name:"param_stamm_fahrgestellnummer",value:r.stamm_fahrgestellnummer||"",onChange:s,placeholder:"z.B. WVWZZZ..."}),e.jsx(L,{label:"Erstzulassung",name:"param_stamm_erstzulassung",type:"date",value:r.stamm_erstzulassung||"",onChange:s}),e.jsx(L,{label:"Garantie Batterie (km)",name:"param_stamm_garantie_batterie_km",type:"number",value:r.stamm_garantie_batterie_km||"",onChange:s,placeholder:"z.B. 160000"})]}),(t==="waermepumpe"||t==="e-auto")&&e.jsxs(e.Fragment,{children:[e.jsx(L,{label:"F√∂rderung Aktenzeichen",name:"param_stamm_foerderung_aktenzeichen",value:r.stamm_foerderung_aktenzeichen||"",onChange:s,placeholder:"z.B. BAFA-2024-12345"}),e.jsx(L,{label:"F√∂rderbetrag (‚Ç¨)",name:"param_stamm_foerderung_betrag_euro",type:"number",value:r.stamm_foerderung_betrag_euro||"",onChange:s,placeholder:"z.B. 5000"})]}),t==="balkonkraftwerk"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{label:"Anmeldung Netzbetreiber",name:"param_stamm_anmeldung_netzbetreiber",type:"date",value:r.stamm_anmeldung_netzbetreiber||"",onChange:s}),e.jsx(L,{label:"Anmeldung MaStR",name:"param_stamm_anmeldung_marktstammdaten",type:"date",value:r.stamm_anmeldung_marktstammdaten||"",onChange:s})]})]}),e.jsx("div",{children:e.jsx(L,{label:"Notizen",name:"param_stamm_notizen",value:r.stamm_notizen||"",onChange:s,placeholder:"Optionale Anmerkungen zu diesem Ger√§t..."})})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>x(!i),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(ht,{className:"w-4 h-4 text-gray-500"}):e.jsx(rt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ansprechpartner"}),u&&!ni(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",l,")"]})]})}),i&&e.jsxs("div",{className:"p-4 space-y-4",children:[u&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder √ºbernehmen automatisch die Werte von ",l,". Nur bei Abweichung ausf√ºllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Firma",name:"param_ansprechpartner_firma",value:r.ansprechpartner_firma||"",onChange:s,placeholder:n?`(${l})`:"z.B. Solar Mustermann GmbH"}),e.jsx(L,{label:"Name",name:"param_ansprechpartner_name",value:r.ansprechpartner_name||"",onChange:s,placeholder:"Kontaktperson"}),e.jsx(L,{label:"Telefon",name:"param_ansprechpartner_telefon",value:r.ansprechpartner_telefon||"",onChange:s,placeholder:"+49 123 456789"}),e.jsx(L,{label:"E-Mail",name:"param_ansprechpartner_email",type:"email",value:r.ansprechpartner_email||"",onChange:s,placeholder:"service@beispiel.de"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(L,{label:"Ticketsystem / Support-Portal",name:"param_ansprechpartner_ticketsystem",value:r.ansprechpartner_ticketsystem||"",onChange:s,placeholder:"https://support.beispiel.de"}),r.ansprechpartner_ticketsystem&&e.jsxs("a",{href:r.ansprechpartner_ticketsystem,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Xt,{className:"w-3 h-3"}),"Portal √∂ffnen"]})]}),e.jsx(L,{label:"Kundennummer",name:"param_ansprechpartner_kundennummer",value:r.ansprechpartner_kundennummer||"",onChange:s,placeholder:"z.B. K-12345"}),e.jsx(L,{label:"Vertragsnummer",name:"param_ansprechpartner_vertragsnummer",value:r.ansprechpartner_vertragsnummer||"",onChange:s,placeholder:"z.B. V-2024-001"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(L,{label:"Notizen",name:"param_ansprechpartner_notizen",value:r.ansprechpartner_notizen||"",onChange:s,placeholder:"Optionale Anmerkungen..."})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>c(!o),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsx(ht,{className:"w-4 h-4 text-gray-500"}):e.jsx(rt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wartungsvertrag"}),u&&!ii(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",l,")"]})]})}),o&&e.jsxs("div",{className:"p-4 space-y-4",children:[u&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder √ºbernehmen automatisch die Werte von ",l,". Nur bei Abweichung ausf√ºllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Vertragsnummer",name:"param_wartung_vertragsnummer",value:r.wartung_vertragsnummer||"",onChange:s,placeholder:"z.B. WV-2024-001"}),e.jsx(L,{label:"Anbieter",name:"param_wartung_anbieter",value:r.wartung_anbieter||"",onChange:s,placeholder:"z.B. Solar Mustermann GmbH"}),e.jsx(L,{label:"G√ºltig bis",name:"param_wartung_gueltig_bis",type:"date",value:r.wartung_gueltig_bis||"",onChange:s}),e.jsx(L,{label:"K√ºndigungsfrist",name:"param_wartung_kuendigungsfrist",value:r.wartung_kuendigungsfrist||"",onChange:s,placeholder:"z.B. 3 Monate zum Jahresende"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(L,{label:"Leistungsumfang",name:"param_wartung_leistungsumfang",value:r.wartung_leistungsumfang||"",onChange:s,placeholder:"z.B. J√§hrliche Inspektion, Reinigung, Fern√ºberwachung"})})]})]})]})]})}function ni(t){return["ansprechpartner_firma","ansprechpartner_name","ansprechpartner_telefon","ansprechpartner_email","ansprechpartner_ticketsystem","ansprechpartner_kundennummer","ansprechpartner_vertragsnummer","ansprechpartner_notizen"].some(s=>t[s]&&String(t[s]).trim()!=="")}function ii(t){return["wartung_vertragsnummer","wartung_anbieter","wartung_gueltig_bis","wartung_kuendigungsfrist","wartung_leistungsumfang"].some(s=>t[s]&&String(t[s]).trim()!=="")}const li={"pv-module":"wechselrichter",speicher:"wechselrichter"},di=["pv-module"],gr={wechselrichter:"Wechselrichter"},Fr={"e-auto":"E-Auto",waermepumpe:"W√§rmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},ci={"e-auto":"Kosten eines vergleichbaren Verbrenners (f√ºr ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/√ñlheizung (f√ºr ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function oi({investition:t,anlageId:r,typ:s,anlage:n,onSubmit:a,onCancel:i}){var P,Z,C,f,$,K;const[x,o]=d.useState(!1),[c,u]=d.useState(null),[l,j]=d.useState([]),[h,p]=d.useState(!1),[m,g]=d.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${Fr[s]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((P=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:P.toString())||"",anschaffungskosten_alternativ:((Z=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:Z.toString())||"",betriebskosten_jahr:((C=t==null?void 0:t.betriebskosten_jahr)==null?void 0:C.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,parent_investition_id:((f=t==null?void 0:t.parent_investition_id)==null?void 0:f.toString())||"",leistung_kwp:(($=t==null?void 0:t.leistung_kwp)==null?void 0:$.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"S√ºd",neigung_grad:((K=t==null?void 0:t.neigung_grad)==null?void 0:K.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""}),v=li[s],w=di.includes(s);d.useEffect(()=>{v&&(p(!0),Fe.list(r,v,!0).then(O=>j(O.filter(X=>X.id!==(t==null?void 0:t.id)))).catch(()=>j([])).finally(()=>p(!1)))},[v,r,t==null?void 0:t.id]);const k=(t==null?void 0:t.parameter)||{},N=()=>{var O,X,Q,_,F,I,q,ne,G,B,he,Ne,_e,ie,D,A,T,ue,ye,me,E,V,te,Me,ze,Tt,Rt,Ht,Gt;return{stamm_hersteller:((O=k.stamm_hersteller)==null?void 0:O.toString())||"",stamm_modell:((X=k.stamm_modell)==null?void 0:X.toString())||"",stamm_seriennummer:((Q=k.stamm_seriennummer)==null?void 0:Q.toString())||"",stamm_garantie_bis:((_=k.stamm_garantie_bis)==null?void 0:_.toString())||"",stamm_notizen:((F=k.stamm_notizen)==null?void 0:F.toString())||"",stamm_mastr_id:((I=k.stamm_mastr_id)==null?void 0:I.toString())||"",stamm_garantie_zyklen:((q=k.stamm_garantie_zyklen)==null?void 0:q.toString())||"",stamm_garantie_leistung_prozent:((ne=k.stamm_garantie_leistung_prozent)==null?void 0:ne.toString())||"",stamm_kennzeichen:((G=k.stamm_kennzeichen)==null?void 0:G.toString())||"",stamm_fahrgestellnummer:((B=k.stamm_fahrgestellnummer)==null?void 0:B.toString())||"",stamm_erstzulassung:((he=k.stamm_erstzulassung)==null?void 0:he.toString())||"",stamm_garantie_batterie_km:((Ne=k.stamm_garantie_batterie_km)==null?void 0:Ne.toString())||"",stamm_foerderung_aktenzeichen:((_e=k.stamm_foerderung_aktenzeichen)==null?void 0:_e.toString())||"",stamm_foerderung_betrag_euro:((ie=k.stamm_foerderung_betrag_euro)==null?void 0:ie.toString())||"",stamm_anmeldung_netzbetreiber:((D=k.stamm_anmeldung_netzbetreiber)==null?void 0:D.toString())||"",stamm_anmeldung_marktstammdaten:((A=k.stamm_anmeldung_marktstammdaten)==null?void 0:A.toString())||"",ansprechpartner_firma:((T=k.ansprechpartner_firma)==null?void 0:T.toString())||"",ansprechpartner_name:((ue=k.ansprechpartner_name)==null?void 0:ue.toString())||"",ansprechpartner_telefon:((ye=k.ansprechpartner_telefon)==null?void 0:ye.toString())||"",ansprechpartner_email:((me=k.ansprechpartner_email)==null?void 0:me.toString())||"",ansprechpartner_ticketsystem:((E=k.ansprechpartner_ticketsystem)==null?void 0:E.toString())||"",ansprechpartner_kundennummer:((V=k.ansprechpartner_kundennummer)==null?void 0:V.toString())||"",ansprechpartner_vertragsnummer:((te=k.ansprechpartner_vertragsnummer)==null?void 0:te.toString())||"",ansprechpartner_notizen:((Me=k.ansprechpartner_notizen)==null?void 0:Me.toString())||"",wartung_vertragsnummer:((ze=k.wartung_vertragsnummer)==null?void 0:ze.toString())||"",wartung_anbieter:((Tt=k.wartung_anbieter)==null?void 0:Tt.toString())||"",wartung_gueltig_bis:((Rt=k.wartung_gueltig_bis)==null?void 0:Rt.toString())||"",wartung_kuendigungsfrist:((Ht=k.wartung_kuendigungsfrist)==null?void 0:Ht.toString())||"",wartung_leistungsumfang:((Gt=k.wartung_leistungsumfang)==null?void 0:Gt.toString())||""}},S=()=>{var X,Q,_,F,I,q,ne,G,B,he,Ne,_e,ie,D,A,T,ue,ye,me,E,V,te,Me,ze,Tt,Rt,Ht,Gt,es,ts,rs,ss,as,ns,is,ls,ds,cs;const O=N();switch(s){case"e-auto":return{...O,batteriekapazitaet_kwh:((X=k.batteriekapazitaet_kwh)==null?void 0:X.toString())||"",verbrauch_kwh_100km:((Q=k.verbrauch_kwh_100km)==null?void 0:Q.toString())||"18",jahresfahrleistung_km:((_=k.jahresfahrleistung_km)==null?void 0:_.toString())||"15000",pv_ladeanteil_prozent:((F=k.pv_ladeanteil_prozent)==null?void 0:F.toString())||"60",vergleich_verbrauch_l_100km:((I=k.vergleich_verbrauch_l_100km)==null?void 0:I.toString())||"7.5",benzinpreis_euro:((q=k.benzinpreis_euro)==null?void 0:q.toString())||"1.65",v2h_faehig:k.v2h_faehig??!1,v2h_entladeleistung_kw:((ne=k.v2h_entladeleistung_kw)==null?void 0:ne.toString())||""};case"speicher":return{...O,kapazitaet_kwh:((G=k.kapazitaet_kwh)==null?void 0:G.toString())||"",nutzbare_kapazitaet_kwh:((B=k.nutzbare_kapazitaet_kwh)==null?void 0:B.toString())||"",max_ladeleistung_kw:((he=k.max_ladeleistung_kw)==null?void 0:he.toString())||"",max_entladeleistung_kw:((Ne=k.max_entladeleistung_kw)==null?void 0:Ne.toString())||"",wirkungsgrad_prozent:((_e=k.wirkungsgrad_prozent)==null?void 0:_e.toString())||"95",arbitrage_faehig:k.arbitrage_faehig??!1};case"waermepumpe":return{...O,leistung_kw:((ie=k.leistung_kw)==null?void 0:ie.toString())||"",effizienz_modus:((D=k.effizienz_modus)==null?void 0:D.toString())||"gesamt_jaz",jaz:((A=k.jaz)==null?void 0:A.toString())||"3.5",scop_heizung:((T=k.scop_heizung)==null?void 0:T.toString())||"4.5",scop_warmwasser:((ue=k.scop_warmwasser)==null?void 0:ue.toString())||"3.2",vorlauftemperatur:((ye=k.vorlauftemperatur)==null?void 0:ye.toString())||"35",cop_heizung:((me=k.cop_heizung)==null?void 0:me.toString())||"3.9",cop_warmwasser:((E=k.cop_warmwasser)==null?void 0:E.toString())||"3.0",heizwaermebedarf_kwh:((V=k.heizwaermebedarf_kwh)==null?void 0:V.toString())||"12000",warmwasserbedarf_kwh:((te=k.warmwasserbedarf_kwh)==null?void 0:te.toString())||"3000",pv_anteil_prozent:((Me=k.pv_anteil_prozent)==null?void 0:Me.toString())||"30",alter_energietraeger:((ze=k.alter_energietraeger)==null?void 0:ze.toString())||"gas",alter_preis_cent_kwh:((Tt=k.alter_preis_cent_kwh)==null?void 0:Tt.toString())||"12",sg_ready:k.sg_ready??!1};case"wallbox":return{...O,max_ladeleistung_kw:((Rt=k.max_ladeleistung_kw)==null?void 0:Rt.toString())||"11",bidirektional:k.bidirektional??!1,pv_optimiert:k.pv_optimiert??!0};case"wechselrichter":return{...O,max_leistung_kw:((Ht=k.max_leistung_kw)==null?void 0:Ht.toString())||"",wirkungsgrad_prozent:((Gt=k.wirkungsgrad_prozent)==null?void 0:Gt.toString())||"97",hybrid:k.hybrid??!1};case"pv-module":return{...O,anzahl_module:((es=k.anzahl_module)==null?void 0:es.toString())||"",modul_leistung_wp:((ts=k.modul_leistung_wp)==null?void 0:ts.toString())||"",modul_typ:((rs=k.modul_typ)==null?void 0:rs.toString())||""};case"balkonkraftwerk":return{...O,leistung_wp:((ss=k.leistung_wp)==null?void 0:ss.toString())||"",anzahl:((as=k.anzahl)==null?void 0:as.toString())||"2",ausrichtung:((ns=k.ausrichtung)==null?void 0:ns.toString())||"S√ºd",neigung_grad:((is=k.neigung_grad)==null?void 0:is.toString())||"30",hat_speicher:k.hat_speicher??!1,speicher_kapazitaet_wh:((ls=k.speicher_kapazitaet_wh)==null?void 0:ls.toString())||""};case"sonstiges":return{...O,kategorie:((ds=k.kategorie)==null?void 0:ds.toString())||"erzeuger",beschreibung:((cs=k.beschreibung)==null?void 0:cs.toString())||""};default:return O}},[y,b]=d.useState(S),W=O=>{const{name:X,value:Q,type:_,checked:F}=O.target;if(X.startsWith("param_")){const I=X.replace("param_","");b(q=>({...q,[I]:_==="checkbox"?F:Q}))}else g(I=>({...I,[X]:_==="checkbox"?F:Q}))},H=async O=>{if(O.preventDefault(),u(null),!m.bezeichnung.trim()){u("Bitte eine Bezeichnung eingeben");return}try{o(!0);const X=["stamm_garantie_bis","stamm_erstzulassung","wartung_gueltig_bis","stamm_anmeldung_netzbetreiber","stamm_anmeldung_marktstammdaten"],Q={};if(Object.entries(y).forEach(([ne,G])=>{if(typeof G=="boolean")Q[ne]=G;else if(G!=="")if(X.includes(ne))Q[ne]=G;else{const B=parseFloat(G);Q[ne]=isNaN(B)?G:B}}),w&&l.length>0&&!m.parent_investition_id){u(`${Fr[s]} m√ºssen einem ${gr[v]||v} zugeordnet werden`);return}let _,F,I;if(s==="balkonkraftwerk"){const ne=parseInt(y.anzahl)||0,G=parseInt(y.leistung_wp)||0;ne>0&&G>0&&(_=ne*G/1e3),F=y.ausrichtung||void 0,I=y.neigung_grad?parseFloat(y.neigung_grad):void 0}const q={...t?{}:{anlage_id:r,typ:s},bezeichnung:m.bezeichnung.trim(),anschaffungsdatum:m.anschaffungsdatum||void 0,anschaffungskosten_gesamt:m.anschaffungskosten_gesamt?parseFloat(m.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:m.anschaffungskosten_alternativ?parseFloat(m.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:m.betriebskosten_jahr?parseFloat(m.betriebskosten_jahr):void 0,aktiv:m.aktiv,parameter:Object.keys(Q).length>0?Q:void 0,parent_investition_id:m.parent_investition_id?parseInt(m.parent_investition_id):void 0,...s==="pv-module"&&{leistung_kwp:m.leistung_kwp?parseFloat(m.leistung_kwp):void 0,ausrichtung:m.ausrichtung||void 0,neigung_grad:m.neigung_grad?parseFloat(m.neigung_grad):void 0,ha_entity_id:m.ha_entity_id||void 0},...s==="balkonkraftwerk"&&{leistung_kwp:_,ausrichtung:F,neigung_grad:I}};await a(q)}catch(X){u(X instanceof Error?X.message:"Fehler beim Speichern")}finally{o(!1)}};return e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[c&&e.jsx(Y,{type:"error",children:c}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Bezeichnung",name:"bezeichnung",value:m.bezeichnung,onChange:W,required:!0}),e.jsx(L,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:m.anschaffungsdatum,onChange:W}),e.jsx(L,{label:"Anschaffungskosten (‚Ç¨)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:m.anschaffungskosten_gesamt,onChange:W,hint:"Gesamtkosten inkl. Installation"}),e.jsx(L,{label:"Alternative Kosten (‚Ç¨)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:m.anschaffungskosten_alternativ,onChange:W,hint:ci[s]}),e.jsx(L,{label:"Betriebskosten/Jahr (‚Ç¨)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:m.betriebskosten_jahr,onChange:W,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:m.aktiv,onChange:W,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen ber√ºcksichtigen)"})]})]}),v&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Geh√∂rt zu (",gr[v]||v,")",w?" *":" (optional)",h&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),l.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:m.parent_investition_id,onChange:O=>g(X=>({...X,parent_investition_id:O.target.value})),className:`input w-full ${w&&!m.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:w,children:[e.jsx("option",{value:"",children:w?"-- Bitte w√§hlen --":"-- Keine Zuordnung --"}),l.map(O=>e.jsx("option",{value:O.id,children:O.bezeichnung},O.id))]}),w&&!m.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Ie,{className:"w-4 h-4"}),s==="pv-module"?"PV-Module m√ºssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):h?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 flex-shrink-0"}),w?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:gr[v]||v})," an, bevor Sie ",Fr[s]," erstellen k√∂nnen."]}):e.jsxs("span",{children:["Kein ",gr[v]||v," vorhanden. Zuordnung ist optional."]})]})})]})]}),s==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:m.leistung_kwp,onChange:W,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:m.ausrichtung,onChange:O=>g(X=>({...X,ausrichtung:O.target.value})),className:"input w-full",children:[e.jsx("option",{value:"S√ºd",children:"S√ºd (0¬∞)"}),e.jsx("option",{value:"S√ºdost",children:"S√ºdost (-45¬∞)"}),e.jsx("option",{value:"Ost",children:"Ost (-90¬∞)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135¬∞)"}),e.jsx("option",{value:"Nord",children:"Nord (180¬∞)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135¬∞)"}),e.jsx("option",{value:"West",children:"West (90¬∞)"}),e.jsx("option",{value:"S√ºdwest",children:"S√ºdwest (45¬∞)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(L,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:m.neigung_grad,onChange:W,hint:"0¬∞ = flach, 90¬∞ = senkrecht"})]})]}),e.jsx(gi,{typ:s,paramData:y,onChange:W}),e.jsx(ai,{typ:s,paramData:y,onChange:W,anlage:n,hasParent:!!m.parent_investition_id}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(ee,{type:"button",variant:"secondary",onClick:i,children:"Abbrechen"}),e.jsx(ee,{type:"submit",loading:x,children:t?"Speichern":"Erstellen"})]})]})}function gi({typ:t,paramData:r,onChange:s}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Batteriekapazit√§t (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.batteriekapazitaet_kwh,onChange:s}),e.jsx(L,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:r.verbrauch_kwh_100km,onChange:s}),e.jsx(L,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:r.jahresfahrleistung_km,onChange:s}),e.jsx(L,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_ladeanteil_prozent,onChange:s,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:r.vergleich_verbrauch_l_100km,onChange:s,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(L,{label:"Benzinpreis (‚Ç¨/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:r.benzinpreis_euro,onChange:s,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:r.v2h_faehig,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-f√§hig (Vehicle-to-Home)"})]}),r.v2h_faehig&&e.jsx(L,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.v2h_entladeleistung_kw,onChange:s})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Kapazit√§t (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.kapazitaet_kwh,onChange:s}),e.jsx(L,{label:"Nutzbare Kapazit√§t (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.nutzbare_kapazitaet_kwh,onChange:s,hint:"Typisch 90-95% der Gesamtkapazit√§t"}),e.jsx(L,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:s}),e.jsx(L,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_entladeleistung_kw,onChange:s}),e.jsx(L,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:s})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:r.arbitrage_faehig,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-f√§hig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":{const a=r.effizienz_modus;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"W√§rmepumpe Parameter"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Berechnungsmodus f√ºr Effizienz"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"gesamt_jaz",checked:a==="gesamt_jaz",onChange:s,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Jahresarbeitszahl (JAZ) - Gemessen vor Ort"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"scop",checked:a==="scop",onChange:s,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"SCOP (EU-Energielabel) - Aus Datenblatt"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"getrennte_cops",checked:a==="getrennte_cops",onChange:s,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Getrennte COPs (Heizung/Warmwasser)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a==="getrennte_cops"?"Separate COPs f√ºr Heizung (~3,9) und Warmwasser (~3,0) - pr√§ziser bei unterschiedlichen Betriebspunkten":a==="scop"?"EU-genormter SCOP vom Energielabel - realistischer als Hersteller-COP, aber standortunabh√§ngig":"Gemessene Jahresarbeitszahl am eigenen Standort - der genaueste Wert, wenn verf√ºgbar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:r.leistung_kw,onChange:s,hint:"Thermische Leistung"}),a==="gesamt_jaz"&&e.jsx(L,{label:"Jahresarbeitszahl (JAZ)",name:"param_jaz",type:"number",step:"0.1",min:"1",max:"10",value:r.jaz,onChange:s,hint:"Typisch 3-4 f√ºr Luft-WP, 4-5 f√ºr Sole-WP",required:!0}),a==="scop"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{label:"SCOP Heizung",name:"param_scop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.scop_heizung,onChange:s,hint:"Vom EU-Energielabel (z.B. 4,5)",required:!0}),e.jsx(L,{label:"SCOP Warmwasser",name:"param_scop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.scop_warmwasser,onChange:s,hint:"Typisch 2,8-3,5",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vorlauftemperatur (EU-Label)"}),e.jsxs("select",{name:"param_vorlauftemperatur",value:r.vorlauftemperatur,onChange:i=>s({target:{name:"param_vorlauftemperatur",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"35",children:"35¬∞C (Fu√übodenheizung)"}),e.jsx("option",{value:"55",children:"55¬∞C (Heizk√∂rper)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SCOP-Wert muss zur Vorlauftemperatur passen"})]})]}),a==="getrennte_cops"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{label:"COP Heizung",name:"param_cop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_heizung,onChange:s,hint:"Typisch 3,5-4,5 (Vorlauf 35¬∞C)",required:!0}),e.jsx(L,{label:"COP Warmwasser",name:"param_cop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_warmwasser,onChange:s,hint:"Typisch 2,5-3,5 (Vorlauf 55¬∞C)",required:!0})]}),e.jsx(L,{label:"Heizw√§rmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:r.heizwaermebedarf_kwh,onChange:s,hint:"Aus Energieausweis oder Sch√§tzung"}),e.jsx(L,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:r.warmwasserbedarf_kwh,onChange:s,hint:"~500 kWh/Person/Jahr typisch"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Vergleich mit alter Heizung (f√ºr ROI-Berechnung)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Alter Energietr√§ger"}),e.jsxs("select",{name:"param_alter_energietraeger",value:r.alter_energietraeger,onChange:i=>s({target:{name:"param_alter_energietraeger",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"gas",children:"Erdgas"}),e.jsx("option",{value:"oel",children:"Heiz√∂l"}),e.jsx("option",{value:"strom",children:"Strom (Direktheizung)"})]})]}),e.jsx(L,{label:"Alter Preis (ct/kWh)",name:"param_alter_preis_cent_kwh",type:"number",step:"0.1",min:"0",value:r.alter_preis_cent_kwh,onChange:s,hint:"Gas ~12 ct, √ñl ~10 ct"}),e.jsx(L,{label:"PV-Anteil (%)",name:"param_pv_anteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_anteil_prozent,onChange:s,hint:"Anteil des WP-Stroms aus PV"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:r.sg_ready,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid f√§hig)"})]})]})}case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(L,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:s,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:r.bidirektional,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:r.pv_optimiert,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-√úberschussladen m√∂glich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:r.max_leistung_kw,onChange:s}),e.jsx(L,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:s})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:r.hybrid,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:r.anzahl_module,onChange:s,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(L,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:r.modul_leistung_wp,onChange:s,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(L,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:r.modul_typ,onChange:s,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),r.anzahl_module&&r.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(r.anzahl_module)||0)*(parseInt(r.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const n=(parseInt(r.anzahl)||0)*(parseInt(r.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:r.anzahl,onChange:s}),e.jsx(L,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:r.leistung_wp,onChange:s,hint:n>0?`= ${n.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:r.ausrichtung,onChange:a=>s({target:{name:"param_ausrichtung",value:a.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"S√ºd",children:"S√ºd (0¬∞)"}),e.jsx("option",{value:"S√ºdost",children:"S√ºdost (-45¬∞)"}),e.jsx("option",{value:"Ost",children:"Ost (-90¬∞)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135¬∞)"}),e.jsx("option",{value:"Nord",children:"Nord (180¬∞)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135¬∞)"}),e.jsx("option",{value:"West",children:"West (90¬∞)"}),e.jsx("option",{value:"S√ºdwest",children:"S√ºdwest (45¬∞)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(L,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:r.neigung_grad,onChange:s,hint:"0¬∞ = flach, 90¬∞ = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:r.hat_speicher,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),r.hat_speicher&&e.jsx(L,{label:"Speicher-Kapazit√§t (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:r.speicher_kapazitaet_wh,onChange:s,hint:"z.B. 1600 Wh f√ºr Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:r.kategorie,onChange:a=>s({target:{name:"param_kategorie",value:a.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(L,{label:"Beschreibung",name:"param_beschreibung",value:r.beschreibung,onChange:s,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const Wr=[{typ:"e-auto",label:"E-Auto",icon:ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"W√§rmepumpe",icon:Ee,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:xt,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:kt,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:re,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:Hs,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:kt,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function hi(){var C;const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(null),[a,i]=d.useState(!1),[x,o]=d.useState(null),[c,u]=d.useState(null),[l,j]=d.useState(null),[h,p]=d.useState(null),m=s??((C=t[0])==null?void 0:C.id),g=t.find(f=>f.id===m)??null,{investitionen:v,loading:w,createInvestition:k,updateInvestition:N,deleteInvestition:S}=Ot(m),y=Ua(v),b=d.useMemo(()=>{const f={};return Wr.forEach($=>{var K;f[$.typ]=((K=y[$.typ])==null?void 0:K.length)||0}),f},[y]),W=f=>{u(f),o(null),i(!0)},H=f=>{o(f),u(f.typ),i(!0)},P=async f=>{try{x?await N(x.id,f):await k(f),i(!1),o(null),u(null)}catch($){p($ instanceof Error?$.message:"Fehler beim Speichern")}},Z=async()=>{if(l)try{await S(l.id),j(null)}catch(f){p(f instanceof Error?f.message:"Fehler beim L√∂schen")}};return r||w?e.jsx(pe,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(Y,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:m??"",onChange:f=>n(Number(f.target.value)),className:"input w-auto",children:t.map(f=>e.jsx("option",{value:f.id,children:f.anlagenname},f.id))})})]}),h&&e.jsx(Y,{type:"error",onClose:()=>p(null),children:h}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Wr.map(f=>e.jsxs("button",{onClick:()=>W(f.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${f.bgColor}`,children:[e.jsx(f.icon,{className:`h-8 w-8 mx-auto ${f.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:f.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[b[f.typ]," vorhanden"]})]},f.typ))}),v.length===0?e.jsx(Bt,{icon:Ft,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, W√§rmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(ee,{onClick:()=>W("speicher"),children:[e.jsx(mt,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:Wr.map(f=>{const $=y[f.typ];return!$||$.length===0?null:e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${f.bgColor}`,children:e.jsx(f.icon,{className:`h-5 w-5 ${f.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:f.label})]}),e.jsx(ee,{variant:"secondary",size:"sm",onClick:()=>W(f.typ),children:e.jsx(mt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:$.map(K=>e.jsx(xi,{investition:K,onEdit:()=>H(K),onDelete:()=>j(K)},K.id))})]},f.typ)})}),e.jsx(tt,{isOpen:a,onClose:()=>{i(!1),o(null),u(null)},title:x?"Investition bearbeiten":"Neue Investition",size:"lg",children:c&&m&&e.jsx(oi,{investition:x,anlageId:m,typ:c,anlage:g,onSubmit:P,onCancel:()=>{i(!1),o(null),u(null)}})}),e.jsxs(tt,{isOpen:!!l,onClose:()=>j(null),title:"Investition l√∂schen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['M√∂chtest du die Investition "',l==null?void 0:l.bezeichnung,'" wirklich l√∂schen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(ee,{variant:"secondary",onClick:()=>j(null),children:"Abbrechen"}),e.jsx(ee,{variant:"danger",onClick:Z,children:"L√∂schen"})]})]})]})}function xi({investition:t,onEdit:r,onDelete:s}){const n=t.parameter||{},i=(()=>{const o=[];switch(t.typ){case"e-auto":n.batteriekapazitaet_kwh&&o.push(`${n.batteriekapazitaet_kwh} kWh Batterie`),n.verbrauch_kwh_100km&&o.push(`${n.verbrauch_kwh_100km} kWh/100km`),n.v2h_faehig&&o.push("V2H f√§hig");break;case"speicher":n.kapazitaet_kwh&&o.push(`${n.kapazitaet_kwh} kWh`),n.nutzbare_kapazitaet_kwh&&o.push(`${n.nutzbare_kapazitaet_kwh} kWh nutzbar`),n.arbitrage_faehig&&o.push("Arbitrage");break;case"waermepumpe":n.leistung_kw&&o.push(`${n.leistung_kw} kW`),n.cop&&o.push(`COP ${n.cop}`);break;case"wallbox":n.max_ladeleistung_kw&&o.push(`${n.max_ladeleistung_kw} kW`),n.bidirektional&&o.push("Bidirektional");break;case"wechselrichter":n.max_leistung_kw&&o.push(`${n.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":n.leistung_wp&&o.push(`${n.leistung_wp} Wp`),n.anzahl&&o.push(`${n.anzahl} Module`);break}return o})(),x=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join(" ‚Ä¢ ")}),x&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[x.toLocaleString("de-DE")," ‚Ç¨"]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(Pa,{className:"h-4 w-4"})}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"L√∂schen",children:e.jsx(dt,{className:"h-4 w-4"})})]})]})}const mi=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"M√§rz"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function Es({monatsdaten:t,anlageId:r,onSubmit:s,onCancel:n}){var I,q,ne,G,B,he,Ne,_e,ie;const a=new Date().getFullYear(),i=new Date().getMonth()+1,[x,o]=d.useState(!1),[c,u]=d.useState(null),{investitionen:l,loading:j}=Ot(r),h=d.useMemo(()=>l.filter(D=>D.aktiv),[l]),p=h.some(D=>D.typ==="speicher"),m=h.some(D=>D.typ==="e-auto"),g=h.some(D=>D.typ==="wallbox"),v=h.some(D=>D.typ==="waermepumpe"),w=h.some(D=>D.typ==="wechselrichter"),k=h.some(D=>D.typ==="pv-module"),N=h.some(D=>D.typ==="balkonkraftwerk"),S=h.some(D=>D.typ==="sonstiges"),[y,b]=d.useState({jahr:((I=t==null?void 0:t.jahr)==null?void 0:I.toString())||a.toString(),monat:((q=t==null?void 0:t.monat)==null?void 0:q.toString())||i.toString(),einspeisung_kwh:((ne=t==null?void 0:t.einspeisung_kwh)==null?void 0:ne.toString())||"",netzbezug_kwh:((G=t==null?void 0:t.netzbezug_kwh)==null?void 0:G.toString())||"",pv_erzeugung_kwh:((B=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:B.toString())||"",batterie_ladung_kwh:((he=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:he.toString())||"",batterie_entladung_kwh:((Ne=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:Ne.toString())||"",globalstrahlung_kwh_m2:((_e=t==null?void 0:t.globalstrahlung_kwh_m2)==null?void 0:_e.toString())||"",sonnenstunden:((ie=t==null?void 0:t.sonnenstunden)==null?void 0:ie.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[W,H]=d.useState(!1),[P,Z]=d.useState(null),[C,f]=d.useState({}),[$,K]=d.useState(!1);d.useEffect(()=>{if(h.length===0)return;(async()=>{const A={};if(h.forEach(T=>{var ue,ye;if(T.typ==="e-auto")A[T.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(T.typ==="speicher")A[T.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(T.typ==="wallbox")A[T.id]={ladung_kwh:"",ladevorgaenge:""};else if(T.typ==="waermepumpe")A[T.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(T.typ==="wechselrichter")A[T.id]={pv_erzeugung_kwh:""};else if(T.typ==="pv-module")A[T.id]={pv_erzeugung_kwh:""};else if(T.typ==="balkonkraftwerk"){const me=(ue=T.parameter)==null?void 0:ue.hat_speicher,E={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};me?A[T.id]={...E,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:A[T.id]=E}else if(T.typ==="sonstiges"){const me=((ye=T.parameter)==null?void 0:ye.kategorie)||"erzeuger";me==="erzeuger"?A[T.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:me==="verbraucher"?A[T.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:me==="speicher"&&(A[T.id]={ladung_kwh:"",entladung_kwh:""})}A[T.id]&&(A[T.id].sonderkosten_euro="",A[T.id].sonderkosten_notiz="")}),t!=null&&t.jahr&&(t!=null&&t.monat)){K(!0);try{const T=await Fe.getMonatsdatenByMonth(r,t.jahr,t.monat);T.forEach(V=>{const te=String(V.investition_id);A[te]&&V.verbrauch_daten&&Object.entries(V.verbrauch_daten).forEach(([Me,ze])=>{A[te][Me]!==void 0&&(A[te][Me]=(ze==null?void 0:ze.toString())||""),Me==="v2h_entladung_kwh"&&A[te].entladung_v2h_kwh!==void 0&&(A[te].entladung_v2h_kwh=(ze==null?void 0:ze.toString())||""),Me==="erzeugung_kwh"&&A[te].pv_erzeugung_kwh!==void 0&&(A[te].pv_erzeugung_kwh=(ze==null?void 0:ze.toString())||""),Me==="verbrauch_kwh"&&A[te].verbrauch_sonstig_kwh!==void 0&&(A[te].verbrauch_sonstig_kwh=(ze==null?void 0:ze.toString())||"")})});const ue=h.filter(V=>V.typ==="speicher"),ye=new Set(T.filter(V=>ue.some(te=>te.id===V.investition_id)).map(V=>V.investition_id)),me=(t==null?void 0:t.batterie_ladung_kwh)||0,E=(t==null?void 0:t.batterie_entladung_kwh)||0;if(ue.length>0&&(me>0||E>0)){const V=ue.filter(te=>!ye.has(te.id));if(V.length>0){const te=1/V.length;V.forEach(Me=>{const ze=String(Me.id);A[ze]&&(A[ze].ladung_kwh=(me*te).toFixed(1),A[ze].entladung_kwh=(E*te).toFixed(1))}),console.info(`Migration: Legacy-Speicherdaten (${me}/${E} kWh) auf ${V.length} Speicher √ºbertragen`)}}}catch(T){console.error("Fehler beim Laden der InvestitionMonatsdaten:",T)}finally{K(!1)}}f(A)})()},[h,t==null?void 0:t.jahr,t==null?void 0:t.monat,r]);const O=D=>{const{name:A,value:T}=D.target;b(ue=>({...ue,[A]:T}))},X=(D,A,T)=>{f(ue=>({...ue,[D]:{...ue[D],[A]:T}}))},Q=d.useMemo(()=>{let D=0,A=0,T=0;return h.forEach(ue=>{var me,E;const ye=C[ue.id];ye&&(ue.typ==="speicher"?(D+=parseFloat(ye.ladung_kwh)||0,A+=parseFloat(ye.entladung_kwh)||0):ue.typ==="pv-module"||ue.typ==="wechselrichter"||ue.typ==="balkonkraftwerk"?(T+=parseFloat(ye.pv_erzeugung_kwh)||0,ue.typ==="balkonkraftwerk"&&((me=ue.parameter)!=null&&me.hat_speicher)&&(D+=parseFloat(ye.speicher_ladung_kwh)||0,A+=parseFloat(ye.speicher_entladung_kwh)||0)):ue.typ==="sonstiges"&&((E=ue.parameter)==null?void 0:E.kategorie)==="erzeuger"&&(T+=parseFloat(ye.erzeugung_kwh)||0))}),{batterieLadung:D,batterieEntladung:A,pvErzeugung:T}},[h,C]),_=async()=>{if(!y.jahr||!y.monat){u("Bitte zuerst Jahr und Monat ausw√§hlen");return}H(!0),Z(null),u(null);try{const D=await fr.getMonatsdaten(r,parseInt(y.jahr),parseInt(y.monat));b(T=>({...T,globalstrahlung_kwh_m2:D.globalstrahlung_kwh_m2.toString(),sonnenstunden:D.sonnenstunden.toString()}));const A=D.datenquelle==="open-meteo"?`Historische Daten von Open-Meteo${D.abdeckung_prozent?` (${D.abdeckung_prozent}% Abdeckung)`:""}`:D.datenquelle==="pvgis-tmy"?"Durchschnittswerte von PVGIS (TMY)":"Gesch√§tzte Durchschnittswerte";Z(A)}catch(D){u(D instanceof Error?D.message:"Wetterdaten konnten nicht abgerufen werden")}finally{H(!1)}},F=async D=>{if(D.preventDefault(),u(null),!y.einspeisung_kwh||!y.netzbezug_kwh){u("Bitte Einspeisung und Netzbezug eingeben");return}try{o(!0);const A={};h.forEach(me=>{const E=C[me.id];if(!E)return;const V={};me.typ==="e-auto"?(E.km_gefahren&&(V.km_gefahren=parseFloat(E.km_gefahren)),E.verbrauch_kwh&&(V.verbrauch_kwh=parseFloat(E.verbrauch_kwh)),E.ladung_pv_kwh&&(V.ladung_pv_kwh=parseFloat(E.ladung_pv_kwh)),E.ladung_netz_kwh&&(V.ladung_netz_kwh=parseFloat(E.ladung_netz_kwh)),E.ladung_extern_kwh&&(V.ladung_extern_kwh=parseFloat(E.ladung_extern_kwh)),E.ladung_extern_euro&&(V.ladung_extern_euro=parseFloat(E.ladung_extern_euro)),E.entladung_v2h_kwh&&(V.v2h_entladung_kwh=parseFloat(E.entladung_v2h_kwh))):me.typ==="speicher"?(E.ladung_kwh&&(V.ladung_kwh=parseFloat(E.ladung_kwh)),E.entladung_kwh&&(V.entladung_kwh=parseFloat(E.entladung_kwh)),E.speicher_ladung_netz_kwh&&(V.speicher_ladung_netz_kwh=parseFloat(E.speicher_ladung_netz_kwh)),E.speicher_ladepreis_cent&&(V.speicher_ladepreis_cent=parseFloat(E.speicher_ladepreis_cent))):me.typ==="wallbox"?(E.ladung_kwh&&(V.ladung_kwh=parseFloat(E.ladung_kwh)),E.ladevorgaenge&&(V.ladevorgaenge=parseInt(E.ladevorgaenge))):me.typ==="waermepumpe"?(E.stromverbrauch_kwh&&(V.stromverbrauch_kwh=parseFloat(E.stromverbrauch_kwh)),E.heizenergie_kwh&&(V.heizenergie_kwh=parseFloat(E.heizenergie_kwh)),E.warmwasser_kwh&&(V.warmwasser_kwh=parseFloat(E.warmwasser_kwh))):me.typ==="wechselrichter"||me.typ==="pv-module"?E.pv_erzeugung_kwh&&(V.pv_erzeugung_kwh=parseFloat(E.pv_erzeugung_kwh)):me.typ==="balkonkraftwerk"?(E.pv_erzeugung_kwh&&(V.erzeugung_kwh=parseFloat(E.pv_erzeugung_kwh)),E.eigenverbrauch_kwh&&(V.eigenverbrauch_kwh=parseFloat(E.eigenverbrauch_kwh)),E.einspeisung_kwh&&(V.einspeisung_kwh=parseFloat(E.einspeisung_kwh)),E.speicher_ladung_kwh&&(V.speicher_ladung_kwh=parseFloat(E.speicher_ladung_kwh)),E.speicher_entladung_kwh&&(V.speicher_entladung_kwh=parseFloat(E.speicher_entladung_kwh))):me.typ==="sonstiges"&&(E.erzeugung_kwh&&(V.erzeugung_kwh=parseFloat(E.erzeugung_kwh)),E.eigenverbrauch_kwh&&(V.eigenverbrauch_kwh=parseFloat(E.eigenverbrauch_kwh)),E.einspeisung_kwh&&(V.einspeisung_kwh=parseFloat(E.einspeisung_kwh)),E.verbrauch_sonstig_kwh&&(V.verbrauch_kwh=parseFloat(E.verbrauch_sonstig_kwh)),E.bezug_pv_kwh&&(V.bezug_pv_kwh=parseFloat(E.bezug_pv_kwh)),E.bezug_netz_kwh&&(V.bezug_netz_kwh=parseFloat(E.bezug_netz_kwh)),E.ladung_kwh&&(V.ladung_kwh=parseFloat(E.ladung_kwh)),E.entladung_kwh&&(V.entladung_kwh=parseFloat(E.entladung_kwh))),E.sonderkosten_euro&&(V.sonderkosten_euro=parseFloat(E.sonderkosten_euro)),E.sonderkosten_notiz&&(V.sonderkosten_notiz=E.sonderkosten_notiz),Object.keys(V).length>0&&(A[me.id]=V)});const T=y.batterie_ladung_kwh?parseFloat(y.batterie_ladung_kwh):Q.batterieLadung||void 0,ue=y.batterie_entladung_kwh?parseFloat(y.batterie_entladung_kwh):Q.batterieEntladung||void 0,ye=y.pv_erzeugung_kwh?parseFloat(y.pv_erzeugung_kwh):Q.pvErzeugung||void 0;await s({anlage_id:r,jahr:parseInt(y.jahr),monat:parseInt(y.monat),einspeisung_kwh:parseFloat(y.einspeisung_kwh),netzbezug_kwh:parseFloat(y.netzbezug_kwh),pv_erzeugung_kwh:ye,batterie_ladung_kwh:T,batterie_entladung_kwh:ue,globalstrahlung_kwh_m2:y.globalstrahlung_kwh_m2?parseFloat(y.globalstrahlung_kwh_m2):void 0,sonnenstunden:y.sonnenstunden?parseFloat(y.sonnenstunden):void 0,notizen:y.notizen||void 0,investitionen_daten:Object.keys(A).length>0?A:void 0})}catch(A){u(A instanceof Error?A.message:"Fehler beim Speichern")}finally{o(!1)}};return j||$?e.jsx("div",{className:"text-center py-4 text-gray-500",children:$?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[c&&e.jsx(Y,{type:"error",children:c}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:y.jahr,onChange:O,required:!0,disabled:!!t}),e.jsx(Je,{label:"Monat",name:"monat",value:y.monat,onChange:O,options:mi,required:!0,disabled:!!t})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:y.einspeisung_kwh,onChange:O,placeholder:"z.B. 450",required:!0}),e.jsx(L,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:y.netzbezug_kwh,onChange:O,placeholder:"z.B. 120",required:!0}),(k||w)&&Q.pvErzeugung>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PV-Erzeugung (berechnet)"}),e.jsx("input",{type:"text",value:`${Q.pvErzeugung.toFixed(1)} kWh`,readOnly:!0,disabled:!0,className:"input bg-gray-100 dark:bg-gray-800 cursor-not-allowed"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Aus ",k?"PV-Modulen":"Wechselrichtern",": ",Q.pvErzeugung.toFixed(1)," kWh"]})]}):e.jsx(L,{label:k||w?"PV-Erzeugung (aus Modulen unten)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:y.pv_erzeugung_kwh,onChange:O,placeholder:"z.B. 800",hint:k||w?"Wird aus PV-Modulen berechnet":"Manuell eingeben wenn keine PV-Module definiert"})]})]}),k&&e.jsx(hr,{title:"PV-Module",icon:re,iconColor:"text-yellow-500",investitionen:h.filter(D=>D.typ==="pv-module"),investitionsDaten:C,onInvChange:X,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),w&&!k&&e.jsx(hr,{title:"Wechselrichter",icon:re,iconColor:"text-yellow-500",investitionen:h.filter(D=>D.typ==="wechselrichter"),investitionsDaten:C,onInvChange:X,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),p&&e.jsxs(e.Fragment,{children:[e.jsx(ui,{investitionen:h.filter(D=>D.typ==="speicher"),investitionsDaten:C,onInvChange:X}),(Q.batterieLadung>0||Q.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",Q.batterieLadung.toFixed(1)," kWh | Entladung ",Q.batterieEntladung.toFixed(1)," kWh"]})]}),m&&e.jsx(pi,{investitionen:h.filter(D=>D.typ==="e-auto"),investitionsDaten:C,onInvChange:X}),g&&e.jsx(hr,{title:"Wallbox",icon:xt,iconColor:"text-purple-500",investitionen:h.filter(D=>D.typ==="wallbox"),investitionsDaten:C,onInvChange:X,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorg√§nge",unit:"",placeholder:"z.B. 12"}]}),v&&e.jsx(hr,{title:"W√§rmepumpe",icon:Ee,iconColor:"text-orange-500",investitionen:h.filter(D=>D.typ==="waermepumpe"),investitionsDaten:C,onInvChange:X,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),N&&e.jsx(bi,{investitionen:h.filter(D=>D.typ==="balkonkraftwerk"),investitionsDaten:C,onInvChange:X}),S&&e.jsx(ji,{investitionen:h.filter(D=>D.typ==="sonstiges"),investitionsDaten:C,onInvChange:X}),!p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(L,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:y.batterie_ladung_kwh,onChange:O,placeholder:"z.B. 150"}),e.jsx(L,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:y.batterie_entladung_kwh,onChange:O,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(St,{className:"w-4 h-4"}),"Wetterdaten (optional)"]}),e.jsx(ee,{type:"button",variant:"secondary",size:"sm",onClick:_,disabled:W,children:W?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 animate-spin mr-1"})," Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 mr-1"})," Auto-Fill"]})})]}),P&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-3 py-2 rounded",children:P}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{label:"Globalstrahlung",name:"globalstrahlung_kwh_m2",type:"number",step:"0.1",min:"0",value:y.globalstrahlung_kwh_m2,onChange:O,placeholder:"z.B. 152",hint:"kWh/m¬≤"}),e.jsx(L,{label:"Sonnenstunden",name:"sonnenstunden",type:"number",step:"0.1",min:"0",value:y.sonnenstunden,onChange:O,placeholder:"z.B. 245",hint:"Stunden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:y.notizen,onChange:O,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(ee,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(ee,{type:"submit",loading:x,children:t?"Speichern":"Monat erfassen"})]})]})}function ui({investitionen:t,investitionsDaten:r,onInvChange:s}){if(t.length===0)return null;const n=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],a=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:"√ò Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),t.map(i=>{var c;const o=((c=i.parameter)==null?void 0:c.arbitrage_faehig)?[...n,...a]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:o.map(u=>{var l;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[u.label," ",u.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",u.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[i.id])==null?void 0:l[u.key])||"",onChange:j=>s(i.id,u.key,j.target.value),placeholder:u.placeholder,className:"input text-sm py-1.5",title:u.hint}),u.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:u.hint,children:u.hint})]},u.key)})}),e.jsx(ar,{invId:i.id,investitionsDaten:r,onInvChange:s})]},i.id)})]})}function pi({investitionen:t,investitionsDaten:r,onInvChange:s}){if(t.length===0)return null;const n=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"‚Ç¨",placeholder:"z.B. 18.00"}],a={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),t.map(i=>{var c,u;const o=((c=i.parameter)==null?void 0:c.v2h_faehig)||((u=i.parameter)==null?void 0:u.nutzt_v2h)?[...n,a]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:o.map(l=>{var j;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[l.label," ",l.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",l.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((j=r[i.id])==null?void 0:j[l.key])||"",onChange:h=>s(i.id,l.key,h.target.value),placeholder:l.placeholder,className:"input text-sm py-1.5",title:l.hint}),l.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:l.hint,children:l.hint})]},l.key)})}),e.jsx(ar,{invId:i.id,investitionsDaten:r,onInvChange:s})]},i.id)})]})}function hr({title:t,icon:r,iconColor:s,investitionen:n,investitionsDaten:a,onInvChange:i,felder:x}){return n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`h-5 w-5 ${s}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),n.map(o=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:o.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:x.map(c=>{var u;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[c.label," ",c.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",c.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=a[o.id])==null?void 0:u[c.key])||"",onChange:l=>i(o.id,c.key,l.target.value),placeholder:c.placeholder,className:"input text-sm py-1.5",title:c.hint}),c.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:c.hint,children:c.hint})]},c.key)})}),e.jsx(ar,{invId:o.id,investitionsDaten:a,onInvChange:i})]},o.id))]})}function bi({investitionen:t,investitionsDaten:r,onInvChange:s}){return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),t.map(n=>{var i,x,o,c,u;const a=!!((i=n.parameter)!=null&&i.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n.bezeichnung,n.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",n.leistung_kwp," kWp)"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:a?"Mit Speicher: Bei Nulleinspeisung entspricht Eigenverbrauch meist der Erzeugung.":"Ohne Speicher: Eigenverbrauch ist der direkt genutzte Anteil (typisch 30-40% der Erzeugung)."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[n.id])==null?void 0:x.pv_erzeugung_kwh)||"",onChange:l=>s(n.id,"pv_erzeugung_kwh",l.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=r[n.id])==null?void 0:o.eigenverbrauch_kwh)||"",onChange:l=>s(n.id,"eigenverbrauch_kwh",l.target.value),placeholder:a?"z.B. 43 (‚âàErzeugung)":"z.B. 15 (30-40%)",className:"input text-sm py-1.5"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((c=r[n.id])==null?void 0:c.speicher_ladung_kwh)||"",onChange:l=>s(n.id,"speicher_ladung_kwh",l.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[n.id])==null?void 0:u.speicher_entladung_kwh)||"",onChange:l=>s(n.id,"speicher_entladung_kwh",l.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(ar,{invId:n.id,investitionsDaten:r,onInvChange:s})]},n.id)})]})}function ji({investitionen:t,investitionsDaten:r,onInvChange:s}){if(t.length===0)return null;const n={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Aa,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),t.map(a=>{var x,o,c,u,l,j,h,p,m,g;const i=((x=a.parameter)==null?void 0:x.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[n[i]||i,(o=a.parameter)!=null&&o.beschreibung?` - ${String(a.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[i==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((c=r[a.id])==null?void 0:c.erzeugung_kwh)||"",onChange:v=>s(a.id,"erzeugung_kwh",v.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[a.id])==null?void 0:u.eigenverbrauch_kwh)||"",onChange:v=>s(a.id,"eigenverbrauch_kwh",v.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[a.id])==null?void 0:l.einspeisung_kwh)||"",onChange:v=>s(a.id,"einspeisung_kwh",v.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),i==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((j=r[a.id])==null?void 0:j.verbrauch_sonstig_kwh)||"",onChange:v=>s(a.id,"verbrauch_sonstig_kwh",v.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[a.id])==null?void 0:h.bezug_pv_kwh)||"",onChange:v=>s(a.id,"bezug_pv_kwh",v.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=r[a.id])==null?void 0:p.bezug_netz_kwh)||"",onChange:v=>s(a.id,"bezug_netz_kwh",v.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),i==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((m=r[a.id])==null?void 0:m.ladung_kwh)||"",onChange:v=>s(a.id,"ladung_kwh",v.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=r[a.id])==null?void 0:g.entladung_kwh)||"",onChange:v=>s(a.id,"entladung_kwh",v.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(ar,{invId:a.id,investitionsDaten:r,onInvChange:s})]},a.id)})]})}function ar({invId:t,investitionsDaten:r,onInvChange:s}){var x,o,c,u;const n=((x=r[t])==null?void 0:x.sonderkosten_euro)||((o=r[t])==null?void 0:o.sonderkosten_notiz),[a,i]=d.useState(!!n);return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:a?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Sonderkosten ",e.jsx("span",{className:"text-gray-400",children:"(‚Ç¨)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((c=r[t])==null?void 0:c.sonderkosten_euro)||"",onChange:l=>s(t,"sonderkosten_euro",l.target.value),placeholder:"z.B. 150",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Beschreibung"}),e.jsx("input",{type:"text",value:((u=r[t])==null?void 0:u.sonderkosten_notiz)||"",onChange:l=>s(t,"sonderkosten_notiz",l.target.value),placeholder:"z.B. Wechselrichter-Reparatur",className:"input text-sm py-1.5"})]})]}):e.jsx("button",{type:"button",onClick:()=>i(!0),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonderkosten erfassen (Reparatur, Wartung, etc.)"})})}const Fs=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Ws={zaehler:{label:"Z√§hlerwerte",color:"bg-blue-500"},komponenten:{label:"Komponenten",color:"bg-amber-500"},berechnet:{label:"Berechnungen",color:"bg-green-500"}},qt=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",group:"zaehler",getValue:t=>t.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",group:"zaehler",getValue:t=>t.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",group:"komponenten",getValue:t=>t.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"speicher_ladung",label:"Speicher Ladung",shortLabel:"Sp.Lad",group:"komponenten",getValue:t=>t.speicher_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"speicher_entladung",label:"Speicher Entladung",shortLabel:"Sp.Entl",group:"komponenten",getValue:t=>t.speicher_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_strom",label:"WP Strom",shortLabel:"WP",group:"komponenten",getValue:t=>t.wp_strom_kwh,format:"kwh",defaultVisible:!1},{key:"wp_heizung",label:"WP Heizung",shortLabel:"WP Hz",group:"komponenten",getValue:t=>t.wp_heizung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_warmwasser",label:"WP Warmwasser",shortLabel:"WP WW",group:"komponenten",getValue:t=>t.wp_warmwasser_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_ladung",label:"E-Auto Ladung",shortLabel:"E-Auto",group:"komponenten",getValue:t=>t.eauto_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_km",label:"E-Auto km",shortLabel:"km",group:"komponenten",getValue:t=>t.eauto_km,defaultVisible:!1},{key:"wallbox_ladung",label:"Wallbox Ladung",shortLabel:"WB",group:"komponenten",getValue:t=>t.wallbox_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",group:"berechnet",getValue:t=>t.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",group:"berechnet",getValue:t=>t.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",group:"berechnet",getValue:t=>t.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",group:"berechnet",getValue:t=>t.autarkie_prozent,format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",group:"berechnet",getValue:t=>t.eigenverbrauchsquote_prozent,format:"percent",defaultVisible:!1}],Ms="eedc-monatsdaten-columns-v3";function ki(){const t=$t(),{anlagen:r,loading:s}=Ce(),[n,a]=d.useState(void 0),{monatsdaten:i,loading:x,error:o,createMonatsdaten:c,updateMonatsdaten:u,deleteMonatsdaten:l}=ta(n);Ot(n);const[j,h]=d.useState([]),[p,m]=d.useState(!1),[g,v]=d.useState(!1),[w,k]=d.useState(null),[N,S]=d.useState(null),[y,b]=d.useState(!1),[W,H]=d.useState(()=>{try{const _=localStorage.getItem(Ms);if(_)return new Set(JSON.parse(_))}catch{}return new Set(qt.filter(_=>_.defaultVisible).map(_=>_.key))});d.useEffect(()=>{localStorage.setItem(Ms,JSON.stringify([...W]))},[W]),d.useEffect(()=>{if(!n)return;(async()=>{m(!0);try{const F=await _t.listAggregiert(n);h(F)}catch(F){console.error("Fehler beim Laden der aggregierten Daten:",F)}finally{m(!1)}})()},[n,i]);const P=_=>{H(F=>{const I=new Set(F);return I.has(_)?I.delete(_):I.add(_),I})},Z=_=>{const F=qt.filter(q=>q.group===_),I=F.every(q=>W.has(q.key));H(q=>{const ne=new Set(q);return F.forEach(G=>{I?ne.delete(G.key):ne.add(G.key)}),ne})},C=qt.filter(_=>W.has(_.key));!n&&r.length>0&&!s&&a(r[0].id);const f=d.useMemo(()=>j.filter(_=>_.hat_legacy_daten).length,[j]),$=async _=>{await c(_),v(!1)},K=async _=>{w&&(await u(w.id,_),k(null))},O=async()=>{N&&(await l(N.id),S(null))},X=_=>i.find(F=>F.id===_.id),Q=(_,F)=>{if(_==null||isNaN(_))return"-";switch(F){case"kwh":return _.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${_.toFixed(1)}%`;default:return _.toLocaleString("de-DE",{maximumFractionDigits:1})}};return s||x?e.jsx(pe,{text:"Lade Daten..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(M,{children:e.jsx(Bt,{icon:Ie,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(ee,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Je,{value:(n==null?void 0:n.toString())||"",onChange:_=>a(parseInt(_.target.value)),options:r.map(_=>({value:_.id.toString(),label:_.anlagenname}))}),e.jsxs(ee,{onClick:()=>v(!0),children:[e.jsx(mt,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),o&&e.jsx(Y,{type:"error",children:o}),f>0&&e.jsxs(Y,{type:"warning",className:"flex items-start gap-3",children:[e.jsx(Re,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Legacy-Daten gefunden"}),e.jsxs("p",{className:"text-sm mt-1",children:[f," Monat",f>1?"e":""," enth√§lt",f>1?"en":""," Daten im alten Format (PV-Erzeugung/Speicher in Monatsdaten statt InvestitionMonatsdaten). Bitte jeden betroffenen Monat einmal √∂ffnen und speichern."]})]})]}),p?e.jsx(pe,{text:"Lade aggregierte Daten..."}):j.length===0?e.jsx(M,{children:e.jsx(Bt,{icon:st,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(ee,{onClick:()=>v(!0),children:"Manuell erfassen"}),e.jsx(ee,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(ee,{variant:"secondary",size:"sm",onClick:()=>b(!y),children:[e.jsx(Ma,{className:"h-4 w-4 mr-2"}),"Spalten (",C.length,"/",qt.length,")"]})}),y&&e.jsxs(M,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"space-y-4",children:Object.keys(Ws).map(_=>{const F=Ws[_],I=qt.filter(ne=>ne.group===_),q=I.filter(ne=>W.has(ne.key)).length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${F.color}`}),e.jsxs("button",{onClick:()=>Z(_),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600",children:[F.label," (",q,"/",I.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-5",children:I.map(ne=>e.jsx("button",{onClick:()=>P(ne.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${W.has(ne.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:ne.label},ne.key))})]},_)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"Klicke auf Gruppen-Namen um alle Spalten ein-/auszublenden, oder auf einzelne Spalten."})]}),e.jsx(M,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Jr,{children:[e.jsx(Zr,{children:e.jsxs(Kt,{children:[e.jsx(De,{children:"Monat"}),C.map(_=>e.jsxs(De,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:_.label}),e.jsx("span",{className:"sm:hidden",children:_.shortLabel||_.label})]},_.key)),e.jsx(De,{className:"text-right",children:"Aktionen"})]})}),e.jsx(qr,{children:j.map(_=>e.jsxs(Kt,{className:_.hat_legacy_daten?"bg-amber-50 dark:bg-amber-900/10":"",children:[e.jsxs(Ve,{children:[e.jsxs("span",{className:"font-medium",children:[Fs[_.monat]," ",_.jahr]}),_.hat_legacy_daten&&e.jsx("span",{title:"Legacy-Daten",children:e.jsx(Re,{className:"h-3 w-3 text-amber-500 inline ml-1"})})]}),C.map(F=>{const I=F.getValue(_);return e.jsx(Ve,{className:`text-right font-mono ${F.className||""}`,children:Q(I,F.format)},F.key)}),e.jsx(Ve,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>{const F=X(_);F&&k(F)},children:e.jsx(Hr,{className:"h-4 w-4"})}),e.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>{const F=X(_);F&&S(F)},children:e.jsx(dt,{className:"h-4 w-4 text-red-500"})})]})})]},_.id))})]})})})]}),e.jsx(tt,{isOpen:g,onClose:()=>v(!1),title:"Monatsdaten erfassen",size:"lg",children:n&&e.jsx(Es,{anlageId:n,onSubmit:$,onCancel:()=>v(!1)})}),e.jsx(tt,{isOpen:!!w,onClose:()=>k(null),title:"Monatsdaten bearbeiten",size:"lg",children:w&&n&&e.jsx(Es,{monatsdaten:w,anlageId:n,onSubmit:K,onCancel:()=>k(null)})}),e.jsx(tt,{isOpen:!!N,onClose:()=>S(null),title:"Monatsdaten l√∂schen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["M√∂chtest du die Daten f√ºr ",e.jsxs("strong",{children:[Fs[(N==null?void 0:N.monat)||0]," ",N==null?void 0:N.jahr]})," wirklich l√∂schen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(ee,{variant:"secondary",onClick:()=>S(null),children:"Abbrechen"}),e.jsx(ee,{variant:"danger",onClick:O,children:"L√∂schen"})]})]})})]})}function Cs(){var D;const{anlagen:t,loading:r,refresh:s}=Ce(),[n,a]=d.useState(null),[i,x]=d.useState(!1),[o,c]=d.useState(!1),[u,l]=d.useState(null),[j,h]=d.useState(null),[p,m]=d.useState(!1),[g,v]=d.useState(!1),[w,k]=d.useState(null),N=d.useRef(null),[S,y]=d.useState(!1),[b,W]=d.useState(!1),[H,P]=d.useState(null),[Z,C]=d.useState(!1),f=d.useRef(null),$=t.some(A=>A.anlagenname==="Demo-Anlage"),K=n??((D=t[0])==null?void 0:D.id),O=A=>{A.preventDefault(),x(!0)},X=A=>{A.preventDefault(),x(!1)},Q=async A=>{A.preventDefault(),x(!1);const T=A.dataTransfer.files;T.length>0&&await F(T[0])},_=async A=>{const T=A.target.files;T&&T.length>0&&await F(T[0]),N.current&&(N.current.value="")},F=async A=>{if(!K){h("Bitte zuerst eine Anlage ausw√§hlen");return}if(!A.name.endsWith(".csv")){h("Bitte eine CSV-Datei ausw√§hlen");return}h(null),l(null),c(!0);try{const T=await gt.importCSV(K,A,p);l(T)}catch(T){h(T instanceof Error?T.message:"Import fehlgeschlagen")}finally{c(!1)}},I=()=>{if(!K){h("Bitte zuerst eine Anlage ausw√§hlen");return}window.location.href=gt.getTemplateDownloadUrl(K)},q=()=>{if(!K){h("Bitte zuerst eine Anlage ausw√§hlen");return}window.location.href=gt.getExportUrl(K)},ne=async()=>{h(null),k(null),v(!0);try{const A=await gt.createDemoData();k(A),s()}catch(A){h(A instanceof Error?A.message:"Fehler beim Erstellen der Demo-Daten")}finally{v(!1)}},G=async()=>{h(null),k(null),v(!0);try{await gt.deleteDemoData(),s()}catch(A){h(A instanceof Error?A.message:"Fehler beim L√∂schen der Demo-Daten")}finally{v(!1)}},B=A=>{A.preventDefault(),y(!0)},he=A=>{A.preventDefault(),y(!1)},Ne=async A=>{A.preventDefault(),y(!1);const T=A.dataTransfer.files;T.length>0&&await ie(T[0])},_e=async A=>{const T=A.target.files;T&&T.length>0&&await ie(T[0]),f.current&&(f.current.value="")},ie=async A=>{if(!A.name.endsWith(".json")){h("Bitte eine JSON-Datei ausw√§hlen");return}h(null),P(null),W(!0);try{const T=await gt.importJSON(A,Z);P(T),T.erfolg&&s()}catch(T){h(T instanceof Error?T.message:"JSON-Import fehlgeschlagen")}finally{W(!1)}};return r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(Y,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(Ut,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, W√§rmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(ee,{onClick:ne,loading:g,className:"w-full",children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),w&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(it,{className:"inline h-4 w-4 mr-1"}),w.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),t.length>1&&e.jsx("select",{value:K??"",onChange:A=>a(Number(A.target.value)),className:"input w-auto",children:t.map(A=>e.jsx("option",{value:A.id,children:A.anlagenname},A.id))})]}),j&&e.jsx(Y,{type:"error",onClose:()=>h(null),children:j}),u&&e.jsx(fi,{result:u,onClose:()=>l(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(Et,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enth√§lt alle verf√ºgbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ee,{variant:"secondary",className:"w-full",onClick:I,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:O,onDragLeave:X,onDrop:Q,onClick:()=>{var A;return(A=N.current)==null?void 0:A.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${o?"opacity-50 pointer-events-none":""}
              `,children:o?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(pe,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(tr,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Ausw√§hlen"})]})}),e.jsx("input",{ref:N,type:"file",accept:".csv",onChange:_,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:A=>m(A.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten √ºberschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(ee,{variant:"secondary",size:"sm",onClick:q,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(Ut,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:$?"Demo-Anlage ist bereits vorhanden. Du kannst sie l√∂schen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),$?e.jsxs(ee,{variant:"danger",onClick:G,loading:g,className:"w-full",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Demo-Anlage l√∂schen"]}):e.jsxs(ee,{onClick:ne,loading:g,className:"w-full",children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),w&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(it,{className:"inline h-4 w-4 mr-1"}),w.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enth√§lt:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, W√§rmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:e.jsx(ms,{className:"h-6 w-6 text-purple-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"JSON Import (Anlage wiederherstellen)"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere eine komplette Anlage aus einer JSON-Export-Datei. Alle Investitionen, Monatsdaten, Strompreise und PVGIS-Prognosen werden importiert."}),H&&e.jsx(yi,{result:H,onClose:()=>P(null)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:B,onDragLeave:he,onDrop:Ne,onClick:()=>{var A;return(A=f.current)==null?void 0:A.click()},className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
              ${S?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600 hover:border-purple-500"}
              ${b?"opacity-50 pointer-events-none":""}
            `,children:b?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(pe,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"JSON-Datei hierher ziehen oder klicken zum Ausw√§hlen"})]})}),e.jsx("input",{ref:f,type:"file",accept:".json",onChange:_e,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:Z,onChange:A=>C(A.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),"Existierende Anlage mit gleichem Namen √ºberschreiben"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"}),' JSON-Dateien k√∂nnen √ºber den "Export (JSON)"-Button in der Anlagen-√úbersicht erstellt werden. Bei Namenskonflikt wird automatisch ein Suffix hinzugef√ºgt, es sei denn "√úberschreiben" ist aktiviert.']})]}),e.jsxs(M,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"üí° Tipp: Template herunterladen"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["Das Template enth√§lt automatisch alle Spalten passend zu deinen angelegten Investitionen (z.B. ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"Sueddach_kWh"}),","," ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"BYD_HVS_Ladung_kWh"}),")."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Pflichtspalten:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Investitions-Spalten (automatisch im Template):"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:["PV-Module: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_kWh"})]}),e.jsxs("li",{children:["Speicher: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Ladung_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Entladung_kWh"})]}),e.jsxs("li",{children:["E-Auto: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_km"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Verbrauch_kWh"}),", etc."]}),e.jsxs("li",{children:["W√§rmepumpe: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Strom_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Heizung_kWh"})]})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg mt-2",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200 mb-1",children:"‚ö†Ô∏è Hinweis zu Legacy-Spalten"}),e.jsxs("p",{className:"text-amber-700 dark:text-amber-300 text-xs",children:["Die Spalten ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," und"," ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"Batterie_*_kWh"})," werden nicht mehr unterst√ºtzt, wenn PV-Module/Speicher als Investitionen angelegt sind. Verwende stattdessen die individuellen Investitions-Spalten."]})]})]})]})]})}function yi({result:t,onClose:r}){const s=t.fehler.length>0,n=t.warnungen.length>0,a=()=>s?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":n?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>s?"text-red-800 dark:text-red-200":n?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",x=()=>s?"text-red-700 dark:text-red-300":n?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300",o=Object.values(t.importiert).reduce((u,l)=>u+l,0),c={strompreise:"Strompreise",investitionen:"Investitionen",investition_monatsdaten:"Investition-Monatsdaten",monatsdaten:"Monatsdaten",pvgis_prognosen:"PVGIS-Prognosen",pvgis_monatsprognosen:"PVGIS-Monatsprognosen"};return e.jsxs("div",{className:`relative p-4 rounded-lg border mb-4 ${a()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Mt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[s?e.jsx(Mt,{className:"h-5 w-5 text-red-500 mt-0.5"}):n?e.jsx(Re,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(it,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:s?"Import fehlgeschlagen":n?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[t.erfolg&&t.anlage_name&&e.jsxs("p",{className:x(),children:[e.jsx("strong",{children:"Anlage:"})," ",t.anlage_name]}),o>0&&e.jsxs("div",{className:x(),children:[e.jsx("p",{className:"font-medium",children:"Importierte Datens√§tze:"}),e.jsx("ul",{className:"list-disc list-inside ml-2",children:Object.entries(t.importiert).filter(([,u])=>u>0).map(([u,l])=>e.jsxs("li",{children:[c[u]||u,": ",l]},u))})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((u,l)=>e.jsx("li",{children:u},l)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((u,l)=>e.jsx("li",{children:u},l)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function fi({result:t,onClose:r}){const s=t.fehler.length>0,n=t.warnungen&&t.warnungen.length>0,a=()=>s?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":n?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>s?"text-red-800 dark:text-red-200":n?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",x=()=>s?"text-red-700 dark:text-red-300":n?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300";return e.jsxs("div",{className:`relative p-4 rounded-lg border ${a()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Mt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[s?e.jsx(Mt,{className:"h-5 w-5 text-red-500 mt-0.5"}):n?e.jsx(Re,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(it,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:s?"Import mit Fehlern":n?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[e.jsxs("p",{className:x(),children:[t.importiert," Datens√§tze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} √ºbersprungen`]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((o,c)=>e.jsx("li",{children:o},c)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((o,c)=>e.jsx("li",{children:o},c)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function wi(){const{theme:t,setTheme:r}=Xs(),[s,n]=d.useState(null),[a,i]=d.useState(null),[x,o]=d.useState([]),[c,u]=d.useState(!0),[l,j]=d.useState(null),h=async()=>{try{u(!0),j(null);const[p,m]=await Promise.all([ps.getStats(),ps.getSettings()]);if(n(p),i(m),m.ha_integration_enabled)try{const g=await pt.getSensors();o(g)}catch{}}catch(p){j(p instanceof Error?p.message:"Fehler beim Laden der Einstellungen")}finally{u(!1)}};return d.useEffect(()=>{h()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:h,disabled:c,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(jt,{className:`h-5 w-5 ${c?"animate-spin":""}`})})]}),l&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:l})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:re},{value:"dark",label:"Dunkel",icon:Zs},{value:"system",label:"System",icon:Js}].map(p=>e.jsxs("button",{onClick:()=>r(p.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===p.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(p.icon,{className:"h-5 w-5"}),p.label]},p.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(lt,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:a!=null&&a.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),x.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",x.length," Energy-Sensoren verf√ºgbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Gr,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt √ºber ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen ‚Üí Import/Export"})," um deine Daten zu importieren."]})]})]}),x.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verf√ºgbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:x.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:p.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:p.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:p.unit_of_measurement||"-"})]},p.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Rs,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),c?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Oe,{className:"h-6 w-6 animate-spin text-gray-400"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),s.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(s.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",s.daten_zeitraum&&e.jsxs("span",{children:[" (",s.daten_zeitraum.von," - ",s.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",s.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(a==null?void 0:a.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verf√ºgbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"./api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]})]})}const $s=["","Jan","Feb","M√§r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function vi(){const{anlagen:t,loading:r}=Ce(),[s,n]=d.useState(),[a,i]=d.useState(null),[x,o]=d.useState([]),[c,u]=d.useState(null),[l,j]=d.useState(null),[h,p]=d.useState(null),[m,g]=d.useState(!1),[v,w]=d.useState(!1),[k,N]=d.useState(!1),[S,y]=d.useState(null),[b,W]=d.useState(null),[H,P]=d.useState(14);d.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),d.useEffect(()=>{s&&Z()},[s]);const Z=async()=>{if(s){g(!0),y(null),W(null);try{const[_,F,I]=await Promise.all([Ue.getAktivePrognose(s),Ue.listeGespeichertePrognosen(s),fr.getProvider(s).catch(()=>null)]);i(_),o(F),p(I)}catch(_){y(_ instanceof Error?_.message:"Fehler beim Laden")}finally{g(!1)}}},C=async()=>{if(s){w(!0),y(null);try{const _=await Ue.getPrognose(s,{system_losses:H});u(_)}catch(_){y(_ instanceof Error?_.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{w(!1)}}},f=async()=>{if(s){N(!0),y(null);try{const _=await Ue.getOptimum(s);j(_)}catch(_){y(_ instanceof Error?_.message:"Fehler beim Ermitteln des Optimums")}finally{N(!1)}}},$=async()=>{if(s){g(!0),y(null);try{await Ue.speicherePrognose(s,{system_losses:H}),W("Prognose erfolgreich gespeichert"),u(null),await Z()}catch(_){y(_ instanceof Error?_.message:"Fehler beim Speichern")}finally{g(!1)}}},K=async _=>{try{await Ue.aktivierePrognose(_),W("Prognose aktiviert"),await Z()}catch(F){y(F instanceof Error?F.message:"Fehler beim Aktivieren")}},O=async _=>{if(confirm("Prognose wirklich l√∂schen?"))try{await Ue.loeschePrognose(_),W("Prognose gel√∂scht"),await Z()}catch(F){y(F instanceof Error?F.message:"Fehler beim L√∂schen")}},X=t.find(_=>_.id===s),Q=(X==null?void 0:X.latitude)&&(X==null?void 0:X.longitude);return r?e.jsx(pe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"}),e.jsx(Y,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Je,{value:(s==null?void 0:s.toString())||"",onChange:_=>n(parseInt(_.target.value)),options:t.map(_=>({value:_.id.toString(),label:_.anlagenname}))}),e.jsx("button",{onClick:Z,disabled:m,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(jt,{className:`h-5 w-5 ${m?"animate-spin":""}`})})]})]}),S&&e.jsx(Y,{type:"error",children:S}),b&&e.jsx(Y,{type:"success",children:b}),!Q&&e.jsx(Y,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(yr,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte erg√§nze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu k√∂nnen."})]})]})}),Q&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),m?e.jsx(pe,{}):a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[a.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[a.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[a.neigung_grad,"¬∞"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:a.ausrichtung_richtung})]})]}),a.monatswerte&&a.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:a.monatswerte.map(_=>({name:$s[_.monat],prognose:_.e_m})),children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name"}),e.jsx(le,{tickFormatter:_=>`${_} kWh`}),e.jsx(ae,{formatter:_=>`${_.toFixed(0)} kWh`}),e.jsx(U,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(a.abgerufen_am).toLocaleDateString("de-DE")," ‚Ä¢ ","Koordinaten: ",a.latitude.toFixed(4),"¬∞N, ",a.longitude.toFixed(4),"¬∞E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:H,onChange:_=>P(parseFloat(_.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(ee,{onClick:C,disabled:v,className:"w-full",children:[v?e.jsx(jt,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),c&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(ee,{onClick:$,disabled:m,children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[c.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[c.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[c.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:c.module.length})]})]}),c.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:c.module.map(_=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:_.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[_.leistung_kwp," kWp ‚Ä¢ ",_.ausrichtung," ‚Ä¢ ",_.neigung_grad,"¬∞ ‚Ä¢ ",_.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},_.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Se,{data:c.monatsdaten.map(_=>({name:$s[_.monat],ertrag:_.e_m})),children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(le,{tickFormatter:_=>`${_}`}),e.jsx(ae,{formatter:_=>`${_.toFixed(0)} kWh`}),e.jsx(U,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(ee,{onClick:f,disabled:k,variant:"secondary",children:[k?e.jsx(jt,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter f√ºr Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[l.optimal.neigung_grad,"¬∞"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:l.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[l.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),l.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung f√ºr deinen Standort zu ermitteln.'})]}),x.length>0&&e.jsxs(M,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:x.map(_=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(_.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[_.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:_.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[_.neigung_grad,"¬∞"]}),e.jsx("td",{className:"text-center py-2 px-2",children:_.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(it,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!_.ist_aktiv&&e.jsx("button",{onClick:()=>K(_.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(it,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>O(_.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"L√∂schen",children:e.jsx(dt,{className:"h-4 w-4"})})]})})]},_.id))})]})})]}),h&&e.jsxs(M,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5"}),"Wetterdaten-Provider"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Der Wetter-Provider bestimmt die Quelle f√ºr Globalstrahlungsdaten bei der Ist-Erfassung und der Kurzfrist-Prognose. Die Einstellung kann in den Anlagen-Stammdaten ge√§ndert werden."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Aktueller Provider"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:h.aktueller_provider==="auto"?"Automatisch":h.aktueller_provider==="brightsky"?"Bright Sky (DWD)":h.aktueller_provider==="open-meteo"?"Open-Meteo":h.aktueller_provider==="open-meteo-solar"?"Open-Meteo Solar (GTI)":h.aktueller_provider})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Standort"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[h.standort.land||"Unbekannt",h.standort.in_deutschland&&" (DWD verf√ºgbar)"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Verf√ºgbare Provider"}),e.jsx("div",{className:"grid gap-2",children:h.provider.map(_=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${_.verfuegbar?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 opacity-60"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${_.verfuegbar?"text-green-700 dark:text-green-300":"text-gray-500 dark:text-gray-400"}`,children:_.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:_.beschreibung})]}),e.jsx("div",{className:"text-sm",children:_.verfuegbar?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"‚úì Verf√ºgbar"}):e.jsx("span",{className:"text-gray-400",children:"Nicht verf√ºgbar"})})]},_.id))})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"√úber Solarprognose"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"PVGIS"})," (Langfrist): EU-Tool f√ºr Ertragsprognosen basierend auf Satellitendaten und Klimamodellen. Nutzt historische TMY-Daten (Typical Meteorological Year)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Wetter-Provider"})," (Kurzfrist): Aktuelle und historische Wetterdaten f√ºr SOLL-IST-Vergleiche. Bright Sky liefert DWD-Daten (Deutschland), Open-Meteo weltweit."]}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"PVGIS-Dokumentation ‚Üí"})]})]})})]})]})}const As=`# Utility Meter f√ºr monatliche Aggregation
# F√ºge dies in deine configuration.yaml ein

utility_meter:
  # PV-Erzeugung (von deinem Wechselrichter)
  pv_erzeugung_monatlich:
    source: sensor.DEIN_WR_total_yield  # <- Anpassen!
    cycle: monthly

  # Einspeisung ins Netz
  einspeisung_monatlich:
    source: sensor.DEIN_ZAEHLER_export  # <- Anpassen!
    cycle: monthly

  # Netzbezug
  netzbezug_monatlich:
    source: sensor.DEIN_ZAEHLER_import  # <- Anpassen!
    cycle: monthly

  # Speicher Ladung (optional)
  speicher_ladung_monatlich:
    source: sensor.DEIN_SPEICHER_charge_total  # <- Anpassen!
    cycle: monthly

  # Speicher Entladung (optional)
  speicher_entladung_monatlich:
    source: sensor.DEIN_SPEICHER_discharge_total  # <- Anpassen!
    cycle: monthly

  # E-Auto Ladung (optional, z.B. von evcc)
  eauto_ladung_monatlich:
    source: sensor.evcc_loadpoint_charge_total_import  # <- Anpassen!
    cycle: monthly`,Is=`# Automation: Monatliche CSV-Export Datei erstellen
# Voraussetzung: File Integration muss eingerichtet sein

automation:
  - alias: "EEDC Monatsdaten Export"
    trigger:
      - platform: time
        at: "00:05:00"  # Am 1. des Monats um 00:05
    condition:
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: notify.file_export  # <- Anpassen an deinen File Notifier
        data:
          message: >
            {{ (now() - timedelta(days=1)).year }},{{ (now() - timedelta(days=1)).month }},{{ states('sensor.einspeisung_monatlich') }},{{ states('sensor.netzbezug_monatlich') }},{{ states('sensor.pv_erzeugung_monatlich') }}

# Hinweis: Die CSV muss dann manuell in EEDC importiert werden
# oder du erweiterst die Automation um einen REST-Call zu EEDC`;function Ni(){const[t,r]=d.useState(!1),[s,n]=d.useState(null),a=(i,x)=>{navigator.clipboard.writeText(i),n(x),setTimeout(()=>n(null),2e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Et,{className:"w-6 h-6"}),"Datenerfassung"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"So erfassen Sie Ihre monatlichen Energiedaten in EEDC"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(pr,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Manuelles Formular"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-2 py-0.5 rounded",children:"Empfohlen f√ºr Einsteiger"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Geben Sie Ihre Monatsdaten direkt im Formular ein. Ideal f√ºr gelegentliche Erfassung oder wenn Sie nur wenige Werte haben."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-500"}),"Einstellungen ‚Üí Monatsdaten ‚Üí Neu"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten k√∂nnen automatisch geladen werden"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-blue-500"}),"Investitions-Daten pro Komponente erfassen"]})]}),e.jsxs("a",{href:"#/einstellungen/monatsdaten",className:"btn btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(pr,{className:"w-4 h-4"}),"Zur Monatsdaten-Erfassung"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(tr,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV-Import"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 px-2 py-0.5 rounded",children:"Empfohlen f√ºr regelm√§√üige Erfassung"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Laden Sie Monatsdaten per CSV-Datei hoch. Perfekt f√ºr gr√∂√üere Datenmengen oder historische Daten."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-500"}),"Einstellungen ‚Üí Import/Export"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-500"}),"Vorlage herunterladen (passt zu Ihren Investitionen)"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-green-500"}),"Wetterdaten werden automatisch erg√§nzt"]})]}),e.jsxs("a",{href:"#/einstellungen/import",className:"btn btn-primary w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(tr,{className:"w-4 h-4"}),"Zum CSV-Import"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Le,{className:"w-6 h-6 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Hinweis f√ºr Home Assistant Benutzer"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"EEDC ist als Standalone-Anwendung konzipiert und ben√∂tigt keine Home Assistant Integration f√ºr die Datenerfassung. Sie k√∂nnen Ihre Daten aus HA manuell in eine CSV-Datei exportieren und in EEDC importieren."}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:[e.jsx("strong",{children:"Optional:"})," Unter Einstellungen ‚Üí HA-Export k√∂nnen Sie berechnete KPIs (Autarkie, Eigenverbrauch, etc.) per MQTT zur√ºck an Home Assistant senden."]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:e.jsxs("a",{href:"#/einstellungen/ha-export",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1",children:[e.jsx(Xt,{className:"w-3 h-3"}),"HA-Export Einstellungen"]})})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!t),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(Et,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Anleitung: CSV aus Home Assistant erstellen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"So richten Sie Utility Meter ein, um monatliche Werte f√ºr EEDC zu exportieren"})]})]}),t?e.jsx(Sa,{className:"w-5 h-5 text-gray-400"}):e.jsx(ht,{className:"w-5 h-5 text-gray-400"})]}),t&&e.jsxs("div",{className:"px-4 pb-4 space-y-6 border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"1"}),"Utility Meter einrichten"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:["Utility Meter aggregieren Ihre Sensordaten monatlich. F√ºgen Sie folgendes in Ihre"," ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"configuration.yaml"})," ein und passen Sie die Sensor-IDs an:"]}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-64",children:As}),e.jsx("button",{onClick:()=>a(As,"utility"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:s==="utility"?e.jsx(it,{className:"w-4 h-4 text-green-400"}):e.jsx(Lr,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"2"}),"Ihre Sensoren finden"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"So finden Sie die richtigen Sensor-IDs in Home Assistant:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-4",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Entwicklerwerkzeuge ‚Üí Zust√§nde"})," in HA √∂ffnen"]}),e.jsx("li",{children:'‚Ä¢ Nach "total" oder "energy" filtern'}),e.jsxs("li",{children:["‚Ä¢ Sensoren mit ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"state_class: total_increasing"})," sind ideal"]}),e.jsxs("li",{children:["‚Ä¢ Typische Namen: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_total_yield"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_energy"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_import"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_export"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"3"}),"CSV-Datei erstellen"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Am Monatsende die Utility Meter Werte ablesen und in eine CSV eintragen:"}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs font-mono overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"// Pflicht-Spalten:"}),e.jsx("div",{children:"Jahr,Monat,Einspeisung_kWh,Netzbezug_kWh"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"// Beispiel:"}),e.jsx("div",{children:"2025,12,125.9,405.5"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[e.jsx("strong",{children:"Tipp:"})," Laden Sie unter Import/Export eine Vorlage herunter - sie enth√§lt alle Spalten passend zu Ihren angelegten Investitionen!"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-gray-400 text-white text-sm flex items-center justify-center",children:"4"}),e.jsx("span",{className:"text-gray-500",children:"(Optional)"})," Automatischer Export"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"F√ºr Fortgeschrittene: Mit der File-Integration und einer Automation k√∂nnen Sie die CSV automatisch erstellen lassen:"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-48",children:Is}),e.jsx("button",{onClick:()=>a(Is,"file"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:s==="file"?e.jsx(it,{className:"w-4 h-4 text-green-400"}):e.jsx(Lr,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Wichtig:"}),' Utility Meter werden bei HA-Neustart zur√ºckgesetzt, es sei denn, Sie haben den Recorder korrekt konfiguriert. Alternativ k√∂nnen Sie auch die "Statistik"-Werte aus dem HA Energy Dashboard verwenden.']})})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"üí° Tipps f√ºr die Datenerfassung"}),e.jsxs("ul",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìÖ"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Regelm√§√üigkeit:"})," Erfassen Sie Ihre Daten am besten immer am gleichen Tag im Monat (z.B. am 1. oder letzten Tag)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"üìä"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Z√§hlerst√§nde:"})," Notieren Sie die Z√§hlerst√§nde Ihrer Wechselrichter, Speicher und Wallbox. EEDC erwartet Monatswerte (Differenz zum Vormonat)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"‚òÄÔ∏è"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wetterdaten:"})," Globalstrahlung und Sonnenstunden werden automatisch aus Open-Meteo geladen, wenn Ihre Anlage Koordinaten hat."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"üöó"}),e.jsxs("span",{children:[e.jsx("strong",{children:"E-Auto:"})," Bei externem Laden (√∂ffentliche S√§ulen) k√∂nnen Sie Ladung und Kosten separat erfassen."]})]})]})]})]})}function _i(){const[t,r]=d.useState([]),[s,n]=d.useState(null),[a,i]=d.useState(null),[x,o]=d.useState(null),[c,u]=d.useState(null),[l,j]=d.useState(!0),[h,p]=d.useState(null),[m,g]=d.useState(null),[v,w]=d.useState("core-mosquitto"),[k,N]=d.useState(1883),[S,y]=d.useState(""),[b,W]=d.useState(""),[H,P]=d.useState(null),[Z,C]=d.useState(null),[f,$]=d.useState(!1),[K,O]=d.useState(!1),[X,Q]=d.useState(!1),[_,F]=d.useState("mqtt"),[I,q]=d.useState(new Set(["energie","finanzen"])),[ne,G]=d.useState(!1),B=async()=>{try{j(!0),p(null);const[E,V,te]=await Promise.all([et.list(),pt.getExportSensors(),pt.getMqttConfig().catch(()=>null)]);r(E),i(V),te&&(g(te),w(te.host),N(te.port),y(te.username)),E.length>0&&!s&&n(E[0].id)}catch(E){p(E instanceof Error?E.message:"Fehler beim Laden")}finally{j(!1)}},he=async E=>{try{const[V,te]=await Promise.all([pt.getAnlageSensors(E),pt.getYamlSnippet(E)]);o(V),u(te)}catch(V){console.error("Fehler beim Laden der Anlage-Daten:",V)}};d.useEffect(()=>{B()},[]),d.useEffect(()=>{s&&he(s)},[s]);const Ne=async()=>{$(!0),P(null);try{const E=await pt.testMqtt({host:v,port:k,username:S||void 0,password:b||void 0});P(E)}catch(E){P({connected:!1,error:E instanceof Error?E.message:"Verbindungsfehler"})}finally{$(!1)}},_e=async()=>{if(s){O(!0),C(null);try{const E=await pt.publishMqtt(s,{host:v,port:k,username:S||void 0,password:b||void 0});C(E)}catch(E){C({message:E instanceof Error?E.message:"Fehler beim Publizieren",anlage_id:s,total:0,success:0,failed:0})}finally{O(!1)}}},ie=async()=>{if(s&&confirm("Alle EEDC-Sensoren f√ºr diese Anlage aus Home Assistant entfernen?")){Q(!0);try{await pt.removeMqtt(s,{host:v,port:k,username:S||void 0,password:b||void 0}),C(null)}catch(E){p(E instanceof Error?E.message:"Fehler beim Entfernen")}finally{Q(!1)}}},D=async()=>{if(c)try{await navigator.clipboard.writeText(c.yaml),G(!0),setTimeout(()=>G(!1),2e3)}catch{const E=document.createElement("textarea");E.value=c.yaml,document.body.appendChild(E),E.select(),document.execCommand("copy"),document.body.removeChild(E),G(!0),setTimeout(()=>G(!1),2e3)}},A=()=>{if(!c||!x)return;const E=new Blob([c.yaml],{type:"text/yaml"}),V=URL.createObjectURL(E),te=document.createElement("a");te.href=V,te.download=`eedc_sensors_${x.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(te),te.click(),document.body.removeChild(te),URL.revokeObjectURL(V)},T=E=>{q(V=>{const te=new Set(V);return te.has(E)?te.delete(E):te.add(E),te})},ue=E=>{const V={};return E.forEach(te=>{const Me=te.category||"sonstige";V[Me]||(V[Me]=[]),V[Me].push(te)}),V},ye={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},me={energie:"‚ö°",finanzen:"üí∞",autarkie:"üè†",umwelt:"üå±",performance:"üìä",sonstige:"üìå"};return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Oe,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:B,disabled:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(jt,{className:`h-5 w-5 ${l?"animate-spin":""}`})})]}),h&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Le,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO‚ÇÇ, ROI) als Sensoren an Home Assistant zur√ºckgeben. W√§hle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entit√§ten)."})]})]}),t.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage ausw√§hlen"}),e.jsx("select",{value:s||"",onChange:E=>n(Number(E.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:t.map(E=>e.jsx("option",{value:E.id,children:E.anlagenname},E.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>F("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${_==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>F("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${_==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),_==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),m&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:v,onChange:E=>w(E.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:k,onChange:E=>N(Number(E.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:S,onChange:E=>y(E.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:b,onChange:E=>W(E.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),H&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${H.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:H.connected?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",H.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Gr,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:H.error})]})}),H.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:H.hint})]}),Z&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${Z.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[Z.success," von ",Z.total," Sensoren publiziert"]})]}),Z.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[Z.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:Ne,disabled:f,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[f?e.jsx(Oe,{className:"w-4 h-4 animate-spin"}):e.jsx(jt,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:_e,disabled:K||!s,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[K?e.jsx(Oe,{className:"w-4 h-4 animate-spin"}):e.jsx(Ka,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:ie,disabled:X||!s,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[X?e.jsx(Oe,{className:"w-4 h-4 animate-spin"}):e.jsx(dt,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${m!=null&&m.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[m!=null&&m.auto_publish?e.jsx(Xe,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(Re,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${m!=null&&m.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen ‚Üí Ger√§te & Dienste ‚Üí MQTT"}),".",m!=null&&m.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",m.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelm√§√üig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen f√ºr automatische Updates."]})]})]})]})]}),_==="rest"&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML f√ºr configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:ne?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Lr,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:A,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:c.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:c.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Le,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["F√ºge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",c.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach √Ñnderungen muss Home Assistant neu gestartet werden."]})]})]})]}),x&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verf√ºgbare Sensoren (",x.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(ue(x.sensors)).map(([E,V])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>T(E),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:me[E]||"üìå"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ye[E]||E}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",V.length,")"]})]}),I.has(E)?e.jsx(ht,{className:"w-5 h-5 text-gray-400"}):e.jsx(rt,{className:"w-5 h-5 text-gray-400"})]}),I.has(E)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:V.map(te=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:te.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:te.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:te.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:te.value!==null?typeof te.value=="number"?te.value.toLocaleString("de-DE",{maximumFractionDigits:2}):te.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:te.unit})]})]}),te.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",te.formel,te.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",te.berechnung]})]})]},te.key))})]},E))})]}),a&&a.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:a.investitionen.map(E=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:E.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",E.typ," - ",E.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:E.sensors.map(V=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:V.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:V.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:V.value!==null?typeof V.value=="number"?V.value.toLocaleString("de-DE",{maximumFractionDigits:2}):V.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:V.unit})]})]},V.key))})]},E.investition_id))})]})]})}function zi({value:t,onChange:r,sensors:s,placeholder:n}){const[a,i]=d.useState(""),[x,o]=d.useState(!1),c=s.filter(h=>{var p;return h.entity_id.toLowerCase().includes(a.toLowerCase())||((p=h.friendly_name)==null?void 0:p.toLowerCase().includes(a.toLowerCase()))}),u=s.find(h=>h.entity_id===t),l=d.useCallback(h=>{r(h),i(""),o(!1)},[r]),j=d.useCallback(()=>{r(null),i("")},[r]);return e.jsxs("div",{className:"relative",children:[t&&u?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsx("span",{className:"flex-1 text-sm truncate",children:u.friendly_name||u.entity_id}),e.jsx("button",{onClick:j,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Mt,{className:"w-4 h-4 text-gray-500"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(Us,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:a,onChange:h=>{i(h.target.value),o(!0)},onFocus:()=>o(!0),placeholder:n||"Sensor suchen...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),x&&!t&&e.jsx("div",{className:"absolute z-10 w-full mt-1 max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:c.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:a?"Keine Sensoren gefunden":"Sensor eingeben..."}):c.slice(0,50).map(h=>e.jsxs("button",{onClick:()=>l(h.entity_id),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:h.friendly_name||h.entity_id}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[h.entity_id,h.unit&&` (${h.unit})`,h.state&&` - ${h.state}`]})]},h.entity_id))})]})}function Be({label:t,einheit:r,value:s,onChange:n,availableSensors:a,strategieOptionen:i,defaultStrategie:x="sensor",kwpAnteil:o,copDefault:c}){const u=(s==null?void 0:s.strategie)||x,l=p=>{p==="keine"?n({strategie:"keine"}):p==="manuell"?n({strategie:"manuell"}):p==="sensor"?n({strategie:"sensor",sensor_id:(s==null?void 0:s.sensor_id)||null}):p==="kwp_verteilung"?n({strategie:"kwp_verteilung",parameter:{anteil:o||0,basis_sensor:"pv_gesamt"}}):p==="cop_berechnung"?n({strategie:"cop_berechnung",parameter:{cop:c||3.5,basis_feld:"stromverbrauch_kwh"}}):p==="ev_quote"&&n({strategie:"ev_quote",parameter:{}})},j=p=>{n({strategie:"sensor",sensor_id:p})},h=p=>{n({strategie:"cop_berechnung",parameter:{...s==null?void 0:s.parameter,cop:p}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",r,")"]})]})}),e.jsx("div",{className:"space-y-3",children:i.map(p=>{var m;return e.jsxs("label",{className:`
              flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-colors
              ${u===p.value?"bg-amber-50 dark:bg-amber-900/20 ring-1 ring-amber-500":"hover:bg-gray-50 dark:hover:bg-gray-700/50"}
            `,children:[e.jsx("input",{type:"radio",name:`strategie-${t}`,checked:u===p.value,onChange:()=>l(p.value),className:"mt-1 w-4 h-4 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:p.label}),p.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:p.description}),u==="sensor"&&p.value==="sensor"&&e.jsx("div",{className:"mt-3",children:e.jsx(zi,{value:s==null?void 0:s.sensor_id,onChange:j,sensors:a})}),u==="kwp_verteilung"&&p.value==="kwp_verteilung"&&o!==void 0&&e.jsxs("div",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400",children:[(o*100).toFixed(1),"% von PV Gesamt"]}),u==="cop_berechnung"&&p.value==="cop_berechnung"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"COP:"}),e.jsx("input",{type:"number",step:"0.1",min:"1",max:"10",value:((m=s==null?void 0:s.parameter)==null?void 0:m.cop)||c||3.5,onChange:g=>h(parseFloat(g.target.value)||3.5),className:"w-20 px-2 py-1 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-amber-500"})]})]})]},p.value)})})]})}function Si({value:t,onChange:r,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant Sensor lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard manuell erfassen"}],a=[{value:"sensor",label:"HA-Sensor",description:"PV-Gesamterzeugung aus Wechselrichter-Sensor"},{value:"keine",label:"Nicht verwenden",description:"Jeder PV-String hat einen eigenen Sensor"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{type:"info",title:"Basis-Sensoren",children:"Diese sind die Grundlage f√ºr alle Energie-Berechnungen. Die Werte werden typischerweise vom Stromz√§hler oder Wechselrichter erfasst."}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(tr,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Be,{label:"Einspeisung",einheit:"kWh",value:t.einspeisung,onChange:i=>r("einspeisung",i),availableSensors:s,strategieOptionen:n})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(qe,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Be,{label:"Netzbezug",einheit:"kWh",value:t.netzbezug,onChange:i=>r("netzbezug",i),availableSensors:s,strategieOptionen:n})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(xe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Be,{label:"PV Erzeugung Gesamt",einheit:"kWh",value:t.pv_gesamt,onChange:i=>r("pv_gesamt",i),availableSensors:s,strategieOptionen:a,defaultStrategie:"keine"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Optional: Wenn du mehrere PV-Strings hast, aber nur einen Gesamtsensor, kann die Erzeugung anteilig nach kWp auf die Strings verteilt werden."})]})]})]})}function Ei({investitionen:t,mappings:r,onChange:s,availableSensors:n,gesamtKwp:a,basisPvGesamt:i}){const x=(i==null?void 0:i.strategie)==="sensor"&&(i==null?void 0:i.sensor_id);return e.jsxs("div",{className:"space-y-6",children:[t.length>1&&e.jsx(Y,{type:"info",title:x?"kWp-Verteilung verf√ºgbar":"Tipp",children:x?e.jsx(e.Fragment,{children:"Du hast einen PV-Gesamt-Sensor konfiguriert. Die Erzeugung kann anteilig auf die einzelnen Strings verteilt werden."}):e.jsx(e.Fragment,{children:'Wenn du keinen separaten Sensor pro String hast, konfiguriere zuerst unter "Basis-Sensoren" einen PV-Gesamt-Sensor.'})}),t.map(o=>{var l,j;const c=a>0&&o.kwp?o.kwp/a:0,u=[{value:"sensor",label:"Eigener Sensor",description:"Separater Sensor f√ºr diesen PV-String"}];return x&&c>0&&u.push({value:"kwp_verteilung",label:`kWp-Verteilung (${(c*100).toFixed(1)}%)`,description:`${(l=o.kwp)==null?void 0:l.toFixed(1)} kWp von ${a.toFixed(1)} kWp gesamt`}),u.push({value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung}),o.kwp&&e.jsxs("div",{className:"text-xs text-gray-500",children:[o.kwp.toFixed(1)," kWp",c>0&&` (${(c*100).toFixed(1)}%)`]})]})]}),e.jsx("div",{className:"p-4",children:e.jsx(Be,{label:"PV-Erzeugung",einheit:"kWh",value:((j=r[o.id.toString()])==null?void 0:j.pv_erzeugung_kwh)||null,onChange:h=>s(o.id,"pv_erzeugung_kwh",h),availableSensors:n,strategieOptionen:u,kwpAnteil:c,defaultStrategie:x&&c>0?"kwp_verteilung":"sensor"})})]},o.id)})]})}function Fi({investitionen:t,mappings:r,onChange:s,availableSensors:n}){const a=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor f√ºr Netzladung"},{value:"keine",label:"Nicht erfassen",description:"Speicher wird nicht aus dem Netz geladen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}];return e.jsx("div",{className:"space-y-6",children:t.map(x=>{var o,c,u;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:x.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Be,{label:"Ladung",einheit:"kWh",value:((o=r[x.id.toString()])==null?void 0:o.ladung_kwh)||null,onChange:l=>s(x.id,"ladung_kwh",l),availableSensors:n,strategieOptionen:a}),e.jsx(Be,{label:"Entladung",einheit:"kWh",value:((c=r[x.id.toString()])==null?void 0:c.entladung_kwh)||null,onChange:l=>s(x.id,"entladung_kwh",l),availableSensors:n,strategieOptionen:a}),e.jsx(Be,{label:"Netzladung",einheit:"kWh",value:((u=r[x.id.toString()])==null?void 0:u.ladung_netz_kwh)||null,onChange:l=>s(x.id,"ladung_netz_kwh",l),availableSensors:n,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2 ml-1",children:"Netzladung wird f√ºr Arbitrage-Auswertung (Speicher aus Netz laden) ben√∂tigt."})]})]},x.id)})})}function Wi({investitionen:t,mappings:r,onChange:s,availableSensors:n}){const a=[{value:"sensor",label:"HA-Sensor",description:"Stromverbrauch aus Energiemessung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"W√§rmemengenz√§hler",description:"Direkte Messung der Heizenergie"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Stromverbrauch √ó COP (JAZ)"}],x=[{value:"sensor",label:"W√§rmemengenz√§hler",description:"Separater Sensor f√ºr Warmwasser"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Anteil Strom √ó COP"},{value:"keine",label:"Nicht separat erfassen",description:"Warmwasser ist in Heizenergie enthalten"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{type:"info",title:"COP-Berechnung",children:"Wenn kein W√§rmemengenz√§hler vorhanden ist, kann die Heizenergie √ºber den COP (Coefficient of Performance) berechnet werden. Der COP sollte aus den Investitions-Parametern √ºbernommen werden."}),t.map(o=>{var c,u,l;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Wt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung}),o.cop&&e.jsxs("div",{className:"text-xs text-gray-500",children:["JAZ/COP: ",o.cop.toFixed(1)]})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-amber-100 dark:bg-amber-900/30 rounded flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(xe,{className:"w-3 h-3 text-amber-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Be,{label:"Stromverbrauch",einheit:"kWh",value:((c=r[o.id.toString()])==null?void 0:c.stromverbrauch_kwh)||null,onChange:j=>s(o.id,"stromverbrauch_kwh",j),availableSensors:n,strategieOptionen:a})})]}),e.jsx(Be,{label:"Heizenergie",einheit:"kWh",value:((u=r[o.id.toString()])==null?void 0:u.heizenergie_kwh)||null,onChange:j=>s(o.id,"heizenergie_kwh",j),availableSensors:n,strategieOptionen:i,copDefault:o.cop||3.5}),e.jsx(Be,{label:"Warmwasser",einheit:"kWh",value:((l=r[o.id.toString()])==null?void 0:l.warmwasser_kwh)||null,onChange:j=>s(o.id,"warmwasser_kwh",j),availableSensors:n,strategieOptionen:x,copDefault:o.cop?o.cop-.5:3,defaultStrategie:"keine"})]})]},o.id)})]})}function Mi({investitionen:t,mappings:r,onChange:s,availableSensors:n}){const a=t.filter(l=>l.typ==="e-auto"),i=t.filter(l=>l.typ==="wallbox"),x=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],o=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor f√ºr Netzladung"},{value:"ev_quote",label:"EV-Quote berechnen",description:"Basierend auf Anlagen-Eigenverbrauchsquote"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],c=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Kilometerstand monatlich erfassen"}],u=[{value:"sensor",label:"HA-Sensor",description:"V2H/V2G Entladung"},{value:"keine",label:"Nicht vorhanden",description:"Kein Vehicle-to-Home"}];return e.jsxs("div",{className:"space-y-6",children:[a.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"E-Autos"]}),a.map(l=>{var j,h,p,m;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:l.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Be,{label:"Ladung PV",einheit:"kWh",value:((j=r[l.id.toString()])==null?void 0:j.ladung_pv_kwh)||null,onChange:g=>s(l.id,"ladung_pv_kwh",g),availableSensors:n,strategieOptionen:x}),e.jsx(Be,{label:"Ladung Netz",einheit:"kWh",value:((h=r[l.id.toString()])==null?void 0:h.ladung_netz_kwh)||null,onChange:g=>s(l.id,"ladung_netz_kwh",g),availableSensors:n,strategieOptionen:o}),e.jsx(Be,{label:"Gefahrene Kilometer",einheit:"km",value:((p=r[l.id.toString()])==null?void 0:p.km_gefahren)||null,onChange:g=>s(l.id,"km_gefahren",g),availableSensors:n,strategieOptionen:c,defaultStrategie:"manuell"}),e.jsx(Be,{label:"V2H Entladung",einheit:"kWh",value:((m=r[l.id.toString()])==null?void 0:m.v2h_entladung_kwh)||null,onChange:g=>s(l.id,"v2h_entladung_kwh",g),availableSensors:n,strategieOptionen:u,defaultStrategie:"keine"})]})]},l.id)})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2 mt-8",children:[e.jsx(us,{className:"w-5 h-5"}),"Wallboxen"]}),e.jsx(Y,{type:"info",children:"Wallbox-Ladung wird f√ºr die Gesamt√ºbersicht verwendet. Die Zuordnung PV/Netz erfolgt √ºber die E-Auto-Konfiguration."}),i.map(l=>{var j;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(us,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:l.bezeichnung})})]}),e.jsx("div",{className:"p-4",children:e.jsx(Be,{label:"Ladung Gesamt",einheit:"kWh",value:((j=r[l.id.toString()])==null?void 0:j.ladung_kwh)||null,onChange:h=>s(l.id,"ladung_kwh",h),availableSensors:n,strategieOptionen:x})})]},l.id)})]})]})}const Ci={sensor:e.jsx(Ys,{className:"w-4 h-4 text-green-500"}),kwp_verteilung:e.jsx(er,{className:"w-4 h-4 text-blue-500"}),cop_berechnung:e.jsx(Bs,{className:"w-4 h-4 text-purple-500"}),ev_quote:e.jsx(er,{className:"w-4 h-4 text-amber-500"}),manuell:e.jsx(pr,{className:"w-4 h-4 text-gray-500"}),keine:e.jsx(Gs,{className:"w-4 h-4 text-gray-400"})},$i={sensor:"HA-Sensor",kwp_verteilung:"kWp-Verteilung",cop_berechnung:"COP-Berechnung",ev_quote:"EV-Quote",manuell:"Manuell",keine:"Nicht erfassen"},Ai={"pv-module":e.jsx(re,{className:"w-4 h-4"}),speicher:e.jsx(fe,{className:"w-4 h-4"}),waermepumpe:e.jsx(Wt,{className:"w-4 h-4"}),"e-auto":e.jsx(ve,{className:"w-4 h-4"}),wallbox:e.jsx(xe,{className:"w-4 h-4"})};function xr({label:t,mapping:r}){var s,n;return r?e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[Ci[r.strategie],e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:$i[r.strategie]}),r.strategie==="sensor"&&r.sensor_id&&e.jsxs("span",{className:"text-xs text-gray-500 max-w-[200px] truncate",children:["(",r.sensor_id,")"]}),r.strategie==="cop_berechnung"&&((s=r.parameter)==null?void 0:s.cop)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(COP: ",r.parameter.cop,")"]}),r.strategie==="kwp_verteilung"&&((n=r.parameter)==null?void 0:n.anteil)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(r.parameter.anteil*100).toFixed(1),"%)"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsx("span",{className:"text-sm text-gray-400 italic",children:"Nicht konfiguriert"})]})}function Ii({state:t,investitionen:r}){const s={sensor:0,kwp_verteilung:0,cop_berechnung:0,ev_quote:0,manuell:0,keine:0},n=i=>{i!=null&&i.strategie&&s[i.strategie]++};n(t.basis.einspeisung),n(t.basis.netzbezug),n(t.basis.pv_gesamt),Object.values(t.investitionen).forEach(i=>{Object.values(i).forEach(x=>{n(x)})});const a=s.sensor+s.kwp_verteilung+s.cop_berechnung+s.ev_quote+s.manuell;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(Lt,{icon:e.jsx(Ys,{className:"w-5 h-5 text-green-500"}),label:"HA-Sensor",count:s.sensor}),e.jsx(Lt,{icon:e.jsx(er,{className:"w-5 h-5 text-blue-500"}),label:"kWp-Verteilung",count:s.kwp_verteilung}),e.jsx(Lt,{icon:e.jsx(Bs,{className:"w-5 h-5 text-purple-500"}),label:"COP-Berechnung",count:s.cop_berechnung}),e.jsx(Lt,{icon:e.jsx(er,{className:"w-5 h-5 text-amber-500"}),label:"EV-Quote",count:s.ev_quote}),e.jsx(Lt,{icon:e.jsx(pr,{className:"w-5 h-5 text-gray-500"}),label:"Manuell",count:s.manuell}),e.jsx(Lt,{icon:e.jsx(Gs,{className:"w-5 h-5 text-gray-400"}),label:"Keine",count:s.keine})]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[a," Felder konfiguriert"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Basis-Sensoren"})]}),e.jsxs("div",{className:"px-4 py-2",children:[e.jsx(xr,{label:"Einspeisung",mapping:t.basis.einspeisung}),e.jsx(xr,{label:"Netzbezug",mapping:t.basis.netzbezug}),e.jsx(xr,{label:"PV Gesamt",mapping:t.basis.pv_gesamt})]})]}),r.map(i=>{const x=t.investitionen[i.id.toString()]||{};return Object.keys(x).length===0?null:e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:Ai[i.typ]||e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:i.bezeichnung}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.typ,")"]})]}),e.jsx("div",{className:"px-4 py-2",children:Object.entries(x).map(([o,c])=>e.jsx(xr,{label:o.replace(/_/g," ").replace("kwh","(kWh)"),mapping:c},o))})]},i.id)})]})}function Lt({icon:t,label:r,count:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"flex justify-center mb-1",children:t}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:s}),e.jsx("div",{className:"text-xs text-gray-500",children:r})]})}const Pi={basis:{einspeisung:null,netzbezug:null,pv_gesamt:null},investitionen:{}};function Li(){var he,Ne,_e;const t=$t(),[r]=ga(),s=r.get("anlage"),n=s?parseInt(s,10):null,[a,i]=d.useState(0),[x,o]=d.useState(Pi),[c,u]=d.useState(null),[l,j]=d.useState(!1),[h,p]=d.useState(!1),[m,g]=d.useState(!1),[v,w]=d.useState(null),[k,N]=d.useState(null),[S,y]=d.useState(null),[b,W]=d.useState([]),[H,P]=d.useState(!0),[Z,C]=d.useState(null),f=n||((he=k==null?void 0:k[0])==null?void 0:he.id);d.useEffect(()=>{async function ie(){var D,A,T,ue;P(!0),C(null);try{if(!n){const V=await et.list();if(N(V),!V.length){P(!1);return}}const ye=n||((D=k==null?void 0:k[0])==null?void 0:D.id);if(!ye)return;const[me,E]=await Promise.all([ir.getMapping(ye),ir.getAvailableSensors(ye).catch(()=>[])]);if(y(me),W(E),me!=null&&me.mapping){const V=me.mapping;o({basis:{einspeisung:((A=V.basis)==null?void 0:A.einspeisung)||null,netzbezug:((T=V.basis)==null?void 0:T.netzbezug)||null,pv_gesamt:((ue=V.basis)==null?void 0:ue.pv_gesamt)||null},investitionen:Object.fromEntries(Object.entries(V.investitionen||{}).map(([te,Me])=>[te,Me.felder||{}]))})}}catch(ye){C(ye.message||"Fehler beim Laden")}finally{P(!1)}}ie()},[n,(Ne=k==null?void 0:k[0])==null?void 0:Ne.id]);const $=d.useMemo(()=>{var A,T,ue,ye,me;if(!S)return[];const ie=[{id:"basis",title:"Basis-Sensoren",icon:e.jsx(xe,{className:"w-5 h-5"})}],D=S.investitionen.reduce((E,V)=>(E[V.typ]||(E[V.typ]=[]),E[V.typ].push(V),E),{});return(A=D["pv-module"])!=null&&A.length&&ie.push({id:"pv",title:"PV-Module",icon:e.jsx(re,{className:"w-5 h-5"}),investitionen:D["pv-module"]}),(T=D.speicher)!=null&&T.length&&ie.push({id:"speicher",title:"Speicher",icon:e.jsx(fe,{className:"w-5 h-5"}),investitionen:D.speicher}),(ue=D.waermepumpe)!=null&&ue.length&&ie.push({id:"wp",title:"W√§rmepumpe",icon:e.jsx(Wt,{className:"w-5 h-5"}),investitionen:D.waermepumpe}),((ye=D["e-auto"])!=null&&ye.length||(me=D.wallbox)!=null&&me.length)&&ie.push({id:"eauto",title:"E-Auto & Wallbox",icon:e.jsx(ve,{className:"w-5 h-5"}),investitionen:[...D["e-auto"]||[],...D.wallbox||[]]}),ie.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(zt,{className:"w-5 h-5"})}),ie},[S]),K=d.useCallback((ie,D)=>{o(A=>({...A,basis:{...A.basis,[ie]:D}}))},[]),O=d.useCallback((ie,D,A)=>{A&&o(T=>({...T,investitionen:{...T.investitionen,[ie.toString()]:{...T.investitionen[ie.toString()],[D]:A}}}))},[]),X=d.useCallback(async()=>{if(f){j(!0),u(null);try{const ie={basis:{einspeisung:x.basis.einspeisung,netzbezug:x.basis.netzbezug,pv_gesamt:x.basis.pv_gesamt},investitionen:Object.fromEntries(Object.entries(x.investitionen).map(([D,A])=>[D,{felder:A}]))};await ir.saveMapping(f,ie),p(!0)}catch(ie){u(ie.message||"Fehler beim Speichern")}finally{j(!1)}}},[x,f]),Q=d.useCallback(async()=>{if(f){g(!0);try{const ie=await ir.initStartValues(f);w(ie)}catch(ie){w({success:!1,message:ie.message||"Fehler beim Initialisieren",updated_fields:0})}finally{g(!1)}}},[f]),_=d.useCallback(()=>{t("/einstellungen/ha-export?saved=true")},[t]),F=a<$.length-1,I=a>0,q=a===$.length-1,ne=()=>{F&&i(ie=>ie+1)},G=()=>{I&&i(ie=>ie-1)};if(!f&&!H)return e.jsx("div",{className:"p-6",children:e.jsx(Y,{type:"warning",children:"Keine Anlage vorhanden. Bitte zuerst eine Anlage erstellen."})});if(H)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Oe,{className:"w-8 h-8 animate-spin text-amber-500"})});if(Z)return e.jsx("div",{className:"p-6",children:e.jsxs(Y,{type:"error",children:["Fehler beim Laden: ",Z]})});if(h)return e.jsx("div",{className:"max-w-2xl mx-auto p-6 space-y-6",children:e.jsxs(M,{children:[e.jsx(js,{title:"Sensor-Zuordnung gespeichert",subtitle:"MQTT-Sensoren wurden erfolgreich erstellt"}),e.jsx("div",{className:"mt-6 space-y-4",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Y,{type:v.success?"success":"error",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:v.message}),v.updated_fields>0&&e.jsxs("p",{className:"text-sm opacity-80",children:[v.updated_fields," Startwert(e) wurden in Home Assistant gesetzt."]})]})}),e.jsxs(ee,{onClick:_,children:[e.jsx(zt,{className:"w-4 h-4 mr-2"}),"Fertig"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{type:"info",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"M√∂chten Sie die Monatsstart-Werte jetzt initialisieren?"}),e.jsx("p",{className:"text-sm opacity-80",children:"Die aktuellen Z√§hlerst√§nde werden als Startwerte f√ºr die Monatsberechnung gesetzt. Der berechnete Monatswert startet dann bei 0 und steigt mit der Zeit."}),e.jsx("p",{className:"text-sm opacity-80",children:"Dies ist nur beim ersten Setup n√∂tig. Danach werden die Startwerte automatisch am 1. jedes Monats aktualisiert."})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ee,{onClick:Q,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Initialisiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Startwerte initialisieren"]})}),e.jsx(ee,{variant:"secondary",onClick:_,children:"√úberspringen"})]})]})})]})});if($.length===0)return e.jsx("div",{className:"p-6",children:e.jsx(Y,{type:"info",children:"Keine Konfiguration erforderlich. Bitte zuerst Investitionen (PV-Module, Speicher, etc.) anlegen."})});const B=$[a];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sensor-Zuordnung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[S==null?void 0:S.anlage_name," - Home Assistant Sensoren konfigurieren"]})]}),e.jsx(ee,{variant:"secondary",onClick:()=>t(-1),children:"Abbrechen"})]}),e.jsx(M,{padding:"sm",children:e.jsx("div",{className:"flex items-center overflow-x-auto py-2",children:$.map((ie,D)=>{const A=D<a,T=D===a;return e.jsxs("div",{className:"flex items-center flex-shrink-0",children:[e.jsxs("button",{onClick:()=>i(D),className:`
                    flex items-center gap-2 px-3 py-2 rounded-lg transition-all
                    ${T?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":A?"text-green-600 dark:text-green-400 hover:bg-gray-100 dark:hover:bg-gray-700":"text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("div",{className:`
                      w-7 h-7 rounded-full flex items-center justify-center text-sm
                      ${A?"bg-green-500 text-white":T?"bg-amber-500 text-white":"bg-gray-200 dark:bg-gray-700"}
                    `,children:A?e.jsx(zt,{className:"w-4 h-4"}):D+1}),e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:ie.title})]}),D<$.length-1&&e.jsx(rt,{className:"w-5 h-5 text-gray-300 dark:text-gray-600 mx-1"})]},ie.id)})})}),e.jsxs(M,{children:[e.jsx(js,{title:B.title,subtitle:B.id==="basis"?"Ordne die grundlegenden Energie-Sensoren zu":B.id==="summary"?"√úberpr√ºfe deine Einstellungen":`Konfiguriere die Sensoren f√ºr ${((_e=B.investitionen)==null?void 0:_e.length)||0} Komponente(n)`,action:e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[B.icon,e.jsxs("span",{className:"text-sm",children:[a+1," / ",$.length]})]})}),e.jsxs("div",{className:"mt-6",children:[B.id==="basis"&&e.jsx(Si,{value:x.basis,onChange:K,availableSensors:b}),B.id==="pv"&&e.jsx(Ei,{investitionen:B.investitionen||[],mappings:x.investitionen,onChange:O,availableSensors:b,gesamtKwp:(S==null?void 0:S.gesamt_kwp)||0,basisPvGesamt:x.basis.pv_gesamt}),B.id==="speicher"&&e.jsx(Fi,{investitionen:B.investitionen||[],mappings:x.investitionen,onChange:O,availableSensors:b}),B.id==="wp"&&e.jsx(Wi,{investitionen:B.investitionen||[],mappings:x.investitionen,onChange:O,availableSensors:b}),B.id==="eauto"&&e.jsx(Mi,{investitionen:B.investitionen||[],mappings:x.investitionen,onChange:O,availableSensors:b}),B.id==="summary"&&e.jsx(Ii,{state:x,investitionen:(S==null?void 0:S.investitionen)||[]})]}),c&&e.jsxs(Y,{type:"error",className:"mt-6",children:[e.jsx(Ie,{className:"w-4 h-4 inline mr-2"}),c]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(ee,{variant:"secondary",onClick:G,disabled:!I,children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),"Zur√ºck"]}),q?e.jsx(ee,{onClick:X,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"w-4 h-4 mr-2"}),"Speichern & Abschlie√üen"]})}):e.jsxs(ee,{onClick:ne,children:["Weiter",e.jsx(rt,{className:"w-4 h-4 ml-2"})]})]})]})]})}const Di=["","Januar","Februar","M√§rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],Xr={"pv-module":e.jsx(re,{className:"w-5 h-5"}),speicher:e.jsx(fe,{className:"w-5 h-5"}),waermepumpe:e.jsx(Wt,{className:"w-5 h-5"}),"e-auto":e.jsx(ve,{className:"w-5 h-5"}),wallbox:e.jsx(xe,{className:"w-5 h-5"})};function Mr(){const{anlageId:t,jahr:r,monat:s}=ha(),n=$t(),[a,i]=d.useState(!0),[x,o]=d.useState(!1),[c,u]=d.useState(null),[l,j]=d.useState(null),[h,p]=d.useState(""),[m,g]=d.useState(null),[v,w]=d.useState(0),[k,N]=d.useState({basis:{},optionale:{},investitionen:{}}),[S,y]=d.useState(r?parseInt(r):new Date().getFullYear()),[b,W]=d.useState(s?parseInt(s):new Date().getMonth()+1);d.useEffect(()=>{(async()=>{if(!t){try{const $=await et.list();$.length>0?n(`/monatsabschluss/${$[0].id}`):u("Keine Anlage gefunden")}catch{u("Fehler beim Laden der Anlagen")}i(!1);return}i(!0),u(null);try{let $=S,K=b;if(!r||!s){const F=await Nr.getNaechsterMonat(parseInt(t));F&&($=F.jahr,K=F.monat,y($),W(K))}const O=await Nr.getStatus(parseInt(t),$,K);g(O),p(O.anlage_name);const X={};for(const F of O.basis_felder)X[F.feld]=F.aktueller_wert;const Q={};for(const F of O.optionale_felder||[])F.typ==="text"?Q[F.feld]=F.aktueller_text:Q[F.feld]=F.aktueller_wert;const _={};for(const F of O.investitionen){_[F.id]={};for(const I of F.felder)_[F.id][I.feld]=I.aktueller_wert}N({basis:X,optionale:Q,investitionen:_})}catch($){u("Fehler beim Laden der Monatsdaten"),console.error($)}finally{i(!1)}})()},[t,r,s,S,b,n]);const H=d.useMemo(()=>{if(!m)return[];const f=[{id:"basis",title:"Z√§hlerdaten",icon:e.jsx(xe,{className:"w-4 h-4"})}],$={};for(const K of m.investitionen)$[K.typ]||($[K.typ]=[]),$[K.typ].push(K);for(const K of Object.keys($))f.push({id:K,title:ia(K),icon:Xr[K]||e.jsx(xe,{className:"w-4 h-4"})});return m.optionale_felder&&m.optionale_felder.length>0&&f.push({id:"optionale",title:"Sonstiges",icon:e.jsx(kr,{className:"w-4 h-4"})}),f.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(Xe,{className:"w-4 h-4"})}),f},[m]),P=(f,$,K)=>{N(K?O=>({...O,investitionen:{...O.investitionen,[K]:{...O.investitionen[K],[f]:$}}}):O=>({...O,basis:{...O.basis,[f]:$}}))},Z=(f,$)=>{N(K=>({...K,optionale:{...K.optionale,[f]:$}}))},C=async()=>{if(!(!m||!t)){o(!0),u(null),j(null);try{const f={einspeisung_kwh:k.basis.einspeisung_kwh,netzbezug_kwh:k.basis.netzbezug_kwh,globalstrahlung_kwh_m2:k.basis.globalstrahlung_kwh_m2,sonnenstunden:k.basis.sonnenstunden,durchschnittstemperatur:k.basis.durchschnittstemperatur,sonderkosten_euro:typeof k.optionale.sonderkosten_euro=="number"?k.optionale.sonderkosten_euro:null,sonderkosten_beschreibung:typeof k.optionale.sonderkosten_beschreibung=="string"?k.optionale.sonderkosten_beschreibung:null,notizen:typeof k.optionale.notizen=="string"?k.optionale.notizen:null,investitionen:[]};for(const K of m.investitionen){const O=[],X=k.investitionen[K.id]||{};for(const[Q,_]of Object.entries(X))_!=null&&O.push({feld:Q,wert:_});O.length>0&&f.investitionen.push({investition_id:K.id,felder:O})}const $=await Nr.save(parseInt(t),S,b,f);$.success?(j($.message),setTimeout(()=>{n("/einstellungen/monatsdaten")},2e3)):u("Speichern fehlgeschlagen")}catch(f){u("Fehler beim Speichern"),console.error(f)}finally{o(!1)}}};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Oe,{className:"w-8 h-8 animate-spin text-primary-500"})}):c&&!m?e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(Y,{type:"error",children:c})}):m?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx("span",{children:h})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Monatsabschluss ",Di[b]," ",S]}),!m.ha_mapping_konfiguriert&&e.jsx(Y,{type:"info",className:"mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Home Assistant Sensor-Zuordnung nicht konfiguriert. Werte m√ºssen manuell eingegeben werden."}),e.jsxs(xa,{to:`/einstellungen/sensor-mapping?anlageId=${t}`,className:"flex items-center gap-1 text-primary-600 hover:underline",children:[e.jsx(Rr,{className:"w-4 h-4"}),"Konfigurieren"]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:H.map((f,$)=>e.jsxs("button",{onClick:()=>w($),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${v===$?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:[f.icon,e.jsx("span",{className:"hidden sm:inline",children:f.title})]},f.id))})}),c&&e.jsx(Y,{type:"error",className:"mb-6",children:c}),l&&e.jsx(Y,{type:"success",className:"mb-6",children:l}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-8",children:[v===0&&e.jsx(Vi,{felder:m.basis_felder,values:k.basis,onChange:(f,$)=>P(f,$)}),v>0&&v<H.length-1&&H[v].id!=="optionale"&&e.jsx(Bi,{typ:H[v].id,investitionen:m.investitionen.filter(f=>f.typ===H[v].id),values:k.investitionen,onChange:(f,$,K)=>P($,K,f)}),H[v].id==="optionale"&&e.jsx(Ki,{felder:m.optionale_felder||[],values:k.optionale,onChange:Z}),v===H.length-1&&e.jsx(Oi,{data:m,values:k})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>w(f=>Math.max(0,f-1)),disabled:v===0,className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Os,{className:"w-4 h-4"}),"Zur√ºck"]}),v<H.length-1?e.jsxs("button",{onClick:()=>w(f=>Math.min(H.length-1,f+1)),className:"flex items-center gap-2 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:["Weiter",e.jsx(rt,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:C,disabled:x,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Va,{className:"w-4 h-4"}),"Speichern"]})})]})]}):e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(Y,{type:"info",children:"Keine Daten verf√ºgbar"})})}function Vi({felder:t,values:r,onChange:s}){const n=["einspeisung_kwh","netzbezug_kwh"],a=["globalstrahlung_kwh_m2","sonnenstunden","durchschnittstemperatur"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-amber-500"}),"Z√§hlerdaten"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.filter(i=>n.includes(i.feld)).map(i=>e.jsx(Kr,{feld:i,value:r[i.feld],onChange:x=>s(i.feld,x)},i.feld))}),e.jsxs("details",{className:"mt-6",children:[e.jsx("summary",{className:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Wetterdaten (optional)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:t.filter(i=>a.includes(i.feld)).map(i=>e.jsx(Kr,{feld:i,value:r[i.feld],onChange:x=>s(i.feld,x),compact:!0},i.feld))})]})]})}function Ki({felder:t,values:r,onChange:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(kr,{className:"w-5 h-5 text-gray-500"}),"Sonstiges"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Optionale Eingaben f√ºr diesen Monat - k√∂nnen auch leer bleiben."}),e.jsx("div",{className:"space-y-4",children:t.map(n=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[n.label,n.einheit&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",n.einheit,")"]})]}),n.typ==="text"?e.jsx("textarea",{value:r[n.feld]||"",onChange:a=>s(n.feld,a.target.value||null),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:n.label}):e.jsx("input",{type:"number",step:"0.01",value:r[n.feld]??"",onChange:a=>s(n.feld,a.target.value?parseFloat(a.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:n.label})]},n.feld))})]})}function Bi({typ:t,investitionen:r,values:s,onChange:n}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[Xr[t],ia(t)]}),r.map(a=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:a.bezeichnung})}),e.jsx("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:a.felder.map(i=>{var x;return e.jsx(Kr,{feld:i,value:(x=s[a.id])==null?void 0:x[i.feld],onChange:o=>n(a.id,i.feld,o)},i.feld)})})]},a.id))]})}function Oi({data:t,values:r}){var a,i;let s=0,n=0;for(const x of t.basis_felder)["einspeisung_kwh","netzbezug_kwh"].includes(x.feld)&&(n++,r.basis[x.feld]!==null&&r.basis[x.feld]!==void 0&&s++);for(const x of t.investitionen)for(const o of x.felder)n++,((a=r.investitionen[x.id])==null?void 0:a[o.feld])!==null&&((i=r.investitionen[x.id])==null?void 0:i[o.feld])!==void 0&&s++;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-500"}),"Zusammenfassung"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[s," von ",n," Feldern ausgef√ºllt"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Z√§hlerdaten"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:t.basis_felder.filter(x=>["einspeisung_kwh","netzbezug_kwh"].includes(x.feld)).map(x=>e.jsx(Cr,{label:x.label,wert:r.basis[x.feld],einheit:x.einheit},x.feld))})]}),t.investitionen.map(x=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[Xr[x.typ],e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:x.bezeichnung})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:x.felder.map(o=>{var c;return e.jsx(Cr,{label:o.label,wert:(c=r.investitionen[x.id])==null?void 0:c[o.feld],einheit:o.einheit},o.feld)})})]},x.id)),t.optionale_felder&&t.optionale_felder.length>0&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(kr,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:t.optionale_felder.map(x=>e.jsx(Cr,{label:x.label,wert:(x.typ==="text",r.optionale[x.feld]),einheit:x.einheit,isText:x.typ==="text"},x.feld))})]})]})}function Kr({feld:t,value:r,onChange:s,compact:n=!1}){const a=t.warnungen.length>0,i=t.vorschlaege.length>0;return e.jsxs("div",{className:n?"":"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.label,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t.einheit,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:r??"",onChange:x=>s(x.target.value?parseFloat(x.target.value):null),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${a?"border-amber-300 focus:border-amber-500":"border-gray-300"}`,placeholder:i?`Vorschlag: ${t.vorschlaege[0].wert}`:""}),i&&r===null&&e.jsx("button",{type:"button",onClick:()=>s(t.vorschlaege[0].wert),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400",children:"√úbernehmen"})]}),i&&!n&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:t.vorschlaege.slice(0,3).map((x,o)=>e.jsxs("button",{type:"button",onClick:()=>s(x.wert),className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300",title:x.beschreibung,children:[x.wert," ",t.einheit,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",x.quelle,")"]})]},o))}),a&&e.jsx("div",{className:"mt-1",children:t.warnungen.map((x,o)=>e.jsxs("div",{className:`flex items-center gap-1 text-xs ${x.schwere==="error"?"text-red-600 dark:text-red-400":x.schwere==="warning"?"text-amber-600 dark:text-amber-400":"text-blue-600 dark:text-blue-400"}`,children:[x.schwere==="error"?e.jsx(Re,{className:"w-3 h-3"}):x.schwere==="warning"?e.jsx(Re,{className:"w-3 h-3"}):e.jsx(Le,{className:"w-3 h-3"}),x.meldung]},o))})]})}function Cr({label:t,wert:r,einheit:s,isText:n=!1}){const a=r!=null&&r!=="";return e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a?n?e.jsx("span",{className:"max-w-xs truncate",children:r}):e.jsxs(e.Fragment,{children:[typeof r=="number"?r.toLocaleString("de-DE",{maximumFractionDigits:1}):r," ",s]}):e.jsx("span",{className:"text-gray-400 italic",children:"nicht ausgef√ºllt"})})]})}function ia(t){return{"pv-module":"PV-Module",speicher:"Speicher",waermepumpe:"W√§rmepumpe","e-auto":"E-Auto",wallbox:"Wallbox",balkonkraftwerk:"Balkonkraftwerk"}[t]||t}function Ti(){return e.jsx(ma,{children:e.jsx(ua,{children:e.jsxs(ge,{path:"/",element:e.jsx(on,{}),children:[e.jsx(ge,{index:!0,element:e.jsx($e,{to:"/cockpit",replace:!0})}),e.jsx(ge,{path:"cockpit",element:e.jsx(hn,{})}),e.jsx(ge,{path:"cockpit/pv-anlage",element:e.jsx(pn,{})}),e.jsx(ge,{path:"cockpit/e-auto",element:e.jsx(bn,{})}),e.jsx(ge,{path:"cockpit/waermepumpe",element:e.jsx(kn,{})}),e.jsx(ge,{path:"cockpit/speicher",element:e.jsx(wn,{})}),e.jsx(ge,{path:"cockpit/wallbox",element:e.jsx(Nn,{})}),e.jsx(ge,{path:"cockpit/balkonkraftwerk",element:e.jsx(Sn,{})}),e.jsx(ge,{path:"cockpit/sonstiges",element:e.jsx(Fn,{})}),e.jsx(ge,{path:"auswertungen",element:e.jsx(ws,{})}),e.jsx(ge,{path:"auswertungen/roi",element:e.jsx(Tn,{})}),e.jsx(ge,{path:"auswertungen/prognose",element:e.jsx(Hn,{})}),e.jsx(ge,{path:"auswertungen/export",element:e.jsx(ws,{})})," ",e.jsx(ge,{path:"aussichten",element:e.jsx(Qn,{})}),e.jsx(ge,{path:"einstellungen/anlage",element:e.jsx(ri,{})}),e.jsx(ge,{path:"einstellungen/strompreise",element:e.jsx(si,{})}),e.jsx(ge,{path:"einstellungen/investitionen",element:e.jsx(hi,{})}),e.jsx(ge,{path:"einstellungen/monatsdaten",element:e.jsx(ki,{})}),e.jsx(ge,{path:"einstellungen/monatsabschluss",element:e.jsx(Mr,{})}),e.jsx(ge,{path:"monatsabschluss/:anlageId",element:e.jsx(Mr,{})}),e.jsx(ge,{path:"monatsabschluss/:anlageId/:jahr/:monat",element:e.jsx(Mr,{})}),e.jsx(ge,{path:"einstellungen/import",element:e.jsx(Cs,{})}),e.jsx(ge,{path:"einstellungen/demo",element:e.jsx(Cs,{})})," ",e.jsx(ge,{path:"einstellungen/solarprognose",element:e.jsx(vi,{})}),e.jsx(ge,{path:"einstellungen/pvgis",element:e.jsx($e,{to:"/einstellungen/solarprognose",replace:!0})}),e.jsx(ge,{path:"einstellungen/datenerfassung",element:e.jsx(Ni,{})}),e.jsx(ge,{path:"einstellungen/ha-import",element:e.jsx($e,{to:"/einstellungen/datenerfassung",replace:!0})}),e.jsx(ge,{path:"einstellungen/ha-export",element:e.jsx(_i,{})}),e.jsx(ge,{path:"einstellungen/sensor-mapping",element:e.jsx(Li,{})}),e.jsx(ge,{path:"einstellungen/allgemein",element:e.jsx(wi,{})}),e.jsx(ge,{path:"dashboard",element:e.jsx($e,{to:"/cockpit",replace:!0})}),e.jsx(ge,{path:"anlagen",element:e.jsx($e,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(ge,{path:"monatsdaten",element:e.jsx($e,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(ge,{path:"strompreise",element:e.jsx($e,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(ge,{path:"investitionen",element:e.jsx($e,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(ge,{path:"auswertung",element:e.jsx($e,{to:"/auswertungen",replace:!0})}),e.jsx(ge,{path:"roi",element:e.jsx($e,{to:"/auswertungen/roi",replace:!0})}),e.jsx(ge,{path:"e-auto",element:e.jsx($e,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(ge,{path:"waermepumpe",element:e.jsx($e,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(ge,{path:"speicher",element:e.jsx($e,{to:"/cockpit/speicher",replace:!0})}),e.jsx(ge,{path:"wallbox",element:e.jsx($e,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(ge,{path:"balkonkraftwerk",element:e.jsx($e,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(ge,{path:"sonstiges",element:e.jsx($e,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(ge,{path:"import",element:e.jsx($e,{to:"/einstellungen/import",replace:!0})}),e.jsx(ge,{path:"settings",element:e.jsx($e,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function Ri({onNext:t,onLoadDemo:r}){const[s,n]=d.useState(!1),[a,i]=d.useState(null),x=async()=>{if(r){n(!0),i(null);try{await r()}catch(o){i(o instanceof Error?o.message:"Fehler beim Laden der Demo-Daten"),n(!1)}}};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(re,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr pers√∂nliches Energie Effizienz Data Center f√ºr die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx($r,{icon:e.jsx(Br,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx($r,{icon:e.jsx(Ft,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen f√ºr alle Ihre Energie-Investitionen"}),e.jsx($r,{icon:e.jsx(ke,{className:"w-6 h-6"}),title:"Prognosen",description:"Wetterbasierte Vorhersagen und PVGIS-Vergleiche"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(mr,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(mr,{number:2,text:"Stromtarif konfigurieren (mit Vorschl√§gen)"}),e.jsx(mr,{number:3,text:"Wechselrichter und PV-Module erfassen"}),e.jsx(mr,{number:4,text:"Optional: Speicher, W√§rmepumpe, E-Auto hinzuf√ºgen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(Pe,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),r&&e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:x,disabled:s,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(La,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),a&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:a}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enth√§lt 24 Monate Beispieldaten, Wechselrichter, PV-Module, Speicher, W√§rmepumpe u.v.m."})]})]})]})}function $r({icon:t,title:r,description:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s})]})}function mr({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}function Hi({isLoading:t,error:r,onSubmit:s,onGeocode:n,onBack:a}){const[i,x]=d.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:""}),[o,c]=d.useState(null),[u,l]=d.useState(!1),[j,h]=d.useState(!1),p=w=>{const{name:k,value:N}=w.target;x(S=>({...S,[k]:N})),c(null),(k==="standort_plz"||k==="standort_ort")&&h(!1)},m=async()=>{if(!i.standort_plz){c("Bitte geben Sie eine PLZ ein");return}l(!0),c(null),h(!1);try{const w=await n(i.standort_plz,i.standort_ort||void 0);w?(x(k=>({...k,latitude:w.latitude.toFixed(6),longitude:w.longitude.toFixed(6)})),h(!0)):c("Koordinaten konnten nicht ermittelt werden. Bitte pr√ºfen Sie PLZ/Ort.")}catch{c("Fehler beim Ermitteln der Koordinaten")}finally{l(!1)}},g=async w=>{if(w.preventDefault(),c(null),!i.anlagenname.trim()){c("Bitte geben Sie einen Namen f√ºr Ihre Anlage ein");return}if(!i.leistung_kwp||parseFloat(i.leistung_kwp)<=0){c("Bitte geben Sie die Anlagenleistung in kWp ein");return}await s({anlagenname:i.anlagenname.trim(),leistung_kwp:parseFloat(i.leistung_kwp),installationsdatum:i.installationsdatum||void 0,standort_plz:i.standort_plz||void 0,standort_ort:i.standort_ort||void 0,latitude:i.latitude?parseFloat(i.latitude):void 0,longitude:i.longitude?parseFloat(i.longitude):void 0})},v=o||r;return e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),v&&e.jsx(Y,{type:"error",className:"mb-6",children:v}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:i.anlagenname,onChange:p,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:i.leistung_kwp,onChange:p,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(st,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:i.installationsdatum,onChange:p,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"F√ºr korrekten Start der Stromtarif-G√ºltigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(yr,{className:"w-4 h-4 text-gray-500"}),"Standort (f√ºr PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:i.standort_plz,onChange:p,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:i.standort_ort,onChange:p,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:m,disabled:u||!i.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):j?e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:i.latitude,onChange:p,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"L√§ngengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:i.longitude,onChange:p,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Le,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden f√ºr die PVGIS-Ertragsprognose ben√∂tigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:a,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Zur√ºck"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Pe,{className:"w-4 h-4"})]})})]})]})}function Gi({anlage:t,isLoading:r,error:s,onSubmit:n,onUseDefaults:a,onBack:i}){const x=t?sa(t.leistung_kwp):Nt.einspeiseverguetung_cent_kwh,[o,c]=d.useState({netzbezug_arbeitspreis_cent_kwh:Nt.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:x.toString(),grundpreis_euro_monat:Nt.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[u,l]=d.useState(null),j=m=>{const{name:g,value:v}=m.target;c(w=>({...w,[g]:v})),l(null)},h=async m=>{if(m.preventDefault(),l(null),!o.netzbezug_arbeitspreis_cent_kwh||parseFloat(o.netzbezug_arbeitspreis_cent_kwh)<0){l("Bitte geben Sie einen g√ºltigen Netzbezugspreis ein");return}if(!o.gueltig_ab){l("Bitte geben Sie ein G√ºltigkeitsdatum ein");return}await n({netzbezug_arbeitspreis_cent_kwh:parseFloat(o.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(o.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:o.grundpreis_euro_monat?parseFloat(o.grundpreis_euro_monat):void 0,gueltig_ab:o.gueltig_ab,tarifname:o.tarifname||void 0,anbieter:o.anbieter||void 0})},p=u||s;return e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(xe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"F√ºr korrekte Wirtschaftlichkeitsberechnungen"})]})]}),p&&e.jsx(Y,{type:"error",className:"mb-6",children:p}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:a,disabled:r,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(Ut,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[Nt.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",x," ct Einspeisung |"," ",Nt.grundpreis_euro_monat," ‚Ç¨ Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:o.netzbezug_arbeitspreis_cent_kwh,onChange:j,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeiseverg√ºtung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:o.einspeiseverguetung_cent_kwh,onChange:j,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"‚â§10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (‚Ç¨/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:o.grundpreis_euro_monat,onChange:j,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["G√ºltig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:o.gueltig_ab,onChange:j,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:o.tarifname,onChange:j,placeholder:"z.B. √ñkostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:o.anbieter,onChange:j,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Le,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie k√∂nnen sp√§ter weitere Stromtarife mit unterschiedlichen G√ºltigkeitszeitr√§umen hinzuf√ºgen, z.B. bei Tarifwechsel oder Preis√§nderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Zur√ºck"]}),e.jsx("button",{type:"submit",disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Pe,{className:"w-4 h-4"})]})})]})]})}function Yt(t){switch(t){case"e-auto":return e.jsx(ve,{className:"w-5 h-5"});case"speicher":return e.jsx(fe,{className:"w-5 h-5"});case"wallbox":return e.jsx(xt,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(Or,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(Ee,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(re,{className:"w-5 h-5"});default:return e.jsx(qs,{className:"w-5 h-5"})}}function Ji({investition:t,allInvestitionen:r,anlage:s,onUpdate:n,onDelete:a,isNew:i=!1}){const[x,o]=d.useState(!0);d.useEffect(()=>{i&&o(!0)},[i]);const[c,u]=d.useState(!1),l=Qa[t.typ],j=l?r.filter(g=>g.typ===l&&g.id!==t.id):[],h=g=>{var v;return(v=t.parameter)==null?void 0:v[g]},p=g=>{var v;return((v=t.parameter)==null?void 0:v[g])===!0},m=(g,v)=>{n({parameter:{...t.parameter,[g]:v}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>o(!x),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:Yt(t.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung||Qe[t.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Qe[t.typ],t.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:["‚Ä¢ ",t.anschaffungskosten_gesamt.toLocaleString("de-DE")," ‚Ç¨"]}):null]})]}),x?e.jsx(ht,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(rt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),x&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:t.bezeichnung,onChange:g=>n({bezeichnung:g.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:t.anschaffungsdatum||"",onChange:g=>n({anschaffungsdatum:g.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (‚Ç¨) *"}),e.jsx("input",{type:"number",value:t.anschaffungskosten_gesamt??"",onChange:g=>n({anschaffungskosten_gesamt:parseFloat(g.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),l&&e.jsx("div",{children:(()=>{const g=Xa.includes(t.typ),v=j.length>0,w=g&&!t.parent_investition_id&&v;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Geh√∂rt zu (",Qe[l],")",g?" *":" (optional)"]}),v?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.parent_investition_id||"",onChange:k=>n({parent_investition_id:k.target.value?parseInt(k.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${w?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:g?"-- Bitte w√§hlen --":"-- Keine Zuordnung --"}),j.map(k=>e.jsx("option",{value:k.id,children:k.bezeichnung},k.id))]}),w&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Ie,{className:"w-4 h-4"}),"PV-Module m√ºssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 flex-shrink-0"}),g?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen k√∂nnen."]}):e.jsxs("span",{children:["Kein ",Qe[l]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),t.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW) *"}),e.jsx("input",{type:"number",value:h("leistung_kw")??"",onChange:g=>m("leistung_kw",parseFloat(g.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:t.leistung_kwp??"",onChange:g=>n({leistung_kwp:parseFloat(g.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:t.ausrichtung||(s==null?void 0:s.ausrichtung)||"",onChange:g=>n({ausrichtung:g.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- W√§hlen --"}),e.jsx("option",{value:"S√ºd",children:"S√ºd (0¬∞)"}),e.jsx("option",{value:"S√ºdost",children:"S√ºdost (-45¬∞)"}),e.jsx("option",{value:"Ost",children:"Ost (-90¬∞)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135¬∞)"}),e.jsx("option",{value:"Nord",children:"Nord (180¬∞)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135¬∞)"}),e.jsx("option",{value:"West",children:"West (90¬∞)"}),e.jsx("option",{value:"S√ºdwest",children:"S√ºdwest (45¬∞)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:t.neigung_grad??(s==null?void 0:s.neigung_grad)??"",onChange:g=>n({neigung_grad:parseFloat(g.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="speicher"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazit√§t (kWh) *"}),e.jsx("input",{type:"number",value:h("kapazitaet_kwh")??"",onChange:g=>m("kapazitaet_kwh",parseFloat(g.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p("arbitrage"),onChange:g=>m("arbitrage",g.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Arbitrage"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Netzstrom g√ºnstig laden, teuer einspeisen"})]})]})})]}),t.typ==="wallbox"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW) *"}),e.jsx("input",{type:"number",value:h("leistung_kw")??"",onChange:g=>m("leistung_kw",parseFloat(g.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p("v2h"),onChange:g=>m("v2h",g.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-f√§hig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Bidirektionales Laden (Vehicle-to-Home)"})]})]})})]}),t.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazit√§t (kWh) *"}),e.jsx("input",{type:"number",value:h("batterie_kwh")??"",onChange:g=>m("batterie_kwh",parseFloat(g.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km) *"}),e.jsx("input",{type:"number",value:h("verbrauch_kwh_100km")??"",onChange:g=>m("verbrauch_kwh_100km",parseFloat(g.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"md:col-span-2 flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p("v2h"),onChange:g=>m("v2h",g.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-f√§hig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Fahrzeug kann Strom ans Haus abgeben (Vehicle-to-Home)"})]})]})})]}),t.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW) *"}),e.jsx("input",{type:"number",value:h("leistung_kw")??"",onChange:g=>m("leistung_kw",parseFloat(g.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl) *"}),e.jsx("input",{type:"number",value:h("cop")??"3.5",onChange:g=>m("cop",parseFloat(g.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung pro Modul (Wp) *"}),e.jsx("input",{type:"number",value:h("leistung_wp")??"",onChange:g=>m("leistung_wp",parseFloat(g.target.value)||void 0),placeholder:"z.B. 400",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module *"}),e.jsx("input",{type:"number",value:h("anzahl")??"",onChange:g=>m("anzahl",parseInt(g.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:h("ausrichtung")||"",onChange:g=>m("ausrichtung",g.target.value||void 0),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- W√§hlen --"}),e.jsx("option",{value:"S√ºd",children:"S√ºd (0¬∞)"}),e.jsx("option",{value:"S√ºdost",children:"S√ºdost (-45¬∞)"}),e.jsx("option",{value:"Ost",children:"Ost (-90¬∞)"}),e.jsx("option",{value:"West",children:"West (90¬∞)"}),e.jsx("option",{value:"S√ºdwest",children:"S√ºdwest (45¬∞)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:h("neigung_grad")??"",onChange:g=>m("neigung_grad",parseFloat(g.target.value)||void 0),placeholder:"z.B. 30",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"0¬∞ = flach, 90¬∞ = senkrecht (Balkon)"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p("hat_speicher"),onChange:g=>m("hat_speicher",g.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mit Speicher"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"z.B. Anker SOLIX, Zendure, EcoFlow"})]})]}),p("hat_speicher")&&e.jsxs("div",{className:"mt-3 ml-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Speicher-Kapazit√§t (Wh) *"}),e.jsx("input",{type:"number",value:h("speicher_kapazitaet_wh")??"",onChange:g=>m("speicher_kapazitaet_wh",parseFloat(g.target.value)||void 0),placeholder:"z.B. 1600",min:"0",step:"100",className:"w-full max-w-xs px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"z.B. 1600 Wh f√ºr Anker SOLIX"})]})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:c?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich l√∂schen?"}),e.jsx("button",{type:"button",onClick:()=>{a(),u(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, l√∂schen"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(dt,{className:"w-4 h-4"}),"Investition l√∂schen"]})})]})]})}function Ps({onAdd:t}){const[r,s]=d.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>s(!r),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(mt,{className:"w-5 h-5"}),"Investition hinzuf√ºgen"]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>s(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:aa.map(n=>e.jsxs("button",{type:"button",onClick:()=>{t(n),s(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Yt(n)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:Qe[n]})]},n))})]})]})}function Zi({investitionen:t,anlage:r,isLoading:s,error:n,onUpdateInvestition:a,onDeleteInvestition:i,onAddInvestition:x,onCreateDefaultPVSystem:o,onNext:c,onBack:u}){const[l,j]=d.useState(null),[h,p]=d.useState(null),m=d.useRef(null);d.useEffect(()=>{if(h&&m.current){m.current.scrollIntoView({behavior:"smooth",block:"center"});const w=setTimeout(()=>p(null),2e3);return()=>clearTimeout(w)}},[h]);const g=aa.reduce((w,k)=>{const N=t.filter(S=>S.typ===k);return N.length>0&&w.push({typ:k,items:N}),w},[]),v=async w=>{j(w);try{const k=await x(w);k!=null&&k.id&&p(k.id)}finally{j(null)}};return t.length===0&&!s?e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(re,{className:"w-8 h-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"PV-System einrichten"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:"Erfassen Sie Ihre PV-Komponenten f√ºr die Ertragsanalyse und ROI-Berechnung."})]}),o&&e.jsx("div",{className:"mb-8",children:e.jsx("button",{type:"button",onClick:o,disabled:s,className:"w-full p-6 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-amber-200 dark:border-amber-800 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-all group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-amber-500 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform",children:e.jsx(re,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg",children:"PV-System anlegen (empfohlen)"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Erstellt automatisch Wechselrichter + PV-Module mit ",(r==null?void 0:r.leistung_kwp)||0," kWp"]})]}),e.jsx(Pe,{className:"w-5 h-5 text-amber-500 group-hover:translate-x-1 transition-transform"})]})})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder einzeln hinzuf√ºgen"})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-6",children:["balkonkraftwerk","speicher","wallbox","waermepumpe","e-auto"].map(w=>e.jsxs("button",{type:"button",onClick:()=>v(w),disabled:l!==null,className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10 transition-all text-center",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-600 dark:text-gray-400",children:Yt(w)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:Qe[w]})]},w))}),e.jsx("div",{className:"text-center",children:e.jsx(Ps,{onAdd:v})}),l&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400 text-center",children:["F√ºge ",Qe[l]," hinzu..."]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Zur√ºck"]}),e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 px-6 py-2.5 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:["√úberspringen",e.jsx(Pe,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollst√§ndigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Erg√§nzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden f√ºr die ROI-Berechnung ben√∂tigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length," Investition",t.length!==1?"en":""]})]}),n&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:n})]}),s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!s&&e.jsxs("div",{className:"space-y-6",children:[g.map(({typ:w,items:k})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Yt(w)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[Qe[w]," (",k.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:k.map(N=>e.jsx("div",{ref:N.id===h?m:void 0,className:`transition-all duration-500 ${N.id===h?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(Ji,{investition:N,allInvestitionen:t,anlage:r,onUpdate:S=>a(N.id,S),onDelete:()=>i(N.id),isNew:N.id===h})},N.id))})]},w)),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4 text-amber-500"}),"Weitere Komponenten hinzuf√ºgen"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:["speicher","wallbox","waermepumpe","e-auto","balkonkraftwerk"].map(w=>{const k=t.some(N=>N.typ===w);return e.jsxs("button",{type:"button",onClick:()=>v(w),disabled:l!==null,className:`p-3 border rounded-xl transition-all text-center ${k?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10"}`,children:[e.jsx("div",{className:`w-8 h-8 mx-auto mb-1 rounded-lg flex items-center justify-center ${k?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:Yt(w)}),e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[Qe[w],k&&" ‚úì"]})]},w)})}),e.jsx(Ps,{onAdd:v}),l&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["F√ºge ",Qe[l]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Le,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig f√ºr die Amortisationsberechnung. Sie k√∂nnen alle Angaben sp√§ter jederzeit unter Einstellungen ‚Üí Investitionen √§ndern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Zur√ºck"]}),e.jsxs("button",{type:"button",onClick:c,disabled:s,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(Pe,{className:"w-4 h-4"})]})]})]})}function qi(t){switch(t){case"e-auto":return e.jsx(ve,{className:"w-4 h-4"});case"speicher":return e.jsx(fe,{className:"w-4 h-4"});case"wallbox":return e.jsx(xt,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(Or,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(Ee,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(re,{className:"w-4 h-4"});default:return e.jsx(qs,{className:"w-4 h-4"})}}function Ui({anlage:t,strompreis:r,investitionen:s,pvgisPrognose:n,pvgisError:a,canFetchPvgis:i,isLoading:x,onFetchPvgis:o,onComplete:c,onBack:u}){const[l,j]=d.useState(!1),h=!!t,p=!!r,m=s.length>0,g=!!n,v=s.reduce((k,N)=>k+(N.anschaffungskosten_gesamt||0),0),w=async()=>{j(!0);try{await o()}finally{j(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(zt,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschlie√üen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"√úberpr√ºfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ur,{icon:e.jsx(re,{className:"w-5 h-5"}),title:"PV-Anlage",status:h?"success":"warning",children:h?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&` ‚Ä¢ ${t.standort_ort}`,t.latitude&&t.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(ur,{icon:e.jsx(xe,{className:"w-5 h-5"}),title:"Stromtarif",status:p?"success":"warning",children:p?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:r.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:r.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),r.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.tarifname,r.anbieter&&` (${r.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollst√§ndig"})}),e.jsx(ur,{icon:e.jsx(Or,{className:"w-5 h-5"}),title:"Investitionen",status:m?"success":"neutral",children:m?e.jsxs("div",{className:"space-y-2",children:[s.slice(0,5).map(k=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:qi(k.typ)}),e.jsx("span",{className:"truncate",children:k.bezeichnung}),k.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[k.anschaffungskosten_gesamt.toLocaleString("de-DE")," ‚Ç¨"]}):null]},k.id)),s.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",s.length-5," weitere"]}),v>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",v.toLocaleString("de-DE")," ‚Ç¨"]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - k√∂nnen sp√§ter hinzugef√ºgt werden"})}),e.jsx(ur,{icon:e.jsx(xs,{className:"w-5 h-5"}),title:"PVGIS Ertragsprognose",status:g?"success":i?"neutral":"warning",children:g?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(n.jahresertrag_kwh).toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp",e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(PVGIS-Daten gespeichert)"})]})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ertragsprognose von PVGIS abrufen f√ºr SOLL-IST Vergleiche"}),a&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm",children:a}),e.jsx("button",{type:"button",onClick:w,disabled:l||x,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 animate-spin"}),"Rufe PVGIS ab..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4"}),"PVGIS-Prognose abrufen"]})})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400 text-sm",children:!(t!=null&&t.latitude)||!(t!=null&&t.longitude)?"Koordinaten fehlen - bitte Standort mit PLZ ermitteln":"PV-Module fehlen - bitte unter Komponenten anlegen"})})]}),e.jsx(Yi,{hasPvgis:g,investitionen:s})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Zur√ºck"]}),e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:[e.jsx(Et,{className:"w-5 h-5"}),"Weiter zur Datenerfassung"]})]})]})}function ur({icon:t,title:r,status:s,children:n}){const a={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${a[s]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[s]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r}),s==="success"&&e.jsx(zt,{className:"w-4 h-4 text-green-500"}),s==="warning"&&e.jsx(Ie,{className:"w-4 h-4 text-amber-500"})]}),n]})]})})}function Yi({hasPvgis:t,investitionen:r}){const s=r.some(a=>a.typ==="wechselrichter"),n=r.some(a=>a.typ==="pv-module");return e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-blue-500"}),"Wie geht es weiter?"]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Et,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Z√§hlerst√§nde (Einspeisung, Netzbezug) und Verbrauchsdaten der Komponenten. Sie k√∂nnen die Daten manuell eingeben oder eine CSV-Datei importieren."})]})]})}),(!n||!s)&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," ",!n&&!s?"Wechselrichter und PV-Module fehlen noch.":n?"Wechselrichter fehlt noch.":"PV-Module fehlen noch."," Diese k√∂nnen Sie jederzeit unter Einstellungen ‚Üí Investitionen erg√§nzen."]})}),!t&&n&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Tipp:"})," Rufen Sie oben die PVGIS-Prognose ab, um sp√§ter SOLL-IST Vergleiche Ihrer PV-Ertr√§ge zu sehen."]})})]})}function Qi({anlage:t,onGoToDashboard:r}){const s=()=>{r(),setTimeout(()=>{window.location.href="/einstellungen/monatsdaten"},100)};return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(re,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(Ia,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6 mb-8 max-w-md mx-auto text-left border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Et,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"N√§chster Schritt: Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Z√§hlerst√§nde (Einspeisung, Netzbezug) und Verbrauchsdaten. Die Daten k√∂nnen manuell eingegeben oder per CSV importiert werden."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:s,className:"inline-flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:[e.jsx(Et,{className:"w-5 h-5"}),"Monatsdaten erfassen"]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center justify-center gap-3 px-6 py-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(Tr,{className:"w-5 h-5"}),"Zum Cockpit"]})]})]})}const Dt=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"investitionen",label:"Komponenten",shortLabel:"Komp."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function Xi({onComplete:t}){var i;const r=en(),s=async()=>{await gt.createDemoData(),t()};d.useEffect(()=>{if(r.step==="complete"){const x=setTimeout(t,100);return()=>clearTimeout(x)}},[r.step,t]);const n=Dt.findIndex(x=>x.key===r.step),a=r.step!=="welcome"&&r.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:ea,alt:"eedc",className:"w-10 h-10"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),a&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",n+1," von ",Dt.length]})]})})}),a&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:Dt.map((x,o)=>{const c=o<n,u=o===n;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${c?"bg-green-500 text-white":u?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:c?e.jsx(zt,{className:"w-5 h-5"}):o+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${u?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:x.label})]}),o<Dt.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${c?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},x.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(i=Dt[n])==null?void 0:i.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n+1,"/",Dt.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${r.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[r.step==="welcome"&&e.jsx(Ri,{onNext:r.nextStep,onLoadDemo:s}),r.step==="anlage"&&e.jsx(Hi,{isLoading:r.isLoading,error:r.error,onSubmit:r.createAnlage,onGeocode:r.geocodeAddress,onBack:r.prevStep}),r.step==="strompreise"&&e.jsx(Gi,{anlage:r.anlage,isLoading:r.isLoading,error:r.error,onSubmit:r.createStrompreis,onUseDefaults:r.useDefaultStrompreise,onBack:r.prevStep}),r.step==="investitionen"&&e.jsx(Zi,{investitionen:r.investitionen,anlage:r.anlage,isLoading:r.isLoading,error:r.error,onUpdateInvestition:r.updateInvestition,onDeleteInvestition:r.deleteInvestition,onAddInvestition:r.addInvestition,onCreateDefaultPVSystem:r.createDefaultPVSystem,onNext:r.nextStep,onBack:r.prevStep}),r.step==="summary"&&e.jsx(Ui,{anlage:r.anlage,strompreis:r.strompreis,investitionen:r.investitionen,pvgisPrognose:r.pvgisPrognose,pvgisError:r.pvgisError,canFetchPvgis:r.canFetchPvgis,isLoading:r.isLoading,onFetchPvgis:r.fetchPvgisPrognose,onComplete:r.completeWizard,onBack:r.prevStep}),r.step==="complete"&&e.jsx(Qi,{anlage:r.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc ‚Äì Energie Effizienz Data Center"})]})}const Ar="eedc_setup_wizard_completed";function el({children:t}){const[r,s]=d.useState(!0),[n,a]=d.useState(!1);d.useEffect(()=>{i()},[]);const i=async()=>{try{(await et.list()).length===0?(localStorage.removeItem(Ar),localStorage.removeItem("eedc_setup_wizard_state"),a(!0)):(localStorage.setItem(Ar,"true"),a(!1))}catch(o){console.error("Fehler beim Pr√ºfen des Setup-Status:",o),a(!1)}finally{s(!1)}},x=()=>{localStorage.setItem(Ar,"true"),a(!1)};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):n?e.jsx(Xi,{onComplete:x}):e.jsx(e.Fragment,{children:t})}Pr.createRoot(document.getElementById("root")).render(e.jsx(pa.StrictMode,{children:e.jsx(Ta,{children:e.jsx(el,{children:e.jsx(Ti,{})})})}));
