var oh=Object.defineProperty;var ch=(t,r,a)=>r in t?oh(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var Il=(t,r,a)=>ch(t,typeof r!="symbol"?r+"":r,a);import{r as m,a as dh,u as fc,N as di,O as hh,b as pr,d as gh,e as uh,L as xh,R as at,H as mh,f as ph,h as ze,i as st}from"./vendor--Y_1AvlA.js";import{R as ge,B as Ze,C as ke,X as ve,Y as be,T as xe,L as Ce,a as le,b as Nt,A as $t,c as qe,P as Jt,d as Ut,e as Ge,f as Or,g as Dr,h as bh,i as fh,j as yh,k as jh,l as kh,m as Vl,n as vh,o as ne}from"./charts-CcGnraFc.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var yc={exports:{}},Wn={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wh=m,Nh=Symbol.for("react.element"),_h=Symbol.for("react.fragment"),zh=Object.prototype.hasOwnProperty,Sh=wh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Eh={key:!0,ref:!0,__self:!0,__source:!0};function jc(t,r,a){var s,n={},i=null,o=null;a!==void 0&&(i=""+a),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(o=r.ref);for(s in r)zh.call(r,s)&&!Eh.hasOwnProperty(s)&&(n[s]=r[s]);if(t&&t.defaultProps)for(s in r=t.defaultProps,r)n[s]===void 0&&(n[s]=r[s]);return{$$typeof:Nh,type:t,key:i,ref:o,props:n,_owner:Sh.current}}Wn.Fragment=_h;Wn.jsx=jc;Wn.jsxs=jc;yc.exports=Wn;var e=yc.exports,hi={},Bl=dh;hi.createRoot=Bl.createRoot,hi.hydrateRoot=Bl.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Mh={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wh=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Y=(t,r)=>{const a=m.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:h,...g},l)=>m.createElement("svg",{ref:l,...Mh,width:n,height:n,stroke:s,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${Wh(t)}`,c].join(" "),...g},[...r.map(([u,x])=>m.createElement(u,x)),...Array.isArray(h)?h:[h]]));return a.displayName=`${t}`,a};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=Y("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=Y("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=Y("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fh=Y("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ol=Y("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=Y("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Y("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=Y("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ah=Y("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=Y("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=Y("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vc=Y("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=Y("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wc=Y("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Y("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Y("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=Y("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=Y("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=Y("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=Y("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=Y("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=Y("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $h=Y("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _c=Y("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=Y("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ph=Y("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dh=Y("CloudSnow",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rl=Y("CloudSun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=Y("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=Y("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=Y("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=Y("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qi=Y("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=Y("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vh=Y("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=Y("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=Y("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=Y("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bh=Y("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tl=Y("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=Y("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=Y("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=Y("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=Y("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kl=Y("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=Y("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=Y("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=Y("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ui=Y("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zc=Y("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=Y("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oh=Y("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Y("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=Y("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rh=Y("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=Y("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=Y("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ec=Y("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mc=Y("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Th=Y("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wc=Y("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kh=Y("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=Y("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hh=Y("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=Y("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=Y("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=Y("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=Y("PlugZap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=Y("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=Y("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=Y("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zh=Y("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qh=Y("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=Y("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fc=Y("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ac=Y("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=Y("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yi=Y("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uh=Y("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=Y("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yh=Y("Snowflake",[["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"m20 16-4-4 4-4",key:"rquw4f"}],["path",{d:"m4 8 4 4-4 4",key:"12s3z9"}],["path",{d:"m16 4-4 4-4-4",key:"1tumq1"}],["path",{d:"m8 20 4-4 4 4",key:"9p200w"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=Y("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xi=Y("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=Y("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=Y("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=Y("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=Y("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=Y("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=Y("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=Y("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=Y("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Y("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=Y("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=Y("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eg=Y("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cc=Y("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=Y("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Y("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=Y("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=Y("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Pc=m.createContext(void 0);function tg({children:t}){const[r,a]=m.useState(()=>localStorage.getItem("eedc-theme")||"system"),[s,n]=m.useState(!1);return m.useEffect(()=>{localStorage.setItem("eedc-theme",r);const i=window.document.documentElement;if(r==="system"){const o=window.matchMedia("(prefers-color-scheme: dark)").matches;n(o),i.classList.toggle("dark",o)}else n(r==="dark"),i.classList.toggle("dark",r==="dark")},[r]),m.useEffect(()=>{if(r!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),o=c=>{n(c.matches),document.documentElement.classList.toggle("dark",c.matches)};return i.addEventListener("change",o),()=>i.removeEventListener("change",o)},[r]),e.jsx(Pc.Provider,{value:{theme:r,setTheme:a,isDark:s},children:t})}function Dc(){const t=m.useContext(Pc);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const Lc="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgODAgODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImczIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzA2YjZkNCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMzNGQzOTkiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8c3R5bGU+CiAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PU91dGZpdDp3Z2h0QDMwMDs3MDAmYW1wO2Rpc3BsYXk9c3dhcCcpOwogICAgPC9zdHlsZT4KICA8L2RlZnM+CgogIDxyZWN0IHg9IjIiIHk9IjIiIHdpZHRoPSI3NiIgaGVpZ2h0PSI3NiIgcng9IjE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuOCIvPgogIDx0ZXh0IHg9IjEyIiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjcwMCIgZm9udC1zaXplPSIzNiIgZmlsbD0idXJsKCNnMykiPmVlPC90ZXh0PgogIDx0ZXh0IHg9IjQ1IiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjMwMCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY0NzQ4YiI+ZGM8L3RleHQ+CiAgPHBhdGggZD0iTTE2IDE2IFE0MCAzIDYyIDE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGNpcmNsZSBjeD0iNjIiIGN5PSIxNiIgcj0iMi44IiBmaWxsPSIjMzRkMzk5Ii8+Cjwvc3ZnPgo=",rg=[{name:"Cockpit",basePath:"/cockpit",icon:Ui},{name:"Auswertungen",basePath:"/auswertungen",icon:Tt},{name:"Aussichten",basePath:"/aussichten",icon:We},{name:"Community",basePath:"/community",icon:_r}],ag=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Monatsabschluss",href:"/einstellungen/monatsabschluss"},{name:"Import",href:"/einstellungen/import"},{name:"Datenerfassung",href:"/einstellungen/datenerfassung"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"Solarprognose",href:"/einstellungen/solarprognose"},{name:"Allgemein",href:"/einstellungen/allgemein"}]},{category:"Home Assistant",items:[{name:"Sensor-Zuordnung",href:"/einstellungen/sensor-mapping"},{name:"Statistik-Import",href:"/einstellungen/ha-statistik-import"},{name:"MQTT-Export",href:"/einstellungen/ha-export"}]},{category:"Community",items:[{name:"Daten teilen",href:"/einstellungen/community"}]}];function sg(){const{theme:t,setTheme:r}=Dc(),a=fc(),[s,n]=m.useState(!1),i=m.useRef(null),c=a.pathname.startsWith("/cockpit")?"Cockpit":a.pathname.startsWith("/auswertungen")?"Auswertungen":a.pathname.startsWith("/aussichten")?"Aussichten":a.pathname.startsWith("/community")?"Community":a.pathname.startsWith("/einstellungen")?null:"Cockpit";m.useEffect(()=>{const l=u=>{i.current&&!i.current.contains(u.target)&&n(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const h=()=>{r(t==="light"?"dark":t==="dark"?"system":"light")},g=l=>a.pathname===l;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-14",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:Lc,alt:"eedc",className:"h-10 w-10"}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"}),e.jsx("nav",{className:"ml-8 flex space-x-1",children:rg.map(l=>{const u=l.icon;return e.jsxs(di,{to:l.basePath,className:()=>`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===l.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(u,{className:"h-4 w-4"}),l.name]},l.name)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:h,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(oe,{className:"h-5 w-5"}),t==="dark"&&e.jsx(Mc,{className:"h-5 w-5"}),t==="system"&&e.jsx(Ec,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>n(!s),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${a.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(Yi,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(zr,{className:`h-4 w-4 transition-transform ${s?"rotate-180":""}`})]}),s&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:ag.map((l,u)=>e.jsxs("div",{children:[u>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:l.category})}),l.items.map(x=>e.jsx(di,{to:x.href,onClick:()=>n(!1),className:`block px-4 py-2 text-sm transition-colors ${g(x.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:x.name},x.href))]},l.category))})]})]})]})})})}const ng=[{name:"Übersicht",href:"/cockpit",icon:Ui,exact:!0},{name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:oe},{name:"E-Auto",href:"/cockpit/e-auto",icon:Ve},{name:"Wärmepumpe",href:"/cockpit/waermepumpe",icon:Qe},{name:"Speicher",href:"/cockpit/speicher",icon:Fe},{name:"Wallbox",href:"/cockpit/wallbox",icon:Kt},{name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:oe},{name:"Sonstiges",href:"/cockpit/sonstiges",icon:en}],ig=[],lg=[{name:"Anlage",href:"/einstellungen/anlage",icon:lt},{name:"Strompreise",href:"/einstellungen/strompreise",icon:_e},{name:"Investitionen",href:"/einstellungen/investitionen",icon:Yr},{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:Jr},{name:"Import/Export",href:"/einstellungen/import",icon:ya},{name:"Solarprognose",href:"/einstellungen/solarprognose",icon:oe},{name:"Allgemein",href:"/einstellungen/allgemein",icon:Yi}];function og(){const t=fc(),a=t.pathname.startsWith("/cockpit")?ng:t.pathname.startsWith("/auswertungen")?ig:t.pathname.startsWith("/einstellungen")?lg:null;return!a||a.length===0?null:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:a.map(s=>e.jsxs(di,{to:s.href,end:s.exact,className:({isActive:n})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${n?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(s.icon,{className:"h-4 w-4"}),s.name]},s.href))})})})}const cg="2.2.0",dg="eedc",hg="Energie Effizienz Data Center",gg=`${dg} v${cg} – ${hg}`;function ug(){return e.jsxs("div",{className:"h-screen bg-gray-50 dark:bg-gray-900 flex flex-col overflow-hidden",children:[e.jsx(sg,{}),e.jsx(og,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(hh,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:gg})})]})}const he=m.forwardRef(({className:t="",variant:r="primary",size:a="md",loading:s,disabled:n,children:i,...o},c)=>{const h="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",g={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},l={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:c,className:`${h} ${g[r]} ${l[a]} ${t}`,disabled:n||s,...o,children:[s&&e.jsx(Re,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});he.displayName="Button";const J=m.forwardRef(({className:t="",label:r,error:a,hint:s,id:n,...i},o)=>{const c=n||i.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:o,id:c,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${a?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...i}),s&&!a&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:s}),a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a})]})});J.displayName="Input";const Ht=m.forwardRef(({className:t="",label:r,error:a,options:s,placeholder:n,id:i,...o},c)=>{const h=i||o.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:h,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,o.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:c,id:h,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${a?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...o,children:[n&&e.jsx("option",{value:"",children:n}),s.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]}),a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a})]})});Ht.displayName="Select";function Ot({isOpen:t,onClose:r,title:a,children:s,size:n="md"}){if(m.useEffect(()=>{const o=c=>{c.key==="Escape"&&r()};return t&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}},[t,r]),!t)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:r}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[n]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),e.jsx("button",{onClick:r,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Xr,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:s})]})})]})}function $({children:t,className:r="",padding:a="md"}){const s={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${s[a]}
        ${r}
      `,children:t})}function Gl({title:t,subtitle:r,action:a}){return e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),r&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r})]}),a&&e.jsx("div",{children:a})]})}function ae({type:t,title:r,children:a,onClose:s,className:n=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:ot},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:pt},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:nt},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:cs}},{bg:o,border:c,text:h,icon:g}=i[t];return e.jsx("div",{className:`${o} ${c} border rounded-lg p-4 relative ${n}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{className:`w-5 h-5 ${h} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[r&&e.jsx("h4",{className:`text-sm font-medium ${h}`,children:r}),e.jsx("div",{className:`text-sm ${h} ${r?"mt-1":""}`,children:a})]}),s&&e.jsx("button",{onClick:s,className:`ml-3 ${h} hover:opacity-70 transition-opacity`,children:e.jsx(Xr,{className:"w-4 h-4"})})]})})}function Qi({children:t,className:r=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${r}`,children:t})})}function el({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function tl({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function ja({children:t,onClick:r,className:a=""}){return e.jsx("tr",{className:`${r?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${a}`,onClick:r,children:t})}function yt({children:t,className:r=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${r}`,children:t})}function jt({children:t,className:r=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${r}`,children:t})}function ka({icon:t,title:r,description:a,action:s}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:a}),s&&e.jsx("div",{children:s})]})}function Me({size:t="md",text:r}){const a={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Re,{className:`${a[t]} text-primary-600 animate-spin`}),r&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:r})]})}function Cr({children:t,formel:r,berechnung:a,ergebnis:s,className:n="",showIcon:i=!0}){const[o,c]=m.useState(!1),[h,g]=m.useState("top"),l=m.useRef(null);return m.useEffect(()=>{if(o&&l.current){const u=l.current.getBoundingClientRect();g(u.top<120?"bottom":"top")}},[o]),e.jsxs("span",{ref:l,className:`relative inline-block cursor-help ${n}`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[t,i&&e.jsx(ot,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),o&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${h==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${h==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:r}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:a})]}),s&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:s})]})]})]})}function D(t,r=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r})}function An({children:t,text:r,className:a="",position:s="auto"}){const[n,i]=m.useState(!1),[o,c]=m.useState("bottom"),[h,g]=m.useState({top:0,left:0}),l=m.useRef(null);return m.useEffect(()=>{if(n&&l.current){const u=l.current.getBoundingClientRect();c(s==="auto"?u.top<60?"bottom":"top":s),g({top:o==="bottom"?u.bottom+6:u.top-6,left:u.left+u.width/2})}},[n,s,o]),e.jsxs("span",{ref:l,className:`relative inline-block cursor-help ${a}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[t,n&&e.jsxs("div",{className:"fixed z-[9999] px-2 py-1 text-xs bg-gray-800 text-white rounded shadow-lg whitespace-nowrap",style:{top:o==="bottom"?h.top:"auto",bottom:o==="top"?`calc(100vh - ${h.top}px)`:"auto",left:h.left,transform:"translateX(-50%)"},children:[r,e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[4px] border-l-transparent
              border-r-[4px] border-r-transparent
              ${o==="top"?"top-full border-t-[4px] border-t-gray-800":"bottom-full border-b-[4px] border-b-gray-800"}`})]})]})}const xg={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function De({title:t,value:r,unit:a,subtitle:s,icon:n,color:i="blue",trend:o,formel:c,berechnung:h,ergebnis:g}){const l=xg[i],u=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof r=="number"?r.toLocaleString("de-DE"):r,a&&e.jsx("span",{className:"text-sm font-normal ml-1",children:a}),o==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"↑"}),o==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"↓"})]});return e.jsx($,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:c?e.jsx(Cr,{formel:c,berechnung:h,ergebnis:g,children:u}):u}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl ${l.bg} ml-3 flex-shrink-0`,children:e.jsx(n,{className:`h-6 w-6 ${l.icon}`})})]})})}const mg="./api";class pg{constructor(r=mg){Il(this,"baseUrl");this.baseUrl=r}async request(r,a={}){const s=`${this.baseUrl}${r}`,n={headers:{"Content-Type":"application/json",...a.headers},...a},i=await fetch(s,n);if(!i.ok){const o={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const c=await i.json();o.detail=c.detail||o.detail}catch{}throw o}if(i.status!==204)return i.json()}async get(r){return this.request(r,{method:"GET"})}async post(r,a){return this.request(r,{method:"POST",body:a?JSON.stringify(a):void 0})}async put(r,a){return this.request(r,{method:"PUT",body:JSON.stringify(a)})}async delete(r){return this.request(r,{method:"DELETE"})}async patch(r,a){return this.request(r,{method:"PATCH",body:JSON.stringify(a)})}async upload(r,a,s="file"){const n=new FormData;return n.append(s,a),this.request(r,{method:"POST",headers:{},body:n})}}const Z=new pg,At={async list(){return Z.get("/anlagen/")},async get(t){return Z.get(`/anlagen/${t}`)},async create(t){return Z.post("/anlagen/",t)},async update(t,r){return Z.put(`/anlagen/${t}`,r)},async delete(t){return Z.delete(`/anlagen/${t}`)},async getSensorConfig(t){return Z.get(`/anlagen/${t}/sensors`)},async updateSensorConfig(t,r){return Z.patch(`/anlagen/${t}/sensors`,r)},async geocode(t,r){const a=new URLSearchParams({plz:t});return r&&a.append("ort",r),Z.get(`/anlagen/geocode/lookup?${a}`)}},Pr={async list(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("jahr",r.toString());const s=a.toString();return Z.get(`/monatsdaten/${s?"?"+s:""}`)},async get(t){return Z.get(`/monatsdaten/${t}`)},async create(t){return Z.post("/monatsdaten/",t)},async update(t,r){return Z.put(`/monatsdaten/${t}`,r)},async delete(t){return Z.delete(`/monatsdaten/${t}`)},async listAggregiert(t,r){const a=r?`?jahr=${r}`:"";return Z.get(`/monatsdaten/aggregiert/${t}${a}`)}},et={async getTypen(){return Z.get("/investitionen/typen")},async list(t,r,a){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("typ",r),a!==void 0&&s.append("aktiv",a.toString());const n=s.toString();return Z.get(`/investitionen/${n?"?"+n:""}`)},async get(t){return Z.get(`/investitionen/${t}`)},async create(t){return Z.post("/investitionen/",t)},async update(t,r){return Z.put(`/investitionen/${t}`,r)},async delete(t){return Z.delete(`/investitionen/${t}`)},async getROIDashboard(t,r,a,s,n){const i=new URLSearchParams;r&&i.append("strompreis_cent",r.toString()),a&&i.append("einspeiseverguetung_cent",a.toString()),s&&i.append("benzinpreis_euro",s.toString()),n&&n!=="all"&&i.append("jahr",n.toString());const o=i.toString();return Z.get(`/investitionen/roi/${t}${o?"?"+o:""}`)},async getEAutoDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("benzinpreis_euro",a.toString());const n=s.toString();return Z.get(`/investitionen/dashboard/e-auto/${t}${n?"?"+n:""}`)},async getWaermepumpeDashboard(t,r){const a=new URLSearchParams;r&&a.append("strompreis_cent",r.toString());const s=a.toString();return Z.get(`/investitionen/dashboard/waermepumpe/${t}${s?"?"+s:""}`)},async getSpeicherDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("einspeiseverguetung_cent",a.toString());const n=s.toString();return Z.get(`/investitionen/dashboard/speicher/${t}${n?"?"+n:""}`)},async getWallboxDashboard(t){return Z.get(`/investitionen/dashboard/wallbox/${t}`)},async getBalkonkraftwerkDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("einspeiseverguetung_cent",a.toString());const n=s.toString();return Z.get(`/investitionen/dashboard/balkonkraftwerk/${t}${n?"?"+n:""}`)},async getSonstigesDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("einspeiseverguetung_cent",a.toString());const n=s.toString();return Z.get(`/investitionen/dashboard/sonstiges/${t}${n?"?"+n:""}`)},async getMonatsdatenByMonth(t,r,a){return Z.get(`/investitionen/monatsdaten/${t}/${r}/${a}`)}},ha={async list(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("aktuell","true");const s=a.toString();return Z.get(`/strompreise/${s?"?"+s:""}`)},async getAktuell(t){return Z.get(`/strompreise/aktuell/${t}`)},async get(t){return Z.get(`/strompreise/${t}`)},async create(t){return Z.post("/strompreise/",t)},async update(t,r){return Z.put(`/strompreise/${t}`,r)},async delete(t){return Z.delete(`/strompreise/${t}`)}},nr="./api",ir={async getTemplateInfo(t){const r=await fetch(`${nr}/import/template/${t}`);if(!r.ok)throw new Error("Fehler beim Laden des Templates");return r.json()},getTemplateDownloadUrl(t){return`${nr}/import/template/${t}/download`},async importCSV(t,r,a=!1){const s=new FormData;s.append("file",r);const n=new URLSearchParams;a&&n.append("ueberschreiben","true");const i=await fetch(`${nr}/import/csv/${t}?${n.toString()}`,{method:"POST",body:s});if(!i.ok){const o=await i.json();throw new Error(o.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(t,r){const a=new URLSearchParams;r&&a.append("jahr",r.toString());const s=a.toString();return`${nr}/import/export/${t}${s?"?"+s:""}`},async createDemoData(){const t=await fetch(`${nr}/import/demo`,{method:"POST"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${nr}/import/demo`,{method:"DELETE"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht gelöscht werden")}return t.json()},getFullExportUrl(t){return`${nr}/import/export/${t}/full`},async importJSON(t,r=!1){const a=new FormData;a.append("file",t);const s=new URLSearchParams;r&&s.append("ueberschreiben","true");const n=await fetch(`${nr}/import/json?${s.toString()}`,{method:"POST",body:a});if(!n.ok){const i=await n.json();throw new Error(i.detail||"JSON-Import fehlgeschlagen")}return n.json()},getPdfExportUrl(t,r){return r?`${nr}/import/pdf/${t}?jahr=${r}`:`${nr}/import/pdf/${t}`}},Zl={async health(){return Z.get("/health")},async getSettings(){return Z.get("/settings")},async getStats(){return Z.get("/stats")}},Xt={async getPrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const s=a.toString();return Z.get(`/pvgis/prognose/${t}${s?`?${s}`:""}`)},async getModulPrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const s=a.toString();return Z.get(`/pvgis/modul/${t}${s?`?${s}`:""}`)},async speicherePrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const s=a.toString();return Z.post(`/pvgis/prognose/${t}/speichern${s?`?${s}`:""}`)},async listeGespeichertePrognosen(t){return Z.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return Z.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return Z.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return Z.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return Z.get(`/pvgis/optimum/${t}`)}},Fr={async getStatus(){return Z.get("/ha/status")},async getSensors(){return Z.get("/ha/sensors")},async getMapping(){return Z.get("/ha/mapping")},async getMqttConfig(){return Z.get("/ha/export/mqtt/config")},async getExportSensors(){return Z.get("/ha/export/sensors")},async getAnlageSensors(t){return Z.get(`/ha/export/sensors/${t}`)},async getYamlSnippet(t){return Z.get(`/ha/export/yaml/${t}`)},async getSensorDefinitions(){return Z.get("/ha/export/definitions")},async testMqtt(t){return Z.post("/ha/export/mqtt/test",t||{})},async publishMqtt(t,r){return Z.post(`/ha/export/mqtt/publish/${t}`,r||{})},async removeMqtt(t,r){return Z.delete(`/ha/export/mqtt/remove/${t}`)}},Qr={async getUebersicht(t,r){const a=r?`?jahr=${r}`:"";return Z.get(`/cockpit/uebersicht/${t}${a}`)},async getPrognoseVsIst(t,r){return Z.get(`/cockpit/prognose-vs-ist/${t}?jahr=${r}`)},async getNachhaltigkeit(t){return Z.get(`/cockpit/nachhaltigkeit/${t}`)},async getKomponentenZeitreihe(t,r){const a=r?`?jahr=${r}`:"";return Z.get(`/cockpit/komponenten-zeitreihe/${t}${a}`)},async getPVStrings(t,r){const a=r?`?jahr=${r}`:"";return Z.get(`/cockpit/pv-strings/${t}${a}`)},async getPVStringsGesamtlaufzeit(t){return Z.get(`/cockpit/pv-strings-gesamtlaufzeit/${t}`)}},$n={async getMonatsdaten(t,r,a,s="auto"){return Z.get(`/wetter/monat/${t}/${r}/${a}?provider=${s}`)},async getMonatsdatenByCoords(t,r,a,s,n="auto"){return Z.get(`/wetter/monat/koordinaten/${t}/${r}/${a}/${s}?provider=${n}`)},async getProvider(t){return Z.get(`/wetter/provider/${t}`)},async getVergleich(t,r,a){return Z.get(`/wetter/vergleich/${t}/${r}/${a}`)},async getSolarPrognose(t,r=7,a=!1){const s=await Z.get(`/solar-prognose/${t}?tage=${r}&pro_string=${a}`);return{...s,tage:s.tageswerte,anlage:{id:s.anlage_id,name:s.anlagenname,leistung_kwp:s.kwp_gesamt,neigung:s.neigung,azimut:s.ausrichtung}}}},Ma={async getMapping(t){return Z.get(`/sensor-mapping/${t}`)},async getAvailableSensors(t,r=!0){const a=new URLSearchParams;r||a.set("filter_energy","false");const s=a.toString()?`?${a.toString()}`:"";return Z.get(`/sensor-mapping/${t}/available-sensors${s}`)},async saveMapping(t,r){return Z.post(`/sensor-mapping/${t}`,r)},async deleteMapping(t){await Z.delete(`/sensor-mapping/${t}`)},async getStatus(t){return Z.get(`/sensor-mapping/${t}/status`)},async initStartValues(t){return Z.post(`/sensor-mapping/${t}/init-start-values`,{})}},On={async getStatus(t,r,a){return Z.get(`/monatsabschluss/${t}/${r}/${a}`)},async save(t,r,a,s){return Z.post(`/monatsabschluss/${t}/${r}/${a}`,s)},async getNaechsterMonat(t){try{return await Z.get(`/monatsabschluss/naechster/${t}`)}catch{return null}},async getHistorie(t,r=12){return Z.get(`/monatsabschluss/historie/${t}?limit=${r}`)}};function bg(t){return{jahr:t.jahr,monat:t.monat,monat_name:t.monat_name,basis:t.basis.map(r=>({feld:r.feld,label:r.feld_label,wert:r.differenz,einheit:r.einheit,sensor_id:r.sensor_id})),investitionen:t.investitionen.map(r=>({investition_id:r.investition_id,bezeichnung:r.bezeichnung,typ:r.typ,felder:r.felder.map(a=>({feld:a.feld,label:a.feld_label,wert:a.differenz,einheit:a.einheit,sensor_id:a.sensor_id}))}))}}const ur={async getStatus(){return Z.get("/ha-statistics/status")},async getMonatswerte(t,r,a){const s=await Z.get(`/ha-statistics/monatswerte/${t}/${r}/${a}`);return bg(s)},async getVerfuegbareMonate(t){return(await Z.get(`/ha-statistics/verfuegbare-monate/${t}`)).monate.map(a=>({...a,hat_daten:!0}))},async getAlleMonatswerte(t){return Z.get(`/ha-statistics/alle-monatswerte/${t}`)},async getMonatsanfangWerte(t,r,a){return Z.get(`/ha-statistics/monatsanfang/${t}/${r}/${a}`)},async getImportVorschau(t){return Z.get(`/ha-statistics/import-vorschau/${t}`)},async importieren(t,r){return Z.post(`/ha-statistics/import/${t}`,r)}},tt={async getStatus(){return Z.get("/community/status")},async getPreview(t){return Z.get(`/community/preview/${t}`)},async share(t){return Z.post(`/community/share/${t}`)},async delete(t){return Z.delete(`/community/delete/${t}`)},async getBenchmark(t,r="letzte_12_monate",a){const s=new URLSearchParams({zeitraum:r});return a&&s.append("jahr",a.toString()),Z.get(`/community/benchmark/${t}?${s.toString()}`)},async getGlobalStatistics(){return Z.get("/community/statistics/global")},async getMonthlyAverages(t=12){return Z.get(`/community/statistics/monthly-averages?monate=${t}`)},async getRegionalStatistics(){return Z.get("/community/statistics/regional")},async getRegionalDetails(t){return Z.get(`/community/statistics/regional/${t}`)},async getDistribution(t,r=10){return Z.get(`/community/statistics/distributions/${t}?bins=${r}`)},async getRanking(t,r=10){return Z.get(`/community/statistics/rankings/${t}?limit=${r}`)},async getSpeicherByClass(){return Z.get("/community/components/speicher/by-class")},async getWaermepumpeByRegion(){return Z.get("/community/components/waermepumpe/by-region")},async getEAutoByUsage(){return Z.get("/community/components/eauto/by-usage")},async getTrends(t){return Z.get(`/community/trends/${t}`)},async getDegradation(){return Z.get("/community/trends/degradation")}};function it(){const[t,r]=m.useState([]),[a,s]=m.useState(!0),[n,i]=m.useState(null),o=m.useCallback(async()=>{try{s(!0),i(null);const l=await At.list();r(l)}catch(l){i(l instanceof Error?l.message:"Fehler beim Laden der Anlagen")}finally{s(!1)}},[]);m.useEffect(()=>{o()},[o]);const c=m.useCallback(async l=>{const u=await At.create(l);return r(x=>[...x,u]),u},[]),h=m.useCallback(async(l,u)=>{const x=await At.update(l,u);return r(d=>d.map(b=>b.id===l?x:b)),x},[]),g=m.useCallback(async l=>{await At.delete(l),r(u=>u.filter(x=>x.id!==l))},[]);return{anlagen:t,loading:a,error:n,refresh:o,createAnlage:c,updateAnlage:h,deleteAnlage:g}}function fg(t,r){const[a,s]=m.useState([]),[n,i]=m.useState(!0),[o,c]=m.useState(null),h=m.useCallback(async()=>{try{i(!0),c(null);const x=await Pr.list(t,r);s(x)}catch(x){c(x instanceof Error?x.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[t,r]);m.useEffect(()=>{h()},[h]);const g=m.useCallback(async x=>{const d=await Pr.create(x);return s(b=>[d,...b]),d},[]),l=m.useCallback(async(x,d)=>{const b=await Pr.update(x,d);return s(p=>p.map(y=>y.id===x?b:y)),b},[]),u=m.useCallback(async x=>{await Pr.delete(x),s(d=>d.filter(b=>b.id!==x))},[]);return{monatsdaten:a,loading:n,error:o,refresh:h,createMonatsdaten:g,updateMonatsdaten:l,deleteMonatsdaten:u}}function yg(t,r){const[a,s]=m.useState([]),[n,i]=m.useState(!0),[o,c]=m.useState(null),h=m.useCallback(async()=>{if(!t){s([]),i(!1);return}try{i(!0),c(null);const g=await Pr.listAggregiert(t,r);s(g)}catch(g){c(g instanceof Error?g.message:"Fehler beim Laden der aggregierten Daten")}finally{i(!1)}},[t,r]);return m.useEffect(()=>{h()},[h]),{daten:a,loading:n,error:o,refresh:h}}function jg(t){return{gesamtErzeugung:t.reduce((r,a)=>r+(a.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((r,a)=>r+a.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((r,a)=>r+a.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((r,a)=>r+(a.eigenverbrauch_kwh||0),0),gesamtDirektverbrauch:t.reduce((r,a)=>r+(a.direktverbrauch_kwh||0),0),gesamtSpeicherLadung:t.reduce((r,a)=>r+(a.speicher_ladung_kwh||0),0),gesamtSpeicherEntladung:t.reduce((r,a)=>r+(a.speicher_entladung_kwh||0),0),gesamtWpStrom:t.reduce((r,a)=>r+(a.wp_strom_kwh||0),0),gesamtWpHeizung:t.reduce((r,a)=>r+(a.wp_heizung_kwh||0),0),gesamtEautoLadung:t.reduce((r,a)=>r+(a.eauto_ladung_kwh||0),0),gesamtEautoKm:t.reduce((r,a)=>r+(a.eauto_km||0),0),durchschnittAutarkie:t.length>0?t.reduce((r,a)=>r+(a.autarkie_prozent||0),0)/t.length:0,anzahlMonate:t.length}}function ds(t,r){const[a,s]=m.useState([]),[n,i]=m.useState(!0),[o,c]=m.useState(null),h=m.useCallback(async()=>{try{i(!0),c(null);const x=await et.list(t,r);s(x)}catch(x){c(x instanceof Error?x.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[t,r]);m.useEffect(()=>{h()},[h]);const g=m.useCallback(async x=>{const d=await et.create(x);return s(b=>[...b,d]),d},[]),l=m.useCallback(async(x,d)=>{const b=await et.update(x,d);return s(p=>p.map(y=>y.id===x?b:y)),b},[]),u=m.useCallback(async x=>{await et.delete(x),s(d=>d.filter(b=>b.id!==x))},[]);return{investitionen:a,loading:n,error:o,refresh:h,createInvestition:g,updateInvestition:l,deleteInvestition:u}}function kg(t){return t.reduce((a,s)=>(a[s.typ]||(a[s.typ]=[]),a[s.typ].push(s),a),{})}function vg(t){const[r,a]=m.useState([]),[s,n]=m.useState(!0),[i,o]=m.useState(null),c=m.useCallback(async()=>{try{n(!0),o(null);const u=await ha.list(t);a(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden der Strompreise")}finally{n(!1)}},[t]);m.useEffect(()=>{c()},[c]);const h=m.useCallback(async u=>{const x=await ha.create(u);return a(d=>[x,...d]),x},[]),g=m.useCallback(async(u,x)=>{const d=await ha.update(u,x);return a(b=>b.map(p=>p.id===u?d:p)),d},[]),l=m.useCallback(async u=>{await ha.delete(u),a(x=>x.filter(d=>d.id!==u))},[]);return{strompreise:r,loading:s,error:i,refresh:c,createStrompreis:h,updateStrompreis:g,deleteStrompreis:l}}function Ic(t){const[r,a]=m.useState(null),[s,n]=m.useState(!1),[i,o]=m.useState(null);return m.useEffect(()=>{if(t===null){a(null);return}(async()=>{try{n(!0),o(null);const h=await ha.getAktuell(t);a(h)}catch{a(null)}finally{n(!1)}})()},[t]),{strompreis:r,loading:s,error:i}}const qr={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function Vc(t){return t<=10?8.2:t<=40?7.1:5.8}const Rn="eedc_setup_wizard_state",ql={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},Rr=["welcome","anlage","strompreise","investitionen","summary","complete"],Bc=["wechselrichter","pv-module","speicher","balkonkraftwerk","waermepumpe","e-auto","wallbox","sonstiges"],er={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},wg={"pv-module":"wechselrichter",speicher:"wechselrichter"},Ng=["pv-module"];function _g(){const[t,r]=m.useState(()=>{try{const B=localStorage.getItem(Rn);if(B)return JSON.parse(B)}catch{}return ql}),[a,s]=m.useState(t.currentStep),[n,i]=m.useState(!1),[o,c]=m.useState(null),[h,g]=m.useState(null),[l,u]=m.useState(null),[x,d]=m.useState([]),[b,p]=m.useState(null),[y,f]=m.useState(null),j=m.useRef(new Map);m.useEffect(()=>{localStorage.setItem(Rn,JSON.stringify({...t,currentStep:a}))},[t,a]),m.useEffect(()=>{t.anlageId&&!h&&At.get(t.anlageId).then(g).catch(()=>{})},[t.anlageId,h]);const k=m.useCallback(async()=>{if(t.anlageId)try{const B=await et.list(t.anlageId);d(B)}catch{}},[t.anlageId]);m.useEffect(()=>{k()},[k]);const w=m.useCallback(B=>{s(B),c(null)},[]),_=m.useCallback(async()=>{const B=j.current;if(B.size===0)return;const G=[];B.forEach(({data:T,timer:q},re)=>{clearTimeout(q),G.push(et.update(re,T).catch(de=>{console.error(`Fehler beim Update von Investition ${re}:`,de)}))}),B.clear(),await Promise.all(G),await k()},[k]),v=m.useCallback(async()=>{await _();const B=Rr.indexOf(a);B<Rr.length-1&&w(Rr[B+1])},[a,w,_]),S=m.useCallback(()=>{const B=Rr.indexOf(a);B>0&&w(Rr[B-1])},[a,w]),V=m.useCallback(()=>{r(B=>({...B,skippedSteps:[...B.skippedSteps,a]})),v()},[a,v]),C=m.useCallback(async(B,G)=>{try{const T=await At.geocode(B,G);return{latitude:T.latitude,longitude:T.longitude}}catch{return null}},[]),I=m.useCallback(async B=>{i(!0),c(null);try{const G=await At.create(B);g(G),r(T=>({...T,anlageId:G.id})),v()}catch(G){c(G instanceof Error?G.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[v]),F=m.useCallback(async B=>{if(!t.anlageId){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const G=await ha.create({anlage_id:t.anlageId,...B});u(G),r(T=>({...T,strompreisId:G.id})),v()}catch(G){c(G instanceof Error?G.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[t.anlageId,v]),M=m.useCallback(async()=>{if(!t.anlageId||!h){c("Keine Anlage vorhanden");return}const B=Vc(h.leistung_kwp);await F({netzbezug_arbeitspreis_cent_kwh:qr.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:B,grundpreis_euro_monat:qr.grundpreis_euro_monat,gueltig_ab:h.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,h,F]),W=m.useCallback(async(B,G)=>{d(de=>de.map(ue=>ue.id!==B?ue:{...ue,...G,parameter:G.parameter?{...ue.parameter||{},...G.parameter}:ue.parameter}));const T=j.current.get(B);T!=null&&T.timer&&clearTimeout(T.timer);const q=T!=null&&T.data?{...T.data,...G,parameter:G.parameter?{...T.data.parameter||{},...G.parameter}:T.data.parameter}:G,re=setTimeout(async()=>{j.current.delete(B);try{await et.update(B,q)}catch(de){c(de instanceof Error?de.message:"Fehler beim Aktualisieren"),await k()}},500);j.current.set(B,{data:q,timer:re})},[k]),N=m.useCallback(async B=>{try{await et.delete(B),await k()}catch(G){c(G instanceof Error?G.message:"Fehler beim Löschen")}},[k]),z=m.useCallback(async B=>{if(!t.anlageId)throw new Error("Keine Anlage vorhanden");c(null);try{const G=await et.create({anlage_id:t.anlageId,typ:B,bezeichnung:`Neue ${er[B]}`,aktiv:!0});return await k(),G}catch(G){const T=G instanceof Error?G.message:"Fehler beim Hinzufügen";throw c(T),G}},[t.anlageId,k]),A=m.useCallback(async()=>{if(!t.anlageId||!h){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const B=await et.create({anlage_id:t.anlageId,typ:"wechselrichter",bezeichnung:"Wechselrichter",aktiv:!0,anschaffungsdatum:h.installationsdatum});await et.create({anlage_id:t.anlageId,typ:"pv-module",bezeichnung:"PV-Module",leistung_kwp:h.leistung_kwp,ausrichtung:h.ausrichtung,neigung_grad:h.neigung_grad,parent_investition_id:B.id,aktiv:!0,anschaffungsdatum:h.installationsdatum}),r(G=>({...G,createdInvestitionen:[...G.createdInvestitionen,B.id]})),await k()}catch(B){c(B instanceof Error?B.message:"Fehler beim Erstellen des PV-Systems")}finally{i(!1)}},[t.anlageId,h,k]),P=m.useCallback(async()=>{if(!t.anlageId||!h)return;if(!h.latitude||!h.longitude){f("Keine Koordinaten vorhanden");return}if(!x.some(G=>G.typ==="pv-module")){f("Keine PV-Module vorhanden");return}i(!0),f(null);try{const G=await Xt.speicherePrognose(t.anlageId);p(G)}catch(G){const T=G instanceof Error?G.message:"Fehler beim Abrufen der PVGIS-Prognose";f(T)}finally{i(!1)}},[t.anlageId,h,x]),E=m.useCallback(()=>{r(B=>({...B,completed:!0,currentStep:"complete"})),s("complete")},[]),L=m.useCallback(()=>{localStorage.removeItem(Rn),r(ql),s("welcome"),g(null),u(null),d([]),c(null)},[]),R=(()=>{switch(a){case"welcome":return!0;case"anlage":return!!t.anlageId;case"strompreise":return!!t.strompreisId;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),X=Math.round(Rr.indexOf(a)/(Rr.length-1)*100),O=!!(h!=null&&h.latitude&&(h!=null&&h.longitude)&&x.some(B=>B.typ==="pv-module"));return{step:a,wizardState:t,isLoading:n,error:o,anlage:h,strompreis:l,pvgisPrognose:b,pvgisError:y,investitionen:x,refreshInvestitionen:k,goToStep:w,nextStep:v,prevStep:S,skipStep:V,createAnlage:I,geocodeAddress:C,createStrompreis:F,useDefaultStrompreise:M,updateInvestition:W,deleteInvestition:N,addInvestition:z,createDefaultPVSystem:A,fetchPvgisPrognose:P,completeWizard:E,resetWizard:L,canProceed:R,progress:X,canFetchPvgis:O}}function zg(){var p,y,f,j,k,w,_;const t=pr(),{anlagen:r,loading:a}=it(),[s,n]=m.useState(null),[i,o]=m.useState(!0),[c,h]=m.useState(null),[g,l]=m.useState(void 0),[u,x]=m.useState([]),d=(p=r[0])==null?void 0:p.id;if(m.useEffect(()=>{if(!d)return;(async()=>{o(!0),h(null);try{const S=await Qr.getUebersicht(d,g);if(n(S),S.zeitraum_von&&S.zeitraum_bis){const V=parseInt(S.zeitraum_von.split("-")[0]),C=parseInt(S.zeitraum_bis.split("-")[0]),I=[];for(let F=V;F<=C;F++)I.push(F);x(I)}}catch(S){h("Fehler beim Laden der Daten"),console.error(S)}finally{o(!1)}})()},[d,g]),a||i)return e.jsx(Me,{text:"Lade Dashboard..."});if(r.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsx(Sg,{})]});if(c||!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs($,{children:[e.jsx("p",{className:"text-red-500",children:c||"Keine Daten verfügbar"}),e.jsx(he,{onClick:()=>t("/einstellungen/monatsdaten"),className:"mt-4",children:"Monatsdaten erfassen"})]})]});const b=r[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{className:"h-8 w-8 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[b.anlagenname," • ",s.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:g||"",onChange:v=>l(v.target.value?parseInt(v.target.value):void 0),className:"input py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Alle Jahre"}),u.map(v=>e.jsx("option",{value:v,children:v},v))]})]})]}),s.zeitraum_von&&s.zeitraum_bis&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Zeitraum: ",s.zeitraum_von," bis ",s.zeitraum_bis," (",s.anzahl_monate," Monate)"]}),e.jsx(vs,{title:"Energie-Bilanz",icon:_e,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"PV-Erzeugung",value:(s.pv_erzeugung_kwh/1e3).toFixed(1),unit:"MWh",icon:oe,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>t("/cockpit/pv-anlage"),formel:"Σ PV-Erzeugung aller Monate",berechnung:`${D(s.pv_erzeugung_kwh,0)} kWh`,ergebnis:`= ${D(s.pv_erzeugung_kwh/1e3,1)} MWh`}),e.jsx(Te,{title:"Gesamtverbrauch",value:(s.gesamtverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:lt,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch + Netzbezug",berechnung:`${D(s.eigenverbrauch_kwh,0)} + ${D(s.netzbezug_kwh,0)} kWh`,ergebnis:`= ${D(s.gesamtverbrauch_kwh/1e3,1)} MWh`}),e.jsx(Te,{title:"Netzbezug",value:(s.netzbezug_kwh/1e3).toFixed(1),unit:"MWh",icon:Ol,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Netzbezug aller Monate",berechnung:`${D(s.netzbezug_kwh,0)} kWh`,ergebnis:`= ${D(s.netzbezug_kwh/1e3,1)} MWh`}),e.jsx(Te,{title:"Einspeisung",value:(s.einspeisung_kwh/1e3).toFixed(1),unit:"MWh",icon:Bn,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einspeisung aller Monate",berechnung:`${D(s.einspeisung_kwh,0)} kWh`,ergebnis:`= ${D(s.einspeisung_kwh/1e3,1)} MWh`})]})}),e.jsx(vs,{title:"Effizienz-Quoten",icon:Qa,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"Autarkie",value:s.autarkie_prozent.toFixed(1),unit:"%",subtitle:"Unabhängigkeit vom Netz",icon:ca,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:`${D(s.eigenverbrauch_kwh,0)} ÷ ${D(s.gesamtverbrauch_kwh,0)} × 100`,ergebnis:`= ${D(s.autarkie_prozent,1)} %`}),e.jsx(Te,{title:"Eigenverbrauchsquote",value:s.eigenverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Selbst genutzte PV",icon:_e,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${D(s.eigenverbrauch_kwh,0)} ÷ ${D(s.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${D(s.eigenverbrauch_quote_prozent,1)} %`}),e.jsx(Te,{title:"Direktverbrauchsquote",value:s.direktverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Ohne Speicher-Umweg",icon:We,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Direktverbrauch ÷ Erzeugung × 100",berechnung:`${D(s.direktverbrauch_kwh,0)} ÷ ${D(s.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${D(s.direktverbrauch_quote_prozent,1)} %`}),e.jsx(Te,{title:"Spez. Ertrag",value:((y=s.spezifischer_ertrag_kwh_kwp)==null?void 0:y.toFixed(0))||"---",unit:"kWh/kWp",subtitle:"Anlageneffizienz",icon:oe,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Erzeugung ÷ Anlagenleistung",berechnung:`${D(s.pv_erzeugung_kwh,0)} kWh ÷ ${D(s.anlagenleistung_kwp,2)} kWp`,ergebnis:`= ${D(s.spezifischer_ertrag_kwh_kwp||0,0)} kWh/kWp`})]})}),s.hat_speicher&&e.jsx(Tn,{title:"Speicher",icon:Fe,onClick:()=>t("/cockpit/speicher"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"Ladung gesamt",value:(s.speicher_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Ol,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung",berechnung:`${D(s.speicher_ladung_kwh,0)} kWh`,ergebnis:`= ${D(s.speicher_ladung_kwh/1e3,2)} MWh`}),e.jsx(Te,{title:"Entladung gesamt",value:(s.speicher_entladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Bn,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung",berechnung:`${D(s.speicher_entladung_kwh,0)} kWh`,ergebnis:`= ${D(s.speicher_entladung_kwh/1e3,2)} MWh`}),e.jsx(Te,{title:"Ø Effizienz",value:((f=s.speicher_effizienz_prozent)==null?void 0:f.toFixed(1))||"---",unit:"%",icon:ca,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${D(s.speicher_entladung_kwh,0)} ÷ ${D(s.speicher_ladung_kwh,0)} × 100`,ergebnis:`= ${D(s.speicher_effizienz_prozent||0,1)} %`}),e.jsx(Te,{title:"Vollzyklen",value:((j=s.speicher_vollzyklen)==null?void 0:j.toFixed(0))||"---",unit:"",subtitle:`${s.speicher_kapazitaet_kwh.toFixed(1)} kWh Kapazität`,icon:Fe,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Ladung ÷ Kapazität",berechnung:`${D(s.speicher_ladung_kwh,0)} kWh ÷ ${D(s.speicher_kapazitaet_kwh,1)} kWh`,ergebnis:`= ${D(s.speicher_vollzyklen||0,0)} Zyklen`})]})}),s.hat_waermepumpe&&e.jsx(Tn,{title:"Wärmepumpe",icon:Qe,onClick:()=>t("/cockpit/waermepumpe"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"Wärme erzeugt",value:(s.wp_waerme_kwh/1e3).toFixed(2),unit:"MWh",icon:Qe,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizung + Warmwasser",berechnung:`${D(s.wp_waerme_kwh,0)} kWh`,ergebnis:`= ${D(s.wp_waerme_kwh/1e3,2)} MWh`}),e.jsx(Te,{title:"Strom verbraucht",value:(s.wp_strom_kwh/1e3).toFixed(2),unit:"MWh",icon:_e,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Stromverbrauch",berechnung:`${D(s.wp_strom_kwh,0)} kWh`,ergebnis:`= ${D(s.wp_strom_kwh/1e3,2)} MWh`}),e.jsx(Te,{title:"Ø COP",value:((k=s.wp_cop)==null?void 0:k.toFixed(1))||"---",unit:"",icon:ca,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${D(s.wp_waerme_kwh,0)} ÷ ${D(s.wp_strom_kwh,0)}`,ergebnis:`= ${D(s.wp_cop||0,1)}`}),e.jsx(Te,{title:"Ersparnis vs. Gas",value:s.wp_ersparnis_euro.toFixed(0),unit:"€",icon:lr,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Gaskosten - Stromkosten",berechnung:`(${D(s.wp_waerme_kwh,0)} kWh ÷ 0.9 × 10ct) - (${D(s.wp_strom_kwh,0)} kWh × Strompreis)`,ergebnis:`= ${D(s.wp_ersparnis_euro,0)} €`})]})}),s.hat_emobilitaet&&e.jsx(Tn,{title:"E-Mobilität",icon:Ve,onClick:()=>t("/cockpit/e-auto"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"Gefahrene km",value:(s.emob_km/1e3).toFixed(1),unit:"Tkm",icon:Ve,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene Kilometer",berechnung:`${D(s.emob_km,0)} km`,ergebnis:`= ${D(s.emob_km/1e3,1)} Tkm`}),e.jsx(Te,{title:"Ladung gesamt",value:(s.emob_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:_e,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Heim + Extern Ladung",berechnung:`${D(s.emob_ladung_kwh,0)} kWh`,ergebnis:`= ${D(s.emob_ladung_kwh/1e3,2)} MWh`}),e.jsx(Te,{title:"PV-Anteil",value:((w=s.emob_pv_anteil_prozent)==null?void 0:w.toFixed(0))||"---",unit:"%",icon:oe,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"PV-Ladung ÷ Heimladung × 100",berechnung:"PV-geladene kWh ÷ Gesamt-Ladung",ergebnis:`= ${D(s.emob_pv_anteil_prozent||0,0)} %`}),e.jsx(Te,{title:"Ersparnis vs. Benzin",value:s.emob_ersparnis_euro.toFixed(0),unit:"€",icon:lr,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Benzinkosten - Stromkosten",berechnung:"Benzin (7L/100km × 1.80€) - Strom",ergebnis:`= ${D(s.emob_ersparnis_euro,0)} €`})]})}),e.jsx(vs,{title:"Finanzen",icon:lr,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"Einspeiseerlös",value:s.einspeise_erloes_euro.toFixed(0),unit:"€",icon:Bn,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Vergütung",berechnung:`${D(s.einspeisung_kwh,0)} kWh × 8.2 ct/kWh`,ergebnis:`= ${D(s.einspeise_erloes_euro,0)} €`}),e.jsx(Te,{title:"EV-Ersparnis",value:s.ev_ersparnis_euro.toFixed(0),unit:"€",icon:_e,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Strompreis",berechnung:`${D(s.eigenverbrauch_kwh,0)} kWh × Strompreis`,ergebnis:`= ${D(s.ev_ersparnis_euro,0)} €`}),e.jsx(Te,{title:"Netto-Ertrag",value:s.netto_ertrag_euro.toFixed(0),unit:"€",icon:We,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Erlös + Ersparnis",berechnung:`${D(s.einspeise_erloes_euro,0)} + ${D(s.ev_ersparnis_euro,0)} €`,ergebnis:`= ${D(s.netto_ertrag_euro,0)} €`}),e.jsx(Te,{title:"Jahres-Rendite",value:((_=s.jahres_rendite_prozent)==null?void 0:_.toFixed(1))||"---",unit:"%",subtitle:`von ${s.investition_gesamt_euro.toFixed(0)} € Invest`,icon:ca,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",onClick:()=>t("/auswertungen/roi"),formel:"Jahres-Ertrag ÷ Investition × 100",berechnung:`${D(s.netto_ertrag_euro,0)} € ÷ ${D(s.investition_gesamt_euro,0)} €`,ergebnis:`= ${D(s.jahres_rendite_prozent||0,1)} % p.a.`})]})}),e.jsx(vs,{title:"CO₂-Bilanz",icon:mt,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Te,{title:"CO₂ PV",value:(s.co2_pv_kg/1e3).toFixed(1),unit:"t",subtitle:"Vermiedene Emissionen",icon:oe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Eigenverbrauch × CO₂-Faktor",berechnung:`${D(s.eigenverbrauch_kwh,0)} kWh × 0.38 kg/kWh`,ergebnis:`= ${D(s.co2_pv_kg,0)} kg`}),e.jsx(Te,{title:"CO₂ Wärmepumpe",value:(s.co2_wp_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Gas-Heizung",icon:Qe,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO₂ Gas - CO₂ Strom",berechnung:"Gasverbrauch × 0.201 - WP-Strom × 0.38",ergebnis:`= ${D(s.co2_wp_kg,0)} kg`}),e.jsx(Te,{title:"CO₂ E-Mobilität",value:(s.co2_emob_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Verbrenner",icon:Ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"CO₂ Benzin - CO₂ Strom",berechnung:"Benzinverbrauch × 2.37 - Stromverbrauch × 0.38",ergebnis:`= ${D(s.co2_emob_kg,0)} kg`}),e.jsx(Te,{title:"CO₂ gesamt",value:(s.co2_gesamt_kg/1e3).toFixed(1),unit:"t",subtitle:"Gesamte Einsparung",icon:mt,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ aller CO₂-Einsparungen",berechnung:`${D(s.co2_pv_kg,0)} + ${D(s.co2_wp_kg,0)} + ${D(s.co2_emob_kg,0)} kg`,ergebnis:`= ${D(s.co2_gesamt_kg/1e3,1)} t`})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Kn,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/einstellungen/monatsdaten")}),e.jsx(Kn,{title:"Auswertungen",description:"Detaillierte Analysen und Zeitverläufe",onClick:()=>t("/auswertungen")}),e.jsx(Kn,{title:"Investitionen",description:"Komponenten verwalten",onClick:()=>t("/einstellungen/investitionen")})]})]})}function vs({title:t,icon:r,children:a}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),a]})}function Tn({title:t,icon:r,onClick:a,children:s}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),e.jsx(ar,{className:"h-4 w-4 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),s]})}function Te({title:t,value:r,unit:a,subtitle:s,icon:n,color:i,bgColor:o,onClick:c,formel:h,berechnung:g,ergebnis:l}){const u=e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:a})]}),x=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-0.5",children:h?e.jsx(Cr,{formel:h,berechnung:g,ergebnis:l,children:u}):u}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate",children:s})]}),e.jsx("div",{className:`p-2 rounded-lg ${o} ml-2 flex-shrink-0`,children:e.jsx(n,{className:`h-5 w-5 ${i}`})})]});return c?e.jsx("button",{onClick:c,className:"card p-3 text-left hover:shadow-md transition-shadow w-full",children:x}):e.jsx($,{className:"p-3",children:x})}function Kn({title:t,description:r,onClick:a}){return e.jsx("button",{onClick:a,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsx(gt,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function Sg(){const t=pr();return e.jsxs($,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(he,{onClick:()=>t("/einstellungen/anlage"),children:["Jetzt starten",e.jsx(gt,{className:"h-4 w-4 ml-2"})]})]})}const Wr=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function Eg({anlageId:t}){var l;const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,o]=m.useState(null);m.useEffect(()=>{let u=!1;return(async()=>{n(!0),o(null);try{const d=await Qr.getPVStringsGesamtlaufzeit(t);u||a(d)}catch(d){if(!u){const b=d&&typeof d=="object"&&"detail"in d?String(d.detail):"Fehler beim Laden der String-Daten";o(b),console.error("PVStringVergleich Fehler:",d)}}finally{u||n(!1)}})(),()=>{u=!0}},[t]);const c=m.useMemo(()=>{if(!(r!=null&&r.strings)||r.strings.length===0)return[];const u={};for(const x of r.strings)for(const d of x.jahreswerte)u[d.jahr]||(u[d.jahr]={}),u[d.jahr][x.bezeichnung]={soll:d.prognose_kwh,ist:d.ist_kwh};return Object.entries(u).sort(([x],[d])=>Number(x)-Number(d)).map(([x,d])=>{const b={name:x};for(const p of r.strings){const y=d[p.bezeichnung];y&&(b[`${p.bezeichnung} SOLL`]=Math.round(y.soll),b[`${p.bezeichnung} IST`]=Math.round(y.ist))}return b})},[r]),h=m.useMemo(()=>r!=null&&r.saisonal_aggregiert?r.saisonal_aggregiert.map(u=>({name:u.monat_name.slice(0,3),SOLL:Math.round(u.prognose_kwh),"IST Ø":Math.round(u.ist_durchschnitt_kwh),"IST Summe":Math.round(u.ist_summe_kwh)})):[],[r]);if(s)return e.jsx(Me,{text:"Lade String-Vergleich..."});if(i)return e.jsx(ae,{type:"error",children:i});if(!r||!r.strings||r.strings.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen → Investitionen anlegen."})]});if(!r.hat_prognose)return e.jsx(ae,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen → PVGIS eine Prognose abrufen."})]})});const g=({ratio:u})=>{if(u==null)return e.jsx("span",{className:"text-gray-400",children:"-"});const x=u*100,d=x>=95?"text-green-600":x<85?"text-red-600":"text-amber-600",b=x>=95?We:x<85?qt:null;return e.jsxs("span",{className:`flex items-center gap-1 ${d}`,children:[b&&e.jsx(b,{className:"h-3 w-3"}),x.toFixed(0),"%"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"SOLL (Prognose)"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:[(r.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("p",{className:"text-xs text-blue-500",children:[r.anzahl_jahre," Jahre × PVGIS"]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"IST (Erzeugt)"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(r.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("p",{className:"text-xs text-amber-500",children:[r.anzahl_monate," Monate erfasst"]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${(r.abweichung_gesamt_prozent??0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Abweichung"}),e.jsxs("p",{className:`text-xl font-bold ${(r.abweichung_gesamt_prozent??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(r.abweichung_gesamt_prozent??0)>=0?"+":"",((l=r.abweichung_gesamt_prozent)==null?void 0:l.toFixed(1))??"0","%"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-700 dark:text-gray-300",children:[r.erstes_jahr," - ",r.letztes_jahr]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.anlagen_leistung_kwp.toFixed(1)," kWp"]})]})]}),r.strings.length>1&&(r.bester_string||r.schlechtester_string)&&e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[r.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full",children:[e.jsx(We,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300",children:["Beste Performance: ",e.jsx("strong",{children:r.bester_string})]})]}),r.schlechtester_string&&r.schlechtester_string!==r.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-full",children:[e.jsx(qt,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-red-700 dark:text-red-300",children:["Schwächster: ",e.jsx("strong",{children:r.schlechtester_string})]})]})]}),c.length>0&&e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Mt,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro Jahr"]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:c,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name"}),e.jsx(be,{unit:" kWh"}),e.jsx(xe,{formatter:u=>[`${u.toLocaleString()} kWh`]}),e.jsx(Ce,{}),r.strings.map((u,x)=>e.jsx(le,{dataKey:`${u.bezeichnung} SOLL`,fill:Wr[x%Wr.length],opacity:.4,name:`${u.bezeichnung} SOLL`},`${u.investition_id}-soll`)),r.strings.map((u,x)=>e.jsx(le,{dataKey:`${u.bezeichnung} IST`,fill:Wr[x%Wr.length],name:`${u.bezeichnung} IST`},`${u.investition_id}-ist`))]})})})]}),h.length>0&&e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5 text-green-500"}),"Saisonaler Vergleich (Jan - Dez)"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Vergleicht die monatliche PVGIS-Prognose mit dem Durchschnitt der tatsächlichen Erzeugung über alle Jahre."}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:h,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name"}),e.jsx(be,{unit:" kWh"}),e.jsx(xe,{formatter:u=>[`${u.toLocaleString()} kWh`]}),e.jsx(Ce,{}),e.jsx($t,{type:"monotone",dataKey:"SOLL",fill:"#3b82f6",stroke:"#3b82f6",fillOpacity:.2,name:"PVGIS Prognose"}),e.jsx(qe,{type:"monotone",dataKey:"IST Ø",stroke:"#f59e0b",strokeWidth:3,dot:{r:4},name:"IST Durchschnitt"})]})})})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einzelne Strings / Module (Gesamtlaufzeit)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String / Modul"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abw."}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Performance"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.strings.map((u,x)=>{var d,b;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Wr[x%Wr.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:u.bezeichnung})]}),u.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:["→ ",u.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:u.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3 text-gray-600 dark:text-gray-400",children:[u.ausrichtung||"-",u.neigung_grad!=null&&` / ${u.neigung_grad}°`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600 dark:text-blue-400",children:[(u.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right font-medium",style:{color:Wr[x%Wr.length]},children:[(u.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right ${(u.abweichung_gesamt_prozent??0)>=0?"text-green-600":"text-red-600"}`,children:[(u.abweichung_gesamt_prozent??0)>=0?"+":"",((d=u.abweichung_gesamt_prozent)==null?void 0:d.toFixed(1))??"0","%"]}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(g,{ratio:u.performance_ratio_gesamt})}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:((b=u.spezifischer_ertrag_kwh_kwp)==null?void 0:b.toFixed(0))??"-"})]},u.investition_id)})})]})})]})]})}const Wa={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"};function Mg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState(null),[o,c]=m.useState([]),[h,g]=m.useState(!0);m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]);const{investitionen:l,loading:u}=ds(a);m.useEffect(()=>{if(!a)return;(async()=>{g(!0);try{const[N,z]=await Promise.all([Qr.getUebersicht(a),Pr.listAggregiert(a)]);i(N),c(z)}catch(N){console.error("Fehler beim Laden der Daten:",N)}finally{g(!1)}})()},[a]);const{pvSysteme:x,orphanModule:d}=m.useMemo(()=>{const W=[],N=[],z=l.filter(E=>E.typ==="wechselrichter"),A=l.filter(E=>E.typ==="pv-module"),P=l.filter(E=>E.typ==="speicher");for(const E of z){const L=A.filter(O=>O.parent_investition_id===E.id),R=P.filter(O=>O.parent_investition_id===E.id),X=L.reduce((O,B)=>O+(B.leistung_kwp||0),0);W.push({wechselrichter:E,pvModule:L,speicher:R,gesamtKwp:X})}for(const E of A)(!E.parent_investition_id||!z.find(L=>L.id===E.parent_investition_id))&&N.push(E);return{pvSysteme:W,orphanModule:N}},[l]),b=(n==null?void 0:n.anlagenleistung_kwp)||0,p=(n==null?void 0:n.pv_erzeugung_kwh)||0,y=(n==null?void 0:n.eigenverbrauch_kwh)||0,f=(n==null?void 0:n.einspeisung_kwh)||0,j=(n==null?void 0:n.spezifischer_ertrag_kwh_kwp)||0,k=(n==null?void 0:n.eigenverbrauch_quote_prozent)||0,w=(n==null?void 0:n.anzahl_monate)||0,_=n==null?void 0:n.zeitraum_von,v=n==null?void 0:n.zeitraum_bis,S=m.useMemo(()=>{if(o.length===0)return[];const W=new Map;for(const N of o){W.has(N.jahr)||W.set(N.jahr,{erzeugung:0,eigenverbrauch:0,einspeisung:0});const z=W.get(N.jahr);z.erzeugung+=N.pv_erzeugung_kwh||0,z.eigenverbrauch+=N.eigenverbrauch_kwh||0,z.einspeisung+=N.einspeisung_kwh||0}return[...W.entries()].sort((N,z)=>N[0]-z[0]).map(([N,z])=>({name:N.toString(),Erzeugung:Math.round(z.erzeugung),Eigenverbrauch:Math.round(z.eigenverbrauch),Einspeisung:Math.round(z.einspeisung)}))},[o]),V=m.useMemo(()=>p===0?[]:[{name:"Eigenverbrauch",value:y,color:Wa.consumption},{name:"Einspeisung",value:f,color:Wa.feedin}],[p,y,f]),C=r||u||h,I=p>0,F=x.length>0||d.length>0,M=S.length>1;return C?e.jsx(Me,{text:"Lade PV-Anlage..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),_&&v&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Gesamtlaufzeit: ",_," bis ",v," (",w," Monate)"]})]})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:W=>s(parseInt(W.target.value)),options:t.map(W=>({value:W.id.toString(),label:W.anlagenname}))})]}),d.length>0&&e.jsx(ae,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsxs("span",{children:[d.length," PV-Modul(e) ohne Wechselrichter-Zuordnung."]})]})}),!F&&e.jsx(ae,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen → Investitionen anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(De,{title:"Anlagenleistung",value:b>0?b.toFixed(1):"---",unit:"kWp",subtitle:`${x.length} WR, ${x.reduce((W,N)=>W+N.pvModule.length,0)+d.length} Module`,icon:oe,color:"yellow"}),e.jsx(De,{title:"Gesamterzeugung",value:p>0?(p/1e3).toFixed(1):"---",unit:"MWh",subtitle:w>0?`${w} Monate Gesamtlaufzeit`:void 0,icon:_e,color:"green"}),e.jsx(De,{title:"Spez. Ertrag",value:j>0?j.toFixed(0):"---",unit:"kWh/kWp",subtitle:"Durchschnitt Gesamtlaufzeit",icon:We,color:"blue",formel:"Spez. Ertrag = Erzeugung ÷ Leistung",berechnung:`${D(p,0)} kWh ÷ ${D(b,1)} kWp`,ergebnis:`= ${D(j,0)} kWh/kWp`}),e.jsx(De,{title:"Eigenverbrauch",value:k>0?k.toFixed(1):"---",unit:"%",subtitle:y>0?`${(y/1e3).toFixed(1)} MWh`:void 0,icon:kc,color:"purple"})]}),F&&e.jsxs($,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsx("div",{className:"space-y-4",children:x.map(W=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:W.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[W.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[W.pvModule.map(N=>{var z;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(oe,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:N.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(z=N.leistung_kwp)==null?void 0:z.toFixed(1)," kWp",N.ausrichtung&&` • ${N.ausrichtung}`]})]},N.id)}),W.speicher.map(N=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(_e,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:N.bezeichnung})]},N.id))]})]},W.wechselrichter.id))})]}),I&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs($,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:M?"Jahresübersicht (Gesamtlaufzeit)":"Jahresübersicht"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:S,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name"}),e.jsx(be,{unit:" kWh"}),e.jsx(xe,{formatter:W=>[`${W.toLocaleString()} kWh`]}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"Erzeugung",fill:Wa.solar}),e.jsx(le,{dataKey:"Eigenverbrauch",fill:Wa.consumption}),e.jsx(le,{dataKey:"Einspeisung",fill:Wa.feedin})]})})})]}),e.jsxs($,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:V,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:W,percent:N})=>`${W}: ${(N*100).toFixed(0)}%`,labelLine:!1,children:V.map((W,N)=>e.jsx(Ge,{fill:W.color},`cell-${N}`))}),e.jsx(xe,{formatter:W=>[`${W.toLocaleString()} kWh`]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(y/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(f/1e3).toFixed(1)," MWh"]})]})]})]})]}),!I&&F&&e.jsxs($,{className:"text-center py-12",children:[e.jsx(Tt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]}),F&&I&&a&&e.jsx(Eg,{anlageId:a})]})}const Jl=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Wg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const u=await et.getEAutoDashboard(a);i(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:l=>s(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),h&&e.jsx(ae,{type:"error",children:h}),o?e.jsx(Me,{text:"Lade E-Auto Daten..."}):n.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ve,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein E-Auto unter "Investitionen" hinzu.'})]})}):n.map(l=>e.jsx(Fg,{dashboard:l},l.investition.id))]})}function Fg({dashboard:t}){var h;const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(g=>({name:`${Jl[g.monat]} ${g.jahr.toString().slice(2)}`,km:g.verbrauch_daten.km_gefahren||0,verbrauch:g.verbrauch_daten.verbrauch_kwh||0,pv:g.verbrauch_daten.ladung_pv_kwh||0,netz:g.verbrauch_daten.ladung_netz_kwh||0,extern:g.verbrauch_daten.ladung_extern_kwh||0,v2h:g.verbrauch_daten.v2h_entladung_kwh||0})),o=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.ladung_extern_kwh||0}].filter(g=>g.value>0),c=[{name:"E-Auto (Strom)",value:n.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:n.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.anzahl_monate," Monate Daten"]})]}),e.jsx(Ve,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Gefahren",value:((h=n.gesamt_km)==null?void 0:h.toLocaleString("de-DE"))||"0",unit:"km",icon:Ve,color:"blue",formel:"Σ km gefahren",berechnung:`${n.anzahl_monate} Monate`,ergebnis:`= ${(n.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(De,{title:"Verbrauch",value:(n.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:_e,color:"yellow",formel:"Verbrauch = kWh ÷ km × 100",berechnung:`${(n.gesamt_verbrauch_kwh||0).toFixed(0)} kWh ÷ ${n.gesamt_km||0} km × 100`,ergebnis:`= ${(n.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(De,{title:"PV-Anteil (Heim)",value:(n.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(n.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:mt,color:"green",formel:"PV-Anteil = PV-Ladung ÷ Heimladung × 100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(n.ladung_heim_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(n.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(De,{title:"Ersparnis vs. Benzin",value:(n.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",subtitle:`+ Wallbox: ${(n.wallbox_ersparnis_euro||0).toFixed(0)} €`,icon:We,color:"green",trend:(n.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten − Stromkosten",berechnung:`${(n.benzin_kosten_alternativ_euro||0).toFixed(0)} € − ${(n.strom_kosten_gesamt_euro||0).toFixed(0)} €`,ergebnis:`= ${(n.ersparnis_vs_benzin_euro||0).toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsxs(Ut,{data:o,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:g,percent:l})=>`${g}: ${(l*100).toFixed(0)}%`,children:[e.jsx(Ge,{fill:"#22c55e"})," ",e.jsx(Ge,{fill:"#f97316"})," ",e.jsx(Ge,{fill:"#ef4444"})," "]}),e.jsx(xe,{formatter:g=>`${g.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(n.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(n.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(n.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(n.ladung_extern_kwh||0).toFixed(0)," kWh (",(n.ladung_extern_euro||0).toFixed(2)," €)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:c,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{type:"number",tickFormatter:g=>`${g}€`}),e.jsx(be,{type:"category",dataKey:"name",width:120}),e.jsx(xe,{formatter:g=>`${g.toFixed(2)} €`}),e.jsx(le,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(n.ersparnis_vs_benzin_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(le,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(le,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(le,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(n.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(n.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(n.v2h_ersparnis_euro||0).toFixed(2)," €"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(n.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:a.map(g=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Jl[g.monat]," ",g.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:g.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(g.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(g.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(g.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(g.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},g.id))})]})})]})]})}const Ul=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Ag(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const u=await et.getWaermepumpeDashboard(a);i(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qe,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:l=>s(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),h&&e.jsx(ae,{type:"error",children:h}),o?e.jsx(Me,{text:"Lade Wärmepumpe Daten..."}):n.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Qe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wärmepumpe für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wärmepumpe unter "Investitionen" hinzu.'})]})}):n.map(l=>e.jsx($g,{dashboard:l},l.investition.id))]})}function $g({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(h=>({name:`${Ul[h.monat]} ${h.jahr.toString().slice(2)}`,strom:h.verbrauch_daten.stromverbrauch_kwh||0,heizung:h.verbrauch_daten.heizenergie_kwh||0,warmwasser:h.verbrauch_daten.warmwasser_kwh||0,cop:((h.verbrauch_daten.heizenergie_kwh||0)+(h.verbrauch_daten.warmwasser_kwh||0))/(h.verbrauch_daten.stromverbrauch_kwh||1)})),o=[{name:"Heizung",value:n.gesamt_heizenergie_kwh},{name:"Warmwasser",value:n.gesamt_warmwasser_kwh}],c=[{name:"Wärmepumpe",value:n.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/Öl",value:n.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.anzahl_monate," Monate Daten"]})]}),e.jsx(Qe,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Ø COP",value:n.durchschnitt_cop.toFixed(2),icon:Br,color:"orange",formel:"COP = Wärme ÷ Strom",berechnung:`${n.gesamt_waerme_kwh.toFixed(0)} kWh ÷ ${n.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${n.durchschnitt_cop.toFixed(2)}`}),e.jsx(De,{title:"Wärme erzeugt",value:(n.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:Qe,color:"red",formel:"Wärme = Heizung + Warmwasser",berechnung:`${n.gesamt_heizenergie_kwh.toFixed(0)} + ${n.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${n.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(De,{title:"Strom verbraucht",value:(n.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:_e,color:"yellow",formel:"Σ Stromverbrauch WP",berechnung:`${n.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(De,{title:"Ersparnis",value:n.ersparnis_euro.toFixed(0),unit:"€",icon:We,color:"green",trend:n.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/Öl-Kosten − WP-Kosten",berechnung:`${n.alte_heizung_kosten_euro.toFixed(0)} € − ${n.wp_kosten_euro.toFixed(0)} €`,ergebnis:`= ${n.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsxs(Ut,{data:o,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:g})=>`${h}: ${(g*100).toFixed(0)}%`,children:[e.jsx(Ge,{fill:"#ef4444"}),e.jsx(Ge,{fill:"#3b82f6"})]}),e.jsx(xe,{formatter:h=>`${h.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",n.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",n.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/Öl"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:c,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{type:"number",tickFormatter:h=>`${h}€`}),e.jsx(be,{type:"category",dataKey:"name",width:100}),e.jsx(xe,{formatter:h=>`${h.toFixed(2)} €`}),e.jsx(le,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",n.ersparnis_euro.toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx($t,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx($t,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{domain:[0,6]}),e.jsx(xe,{formatter:h=>h.toFixed(2)}),e.jsx(le,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(mt,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis gegenüber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:a.map(h=>{const g=h.verbrauch_daten.stromverbrauch_kwh||0,l=h.verbrauch_daten.heizenergie_kwh||0,u=h.verbrauch_daten.warmwasser_kwh||0,x=g>0?(l+u)/g:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Ul[h.monat]," ",h.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:g.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:l.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:u.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:x.toFixed(2)})]},h.id)})})]})})]})]})}const Cg=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Pg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const u=await et.getSpeicherDashboard(a);i(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:l=>s(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),h&&e.jsx(ae,{type:"error",children:h}),o?e.jsx(Me,{text:"Lade Speicher Daten..."}):n.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Fe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge einen Speicher unter "Investitionen" hinzu.'})]})}):n.map(l=>e.jsx(Dg,{dashboard:l},l.investition.id))]})}function Dg({dashboard:t}){var o;const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(c=>{const h=c.verbrauch_daten.ladung_kwh||0,g=c.verbrauch_daten.entladung_kwh||0,l=c.verbrauch_daten.speicher_ladung_netz_kwh||0;return{name:`${Cg[c.monat]} ${c.jahr.toString().slice(2)}`,ladung:h,entladung:g,arbitrage:l,pvLadung:h-l,zyklen:n.kapazitaet_kwh>0?h/n.kapazitaet_kwh:0,effizienz:h>0?g/h*100:0}});return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.kapazitaet_kwh," kWh Kapazität • ",n.anzahl_monate," Monate Daten"]})]}),e.jsx(Fe,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Vollzyklen",value:n.vollzyklen.toFixed(0),icon:Zh,color:"blue",formel:"Vollzyklen = Ladung ÷ Kapazität",berechnung:`${n.gesamt_ladung_kwh.toFixed(0)} kWh ÷ ${n.kapazitaet_kwh} kWh`,ergebnis:`= ${n.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(De,{title:"Effizienz",value:n.effizienz_prozent.toFixed(1),unit:"%",icon:kc,color:"green",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh ÷ ${n.gesamt_ladung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${n.effizienz_prozent.toFixed(1)} %`}),e.jsx(De,{title:"Durchsatz",value:(n.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:_e,color:"yellow",formel:"Durchsatz = Σ Entladung",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(De,{title:"Ersparnis",value:n.ersparnis_euro.toFixed(0),unit:"€",icon:We,color:"green",trend:n.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${n.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:n.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(n.gesamt_ladung_kwh-n.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),n.arbitrage_faehig&&n.arbitrage_kwh>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Vh,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h3",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Arbitrage (Netzladung)"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Netzladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[n.arbitrage_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Ø Ladepreis"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[((o=n.arbitrage_avg_preis_cent)==null?void 0:o.toFixed(1))||"-"," ct/kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Anteil an Ladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(n.arbitrage_kwh/n.gesamt_ladung_kwh*100).toFixed(0)," %"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Arbitrage-Gewinn"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:["+",n.arbitrage_gewinn_euro.toFixed(0)," €"]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),n.arbitrage_faehig&&n.arbitrage_kwh>0?e.jsxs(e.Fragment,{children:[e.jsx(le,{dataKey:"pvLadung",stackId:"ladung",fill:"#3b82f6",name:"PV-Ladung"}),e.jsx(le,{dataKey:"arbitrage",stackId:"ladung",fill:"#f59e0b",name:"Netz-Ladung"})]}):e.jsx(le,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(le,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{formatter:c=>c.toFixed(1)}),e.jsx($t,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{domain:[80,100]}),e.jsx(xe,{formatter:c=>`${c.toFixed(1)}%`}),e.jsx(qe,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((c,h)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:c.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:c.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:c.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:c.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[c.effizienz.toFixed(1),"%"]})]},h))})]})})]})]})}function Lg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const u=await et.getWallboxDashboard(a);i(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Kt,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:l=>s(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),h&&e.jsx(ae,{type:"error",children:h}),o?e.jsx(Me,{text:"Lade Wallbox Daten..."}):n.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Kt,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wallbox unter "Einstellungen → Investitionen" hinzu.'})]})}):n.map(l=>e.jsx(Ig,{dashboard:l},l.investition.id))]})}function Ig({dashboard:t}){const{investition:r,zusammenfassung:a}=t,s=a,n=[{name:"Heim: PV",value:s.ladung_pv_kwh||0},{name:"Heim: Netz",value:s.ladung_netz_kwh||0},{name:"Extern",value:s.extern_ladung_kwh||0}].filter(h=>h.value>0),i=[{name:"Heimladung (tatsächlich)",value:s.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:s.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],o=s.leistung_kw||11,c=(s.gesamt_heim_ladung_kwh||0)>0;return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o," kW Ladeleistung • ",s.anzahl_monate||0," Monate Daten"]})]}),e.jsx(Kt,{className:"h-10 w-10 text-purple-500"})]}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Heimladung",value:((s.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:lt,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} + ${(s.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(s.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(De,{title:"PV-Anteil",value:(s.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:mt,color:"green",formel:"PV-Anteil = PV ÷ Heimladung × 100",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(s.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(s.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(De,{title:"Ersparnis vs. Extern",value:(s.ersparnis_vs_extern_euro||0).toFixed(0),unit:"€",subtitle:"Wallbox-ROI",icon:We,color:"green",trend:(s.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten − Heim-Kosten",berechnung:`${(s.heim_als_extern_kosten_euro||0).toFixed(0)} € − ${(s.heim_kosten_euro||0).toFixed(0)} €`,ergebnis:`= ${(s.ersparnis_vs_extern_euro||0).toFixed(2)} €`}),e.jsx(De,{title:"Ladevorgänge",value:(s.gesamt_ladevorgaenge||0).toString(),subtitle:`Ø ${(s.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:_e,color:"blue",formel:"Σ Ladevorgänge",berechnung:`${s.anzahl_monate||0} Monate`,ergebnis:`= ${s.gesamt_ladevorgaenge||0} Vorgänge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsxs(Ut,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:g})=>`${h}: ${(g*100).toFixed(0)}%`,children:[e.jsx(Ge,{fill:"#22c55e"})," ",e.jsx(Ge,{fill:"#f97316"})," ",e.jsx(Ge,{fill:"#ef4444"})," "]}),e.jsx(xe,{formatter:h=>`${h.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(s.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(s.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-4 w-4 text-red-500"}),"Extern: ",(s.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{type:"number",tickFormatter:h=>`${h}€`}),e.jsx(be,{type:"category",dataKey:"name",width:150}),e.jsx(xe,{formatter:h=>`${h.toFixed(2)} €`}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(s.ersparnis_vs_extern_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklärt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(s.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(s.ladung_netz_kwh||0).toFixed(0)," kWh = ",(s.heim_kosten_euro||0).toFixed(2)," €)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(s.extern_preis_kwh_euro||.5).toFixed(2)," €/kWh"]})]}),(s.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatsächliche externe Ladung: ",(s.extern_ladung_kwh||0).toFixed(0)," kWh für ",(s.extern_kosten_euro||0).toFixed(2)," €"]})]}),r.anschaffungskosten_gesamt&&r.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[s.anzahl_monate&&s.anzahl_monate>0?((s.ersparnis_vs_extern_euro||0)/s.anzahl_monate*12).toFixed(0):0," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const h=s.anzahl_monate&&s.anzahl_monate>0?(s.ersparnis_vs_extern_euro||0)/s.anzahl_monate*12:0;return h<=0?"∞":`${(r.anschaffungskosten_gesamt/h).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen → Monatsdaten".'})})]})}const Vg=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Bg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const u=await et.getBalkonkraftwerkDashboard(a);i(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:l=>s(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),h&&e.jsx(ae,{type:"error",children:h}),o?e.jsx(Me,{text:"Lade Balkonkraftwerk Daten..."}):n.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):n.map(l=>e.jsx(Og,{dashboard:l},l.investition.id))]})}function Og({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(h=>({name:`${Vg[h.monat]} ${h.jahr.toString().slice(2)}`,erzeugung:h.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:h.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:h.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:h.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:h.verbrauch_daten.speicher_entladung_kwh||0})),o=[{name:"Eigenverbrauch",value:n.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:n.gesamt_einspeisung_kwh}],c=["#22c55e","#f59e0b"];return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.leistung_wp," Wp • ",n.anzahl_module," Module • ",n.anzahl_monate," Monate Daten",n.hat_speicher&&` • ${n.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(oe,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Erzeugung",value:n.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:_e,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${n.anzahl_monate} Monate`,ergebnis:`= ${n.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(De,{title:"Eigenverbrauch",value:n.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:lt,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh ÷ ${n.gesamt_erzeugung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${n.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(De,{title:"Ersparnis",value:n.gesamt_ersparnis_euro.toFixed(0),unit:"€",icon:We,color:"green",trend:n.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${n.gesamt_ersparnis_euro.toFixed(2)} €`}),e.jsx(De,{title:"CO₂ gespart",value:n.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:mt,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × 0.4`,ergebnis:`= ${n.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["Einspeisung",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(unvergütet)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[n.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Entgangener Erlös",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(8 ct/kWh)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-500 dark:text-gray-400",children:[(n.gesamt_einspeisung_kwh*.08).toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:o,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:g})=>`${h}: ${(g*100).toFixed(0)}%`,children:o.map((h,g)=>e.jsx(Ge,{fill:c[g%c.length]},`cell-${g}`))}),e.jsx(xe,{formatter:h=>`${h.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",n.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",n.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx($t,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx($t,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),n.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Fe,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",n.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(le,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(mt,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),n.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:i.map((h,g)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:h.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:h.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:h.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:h.einspeisung.toFixed(1)}),n.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:h.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:h.speicher_entladung.toFixed(1)})]})]},g))})]})})]})]})}const rl=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],al={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function Rg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const u=await et.getSonstigesDashboard(a);i(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(en,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:l=>s(parseInt(l.target.value)),options:t.map(l=>({value:l.id.toString(),label:l.anlagenname}))})]}),h&&e.jsx(ae,{type:"error",children:h}),o?e.jsx(Me,{text:"Lade Daten..."}):n.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(en,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):n.map(l=>e.jsx(Tg,{dashboard:l},l.investition.id))]})}function Tg({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=n.kategorie;return i==="erzeuger"?e.jsx(Kg,{investition:r,monatsdaten:a,zusammenfassung:n}):i==="verbraucher"?e.jsx(Hg,{investition:r,monatsdaten:a,zusammenfassung:n}):e.jsx(Gg,{investition:r,monatsdaten:a,zusammenfassung:n})}function Kg({investition:t,monatsdaten:r,zusammenfassung:a}){const s=r.map(i=>({name:`${rl[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0})),n=[{name:"Eigenverbrauch",value:a.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:a.gesamt_einspeisung_kwh||0}];return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:al[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(_e,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Erzeugung",value:(a.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:_e,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(De,{title:"Eigenverbrauch",value:(a.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:lt,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} ÷ ${(a.gesamt_erzeugung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(a.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(De,{title:"Ersparnis",value:(a.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",icon:We,color:"green",trend:(a.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.gesamt_ersparnis_euro||0).toFixed(2)} €`}),e.jsx(De,{title:"CO₂ gespart",value:(a.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:mt,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × 0.4`,ergebnis:`= ${(a.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(nt,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsxs(Ut,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:o})=>`${i}: ${(o*100).toFixed(0)}%`,children:[e.jsx(Ge,{fill:"#22c55e"}),e.jsx(Ge,{fill:"#f59e0b"})]}),e.jsx(xe,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:s,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx($t,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx($t,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:s.map((i,o)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)})]},o))})]})})]})]})}function Hg({investition:t,monatsdaten:r,zusammenfassung:a}){const s=r.map(i=>({name:`${rl[i.monat]} ${i.jahr.toString().slice(2)}`,verbrauch:i.verbrauch_daten.verbrauch_kwh||0,bezug_pv:i.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:i.verbrauch_daten.bezug_netz_kwh||0})),n=[{name:"PV-Strom",value:a.bezug_pv_kwh||0},{name:"Netzstrom",value:a.bezug_netz_kwh||0}];return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:al[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(_e,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Verbrauch",value:(a.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:_e,color:"blue",formel:"Σ Verbrauch alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(De,{title:"PV-Anteil",value:(a.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:lt,color:"green",formel:"PV-Anteil = PV-Bezug ÷ Verbrauch × 100",berechnung:`${(a.bezug_pv_kwh||0).toFixed(0)} ÷ ${(a.gesamt_verbrauch_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(a.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(De,{title:"Netzkosten",value:(a.kosten_netz_euro||0).toFixed(0),unit:"€",icon:We,color:"red",formel:"Netzkosten = Netzbezug × Strompreis",berechnung:`${(a.bezug_netz_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.kosten_netz_euro||0).toFixed(2)} €`}),e.jsx(De,{title:"PV-Ersparnis",value:(a.ersparnis_pv_euro||0).toFixed(0),unit:"€",icon:mt,color:"green",trend:(a.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug × Strompreis",berechnung:`${(a.bezug_pv_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.ersparnis_pv_euro||0).toFixed(2)} €`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(nt,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsxs(Ut,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:o})=>`${i}: ${(o*100).toFixed(0)}%`,children:[e.jsx(Ge,{fill:"#22c55e"}),e.jsx(Ge,{fill:"#ef4444"})]}),e.jsx(xe,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:s,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(le,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:s.map((i,o)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:i.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:i.bezug_netz.toFixed(1)})]},o))})]})})]})]})}function Gg({investition:t,monatsdaten:r,zusammenfassung:a}){const s=r.map(n=>({name:`${rl[n.monat]} ${n.jahr.toString().slice(2)}`,ladung:n.verbrauch_daten.ladung_kwh||0,entladung:n.verbrauch_daten.entladung_kwh||0}));return e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:al[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Fe,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Ladung",value:(a.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:Fe,color:"purple",formel:"Σ Ladung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(De,{title:"Entladung",value:(a.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:_e,color:"green",formel:"Σ Entladung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(De,{title:"Effizienz",value:(a.effizienz_prozent||0).toFixed(1),unit:"%",icon:We,color:"blue",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${(a.gesamt_entladung_kwh||0).toFixed(0)} ÷ ${(a.gesamt_ladung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(a.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(De,{title:"Ersparnis",value:(a.ersparnis_euro||0).toFixed(0),unit:"€",icon:We,color:"green",trend:(a.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${(a.gesamt_entladung_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.ersparnis_euro||0).toFixed(2)} €`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(nt,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:s,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(le,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:s.map((n,i)=>{const o=n.ladung>0?n.entladung/n.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:n.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:n.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:n.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[o.toFixed(1),"%"]})]},i)})})]})})]})]})}function Zg(t,r){const a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function hs(t,r,a){const s=t.join(";"),n=r.map(c=>c.map(h=>h==null||h===""?"":typeof h=="number"?h.toString().replace(".",","):typeof h=="string"&&(h.includes(";")||h.includes('"'))?`"${h.replace(/"/g,'""')}"`:String(h)).join(";")),i=[s,...n].join(`
`),o=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8"});Zg(o,a)}function Se({title:t,value:r,unit:a,subtitle:s,icon:n,color:i,bgColor:o,formel:c,berechnung:h,ergebnis:g}){const l=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal",children:a})]});return e.jsx($,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:c?e.jsx(Cr,{formel:c,berechnung:h,ergebnis:g,children:l}):l}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl ${o}`,children:e.jsx(n,{className:`h-6 w-6 ${i}`})})]})})}const Oc=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Qt={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},Wt={erzeugung:"#f59e0b",eigenverbrauch:"#8b5cf6",einspeisung:"#10b981",netzbezug:"#ef4444",autarkie:"#3b82f6",evQuote:"#a855f7",spezErtrag:"#eab308",speicherLadung:"#22c55e",speicherEntladung:"#3b82f6",speicherEffizienz:"#06b6d4",wpWaerme:"#ef4444",wpStrom:"#8b5cf6",wpCop:"#f97316",emobPvAnteil:"#10b981"},Tr={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},Fa={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function sl(t,r,a){return[...t].sort((n,i)=>n.jahr!==i.jahr?n.jahr-i.jahr:n.monat-i.monat).map(n=>{const i=n.pv_erzeugung_kwh||0,o=n.eigenverbrauch_kwh||0,c=n.gesamtverbrauch_kwh||o+n.netzbezug_kwh,h=n.direktverbrauch_kwh||0,g=n.autarkie_prozent??(c>0?o/c*100:0),l=n.eigenverbrauchsquote_prozent??(i>0?o/i*100:0),u=r!=null&&r.leistung_kwp?i/r.leistung_kwp:0,x=n.speicher_ladung_kwh||0,d=n.speicher_entladung_kwh||0,b=x>0?d/x*100:null,p=(n.wp_heizung_kwh||0)+(n.wp_warmwasser_kwh||0),y=n.wp_strom_kwh||0,f=y>0?p/y:null,j=n.eauto_km||0,k=n.eauto_ladung_kwh||0,w=null,_=a?n.einspeisung_kwh*a.einspeiseverguetung_cent_kwh/100:0,v=a?o*a.netzbezug_arbeitspreis_cent_kwh/100:0,S=a?n.netzbezug_kwh*a.netzbezug_arbeitspreis_cent_kwh/100:0,V=_+v,I=i*.38;return{name:`${Oc[n.monat]} ${n.jahr.toString().slice(-2)}`,jahr:n.jahr,monat:n.monat,erzeugung:i,eigenverbrauch:o,einspeisung:n.einspeisung_kwh,netzbezug:n.netzbezug_kwh,gesamtverbrauch:c,direktverbrauch:h,autarkie:g,evQuote:l,spezErtrag:u,speicher_ladung:x,speicher_entladung:d,speicher_effizienz:b,wp_waerme:p,wp_strom:y,wp_cop:f,eauto_km:j,eauto_ladung:k,eauto_pv_anteil:w,einspeise_erloes:_,ev_ersparnis:v,netzbezug_kosten:S,netto_ertrag:V,co2_einsparung:I}})}function qg({data:t,stats:r,anlage:a,strompreis:s,zeitraumLabel:n}){const i=m.useMemo(()=>sl(t,a,s),[t,a,s]),o=()=>{const h=["Monat","Erzeugung (kWh)","Eigenverbrauch (kWh)","Einspeisung (kWh)","Netzbezug (kWh)","Autarkie (%)","EV-Quote (%)","Spez. Ertrag (kWh/kWp)"],g=i.map(l=>[l.name,l.erzeugung,l.eigenverbrauch,l.einspeisung,l.netzbezug,l.autarkie,l.evQuote,l.spezErtrag]);hs(h,g,`energie_${(a==null?void 0:a.anlagenname)||"export"}.csv`)},c=m.useMemo(()=>{if(!s)return null;const h=r.gesamtEinspeisung*s.einspeiseverguetung_cent_kwh/100,g=r.gesamtEigenverbrauch*s.netzbezug_arbeitspreis_cent_kwh/100;return h+g},[r,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","•"," ",r.anzahlMonate," Monate"]}),e.jsxs(he,{variant:"secondary",size:"sm",onClick:o,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"PV-Erzeugung",value:(r.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:oe,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${D(r.gesamtErzeugung,0)} kWh`,ergebnis:`= ${D(r.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(Se,{title:"Eigenverbrauch",value:r.gesamtErzeugung>0?(r.gesamtEigenverbrauch/r.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(r.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:_e,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${D(r.gesamtEigenverbrauch,0)} kWh ÷ ${D(r.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${D(r.gesamtEigenverbrauch/r.gesamtErzeugung*100,1)} %`}),e.jsx(Se,{title:"Autarkie",value:r.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:We,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${D(r.durchschnittAutarkie,1)} %`}),e.jsx(Se,{title:"Spez. Ertrag",value:a!=null&&a.leistung_kwp?(r.gesamtErzeugung/a.leistung_kwp).toFixed(0):"---",unit:"kWh/kWp",subtitle:a!=null&&a.leistung_kwp?`${a.leistung_kwp} kWp`:void 0,icon:oe,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"PV-Erzeugung ÷ Anlagenleistung",berechnung:a!=null&&a.leistung_kwp?`${D(r.gesamtErzeugung,0)} kWh ÷ ${a.leistung_kwp} kWp`:void 0,ergebnis:a!=null&&a.leistung_kwp?`= ${D(r.gesamtErzeugung/a.leistung_kwp,0)} kWh/kWp`:void 0})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-blue-500"}),"Energie-Bilanz pro Monat"]}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{tickFormatter:h=>`${h.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(xe,{formatter:(h,g)=>[`${h.toFixed(0)} kWh`,g],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"eigenverbrauch",name:"Eigenverbrauch",fill:Wt.eigenverbrauch,stackId:"pv"}),e.jsx(le,{dataKey:"einspeisung",name:"Einspeisung",fill:Wt.einspeisung,stackId:"pv"}),e.jsx(le,{dataKey:"netzbezug",name:"Netzbezug",fill:Wt.netzbezug})]})})})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-green-500"}),"Effizienz-Trends"]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",tickFormatter:h=>`${h.toFixed(0)}`,unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(xe,{formatter:(h,g)=>g.includes("kWh/kWp")?[`${h.toFixed(0)} kWh/kWp`,g]:[`${h.toFixed(1)}%`,g],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),e.jsx(qe,{yAxisId:"left",type:"monotone",dataKey:"autarkie",name:"Autarkie (%)",stroke:Wt.autarkie,strokeWidth:2,dot:!1}),e.jsx(qe,{yAxisId:"left",type:"monotone",dataKey:"evQuote",name:"EV-Quote (%)",stroke:Wt.evQuote,strokeWidth:2,dot:!1}),e.jsx(le,{yAxisId:"right",dataKey:"spezErtrag",name:"Spez. Ertrag (kWh/kWp)",fill:Wt.spezErtrag,opacity:.7})]})})})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-yellow-500"}),"PV-Erzeugung Verlauf"]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(xe,{formatter:h=>[`${h.toFixed(0)} kWh`,"Erzeugung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(qe,{type:"monotone",dataKey:"erzeugung",name:"PV-Erzeugung",stroke:Wt.erzeugung,strokeWidth:2,dot:!1})]})})})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[r.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(a==null?void 0:a.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Netto-Ertrag"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:c?`${c.toFixed(0)} €`:"---"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(r.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function Jg({anlage:t,strompreis:r,selectedYear:a,zeitraumLabel:s}){var j,k,w;const[n,i]=m.useState(null),[o,c]=m.useState(!0),[h,g]=m.useState(null);m.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{c(!0),g(null);try{const v=a&&a!=="all"?a:void 0,S=await Qr.getKomponentenZeitreihe(t.id,v);i(S)}catch(v){g("Fehler beim Laden der Komponentendaten"),console.error(v)}finally{c(!1)}})()},[t==null?void 0:t.id,a]);const l=m.useMemo(()=>n!=null&&n.monatswerte?n.monatswerte.map(_=>({..._,name:`${Oc[_.monat]} ${_.jahr.toString().slice(-2)}`})):[],[n]),u=m.useMemo(()=>{if(!l.length)return{ladung:0,entladung:0,effizienz:null,arbitrage:0};const _=l.reduce((V,C)=>V+C.speicher_ladung_kwh,0),v=l.reduce((V,C)=>V+C.speicher_entladung_kwh,0),S=l.reduce((V,C)=>V+C.speicher_arbitrage_kwh,0);return{ladung:_,entladung:v,effizienz:_>0?v/_*100:null,arbitrage:S}},[l]),x=m.useMemo(()=>{if(!l.length)return{waerme:0,strom:0,cop:null,heizung:0,warmwasser:0};const _=l.reduce((C,I)=>C+I.wp_waerme_kwh,0),v=l.reduce((C,I)=>C+I.wp_strom_kwh,0),S=l.reduce((C,I)=>C+I.wp_heizung_kwh,0),V=l.reduce((C,I)=>C+I.wp_warmwasser_kwh,0);return{waerme:_,strom:v,cop:v>0?_/v:null,heizung:S,warmwasser:V}},[l]),d=m.useMemo(()=>{if(!l.length)return{km:0,ladung:0,pvAnteil:null,pvLadung:0,netzLadung:0,externLadung:0,externEuro:0,v2h:0};const _=l.reduce((W,N)=>W+N.emob_km,0),v=l.reduce((W,N)=>W+N.emob_ladung_kwh,0),S=l.reduce((W,N)=>W+N.emob_ladung_pv_kwh,0),V=l.reduce((W,N)=>W+N.emob_ladung_netz_kwh,0),C=l.reduce((W,N)=>W+N.emob_ladung_extern_kwh,0),I=l.reduce((W,N)=>W+N.emob_ladung_extern_euro,0),F=l.reduce((W,N)=>W+N.emob_v2h_kwh,0),M=v>0?S/v*100:null;return{km:_,ladung:v,pvAnteil:M,pvLadung:S,netzLadung:V,externLadung:C,externEuro:I,v2h:F}},[l]),b=m.useMemo(()=>l.length?{erzeugung:l.reduce((_,v)=>_+v.bkw_erzeugung_kwh,0),eigenverbrauch:l.reduce((_,v)=>_+v.bkw_eigenverbrauch_kwh,0),speicherLadung:l.reduce((_,v)=>_+v.bkw_speicher_ladung_kwh,0),speicherEntladung:l.reduce((_,v)=>_+v.bkw_speicher_entladung_kwh,0)}:{erzeugung:0,eigenverbrauch:0,speicherLadung:0,speicherEntladung:0},[l]),p=m.useMemo(()=>l.length?{erzeugung:l.reduce((_,v)=>_+v.sonstiges_erzeugung_kwh,0),verbrauch:l.reduce((_,v)=>_+v.sonstiges_verbrauch_kwh,0)}:{erzeugung:0,verbrauch:0},[l]);m.useMemo(()=>l.length?l.reduce((_,v)=>_+v.sonderkosten_euro,0):0,[l]);const y=()=>{if(!l.length)return;const _=["Monat"];n!=null&&n.hat_speicher&&_.push("Speicher Ladung (kWh)","Speicher Entladung (kWh)","Speicher Effizienz (%)"),n!=null&&n.hat_waermepumpe&&_.push("WP Wärme (kWh)","WP Strom (kWh)","WP COP"),n!=null&&n.hat_emobilitaet&&_.push("E-Auto km","E-Auto Ladung (kWh)","E-Auto PV-Anteil (%)"),n!=null&&n.hat_balkonkraftwerk&&_.push("BKW Erzeugung (kWh)","BKW Eigenverbrauch (kWh)"),n!=null&&n.hat_sonstiges&&_.push("Sonstiges Erzeugung (kWh)","Sonstiges Verbrauch (kWh)");const v=l.map(S=>{const V=[S.name];return n!=null&&n.hat_speicher&&V.push(S.speicher_ladung_kwh,S.speicher_entladung_kwh,S.speicher_effizienz_prozent??""),n!=null&&n.hat_waermepumpe&&V.push(S.wp_waerme_kwh,S.wp_strom_kwh,S.wp_cop??""),n!=null&&n.hat_emobilitaet&&V.push(S.emob_km,S.emob_ladung_kwh,S.emob_pv_anteil_prozent??""),n!=null&&n.hat_balkonkraftwerk&&V.push(S.bkw_erzeugung_kwh,S.bkw_eigenverbrauch_kwh),n!=null&&n.hat_sonstiges&&V.push(S.sonstiges_erzeugung_kwh,S.sonstiges_verbrauch_kwh),V});hs(_,v,`komponenten_${(t==null?void 0:t.anlagenname)||"export"}.csv`)};return o?e.jsxs($,{className:"text-center py-12",children:[e.jsx(gr,{className:"h-12 w-12 mx-auto text-gray-400 mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Komponentendaten..."})]}):h?e.jsxs($,{className:"text-center py-12",children:[e.jsx(nt,{className:"h-12 w-12 mx-auto text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:h})]}):n&&(n.hat_speicher||n.hat_waermepumpe||n.hat_emobilitaet||n.hat_balkonkraftwerk||n.hat_sonstiges)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s})," ","•"," ",(n==null?void 0:n.anzahl_monate)||0," Monate"]}),e.jsxs(he,{variant:"secondary",size:"sm",onClick:y,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),(n==null?void 0:n.hat_speicher)&&u.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Fe,{className:"h-6 w-6 text-green-500"}),"Speicher",n.hat_arbitrage&&e.jsx("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded",children:"Arbitrage"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Ladung gesamt",value:(u.ladung/1e3).toFixed(2),unit:"MWh",icon:Fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung aller Monate",berechnung:`${D(u.ladung,0)} kWh`,ergebnis:`= ${D(u.ladung/1e3,2)} MWh`}),e.jsx(Se,{title:"Entladung gesamt",value:(u.entladung/1e3).toFixed(2),unit:"MWh",icon:Fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung aller Monate",berechnung:`${D(u.entladung,0)} kWh`,ergebnis:`= ${D(u.entladung/1e3,2)} MWh`}),e.jsx(Se,{title:"Ø Effizienz",value:((j=u.effizienz)==null?void 0:j.toFixed(1))||"---",unit:"%",icon:Fe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${D(u.entladung,0)} kWh ÷ ${D(u.ladung,0)} kWh × 100`,ergebnis:u.effizienz?`= ${D(u.effizienz,1)}%`:"---"}),n.hat_arbitrage&&u.arbitrage>0?e.jsx(Se,{title:"Arbitrage",value:u.arbitrage.toFixed(0),unit:"kWh",subtitle:"Netzladung",icon:Fe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ Netzladung für Arbitrage"}):e.jsx(Se,{title:"Verlust",value:(u.ladung-u.entladung).toFixed(0),unit:"kWh",subtitle:u.effizienz?`${(100-u.effizienz).toFixed(1)}%`:void 0,icon:Fe,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Speicher pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:l.filter(_=>_.speicher_ladung_kwh>0||_.speicher_entladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",tickFormatter:_=>`${_.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(xe,{formatter:(_,v)=>v.includes("Effizienz")?[`${(_==null?void 0:_.toFixed(1))||"---"}%`,v]:[`${_.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),e.jsx(le,{yAxisId:"left",dataKey:"speicher_ladung_kwh",name:"Ladung",fill:Wt.speicherLadung}),e.jsx(le,{yAxisId:"left",dataKey:"speicher_entladung_kwh",name:"Entladung",fill:Wt.speicherEntladung}),n.hat_arbitrage&&e.jsx(le,{yAxisId:"left",dataKey:"speicher_arbitrage_kwh",name:"Arbitrage (Netz)",fill:"#8b5cf6"}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"speicher_effizienz_prozent",name:"Effizienz (%)",stroke:Wt.speicherEffizienz,strokeWidth:2,dot:!1})]})})})]})]}),(n==null?void 0:n.hat_waermepumpe)&&x.strom>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Qe,{className:"h-6 w-6 text-red-500"}),"Wärmepumpe"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Wärme erzeugt",value:(x.waerme/1e3).toFixed(2),unit:"MWh",icon:Qe,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Wärme aller Monate",berechnung:`${D(x.waerme,0)} kWh`,ergebnis:`= ${D(x.waerme/1e3,2)} MWh`}),e.jsx(Se,{title:"Strom verbraucht",value:(x.strom/1e3).toFixed(2),unit:"MWh",icon:Qe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Strom aller Monate",berechnung:`${D(x.strom,0)} kWh`,ergebnis:`= ${D(x.strom/1e3,2)} MWh`}),e.jsx(Se,{title:"Ø COP",value:((k=x.cop)==null?void 0:k.toFixed(2))||"---",unit:"",subtitle:"Jahresarbeitszahl",icon:Qe,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${D(x.waerme,0)} kWh ÷ ${D(x.strom,0)} kWh`,ergebnis:x.cop?`= ${D(x.cop,2)} COP`:"---"}),e.jsx(Se,{title:"Ersparnis vs. Gas",value:r?(x.waerme*.08-x.strom*r.netzbezug_arbeitspreis_cent_kwh/100).toFixed(0):"---",unit:"€",subtitle:"ca. 8 ct/kWh Gas",icon:Qe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]}),(x.heizung>0||x.warmwasser>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Heizung",value:(x.heizung/1e3).toFixed(2),unit:"MWh",subtitle:x.waerme>0?`${(x.heizung/x.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:Qe,color:"text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizenergie aller Monate"}),e.jsx(Se,{title:"Warmwasser",value:(x.warmwasser/1e3).toFixed(2),unit:"MWh",subtitle:x.waerme>0?`${(x.warmwasser/x.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:Qe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Warmwasser-Energie aller Monate"})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Wärmepumpe pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:l.filter(_=>_.wp_waerme_kwh>0||_.wp_strom_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",tickFormatter:_=>`${_.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",domain:[0,"auto"],tick:{fontSize:11}}),e.jsx(xe,{formatter:(_,v)=>v==="COP"?[`${(_==null?void 0:_.toFixed(2))||"---"}`,v]:[`${_.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),x.heizung>0||x.warmwasser>0?e.jsxs(e.Fragment,{children:[e.jsx(le,{yAxisId:"left",dataKey:"wp_heizung_kwh",name:"Heizung",stackId:"waerme",fill:"#f87171"}),e.jsx(le,{yAxisId:"left",dataKey:"wp_warmwasser_kwh",name:"Warmwasser",stackId:"waerme",fill:"#60a5fa"})]}):e.jsx(le,{yAxisId:"left",dataKey:"wp_waerme_kwh",name:"Wärme",fill:Wt.wpWaerme}),e.jsx(le,{yAxisId:"left",dataKey:"wp_strom_kwh",name:"Strom",fill:Wt.wpStrom}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"wp_cop",name:"COP",stroke:Wt.wpCop,strokeWidth:2,dot:!1})]})})})]})]}),(n==null?void 0:n.hat_emobilitaet)&&d.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ve,{className:"h-6 w-6 text-purple-500"}),"E-Mobilität",n.hat_v2h&&e.jsx("span",{className:"text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 px-2 py-0.5 rounded",children:"V2H"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Gefahrene km",value:(d.km/1e3).toFixed(1),unit:"Tkm",icon:Ve,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene km aller Monate",berechnung:`${D(d.km,0)} km`,ergebnis:`= ${D(d.km/1e3,1)} Tausend km`}),e.jsx(Se,{title:"Ladung gesamt",value:(d.ladung/1e3).toFixed(2),unit:"MWh",icon:Ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ E-Auto-Ladung aller Monate",berechnung:`${D(d.ladung,0)} kWh`,ergebnis:`= ${D(d.ladung/1e3,2)} MWh`}),e.jsx(Se,{title:"Ø PV-Anteil",value:((w=d.pvAnteil)==null?void 0:w.toFixed(0))||"---",unit:"%",icon:Ve,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Ladung ÷ Gesamtladung × 100",berechnung:`${D(d.pvLadung,0)} kWh ÷ ${D(d.ladung,0)} kWh × 100`,ergebnis:d.pvAnteil?`= ${D(d.pvAnteil,0)}%`:"---"}),e.jsx(Se,{title:"Verbrauch",value:d.km>0?(d.ladung/d.km*100).toFixed(1):"---",unit:"kWh/100km",icon:Ve,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Ladung ÷ km × 100",berechnung:`${D(d.ladung,0)} kWh ÷ ${D(d.km,0)} km × 100`,ergebnis:d.km>0?`= ${D(d.ladung/d.km*100,1)} kWh/100km`:"---"})]}),(d.pvLadung>0||d.netzLadung>0||d.externLadung>0||d.v2h>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"PV-Ladung",value:d.pvLadung.toFixed(0),unit:"kWh",subtitle:d.ladung>0?`${(d.pvLadung/d.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:oe,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ Ladung aus eigener PV"}),e.jsx(Se,{title:"Netz-Ladung",value:d.netzLadung.toFixed(0),unit:"kWh",subtitle:d.ladung>0?`${(d.netzLadung/d.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:_e,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Ladung aus Netzstrom"}),d.externLadung>0&&e.jsx(Se,{title:"Extern geladen",value:d.externLadung.toFixed(0),unit:"kWh",subtitle:d.externEuro>0?`${D(d.externEuro,2)} €`:void 0,icon:Ve,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Σ Ladung an öffentlichen Säulen"}),n.hat_v2h&&d.v2h>0&&e.jsx(Se,{title:"V2H Entladung",value:d.v2h.toFixed(0),unit:"kWh",subtitle:r?`≈ ${D(d.v2h*r.netzbezug_arbeitspreis_cent_kwh/100,0)} € Ersparnis`:void 0,icon:Fe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Σ Rückspeisung ins Haus (Vehicle-to-Home)"})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"E-Mobilität pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:l.filter(_=>_.emob_km>0||_.emob_ladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(xe,{formatter:(_,v)=>v.includes("PV-Anteil")?[`${(_==null?void 0:_.toFixed(0))||"---"}%`,v]:v.includes("km")?[`${_.toFixed(0)} km`,v]:v.includes("€")?[`${_.toFixed(2)} €`,v]:[`${_.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),e.jsx(le,{yAxisId:"left",dataKey:"emob_ladung_pv_kwh",name:"PV-Ladung",stackId:"ladung",fill:"#f59e0b"}),e.jsx(le,{yAxisId:"left",dataKey:"emob_ladung_netz_kwh",name:"Netz-Ladung",stackId:"ladung",fill:"#ef4444"}),d.externLadung>0&&e.jsx(le,{yAxisId:"left",dataKey:"emob_ladung_extern_kwh",name:"Extern",stackId:"ladung",fill:"#f97316"}),n.hat_v2h&&e.jsx(le,{yAxisId:"left",dataKey:"emob_v2h_kwh",name:"V2H",fill:"#06b6d4"}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"emob_pv_anteil_prozent",name:"PV-Anteil (%)",stroke:Wt.emobPvAnteil,strokeWidth:2,dot:!1})]})})})]})]}),(n==null?void 0:n.hat_balkonkraftwerk)&&b.erzeugung>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(oe,{className:"h-6 w-6 text-yellow-500"}),"Balkonkraftwerk",b.speicherLadung>0&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded",children:"mit Speicher"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Die BKW-Erzeugung ist in der PV-Gesamterzeugung enthalten, wird hier aber separat ausgewiesen."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Erzeugung gesamt",value:b.erzeugung.toFixed(0),unit:"kWh",icon:oe,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ BKW-Erzeugung aller Monate",berechnung:`${D(b.erzeugung,0)} kWh`,ergebnis:`= ${D(b.erzeugung,0)} kWh`}),e.jsx(Se,{title:"Eigenverbrauch",value:b.eigenverbrauch.toFixed(0),unit:"kWh",icon:oe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Eigenverbrauch aller Monate",berechnung:`${D(b.eigenverbrauch,0)} kWh`,ergebnis:`= ${D(b.eigenverbrauch,0)} kWh`}),e.jsx(Se,{title:"EV-Quote",value:b.erzeugung>0?(b.eigenverbrauch/b.erzeugung*100).toFixed(0):"---",unit:"%",icon:oe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${D(b.eigenverbrauch,0)} kWh ÷ ${D(b.erzeugung,0)} kWh × 100`,ergebnis:b.erzeugung>0?`= ${D(b.eigenverbrauch/b.erzeugung*100,0)}%`:"---"}),e.jsx(Se,{title:"Einspeisung",value:(b.erzeugung-b.eigenverbrauch).toFixed(0),unit:"kWh",subtitle:"geschätzt",icon:oe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"})]}),b.speicherLadung>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Speicher Ladung",value:b.speicherLadung.toFixed(0),unit:"kWh",icon:Fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Speicher Ladung"}),e.jsx(Se,{title:"Speicher Entladung",value:b.speicherEntladung.toFixed(0),unit:"kWh",icon:Fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ BKW-Speicher Entladung"}),e.jsx(Se,{title:"Speicher Effizienz",value:b.speicherLadung>0?(b.speicherEntladung/b.speicherLadung*100).toFixed(0):"---",unit:"%",icon:Fe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100"})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Balkonkraftwerk pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:l.filter(_=>_.bkw_erzeugung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(xe,{formatter:(_,v)=>[`${_.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"bkw_erzeugung_kwh",name:"Erzeugung",fill:"#f59e0b"}),e.jsx(le,{dataKey:"bkw_eigenverbrauch_kwh",name:"Eigenverbrauch",fill:"#10b981"}),b.speicherLadung>0&&e.jsxs(e.Fragment,{children:[e.jsx(le,{dataKey:"bkw_speicher_ladung_kwh",name:"Speicher Ladung",fill:"#22c55e"}),e.jsx(le,{dataKey:"bkw_speicher_entladung_kwh",name:"Speicher Entladung",fill:"#3b82f6"})]})]})})})]})]}),(n==null?void 0:n.hat_sonstiges)&&(p.erzeugung>0||p.verbrauch>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(_e,{className:"h-6 w-6 text-gray-500"}),"Sonstige Komponenten"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:'Aggregiert alle Investitionen vom Typ "Sonstiges" (z.B. Mini-BHKW, Pool-Pumpe).'})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[p.erzeugung>0&&e.jsx(Se,{title:"Erzeugung gesamt",value:p.erzeugung.toFixed(0),unit:"kWh",icon:_e,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"}),p.verbrauch>0&&e.jsx(Se,{title:"Verbrauch gesamt",value:p.verbrauch.toFixed(0),unit:"kWh",icon:_e,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20"}),p.erzeugung>0&&p.verbrauch>0&&e.jsx(Se,{title:"Netto",value:(p.erzeugung-p.verbrauch).toFixed(0),unit:"kWh",icon:_e,color:p.erzeugung-p.verbrauch>=0?"text-green-500":"text-red-500",bgColor:p.erzeugung-p.verbrauch>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Sonstige Komponenten pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:l.filter(_=>_.sonstiges_erzeugung_kwh>0||_.sonstiges_verbrauch_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(xe,{formatter:(_,v)=>[`${_.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),p.erzeugung>0&&e.jsx(le,{dataKey:"sonstiges_erzeugung_kwh",name:"Erzeugung",fill:"#10b981"}),p.verbrauch>0&&e.jsx(le,{dataKey:"sonstiges_verbrauch_kwh",name:"Verbrauch",fill:"#ef4444"})]})})})]})]}),n&&(n.hat_waermepumpe&&x.strom===0||n.hat_emobilitaet&&d.ladung===0||n.hat_balkonkraftwerk&&b.erzeugung===0||n.hat_sonstiges&&p.erzeugung===0&&p.verbrauch===0)&&e.jsx($,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(nt,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Komponenten ohne Monatsdaten"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Einige Investitionen sind angelegt, haben aber noch keine Monatsdaten. Erfasse monatliche Verbrauchsdaten unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"}),"."]})]})]})})]}):e.jsxs($,{className:"text-center py-12",children:[e.jsx(nt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Komponentendaten vorhanden"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:["Erfasse Daten für Speicher, Wärmepumpe, E-Auto, Balkonkraftwerk oder Sonstiges unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," und füge Monatsdaten hinzu."]})]})}function Ug({data:t,stats:r,strompreis:a,anlageId:s,zeitraumLabel:n}){const[i,o]=m.useState(null);if(m.useEffect(()=>{s&&Qr.getKomponentenZeitreihe(s).then(o).catch(console.error)},[s]),!a)return e.jsxs($,{className:"text-center py-8",children:[e.jsx(lr,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const c=m.useMemo(()=>sl(t,void 0,a),[t,a]),h=m.useMemo(()=>{var d;const x=new Map;return(d=i==null?void 0:i.monatswerte)==null||d.forEach(b=>{const p=`${b.jahr}-${b.monat}`;x.set(p,b.sonderkosten_euro||0)}),x},[i]),g=m.useMemo(()=>{let x=0;return c.map(d=>{const b=h.get(`${d.jahr}-${d.monat}`)||0,p=d.netto_ertrag-b;return x+=p,{...d,sonderkosten:b,netto_nach_sonderkosten:p,kumuliert_ertrag:x}})},[c,h]),l=m.useMemo(()=>{const x=r.gesamtEinspeisung*a.einspeiseverguetung_cent_kwh/100,d=r.gesamtNetzbezug*a.netzbezug_arbeitspreis_cent_kwh/100,b=r.gesamtEigenverbrauch*a.netzbezug_arbeitspreis_cent_kwh/100,p=g.reduce((j,k)=>j+(k.sonderkosten||0),0),y=x+b,f=y-p;return{einspeiseErloes:x,netzbezugKosten:d,eigenverbrauchErsparnis:b,nettoErtrag:y,sonderkosten:p,nettoNachSonderkosten:f}},[r,a,g]),u=()=>{const x=["Monat","Einspeiseerlös (€)","EV-Ersparnis (€)","Netzbezug-Kosten (€)","Netto-Ertrag (€)","Sonderkosten (€)","Netto nach Sonderkosten (€)","Kumulierter Ertrag (€)"],d=g.map(b=>[b.name,b.einspeise_erloes,b.ev_ersparnis,b.netzbezug_kosten,b.netto_ertrag,b.sonderkosten,b.netto_nach_sonderkosten,b.kumuliert_ertrag]);hs(x,d,"finanzen_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","•"," ",r.anzahlMonate," Monate"]}),e.jsxs(he,{variant:"secondary",size:"sm",onClick:u,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Einspeiseerlös",value:l.einspeiseErloes.toFixed(0),unit:"€",subtitle:`${a.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:We,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Einspeisevergütung",berechnung:`${D(r.gesamtEinspeisung,0)} kWh × ${D(a.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${D(l.einspeiseErloes,2)} €`}),e.jsx(Se,{title:"EV-Ersparnis",value:l.eigenverbrauchErsparnis.toFixed(0),unit:"€",subtitle:"vermiedener Netzbezug",icon:lr,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Netzbezugspreis",berechnung:`${D(r.gesamtEigenverbrauch,0)} kWh × ${D(a.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${D(l.eigenverbrauchErsparnis,2)} €`}),e.jsx(Se,{title:"Netzbezug-Kosten",value:l.netzbezugKosten.toFixed(0),unit:"€",subtitle:`${a.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:lr,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug × Netzbezugspreis",berechnung:`${D(r.gesamtNetzbezug,0)} kWh × ${D(a.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${D(l.netzbezugKosten,2)} €`}),e.jsx(Se,{title:"Netto-Ertrag",value:l.nettoNachSonderkosten.toFixed(0),unit:"€",subtitle:l.sonderkosten>0?`nach ${l.sonderkosten.toFixed(0)} € Sonderkosten`:"Gesamt",icon:lr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:l.sonderkosten>0?"Einspeiseerlös + EV-Ersparnis − Sonderkosten":"Einspeiseerlös + EV-Ersparnis",berechnung:l.sonderkosten>0?`${D(l.einspeiseErloes,2)} € + ${D(l.eigenverbrauchErsparnis,2)} € − ${D(l.sonderkosten,2)} €`:`${D(l.einspeiseErloes,2)} € + ${D(l.eigenverbrauchErsparnis,2)} €`,ergebnis:`= ${D(l.nettoNachSonderkosten,2)} €`})]}),l.sonderkosten>0&&e.jsx($,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(en,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:["Sonderkosten im Zeitraum: ",l.sonderkosten.toFixed(2)," €"]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Reparaturen, Wartung und sonstige Kosten werden vom Netto-Ertrag abgezogen."})]})]})}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(lr,{className:"h-5 w-5 text-green-500"}),"Finanzielle Bilanz pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:g,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" €",tick:{fontSize:11}}),e.jsx(xe,{formatter:(x,d)=>[`${x.toFixed(2)} €`,d],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"einspeise_erloes",name:"Einspeiseerlös",fill:Qt.feedin,stackId:"pos"}),e.jsx(le,{dataKey:"ev_ersparnis",name:"EV-Ersparnis",fill:Qt.consumption,stackId:"pos"}),e.jsx(le,{dataKey:"netzbezug_kosten",name:"Netzbezug (negativ)",fill:Qt.grid}),l.sonderkosten>0&&e.jsx(le,{dataKey:"sonderkosten",name:"Sonderkosten",fill:"#f59e0b"})]})})})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-blue-500"}),"Kumulierter Netto-Ertrag"]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:g,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" €",tick:{fontSize:11}}),e.jsx(xe,{formatter:x=>[`${x.toFixed(0)} €`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx($t,{type:"monotone",dataKey:"kumuliert_ertrag",name:"Kumulierter Ertrag",stroke:Qt.feedin,fill:Qt.feedin,fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[l.nettoNachSonderkosten.toFixed(0)," €"]}),l.sonderkosten>0&&e.jsxs("span",{className:"text-gray-400 text-xs",children:["(nach ",l.sonderkosten.toFixed(0)," € Sonderkosten)"]})]})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Netto-Ertrag pro Monat ",l.sonderkosten>0&&"(nach Sonderkosten)"]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:g,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" €",tick:{fontSize:11}}),e.jsx(xe,{formatter:(x,d)=>[`${x.toFixed(2)} €`,d],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(le,{dataKey:"netto_nach_sonderkosten",name:"Netto-Ertrag",fill:Qt.feedin,opacity:.7}),e.jsx(qe,{type:"monotone",dataKey:"netto_nach_sonderkosten",name:"Trend",stroke:Qt.solar,strokeWidth:2,dot:!1})]})})})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Durchschnittswerte"}),e.jsxs("div",{className:`grid grid-cols-2 gap-4 text-sm ${l.sonderkosten>0?"md:grid-cols-5":"md:grid-cols-4"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Einspeiseerlös/Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(l.einspeiseErloes/r.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø EV-Ersparnis/Monat"}),e.jsxs("p",{className:"font-medium text-purple-600",children:[(l.eigenverbrauchErsparnis/r.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netzbezug-Kosten/Monat"}),e.jsxs("p",{className:"font-medium text-red-600",children:[(l.netzbezugKosten/r.anzahlMonate).toFixed(0)," €"]})]}),l.sonderkosten>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Sonderkosten/Monat"}),e.jsxs("p",{className:"font-medium text-amber-600",children:[(l.sonderkosten/r.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netto-Ertrag/Monat"}),e.jsxs("p",{className:"font-medium text-blue-600",children:[(l.nettoNachSonderkosten/r.anzahlMonate).toFixed(0)," €"]})]})]})]})]})}const ws=.38;function Yg({data:t,stats:r,zeitraumLabel:a}){const s=m.useMemo(()=>sl(t),[t]),n=m.useMemo(()=>{let l=0;return s.map(u=>(l+=u.co2_einsparung,{...u,kumuliert_co2:l}))},[s]),i=r.gesamtErzeugung*ws,o=i/12.5,c=i/.12,h=i/230,g=()=>{const l=["Monat","CO2-Einsparung (kg)","Kumuliert (kg)","Kumuliert (t)"],u=n.map(x=>[x.name,x.co2_einsparung,x.kumuliert_co2,x.kumuliert_co2/1e3]);hs(l,u,"co2_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","•"," ",r.anzahlMonate," Monate"]}),e.jsxs(he,{variant:"secondary",size:"sm",onClick:g,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"CO2 eingespart",value:(i/1e3).toFixed(2),unit:"t",subtitle:`${r.anzahlMonate} Monate`,icon:mt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung × CO2-Faktor",berechnung:`${D(r.gesamtErzeugung,0)} kWh × ${ws*1e3} g/kWh`,ergebnis:`= ${D(i,0)} kg = ${D(i/1e3,2)} t`}),e.jsx(Se,{title:"Bäume äquivalent",value:o.toFixed(0),unit:"Bäume/Jahr",subtitle:"Bindungsleistung",icon:mt,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung ÷ 12,5 kg/Baum/Jahr",berechnung:`${D(i,0)} kg ÷ 12,5 kg/Baum`,ergebnis:`= ${D(o,0)} Bäume`}),e.jsx(Se,{title:"Auto-km vermieden",value:(c/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:mt,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung ÷ 120 g/km",berechnung:`${D(i*1e3,0)} g ÷ 120 g/km`,ergebnis:`= ${D(c,0)} km`}),e.jsx(Se,{title:"Kurzstreckenflüge",value:h.toFixed(1),unit:"Flüge",subtitle:"à 1000 km",icon:mt,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"CO2-Einsparung ÷ 230 kg/Flug",berechnung:`${D(i,0)} kg ÷ 230 kg/Flug`,ergebnis:`= ${D(h,1)} Flüge vermieden`})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(mt,{className:"h-5 w-5 text-green-500"}),"CO2-Einsparung pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:s,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kg",tick:{fontSize:11}}),e.jsx(xe,{formatter:l=>[`${l.toFixed(0)} kg CO2`,"Einsparung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(le,{dataKey:"co2_einsparung",name:"CO2 eingespart",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kumulierte CO2-Einsparung"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{tickFormatter:l=>`${(l/1e3).toFixed(1)}`,unit:" t",tick:{fontSize:11}}),e.jsx(xe,{formatter:l=>[`${(l/1e3).toFixed(2)} t CO2`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx($t,{type:"monotone",dataKey:"kumuliert_co2",name:"Kumulierte Einsparung",stroke:"#10b981",fill:"#10b981",fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[(i/1e3).toFixed(2)," t CO2"]})]})]}),e.jsxs($,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",e.jsxs("strong",{children:[ws*1e3," g CO2/kWh"]})," berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate).toFixed(0)," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro kWh"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(ws*1e3).toFixed(0)," g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Jahr"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12/1e3).toFixed(2)," t"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Hochgerechnet 20 Jahre"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12*20/1e3).toFixed(1)," t"]})]})]})]})]})}function Xg({anlageId:t,strompreis:r,selectedYear:a="all"}){var y,f,j;const{investitionen:s,loading:n}=ds(t),[i,o]=m.useState(null),[c,h]=m.useState(!0),[g,l]=m.useState(new Set);m.useEffect(()=>{(async()=>{try{h(!0);const w=await et.getROIDashboard(t,r==null?void 0:r.netzbezug_arbeitspreis_cent_kwh,r==null?void 0:r.einspeiseverguetung_cent_kwh,void 0,a);o(w)}catch(w){console.error("ROI-Dashboard Fehler:",w)}finally{h(!1)}})()},[t,r,a]);const u=m.useMemo(()=>{const k={};return s.forEach(w=>{k[w.typ]||(k[w.typ]=[]),k[w.typ].push(w)}),k},[s]),x=m.useMemo(()=>Object.entries(u).map(([k,w])=>({typ:k,label:Fa[k]||k,kosten:w.reduce((_,v)=>_+(v.anschaffungskosten_gesamt||0),0),color:Tr[k]||"#6b7280"})).filter(k=>k.kosten>0).sort((k,w)=>w.kosten-k.kosten),[u]),d=m.useMemo(()=>{if(!i||!i.gesamt_jahres_einsparung)return[];const k=i.gesamt_relevante_kosten,w=i.gesamt_jahres_einsparung,_=[];for(let v=0;v<=25;v++){const S=v*w;_.push({jahr:v,investition:k,ersparnis:S,bilanz:S-k})}return _},[i]);if(n||c)return e.jsx(Me,{text:"Lade Investitionsdaten..."});if(s.length===0)return e.jsxs($,{className:"text-center py-8",children:[e.jsx(Yr,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const b=(y=i==null?void 0:i.berechnungen.find(k=>k.investition_typ==="pv-module"))==null?void 0:y.detail_berechnung,p=b==null?void 0:b.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"Gesamtinvestition",value:((i==null?void 0:i.gesamt_relevante_kosten)||0).toFixed(0),unit:"€",subtitle:`${s.length} Komponenten`,icon:eg,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten − Alternativkosten",berechnung:i?`${D(i.gesamt_investition,0)} € − ${D(i.gesamt_investition-i.gesamt_relevante_kosten,0)} € Alternativ`:void 0,ergebnis:i?`= ${D(i.gesamt_relevante_kosten,0)} € relevante Kosten`:void 0}),e.jsx(Se,{title:"Jahresersparnis",value:((i==null?void 0:i.gesamt_jahres_einsparung)||0).toFixed(0),unit:"€/Jahr",icon:We,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + Eigenverbrauch-Ersparnis",berechnung:b?`${D(b.einspeise_erloes_euro,2)} € + ${D(b.ev_ersparnis_euro,2)} €`:"Σ aller Investitions-Einsparungen",ergebnis:p||(i?`= ${D(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0)}),e.jsx(Se,{title:"ROI",value:((f=i==null?void 0:i.gesamt_roi_prozent)==null?void 0:f.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:We,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis ÷ Relevante Kosten × 100",berechnung:i&&i.gesamt_relevante_kosten>0?`${D(i.gesamt_jahres_einsparung,0)} € ÷ ${D(i.gesamt_relevante_kosten,0)} € × 100`:void 0,ergebnis:i!=null&&i.gesamt_roi_prozent?`= ${i.gesamt_roi_prozent.toFixed(1)}% ROI p.a.`:void 0}),e.jsx(Se,{title:"Amortisation",value:((j=i==null?void 0:i.gesamt_amortisation_jahre)==null?void 0:j.toFixed(1))||"---",unit:"Jahre",icon:Mt,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten ÷ Jahresersparnis",berechnung:i&&i.gesamt_jahres_einsparung>0?`${D(i.gesamt_relevante_kosten,0)} € ÷ ${D(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:i!=null&&i.gesamt_amortisation_jahre?`= ${i.gesamt_amortisation_jahre.toFixed(1)} Jahre bis zur Kostendeckung`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:x,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:k,percent:w})=>`${k}: ${(w*100).toFixed(0)}%`,labelLine:!1,children:x.map((k,w)=>e.jsx(Ge,{fill:k.color},`cell-${w}`))}),e.jsx(xe,{formatter:k=>[`${k.toFixed(0)} €`,""]})]})})})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:x,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{type:"number",unit:" €",tick:{fontSize:11}}),e.jsx(be,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(xe,{formatter:k=>[`${k.toFixed(0)} €`,""]}),e.jsx(le,{dataKey:"kosten",name:"Kosten",children:x.map((k,w)=>e.jsx(Ge,{fill:k.color},`cell-${w}`))})]})})})]})]}),d.length>0&&e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:d,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(be,{unit:" €",tick:{fontSize:11}}),e.jsx(xe,{formatter:k=>[`${k.toFixed(0)} €`,""]}),e.jsx(Ce,{}),e.jsx($t,{type:"monotone",dataKey:"investition",name:"Investition",stroke:Qt.grid,fill:Qt.grid,fillOpacity:.3}),e.jsx($t,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:Qt.feedin,fill:Qt.feedin,fillOpacity:.3})]})})}),(i==null?void 0:i.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",i.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(i==null?void 0:i.berechnungen)&&i.berechnungen.length>0&&(()=>{const k=i.berechnungen.filter(v=>{var S;return v.investition_typ==="pv-module"&&typeof((S=v.detail_berechnung)==null?void 0:S.hinweis)=="string"&&v.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),w=i.berechnungen.filter(v=>{var S;return v.investition_typ==="wechselrichter"&&typeof((S=v.detail_berechnung)==null?void 0:S.hinweis)=="string"&&v.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),_=k.length>0||w.length>0;return e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),_&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollständig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[k.length>0&&e.jsxs("li",{children:[k.length," PV-Modul",k.length>1?"e":""," ohne Wechselrichter-Zuordnung → Bitte unter Einstellungen → Investitionen zuordnen"]}),w.length>0&&e.jsxs("li",{children:[w.length," Wechselrichter ohne PV-Module → Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.berechnungen.map(v=>{var E,L;const S=v.anschaffungskosten_alternativ>0,V=S?"Anschaffung − Alternativkosten":"Anschaffungskosten (keine Alternative)",C=S?`${D(v.anschaffungskosten,0)} € − ${D(v.anschaffungskosten_alternativ,0)} €`:`${D(v.anschaffungskosten,0)} €`,I=`= ${D(v.relevante_kosten,0)} € Mehrkosten`,M=(v.detail_berechnung||{}).hinweis,W=v.investition_typ==="pv-system"&&v.komponenten&&v.komponenten.length>0,N=g.has(v.investition_id),z=v.investition_typ==="pv-module"&&typeof M=="string"&&M.includes("ohne Wechselrichter"),A=v.investition_typ==="wechselrichter"&&typeof M=="string"&&M.includes("ohne zugeordnete PV-Module"),P=()=>{l(R=>{const X=new Set(R);return X.has(v.investition_id)?X.delete(v.investition_id):X.add(v.investition_id),X})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${W?"cursor-pointer":""}`,onClick:W?P:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[W&&(N?e.jsx(zr,{className:"h-4 w-4 text-gray-400"}):e.jsx(ar,{className:"h-4 w-4 text-gray-400"})),(z||A)&&e.jsx("span",{title:z?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(ft,{className:"h-4 w-4 text-amber-500"})}),v.investition_bezeichnung,W&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",v.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Tr[v.investition_typ]||"#6b7280"}20`,color:Tr[v.investition_typ]||"#6b7280"},children:Fa[v.investition_typ]||v.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(Cr,{formel:V,berechnung:C,ergebnis:I,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[v.relevante_kosten.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(Cr,{formel:`Jahresersparnis ${Fa[v.investition_typ]||v.investition_typ}`,berechnung:M||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${D(v.jahres_einsparung,0)} €/Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[v.jahres_einsparung.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(Cr,{formel:"Ersparnis ÷ Mehrkosten × 100",berechnung:`${D(v.jahres_einsparung,0)} € ÷ ${D(v.relevante_kosten,0)} € × 100`,ergebnis:v.roi_prozent?`= ${v.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((E=v.roi_prozent)==null?void 0:E.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(Cr,{formel:"Mehrkosten ÷ Ersparnis",berechnung:`${D(v.relevante_kosten,0)} € ÷ ${D(v.jahres_einsparung,0)} €/Jahr`,ergebnis:v.amortisation_jahre?`= ${v.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((L=v.amortisation_jahre)==null?void 0:L.toFixed(1))||"---"," J."]})})})]},v.investition_id),W&&N&&v.komponenten.map(R=>{var X,O;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:Tr[R.typ]||"#6b7280"}}),R.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Tr[R.typ]||"#6b7280"}15`,color:Tr[R.typ]||"#6b7280"},children:Fa[R.typ]||R.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[R.relevante_kosten.toFixed(0)," €"]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:R.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[R.einsparung.toFixed(0)," €"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((X=R.detail)==null?void 0:X.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[R.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((O=R.detail)==null?void 0:O.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:R.detail.hinweis})]})]},`komp-${R.investition_id}`)})]})})})]})})]})})(),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(u).map(([k,w])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Tr[k]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Fa[k]||k}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",w.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:w.map(_=>{var v;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:_.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((v=_.anschaffungskosten_gesamt)==null?void 0:v.toFixed(0))||"0"," €"]})]},_.id)})})]},k))})]})]})}const aa=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function Qg({anlageId:t,selectedYear:r,verfuegbareJahre:a,zeitraumLabel:s}){var p,y;const[n,i]=m.useState(null),[o,c]=m.useState(!0),[h,g]=m.useState(null),[l,u]=m.useState(new Map);m.useEffect(()=>{(async()=>{var j,k;c(!0),g(null);try{if(r==="all"){const w=new Map;for(const _ of a)try{const v=await Qr.getPVStrings(t,_);w.set(_,v)}catch(v){console.error(`Fehler beim Laden Jahr ${_}:`,v)}if(u(w),w.size>0){const _=w.get(a[0]);if(_){const v=_.strings.map(F=>{let M=0,W=0;w.forEach(A=>{const P=A.strings.find(E=>E.investition_id===F.investition_id);P&&(M+=P.prognose_jahr_kwh,W+=P.ist_jahr_kwh)});const N=M>0?(W-M)/M*100:null,z=M>0?W/M:null;return{...F,prognose_jahr_kwh:M,ist_jahr_kwh:W,abweichung_jahr_prozent:N,abweichung_jahr_kwh:W-M,performance_ratio_jahr:z,spezifischer_ertrag_kwh_kwp:F.leistung_kwp>0?W/F.leistung_kwp:null,monatswerte:F.monatswerte.map((A,P)=>{let E=0,L=0;return w.forEach(R=>{const X=R.strings.find(O=>O.investition_id===F.investition_id);X&&X.monatswerte[P]&&(E+=X.monatswerte[P].prognose_kwh,L+=X.monatswerte[P].ist_kwh)}),{...A,prognose_kwh:E,ist_kwh:L}})}}),S=v.reduce((F,M)=>F+M.prognose_jahr_kwh,0),V=v.reduce((F,M)=>F+M.ist_jahr_kwh,0),C=[...v].filter(F=>F.performance_ratio_jahr!==null).sort((F,M)=>(M.performance_ratio_jahr||0)-(F.performance_ratio_jahr||0)),I={..._,strings:v,prognose_gesamt_kwh:S,ist_gesamt_kwh:V,abweichung_gesamt_kwh:V-S,abweichung_gesamt_prozent:S>0?(V-S)/S*100:null,bester_string:((j=C[0])==null?void 0:j.bezeichnung)||null,schlechtester_string:((k=C[C.length-1])==null?void 0:k.bezeichnung)||null};i(I)}}}else{const w=await Qr.getPVStrings(t,r);i(w)}}catch(w){g("Fehler beim Laden der String-Daten"),console.error(w)}finally{c(!1)}})()},[t,r,a]);const x=m.useMemo(()=>r!=="all"||l.size===0?[]:a.map(f=>{const j=l.get(f);if(!j)return null;const k={name:f.toString(),jahr:f};return j.strings.forEach(w=>{k[w.bezeichnung]=w.performance_ratio_jahr?Math.round(w.performance_ratio_jahr*100):0}),k.Gesamt=j.abweichung_gesamt_prozent?100+j.abweichung_gesamt_prozent:100,k}).filter(Boolean).reverse(),[r,l,a]),d=()=>{if(!n)return;const f=["String","kWp","Ausrichtung","SOLL (kWh)","IST (kWh)","Abweichung (%)","Performance Ratio","kWh/kWp"],j=n.strings.map(w=>[w.bezeichnung,w.leistung_kwp,w.ausrichtung||"-",w.prognose_jahr_kwh,w.ist_jahr_kwh,w.abweichung_jahr_prozent??"-",w.performance_ratio_jahr?(w.performance_ratio_jahr*100).toFixed(1)+"%":"-",w.spezifischer_ertrag_kwh_kwp??"-"]),k=r==="all"?"alle_jahre":r.toString();hs(f,j,`pv_strings_${k}.csv`)};if(o)return e.jsx(Me,{text:"Lade PV-String Daten..."});if(h)return e.jsx(ae,{type:"error",children:h});if(!n||n.strings.length===0)return e.jsxs($,{className:"text-center py-8",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen → Investitionen anlegen."})]});if(!n.hat_prognose)return e.jsx(ae,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen → PVGIS eine Prognose abrufen, um den SOLL-IST Vergleich zu nutzen."})]})});const b=[...n.strings].sort((f,j)=>(j.performance_ratio_jahr||0)-(f.performance_ratio_jahr||0));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s})," ","•"," ",n.strings.length," Strings • ",n.anlagen_leistung_kwp.toFixed(1)," kWp"]}),e.jsxs(he,{variant:"secondary",size:"sm",onClick:d,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Se,{title:"SOLL (Prognose)",value:(n.prognose_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:"PVGIS Jahresprognose",icon:oe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ PVGIS-Prognose aller Strings",berechnung:n.strings.map(f=>`${f.bezeichnung}: ${f.prognose_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${D(n.prognose_gesamt_kwh,0)} kWh`}),e.jsx(Se,{title:"IST (Erzeugt)",value:(n.ist_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:s,icon:We,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Σ Erzeugung aller Strings",berechnung:n.strings.map(f=>`${f.bezeichnung}: ${f.ist_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${D(n.ist_gesamt_kwh,0)} kWh`}),e.jsx(Se,{title:"Abweichung",value:`${(n.abweichung_gesamt_prozent||0)>=0?"+":""}${(n.abweichung_gesamt_prozent||0).toFixed(1)}`,unit:"%",subtitle:`${n.abweichung_gesamt_kwh>=0?"+":""}${n.abweichung_gesamt_kwh.toFixed(0)} kWh`,icon:(n.abweichung_gesamt_prozent||0)>=0?We:qt,color:(n.abweichung_gesamt_prozent||0)>=0?"text-green-500":"text-red-500",bgColor:(n.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20",formel:"(IST - SOLL) ÷ SOLL × 100",berechnung:`(${D(n.ist_gesamt_kwh,0)} - ${D(n.prognose_gesamt_kwh,0)}) ÷ ${D(n.prognose_gesamt_kwh,0)} × 100`,ergebnis:`= ${D(n.abweichung_gesamt_prozent||0,1)} %`}),e.jsx(Se,{title:"Spez. Ertrag Ø",value:(n.ist_gesamt_kwh/n.anlagen_leistung_kwp).toFixed(0),unit:"kWh/kWp",subtitle:s,icon:Kl,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"IST-Erzeugung ÷ Anlagenleistung",berechnung:`${D(n.ist_gesamt_kwh,0)} kWh ÷ ${D(n.anlagen_leistung_kwp,1)} kWp`,ergebnis:`= ${D(n.ist_gesamt_kwh/n.anlagen_leistung_kwp,0)} kWh/kWp`})]}),n.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[n.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-lg",children:[e.jsx(We,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Beste Performance"}),e.jsx("p",{className:"font-medium text-green-700 dark:text-green-300",children:n.bester_string})]})]}),n.schlechtester_string&&n.schlechtester_string!==n.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(qt,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Schwächste Performance"}),e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300",children:n.schlechtester_string})]})]})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Kl,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro String"]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:n.strings.map((f,j)=>({name:f.bezeichnung.length>12?f.bezeichnung.slice(0,12)+"...":f.bezeichnung,SOLL:f.prognose_jahr_kwh,IST:f.ist_jahr_kwh,color:aa[j%aa.length]})),layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{type:"number",unit:" kWh"}),e.jsx(be,{type:"category",dataKey:"name",width:100,tick:{fontSize:11}}),e.jsx(xe,{formatter:f=>[`${f.toFixed(0)} kWh`,""]}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(le,{dataKey:"IST",fill:"#f59e0b",name:"IST (Erzeugt)"})]})})})]}),e.jsxs($,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Monatsverlauf SOLL vs IST ",r==="all"?"(Summe aller Jahre)":""]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:((p=n.strings[0])==null?void 0:p.monatswerte.map((f,j)=>{const k={name:f.monat_name,SOLL:n.strings.reduce((w,_)=>{var v;return w+(((v=_.monatswerte[j])==null?void 0:v.prognose_kwh)||0)},0),IST:n.strings.reduce((w,_)=>{var v;return w+(((v=_.monatswerte[j])==null?void 0:v.ist_kwh)||0)},0)};return k.Abweichung=k.IST-k.SOLL,k}))||[],children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:10}}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(xe,{formatter:f=>[`${f.toFixed(0)} kWh`,""]}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(le,{dataKey:"IST",fill:"#f59e0b",name:"IST"}),e.jsx(qe,{type:"monotone",dataKey:"Abweichung",stroke:"#10b981",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]}),r==="all"&&x.length>1&&e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Entwicklung über Jahre"}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:x,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name"}),e.jsx(be,{unit:"%",domain:[80,120],ticks:[80,90,100,110,120]}),e.jsx(xe,{formatter:f=>[`${f}%`,""]}),e.jsx(Ce,{}),n.strings.map((f,j)=>e.jsx(qe,{type:"monotone",dataKey:f.bezeichnung,stroke:aa[j%aa.length],strokeWidth:2,dot:{r:4}},f.investition_id)),e.jsx(qe,{type:"monotone",dataKey:"Gesamt",stroke:"#6b7280",strokeWidth:3,strokeDasharray:"5 5",dot:{r:4}})]})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"100% = Prognose erreicht • Werte über 100% = Überperformance"})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abweichung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:b.map(f=>{var j,k;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:aa[n.strings.findIndex(w=>w.investition_id===f.investition_id)%aa.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:f.bezeichnung})]}),f.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:["→ ",f.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right",children:f.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3",children:[f.ausrichtung||"-",f.neigung_grad&&` / ${f.neigung_grad}°`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600",children:[f.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right text-amber-600 font-medium",children:[f.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right font-medium ${(f.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(f.abweichung_jahr_prozent||0)>=0?"+":"",((j=f.abweichung_jahr_prozent)==null?void 0:j.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right text-purple-600",children:((k=f.spezifischer_ertrag_kwh_kwp)==null?void 0:k.toFixed(0))||"-"})]},f.investition_id)})}),e.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:"Gesamt"}),e.jsx("td",{className:"px-3 py-2 text-right",children:n.anlagen_leistung_kwp.toFixed(1)}),e.jsx("td",{className:"px-3 py-2",children:"-"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-600",children:[n.prognose_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-2 text-right text-amber-600",children:[n.ist_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-2 text-right ${(n.abweichung_gesamt_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(n.abweichung_gesamt_prozent||0)>=0?"+":"",((y=n.abweichung_gesamt_prozent)==null?void 0:y.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-2 text-right text-purple-600",children:(n.ist_gesamt_kwh/n.anlagen_leistung_kwp).toFixed(0)})]})})]})})]})]})}function e0(t,r){if(t==="all"){if(r.length===0)return"Alle Jahre";if(r.length===1)return`${r[0]}`;const a=Math.min(...r),s=Math.max(...r);return`${a}–${s}`}return`${t}`}function Yl(){var w;const t=pr(),[r,a]=m.useState("energie"),[s,n]=m.useState("all"),{anlagen:i,loading:o}=it(),[c,h]=m.useState(null),g=c??((w=i[0])==null?void 0:w.id),l=i.find(_=>_.id===g),{daten:u,loading:x}=yg(g),{strompreis:d}=Ic(g??null),b=m.useMemo(()=>[...new Set(u.map(v=>v.jahr))].sort((v,S)=>S-v),[u]),p=m.useMemo(()=>s==="all"?u:u.filter(_=>_.jahr===s),[u,s]),y=jg(p);if(o||x)return e.jsx(Me,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(u.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs($,{className:"text-center py-12",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(he,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(gt,{className:"h-4 w-4 ml-2"})]})]})]});const j=[{key:"energie",label:"Energie"},{key:"pv",label:"PV-Anlage"},{key:"komponenten",label:"Komponenten"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"},{key:"investitionen",label:"Investitionen"}],k=e0(s,b);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:s,onChange:_=>n(_.target.value==="all"?"all":Number(_.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),b.map(_=>e.jsx("option",{value:_,children:_},_))]})]}),i.length>1&&e.jsx("select",{value:g??"",onChange:_=>h(Number(_.target.value)),className:"input w-auto",children:i.map(_=>e.jsx("option",{value:_.id,children:_.anlagenname},_.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:j.map(_=>e.jsx("button",{onClick:()=>a(_.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${r===_.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:_.label},_.key))})})]}),e.jsxs("div",{children:[r==="energie"&&e.jsx(qg,{data:p,stats:y,anlage:l,strompreis:d,zeitraumLabel:k}),r==="pv"&&g&&e.jsx(Qg,{anlageId:g,selectedYear:s,verfuegbareJahre:b,zeitraumLabel:k}),r==="komponenten"&&e.jsx(Jg,{anlage:l,strompreis:d,selectedYear:s,zeitraumLabel:k}),r==="finanzen"&&e.jsx(Ug,{data:p,stats:y,strompreis:d,anlageId:g,zeitraumLabel:k}),r==="co2"&&e.jsx(Yg,{data:p,stats:y,zeitraumLabel:k}),r==="investitionen"&&g&&e.jsx(Xg,{anlageId:g,strompreis:d,selectedYear:s,zeitraumLabel:k})]})]})}const t0={"e-auto":Ve,waermepumpe:Qe,speicher:Fe,wallbox:Kt,wechselrichter:Vr,"pv-module":oe,balkonkraftwerk:zc,sonstiges:Vr},Hn={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},Xl={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function r0(){var _;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(!1),[h,g]=m.useState(null),[l,u]=m.useState(30),[x,d]=m.useState(8.2),[b,p]=m.useState(1.85),y=a??((_=t[0])==null?void 0:_.id),{strompreis:f}=Ic(y??null);m.useEffect(()=>{f&&(u(f.netzbezug_arbeitspreis_cent_kwh),d(f.einspeiseverguetung_cent_kwh))},[f]),m.useEffect(()=>{if(!y)return;(async()=>{try{c(!0),g(null);const S=await et.getROIDashboard(y,l,x,b);i(S)}catch(S){g(S instanceof Error?S.message:"Fehler beim Laden der ROI-Daten")}finally{c(!1)}})()},[y,l,x,b]);const j=m.useMemo(()=>{if(!n||n.gesamt_relevante_kosten<=0)return[];const v=[];let S=0;const V=Math.min(Math.ceil((n.gesamt_amortisation_jahre??20)*1.5),30);for(let C=0;C<=V;C++)v.push({jahr:C,kumulierte_einsparung:Math.round(S),investition:n.gesamt_relevante_kosten}),S+=n.gesamt_jahres_einsparung;return v},[n]),k=m.useMemo(()=>{if(!n)return[];const v={};return n.berechnungen.forEach(S=>{const V=S.investition_typ;v[V]=(v[V]||0)+S.jahres_einsparung}),Object.entries(v).map(([S,V])=>({name:Xl[S]||S,value:Math.round(V),color:Hn[S]||"#6b7280"})).filter(S=>S.value>0)},[n]),w=m.useMemo(()=>n?n.berechnungen.map(v=>({name:v.investition_bezeichnung.length>15?v.investition_bezeichnung.substring(0,15)+"...":v.investition_bezeichnung,fullName:v.investition_bezeichnung,kosten:v.relevante_kosten,einsparung:v.jahres_einsparung,amortisation:v.amortisation_jahre??0,typ:v.investition_typ,color:Hn[v.investition_typ]||"#6b7280"})):[],[n]);return r?e.jsx(Me,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:y??"",onChange:v=>s(Number(v.target.value)),className:"input w-auto",children:t.map(v=>e.jsx("option",{value:v.id,children:v.anlagenname},v.id))})})]}),h&&e.jsx(ae,{type:"error",onClose:()=>g(null),children:h}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vr,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:l,onChange:v=>u(Number(v.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergütung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:x,onChange:v=>d(Number(v.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:b,onChange:v=>p(Number(v.target.value)),className:"input"})]})]})]}),o&&e.jsx(Me,{text:"Berechne ROI..."}),!o&&n&&n.berechnungen.length===0&&e.jsx(ka,{icon:Yr,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!o&&n&&n.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ns,{icon:Yr,title:"Gesamtinvestition",value:`${n.gesamt_investition.toLocaleString("de-DE")} €`,subtitle:`Relevant: ${n.gesamt_relevante_kosten.toLocaleString("de-DE")} €`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt − Alternativkosten",ergebnis:`= ${D(n.gesamt_relevante_kosten,0)} €`}),e.jsx(Ns,{icon:We,title:"Jährliche Einsparung",value:`${n.gesamt_jahres_einsparung.toLocaleString("de-DE")} €`,subtitle:n.gesamt_roi_prozent?`ROI: ${n.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einsparungen aller Investitionen",berechnung:n.gesamt_relevante_kosten>0?"ROI = Einsparung ÷ Kosten × 100":void 0,ergebnis:n.gesamt_roi_prozent?`= ${n.gesamt_roi_prozent}% ROI`:void 0}),e.jsx(Ns,{icon:_c,title:"Amortisation",value:n.gesamt_amortisation_jahre?`${n.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten ÷ Jährliche Einsparung",berechnung:n.gesamt_jahres_einsparung>0?`${D(n.gesamt_relevante_kosten,0)} € ÷ ${D(n.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:n.gesamt_amortisation_jahre?`= ${n.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx(Ns,{icon:mt,title:"CO2-Einsparung",value:`${n.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${D(n.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:j,children:[e.jsx(ke,{strokeDasharray:"3 3",opacity:.3}),e.jsx(ve,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(be,{tickFormatter:v=>`${(v/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(xe,{formatter:(v,S)=>[`${v.toLocaleString("de-DE")} €`,S==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:v=>`Jahr ${v}`}),e.jsx(Ce,{formatter:v=>v==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(qe,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(qe,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),n.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",n.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:k,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:v,percent:S})=>`${v}: ${(S*100).toFixed(0)}%`,labelLine:!0,children:k.map((v,S)=>e.jsx(Ge,{fill:v.color},`cell-${S}`))}),e.jsx(xe,{formatter:v=>[`${v.toLocaleString("de-DE")} €/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:w,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",opacity:.3}),e.jsx(ve,{type:"number",tickFormatter:v=>`${v.toLocaleString("de-DE")}`}),e.jsx(be,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(xe,{formatter:(v,S)=>[S==="kosten"?`${v.toLocaleString("de-DE")} €`:`${v.toLocaleString("de-DE")} €/Jahr`,S==="kosten"?"Relevante Kosten":"Jährliche Einsparung"]}),e.jsx(Ce,{formatter:v=>v==="kosten"?"Relevante Kosten (€)":"Jährliche Einsparung (€)"}),e.jsx(le,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(le,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:n.berechnungen.map(v=>{const S=t0[v.investition_typ]||Vr;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4",style:{color:Hn[v.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:v.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Xl[v.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[v.relevante_kosten.toLocaleString("de-DE")," €"]}),v.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",v.anschaffungskosten.toLocaleString("de-DE")," € gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[v.jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:v.roi_prozent?e.jsxs("span",{className:v.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[v.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:v.amortisation_jahre?e.jsxs("span",{className:v.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[v.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:v.co2_einsparung_kg?`${v.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},v.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[n.gesamt_relevante_kosten.toLocaleString("de-DE")," €"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[n.gesamt_jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:n.gesamt_roi_prozent?`${n.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:n.gesamt_amortisation_jahre?`${n.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[n.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(ae,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatsächlichen Einsparungen können je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function Ns({icon:t,title:r,value:a,subtitle:s,color:n,bgColor:i,formel:o,berechnung:c,ergebnis:h}){const g=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a});return e.jsx($,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:`h-6 w-6 ${n}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),o?e.jsx(Cr,{formel:o,berechnung:c,ergebnis:h,children:g}):g,s&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]})]})})}const a0=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function s0(){var F;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState(new Date().getFullYear()),[o,c]=m.useState(null),[h,g]=m.useState([]),[l,u]=m.useState(!1),[x,d]=m.useState(!1),[b,p]=m.useState(null);m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{a&&y()},[a,n]);const y=async()=>{if(a){u(!0),p(null);try{const M=await Pr.listAggregiert(a);g(M);const W=await Xt.getAktivePrognose(a);if(W)c({jahresertrag_kwh:W.jahresertrag_kwh,monatswerte:W.monatswerte,isLive:!1});else try{const N=await Xt.getPrognose(a);c({jahresertrag_kwh:N.jahresertrag_kwh,monatswerte:N.monatsdaten.map(z=>({monat:z.monat,e_m:z.e_m})),isLive:!0,module:N.module})}catch(N){c(null),N instanceof Error&&N.message.includes("PV-Module")&&p("Keine PV-Module für diese Anlage definiert. Bitte unter Einstellungen → Investitionen anlegen.")}}catch(M){p(M instanceof Error?M.message:"Fehler beim Laden")}finally{u(!1)}}},f=async()=>{if(a){d(!0);try{await Xt.speicherePrognose(a);const M=o==null?void 0:o.module;await y(),M&&M.length>0&&c(W=>W?{...W,module:M}:null)}catch(M){p(M instanceof Error?M.message:"Fehler beim Speichern")}finally{d(!1)}}},j=[...new Set(h.map(M=>M.jahr))].sort((M,W)=>W-M);m.useEffect(()=>{j.length>0&&!j.includes(n)&&i(j[0])},[j,n]);const k=[];if(o!=null&&o.monatswerte)for(let M=1;M<=12;M++){const W=((F=o.monatswerte.find(P=>P.monat===M))==null?void 0:F.e_m)||0,N=h.filter(P=>P.jahr===n&&P.monat===M).reduce((P,E)=>P+(E.pv_erzeugung_kwh||0),0),z=N-W,A=W>0?z/W*100:0;k.push({monat:M,monatName:a0[M],prognose:W,ist:N,abweichung:z,abweichungProzent:A})}const w=k.reduce((M,W)=>M+W.prognose,0),_=k.reduce((M,W)=>M+W.ist,0),v=_-w,S=w>0?v/w*100:0,C=12-k.filter(M=>M.ist===0).length,I=C>0?_/C*12:0;return r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ui,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:M=>s(parseInt(M.target.value)),options:t.map(M=>({value:M.id.toString(),label:M.anlagenname}))}),j.length>0&&e.jsx(Ht,{value:n.toString(),onChange:M=>i(parseInt(M.target.value)),options:j.map(M=>({value:M.toString(),label:M.toString()}))}),e.jsx("button",{onClick:y,disabled:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(gr,{className:`h-5 w-5 ${l?"animate-spin":""}`})})]})]}),b&&e.jsx(ae,{type:"error",children:b}),l?e.jsx(Me,{text:"Lade Vergleichsdaten..."}):o?h.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(nt,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten für diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen → Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[o.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(he,{size:"sm",onClick:f,disabled:x,children:[e.jsx(Ct,{className:"h-4 w-4 mr-1"}),x?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs($,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[w.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",n]})]}),e.jsxs($,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[_.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[C," von 12 Monaten"]})]}),e.jsxs($,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[v>=0?e.jsx(We,{className:"h-6 w-6 text-green-500"}):e.jsx(qt,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${v>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[v>=0?"+":"",v.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${v>=0?"text-green-500":"text-red-500"}`,children:[v>=0?"+":"",S.toFixed(1),"%"]})]}),C<12&&C>0&&e.jsxs($,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[I.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((I/w-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",n]}),e.jsx("div",{className:"h-80",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:k,children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"monatName"}),e.jsx(be,{yAxisId:"left",tickFormatter:M=>`${M} kWh`}),e.jsx(be,{yAxisId:"right",orientation:"right",tickFormatter:M=>`${M}%`}),e.jsx(xe,{formatter:(M,W)=>W==="Abweichung %"?`${M.toFixed(1)}%`:`${M.toFixed(0)} kWh`}),e.jsx(Ce,{}),e.jsx(bh,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(le,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(le,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),e.jsxs($,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:k.map(M=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:M.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[M.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:M.ist>0?e.jsxs("span",{className:"text-green-600",children:[M.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${M.abweichung>=0?"text-green-600":"text-red-600"}`,children:M.ist>0?`${M.abweichung>=0?"+":""}${M.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${M.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:M.ist>0?`${M.abweichungProzent>=0?"+":""}${M.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:M.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):M.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(We,{className:"h-4 w-4"}),"Übertroffen"]}):M.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):M.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(qt,{className:"h-4 w-4"}),"Unter Plan"]})})]},M.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[w.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[_.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${v>=0?"text-green-600":"text-red-600"}`,children:[v>=0?"+":"",v.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${S>=0?"text-green-600":"text-red-600"}`,children:[S>=0?"+":"",S.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Übertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prüfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjährigen Mittelwerten. Einzelne Monate können stark abweichen."})]})]}):e.jsx($,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfügbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen → Investitionen".'})]})})]})}const Cn={async getKurzfristPrognose(t,r=14){return Z.get(`/aussichten/kurzfristig/${t}?tage=${r}`)},async getLangfristPrognose(t,r=12){return Z.get(`/aussichten/langfristig/${t}?monate=${r}`)},async getTrendAnalyse(t,r=3){return Z.get(`/aussichten/trend/${t}?jahre=${r}`)},async getWetterVorhersage(t,r=7){return Z.get(`/aussichten/wetter/${t}?tage=${r}`)},async getFinanzPrognose(t,r=12){return Z.get(`/aussichten/finanzen/${t}?monate=${r}`)}};function sa({symbol:t,className:r="h-6 w-6"}){switch(t){case"sunny":return e.jsx(oe,{className:`${r} text-yellow-500`});case"partly_cloudy":return e.jsx(Lr,{className:`${r} text-gray-400`});case"cloudy":return e.jsx(Lr,{className:`${r} text-gray-500`});case"rainy":case"drizzle":case"showers":return e.jsx(Ph,{className:`${r} text-blue-500`});case"snowy":case"snow_showers":return e.jsx(Dh,{className:`${r} text-blue-300`});case"thunderstorm":return e.jsx(Ch,{className:`${r} text-purple-500`});case"foggy":return e.jsx(Lr,{className:`${r} text-gray-300`});default:return e.jsx(oe,{className:`${r} text-yellow-400`})}}function na(t){return new Date(t).toLocaleDateString("de-DE",{weekday:"short",day:"2-digit",month:"2-digit"})}function Ql(t){return new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})}function _s(t){return t==null||t<20?"sunny":t<50?"partly_cloudy":(t<80,"cloudy")}function n0({anlageId:t}){var S,V,C,I;const[r,a]=m.useState(null),[s,n]=m.useState(null),[i,o]=m.useState(!0),[c,h]=m.useState(null),[g,l]=m.useState(14),[u,x]=m.useState("standard"),[d,b]=m.useState(!1);m.useEffect(()=>{p()},[t,g,u]);async function p(){o(!0),h(null);try{if(u==="solar-gti"){const F=await $n.getSolarPrognose(t,g,!1);n(F),a(null)}else{const F=await Cn.getKurzfristPrognose(t,g);a(F),n(null)}}catch(F){h(F.message||"Fehler beim Laden der Prognose")}finally{o(!1)}}if(i)return e.jsx(Me,{text:"Lade Kurzfrist-Prognose..."});if(c)return e.jsx(ae,{type:"error",children:c});if(!r&&!s)return e.jsx(ae,{type:"warning",children:"Keine Prognose verfügbar"});const y=u==="solar-gti"&&s?s.tage.map(F=>({datum:Ql(F.datum),datumFull:na(F.datum),pv_kwh:F.pv_ertrag_kwh,sonnenstunden:null,temperatur:F.temperatur_max_c,gti:F.gti_kwh_m2})):(r==null?void 0:r.tageswerte.map(F=>({datum:Ql(F.datum),datumFull:na(F.datum),pv_kwh:F.pv_prognose_kwh,sonnenstunden:F.sonnenstunden,temperatur:F.temperatur_max_c,gti:null})))||[],f=u==="solar-gti"&&s?{...s.tage[0],pv_prognose_kwh:(S=s.tage[0])==null?void 0:S.pv_ertrag_kwh,wetter_symbol:_s((V=s.tage[0])==null?void 0:V.bewoelkung_prozent)}:r==null?void 0:r.tageswerte[0],j=u==="solar-gti"&&s?{...s.tage[1],pv_prognose_kwh:(C=s.tage[1])==null?void 0:C.pv_ertrag_kwh,wetter_symbol:_s((I=s.tage[1])==null?void 0:I.bewoelkung_prozent)}:r==null?void 0:r.tageswerte[1],k=u==="solar-gti"&&s?s.tage.reduce((F,M)=>F+(M.pv_ertrag_kwh||0),0):(r==null?void 0:r.summe_kwh)||0,w=y.length>0?k/y.length:0,_=u==="solar-gti"&&s?s.anlage.leistung_kwp:(r==null?void 0:r.anlagenleistung_kwp)||0,v=u==="solar-gti"&&s?"Open-Meteo Solar (GTI)":(r==null?void 0:r.datenquelle)||"";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vr,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Prognose-Modus:"}),e.jsxs("select",{value:u,onChange:F=>x(F.target.value),className:"input w-auto text-sm",children:[e.jsx("option",{value:"standard",children:"Standard (GHI-basiert)"}),e.jsx("option",{value:"solar-gti",children:"Solar GTI (Modulneigung)"})]}),e.jsx("button",{onClick:()=>b(!d),className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Info zum Prognose-Modus",children:e.jsx(ot,{className:"h-4 w-4"})})]})}),d&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Prognose-Modi:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Standard:"})," Basiert auf horizontaler Globalstrahlung (GHI). Guter Überblick."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solar GTI:"})," Berücksichtigt Modulneigung und -ausrichtung für genauere Prognose. Nutzt Open-Meteo Solar API."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(_e,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Summe ",y.length," Tage"]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[k.toFixed(0)," kWh"]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(oe,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Durchschnitt/Tag"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[w.toFixed(1)," kWh"]})]})]})}),f&&e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(sa,{symbol:f.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Heute"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(f.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})}),j&&e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(sa,{symbol:j.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Morgen"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(j.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})})]}),e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:u==="solar-gti"?"Solar-Prognose (GTI)":"Wettervorhersage"}),e.jsxs("select",{value:g,onChange:F=>l(Number(F.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:7,children:"7 Tage"}),e.jsx("option",{value:14,children:"14 Tage"}),e.jsx("option",{value:16,children:"16 Tage"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 min-w-max pb-2",children:u==="solar-gti"&&s?s.tage.map((F,M)=>{var W;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${M===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:na(F.datum)}),e.jsx(sa,{symbol:_s(F.bewoelkung_prozent),className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[F.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Br,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((W=F.temperatur_max_c)==null?void 0:W.toFixed(0))??"-","°C"]})]}),F.gti_kwh_m2!==null&&F.gti_kwh_m2>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(oe,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[F.gti_kwh_m2.toFixed(1)," GTI"]})]})]},F.datum)}):r?r.tageswerte.map((F,M)=>{var W;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${M===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:na(F.datum)}),e.jsx(sa,{symbol:F.wetter_symbol,className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[F.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Br,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((W=F.temperatur_max_c)==null?void 0:W.toFixed(0))??"-","°C"]})]}),F.sonnenstunden!==null&&F.sonnenstunden>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(oe,{className:"h-3 w-3 text-yellow-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[F.sonnenstunden.toFixed(0),"h"]})]})]},F.datum)}):null})})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Prognose"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:y,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"datum",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{yAxisId:"left",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(be,{yAxisId:"right",orientation:"right",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"°C",angle:90,position:"insideRight"}}),e.jsx(xe,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(F,M)=>M==="pv_kwh"?[`${F.toFixed(1)} kWh`,"PV-Prognose"]:M==="sonnenstunden"?[`${F.toFixed(1)} h`,"Sonnenstunden"]:M==="temperatur"?[`${F.toFixed(0)} °C`,"Temperatur"]:[F,M]}),e.jsx(Ce,{}),e.jsx(le,{yAxisId:"left",dataKey:"pv_kwh",name:"PV-Prognose",fill:"#eab308",radius:[4,4,0,0]}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"temperatur",name:"Temperatur",stroke:"#ef4444",strokeWidth:2,dot:{r:3}})]})})})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Datum"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Wetter"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Prognose"}),e.jsx("th",{className:"text-right py-2 px-3",children:u==="solar-gti"?"GTI":"Strahlung"}),e.jsx("th",{className:"text-right py-2 px-3",children:u==="solar-gti"?"Bewölkung":"Sonnenstunden"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Temperatur"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Niederschlag"})]})}),e.jsx("tbody",{children:u==="solar-gti"&&s?s.tage.map((F,M)=>{var W,N,z;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${M===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:na(F.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(sa,{symbol:_s(F.bewoelkung_prozent),className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[F.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((W=F.gti_kwh_m2)==null?void 0:W.toFixed(2))??"-"," kWh/m²"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((N=F.bewoelkung_prozent)==null?void 0:N.toFixed(0))??"-"," %"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((z=F.temperatur_max_c)==null?void 0:z.toFixed(0))??"-","°C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:F.niederschlag_mm!==null&&F.niederschlag_mm!==void 0&&F.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[F.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},F.datum)}):r?r.tageswerte.map((F,M)=>{var W,N,z;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${M===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:na(F.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(sa,{symbol:F.wetter_symbol,className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[F.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((W=F.globalstrahlung_kwh_m2)==null?void 0:W.toFixed(1))??"-"," kWh/m²"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((N=F.sonnenstunden)==null?void 0:N.toFixed(1))??"-"," h"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((z=F.temperatur_max_c)==null?void 0:z.toFixed(0))??"-","°C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:F.niederschlag_mm!==null&&F.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[F.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},F.datum)}):null})]})})]}),e.jsx($,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",_.toFixed(1)," kWp"]}),u==="solar-gti"&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Neigung: ",s.anlage.neigung,"°"]}),e.jsxs("span",{children:["Ausrichtung: ",s.anlage.azimut,"°"]})]}),u!=="solar-gti"&&r&&e.jsxs("span",{children:["Systemverluste: ",r.system_losses_prozent.toFixed(0),"%"]}),e.jsxs("span",{children:["Datenquelle: ",v]}),e.jsxs("span",{children:["Abgerufen: ",new Date(u==="solar-gti"&&s?s.abgerufen_am:(r==null?void 0:r.abgerufen_am)||new Date().toISOString()).toLocaleString("de-DE")]})]})})]})}function eo({richtung:t}){switch(t){case"positiv":return e.jsx(We,{className:"h-5 w-5 text-green-500"});case"negativ":return e.jsx(qt,{className:"h-5 w-5 text-red-500"});default:return e.jsx(Xs,{className:"h-5 w-5 text-gray-400"})}}function i0({anlageId:t}){const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,o]=m.useState(null),[c,h]=m.useState(12),[g,l]=m.useState(!0);m.useEffect(()=>{u()},[t,c]);async function u(){n(!0),o(null);try{const p=await Cn.getLangfristPrognose(t,c);a(p)}catch(p){o(p.message||"Fehler beim Laden der Prognose")}finally{n(!1)}}if(s)return e.jsx(Me,{text:"Lade Langfrist-Prognose..."});if(i)return e.jsx(ae,{type:"error",children:i});if(!r)return e.jsx(ae,{type:"warning",children:"Keine Prognose verfügbar"});const x=r.monatswerte.map(p=>({name:`${p.monat_name.substring(0,3)} ${p.jahr}`,monat_name:p.monat_name,jahr:p.jahr,pvgis:p.pvgis_prognose_kwh,trend:p.trend_korrigiert_kwh,min:p.konfidenz_min_kwh,max:p.konfidenz_max_kwh,konfidenz:[p.konfidenz_min_kwh,p.konfidenz_max_kwh],pr:p.historische_performance_ratio})),d=r.trend_analyse,b=(d.durchschnittliche_performance_ratio*100).toFixed(0)+"%";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(_e,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahresprognose"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(Mt,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[c," Monate"]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(eo,{richtung:d.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:b})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(ot,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenbasis"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[d.datenbasis_monate," Monate"]})]})]})})]}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatsprognose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:p=>l(p.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Konfidenzband"})]}),e.jsxs("select",{value:c,onChange:p=>h(Number(p.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})]})}),e.jsx($,{className:"p-4",children:e.jsx("div",{className:"h-[350px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:x,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60,className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(xe,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(p,y)=>y==="trend"?[`${p.toFixed(0)} kWh`,"Trend-korrigiert"]:y==="pvgis"?[`${p.toFixed(0)} kWh`,"PVGIS-Prognose"]:y==="konfidenz"&&Array.isArray(p)?[`${p[0].toFixed(0)} - ${p[1].toFixed(0)} kWh`,"Konfidenzband"]:[p,y]}),e.jsx(Ce,{}),g&&e.jsx($t,{type:"monotone",dataKey:"konfidenz",name:"Konfidenzband",fill:"#3b82f6",fillOpacity:.1,stroke:"none"}),e.jsx(le,{dataKey:"pvgis",name:"PVGIS-Prognose",fill:"#9ca3af",fillOpacity:.5,radius:[4,4,0,0]}),e.jsx(le,{dataKey:"trend",name:"Trend-korrigiert",fill:"#eab308",radius:[4,4,0,0]})]})})})}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Trend-Analyse"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(eo,{richtung:d.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trend"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white capitalize",children:d.trend_richtung})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[b,e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(IST / SOLL)"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenquellen"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.datenquellen.join(", ")})]})]})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PVGIS"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Trend-korrigiert"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Min"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Max"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Hist. PR"})]})}),e.jsx("tbody",{children:r.monatswerte.map(p=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[p.monat_name," ",p.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[p.pvgis_prognose_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[p.trend_korrigiert_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[p.konfidenz_min_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[p.konfidenz_max_kwh.toFixed(0)," kWh"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:p.historische_performance_ratio!==null?e.jsxs("span",{className:p.historische_performance_ratio>1?"text-green-600":p.historische_performance_ratio<.9?"text-red-600":"text-gray-600",children:[(p.historische_performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},`${p.jahr}-${p.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[r.monatswerte.reduce((p,y)=>p+y.pvgis_prognose_kwh,0).toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{colSpan:3})]})})]})})]}),e.jsx($,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]}),e.jsxs("span",{children:["Spez. Ertrag: ",(r.jahresprognose_kwh/r.anlagenleistung_kwp).toFixed(0)," kWh/kWp"]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function l0({anlageId:t}){const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,o]=m.useState(null),[c,h]=m.useState(3);m.useEffect(()=>{g()},[t,c]);async function g(){n(!0),o(null);try{const p=await Cn.getTrendAnalyse(t,c);a(p)}catch(p){o(p.message||"Fehler beim Laden der Trend-Analyse")}finally{n(!1)}}if(s)return e.jsx(Me,{text:"Lade Trend-Analyse..."});if(i)return e.jsx(ae,{type:"error",children:i});if(!r)return e.jsx(ae,{type:"warning",children:"Keine Trend-Daten verfügbar"});if(!r.jahres_vergleich.some(p=>p.gesamt_kwh>0))return e.jsx("div",{className:"space-y-6",children:e.jsxs($,{className:"p-8 text-center",children:[e.jsx(ft,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine historischen Daten"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Für eine Trend-Analyse werden mindestens Daten aus einem Jahr benötigt.",e.jsx("br",{}),"Erfasse Monatsdaten, um Trends zu analysieren."]})]})});const u=r.jahres_vergleich.map(p=>({jahr:p.jahr.toString(),kwh:p.gesamt_kwh,spez_ertrag:p.spezifischer_ertrag_kwh_kwp,pr:p.performance_ratio?p.performance_ratio*100:null})),x=r.jahres_vergleich.filter(p=>p.gesamt_kwh>0),d=x.length>0?x.reduce((p,y)=>y.gesamt_kwh>p.gesamt_kwh?y:p,x[0]):null,b=r.degradation.geschaetzt_prozent_jahr;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[d&&e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(fa,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bestes Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:d.jahr}),e.jsxs("p",{className:"text-sm text-green-600",children:[d.gesamt_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(Mt,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Analysezeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.analyse_zeitraum.von," - ",r.analyse_zeitraum.bis]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[b!==null?b>0?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(We,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):b<-1?e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(qt,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Xs,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Xs,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Degradation/Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:b!==null?e.jsxs("span",{className:b>0?"text-green-600":b<-1?"text-red-600":"",children:[b>0?"+":"",b.toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(_e,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]})})]}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"}),e.jsxs("select",{value:c,onChange:p=>h(Number(p.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:2,children:"2 Jahre"}),e.jsx("option",{value:3,children:"3 Jahre"}),e.jsx("option",{value:5,children:"5 Jahre"}),e.jsx("option",{value:10,children:"10 Jahre"})]})]})}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahreserträge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:u,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(xe,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:p=>[`${p.toLocaleString("de-DE")} kWh`,"Ertrag"]}),e.jsx(Ce,{}),e.jsx(le,{dataKey:"kwh",name:"Jahresertrag",radius:[4,4,0,0],children:u.map((p,y)=>e.jsx(Ge,{fill:p.kwh===(d==null?void 0:d.gesamt_kwh)?"#10b981":"#eab308"},`cell-${y}`))})]})})})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:u,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",domain:["auto","auto"]}),e.jsx(xe,{formatter:p=>[`${p.toFixed(0)} kWh/kWp`,"Spez. Ertrag"]}),e.jsx(Ce,{}),e.jsx(qe,{type:"monotone",dataKey:"spez_ertrag",name:"Spez. Ertrag",stroke:"#3b82f6",strokeWidth:2,dot:{r:5}})]})})})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Saisonale Muster"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Beste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.beste_monate.map((p,y)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${y===0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-500"}`,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Schwächste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.schlechteste_monate.map((p,y)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${y===0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-orange-50 text-orange-700 dark:bg-orange-900/20 dark:text-orange-500"}`,children:p},p))})]})]})]}),e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Degradation"}),r.degradation.methode&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.degradation.methode==="vollstaendig"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:r.degradation.methode==="vollstaendig"?"Vollständige Jahre":"TMY-ergänzt"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:b!==null?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:b>0?e.jsxs("span",{className:"text-green-600",children:["+",b.toFixed(2),"% pro Jahr"]}):b<-1?e.jsxs("span",{className:"text-red-600",children:[b.toFixed(2),"% pro Jahr"]}):e.jsxs("span",{className:"text-gray-600",children:[b.toFixed(2),"% pro Jahr"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.degradation.hinweis}),r.degradation.methode==="tmy_ergaenzt"&&e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:"Unvollständige Jahre wurden mit PVGIS TMY-Prognosewerten ergänzt."}),b<-1&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-2",children:"Eine Degradation von mehr als 1% pro Jahr kann auf Probleme hinweisen. Typische Modul-Degradation liegt bei 0.3-0.5% pro Jahr."})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r.degradation.hinweis})})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Jahr"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Monate"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Performance-Ratio"})]})}),e.jsx("tbody",{children:r.jahres_vergleich.map(p=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${p.gesamt_kwh===(d==null?void 0:d.gesamt_kwh)&&p.ist_vollstaendig?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[p.jahr,!p.ist_vollstaendig&&p.anzahl_monate>0&&e.jsx("span",{className:"ml-1 text-xs text-orange-500",title:"Unvollständiges Jahr",children:"*"})]}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:p.ist_vollstaendig?"text-green-600":"text-orange-500",children:[p.anzahl_monate,"/12"]})}),e.jsx("td",{className:"py-2 px-3 text-right",children:p.gesamt_kwh>0?e.jsxs("span",{className:"font-semibold text-yellow-600",children:[p.gesamt_kwh.toLocaleString("de-DE")," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:p.spezifischer_ertrag_kwh_kwp>0?`${p.spezifischer_ertrag_kwh_kwp.toFixed(0)} kWh/kWp`:e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:p.performance_ratio!==null?e.jsxs("span",{className:p.performance_ratio>1?"text-green-600":p.performance_ratio<.9?"text-red-600":"text-gray-600",children:[(p.performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},p.jahr))})]})})]}),e.jsx($,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})})]})}const o0=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ec4899"],c0={speicher:Fe,"e-auto-v2h":Ve,"e-auto-ladung":Ve,waermepumpe:Qe};function d0({anlageId:t}){const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,o]=m.useState(null),[c,h]=m.useState(12);m.useEffect(()=>{g()},[t,c]);async function g(){n(!0),o(null);try{const d=await Cn.getFinanzPrognose(t,c);a(d)}catch(d){o(d.message||"Fehler beim Laden der Finanzprognose")}finally{n(!1)}}if(s)return e.jsx(Me,{text:"Lade Finanzprognose..."});if(i)return e.jsx(ae,{type:"error",children:i});if(!r)return e.jsx(ae,{type:"warning",children:"Keine Prognose verfügbar"});const l=r.monatswerte.map(d=>({name:`${d.monat_name.substring(0,3)} ${d.jahr}`,einspeise_erloes:d.einspeise_erloes_euro,ev_ersparnis:d.ev_ersparnis_euro,netto_ertrag:d.netto_ertrag_euro})),u=[{name:"EV-Ersparnis",value:r.jahres_ev_ersparnis_euro},{name:"Einspeise-Erlös",value:r.jahres_einspeise_erloes_euro}],x=Math.min(r.amortisations_fortschritt_prozent,100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(lr,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahres-Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," €"]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(We,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.amortisations_fortschritt_prozent.toFixed(1),"%"]})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[r.amortisation_erreicht?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(pt,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(_c,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.amortisation_erreicht?e.jsx("span",{className:"text-green-600",children:"Erreicht"}):r.amortisation_prognose_jahr?e.jsx("span",{children:r.amortisation_prognose_jahr}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(Yr,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bisherige Erträge"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," €"]})]})]})})]}),e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Amortisations-Fortschritt"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," € von ",r.investition_gesamt_euro.toLocaleString("de-DE")," €"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all ${r.amortisation_erreicht?"bg-green-500":x>75?"bg-blue-500":x>50?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${x}%`}})}),!r.amortisation_erreicht&&r.restlaufzeit_bis_amortisation_monate&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Noch ca. ",r.restlaufzeit_bis_amortisation_monate," Monate bis zur Amortisation (voraussichtlich ",r.amortisation_prognose_jahr,")"]})]}),e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatliche Ertrags-Prognose"}),e.jsxs("select",{value:c,onChange:d=>h(Number(d.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs($,{className:"p-4 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatliche Erträge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:l,children:[e.jsx(ke,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ve,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:12},label:{value:"€",angle:-90,position:"insideLeft"}}),e.jsx(xe,{formatter:(d,b)=>{const p={einspeise_erloes:"Einspeise-Erlös",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"};return[`${d.toFixed(2)} €`,p[b]||b]}}),e.jsx(Ce,{formatter:d=>({einspeise_erloes:"Einspeise-Erlös",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"})[d]||d}),e.jsx(le,{dataKey:"einspeise_erloes",stackId:"a",fill:"#3b82f6",name:"einspeise_erloes"}),e.jsx(le,{dataKey:"ev_ersparnis",stackId:"a",fill:"#10b981",name:"ev_ersparnis"}),e.jsx(qe,{type:"monotone",dataKey:"netto_ertrag",stroke:"#f59e0b",strokeWidth:2,dot:{r:3},name:"netto_ertrag"})]})})})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Ertrags-Zusammensetzung"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:u,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({percent:d})=>`${(d*100).toFixed(0)}%`,children:u.map((d,b)=>e.jsx(Ge,{fill:o0[b]},`cell-${b}`))}),e.jsx(xe,{formatter:d=>`${d.toFixed(2)} €`}),e.jsx(Ce,{})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"EV-Quote:"}),e.jsxs("span",{className:"font-medium",children:[r.eigenverbrauchsquote_prozent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]})]})]})]})]}),r.komponenten_beitraege&&r.komponenten_beitraege.length>0&&e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Komponenten-Beiträge zur Finanzierung"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.komponenten_beitraege.map((d,b)=>{const p=c0[d.typ]||Fe;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(p,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:d.bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500",children:d.beschreibung})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[d.beitrag_kwh_jahr.toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",d.beitrag_euro_jahr.toFixed(0)," €/Jahr"]})]})]},b)})}),(r.speicher_ev_erhoehung_kwh>0||r.v2h_rueckspeisung_kwh>0||r.wp_pv_anteil_kwh>0)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.speicher_ev_erhoehung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Speicher EV+"}),e.jsxs("p",{className:"font-semibold",children:[r.speicher_ev_erhoehung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.speicher_ev_erhoehung_euro.toFixed(0)," €"]})]}),r.v2h_rueckspeisung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"V2H-Rückspeisung"}),e.jsxs("p",{className:"font-semibold",children:[r.v2h_rueckspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.v2h_ersparnis_euro.toFixed(0)," €"]})]}),r.eauto_ladung_pv_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"E-Auto PV-Ladung"}),e.jsxs("p",{className:"font-semibold",children:[r.eauto_ladung_pv_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.eauto_ersparnis_euro.toFixed(0)," €"]})]}),r.wp_pv_anteil_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"WP PV-Direkt"}),e.jsxs("p",{className:"font-semibold",children:[r.wp_pv_anteil_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.wp_pv_ersparnis_euro.toFixed(0)," €"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Strompreise"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Einspeisevergütung"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Netzbezugspreis"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:[r.netzbezug_preis_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ersparnis durch EV"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[(r.netzbezug_preis_cent_kwh-r.einspeiseverguetung_cent_kwh).toFixed(2)," ct/kWh"]})]})]})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Investition & ROI"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Investition gesamt"}),e.jsxs("span",{className:"font-semibold",children:[r.investition_gesamt_euro.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Bisherige Erträge"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Prognose Jahres-Ertrag"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE")," €/Jahr"]})]})]})]})]}),e.jsxs($,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeisung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeise-Erlös"}),e.jsx("th",{className:"text-right py-2 px-3",children:"EV-Ersparnis"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold",children:"Netto-Ertrag"})]})}),e.jsx("tbody",{children:r.monatswerte.map(d=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[d.monat_name," ",d.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[d.pv_erzeugung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[d.eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[d.einspeisung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[d.einspeise_erloes_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[d.ev_ersparnis_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[d.netto_ertrag_euro.toFixed(2)," €"]})]},`${d.jahr}-${d.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_erzeugung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[r.jahres_einspeise_erloes_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[r.jahres_ev_ersparnis_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahres_netto_ertrag_euro.toFixed(2)," €"]})]})})]})})]}),e.jsx($,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function h0(){var u;const t=pr(),[r,a]=m.useState("kurzfristig"),{anlagen:s,loading:n}=it(),[i,o]=m.useState(null),c=i??((u=s[0])==null?void 0:u.id);if(n)return e.jsx(Me,{text:"Lade Aussichten..."});if(s.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});const h=s.find(x=>x.id===c);if(!((h==null?void 0:h.latitude)&&(h==null?void 0:h.longitude)))return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsxs($,{className:"text-center py-12",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Standort nicht konfiguriert"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["Für Prognosen werden die Koordinaten der Anlage benötigt.",e.jsx("br",{}),"Bitte konfiguriere den Standort in den Anlagen-Einstellungen."]}),e.jsxs(he,{onClick:()=>t("/einstellungen/anlage"),children:["Anlage konfigurieren",e.jsx(gt,{className:"h-4 w-4 ml-2"})]})]})]});const l=[{key:"kurzfristig",label:"Kurzfristig",icon:oe,tooltip:"7-14 Tage Wetterprognose mit PV-Ertragsprognose"},{key:"langfristig",label:"Langfristig",icon:Mt,tooltip:"12-Monats-Prognose basierend auf PVGIS-Daten"},{key:"trend",label:"Trend",icon:We,tooltip:"Historische Trends und Degradationsanalyse"},{key:"finanzen",label:"Finanzen",icon:lr,tooltip:"Finanzielle Prognosen und Amortisation"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx("div",{className:"flex items-center gap-3",children:s.length>1&&e.jsx("select",{value:c??"",onChange:x=>o(Number(x.target.value)),className:"input w-auto",children:s.map(x=>e.jsx("option",{value:x.id,children:x.anlagenname},x.id))})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:l.map(x=>{const d=x.icon;return e.jsx(An,{text:x.tooltip,children:e.jsxs("button",{onClick:()=>a(x.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 ${r===x.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(d,{className:"h-4 w-4"}),x.label]})},x.key)})})})]}),c&&e.jsxs(e.Fragment,{children:[r==="kurzfristig"&&e.jsx(n0,{anlageId:c}),r==="langfristig"&&e.jsx(i0,{anlageId:c}),r==="trend"&&e.jsx(l0,{anlageId:c}),r==="finanzen"&&e.jsx(d0,{anlageId:c})]})]})}const g0=[{key:"strom",label:"Strom",icon:"⚡"},{key:"gas",label:"Gas",icon:"🔥"},{key:"wasser",label:"Wasser",icon:"💧"}],Aa=()=>({name:"",kundennummer:"",portal_url:"",notizen:"",zaehler:[]}),u0=()=>({bezeichnung:"",nummer:"",notizen:""});function x0({value:t,onChange:r}){const[a,s]=m.useState({}),n=x=>{s(d=>({...d,[x]:!d[x]}))},i=(x,d)=>{const b={...t};d?b[x]=d:delete b[x],r(b)},o=x=>{i(x,Aa()),s(d=>({...d,[x]:!0}))},c=x=>{i(x,void 0)},h=(x,d,b)=>{const p=t[x]||Aa();i(x,{...p,[d]:b})},g=x=>{const d=t[x]||Aa();i(x,{...d,zaehler:[...d.zaehler,u0()]})},l=(x,d,b)=>{const p=t[x]||Aa(),y=[...p.zaehler];y[d]=b,i(x,{...p,zaehler:y})},u=(x,d)=>{const b=t[x]||Aa(),p=b.zaehler.filter((y,f)=>f!==d);i(x,{...b,zaehler:p})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Versorger & Zähler"}),e.jsx("div",{className:"space-y-3",children:g0.map(({key:x,label:d,icon:b})=>{const p=t[x],y=a[x];return p?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer",onClick:()=>n(x),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsx(zr,{className:"w-4 h-4 text-gray-500"}):e.jsx(ar,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-lg",children:b}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:p.name||d}),p.zaehler.length>0&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",p.zaehler.length," Zähler)"]})]}),e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),c(x)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Versorger entfernen",children:e.jsx(Pt,{className:"w-4 h-4"})})]}),y&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Versorger-Name",value:p.name,onChange:f=>h(x,"name",f.target.value),placeholder:`z.B. Stadtwerke ${d}`}),e.jsx(J,{label:"Kundennummer",value:p.kundennummer,onChange:f=>h(x,"kundennummer",f.target.value),placeholder:"z.B. 12345678"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(J,{label:"Kundenportal-URL",value:p.portal_url||"",onChange:f=>h(x,"portal_url",f.target.value),placeholder:"https://kundenportal.beispiel.de"}),p.portal_url&&e.jsxs("a",{href:p.portal_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Ir,{className:"w-3 h-3"}),"Portal öffnen"]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(J,{label:"Notizen",value:p.notizen||"",onChange:f=>h(x,"notizen",f.target.value),placeholder:"Optionale Anmerkungen..."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Zähler"}),e.jsxs(he,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(x),children:[e.jsx(Sr,{className:"w-4 h-4 mr-1"}),"Zähler"]})]}),p.zaehler.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Noch keine Zähler erfasst"}):e.jsx("div",{className:"space-y-2",children:p.zaehler.map((f,j)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(J,{label:"Bezeichnung",value:f.bezeichnung,onChange:k=>l(x,j,{...f,bezeichnung:k.target.value}),placeholder:x==="strom"?"z.B. Einspeisung":"z.B. Hauptzähler"}),e.jsx(J,{label:"Zählernummer",value:f.nummer,onChange:k=>l(x,j,{...f,nummer:k.target.value}),placeholder:"z.B. 1EMH0012345678"}),e.jsx(J,{label:"Notizen",value:f.notizen||"",onChange:k=>l(x,j,{...f,notizen:k.target.value}),placeholder:"Optional..."})]}),e.jsx("button",{type:"button",onClick:()=>u(x,j),className:"p-2 text-gray-400 hover:text-red-500 transition-colors mt-6",title:"Zähler entfernen",children:e.jsx(Pt,{className:"w-4 h-4"})})]},j))})]})]})]},x):e.jsxs("button",{type:"button",onClick:()=>o(x),className:"w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-400 hover:text-blue-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Sr,{className:"w-4 h-4"}),e.jsxs("span",{children:[b," ",d,"-Versorger hinzufügen"]})]},x)})})]})}function to({anlage:t,onSubmit:r,onCancel:a}){var f,j,k;const[s,n]=m.useState(!1),[i,o]=m.useState(null),[c,h]=m.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((f=t==null?void 0:t.leistung_kwp)==null?void 0:f.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((j=t==null?void 0:t.latitude)==null?void 0:j.toString())||"",longitude:((k=t==null?void 0:t.longitude)==null?void 0:k.toString())||"",mastr_id:(t==null?void 0:t.mastr_id)||"",wetter_provider:(t==null?void 0:t.wetter_provider)||"auto"}),[g,l]=m.useState((t==null?void 0:t.versorger_daten)||{}),[u,x]=m.useState([]),[d,b]=m.useState(!1);m.useEffect(()=>{t!=null&&t.id&&t.latitude&&t.longitude&&(b(!0),$n.getProvider(t.id).then(w=>x(w.provider)).catch(w=>console.warn("Wetter-Provider laden fehlgeschlagen:",w)).finally(()=>b(!1)))},[t==null?void 0:t.id,t==null?void 0:t.latitude,t==null?void 0:t.longitude]);const p=w=>{const{name:_,value:v}=w.target;h(S=>({...S,[_]:v}))},y=async w=>{if(w.preventDefault(),o(null),!c.anlagenname.trim()){o("Bitte einen Namen eingeben");return}if(!c.leistung_kwp||parseFloat(c.leistung_kwp)<=0){o("Bitte eine gültige Leistung eingeben");return}try{n(!0),await r({anlagenname:c.anlagenname.trim(),leistung_kwp:parseFloat(c.leistung_kwp),installationsdatum:c.installationsdatum||void 0,standort_plz:c.standort_plz||void 0,standort_ort:c.standort_ort||void 0,standort_strasse:c.standort_strasse||void 0,latitude:c.latitude?parseFloat(c.latitude):void 0,longitude:c.longitude?parseFloat(c.longitude):void 0,mastr_id:c.mastr_id||void 0,versorger_daten:Object.keys(g).length>0?g:void 0,wetter_provider:c.wetter_provider})}catch(_){o(_ instanceof Error?_.message:"Fehler beim Speichern")}finally{n(!1)}};return e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[i&&e.jsx(ae,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Anlagenname",name:"anlagenname",value:c.anlagenname,onChange:p,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(J,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:c.leistung_kwp,onChange:p,placeholder:"z.B. 10.5",required:!0}),e.jsx(J,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:c.installationsdatum,onChange:p})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," gepflegt. So können auch Anlagen mit mehreren Dachflächen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(J,{label:"PLZ",name:"standort_plz",value:c.standort_plz,onChange:p,placeholder:"z.B. 12345"}),e.jsx(J,{label:"Ort",name:"standort_ort",value:c.standort_ort,onChange:p,placeholder:"z.B. Berlin"}),e.jsx(J,{label:"Straße",name:"standort_strasse",value:c.standort_strasse,onChange:p,placeholder:"z.B. Musterstraße 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(für PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:c.latitude,onChange:p,placeholder:"z.B. 52.520008",hint:"Nördliche Breite (positiv)"}),e.jsx(J,{label:"Längengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:c.longitude,onChange:p,placeholder:"z.B. 13.404954",hint:"Östliche Länge (positiv)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Erweiterte Stammdaten"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(J,{label:"MaStR-ID",name:"mastr_id",value:c.mastr_id,onChange:p,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID der Anlage"}),c.mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${c.mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Ir,{className:"w-3 h-3"}),"Im MaStR öffnen"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Lr,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten-Quelle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"wetter_provider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bevorzugter Provider"}),e.jsx("select",{id:"wetter_provider",name:"wetter_provider",value:c.wetter_provider,onChange:p,disabled:d,className:"w-full px-3 py-2 rounded-lg border bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed border-gray-300 dark:border-gray-600",children:u.length>0?u.map(w=>e.jsxs("option",{value:w.id,disabled:!w.verfuegbar,children:[w.name,w.empfohlen?" (empfohlen)":"",w.verfuegbar?"":" (nicht verfügbar)"]},w.id)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"auto",children:"Automatisch (empfohlen)"}),e.jsx("option",{value:"open-meteo",children:"Open-Meteo"}),e.jsx("option",{value:"brightsky",children:"Bright Sky (DWD)"}),e.jsx("option",{value:"open-meteo-solar",children:"Open-Meteo Solar"})]})})]}),e.jsx("div",{className:"flex items-end pb-1",children:e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[c.wetter_provider==="auto"&&e.jsx("span",{children:"Automatische Auswahl: Bright Sky für DE, Open-Meteo sonst"}),c.wetter_provider==="brightsky"&&e.jsx("span",{children:"DWD-Daten über Bright Sky API (nur Deutschland)"}),c.wetter_provider==="open-meteo"&&e.jsx("span",{children:"Open-Meteo Archive API (weltweit verfügbar)"}),c.wetter_provider==="open-meteo-solar"&&e.jsx("span",{children:"GTI-Berechnung für geneigte PV-Module"})]})})]}),!(t!=null&&t.latitude)&&!(t!=null&&t.longitude)&&e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg flex gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Bitte zuerst Geokoordinaten eintragen, um die verfügbaren Provider zu sehen."})]})]}),e.jsx(x0,{value:g,onChange:l}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(he,{type:"button",variant:"secondary",onClick:a,children:"Abbrechen"}),e.jsx(he,{type:"submit",loading:s,children:t?"Speichern":"Anlage erstellen"})]})]})}function m0(){const{anlagen:t,loading:r,error:a,createAnlage:s,updateAnlage:n,deleteAnlage:i}=it(),[o,c]=m.useState(!1),[h,g]=m.useState(null),[l,u]=m.useState(null),x=async p=>{await s(p),c(!1)},d=async p=>{h&&(await n(h.id,p),g(null))},b=async()=>{l&&(await i(l.id),u(null))};return r?e.jsx(Me,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(he,{onClick:()=>c(!0),children:[e.jsx(Sr,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),a&&e.jsx(ae,{type:"error",children:a}),t.length===0?e.jsx($,{children:e.jsx(ka,{icon:oe,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(he,{onClick:()=>c(!0),children:"Erste Anlage anlegen"})})}):e.jsx($,{padding:"none",children:e.jsxs(Qi,{children:[e.jsx(el,{children:e.jsxs(ja,{children:[e.jsx(yt,{children:"Name"}),e.jsx(yt,{children:"Leistung"}),e.jsx(yt,{children:"Standort"}),e.jsx(yt,{children:"Ausrichtung"}),e.jsx(yt,{children:"Installation"}),e.jsx(yt,{className:"text-right",children:"Aktionen"})]})}),e.jsx(tl,{children:t.map(p=>e.jsxs(ja,{children:[e.jsx(jt,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:p.anlagenname})]})}),e.jsxs(jt,{children:[e.jsx("span",{className:"font-mono",children:p.leistung_kwp})," kWp"]}),e.jsx(jt,{children:p.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(_t,{className:"h-4 w-4"}),p.standort_plz," ",p.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(jt,{children:[p.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),p.neigung_grad&&` / ${p.neigung_grad}°`]}),e.jsx(jt,{children:p.installationsdatum?new Date(p.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(jt,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=ir.getPdfExportUrl(p.id)},title:"PDF-Dokumentation (Gesamtzeitraum)",children:e.jsx(Fn,{className:"h-4 w-4 text-orange-500"})}),e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=ir.getFullExportUrl(p.id)},title:"Export (JSON)",children:e.jsx(Ct,{className:"h-4 w-4 text-blue-500"})}),e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>g(p),children:e.jsx(Xi,{className:"h-4 w-4"})}),e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>u(p),children:e.jsx(Pt,{className:"h-4 w-4 text-red-500"})})]})})]},p.id))})]})}),e.jsx(Ot,{isOpen:o,onClose:()=>c(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(to,{onSubmit:x,onCancel:()=>c(!1)})}),e.jsx(Ot,{isOpen:!!h,onClose:()=>g(null),title:"Anlage bearbeiten",size:"lg",children:h&&e.jsx(to,{anlage:h,onSubmit:d,onCancel:()=>g(null)})}),e.jsx(Ot,{isOpen:!!l,onClose:()=>u(null),title:"Anlage löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Anlage ",e.jsxs("strong",{children:['"',l==null?void 0:l.anlagenname,'"']})," wirklich löschen?"]}),e.jsx(ae,{type:"warning",children:"Alle zugehörigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelöscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(he,{variant:"secondary",onClick:()=>u(null),children:"Abbrechen"}),e.jsx(he,{variant:"danger",onClick:b,children:"Löschen"})]})]})})]})}function p0(){var V;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(null),n=a??((V=t[0])==null?void 0:V.id),{strompreise:i,loading:o,error:c,createStrompreis:h,updateStrompreis:g,deleteStrompreis:l}=vg(n),[u,x]=m.useState(!1),[d,b]=m.useState(null),[p,y]=m.useState(null),[f,j]=m.useState(null),k=async C=>{try{j(null),await h(C),x(!1)}catch(I){j(I instanceof Error?I.message:"Fehler beim Erstellen")}},w=async C=>{if(d)try{j(null),await g(d.id,C),b(null)}catch(I){j(I instanceof Error?I.message:"Fehler beim Aktualisieren")}},_=async()=>{if(p)try{await l(p.id),y(null)}catch(C){j(C instanceof Error?C.message:"Fehler beim Löschen")}},v=C=>{const I=new Date().toISOString().split("T")[0],F=C.gueltig_ab<=I,M=!C.gueltig_bis||C.gueltig_bis>=I;return F&&M};if(r||o)return e.jsx(Me,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const S=[...i].sort((C,I)=>{const F=v(C),M=v(I);return F!==M?F?-1:1:I.gueltig_ab.localeCompare(C.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:n??"",onChange:C=>s(Number(C.target.value)),className:"input w-auto",children:t.map(C=>e.jsx("option",{value:C.id,children:C.anlagenname},C.id))}),e.jsxs(he,{onClick:()=>x(!0),children:[e.jsx(Sr,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),c&&e.jsx(ae,{type:"error",children:c}),S.length>0&&v(S[0])&&e.jsx($,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(hr,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",S[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[S[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," · ","Einspeisung: ",e.jsxs("strong",{children:[S[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),S[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" · Grundpreis: ",e.jsxs("strong",{children:[S[0].grundpreis_euro_monat.toFixed(2)," €/Monat"]})]})]})]})]})}),i.length===0?e.jsx($,{children:e.jsx(ka,{icon:_e,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(he,{onClick:()=>x(!0),children:"Ersten Tarif anlegen"})})}):e.jsx($,{padding:"none",children:e.jsxs(Qi,{children:[e.jsx(el,{children:e.jsxs(ja,{children:[e.jsx(yt,{children:"Tarif"}),e.jsx(yt,{children:"Netzbezug"}),e.jsx(yt,{children:"Einspeisung"}),e.jsx(yt,{children:"Grundpreis"}),e.jsx(yt,{children:"Gültigkeit"}),e.jsx(yt,{className:"text-right",children:"Aktionen"})]})}),e.jsx(tl,{children:S.map(C=>{const I=v(C);return e.jsxs(ja,{className:I?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(jt,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:`h-5 w-5 ${I?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:C.tarifname||"Standard"}),I&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),C.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:C.anbieter})]})]})}),e.jsxs(jt,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:C.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(jt,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:C.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(jt,{children:C.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:C.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" €/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(jt,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Mt,{className:"h-4 w-4"}),new Date(C.gueltig_ab).toLocaleDateString("de-DE"),C.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(C.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(jt,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>b(C),children:e.jsx(Xi,{className:"h-4 w-4"})}),e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>y(C),children:e.jsx(Pt,{className:"h-4 w-4 text-red-500"})})]})})]},C.id)})})]})}),e.jsxs($,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gültige Tarif wird automatisch für Berechnungen verwendet"}),e.jsx("li",{children:"Für historische Auswertungen werden die zum jeweiligen Zeitpunkt gültigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gültigkeitszeitraum korrekt setzen"})]})]}),e.jsx(Ot,{isOpen:u,onClose:()=>{x(!1),j(null)},title:"Neuen Tarif anlegen",size:"lg",children:n&&e.jsx(ro,{anlageId:n,onCreate:k,onCancel:()=>{x(!1),j(null)},error:f})}),e.jsx(Ot,{isOpen:!!d,onClose:()=>{b(null),j(null)},title:"Tarif bearbeiten",size:"lg",children:d&&e.jsx(ro,{strompreis:d,anlageId:d.anlage_id,onUpdate:w,onCancel:()=>{b(null),j(null)},error:f})}),e.jsx(Ot,{isOpen:!!p,onClose:()=>y(null),title:"Tarif löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du den Tarif ",e.jsxs("strong",{children:['"',(p==null?void 0:p.tarifname)||"Standard",'"']})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(he,{variant:"secondary",onClick:()=>y(null),children:"Abbrechen"}),e.jsx(he,{variant:"danger",onClick:_,children:"Löschen"})]})]})})]})}function ro({strompreis:t,anlageId:r,onCreate:a,onUpdate:s,onCancel:n,error:i}){var x,d,b;const[o,c]=m.useState(!1),[h,g]=m.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((x=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:x.toString())||"30",einspeiseverguetung_cent_kwh:((d=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:d.toString())||"8.2",grundpreis_euro_monat:((b=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:b.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||""}),l=p=>{const{name:y,value:f}=p.target;g(j=>({...j,[y]:f}))},u=async p=>{p.preventDefault(),c(!0);try{const y={netzbezug_arbeitspreis_cent_kwh:parseFloat(h.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(h.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:h.grundpreis_euro_monat?parseFloat(h.grundpreis_euro_monat):void 0,gueltig_ab:h.gueltig_ab,gueltig_bis:h.gueltig_bis||void 0,tarifname:h.tarifname||void 0,anbieter:h.anbieter||void 0,vertragsart:h.vertragsart||void 0};t&&s?await s(y):a&&await a({...y,anlage_id:r})}finally{c(!1)}};return e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[i&&e.jsx(ae,{type:"error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Tarifname",name:"tarifname",value:h.tarifname,onChange:l,placeholder:"z.B. Grundversorgung, Öko-Strom"}),e.jsx(J,{label:"Anbieter",name:"anbieter",value:h.anbieter,onChange:l,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(J,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:h.netzbezug_arbeitspreis_cent_kwh,onChange:l,required:!0,hint:"Arbeitspreis für Strombezug"}),e.jsx(J,{label:"Einspeisevergütung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:h.einspeiseverguetung_cent_kwh,onChange:l,required:!0,hint:"EEG-Vergütung oder PPA-Preis"}),e.jsx(J,{label:"Grundpreis (€/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:h.grundpreis_euro_monat,onChange:l,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gültigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Gültig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:h.gueltig_ab,onChange:l,required:!0}),e.jsx(J,{label:"Gültig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:h.gueltig_bis,onChange:l,hint:"Leer lassen für unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:h.vertragsart,onChange:l,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte wählen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"Ökostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(he,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(he,{type:"submit",loading:o,children:t?"Speichern":"Anlegen"})]})]})}function b0({typ:t,paramData:r,onChange:a,anlage:s,hasParent:n}){const[i,o]=m.useState(!1),[c,h]=m.useState(!1),g=n,l="Wechselrichter";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gerätedaten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Hersteller",name:"param_stamm_hersteller",value:r.stamm_hersteller||"",onChange:a,placeholder:"z.B. Fronius, BYD, Longi"}),e.jsx(J,{label:"Modell",name:"param_stamm_modell",value:r.stamm_modell||"",onChange:a,placeholder:"z.B. Symo GEN24 10.0"}),e.jsx(J,{label:"Seriennummer",name:"param_stamm_seriennummer",value:r.stamm_seriennummer||"",onChange:a,placeholder:t==="pv-module"?"z.B. SN001-SN020":"z.B. ABC123456"}),e.jsx(J,{label:"Garantie bis",name:"param_stamm_garantie_bis",type:"date",value:r.stamm_garantie_bis||"",onChange:a}),t==="wechselrichter"&&e.jsxs("div",{children:[e.jsx(J,{label:"MaStR-ID",name:"param_stamm_mastr_id",value:r.stamm_mastr_id||"",onChange:a,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID des Wechselrichters"}),r.stamm_mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${r.stamm_mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Ir,{className:"w-3 h-3"}),"Im MaStR öffnen"]})]}),t==="speicher"&&e.jsx(J,{label:"Garantie-Zyklen",name:"param_stamm_garantie_zyklen",type:"number",value:r.stamm_garantie_zyklen||"",onChange:a,placeholder:"z.B. 6000",hint:"Garantierte Ladezyklen"}),t==="pv-module"&&e.jsx(J,{label:"Leistungsgarantie (%)",name:"param_stamm_garantie_leistung_prozent",type:"number",min:"0",max:"100",value:r.stamm_garantie_leistung_prozent||"",onChange:a,placeholder:"z.B. 80",hint:"Garantierte Mindestleistung nach 25 Jahren"}),t==="e-auto"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{label:"Kennzeichen",name:"param_stamm_kennzeichen",value:r.stamm_kennzeichen||"",onChange:a,placeholder:"z.B. M-EE 1234"}),e.jsx(J,{label:"Fahrgestellnummer (VIN)",name:"param_stamm_fahrgestellnummer",value:r.stamm_fahrgestellnummer||"",onChange:a,placeholder:"z.B. WVWZZZ..."}),e.jsx(J,{label:"Erstzulassung",name:"param_stamm_erstzulassung",type:"date",value:r.stamm_erstzulassung||"",onChange:a}),e.jsx(J,{label:"Garantie Batterie (km)",name:"param_stamm_garantie_batterie_km",type:"number",value:r.stamm_garantie_batterie_km||"",onChange:a,placeholder:"z.B. 160000"})]}),(t==="waermepumpe"||t==="e-auto")&&e.jsxs(e.Fragment,{children:[e.jsx(J,{label:"Förderung Aktenzeichen",name:"param_stamm_foerderung_aktenzeichen",value:r.stamm_foerderung_aktenzeichen||"",onChange:a,placeholder:"z.B. BAFA-2024-12345"}),e.jsx(J,{label:"Förderbetrag (€)",name:"param_stamm_foerderung_betrag_euro",type:"number",value:r.stamm_foerderung_betrag_euro||"",onChange:a,placeholder:"z.B. 5000"})]}),t==="balkonkraftwerk"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{label:"Anmeldung Netzbetreiber",name:"param_stamm_anmeldung_netzbetreiber",type:"date",value:r.stamm_anmeldung_netzbetreiber||"",onChange:a}),e.jsx(J,{label:"Anmeldung MaStR",name:"param_stamm_anmeldung_marktstammdaten",type:"date",value:r.stamm_anmeldung_marktstammdaten||"",onChange:a})]})]}),e.jsx("div",{children:e.jsx(J,{label:"Notizen",name:"param_stamm_notizen",value:r.stamm_notizen||"",onChange:a,placeholder:"Optionale Anmerkungen zu diesem Gerät..."})})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>o(!i),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(zr,{className:"w-4 h-4 text-gray-500"}):e.jsx(ar,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ansprechpartner"}),g&&!f0(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",l,")"]})]})}),i&&e.jsxs("div",{className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder übernehmen automatisch die Werte von ",l,". Nur bei Abweichung ausfüllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Firma",name:"param_ansprechpartner_firma",value:r.ansprechpartner_firma||"",onChange:a,placeholder:s?`(${l})`:"z.B. Solar Mustermann GmbH"}),e.jsx(J,{label:"Name",name:"param_ansprechpartner_name",value:r.ansprechpartner_name||"",onChange:a,placeholder:"Kontaktperson"}),e.jsx(J,{label:"Telefon",name:"param_ansprechpartner_telefon",value:r.ansprechpartner_telefon||"",onChange:a,placeholder:"+49 123 456789"}),e.jsx(J,{label:"E-Mail",name:"param_ansprechpartner_email",type:"email",value:r.ansprechpartner_email||"",onChange:a,placeholder:"service@beispiel.de"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(J,{label:"Ticketsystem / Support-Portal",name:"param_ansprechpartner_ticketsystem",value:r.ansprechpartner_ticketsystem||"",onChange:a,placeholder:"https://support.beispiel.de"}),r.ansprechpartner_ticketsystem&&e.jsxs("a",{href:r.ansprechpartner_ticketsystem,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Ir,{className:"w-3 h-3"}),"Portal öffnen"]})]}),e.jsx(J,{label:"Kundennummer",name:"param_ansprechpartner_kundennummer",value:r.ansprechpartner_kundennummer||"",onChange:a,placeholder:"z.B. K-12345"}),e.jsx(J,{label:"Vertragsnummer",name:"param_ansprechpartner_vertragsnummer",value:r.ansprechpartner_vertragsnummer||"",onChange:a,placeholder:"z.B. V-2024-001"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(J,{label:"Notizen",name:"param_ansprechpartner_notizen",value:r.ansprechpartner_notizen||"",onChange:a,placeholder:"Optionale Anmerkungen..."})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>h(!c),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx(zr,{className:"w-4 h-4 text-gray-500"}):e.jsx(ar,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wartungsvertrag"}),g&&!y0(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",l,")"]})]})}),c&&e.jsxs("div",{className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder übernehmen automatisch die Werte von ",l,". Nur bei Abweichung ausfüllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Vertragsnummer",name:"param_wartung_vertragsnummer",value:r.wartung_vertragsnummer||"",onChange:a,placeholder:"z.B. WV-2024-001"}),e.jsx(J,{label:"Anbieter",name:"param_wartung_anbieter",value:r.wartung_anbieter||"",onChange:a,placeholder:"z.B. Solar Mustermann GmbH"}),e.jsx(J,{label:"Gültig bis",name:"param_wartung_gueltig_bis",type:"date",value:r.wartung_gueltig_bis||"",onChange:a}),e.jsx(J,{label:"Kündigungsfrist",name:"param_wartung_kuendigungsfrist",value:r.wartung_kuendigungsfrist||"",onChange:a,placeholder:"z.B. 3 Monate zum Jahresende"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(J,{label:"Leistungsumfang",name:"param_wartung_leistungsumfang",value:r.wartung_leistungsumfang||"",onChange:a,placeholder:"z.B. Jährliche Inspektion, Reinigung, Fernüberwachung"})})]})]})]})]})}function f0(t){return["ansprechpartner_firma","ansprechpartner_name","ansprechpartner_telefon","ansprechpartner_email","ansprechpartner_ticketsystem","ansprechpartner_kundennummer","ansprechpartner_vertragsnummer","ansprechpartner_notizen"].some(a=>t[a]&&String(t[a]).trim()!=="")}function y0(t){return["wartung_vertragsnummer","wartung_anbieter","wartung_gueltig_bis","wartung_kuendigungsfrist","wartung_leistungsumfang"].some(a=>t[a]&&String(t[a]).trim()!=="")}const j0={"pv-module":"wechselrichter",speicher:"wechselrichter"},k0=["pv-module"],zs={wechselrichter:"Wechselrichter"},Gn={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},v0={"e-auto":"Kosten eines vergleichbaren Verbrenners (für ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/Ölheizung (für ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function w0({investition:t,anlageId:r,typ:a,anlage:s,onSubmit:n,onCancel:i}){var C,I,F,M,W,N;const[o,c]=m.useState(!1),[h,g]=m.useState(null),[l,u]=m.useState([]),[x,d]=m.useState(!1),[b,p]=m.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${Gn[a]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((C=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:C.toString())||"",anschaffungskosten_alternativ:((I=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:I.toString())||"",betriebskosten_jahr:((F=t==null?void 0:t.betriebskosten_jahr)==null?void 0:F.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,parent_investition_id:((M=t==null?void 0:t.parent_investition_id)==null?void 0:M.toString())||"",leistung_kwp:((W=t==null?void 0:t.leistung_kwp)==null?void 0:W.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"Süd",neigung_grad:((N=t==null?void 0:t.neigung_grad)==null?void 0:N.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""}),y=j0[a],f=k0.includes(a);m.useEffect(()=>{y&&(d(!0),et.list(r,y,!0).then(z=>u(z.filter(A=>A.id!==(t==null?void 0:t.id)))).catch(()=>u([])).finally(()=>d(!1)))},[y,r,t==null?void 0:t.id]);const j=(t==null?void 0:t.parameter)||{},k=()=>{var z,A,P,E,L,R,X,O,B,G,T,q,re,de,ue,ee,pe,Be,ie,se,K,Q,ce,Ee,te,U,je,Pe,Ae;return{stamm_hersteller:((z=j.stamm_hersteller)==null?void 0:z.toString())||"",stamm_modell:((A=j.stamm_modell)==null?void 0:A.toString())||"",stamm_seriennummer:((P=j.stamm_seriennummer)==null?void 0:P.toString())||"",stamm_garantie_bis:((E=j.stamm_garantie_bis)==null?void 0:E.toString())||"",stamm_notizen:((L=j.stamm_notizen)==null?void 0:L.toString())||"",stamm_mastr_id:((R=j.stamm_mastr_id)==null?void 0:R.toString())||"",stamm_garantie_zyklen:((X=j.stamm_garantie_zyklen)==null?void 0:X.toString())||"",stamm_garantie_leistung_prozent:((O=j.stamm_garantie_leistung_prozent)==null?void 0:O.toString())||"",stamm_kennzeichen:((B=j.stamm_kennzeichen)==null?void 0:B.toString())||"",stamm_fahrgestellnummer:((G=j.stamm_fahrgestellnummer)==null?void 0:G.toString())||"",stamm_erstzulassung:((T=j.stamm_erstzulassung)==null?void 0:T.toString())||"",stamm_garantie_batterie_km:((q=j.stamm_garantie_batterie_km)==null?void 0:q.toString())||"",stamm_foerderung_aktenzeichen:((re=j.stamm_foerderung_aktenzeichen)==null?void 0:re.toString())||"",stamm_foerderung_betrag_euro:((de=j.stamm_foerderung_betrag_euro)==null?void 0:de.toString())||"",stamm_anmeldung_netzbetreiber:((ue=j.stamm_anmeldung_netzbetreiber)==null?void 0:ue.toString())||"",stamm_anmeldung_marktstammdaten:((ee=j.stamm_anmeldung_marktstammdaten)==null?void 0:ee.toString())||"",ansprechpartner_firma:((pe=j.ansprechpartner_firma)==null?void 0:pe.toString())||"",ansprechpartner_name:((Be=j.ansprechpartner_name)==null?void 0:Be.toString())||"",ansprechpartner_telefon:((ie=j.ansprechpartner_telefon)==null?void 0:ie.toString())||"",ansprechpartner_email:((se=j.ansprechpartner_email)==null?void 0:se.toString())||"",ansprechpartner_ticketsystem:((K=j.ansprechpartner_ticketsystem)==null?void 0:K.toString())||"",ansprechpartner_kundennummer:((Q=j.ansprechpartner_kundennummer)==null?void 0:Q.toString())||"",ansprechpartner_vertragsnummer:((ce=j.ansprechpartner_vertragsnummer)==null?void 0:ce.toString())||"",ansprechpartner_notizen:((Ee=j.ansprechpartner_notizen)==null?void 0:Ee.toString())||"",wartung_vertragsnummer:((te=j.wartung_vertragsnummer)==null?void 0:te.toString())||"",wartung_anbieter:((U=j.wartung_anbieter)==null?void 0:U.toString())||"",wartung_gueltig_bis:((je=j.wartung_gueltig_bis)==null?void 0:je.toString())||"",wartung_kuendigungsfrist:((Pe=j.wartung_kuendigungsfrist)==null?void 0:Pe.toString())||"",wartung_leistungsumfang:((Ae=j.wartung_leistungsumfang)==null?void 0:Ae.toString())||""}},w=()=>{var A,P,E,L,R,X,O,B,G,T,q,re,de,ue,ee,pe,Be,ie,se,K,Q,ce,Ee,te,U,je,Pe,Ae,It,H,fe,Oe,Ke,Ie,dt,Ea,ks,Ll;const z=k();switch(a){case"e-auto":return{...z,batteriekapazitaet_kwh:((A=j.batteriekapazitaet_kwh)==null?void 0:A.toString())||"",verbrauch_kwh_100km:((P=j.verbrauch_kwh_100km)==null?void 0:P.toString())||"18",jahresfahrleistung_km:((E=j.jahresfahrleistung_km)==null?void 0:E.toString())||"15000",pv_ladeanteil_prozent:((L=j.pv_ladeanteil_prozent)==null?void 0:L.toString())||"60",vergleich_verbrauch_l_100km:((R=j.vergleich_verbrauch_l_100km)==null?void 0:R.toString())||"7.5",benzinpreis_euro:((X=j.benzinpreis_euro)==null?void 0:X.toString())||"1.65",v2h_faehig:j.v2h_faehig??!1,v2h_entladeleistung_kw:((O=j.v2h_entladeleistung_kw)==null?void 0:O.toString())||""};case"speicher":return{...z,kapazitaet_kwh:((B=j.kapazitaet_kwh)==null?void 0:B.toString())||"",nutzbare_kapazitaet_kwh:((G=j.nutzbare_kapazitaet_kwh)==null?void 0:G.toString())||"",max_ladeleistung_kw:((T=j.max_ladeleistung_kw)==null?void 0:T.toString())||"",max_entladeleistung_kw:((q=j.max_entladeleistung_kw)==null?void 0:q.toString())||"",wirkungsgrad_prozent:((re=j.wirkungsgrad_prozent)==null?void 0:re.toString())||"95",arbitrage_faehig:j.arbitrage_faehig??!1};case"waermepumpe":return{...z,leistung_kw:((de=j.leistung_kw)==null?void 0:de.toString())||"",effizienz_modus:((ue=j.effizienz_modus)==null?void 0:ue.toString())||"gesamt_jaz",jaz:((ee=j.jaz)==null?void 0:ee.toString())||"3.5",scop_heizung:((pe=j.scop_heizung)==null?void 0:pe.toString())||"4.5",scop_warmwasser:((Be=j.scop_warmwasser)==null?void 0:Be.toString())||"3.2",vorlauftemperatur:((ie=j.vorlauftemperatur)==null?void 0:ie.toString())||"35",cop_heizung:((se=j.cop_heizung)==null?void 0:se.toString())||"3.9",cop_warmwasser:((K=j.cop_warmwasser)==null?void 0:K.toString())||"3.0",heizwaermebedarf_kwh:((Q=j.heizwaermebedarf_kwh)==null?void 0:Q.toString())||"12000",warmwasserbedarf_kwh:((ce=j.warmwasserbedarf_kwh)==null?void 0:ce.toString())||"3000",pv_anteil_prozent:((Ee=j.pv_anteil_prozent)==null?void 0:Ee.toString())||"30",alter_energietraeger:((te=j.alter_energietraeger)==null?void 0:te.toString())||"gas",alter_preis_cent_kwh:((U=j.alter_preis_cent_kwh)==null?void 0:U.toString())||"12",sg_ready:j.sg_ready??!1};case"wallbox":return{...z,max_ladeleistung_kw:((je=j.max_ladeleistung_kw)==null?void 0:je.toString())||"11",bidirektional:j.bidirektional??!1,pv_optimiert:j.pv_optimiert??!0};case"wechselrichter":return{...z,max_leistung_kw:((Pe=j.max_leistung_kw)==null?void 0:Pe.toString())||"",wirkungsgrad_prozent:((Ae=j.wirkungsgrad_prozent)==null?void 0:Ae.toString())||"97",hybrid:j.hybrid??!1};case"pv-module":return{...z,anzahl_module:((It=j.anzahl_module)==null?void 0:It.toString())||"",modul_leistung_wp:((H=j.modul_leistung_wp)==null?void 0:H.toString())||"",modul_typ:((fe=j.modul_typ)==null?void 0:fe.toString())||""};case"balkonkraftwerk":return{...z,leistung_wp:((Oe=j.leistung_wp)==null?void 0:Oe.toString())||"",anzahl:((Ke=j.anzahl)==null?void 0:Ke.toString())||"2",ausrichtung:((Ie=j.ausrichtung)==null?void 0:Ie.toString())||"Süd",neigung_grad:((dt=j.neigung_grad)==null?void 0:dt.toString())||"30",hat_speicher:j.hat_speicher??!1,speicher_kapazitaet_wh:((Ea=j.speicher_kapazitaet_wh)==null?void 0:Ea.toString())||""};case"sonstiges":return{...z,kategorie:((ks=j.kategorie)==null?void 0:ks.toString())||"erzeuger",beschreibung:((Ll=j.beschreibung)==null?void 0:Ll.toString())||""};default:return z}},[_,v]=m.useState(w),S=z=>{const{name:A,value:P,type:E,checked:L}=z.target;if(A.startsWith("param_")){const R=A.replace("param_","");v(X=>({...X,[R]:E==="checkbox"?L:P}))}else p(R=>({...R,[A]:E==="checkbox"?L:P}))},V=async z=>{if(z.preventDefault(),g(null),!b.bezeichnung.trim()){g("Bitte eine Bezeichnung eingeben");return}try{c(!0);const A=["stamm_garantie_bis","stamm_erstzulassung","wartung_gueltig_bis","stamm_anmeldung_netzbetreiber","stamm_anmeldung_marktstammdaten"],P={};if(Object.entries(_).forEach(([O,B])=>{if(typeof B=="boolean")P[O]=B;else if(B!=="")if(A.includes(O))P[O]=B;else{const G=parseFloat(B);P[O]=isNaN(G)?B:G}}),f&&l.length>0&&!b.parent_investition_id){g(`${Gn[a]} müssen einem ${zs[y]||y} zugeordnet werden`);return}let E,L,R;if(a==="balkonkraftwerk"){const O=parseInt(_.anzahl)||0,B=parseInt(_.leistung_wp)||0;O>0&&B>0&&(E=O*B/1e3),L=_.ausrichtung||void 0,R=_.neigung_grad?parseFloat(_.neigung_grad):void 0}const X={...t?{}:{anlage_id:r,typ:a},bezeichnung:b.bezeichnung.trim(),anschaffungsdatum:b.anschaffungsdatum||void 0,anschaffungskosten_gesamt:b.anschaffungskosten_gesamt?parseFloat(b.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:b.anschaffungskosten_alternativ?parseFloat(b.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:b.betriebskosten_jahr?parseFloat(b.betriebskosten_jahr):void 0,aktiv:b.aktiv,parameter:Object.keys(P).length>0?P:void 0,parent_investition_id:b.parent_investition_id?parseInt(b.parent_investition_id):void 0,...a==="pv-module"&&{leistung_kwp:b.leistung_kwp?parseFloat(b.leistung_kwp):void 0,ausrichtung:b.ausrichtung||void 0,neigung_grad:b.neigung_grad?parseFloat(b.neigung_grad):void 0,ha_entity_id:b.ha_entity_id||void 0},...a==="balkonkraftwerk"&&{leistung_kwp:E,ausrichtung:L,neigung_grad:R}};await n(X)}catch(A){g(A instanceof Error?A.message:"Fehler beim Speichern")}finally{c(!1)}};return e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[h&&e.jsx(ae,{type:"error",children:h}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Bezeichnung",name:"bezeichnung",value:b.bezeichnung,onChange:S,required:!0}),e.jsx(J,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:b.anschaffungsdatum,onChange:S}),e.jsx(J,{label:"Anschaffungskosten (€)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:b.anschaffungskosten_gesamt,onChange:S,hint:"Gesamtkosten inkl. Installation"}),e.jsx(J,{label:"Alternative Kosten (€)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:b.anschaffungskosten_alternativ,onChange:S,hint:v0[a]}),e.jsx(J,{label:"Betriebskosten/Jahr (€)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:b.betriebskosten_jahr,onChange:S,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:b.aktiv,onChange:S,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen berücksichtigen)"})]})]}),y&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",zs[y]||y,")",f?" *":" (optional)",x&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),l.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:b.parent_investition_id,onChange:z=>p(A=>({...A,parent_investition_id:z.target.value})),className:`input w-full ${f&&!b.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:f,children:[e.jsx("option",{value:"",children:f?"-- Bitte wählen --":"-- Keine Zuordnung --"}),l.map(z=>e.jsx("option",{value:z.id,children:z.bezeichnung},z.id))]}),f&&!b.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(nt,{className:"w-4 h-4"}),a==="pv-module"?"PV-Module müssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):x?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0"}),f?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:zs[y]||y})," an, bevor Sie ",Gn[a]," erstellen können."]}):e.jsxs("span",{children:["Kein ",zs[y]||y," vorhanden. Zuordnung ist optional."]})]})})]})]}),a==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:b.leistung_kwp,onChange:S,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:b.ausrichtung,onChange:z=>p(A=>({...A,ausrichtung:z.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(J,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:b.neigung_grad,onChange:S,hint:"0° = flach, 90° = senkrecht"})]})]}),e.jsx(N0,{typ:a,paramData:_,onChange:S}),e.jsx(b0,{typ:a,paramData:_,onChange:S,anlage:s,hasParent:!!b.parent_investition_id}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(he,{type:"button",variant:"secondary",onClick:i,children:"Abbrechen"}),e.jsx(he,{type:"submit",loading:o,children:t?"Speichern":"Erstellen"})]})]})}function N0({typ:t,paramData:r,onChange:a}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Batteriekapazität (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.batteriekapazitaet_kwh,onChange:a}),e.jsx(J,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:r.verbrauch_kwh_100km,onChange:a}),e.jsx(J,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:r.jahresfahrleistung_km,onChange:a}),e.jsx(J,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_ladeanteil_prozent,onChange:a,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:r.vergleich_verbrauch_l_100km,onChange:a,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(J,{label:"Benzinpreis (€/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:r.benzinpreis_euro,onChange:a,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:r.v2h_faehig,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fähig (Vehicle-to-Home)"})]}),r.v2h_faehig&&e.jsx(J,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.v2h_entladeleistung_kw,onChange:a})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Kapazität (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.kapazitaet_kwh,onChange:a}),e.jsx(J,{label:"Nutzbare Kapazität (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.nutzbare_kapazitaet_kwh,onChange:a,hint:"Typisch 90-95% der Gesamtkapazität"}),e.jsx(J,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:a}),e.jsx(J,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_entladeleistung_kw,onChange:a}),e.jsx(J,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:r.arbitrage_faehig,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fähig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":{const n=r.effizienz_modus;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wärmepumpe Parameter"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Berechnungsmodus für Effizienz"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"gesamt_jaz",checked:n==="gesamt_jaz",onChange:a,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Jahresarbeitszahl (JAZ) - Gemessen vor Ort"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"scop",checked:n==="scop",onChange:a,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"SCOP (EU-Energielabel) - Aus Datenblatt"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"getrennte_cops",checked:n==="getrennte_cops",onChange:a,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Getrennte COPs (Heizung/Warmwasser)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n==="getrennte_cops"?"Separate COPs für Heizung (~3,9) und Warmwasser (~3,0) - präziser bei unterschiedlichen Betriebspunkten":n==="scop"?"EU-genormter SCOP vom Energielabel - realistischer als Hersteller-COP, aber standortunabhängig":"Gemessene Jahresarbeitszahl am eigenen Standort - der genaueste Wert, wenn verfügbar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:r.leistung_kw,onChange:a,hint:"Thermische Leistung"}),n==="gesamt_jaz"&&e.jsx(J,{label:"Jahresarbeitszahl (JAZ)",name:"param_jaz",type:"number",step:"0.1",min:"1",max:"10",value:r.jaz,onChange:a,hint:"Typisch 3-4 für Luft-WP, 4-5 für Sole-WP",required:!0}),n==="scop"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{label:"SCOP Heizung",name:"param_scop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.scop_heizung,onChange:a,hint:"Vom EU-Energielabel (z.B. 4,5)",required:!0}),e.jsx(J,{label:"SCOP Warmwasser",name:"param_scop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.scop_warmwasser,onChange:a,hint:"Typisch 2,8-3,5",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vorlauftemperatur (EU-Label)"}),e.jsxs("select",{name:"param_vorlauftemperatur",value:r.vorlauftemperatur,onChange:i=>a({target:{name:"param_vorlauftemperatur",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"35",children:"35°C (Fußbodenheizung)"}),e.jsx("option",{value:"55",children:"55°C (Heizkörper)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SCOP-Wert muss zur Vorlauftemperatur passen"})]})]}),n==="getrennte_cops"&&e.jsxs(e.Fragment,{children:[e.jsx(J,{label:"COP Heizung",name:"param_cop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_heizung,onChange:a,hint:"Typisch 3,5-4,5 (Vorlauf 35°C)",required:!0}),e.jsx(J,{label:"COP Warmwasser",name:"param_cop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_warmwasser,onChange:a,hint:"Typisch 2,5-3,5 (Vorlauf 55°C)",required:!0})]}),e.jsx(J,{label:"Heizwärmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:r.heizwaermebedarf_kwh,onChange:a,hint:"Aus Energieausweis oder Schätzung"}),e.jsx(J,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:r.warmwasserbedarf_kwh,onChange:a,hint:"~500 kWh/Person/Jahr typisch"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Vergleich mit alter Heizung (für ROI-Berechnung)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Alter Energieträger"}),e.jsxs("select",{name:"param_alter_energietraeger",value:r.alter_energietraeger,onChange:i=>a({target:{name:"param_alter_energietraeger",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"gas",children:"Erdgas"}),e.jsx("option",{value:"oel",children:"Heizöl"}),e.jsx("option",{value:"strom",children:"Strom (Direktheizung)"})]})]}),e.jsx(J,{label:"Alter Preis (ct/kWh)",name:"param_alter_preis_cent_kwh",type:"number",step:"0.1",min:"0",value:r.alter_preis_cent_kwh,onChange:a,hint:"Gas ~12 ct, Öl ~10 ct"}),e.jsx(J,{label:"PV-Anteil (%)",name:"param_pv_anteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_anteil_prozent,onChange:a,hint:"Anteil des WP-Stroms aus PV"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:r.sg_ready,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fähig)"})]})]})}case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(J,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:a,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:r.bidirektional,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:r.pv_optimiert,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-Überschussladen möglich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:r.max_leistung_kw,onChange:a}),e.jsx(J,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:r.hybrid,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:r.anzahl_module,onChange:a,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(J,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:r.modul_leistung_wp,onChange:a,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(J,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:r.modul_typ,onChange:a,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),r.anzahl_module&&r.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(r.anzahl_module)||0)*(parseInt(r.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const s=(parseInt(r.anzahl)||0)*(parseInt(r.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:r.anzahl,onChange:a}),e.jsx(J,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:r.leistung_wp,onChange:a,hint:s>0?`= ${s.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:r.ausrichtung,onChange:n=>a({target:{name:"param_ausrichtung",value:n.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(J,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:r.neigung_grad,onChange:a,hint:"0° = flach, 90° = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:r.hat_speicher,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),r.hat_speicher&&e.jsx(J,{label:"Speicher-Kapazität (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:r.speicher_kapazitaet_wh,onChange:a,hint:"z.B. 1600 Wh für Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:r.kategorie,onChange:n=>a({target:{name:"param_kategorie",value:n.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(J,{label:"Beschreibung",name:"param_beschreibung",value:r.beschreibung,onChange:a,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const Zn=[{typ:"e-auto",label:"E-Auto",icon:Ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wärmepumpe",icon:Qe,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:Fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:Kt,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:Vr,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:oe,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:zc,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:Vr,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function _0(){var F;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(null),[n,i]=m.useState(!1),[o,c]=m.useState(null),[h,g]=m.useState(null),[l,u]=m.useState(null),[x,d]=m.useState(null),b=a??((F=t[0])==null?void 0:F.id),p=t.find(M=>M.id===b)??null,{investitionen:y,loading:f,createInvestition:j,updateInvestition:k,deleteInvestition:w}=ds(b),_=kg(y),v=m.useMemo(()=>{const M={};return Zn.forEach(W=>{var N;M[W.typ]=((N=_[W.typ])==null?void 0:N.length)||0}),M},[_]),S=M=>{g(M),c(null),i(!0)},V=M=>{c(M),g(M.typ),i(!0)},C=async M=>{try{o?await k(o.id,M):await j(M),i(!1),c(null),g(null)}catch(W){d(W instanceof Error?W.message:"Fehler beim Speichern")}},I=async()=>{if(l)try{await w(l.id),u(null)}catch(M){d(M instanceof Error?M.message:"Fehler beim Löschen")}};return r||f?e.jsx(Me,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:b??"",onChange:M=>s(Number(M.target.value)),className:"input w-auto",children:t.map(M=>e.jsx("option",{value:M.id,children:M.anlagenname},M.id))})})]}),x&&e.jsx(ae,{type:"error",onClose:()=>d(null),children:x}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Zn.map(M=>e.jsxs("button",{onClick:()=>S(M.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${M.bgColor}`,children:[e.jsx(M.icon,{className:`h-8 w-8 mx-auto ${M.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:M.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[v[M.typ]," vorhanden"]})]},M.typ))}),y.length===0?e.jsx(ka,{icon:Yr,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wärmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(he,{onClick:()=>S("speicher"),children:[e.jsx(Sr,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:Zn.map(M=>{const W=_[M.typ];return!W||W.length===0?null:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${M.bgColor}`,children:e.jsx(M.icon,{className:`h-5 w-5 ${M.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:M.label})]}),e.jsx(he,{variant:"secondary",size:"sm",onClick:()=>S(M.typ),children:e.jsx(Sr,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:W.map(N=>e.jsx(z0,{investition:N,onEdit:()=>V(N),onDelete:()=>u(N)},N.id))})]},M.typ)})}),e.jsx(Ot,{isOpen:n,onClose:()=>{i(!1),c(null),g(null)},title:o?"Investition bearbeiten":"Neue Investition",size:"lg",children:h&&b&&e.jsx(w0,{investition:o,anlageId:b,typ:h,anlage:p,onSubmit:C,onCancel:()=>{i(!1),c(null),g(null)}})}),e.jsxs(Ot,{isOpen:!!l,onClose:()=>u(null),title:"Investition löschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Möchtest du die Investition "',l==null?void 0:l.bezeichnung,'" wirklich löschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(he,{variant:"secondary",onClick:()=>u(null),children:"Abbrechen"}),e.jsx(he,{variant:"danger",onClick:I,children:"Löschen"})]})]})]})}function z0({investition:t,onEdit:r,onDelete:a}){const s=t.parameter||{},i=(()=>{const c=[];switch(t.typ){case"e-auto":s.batteriekapazitaet_kwh&&c.push(`${s.batteriekapazitaet_kwh} kWh Batterie`),s.verbrauch_kwh_100km&&c.push(`${s.verbrauch_kwh_100km} kWh/100km`),s.v2h_faehig&&c.push("V2H fähig");break;case"speicher":s.kapazitaet_kwh&&c.push(`${s.kapazitaet_kwh} kWh`),s.nutzbare_kapazitaet_kwh&&c.push(`${s.nutzbare_kapazitaet_kwh} kWh nutzbar`),s.arbitrage_faehig&&c.push("Arbitrage");break;case"waermepumpe":s.leistung_kw&&c.push(`${s.leistung_kw} kW`),s.cop&&c.push(`COP ${s.cop}`);break;case"wallbox":s.max_ladeleistung_kw&&c.push(`${s.max_ladeleistung_kw} kW`),s.bidirektional&&c.push("Bidirektional");break;case"wechselrichter":s.max_leistung_kw&&c.push(`${s.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":s.leistung_wp&&c.push(`${s.leistung_wp} Wp`),s.anzahl&&c.push(`${s.anzahl} Module`);break}return c})(),o=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join(" • ")}),o&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[o.toLocaleString("de-DE")," €"]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(Hh,{className:"h-4 w-4"})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Löschen",children:e.jsx(Pt,{className:"h-4 w-4"})})]})]})}const S0=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"März"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function ao({monatsdaten:t,anlageId:r,onSubmit:a,onCancel:s,haVorausfuellung:n}){var O,B,G,T,q,re,de,ue,ee,pe,Be;const i=new Date().getFullYear(),o=new Date().getMonth()+1,[c,h]=m.useState(!1),[g,l]=m.useState(null),{investitionen:u,loading:x}=ds(r),d=m.useMemo(()=>u.filter(ie=>ie.aktiv),[u]),b=d.some(ie=>ie.typ==="speicher"),p=d.some(ie=>ie.typ==="e-auto"),y=d.some(ie=>ie.typ==="wallbox"),f=d.some(ie=>ie.typ==="waermepumpe"),j=d.some(ie=>ie.typ==="wechselrichter"),k=d.some(ie=>ie.typ==="pv-module"),w=d.some(ie=>ie.typ==="balkonkraftwerk"),_=d.some(ie=>ie.typ==="sonstiges"),v=ie=>{if(!n)return"";const se=n.basis.find(K=>K.feld===ie);return(se==null?void 0:se.wert)!==null&&(se==null?void 0:se.wert)!==void 0?se.wert.toString():""},[S,V]=m.useState({jahr:((O=n==null?void 0:n.jahr)==null?void 0:O.toString())||((B=t==null?void 0:t.jahr)==null?void 0:B.toString())||i.toString(),monat:((G=n==null?void 0:n.monat)==null?void 0:G.toString())||((T=t==null?void 0:t.monat)==null?void 0:T.toString())||o.toString(),einspeisung_kwh:v("einspeisung")||((q=t==null?void 0:t.einspeisung_kwh)==null?void 0:q.toString())||"",netzbezug_kwh:v("netzbezug")||((re=t==null?void 0:t.netzbezug_kwh)==null?void 0:re.toString())||"",pv_erzeugung_kwh:((de=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:de.toString())||"",batterie_ladung_kwh:((ue=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:ue.toString())||"",batterie_entladung_kwh:((ee=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:ee.toString())||"",globalstrahlung_kwh_m2:((pe=t==null?void 0:t.globalstrahlung_kwh_m2)==null?void 0:pe.toString())||"",sonnenstunden:((Be=t==null?void 0:t.sonnenstunden)==null?void 0:Be.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[C,I]=m.useState(!1),[F,M]=m.useState(null),[W,N]=m.useState({}),[z,A]=m.useState(!1);m.useEffect(()=>{if(d.length===0)return;(async()=>{const se={};if(d.forEach(K=>{var Q,ce;if(K.typ==="e-auto")se[K.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(K.typ==="speicher")se[K.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(K.typ==="wallbox")se[K.id]={ladung_kwh:"",ladevorgaenge:""};else if(K.typ==="waermepumpe")se[K.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(K.typ==="wechselrichter")se[K.id]={pv_erzeugung_kwh:""};else if(K.typ==="pv-module")se[K.id]={pv_erzeugung_kwh:""};else if(K.typ==="balkonkraftwerk"){const Ee=(Q=K.parameter)==null?void 0:Q.hat_speicher,te={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};Ee?se[K.id]={...te,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:se[K.id]=te}else if(K.typ==="sonstiges"){const Ee=((ce=K.parameter)==null?void 0:ce.kategorie)||"erzeuger";Ee==="erzeuger"?se[K.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:Ee==="verbraucher"?se[K.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:Ee==="speicher"&&(se[K.id]={ladung_kwh:"",entladung_kwh:""})}se[K.id]&&(se[K.id].sonderkosten_euro="",se[K.id].sonderkosten_notiz="")}),t!=null&&t.jahr&&(t!=null&&t.monat)){A(!0);try{const K=await et.getMonatsdatenByMonth(r,t.jahr,t.monat);K.forEach(U=>{const je=String(U.investition_id);se[je]&&U.verbrauch_daten&&Object.entries(U.verbrauch_daten).forEach(([Pe,Ae])=>{se[je][Pe]!==void 0&&(se[je][Pe]=(Ae==null?void 0:Ae.toString())||""),Pe==="v2h_entladung_kwh"&&se[je].entladung_v2h_kwh!==void 0&&(se[je].entladung_v2h_kwh=(Ae==null?void 0:Ae.toString())||""),Pe==="erzeugung_kwh"&&se[je].pv_erzeugung_kwh!==void 0&&(se[je].pv_erzeugung_kwh=(Ae==null?void 0:Ae.toString())||""),Pe==="verbrauch_kwh"&&se[je].verbrauch_sonstig_kwh!==void 0&&(se[je].verbrauch_sonstig_kwh=(Ae==null?void 0:Ae.toString())||"")})});const Q=d.filter(U=>U.typ==="speicher"),ce=new Set(K.filter(U=>Q.some(je=>je.id===U.investition_id)).map(U=>U.investition_id)),Ee=(t==null?void 0:t.batterie_ladung_kwh)||0,te=(t==null?void 0:t.batterie_entladung_kwh)||0;if(Q.length>0&&(Ee>0||te>0)){const U=Q.filter(je=>!ce.has(je.id));if(U.length>0){const je=1/U.length;U.forEach(Pe=>{const Ae=String(Pe.id);se[Ae]&&(se[Ae].ladung_kwh=(Ee*je).toFixed(1),se[Ae].entladung_kwh=(te*je).toFixed(1))}),console.info(`Migration: Legacy-Speicherdaten (${Ee}/${te} kWh) auf ${U.length} Speicher übertragen`)}}}catch(K){console.error("Fehler beim Laden der InvestitionMonatsdaten:",K)}finally{A(!1)}}n!=null&&n.investitionen&&(n.investitionen.forEach(K=>{const Q=String(K.investition_id);se[Q]&&K.felder.forEach(({feld:ce,wert:Ee})=>{Ee!=null&&(se[Q][ce]!==void 0&&(se[Q][ce]=Ee.toString()),ce==="pv_erzeugung_kwh"&&se[Q].pv_erzeugung_kwh!==void 0&&(se[Q].pv_erzeugung_kwh=Ee.toString()),ce==="ladung_kwh"&&se[Q].ladung_kwh!==void 0&&(se[Q].ladung_kwh=Ee.toString()),ce==="entladung_kwh"&&se[Q].entladung_kwh!==void 0&&(se[Q].entladung_kwh=Ee.toString()),ce==="ladung_pv_kwh"&&se[Q].ladung_pv_kwh!==void 0&&(se[Q].ladung_pv_kwh=Ee.toString()),ce==="ladung_netz_kwh"&&se[Q].ladung_netz_kwh!==void 0&&(se[Q].ladung_netz_kwh=Ee.toString()),ce==="km_gefahren"&&se[Q].km_gefahren!==void 0&&(se[Q].km_gefahren=Ee.toString()))})}),console.info("HA-Vorausfüllung: Investitionswerte aus HA-Statistik eingefügt")),N(se)})()},[d,t==null?void 0:t.jahr,t==null?void 0:t.monat,r,n]);const P=ie=>{const{name:se,value:K}=ie.target;V(Q=>({...Q,[se]:K}))},E=(ie,se,K)=>{N(Q=>({...Q,[ie]:{...Q[ie],[se]:K}}))},L=m.useMemo(()=>{let ie=0,se=0,K=0;return d.forEach(Q=>{var Ee,te;const ce=W[Q.id];ce&&(Q.typ==="speicher"?(ie+=parseFloat(ce.ladung_kwh)||0,se+=parseFloat(ce.entladung_kwh)||0):Q.typ==="pv-module"||Q.typ==="wechselrichter"||Q.typ==="balkonkraftwerk"?(K+=parseFloat(ce.pv_erzeugung_kwh)||0,Q.typ==="balkonkraftwerk"&&((Ee=Q.parameter)!=null&&Ee.hat_speicher)&&(ie+=parseFloat(ce.speicher_ladung_kwh)||0,se+=parseFloat(ce.speicher_entladung_kwh)||0)):Q.typ==="sonstiges"&&((te=Q.parameter)==null?void 0:te.kategorie)==="erzeuger"&&(K+=parseFloat(ce.erzeugung_kwh)||0))}),{batterieLadung:ie,batterieEntladung:se,pvErzeugung:K}},[d,W]),R=async()=>{if(!S.jahr||!S.monat){l("Bitte zuerst Jahr und Monat auswählen");return}I(!0),M(null),l(null);try{const ie=await $n.getMonatsdaten(r,parseInt(S.jahr),parseInt(S.monat));V(K=>({...K,globalstrahlung_kwh_m2:ie.globalstrahlung_kwh_m2.toString(),sonnenstunden:ie.sonnenstunden.toString()}));const se=ie.datenquelle==="open-meteo"?`Historische Daten von Open-Meteo${ie.abdeckung_prozent?` (${ie.abdeckung_prozent}% Abdeckung)`:""}`:ie.datenquelle==="pvgis-tmy"?"Durchschnittswerte von PVGIS (TMY)":"Geschätzte Durchschnittswerte";M(se)}catch(ie){l(ie instanceof Error?ie.message:"Wetterdaten konnten nicht abgerufen werden")}finally{I(!1)}},X=async ie=>{if(ie.preventDefault(),l(null),!S.einspeisung_kwh||!S.netzbezug_kwh){l("Bitte Einspeisung und Netzbezug eingeben");return}try{h(!0);const se={};d.forEach(Ee=>{const te=W[Ee.id];if(!te)return;const U={};Ee.typ==="e-auto"?(te.km_gefahren&&(U.km_gefahren=parseFloat(te.km_gefahren)),te.verbrauch_kwh&&(U.verbrauch_kwh=parseFloat(te.verbrauch_kwh)),te.ladung_pv_kwh&&(U.ladung_pv_kwh=parseFloat(te.ladung_pv_kwh)),te.ladung_netz_kwh&&(U.ladung_netz_kwh=parseFloat(te.ladung_netz_kwh)),te.ladung_extern_kwh&&(U.ladung_extern_kwh=parseFloat(te.ladung_extern_kwh)),te.ladung_extern_euro&&(U.ladung_extern_euro=parseFloat(te.ladung_extern_euro)),te.entladung_v2h_kwh&&(U.v2h_entladung_kwh=parseFloat(te.entladung_v2h_kwh))):Ee.typ==="speicher"?(te.ladung_kwh&&(U.ladung_kwh=parseFloat(te.ladung_kwh)),te.entladung_kwh&&(U.entladung_kwh=parseFloat(te.entladung_kwh)),te.speicher_ladung_netz_kwh&&(U.speicher_ladung_netz_kwh=parseFloat(te.speicher_ladung_netz_kwh)),te.speicher_ladepreis_cent&&(U.speicher_ladepreis_cent=parseFloat(te.speicher_ladepreis_cent))):Ee.typ==="wallbox"?(te.ladung_kwh&&(U.ladung_kwh=parseFloat(te.ladung_kwh)),te.ladevorgaenge&&(U.ladevorgaenge=parseInt(te.ladevorgaenge))):Ee.typ==="waermepumpe"?(te.stromverbrauch_kwh&&(U.stromverbrauch_kwh=parseFloat(te.stromverbrauch_kwh)),te.heizenergie_kwh&&(U.heizenergie_kwh=parseFloat(te.heizenergie_kwh)),te.warmwasser_kwh&&(U.warmwasser_kwh=parseFloat(te.warmwasser_kwh))):Ee.typ==="wechselrichter"||Ee.typ==="pv-module"?te.pv_erzeugung_kwh&&(U.pv_erzeugung_kwh=parseFloat(te.pv_erzeugung_kwh)):Ee.typ==="balkonkraftwerk"?(te.pv_erzeugung_kwh&&(U.erzeugung_kwh=parseFloat(te.pv_erzeugung_kwh)),te.eigenverbrauch_kwh&&(U.eigenverbrauch_kwh=parseFloat(te.eigenverbrauch_kwh)),te.einspeisung_kwh&&(U.einspeisung_kwh=parseFloat(te.einspeisung_kwh)),te.speicher_ladung_kwh&&(U.speicher_ladung_kwh=parseFloat(te.speicher_ladung_kwh)),te.speicher_entladung_kwh&&(U.speicher_entladung_kwh=parseFloat(te.speicher_entladung_kwh))):Ee.typ==="sonstiges"&&(te.erzeugung_kwh&&(U.erzeugung_kwh=parseFloat(te.erzeugung_kwh)),te.eigenverbrauch_kwh&&(U.eigenverbrauch_kwh=parseFloat(te.eigenverbrauch_kwh)),te.einspeisung_kwh&&(U.einspeisung_kwh=parseFloat(te.einspeisung_kwh)),te.verbrauch_sonstig_kwh&&(U.verbrauch_kwh=parseFloat(te.verbrauch_sonstig_kwh)),te.bezug_pv_kwh&&(U.bezug_pv_kwh=parseFloat(te.bezug_pv_kwh)),te.bezug_netz_kwh&&(U.bezug_netz_kwh=parseFloat(te.bezug_netz_kwh)),te.ladung_kwh&&(U.ladung_kwh=parseFloat(te.ladung_kwh)),te.entladung_kwh&&(U.entladung_kwh=parseFloat(te.entladung_kwh))),te.sonderkosten_euro&&(U.sonderkosten_euro=parseFloat(te.sonderkosten_euro)),te.sonderkosten_notiz&&(U.sonderkosten_notiz=te.sonderkosten_notiz),Object.keys(U).length>0&&(se[Ee.id]=U)});const K=S.batterie_ladung_kwh?parseFloat(S.batterie_ladung_kwh):L.batterieLadung||void 0,Q=S.batterie_entladung_kwh?parseFloat(S.batterie_entladung_kwh):L.batterieEntladung||void 0,ce=S.pv_erzeugung_kwh?parseFloat(S.pv_erzeugung_kwh):L.pvErzeugung||void 0;await a({anlage_id:r,jahr:parseInt(S.jahr),monat:parseInt(S.monat),einspeisung_kwh:parseFloat(S.einspeisung_kwh),netzbezug_kwh:parseFloat(S.netzbezug_kwh),pv_erzeugung_kwh:ce,batterie_ladung_kwh:K,batterie_entladung_kwh:Q,globalstrahlung_kwh_m2:S.globalstrahlung_kwh_m2?parseFloat(S.globalstrahlung_kwh_m2):void 0,sonnenstunden:S.sonnenstunden?parseFloat(S.sonnenstunden):void 0,notizen:S.notizen||void 0,investitionen_daten:Object.keys(se).length>0?se:void 0})}catch(se){l(se instanceof Error?se.message:"Fehler beim Speichern")}finally{h(!1)}};return x||z?e.jsx("div",{className:"text-center py-4 text-gray-500",children:z?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[g&&e.jsx(ae,{type:"error",children:g}),n&&e.jsx(ae,{type:"info",children:"Die Werte wurden aus der Home Assistant Langzeitstatistik geladen. Bitte prüfen Sie die Daten und ergänzen Sie fehlende Werte vor dem Speichern."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:S.jahr,onChange:P,required:!0,disabled:!!t||!!n}),e.jsx(Ht,{label:"Monat",name:"monat",value:S.monat,onChange:P,options:S0,required:!0,disabled:!!t||!!n})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:S.einspeisung_kwh,onChange:P,placeholder:"z.B. 450",required:!0}),e.jsx(J,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:S.netzbezug_kwh,onChange:P,placeholder:"z.B. 120",required:!0}),(k||j)&&L.pvErzeugung>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PV-Erzeugung (berechnet)"}),e.jsx("input",{type:"text",value:`${L.pvErzeugung.toFixed(1)} kWh`,readOnly:!0,disabled:!0,className:"input bg-gray-100 dark:bg-gray-800 cursor-not-allowed"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Aus ",k?"PV-Modulen":"Wechselrichtern",": ",L.pvErzeugung.toFixed(1)," kWh"]})]}):e.jsx(J,{label:k||j?"PV-Erzeugung (aus Modulen unten)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:S.pv_erzeugung_kwh,onChange:P,placeholder:"z.B. 800",hint:k||j?"Wird aus PV-Modulen berechnet":"Manuell eingeben wenn keine PV-Module definiert"})]})]}),k&&e.jsx(Ss,{title:"PV-Module",icon:oe,iconColor:"text-yellow-500",investitionen:d.filter(ie=>ie.typ==="pv-module"),investitionsDaten:W,onInvChange:E,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),j&&!k&&e.jsx(Ss,{title:"Wechselrichter",icon:oe,iconColor:"text-yellow-500",investitionen:d.filter(ie=>ie.typ==="wechselrichter"),investitionsDaten:W,onInvChange:E,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),b&&e.jsxs(e.Fragment,{children:[e.jsx(E0,{investitionen:d.filter(ie=>ie.typ==="speicher"),investitionsDaten:W,onInvChange:E}),(L.batterieLadung>0||L.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",L.batterieLadung.toFixed(1)," kWh | Entladung ",L.batterieEntladung.toFixed(1)," kWh"]})]}),p&&e.jsx(M0,{investitionen:d.filter(ie=>ie.typ==="e-auto"),investitionsDaten:W,onInvChange:E}),y&&e.jsx(Ss,{title:"Wallbox",icon:Kt,iconColor:"text-purple-500",investitionen:d.filter(ie=>ie.typ==="wallbox"),investitionsDaten:W,onInvChange:E,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgänge",unit:"",placeholder:"z.B. 12"}]}),f&&e.jsx(Ss,{title:"Wärmepumpe",icon:Qe,iconColor:"text-orange-500",investitionen:d.filter(ie=>ie.typ==="waermepumpe"),investitionsDaten:W,onInvChange:E,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),w&&e.jsx(W0,{investitionen:d.filter(ie=>ie.typ==="balkonkraftwerk"),investitionsDaten:W,onInvChange:E}),_&&e.jsx(F0,{investitionen:d.filter(ie=>ie.typ==="sonstiges"),investitionsDaten:W,onInvChange:E}),!b&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:S.batterie_ladung_kwh,onChange:P,placeholder:"z.B. 150"}),e.jsx(J,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:S.batterie_entladung_kwh,onChange:P,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Lr,{className:"w-4 h-4"}),"Wetterdaten (optional)"]}),e.jsx(he,{type:"button",variant:"secondary",size:"sm",onClick:R,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 animate-spin mr-1"})," Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Lr,{className:"w-4 h-4 mr-1"})," Auto-Fill"]})})]}),F&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-3 py-2 rounded",children:F}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{label:"Globalstrahlung",name:"globalstrahlung_kwh_m2",type:"number",step:"0.1",min:"0",value:S.globalstrahlung_kwh_m2,onChange:P,placeholder:"z.B. 152",hint:"kWh/m²"}),e.jsx(J,{label:"Sonnenstunden",name:"sonnenstunden",type:"number",step:"0.1",min:"0",value:S.sonnenstunden,onChange:P,placeholder:"z.B. 245",hint:"Stunden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:S.notizen,onChange:P,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(he,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(he,{type:"submit",loading:c,children:t?"Speichern":"Monat erfassen"})]})]})}function E0({investitionen:t,investitionsDaten:r,onInvChange:a}){if(t.length===0)return null;const s=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],n=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:"Ø Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),t.map(i=>{var h;const c=((h=i.parameter)==null?void 0:h.arbitrage_faehig)?[...s,...n]:s;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:c.map(g=>{var l;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[g.label," ",g.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",g.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[i.id])==null?void 0:l[g.key])||"",onChange:u=>a(i.id,g.key,u.target.value),placeholder:g.placeholder,className:"input text-sm py-1.5",title:g.hint}),g.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:g.hint,children:g.hint})]},g.key)})}),e.jsx(gs,{invId:i.id,investitionsDaten:r,onInvChange:a})]},i.id)})]})}function M0({investitionen:t,investitionsDaten:r,onInvChange:a}){if(t.length===0)return null;const s=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"€",placeholder:"z.B. 18.00"}],n={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),t.map(i=>{var h,g;const c=((h=i.parameter)==null?void 0:h.v2h_faehig)||((g=i.parameter)==null?void 0:g.nutzt_v2h)?[...s,n]:s;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:c.map(l=>{var u;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[l.label," ",l.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",l.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[i.id])==null?void 0:u[l.key])||"",onChange:x=>a(i.id,l.key,x.target.value),placeholder:l.placeholder,className:"input text-sm py-1.5",title:l.hint}),l.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:l.hint,children:l.hint})]},l.key)})}),e.jsx(gs,{invId:i.id,investitionsDaten:r,onInvChange:a})]},i.id)})]})}function Ss({title:t,icon:r,iconColor:a,investitionen:s,investitionsDaten:n,onInvChange:i,felder:o}){return s.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`h-5 w-5 ${a}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),s.map(c=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:c.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:o.map(h=>{var g;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[h.label," ",h.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",h.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=n[c.id])==null?void 0:g[h.key])||"",onChange:l=>i(c.id,h.key,l.target.value),placeholder:h.placeholder,className:"input text-sm py-1.5",title:h.hint}),h.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:h.hint,children:h.hint})]},h.key)})}),e.jsx(gs,{invId:c.id,investitionsDaten:n,onInvChange:i})]},c.id))]})}function W0({investitionen:t,investitionsDaten:r,onInvChange:a}){return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),t.map(s=>{var i,o,c,h,g;const n=!!((i=s.parameter)!=null&&i.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[s.bezeichnung,s.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",s.leistung_kwp," kWp)"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:n?"Mit Speicher: Bei Nulleinspeisung entspricht Eigenverbrauch meist der Erzeugung.":"Ohne Speicher: Eigenverbrauch ist der direkt genutzte Anteil (typisch 30-40% der Erzeugung)."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=r[s.id])==null?void 0:o.pv_erzeugung_kwh)||"",onChange:l=>a(s.id,"pv_erzeugung_kwh",l.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((c=r[s.id])==null?void 0:c.eigenverbrauch_kwh)||"",onChange:l=>a(s.id,"eigenverbrauch_kwh",l.target.value),placeholder:n?"z.B. 43 (≈Erzeugung)":"z.B. 15 (30-40%)",className:"input text-sm py-1.5"})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[s.id])==null?void 0:h.speicher_ladung_kwh)||"",onChange:l=>a(s.id,"speicher_ladung_kwh",l.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=r[s.id])==null?void 0:g.speicher_entladung_kwh)||"",onChange:l=>a(s.id,"speicher_entladung_kwh",l.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(gs,{invId:s.id,investitionsDaten:r,onInvChange:a})]},s.id)})]})}function F0({investitionen:t,investitionsDaten:r,onInvChange:a}){if(t.length===0)return null;const s={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Th,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),t.map(n=>{var o,c,h,g,l,u,x,d,b,p;const i=((o=n.parameter)==null?void 0:o.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[s[i]||i,(c=n.parameter)!=null&&c.beschreibung?` - ${String(n.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[i==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[n.id])==null?void 0:h.erzeugung_kwh)||"",onChange:y=>a(n.id,"erzeugung_kwh",y.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=r[n.id])==null?void 0:g.eigenverbrauch_kwh)||"",onChange:y=>a(n.id,"eigenverbrauch_kwh",y.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[n.id])==null?void 0:l.einspeisung_kwh)||"",onChange:y=>a(n.id,"einspeisung_kwh",y.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),i==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[n.id])==null?void 0:u.verbrauch_sonstig_kwh)||"",onChange:y=>a(n.id,"verbrauch_sonstig_kwh",y.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[n.id])==null?void 0:x.bezug_pv_kwh)||"",onChange:y=>a(n.id,"bezug_pv_kwh",y.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=r[n.id])==null?void 0:d.bezug_netz_kwh)||"",onChange:y=>a(n.id,"bezug_netz_kwh",y.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),i==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((b=r[n.id])==null?void 0:b.ladung_kwh)||"",onChange:y=>a(n.id,"ladung_kwh",y.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=r[n.id])==null?void 0:p.entladung_kwh)||"",onChange:y=>a(n.id,"entladung_kwh",y.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(gs,{invId:n.id,investitionsDaten:r,onInvChange:a})]},n.id)})]})}function gs({invId:t,investitionsDaten:r,onInvChange:a}){var o,c,h,g;const s=((o=r[t])==null?void 0:o.sonderkosten_euro)||((c=r[t])==null?void 0:c.sonderkosten_notiz),[n,i]=m.useState(!!s);return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:n?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Sonderkosten ",e.jsx("span",{className:"text-gray-400",children:"(€)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[t])==null?void 0:h.sonderkosten_euro)||"",onChange:l=>a(t,"sonderkosten_euro",l.target.value),placeholder:"z.B. 150",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Beschreibung"}),e.jsx("input",{type:"text",value:((g=r[t])==null?void 0:g.sonderkosten_notiz)||"",onChange:l=>a(t,"sonderkosten_notiz",l.target.value),placeholder:"z.B. Wechselrichter-Reparatur",className:"input text-sm py-1.5"})]})]}):e.jsx("button",{type:"button",onClick:()=>i(!0),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonderkosten erfassen (Reparatur, Wartung, etc.)"})})}const so=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],no={zaehler:{label:"Zählerwerte",color:"bg-blue-500"},komponenten:{label:"Komponenten",color:"bg-amber-500"},berechnet:{label:"Berechnungen",color:"bg-green-500"}},$a=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",group:"zaehler",getValue:t=>t.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",group:"zaehler",getValue:t=>t.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",group:"komponenten",getValue:t=>t.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"speicher_ladung",label:"Speicher Ladung",shortLabel:"Sp.Lad",group:"komponenten",getValue:t=>t.speicher_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"speicher_entladung",label:"Speicher Entladung",shortLabel:"Sp.Entl",group:"komponenten",getValue:t=>t.speicher_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_strom",label:"WP Strom",shortLabel:"WP",group:"komponenten",getValue:t=>t.wp_strom_kwh,format:"kwh",defaultVisible:!1},{key:"wp_heizung",label:"WP Heizung",shortLabel:"WP Hz",group:"komponenten",getValue:t=>t.wp_heizung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_warmwasser",label:"WP Warmwasser",shortLabel:"WP WW",group:"komponenten",getValue:t=>t.wp_warmwasser_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_ladung",label:"E-Auto Ladung",shortLabel:"E-Auto",group:"komponenten",getValue:t=>t.eauto_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_km",label:"E-Auto km",shortLabel:"km",group:"komponenten",getValue:t=>t.eauto_km,defaultVisible:!1},{key:"wallbox_ladung",label:"Wallbox Ladung",shortLabel:"WB",group:"komponenten",getValue:t=>t.wallbox_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",group:"berechnet",getValue:t=>t.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",group:"berechnet",getValue:t=>t.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",group:"berechnet",getValue:t=>t.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",group:"berechnet",getValue:t=>t.autarkie_prozent,format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",group:"berechnet",getValue:t=>t.eigenverbrauchsquote_prozent,format:"percent",defaultVisible:!1}],io="eedc-monatsdaten-columns-v3";function A0(){var Ae,It;const t=pr(),{anlagen:r,loading:a}=it(),[s,n]=m.useState(void 0),{monatsdaten:i,loading:o,error:c,createMonatsdaten:h,updateMonatsdaten:g,deleteMonatsdaten:l}=fg(s);ds(s);const[u,x]=m.useState([]),[d,b]=m.useState(!1),[p,y]=m.useState(!1),[f,j]=m.useState(null),[k,w]=m.useState(null),[_,v]=m.useState(!1),[S,V]=m.useState(!1),[C,I]=m.useState(null),[F,M]=m.useState(!1),[W,N]=m.useState([]),[z,A]=m.useState(!1),[P,E]=m.useState(null),[L,R]=m.useState(new Date().getFullYear()),[X,O]=m.useState(new Date().getMonth()),[B,G]=m.useState(null),[T,q]=m.useState(!1),[re,de]=m.useState(null),[ue,ee]=m.useState(()=>{try{const H=localStorage.getItem(io);if(H)return new Set(JSON.parse(H))}catch{}return new Set($a.filter(H=>H.defaultVisible).map(H=>H.key))});m.useEffect(()=>{localStorage.setItem(io,JSON.stringify([...ue]))},[ue]),m.useEffect(()=>{if(!s)return;(async()=>{b(!0);try{const fe=await Pr.listAggregiert(s);x(fe)}catch(fe){console.error("Fehler beim Laden der aggregierten Daten:",fe)}finally{b(!1)}})()},[s,i]),m.useEffect(()=>{if(F)return;(async()=>{try{const fe=await ur.getStatus();I(fe.verfuegbar)}catch{I(!1)}finally{M(!0)}})()},[F]),m.useEffect(()=>{if(!S||!s)return;(async()=>{A(!0),E(null);try{const fe=await ur.getVerfuegbareMonate(s);N(fe)}catch(fe){E("Fehler beim Laden der verfügbaren Monate"),console.error(fe)}finally{A(!1)}})()},[S,s]);const pe=async()=>{if(!(!s||!L||!X)){A(!0),E(null);try{const H=await ur.getMonatswerte(s,L,X),fe=i.find(Oe=>Oe.jahr===L&&Oe.monat===X);if(fe){const Oe=await et.getMonatsdatenByMonth(s,L,X);de({haWerte:H,vorhandeneDaten:fe,vorhandeneInvestitionsDaten:Oe}),V(!1),q(!0)}else G(H),V(!1),y(!0)}catch(H){E("Fehler beim Laden der Monatswerte aus HA-Statistik"),console.error(H)}finally{A(!1)}}},Be=()=>{re&&(G(re.haWerte),j(re.vorhandeneDaten),q(!1),de(null))},ie=()=>{q(!1),de(null)},se=H=>{ee(fe=>{const Oe=new Set(fe);return Oe.has(H)?Oe.delete(H):Oe.add(H),Oe})},K=H=>{const fe=$a.filter(Ke=>Ke.group===H),Oe=fe.every(Ke=>ue.has(Ke.key));ee(Ke=>{const Ie=new Set(Ke);return fe.forEach(dt=>{Oe?Ie.delete(dt.key):Ie.add(dt.key)}),Ie})},Q=$a.filter(H=>ue.has(H.key));!s&&r.length>0&&!a&&n(r[0].id);const ce=m.useMemo(()=>u.filter(H=>H.hat_legacy_daten).length,[u]),Ee=async H=>{await h(H),y(!1)},te=async H=>{f&&(await g(f.id,H),j(null))},U=async()=>{k&&(await l(k.id),w(null))},je=H=>i.find(fe=>fe.id===H.id),Pe=(H,fe)=>{if(H==null||isNaN(H))return"-";switch(fe){case"kwh":return H.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${H.toFixed(1)}%`;default:return H.toLocaleString("de-DE",{maximumFractionDigits:1})}};return a||o?e.jsx(Me,{text:"Lade Daten..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx($,{children:e.jsx(ka,{icon:nt,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(he,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ht,{value:(s==null?void 0:s.toString())||"",onChange:H=>n(parseInt(H.target.value)),options:r.map(H=>({value:H.id.toString(),label:H.anlagenname}))}),C&&e.jsxs(he,{variant:"secondary",onClick:()=>V(!0),children:[e.jsx(Jr,{className:"h-5 w-5 mr-2"}),"Aus HA laden"]}),e.jsxs(he,{onClick:()=>{G(null),y(!0)},children:[e.jsx(Sr,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),c&&e.jsx(ae,{type:"error",children:c}),ce>0&&e.jsxs(ae,{type:"warning",className:"flex items-start gap-3",children:[e.jsx(ft,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Legacy-Daten gefunden"}),e.jsxs("p",{className:"text-sm mt-1",children:[ce," Monat",ce>1?"e":""," enthält",ce>1?"en":""," Daten im alten Format (PV-Erzeugung/Speicher in Monatsdaten statt InvestitionMonatsdaten). Bitte jeden betroffenen Monat einmal öffnen und speichern."]})]})]}),d?e.jsx(Me,{text:"Lade aggregierte Daten..."}):u.length===0?e.jsx($,{children:e.jsx(ka,{icon:Mt,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(he,{onClick:()=>y(!0),children:"Manuell erfassen"}),e.jsx(he,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(he,{variant:"secondary",size:"sm",onClick:()=>v(!_),children:[e.jsx(Lh,{className:"h-4 w-4 mr-2"}),"Spalten (",Q.length,"/",$a.length,")"]})}),_&&e.jsxs($,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"space-y-4",children:Object.keys(no).map(H=>{const fe=no[H],Oe=$a.filter(Ie=>Ie.group===H),Ke=Oe.filter(Ie=>ue.has(Ie.key)).length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${fe.color}`}),e.jsxs("button",{onClick:()=>K(H),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600",children:[fe.label," (",Ke,"/",Oe.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-5",children:Oe.map(Ie=>e.jsx("button",{onClick:()=>se(Ie.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${ue.has(Ie.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:Ie.label},Ie.key))})]},H)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"Klicke auf Gruppen-Namen um alle Spalten ein-/auszublenden, oder auf einzelne Spalten."})]}),e.jsx($,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Qi,{children:[e.jsx(el,{children:e.jsxs(ja,{children:[e.jsx(yt,{children:"Monat"}),Q.map(H=>e.jsxs(yt,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:H.label}),e.jsx("span",{className:"sm:hidden",children:H.shortLabel||H.label})]},H.key)),e.jsx(yt,{className:"text-right",children:"Aktionen"})]})}),e.jsx(tl,{children:u.map(H=>e.jsxs(ja,{className:H.hat_legacy_daten?"bg-amber-50 dark:bg-amber-900/10":"",children:[e.jsxs(jt,{children:[e.jsxs("span",{className:"font-medium",children:[so[H.monat]," ",H.jahr]}),H.hat_legacy_daten&&e.jsx("span",{title:"Legacy-Daten",children:e.jsx(ft,{className:"h-3 w-3 text-amber-500 inline ml-1"})})]}),Q.map(fe=>{const Oe=fe.getValue(H);return e.jsx(jt,{className:`text-right font-mono ${fe.className||""}`,children:Pe(Oe,fe.format)},fe.key)}),e.jsx(jt,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>{const fe=je(H);fe&&j(fe)},children:e.jsx(Xi,{className:"h-4 w-4"})}),e.jsx(he,{variant:"ghost",size:"sm",onClick:()=>{const fe=je(H);fe&&w(fe)},children:e.jsx(Pt,{className:"h-4 w-4 text-red-500"})})]})})]},H.id))})]})})})]}),e.jsx(Ot,{isOpen:S,onClose:()=>V(!1),title:"Monatsdaten aus HA-Statistik laden",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[P&&e.jsx(ae,{type:"error",children:P}),z&&!W.length?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Re,{className:"h-8 w-8 animate-spin text-primary-500"})}):W.length===0?e.jsx(ae,{type:"warning",children:"Keine Daten in HA-Statistik gefunden. Stellen Sie sicher, dass das Sensor-Mapping konfiguriert ist und die Sensoren Langzeit-Statistiken haben."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Wählen Sie einen Monat aus, dessen Daten aus der Home Assistant Langzeitstatistik geladen werden sollen. Die Werte werden im Formular vorausgefüllt und können vor dem Speichern angepasst werden."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Jahr"}),e.jsx("select",{value:L,onChange:H=>R(parseInt(H.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[...new Set(W.map(H=>H.jahr))].sort((H,fe)=>fe-H).map(H=>e.jsx("option",{value:H,children:H},H))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Monat"}),e.jsx("select",{value:X,onChange:H=>O(parseInt(H.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:W.filter(H=>H.jahr===L).sort((H,fe)=>fe.monat-H.monat).map(H=>e.jsxs("option",{value:H.monat,children:[H.monat_name," ",H.hat_daten?"":"(keine Daten)"]},H.monat))})]})]}),i.some(H=>H.jahr===L&&H.monat===X)&&e.jsx(ae,{type:"info",children:"Für diesen Monat existieren bereits Daten. Nach dem Laden wird ein Vergleich angezeigt, damit Sie die Unterschiede prüfen können."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(he,{variant:"secondary",onClick:()=>V(!1),children:"Abbrechen"}),e.jsx(he,{onClick:pe,disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 mr-2 animate-spin"}),"Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"h-4 w-4 mr-2"}),"Werte laden"]})})]})]})]})}),e.jsx(Ot,{isOpen:T,onClose:ie,title:`Vergleich: ${re==null?void 0:re.haWerte.monat_name} ${re==null?void 0:re.haWerte.jahr}`,size:"lg",children:re&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{type:"warning",children:"Für diesen Monat existieren bereits Daten. Bitte prüfen Sie die Unterschiede und entscheiden Sie, ob die HA-Werte übernommen werden sollen."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Werte (kWh)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsxs("tbody",{children:[e.jsx(Es,{label:"Einspeisung",vorhanden:re.vorhandeneDaten.einspeisung_kwh,haWert:(Ae=re.haWerte.basis.find(H=>H.feld==="einspeisung"))==null?void 0:Ae.wert}),e.jsx(Es,{label:"Netzbezug",vorhanden:re.vorhandeneDaten.netzbezug_kwh,haWert:(It=re.haWerte.basis.find(H=>H.feld==="netzbezug"))==null?void 0:It.wert})]})]})})]}),(re.haWerte.investitionen.length>0||re.vorhandeneInvestitionsDaten.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Komponenten-Werte (kWh)"}),re.haWerte.investitionen.map(H=>{const fe=re.vorhandeneInvestitionsDaten.find(Ie=>Ie.investition_id===H.investition_id),Oe=(fe==null?void 0:fe.verbrauch_daten)||{},Ke=new Set;return H.felder.forEach(Ie=>Ke.add(Ie.feld)),Object.keys(Oe).forEach(Ie=>Ke.add(Ie)),e.jsxs("div",{className:"border rounded-lg overflow-hidden dark:border-gray-700",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[H.bezeichnung," (",H.typ,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsx("tbody",{children:[...Ke].map(Ie=>{const dt=H.felder.find(ks=>ks.feld===Ie),Ea=Oe[Ie];return(dt==null?void 0:dt.wert)===null&&Ea===void 0?null:e.jsx(Es,{label:(dt==null?void 0:dt.label)||Ie.replace(/_/g," "),vorhanden:Ea,haWert:dt==null?void 0:dt.wert},Ie)})})]})})]},H.investition_id)}),re.vorhandeneInvestitionsDaten.filter(H=>!re.haWerte.investitionen.some(fe=>fe.investition_id===H.investition_id)).filter(H=>Object.keys(H.verbrauch_daten).length>0).map(H=>e.jsxs("div",{className:"border rounded-lg overflow-hidden dark:border-gray-700 opacity-75",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:["Investition #",H.investition_id," (nur Bestandsdaten, kein HA-Mapping)"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsx("tbody",{children:Object.entries(H.verbrauch_daten).map(([fe,Oe])=>e.jsx(Es,{label:fe.replace(/_/g," "),vorhanden:Oe,haWert:null},fe))})]})})]},H.investition_id))]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(he,{variant:"secondary",onClick:ie,children:"Abbrechen"}),e.jsxs(he,{onClick:Be,children:[e.jsx(Jr,{className:"h-4 w-4 mr-2"}),"Mit HA-Werten fortfahren"]})]})]})}),e.jsx(Ot,{isOpen:p,onClose:()=>{y(!1),G(null)},title:B?`Monatsdaten aus HA laden - ${B.monat_name} ${B.jahr}`:"Monatsdaten erfassen",size:"lg",children:s&&e.jsx(ao,{anlageId:s,onSubmit:Ee,onCancel:()=>{y(!1),G(null)},haVorausfuellung:B})}),e.jsx(Ot,{isOpen:!!f,onClose:()=>{j(null),G(null)},title:B?`HA-Werte übernehmen - ${B.monat_name} ${B.jahr}`:"Monatsdaten bearbeiten",size:"lg",children:f&&s&&e.jsx(ao,{monatsdaten:f,anlageId:s,onSubmit:te,onCancel:()=>{j(null),G(null)},haVorausfuellung:B})}),e.jsx(Ot,{isOpen:!!k,onClose:()=>w(null),title:"Monatsdaten löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Daten für ",e.jsxs("strong",{children:[so[(k==null?void 0:k.monat)||0]," ",k==null?void 0:k.jahr]})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(he,{variant:"secondary",onClick:()=>w(null),children:"Abbrechen"}),e.jsx(he,{variant:"danger",onClick:U,children:"Löschen"})]})]})})]})}function Es({label:t,vorhanden:r,haWert:a}){const s=r??null,n=a??null;let i=null,o="";s!==null&&n!==null&&(i=n-s,Math.abs(i)<.1?o="text-gray-500":i>0?o="text-green-600 dark:text-green-400":o="text-red-600 dark:text-red-400");const c=g=>g!==null?g.toLocaleString("de-DE",{maximumFractionDigits:1}):"–",h=s!==null&&n!==null&&Math.abs(n-s)>.1;return e.jsxs("tr",{className:`border-b dark:border-gray-700 ${h?"bg-amber-50 dark:bg-amber-900/10":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:t}),e.jsx("td",{className:"py-2 px-3 text-right text-blue-600 dark:text-blue-400",children:c(s)}),e.jsx("td",{className:"py-2 px-3 text-right text-green-600 dark:text-green-400 font-medium",children:c(n)}),e.jsx("td",{className:`py-2 px-3 text-right font-medium ${o}`,children:i!==null?(i>=0?"+":"")+i.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"})]})}function lo(){var ue;const{anlagen:t,loading:r,refresh:a}=it(),[s,n]=m.useState(null),[i,o]=m.useState(!1),[c,h]=m.useState(!1),[g,l]=m.useState(null),[u,x]=m.useState(null),[d,b]=m.useState(!1),[p,y]=m.useState(!1),[f,j]=m.useState(null),k=m.useRef(null),[w,_]=m.useState(!1),[v,S]=m.useState(!1),[V,C]=m.useState(null),[I,F]=m.useState(!1),M=m.useRef(null),W=t.some(ee=>ee.anlagenname==="Demo-Anlage"),N=s??((ue=t[0])==null?void 0:ue.id),z=ee=>{ee.preventDefault(),o(!0)},A=ee=>{ee.preventDefault(),o(!1)},P=async ee=>{ee.preventDefault(),o(!1);const pe=ee.dataTransfer.files;pe.length>0&&await L(pe[0])},E=async ee=>{const pe=ee.target.files;pe&&pe.length>0&&await L(pe[0]),k.current&&(k.current.value="")},L=async ee=>{if(!N){x("Bitte zuerst eine Anlage auswählen");return}if(!ee.name.endsWith(".csv")){x("Bitte eine CSV-Datei auswählen");return}x(null),l(null),h(!0);try{const pe=await ir.importCSV(N,ee,d);l(pe)}catch(pe){x(pe instanceof Error?pe.message:"Import fehlgeschlagen")}finally{h(!1)}},R=()=>{if(!N){x("Bitte zuerst eine Anlage auswählen");return}window.location.href=ir.getTemplateDownloadUrl(N)},X=()=>{if(!N){x("Bitte zuerst eine Anlage auswählen");return}window.location.href=ir.getExportUrl(N)},O=async()=>{x(null),j(null),y(!0);try{const ee=await ir.createDemoData();j(ee),a()}catch(ee){x(ee instanceof Error?ee.message:"Fehler beim Erstellen der Demo-Daten")}finally{y(!1)}},B=async()=>{x(null),j(null),y(!0);try{await ir.deleteDemoData(),a()}catch(ee){x(ee instanceof Error?ee.message:"Fehler beim Löschen der Demo-Daten")}finally{y(!1)}},G=ee=>{ee.preventDefault(),_(!0)},T=ee=>{ee.preventDefault(),_(!1)},q=async ee=>{ee.preventDefault(),_(!1);const pe=ee.dataTransfer.files;pe.length>0&&await de(pe[0])},re=async ee=>{const pe=ee.target.files;pe&&pe.length>0&&await de(pe[0]),M.current&&(M.current.value="")},de=async ee=>{if(!ee.name.endsWith(".json")){x("Bitte eine JSON-Datei auswählen");return}x(null),C(null),S(!0);try{const pe=await ir.importJSON(ee,I);C(pe),pe.erfolg&&a()}catch(pe){x(pe instanceof Error?pe.message:"JSON-Import fehlgeschlagen")}finally{S(!1)}};return r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(da,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wärmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(he,{onClick:O,loading:p,className:"w-full",children:[e.jsx(da,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(hr,{className:"inline h-4 w-4 mr-1"}),f.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),t.length>1&&e.jsx("select",{value:N??"",onChange:ee=>n(Number(ee.target.value)),className:"input w-auto",children:t.map(ee=>e.jsx("option",{value:ee.id,children:ee.anlagenname},ee.id))})]}),u&&e.jsx(ae,{type:"error",onClose:()=>x(null),children:u}),g&&e.jsx(C0,{result:g,onClose:()=>l(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(Ur,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthält alle verfügbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(he,{variant:"secondary",className:"w-full",onClick:R,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:z,onDragLeave:A,onDrop:P,onClick:()=>{var ee;return(ee=k.current)==null?void 0:ee.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${c?"opacity-50 pointer-events-none":""}
              `,children:c?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Me,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:k,type:"file",accept:".csv",onChange:E,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:ee=>b(ee.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten überschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(he,{variant:"secondary",size:"sm",onClick:X,children:[e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(da,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:W?"Demo-Anlage ist bereits vorhanden. Du kannst sie löschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),W?e.jsxs(he,{variant:"danger",onClick:B,loading:p,className:"w-full",children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Demo-Anlage löschen"]}):e.jsxs(he,{onClick:O,loading:p,className:"w-full",children:[e.jsx(da,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),f&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(hr,{className:"inline h-4 w-4 mr-1"}),f.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthält:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, Wärmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:e.jsx(Tl,{className:"h-6 w-6 text-purple-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"JSON Import (Anlage wiederherstellen)"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere eine komplette Anlage aus einer JSON-Export-Datei. Alle Investitionen, Monatsdaten, Strompreise und PVGIS-Prognosen werden importiert."}),V&&e.jsx($0,{result:V,onClose:()=>C(null)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:G,onDragLeave:T,onDrop:q,onClick:()=>{var ee;return(ee=M.current)==null?void 0:ee.click()},className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
              ${w?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600 hover:border-purple-500"}
              ${v?"opacity-50 pointer-events-none":""}
            `,children:v?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Me,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Tl,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"JSON-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:M,type:"file",accept:".json",onChange:re,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:ee=>F(ee.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),"Existierende Anlage mit gleichem Namen überschreiben"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"}),' JSON-Dateien können über den "Export (JSON)"-Button in der Anlagen-Übersicht erstellt werden. Bei Namenskonflikt wird automatisch ein Suffix hinzugefügt, es sei denn "Überschreiben" ist aktiviert.']})]}),e.jsxs($,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"💡 Tipp: Template herunterladen"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["Das Template enthält automatisch alle Spalten passend zu deinen angelegten Investitionen (z.B. ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"Sueddach_kWh"}),","," ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"BYD_HVS_Ladung_kWh"}),")."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Pflichtspalten:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Investitions-Spalten (automatisch im Template):"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:["PV-Module: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_kWh"})]}),e.jsxs("li",{children:["Speicher: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Ladung_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Entladung_kWh"})]}),e.jsxs("li",{children:["E-Auto: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_km"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Verbrauch_kWh"}),", etc."]}),e.jsxs("li",{children:["Wärmepumpe: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Strom_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Heizung_kWh"})]})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg mt-2",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200 mb-1",children:"⚠️ Hinweis zu Legacy-Spalten"}),e.jsxs("p",{className:"text-amber-700 dark:text-amber-300 text-xs",children:["Die Spalten ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," und"," ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"Batterie_*_kWh"})," werden nicht mehr unterstützt, wenn PV-Module/Speicher als Investitionen angelegt sind. Verwende stattdessen die individuellen Investitions-Spalten."]})]})]})]})]})}function $0({result:t,onClose:r}){const a=t.fehler.length>0,s=t.warnungen.length>0,n=()=>a?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>a?"text-red-800 dark:text-red-200":s?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",o=()=>a?"text-red-700 dark:text-red-300":s?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300",c=Object.values(t.importiert).reduce((g,l)=>g+l,0),h={strompreise:"Strompreise",investitionen:"Investitionen",investition_monatsdaten:"Investition-Monatsdaten",monatsdaten:"Monatsdaten",pvgis_prognosen:"PVGIS-Prognosen",pvgis_monatsprognosen:"PVGIS-Monatsprognosen"};return e.jsxs("div",{className:`relative p-4 rounded-lg border mb-4 ${n()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Xr,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[a?e.jsx(Xr,{className:"h-5 w-5 text-red-500 mt-0.5"}):s?e.jsx(ft,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(hr,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:a?"Import fehlgeschlagen":s?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[t.erfolg&&t.anlage_name&&e.jsxs("p",{className:o(),children:[e.jsx("strong",{children:"Anlage:"})," ",t.anlage_name]}),c>0&&e.jsxs("div",{className:o(),children:[e.jsx("p",{className:"font-medium",children:"Importierte Datensätze:"}),e.jsx("ul",{className:"list-disc list-inside ml-2",children:Object.entries(t.importiert).filter(([,g])=>g>0).map(([g,l])=>e.jsxs("li",{children:[h[g]||g,": ",l]},g))})]}),a&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((g,l)=>e.jsx("li",{children:g},l)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((g,l)=>e.jsx("li",{children:g},l)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function C0({result:t,onClose:r}){const a=t.fehler.length>0,s=t.warnungen&&t.warnungen.length>0,n=()=>a?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>a?"text-red-800 dark:text-red-200":s?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",o=()=>a?"text-red-700 dark:text-red-300":s?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300";return e.jsxs("div",{className:`relative p-4 rounded-lg border ${n()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Xr,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[a?e.jsx(Xr,{className:"h-5 w-5 text-red-500 mt-0.5"}):s?e.jsx(ft,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(hr,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:a?"Import mit Fehlern":s?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[e.jsxs("p",{className:o(),children:[t.importiert," Datensätze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} übersprungen`]}),a&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((c,h)=>e.jsx("li",{children:c},h)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((c,h)=>e.jsx("li",{children:c},h)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function P0(){const{theme:t,setTheme:r}=Dc(),[a,s]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState([]),[h,g]=m.useState(!0),[l,u]=m.useState(null),x=async()=>{try{g(!0),u(null);const[d,b]=await Promise.all([Zl.getStats(),Zl.getSettings()]);if(s(d),i(b),b.ha_integration_enabled)try{const p=await Fr.getSensors();c(p)}catch{}}catch(d){u(d instanceof Error?d.message:"Fehler beim Laden der Einstellungen")}finally{g(!1)}};return m.useEffect(()=>{x()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:x,disabled:h,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(gr,{className:`h-5 w-5 ${h?"animate-spin":""}`})})]}),l&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:l})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:oe},{value:"dark",label:"Dunkel",icon:Mc},{value:"system",label:"System",icon:Ec}].map(d=>e.jsxs("button",{onClick:()=>r(d.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===d.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(d.icon,{className:"h-5 w-5"}),d.label]},d.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(lt,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:n!=null&&n.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),o.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",o.length," Energy-Sensoren verfügbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt über ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen → Import/Export"})," um deine Daten zu importieren."]})]})]}),o.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfügbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:d.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:d.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:d.unit_of_measurement||"-"})]},d.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Jr,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),h?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Re,{className:"h-6 w-6 animate-spin text-gray-400"})}):a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),a.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(a.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",a.daten_zeitraum&&e.jsxs("span",{children:[" (",a.daten_zeitraum.von," - ",a.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",a.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(n==null?void 0:n.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfügbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"./api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]})]})}const oo=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function D0(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState(null),[o,c]=m.useState([]),[h,g]=m.useState(null),[l,u]=m.useState(null),[x,d]=m.useState(null),[b,p]=m.useState(!1),[y,f]=m.useState(!1),[j,k]=m.useState(!1),[w,_]=m.useState(null),[v,S]=m.useState(null),[V,C]=m.useState(14);m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{a&&I()},[a]);const I=async()=>{if(a){p(!0),_(null),S(null);try{const[E,L,R]=await Promise.all([Xt.getAktivePrognose(a),Xt.listeGespeichertePrognosen(a),$n.getProvider(a).catch(()=>null)]);i(E),c(L),d(R)}catch(E){_(E instanceof Error?E.message:"Fehler beim Laden")}finally{p(!1)}}},F=async()=>{if(a){f(!0),_(null);try{const E=await Xt.getPrognose(a,{system_losses:V});g(E)}catch(E){_(E instanceof Error?E.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{f(!1)}}},M=async()=>{if(a){k(!0),_(null);try{const E=await Xt.getOptimum(a);u(E)}catch(E){_(E instanceof Error?E.message:"Fehler beim Ermitteln des Optimums")}finally{k(!1)}}},W=async()=>{if(a){p(!0),_(null);try{await Xt.speicherePrognose(a,{system_losses:V}),S("Prognose erfolgreich gespeichert"),g(null),await I()}catch(E){_(E instanceof Error?E.message:"Fehler beim Speichern")}finally{p(!1)}}},N=async E=>{try{await Xt.aktivierePrognose(E),S("Prognose aktiviert"),await I()}catch(L){_(L instanceof Error?L.message:"Fehler beim Aktivieren")}},z=async E=>{if(confirm("Prognose wirklich löschen?"))try{await Xt.loeschePrognose(E),S("Prognose gelöscht"),await I()}catch(L){_(L instanceof Error?L.message:"Fehler beim Löschen")}},A=t.find(E=>E.id===a),P=(A==null?void 0:A.latitude)&&(A==null?void 0:A.longitude);return r?e.jsx(Me,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"}),e.jsx(ae,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Ht,{value:(a==null?void 0:a.toString())||"",onChange:E=>s(parseInt(E.target.value)),options:t.map(E=>({value:E.id.toString(),label:E.anlagenname}))}),e.jsx("button",{onClick:I,disabled:b,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(gr,{className:`h-5 w-5 ${b?"animate-spin":""}`})})]})]}),w&&e.jsx(ae,{type:"error",children:w}),v&&e.jsx(ae,{type:"success",children:v}),!P&&e.jsx(ae,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_t,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergänze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu können."})]})]})}),P&&e.jsxs(e.Fragment,{children:[e.jsxs($,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),b?e.jsx(Me,{}):n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[n.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.neigung_grad,"°"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:n.ausrichtung_richtung})]})]}),n.monatswerte&&n.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:n.monatswerte.map(E=>({name:oo[E.monat],prognose:E.e_m})),children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name"}),e.jsx(be,{tickFormatter:E=>`${E} kWh`}),e.jsx(xe,{formatter:E=>`${E.toFixed(0)} kWh`}),e.jsx(le,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(n.abgerufen_am).toLocaleDateString("de-DE")," • ","Koordinaten: ",n.latitude.toFixed(4),"°N, ",n.longitude.toFixed(4),"°E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs($,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:V,onChange:E=>C(parseFloat(E.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(he,{onClick:F,disabled:y,className:"w-full",children:[y?e.jsx(gr,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ct,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),h&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(he,{onClick:W,disabled:b,children:[e.jsx(hr,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[h.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[h.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[h.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:h.module.length})]})]}),h.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:h.module.map(E=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:E.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[E.leistung_kwp," kWp • ",E.ausrichtung," • ",E.neigung_grad,"° • ",E.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},E.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:h.monatsdaten.map(E=>({name:oo[E.monat],ertrag:E.e_m})),children:[e.jsx(ke,{strokeDasharray:"3 3"}),e.jsx(ve,{dataKey:"name",fontSize:10}),e.jsx(be,{tickFormatter:E=>`${E}`}),e.jsx(xe,{formatter:E=>`${E.toFixed(0)} kWh`}),e.jsx(le,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ih,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(he,{onClick:M,disabled:j,variant:"secondary",children:[j?e.jsx(gr,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(We,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter für Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[l.optimal.neigung_grad,"°"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:l.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[l.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),l.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung für deinen Standort zu ermitteln.'})]}),o.length>0&&e.jsxs($,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:o.map(E=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(E.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[E.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:E.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[E.neigung_grad,"°"]}),e.jsx("td",{className:"text-center py-2 px-2",children:E.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(hr,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!E.ist_aktiv&&e.jsx("button",{onClick:()=>N(E.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(hr,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>z(E.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Löschen",children:e.jsx(Pt,{className:"h-4 w-4"})})]})})]},E.id))})]})})]}),x&&e.jsxs($,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Lr,{className:"h-5 w-5"}),"Wetterdaten-Provider"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Der Wetter-Provider bestimmt die Quelle für Globalstrahlungsdaten bei der Ist-Erfassung und der Kurzfrist-Prognose. Die Einstellung kann in den Anlagen-Stammdaten geändert werden."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Aktueller Provider"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:x.aktueller_provider==="auto"?"Automatisch":x.aktueller_provider==="brightsky"?"Bright Sky (DWD)":x.aktueller_provider==="open-meteo"?"Open-Meteo":x.aktueller_provider==="open-meteo-solar"?"Open-Meteo Solar (GTI)":x.aktueller_provider})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Standort"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[x.standort.land||"Unbekannt",x.standort.in_deutschland&&" (DWD verfügbar)"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Verfügbare Provider"}),e.jsx("div",{className:"grid gap-2",children:x.provider.map(E=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${E.verfuegbar?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 opacity-60"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${E.verfuegbar?"text-green-700 dark:text-green-300":"text-gray-500 dark:text-gray-400"}`,children:E.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:E.beschreibung})]}),e.jsx("div",{className:"text-sm",children:E.verfuegbar?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"✓ Verfügbar"}):e.jsx("span",{className:"text-gray-400",children:"Nicht verfügbar"})})]},E.id))})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(nt,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Über Solarprognose"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"PVGIS"})," (Langfrist): EU-Tool für Ertragsprognosen basierend auf Satellitendaten und Klimamodellen. Nutzt historische TMY-Daten (Typical Meteorological Year)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Wetter-Provider"})," (Kurzfrist): Aktuelle und historische Wetterdaten für SOLL-IST-Vergleiche. Bright Sky liefert DWD-Daten (Deutschland), Open-Meteo weltweit."]}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"PVGIS-Dokumentation →"})]})]})})]})]})}const co=`# Utility Meter für monatliche Aggregation
# Füge dies in deine configuration.yaml ein

utility_meter:
  # PV-Erzeugung (von deinem Wechselrichter)
  pv_erzeugung_monatlich:
    source: sensor.DEIN_WR_total_yield  # <- Anpassen!
    cycle: monthly

  # Einspeisung ins Netz
  einspeisung_monatlich:
    source: sensor.DEIN_ZAEHLER_export  # <- Anpassen!
    cycle: monthly

  # Netzbezug
  netzbezug_monatlich:
    source: sensor.DEIN_ZAEHLER_import  # <- Anpassen!
    cycle: monthly

  # Speicher Ladung (optional)
  speicher_ladung_monatlich:
    source: sensor.DEIN_SPEICHER_charge_total  # <- Anpassen!
    cycle: monthly

  # Speicher Entladung (optional)
  speicher_entladung_monatlich:
    source: sensor.DEIN_SPEICHER_discharge_total  # <- Anpassen!
    cycle: monthly

  # E-Auto Ladung (optional, z.B. von evcc)
  eauto_ladung_monatlich:
    source: sensor.evcc_loadpoint_charge_total_import  # <- Anpassen!
    cycle: monthly`,ho=`# Automation: Monatliche CSV-Export Datei erstellen
# Voraussetzung: File Integration muss eingerichtet sein

automation:
  - alias: "EEDC Monatsdaten Export"
    trigger:
      - platform: time
        at: "00:05:00"  # Am 1. des Monats um 00:05
    condition:
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: notify.file_export  # <- Anpassen an deinen File Notifier
        data:
          message: >
            {{ (now() - timedelta(days=1)).year }},{{ (now() - timedelta(days=1)).month }},{{ states('sensor.einspeisung_monatlich') }},{{ states('sensor.netzbezug_monatlich') }},{{ states('sensor.pv_erzeugung_monatlich') }}

# Hinweis: Die CSV muss dann manuell in EEDC importiert werden
# oder du erweiterst die Automation um einen REST-Call zu EEDC`;function L0(){const[t,r]=m.useState(!1),[a,s]=m.useState(null),n=(i,o)=>{navigator.clipboard.writeText(i),s(o),setTimeout(()=>s(null),2e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ur,{className:"w-6 h-6"}),"Datenerfassung"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"So erfassen Sie Ihre monatlichen Energiedaten in EEDC"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(Qs,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Manuelles Formular"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-2 py-0.5 rounded",children:"Empfohlen für Einsteiger"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Geben Sie Ihre Monatsdaten direkt im Formular ein. Ideal für gelegentliche Erfassung oder wenn Sie nur wenige Werte haben."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4 text-blue-500"}),"Einstellungen → Monatsdaten → Neu"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten können automatisch geladen werden"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4 text-blue-500"}),"Investitions-Daten pro Komponente erfassen"]})]}),e.jsxs("a",{href:"#/einstellungen/monatsdaten",className:"btn btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(Qs,{className:"w-4 h-4"}),"Zur Monatsdaten-Erfassung"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(ya,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV-Import"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 px-2 py-0.5 rounded",children:"Empfohlen für regelmäßige Erfassung"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Laden Sie Monatsdaten per CSV-Datei hoch. Perfekt für größere Datenmengen oder historische Daten."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4 text-green-500"}),"Einstellungen → Import/Export"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4 text-green-500"}),"Vorlage herunterladen (passt zu Ihren Investitionen)"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4 text-green-500"}),"Wetterdaten werden automatisch ergänzt"]})]}),e.jsxs("a",{href:"#/einstellungen/import",className:"btn btn-primary w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(ya,{className:"w-4 h-4"}),"Zum CSV-Import"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(ot,{className:"w-6 h-6 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Hinweis für Home Assistant Benutzer"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"EEDC ist als Standalone-Anwendung konzipiert und benötigt keine Home Assistant Integration für die Datenerfassung. Sie können Ihre Daten aus HA manuell in eine CSV-Datei exportieren und in EEDC importieren."}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:[e.jsx("strong",{children:"Optional:"})," Unter Einstellungen → HA-Export können Sie berechnete KPIs (Autarkie, Eigenverbrauch, etc.) per MQTT zurück an Home Assistant senden."]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:e.jsxs("a",{href:"#/einstellungen/ha-export",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1",children:[e.jsx(Ir,{className:"w-3 h-3"}),"HA-Export Einstellungen"]})})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!t),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(Ur,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Anleitung: CSV aus Home Assistant erstellen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"So richten Sie Utility Meter ein, um monatliche Werte für EEDC zu exportieren"})]})]}),t?e.jsx($h,{className:"w-5 h-5 text-gray-400"}):e.jsx(zr,{className:"w-5 h-5 text-gray-400"})]}),t&&e.jsxs("div",{className:"px-4 pb-4 space-y-6 border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"1"}),"Utility Meter einrichten"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:["Utility Meter aggregieren Ihre Sensordaten monatlich. Fügen Sie folgendes in Ihre"," ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"configuration.yaml"})," ein und passen Sie die Sensor-IDs an:"]}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-64",children:co}),e.jsx("button",{onClick:()=>n(co,"utility"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:a==="utility"?e.jsx(hr,{className:"w-4 h-4 text-green-400"}):e.jsx(gi,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"2"}),"Ihre Sensoren finden"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"So finden Sie die richtigen Sensor-IDs in Home Assistant:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-4",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Entwicklerwerkzeuge → Zustände"})," in HA öffnen"]}),e.jsx("li",{children:'• Nach "total" oder "energy" filtern'}),e.jsxs("li",{children:["• Sensoren mit ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"state_class: total_increasing"})," sind ideal"]}),e.jsxs("li",{children:["• Typische Namen: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_total_yield"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_energy"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_import"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_export"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"3"}),"CSV-Datei erstellen"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Am Monatsende die Utility Meter Werte ablesen und in eine CSV eintragen:"}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs font-mono overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"// Pflicht-Spalten:"}),e.jsx("div",{children:"Jahr,Monat,Einspeisung_kWh,Netzbezug_kWh"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"// Beispiel:"}),e.jsx("div",{children:"2025,12,125.9,405.5"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[e.jsx("strong",{children:"Tipp:"})," Laden Sie unter Import/Export eine Vorlage herunter - sie enthält alle Spalten passend zu Ihren angelegten Investitionen!"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-gray-400 text-white text-sm flex items-center justify-center",children:"4"}),e.jsx("span",{className:"text-gray-500",children:"(Optional)"})," Automatischer Export"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Für Fortgeschrittene: Mit der File-Integration und einer Automation können Sie die CSV automatisch erstellen lassen:"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-48",children:ho}),e.jsx("button",{onClick:()=>n(ho,"file"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:a==="file"?e.jsx(hr,{className:"w-4 h-4 text-green-400"}):e.jsx(gi,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Wichtig:"}),' Utility Meter werden bei HA-Neustart zurückgesetzt, es sei denn, Sie haben den Recorder korrekt konfiguriert. Alternativ können Sie auch die "Statistik"-Werte aus dem HA Energy Dashboard verwenden.']})})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"💡 Tipps für die Datenerfassung"}),e.jsxs("ul",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"📅"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Regelmäßigkeit:"})," Erfassen Sie Ihre Daten am besten immer am gleichen Tag im Monat (z.B. am 1. oder letzten Tag)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"📊"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Zählerstände:"})," Notieren Sie die Zählerstände Ihrer Wechselrichter, Speicher und Wallbox. EEDC erwartet Monatswerte (Differenz zum Vormonat)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"☀️"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wetterdaten:"})," Globalstrahlung und Sonnenstunden werden automatisch aus Open-Meteo geladen, wenn Ihre Anlage Koordinaten hat."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚗"}),e.jsxs("span",{children:[e.jsx("strong",{children:"E-Auto:"})," Bei externem Laden (öffentliche Säulen) können Sie Ladung und Kosten separat erfassen."]})]})]})]})]})}function I0(){const[t,r]=m.useState([]),[a,s]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[h,g]=m.useState(null),[l,u]=m.useState(!0),[x,d]=m.useState(null),[b,p]=m.useState(null),[y,f]=m.useState("core-mosquitto"),[j,k]=m.useState(1883),[w,_]=m.useState(""),[v,S]=m.useState(""),[V,C]=m.useState(null),[I,F]=m.useState(null),[M,W]=m.useState(!1),[N,z]=m.useState(!1),[A,P]=m.useState(!1),[E,L]=m.useState("mqtt"),[R,X]=m.useState(new Set(["energie","finanzen"])),[O,B]=m.useState(!1),G=async()=>{try{u(!0),d(null);const[K,Q,ce]=await Promise.all([At.list(),Fr.getExportSensors(),Fr.getMqttConfig().catch(()=>null)]);r(K),i(Q),ce&&(p(ce),f(ce.host),k(ce.port),_(ce.username)),K.length>0&&!a&&s(K[0].id)}catch(K){d(K instanceof Error?K.message:"Fehler beim Laden")}finally{u(!1)}},T=async K=>{try{const[Q,ce]=await Promise.all([Fr.getAnlageSensors(K),Fr.getYamlSnippet(K)]);c(Q),g(ce)}catch(Q){console.error("Fehler beim Laden der Anlage-Daten:",Q)}};m.useEffect(()=>{G()},[]),m.useEffect(()=>{a&&T(a)},[a]);const q=async()=>{W(!0),C(null);try{const K=await Fr.testMqtt({host:y,port:j,username:w||void 0,password:v||void 0});C(K)}catch(K){C({connected:!1,error:K instanceof Error?K.message:"Verbindungsfehler"})}finally{W(!1)}},re=async()=>{if(a){z(!0),F(null);try{const K=await Fr.publishMqtt(a,{host:y,port:j,username:w||void 0,password:v||void 0});F(K)}catch(K){F({message:K instanceof Error?K.message:"Fehler beim Publizieren",anlage_id:a,total:0,success:0,failed:0})}finally{z(!1)}}},de=async()=>{if(a&&confirm("Alle EEDC-Sensoren für diese Anlage aus Home Assistant entfernen?")){P(!0);try{await Fr.removeMqtt(a,{host:y,port:j,username:w||void 0,password:v||void 0}),F(null)}catch(K){d(K instanceof Error?K.message:"Fehler beim Entfernen")}finally{P(!1)}}},ue=async()=>{if(h)try{await navigator.clipboard.writeText(h.yaml),B(!0),setTimeout(()=>B(!1),2e3)}catch{const K=document.createElement("textarea");K.value=h.yaml,document.body.appendChild(K),K.select(),document.execCommand("copy"),document.body.removeChild(K),B(!0),setTimeout(()=>B(!1),2e3)}},ee=()=>{if(!h||!o)return;const K=new Blob([h.yaml],{type:"text/yaml"}),Q=URL.createObjectURL(K),ce=document.createElement("a");ce.href=Q,ce.download=`eedc_sensors_${o.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(ce),ce.click(),document.body.removeChild(ce),URL.revokeObjectURL(Q)},pe=K=>{X(Q=>{const ce=new Set(Q);return ce.has(K)?ce.delete(K):ce.add(K),ce})},Be=K=>{const Q={};return K.forEach(ce=>{const Ee=ce.category||"sonstige";Q[Ee]||(Q[Ee]=[]),Q[Ee].push(ce)}),Q},ie={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},se={energie:"⚡",finanzen:"💰",autarkie:"🏠",umwelt:"🌱",performance:"📊",sonstige:"📌"};return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Re,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:G,disabled:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(gr,{className:`h-5 w-5 ${l?"animate-spin":""}`})})]}),x&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:x})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(ot,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO₂, ROI) als Sensoren an Home Assistant zurückgeben. Wähle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entitäten)."})]})]}),t.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswählen"}),e.jsx("select",{value:a||"",onChange:K=>s(Number(K.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:t.map(K=>e.jsx("option",{value:K.id,children:K.anlagenname},K.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>L("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${E==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>L("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${E==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),E==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),b&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:y,onChange:K=>f(K.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:j,onChange:K=>k(Number(K.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:w,onChange:K=>_(K.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:v,onChange:K=>S(K.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),V&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${V.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:V.connected?e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",V.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:V.error})]})}),V.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:V.hint})]}),I&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${I.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[I.success," von ",I.total," Sensoren publiziert"]})]}),I.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[I.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:q,disabled:M,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[M?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(gr,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:re,disabled:N||!a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[N?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(Ac,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:de,disabled:A||!a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[A?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(Pt,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${b!=null&&b.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[b!=null&&b.auto_publish?e.jsx(pt,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(ft,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${b!=null&&b.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen → Geräte & Dienste → MQTT"}),".",b!=null&&b.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",b.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelmäßig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen für automatische Updates."]})]})]})]})]}),E==="rest"&&h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML für configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ue,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:O?e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(gi,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:h.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:h.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(ot,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["Füge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",h.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach Änderungen muss Home Assistant neu gestartet werden."]})]})]})]}),o&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verfügbare Sensoren (",o.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(Be(o.sensors)).map(([K,Q])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>pe(K),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:se[K]||"📌"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ie[K]||K}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",Q.length,")"]})]}),R.has(K)?e.jsx(zr,{className:"w-5 h-5 text-gray-400"}):e.jsx(ar,{className:"w-5 h-5 text-gray-400"})]}),R.has(K)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Q.map(ce=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:ce.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ce.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:ce.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:ce.value!==null?typeof ce.value=="number"?ce.value.toLocaleString("de-DE",{maximumFractionDigits:2}):ce.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:ce.unit})]})]}),ce.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",ce.formel,ce.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",ce.berechnung]})]})]},ce.key))})]},K))})]}),n&&n.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:n.investitionen.map(K=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:K.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",K.typ," - ",K.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:K.sensors.map(Q=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:Q.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:Q.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:Q.value!==null?typeof Q.value=="number"?Q.value.toLocaleString("de-DE",{maximumFractionDigits:2}):Q.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:Q.unit})]})]},Q.key))})]},K.investition_id))})]})]})}function V0({value:t,onChange:r,sensors:a,placeholder:s}){const[n,i]=m.useState(""),[o,c]=m.useState(!1),h=a.filter(d=>{var b;return d.entity_id.toLowerCase().includes(n.toLowerCase())||((b=d.friendly_name)==null?void 0:b.toLowerCase().includes(n.toLowerCase()))}),g=a.find(d=>d.entity_id===t),l=m.useCallback(d=>{r(d),i(""),c(!1)},[r]),u=m.useCallback(()=>{r(null),i("")},[r]),x=t&&t.length>0;return e.jsxs("div",{className:"relative",children:[x?e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${g?"bg-gray-100 dark:bg-gray-700":"bg-amber-50 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700"}`,children:[e.jsxs("span",{className:"flex-1 text-sm truncate",children:[(g==null?void 0:g.friendly_name)||t,!g&&e.jsx("span",{className:"ml-2 text-xs text-amber-600 dark:text-amber-400",children:"(nicht verfügbar)"})]}),e.jsx("button",{onClick:u,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Xr,{className:"w-4 h-4 text-gray-500"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(Fc,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:d=>{i(d.target.value),c(!0)},onFocus:()=>c(!0),placeholder:s||"Sensor suchen...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),o&&!t&&e.jsx("div",{className:"absolute z-10 w-full mt-1 max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:h.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:n?"Keine Sensoren gefunden":"Sensor eingeben..."}):h.slice(0,50).map(d=>e.jsxs("button",{onClick:()=>l(d.entity_id),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:d.friendly_name||d.entity_id}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[d.entity_id,d.unit&&` (${d.unit})`,d.state&&` - ${d.state}`]})]},d.entity_id))})]})}function Xe({label:t,einheit:r,value:a,onChange:s,availableSensors:n,strategieOptionen:i,defaultStrategie:o="sensor",kwpAnteil:c,copDefault:h}){const g=(a==null?void 0:a.strategie)||o,l=d=>{d==="keine"?s({strategie:"keine"}):d==="manuell"?s({strategie:"manuell"}):d==="sensor"?s({strategie:"sensor",sensor_id:(a==null?void 0:a.sensor_id)||null}):d==="kwp_verteilung"?s({strategie:"kwp_verteilung",parameter:{anteil:c||0,basis_sensor:"pv_gesamt"}}):d==="cop_berechnung"?s({strategie:"cop_berechnung",parameter:{cop:h||3.5,basis_feld:"stromverbrauch_kwh"}}):d==="ev_quote"&&s({strategie:"ev_quote",parameter:{}})},u=d=>{s({strategie:"sensor",sensor_id:d})},x=d=>{s({strategie:"cop_berechnung",parameter:{...a==null?void 0:a.parameter,cop:d}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",r,")"]})]})}),e.jsx("div",{className:"space-y-3",children:i.map(d=>{var b;return e.jsxs("label",{className:`
              flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-colors
              ${g===d.value?"bg-amber-50 dark:bg-amber-900/20 ring-1 ring-amber-500":"hover:bg-gray-50 dark:hover:bg-gray-700/50"}
            `,children:[e.jsx("input",{type:"radio",name:`strategie-${t}`,checked:g===d.value,onChange:()=>l(d.value),className:"mt-1 w-4 h-4 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:d.label}),d.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:d.description}),g==="sensor"&&d.value==="sensor"&&e.jsx("div",{className:"mt-3",children:e.jsx(V0,{value:a==null?void 0:a.sensor_id,onChange:u,sensors:n})}),g==="kwp_verteilung"&&d.value==="kwp_verteilung"&&c!==void 0&&e.jsxs("div",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400",children:[(c*100).toFixed(1),"% von PV Gesamt"]}),g==="cop_berechnung"&&d.value==="cop_berechnung"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"COP:"}),e.jsx("input",{type:"number",step:"0.1",min:"1",max:"10",value:((b=a==null?void 0:a.parameter)==null?void 0:b.cop)||h||3.5,onChange:p=>x(parseFloat(p.target.value)||3.5),className:"w-20 px-2 py-1 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-amber-500"})]})]})]},d.value)})})]})}function B0({value:t,onChange:r,availableSensors:a}){const s=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant Sensor lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard manuell erfassen"}],n=[{value:"sensor",label:"HA-Sensor",description:"PV-Gesamterzeugung aus Wechselrichter-Sensor"},{value:"keine",label:"Nicht verwenden",description:"Jeder PV-String hat einen eigenen Sensor"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ae,{type:"info",title:"Basis-Sensoren",children:"Diese sind die Grundlage für alle Energie-Berechnungen. Die Werte werden typischerweise vom Stromzähler oder Wechselrichter erfasst."}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ya,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Xe,{label:"Einspeisung",einheit:"kWh",value:t.einspeisung,onChange:i=>r("einspeisung",i),availableSensors:a,strategieOptionen:s})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ct,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Xe,{label:"Netzbezug",einheit:"kWh",value:t.netzbezug,onChange:i=>r("netzbezug",i),availableSensors:a,strategieOptionen:s})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(_e,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Xe,{label:"PV Erzeugung Gesamt",einheit:"kWh",value:t.pv_gesamt,onChange:i=>r("pv_gesamt",i),availableSensors:a,strategieOptionen:n,defaultStrategie:"keine"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Optional: Wenn du mehrere PV-Strings hast, aber nur einen Gesamtsensor, kann die Erzeugung anteilig nach kWp auf die Strings verteilt werden."})]})]})]})}function O0({investitionen:t,mappings:r,onChange:a,availableSensors:s,gesamtKwp:n,basisPvGesamt:i}){const o=(i==null?void 0:i.strategie)==="sensor"&&(i==null?void 0:i.sensor_id);return e.jsxs("div",{className:"space-y-6",children:[t.length>1&&e.jsx(ae,{type:"info",title:o?"kWp-Verteilung verfügbar":"Tipp",children:o?e.jsx(e.Fragment,{children:"Du hast einen PV-Gesamt-Sensor konfiguriert. Die Erzeugung kann anteilig auf die einzelnen Strings verteilt werden."}):e.jsx(e.Fragment,{children:'Wenn du keinen separaten Sensor pro String hast, konfiguriere zuerst unter "Basis-Sensoren" einen PV-Gesamt-Sensor.'})}),t.map(c=>{var l,u;const h=n>0&&c.kwp?c.kwp/n:0,g=[{value:"sensor",label:"Eigener Sensor",description:"Separater Sensor für diesen PV-String"}];return o&&h>0&&g.push({value:"kwp_verteilung",label:`kWp-Verteilung (${(h*100).toFixed(1)}%)`,description:`${(l=c.kwp)==null?void 0:l.toFixed(1)} kWp von ${n.toFixed(1)} kWp gesamt`}),g.push({value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung}),c.kwp&&e.jsxs("div",{className:"text-xs text-gray-500",children:[c.kwp.toFixed(1)," kWp",h>0&&` (${(h*100).toFixed(1)}%)`]})]})]}),e.jsx("div",{className:"p-4",children:e.jsx(Xe,{label:"PV-Erzeugung",einheit:"kWh",value:((u=r[c.id.toString()])==null?void 0:u.pv_erzeugung_kwh)||null,onChange:x=>a(c.id,"pv_erzeugung_kwh",x),availableSensors:s,strategieOptionen:g,kwpAnteil:h,defaultStrategie:o&&h>0?"kwp_verteilung":"sensor"})})]},c.id)})]})}function R0({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor für Netzladung"},{value:"keine",label:"Nicht erfassen",description:"Speicher wird nicht aus dem Netz geladen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}];return e.jsx("div",{className:"space-y-6",children:t.map(o=>{var c,h,g;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Fe,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Xe,{label:"Ladung",einheit:"kWh",value:((c=r[o.id.toString()])==null?void 0:c.ladung_kwh)||null,onChange:l=>a(o.id,"ladung_kwh",l),availableSensors:s,strategieOptionen:n}),e.jsx(Xe,{label:"Entladung",einheit:"kWh",value:((h=r[o.id.toString()])==null?void 0:h.entladung_kwh)||null,onChange:l=>a(o.id,"entladung_kwh",l),availableSensors:s,strategieOptionen:n}),e.jsx(Xe,{label:"Netzladung",einheit:"kWh",value:((g=r[o.id.toString()])==null?void 0:g.ladung_netz_kwh)||null,onChange:l=>a(o.id,"ladung_netz_kwh",l),availableSensors:s,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2 ml-1",children:"Netzladung wird für Arbitrage-Auswertung (Speicher aus Netz laden) benötigt."})]})]},o.id)})})}function T0({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Stromverbrauch aus Energiemessung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"Wärmemengenzähler",description:"Direkte Messung der Heizenergie"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Stromverbrauch × COP (JAZ)"}],o=[{value:"sensor",label:"Wärmemengenzähler",description:"Separater Sensor für Warmwasser"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Anteil Strom × COP"},{value:"keine",label:"Nicht separat erfassen",description:"Warmwasser ist in Heizenergie enthalten"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ae,{type:"info",title:"COP-Berechnung",children:"Wenn kein Wärmemengenzähler vorhanden ist, kann die Heizenergie über den COP (Coefficient of Performance) berechnet werden. Der COP sollte aus den Investitions-Parametern übernommen werden."}),t.map(c=>{var h,g,l;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Br,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung}),c.cop&&e.jsxs("div",{className:"text-xs text-gray-500",children:["JAZ/COP: ",c.cop.toFixed(1)]})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-amber-100 dark:bg-amber-900/30 rounded flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(_e,{className:"w-3 h-3 text-amber-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Xe,{label:"Stromverbrauch",einheit:"kWh",value:((h=r[c.id.toString()])==null?void 0:h.stromverbrauch_kwh)||null,onChange:u=>a(c.id,"stromverbrauch_kwh",u),availableSensors:s,strategieOptionen:n})})]}),e.jsx(Xe,{label:"Heizenergie",einheit:"kWh",value:((g=r[c.id.toString()])==null?void 0:g.heizenergie_kwh)||null,onChange:u=>a(c.id,"heizenergie_kwh",u),availableSensors:s,strategieOptionen:i,copDefault:c.cop||3.5}),e.jsx(Xe,{label:"Warmwasser",einheit:"kWh",value:((l=r[c.id.toString()])==null?void 0:l.warmwasser_kwh)||null,onChange:u=>a(c.id,"warmwasser_kwh",u),availableSensors:s,strategieOptionen:o,copDefault:c.cop?c.cop-.5:3,defaultStrategie:"keine"})]})]},c.id)})]})}function K0({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=t.filter(d=>d.typ==="e-auto"),i=t.filter(d=>d.typ==="wallbox"),o=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],c=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor für Netzladung"},{value:"ev_quote",label:"EV-Quote berechnen",description:"Basierend auf Anlagen-Eigenverbrauchsquote"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],h=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Kilometerstand monatlich erfassen"}],g=[{value:"sensor",label:"HA-Sensor",description:"V2H/V2G Entladung"},{value:"keine",label:"Nicht vorhanden",description:"Kein Vehicle-to-Home"}],l=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Keine externe Ladung"}],u=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Wird aus Ladung berechnet"}],x=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Wallbox-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Optional"}];return e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),"E-Autos"]}),n.map(d=>{var b,p,y,f,j,k;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Ve,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:d.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Xe,{label:"Ladung PV",einheit:"kWh",value:((b=r[d.id.toString()])==null?void 0:b.ladung_pv_kwh)||null,onChange:w=>a(d.id,"ladung_pv_kwh",w),availableSensors:s,strategieOptionen:o}),e.jsx(Xe,{label:"Ladung Netz",einheit:"kWh",value:((p=r[d.id.toString()])==null?void 0:p.ladung_netz_kwh)||null,onChange:w=>a(d.id,"ladung_netz_kwh",w),availableSensors:s,strategieOptionen:c}),e.jsx(Xe,{label:"Gefahrene Kilometer",einheit:"km",value:((y=r[d.id.toString()])==null?void 0:y.km_gefahren)||null,onChange:w=>a(d.id,"km_gefahren",w),availableSensors:s,strategieOptionen:h,defaultStrategie:"manuell"}),e.jsx(Xe,{label:"V2H Entladung",einheit:"kWh",value:((f=r[d.id.toString()])==null?void 0:f.v2h_entladung_kwh)||null,onChange:w=>a(d.id,"v2h_entladung_kwh",w),availableSensors:s,strategieOptionen:g,defaultStrategie:"keine"}),e.jsx(Xe,{label:"Verbrauch gesamt",einheit:"kWh",value:((j=r[d.id.toString()])==null?void 0:j.verbrauch_kwh)||null,onChange:w=>a(d.id,"verbrauch_kwh",w),availableSensors:s,strategieOptionen:u,defaultStrategie:"keine"}),e.jsx(Xe,{label:"Ladung Extern",einheit:"kWh",value:((k=r[d.id.toString()])==null?void 0:k.ladung_extern_kwh)||null,onChange:w=>a(d.id,"ladung_extern_kwh",w),availableSensors:s,strategieOptionen:l,defaultStrategie:"keine"})]})]},d.id)})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2 mt-8",children:[e.jsx(Hl,{className:"w-5 h-5"}),"Wallboxen"]}),e.jsx(ae,{type:"info",children:"Wallbox-Ladung wird für die Gesamtübersicht verwendet. Die Zuordnung PV/Netz erfolgt über die E-Auto-Konfiguration."}),i.map(d=>{var b,p;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Hl,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:d.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Xe,{label:"Ladung Gesamt",einheit:"kWh",value:((b=r[d.id.toString()])==null?void 0:b.ladung_kwh)||null,onChange:y=>a(d.id,"ladung_kwh",y),availableSensors:s,strategieOptionen:o}),e.jsx(Xe,{label:"Ladevorgänge",einheit:"Anzahl",value:((p=r[d.id.toString()])==null?void 0:p.ladevorgaenge)||null,onChange:y=>a(d.id,"ladevorgaenge",y),availableSensors:s,strategieOptionen:x,defaultStrategie:"keine"})]})]},d.id)})]})]})}function H0({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung vom Wechselrichter"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Falls separater Sensor vorhanden"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Wird aus Erzeugung - Einspeisung berechnet"}],o=[{value:"sensor",label:"HA-Sensor",description:"Z.B. von Speicher-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Kein Speicher",description:"BKW ohne Speicher"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ae,{type:"info",children:"Balkonkraftwerke können optional einen integrierten Speicher haben. Konfiguriere die Speicher-Felder nur, wenn dein BKW einen Speicher hat."}),t.map(c=>{var h,g,l,u;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Xe,{label:"PV-Erzeugung",einheit:"kWh",value:((h=r[c.id.toString()])==null?void 0:h.pv_erzeugung_kwh)||null,onChange:x=>a(c.id,"pv_erzeugung_kwh",x),availableSensors:s,strategieOptionen:n}),e.jsx(Xe,{label:"Eigenverbrauch",einheit:"kWh",value:((g=r[c.id.toString()])==null?void 0:g.eigenverbrauch_kwh)||null,onChange:x=>a(c.id,"eigenverbrauch_kwh",x),availableSensors:s,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx(Xe,{label:"Speicher Ladung",einheit:"kWh",value:((l=r[c.id.toString()])==null?void 0:l.speicher_ladung_kwh)||null,onChange:x=>a(c.id,"speicher_ladung_kwh",x),availableSensors:s,strategieOptionen:o,defaultStrategie:"keine"}),e.jsx(Xe,{label:"Speicher Entladung",einheit:"kWh",value:((u=r[c.id.toString()])==null?void 0:u.speicher_entladung_kwh)||null,onChange:x=>a(c.id,"speicher_entladung_kwh",x),availableSensors:s,strategieOptionen:o,defaultStrategie:"keine"})]})]},c.id)})]})}const G0={sensor:e.jsx(Cc,{className:"w-4 h-4 text-green-500"}),kwp_verteilung:e.jsx(Qa,{className:"w-4 h-4 text-blue-500"}),cop_berechnung:e.jsx(wc,{className:"w-4 h-4 text-purple-500"}),ev_quote:e.jsx(Qa,{className:"w-4 h-4 text-amber-500"}),manuell:e.jsx(Qs,{className:"w-4 h-4 text-gray-500"}),keine:e.jsx(Sc,{className:"w-4 h-4 text-gray-400"})},Z0={sensor:"HA-Sensor",kwp_verteilung:"kWp-Verteilung",cop_berechnung:"COP-Berechnung",ev_quote:"EV-Quote",manuell:"Manuell",keine:"Nicht erfassen"},q0={"pv-module":e.jsx(oe,{className:"w-4 h-4"}),speicher:e.jsx(Fe,{className:"w-4 h-4"}),waermepumpe:e.jsx(Br,{className:"w-4 h-4"}),"e-auto":e.jsx(Ve,{className:"w-4 h-4"}),wallbox:e.jsx(_e,{className:"w-4 h-4"})};function Ms({label:t,mapping:r}){var a,s;return r?e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[G0[r.strategie],e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:Z0[r.strategie]}),r.strategie==="sensor"&&r.sensor_id&&e.jsxs("span",{className:"text-xs text-gray-500 max-w-[200px] truncate",children:["(",r.sensor_id,")"]}),r.strategie==="cop_berechnung"&&((a=r.parameter)==null?void 0:a.cop)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(COP: ",r.parameter.cop,")"]}),r.strategie==="kwp_verteilung"&&((s=r.parameter)==null?void 0:s.anteil)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(r.parameter.anteil*100).toFixed(1),"%)"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsx("span",{className:"text-sm text-gray-400 italic",children:"Nicht konfiguriert"})]})}function J0({state:t,investitionen:r}){const a={sensor:0,kwp_verteilung:0,cop_berechnung:0,ev_quote:0,manuell:0,keine:0},s=i=>{i!=null&&i.strategie&&a[i.strategie]++};s(t.basis.einspeisung),s(t.basis.netzbezug),s(t.basis.pv_gesamt),Object.values(t.investitionen).forEach(i=>{Object.values(i).forEach(o=>{s(o)})});const n=a.sensor+a.kwp_verteilung+a.cop_berechnung+a.ev_quote+a.manuell;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(ia,{icon:e.jsx(Cc,{className:"w-5 h-5 text-green-500"}),label:"HA-Sensor",count:a.sensor}),e.jsx(ia,{icon:e.jsx(Qa,{className:"w-5 h-5 text-blue-500"}),label:"kWp-Verteilung",count:a.kwp_verteilung}),e.jsx(ia,{icon:e.jsx(wc,{className:"w-5 h-5 text-purple-500"}),label:"COP-Berechnung",count:a.cop_berechnung}),e.jsx(ia,{icon:e.jsx(Qa,{className:"w-5 h-5 text-amber-500"}),label:"EV-Quote",count:a.ev_quote}),e.jsx(ia,{icon:e.jsx(Qs,{className:"w-5 h-5 text-gray-500"}),label:"Manuell",count:a.manuell}),e.jsx(ia,{icon:e.jsx(Sc,{className:"w-5 h-5 text-gray-400"}),label:"Keine",count:a.keine})]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[n," Felder konfiguriert"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Basis-Sensoren"})]}),e.jsxs("div",{className:"px-4 py-2",children:[e.jsx(Ms,{label:"Einspeisung",mapping:t.basis.einspeisung}),e.jsx(Ms,{label:"Netzbezug",mapping:t.basis.netzbezug}),e.jsx(Ms,{label:"PV Gesamt",mapping:t.basis.pv_gesamt})]})]}),r.map(i=>{const o=t.investitionen[i.id.toString()]||{};return Object.keys(o).length===0?null:e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:q0[i.typ]||e.jsx(_e,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:i.bezeichnung}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.typ,")"]})]}),e.jsx("div",{className:"px-4 py-2",children:Object.entries(o).map(([c,h])=>e.jsx(Ms,{label:c.replace(/_/g," ").replace("kwh","(kWh)"),mapping:h},c))})]},i.id)})]})}function ia({icon:t,label:r,count:a}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"flex justify-center mb-1",children:t}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:a}),e.jsx("div",{className:"text-xs text-gray-500",children:r})]})}const go={basis:{einspeisung:null,netzbezug:null,pv_gesamt:null},investitionen:{}};function U0(){var ce,Ee,te;const t=pr(),[r]=gh(),a=r.get("anlage"),s=a?parseInt(a,10):null,[n,i]=m.useState(0),[o,c]=m.useState(go),[h,g]=m.useState(null),[l,u]=m.useState(!1),[x,d]=m.useState(!1),[b,p]=m.useState(!1),[y,f]=m.useState(null),[j,k]=m.useState(null),[w,_]=m.useState(!1),[v,S]=m.useState(!1),[V,C]=m.useState(!1),[I,F]=m.useState(!1),[M,W]=m.useState(null),[N,z]=m.useState(null),[A,P]=m.useState([]),[E,L]=m.useState(!0),[R,X]=m.useState(null),O=s||((ce=M==null?void 0:M[0])==null?void 0:ce.id);m.useEffect(()=>{async function U(){var je,Pe,Ae,It;L(!0),X(null);try{if(!s){const Ke=await At.list();if(W(Ke),!Ke.length){L(!1);return}}const H=s||((je=M==null?void 0:M[0])==null?void 0:je.id);if(!H)return;const[fe,Oe]=await Promise.all([Ma.getMapping(H),Ma.getAvailableSensors(H).catch(()=>[])]);if(z(fe),P(Oe),fe!=null&&fe.mapping){const Ke=fe.mapping;c({basis:{einspeisung:((Pe=Ke.basis)==null?void 0:Pe.einspeisung)||null,netzbezug:((Ae=Ke.basis)==null?void 0:Ae.netzbezug)||null,pv_gesamt:((It=Ke.basis)==null?void 0:It.pv_gesamt)||null},investitionen:Object.fromEntries(Object.entries(Ke.investitionen||{}).map(([Ie,dt])=>[Ie,dt.felder||{}]))})}}catch(H){X(H.message||"Fehler beim Laden")}finally{L(!1)}}U()},[s,(Ee=M==null?void 0:M[0])==null?void 0:Ee.id]);const B=m.useMemo(()=>{var Pe,Ae,It,H,fe,Oe;if(!N)return[];const U=[{id:"basis",title:"Basis-Sensoren",icon:e.jsx(_e,{className:"w-5 h-5"})}],je=N.investitionen.reduce((Ke,Ie)=>(Ke[Ie.typ]||(Ke[Ie.typ]=[]),Ke[Ie.typ].push(Ie),Ke),{});return(Pe=je["pv-module"])!=null&&Pe.length&&U.push({id:"pv",title:"PV-Module",icon:e.jsx(oe,{className:"w-5 h-5"}),investitionen:je["pv-module"]}),(Ae=je.speicher)!=null&&Ae.length&&U.push({id:"speicher",title:"Speicher",icon:e.jsx(Fe,{className:"w-5 h-5"}),investitionen:je.speicher}),(It=je.waermepumpe)!=null&&It.length&&U.push({id:"wp",title:"Wärmepumpe",icon:e.jsx(Br,{className:"w-5 h-5"}),investitionen:je.waermepumpe}),((H=je["e-auto"])!=null&&H.length||(fe=je.wallbox)!=null&&fe.length)&&U.push({id:"eauto",title:"E-Auto & Wallbox",icon:e.jsx(Ve,{className:"w-5 h-5"}),investitionen:[...je["e-auto"]||[],...je.wallbox||[]]}),(Oe=je.balkonkraftwerk)!=null&&Oe.length&&U.push({id:"bkw",title:"Balkonkraftwerk",icon:e.jsx(oe,{className:"w-5 h-5"}),investitionen:je.balkonkraftwerk}),U.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(wr,{className:"w-5 h-5"})}),U},[N]),G=m.useCallback((U,je)=>{c(Pe=>({...Pe,basis:{...Pe.basis,[U]:je}}))},[]),T=m.useCallback((U,je,Pe)=>{Pe&&c(Ae=>({...Ae,investitionen:{...Ae.investitionen,[U.toString()]:{...Ae.investitionen[U.toString()],[je]:Pe}}}))},[]),q=m.useCallback(async()=>{if(O){u(!0),g(null);try{const U={basis:{einspeisung:o.basis.einspeisung,netzbezug:o.basis.netzbezug,pv_gesamt:o.basis.pv_gesamt},investitionen:Object.fromEntries(Object.entries(o.investitionen).map(([je,Pe])=>[je,{felder:Pe}]))};await Ma.saveMapping(O,U),d(!0)}catch(U){g(U.message||"Fehler beim Speichern")}finally{u(!1)}}},[o,O]),re=m.useCallback(async()=>{if(O){p(!0);try{const U=await Ma.initStartValues(O);f(U)}catch(U){f({success:!1,message:U.message||"Fehler beim Initialisieren",updated_fields:0})}finally{p(!1)}}},[O]);m.useEffect(()=>{x&&j===null&&(_(!0),ur.getStatus().then(U=>k(U.verfuegbar)).catch(()=>k(!1)).finally(()=>_(!1)))},[x,j]);const de=m.useCallback(async()=>{if(O){S(!0);try{const U=new Date,je=U.getFullYear(),Pe=U.getMonth()+1,It=(await ur.getMonatsanfangWerte(O,je,Pe)).startwerte||{},H=Object.keys(It).length;H>0?f({success:!0,message:`Startwerte für ${Pe}/${je} aus HA-Statistik geladen`,updated_fields:H}):f({success:!1,message:"Keine Daten in HA-Statistik für diesen Monat gefunden. Möglicherweise sind noch keine Langzeit-Statistiken für die konfigurierten Sensoren vorhanden.",updated_fields:0})}catch(U){f({success:!1,message:U.message||"Fehler beim Laden aus HA-Statistik",updated_fields:0})}finally{S(!1)}}},[O]),ue=m.useCallback(()=>{t("/einstellungen/ha-export?saved=true")},[t]),ee=m.useCallback(async()=>{if(O){C(!0);try{await Ma.deleteMapping(O),c(go),z(U=>U?{...U,mapping:null,mqtt_setup_complete:!1}:null),F(!1),window.location.reload()}catch(U){g(U.message||"Fehler beim Löschen")}finally{C(!1)}}},[O]),pe=n<B.length-1,Be=n>0,ie=n===B.length-1,se=()=>{pe&&i(U=>U+1)},K=()=>{Be&&i(U=>U-1)};if(!O&&!E)return e.jsx("div",{className:"p-6",children:e.jsx(ae,{type:"warning",children:"Keine Anlage vorhanden. Bitte zuerst eine Anlage erstellen."})});if(E)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Re,{className:"w-8 h-8 animate-spin text-amber-500"})});if(R)return e.jsx("div",{className:"p-6",children:e.jsxs(ae,{type:"error",children:["Fehler beim Laden: ",R]})});if(x)return e.jsx("div",{className:"max-w-2xl mx-auto p-6 space-y-6",children:e.jsxs($,{children:[e.jsx(Gl,{title:"Sensor-Zuordnung gespeichert",subtitle:"MQTT-Sensoren wurden erfolgreich erstellt"}),e.jsx("div",{className:"mt-6 space-y-4",children:y?e.jsxs(e.Fragment,{children:[e.jsx(ae,{type:y.success?"success":"error",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:y.message}),y.updated_fields>0&&e.jsxs("p",{className:"text-sm opacity-80",children:[y.updated_fields," Startwert(e) wurden in Home Assistant gesetzt."]})]})}),e.jsxs(he,{onClick:ue,children:[e.jsx(wr,{className:"w-4 h-4 mr-2"}),"Fertig"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{type:"info",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Möchten Sie die Monatsstart-Werte jetzt initialisieren?"}),e.jsx("p",{className:"text-sm opacity-80",children:"Die Startwerte werden als Basis für die monatliche Berechnung benötigt. Der berechnete Monatswert startet dann bei 0 und steigt mit der Zeit."})]})}),e.jsxs("div",{className:"space-y-3",children:[w?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(Re,{className:"w-4 h-4 animate-spin"}),"Prüfe HA-Statistik-Verfügbarkeit..."]}):j&&e.jsxs("div",{className:"p-4 border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200 mb-2",children:[e.jsx("strong",{children:"Empfohlen:"})," Startwerte aus HA-Langzeitstatistik laden"]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mb-3",children:"Verwendet die gespeicherten Zählerstände vom Monatsanfang aus der HA-Datenbank."}),e.jsx(he,{onClick:de,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2 animate-spin"}),"Lade aus HA-DB..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{className:"w-4 h-4 mr-2"}),"Aus HA-Statistik laden (empfohlen)"]})})]}),e.jsxs("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Aktuelle Sensor-Werte als Startwerte setzen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Verwendet die aktuellen Zählerstände. Der Monatswert startet dann bei 0."}),e.jsx(he,{variant:"secondary",onClick:re,disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2 animate-spin"}),"Initialisiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Aktuelle Werte verwenden"]})})]}),e.jsx(he,{variant:"secondary",onClick:ue,className:"mt-2",children:"Überspringen"})]})]})})]})});if(B.length===0)return e.jsx("div",{className:"p-6",children:e.jsx(ae,{type:"info",children:"Keine Konfiguration erforderlich. Bitte zuerst Investitionen (PV-Module, Speicher, etc.) anlegen."})});const Q=B[n];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sensor-Zuordnung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[N==null?void 0:N.anlage_name," - Home Assistant Sensoren konfigurieren"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(N==null?void 0:N.mapping)&&Object.keys(N.mapping).length>0&&e.jsxs(he,{variant:"secondary",onClick:()=>F(!0),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Mapping löschen"]}),e.jsx(he,{variant:"secondary",onClick:()=>t(-1),children:"Abbrechen"})]})]}),I&&e.jsx(ae,{type:"warning",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Sensor-Mapping wirklich löschen?"}),e.jsx("p",{className:"text-sm mt-1",children:"Alle Sensor-Zuordnungen und MQTT-Entities werden entfernt. Die Monatsdaten bleiben erhalten."})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(he,{variant:"secondary",size:"sm",onClick:()=>F(!1),disabled:V,children:"Abbrechen"}),e.jsx(he,{size:"sm",onClick:ee,disabled:V,className:"bg-red-600 hover:bg-red-700",children:V?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2 animate-spin"}),"Lösche..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Löschen"]})})]})]})}),e.jsx($,{padding:"sm",children:e.jsx("div",{className:"flex items-center overflow-x-auto py-2",children:B.map((U,je)=>{const Pe=je<n,Ae=je===n;return e.jsxs("div",{className:"flex items-center flex-shrink-0",children:[e.jsxs("button",{onClick:()=>i(je),className:`
                    flex items-center gap-2 px-3 py-2 rounded-lg transition-all
                    ${Ae?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":Pe?"text-green-600 dark:text-green-400 hover:bg-gray-100 dark:hover:bg-gray-700":"text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("div",{className:`
                      w-7 h-7 rounded-full flex items-center justify-center text-sm
                      ${Pe?"bg-green-500 text-white":Ae?"bg-amber-500 text-white":"bg-gray-200 dark:bg-gray-700"}
                    `,children:Pe?e.jsx(wr,{className:"w-4 h-4"}):je+1}),e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:U.title})]}),je<B.length-1&&e.jsx(ar,{className:"w-5 h-5 text-gray-300 dark:text-gray-600 mx-1"})]},U.id)})})}),e.jsxs($,{children:[e.jsx(Gl,{title:Q.title,subtitle:Q.id==="basis"?"Ordne die grundlegenden Energie-Sensoren zu":Q.id==="summary"?"Überprüfe deine Einstellungen":`Konfiguriere die Sensoren für ${((te=Q.investitionen)==null?void 0:te.length)||0} Komponente(n)`,action:e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[Q.icon,e.jsxs("span",{className:"text-sm",children:[n+1," / ",B.length]})]})}),e.jsxs("div",{className:"mt-6",children:[Q.id==="basis"&&e.jsx(B0,{value:o.basis,onChange:G,availableSensors:A}),Q.id==="pv"&&e.jsx(O0,{investitionen:Q.investitionen||[],mappings:o.investitionen,onChange:T,availableSensors:A,gesamtKwp:(N==null?void 0:N.gesamt_kwp)||0,basisPvGesamt:o.basis.pv_gesamt}),Q.id==="speicher"&&e.jsx(R0,{investitionen:Q.investitionen||[],mappings:o.investitionen,onChange:T,availableSensors:A}),Q.id==="wp"&&e.jsx(T0,{investitionen:Q.investitionen||[],mappings:o.investitionen,onChange:T,availableSensors:A}),Q.id==="eauto"&&e.jsx(K0,{investitionen:Q.investitionen||[],mappings:o.investitionen,onChange:T,availableSensors:A}),Q.id==="bkw"&&e.jsx(H0,{investitionen:Q.investitionen||[],mappings:o.investitionen,onChange:T,availableSensors:A}),Q.id==="summary"&&e.jsx(J0,{state:o,investitionen:(N==null?void 0:N.investitionen)||[]})]}),h&&e.jsxs(ae,{type:"error",className:"mt-6",children:[e.jsx(nt,{className:"w-4 h-4 inline mr-2"}),h]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(he,{variant:"secondary",onClick:K,disabled:!Be,children:[e.jsx(Nc,{className:"w-4 h-4 mr-2"}),"Zurück"]}),ie?e.jsx(he,{onClick:q,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vr,{className:"w-4 h-4 mr-2"}),"Speichern & Abschließen"]})}):e.jsxs(he,{onClick:se,children:["Weiter",e.jsx(ar,{className:"w-4 h-4 ml-2"})]})]})]})]})}const Y0=["","Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],nl={"pv-module":e.jsx(oe,{className:"w-5 h-5"}),speicher:e.jsx(Fe,{className:"w-5 h-5"}),waermepumpe:e.jsx(Br,{className:"w-5 h-5"}),"e-auto":e.jsx(Ve,{className:"w-5 h-5"}),wallbox:e.jsx(_e,{className:"w-5 h-5"})};function qn(){const{anlageId:t,jahr:r,monat:a}=uh(),s=pr(),[n,i]=m.useState(!0),[o,c]=m.useState(!1),[h,g]=m.useState(!1),[l,u]=m.useState(null),[x,d]=m.useState(null),[b,p]=m.useState(null),[y,f]=m.useState(""),[j,k]=m.useState(null),[w,_]=m.useState(0),[v,S]=m.useState({basis:{},optionale:{},investitionen:{}}),[V,C]=m.useState(r?parseInt(r):new Date().getFullYear()),[I,F]=m.useState(a?parseInt(a):new Date().getMonth()+1);m.useEffect(()=>{(async()=>{if(!t){try{const E=await At.list();E.length>0?s(`/monatsabschluss/${E[0].id}`):u("Keine Anlage gefunden")}catch{u("Fehler beim Laden der Anlagen")}i(!1);return}i(!0),u(null);try{let E=V,L=I;if(!r||!a){const G=await On.getNaechsterMonat(parseInt(t));G&&(E=G.jahr,L=G.monat,C(E),F(L))}const R=await On.getStatus(parseInt(t),E,L);k(R),f(R.anlage_name);const X={};for(const G of R.basis_felder)X[G.feld]=G.aktueller_wert;const O={};for(const G of R.optionale_felder||[])G.typ==="text"?O[G.feld]=G.aktueller_text:O[G.feld]=G.aktueller_wert;const B={};for(const G of R.investitionen){B[G.id]={};for(const T of G.felder)B[G.id][T.feld]=T.aktueller_wert}S({basis:X,optionale:O,investitionen:B})}catch(E){u("Fehler beim Laden der Monatsdaten"),console.error(E)}finally{i(!1)}})()},[t,r,a,V,I,s]);const M=m.useMemo(()=>{if(!j)return[];const P=[{id:"basis",title:"Zählerdaten",icon:e.jsx(_e,{className:"w-4 h-4"})}],E={};for(const L of j.investitionen)E[L.typ]||(E[L.typ]=[]),E[L.typ].push(L);for(const L of Object.keys(E))P.push({id:L,title:Rc(L),icon:nl[L]||e.jsx(_e,{className:"w-4 h-4"})});return j.optionale_felder&&j.optionale_felder.length>0&&P.push({id:"optionale",title:"Sonstiges",icon:e.jsx(Fn,{className:"w-4 h-4"})}),P.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(pt,{className:"w-4 h-4"})}),P},[j]),W=(P,E,L)=>{S(L?R=>({...R,investitionen:{...R.investitionen,[L]:{...R.investitionen[L],[P]:E}}}):R=>({...R,basis:{...R.basis,[P]:E}}))},N=(P,E)=>{S(L=>({...L,optionale:{...L.optionale,[P]:E}}))},z=async()=>{if(t){g(!0),u(null),p(null);try{if(!(await ur.getStatus()).verfuegbar){u("Home Assistant Datenbank nicht verfügbar");return}const E=await ur.getMonatswerte(parseInt(t),V,I);let L=0;const R={...v.basis};for(const O of E.basis)O.wert!==null&&O.wert!==void 0&&(R[O.feld]=O.wert,L++);const X={...v.investitionen};for(const O of E.investitionen){X[O.investition_id]||(X[O.investition_id]={});for(const B of O.felder)B.wert!==null&&B.wert!==void 0&&(X[O.investition_id][B.feld]=B.wert,L++)}S(O=>({...O,basis:R,investitionen:X})),p(`${L} Werte aus HA-Statistik geladen`)}catch(P){console.error(P),u("Fehler beim Laden der HA-Werte. Ist das Sensor-Mapping konfiguriert?")}finally{g(!1)}}},A=async()=>{if(!(!j||!t)){c(!0),u(null),d(null);try{const P={einspeisung_kwh:v.basis.einspeisung_kwh,netzbezug_kwh:v.basis.netzbezug_kwh,globalstrahlung_kwh_m2:v.basis.globalstrahlung_kwh_m2,sonnenstunden:v.basis.sonnenstunden,durchschnittstemperatur:v.basis.durchschnittstemperatur,sonderkosten_euro:typeof v.optionale.sonderkosten_euro=="number"?v.optionale.sonderkosten_euro:null,sonderkosten_beschreibung:typeof v.optionale.sonderkosten_beschreibung=="string"?v.optionale.sonderkosten_beschreibung:null,notizen:typeof v.optionale.notizen=="string"?v.optionale.notizen:null,investitionen:[]};for(const L of j.investitionen){const R=[],X=v.investitionen[L.id]||{};for(const[O,B]of Object.entries(X))B!=null&&R.push({feld:O,wert:B});R.length>0&&P.investitionen.push({investition_id:L.id,felder:R})}const E=await On.save(parseInt(t),V,I,P);E.success?(d(E.message),setTimeout(()=>{s("/einstellungen/monatsdaten")},2e3)):u("Speichern fehlgeschlagen")}catch(P){u("Fehler beim Speichern"),console.error(P)}finally{c(!1)}}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Re,{className:"w-8 h-8 animate-spin text-primary-500"})}):l&&!j?e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(ae,{type:"error",children:l})}):j?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(Mt,{className:"w-4 h-4"}),e.jsx("span",{children:y})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Monatsabschluss ",Y0[I]," ",V]}),j.ha_mapping_konfiguriert?e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsx("button",{onClick:z,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 animate-spin"}),"Lade HA-Werte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Jr,{className:"w-4 h-4"}),"Werte aus HA-Statistik laden"]})}),b&&e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:b})]}):e.jsx(ae,{type:"info",className:"mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Home Assistant Sensor-Zuordnung nicht konfiguriert. Werte müssen manuell eingegeben werden."}),e.jsxs(xh,{to:`/einstellungen/sensor-mapping?anlageId=${t}`,className:"flex items-center gap-1 text-primary-600 hover:underline",children:[e.jsx(Yi,{className:"w-4 h-4"}),"Konfigurieren"]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:M.map((P,E)=>e.jsxs("button",{onClick:()=>_(E),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w===E?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:[P.icon,e.jsx("span",{className:"hidden sm:inline",children:P.title})]},P.id))})}),l&&e.jsx(ae,{type:"error",className:"mb-6",children:l}),x&&e.jsx(ae,{type:"success",className:"mb-6",children:x}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-8",children:[w===0&&e.jsx(X0,{felder:j.basis_felder,values:v.basis,onChange:(P,E)=>W(P,E)}),w>0&&w<M.length-1&&M[w].id!=="optionale"&&e.jsx(eu,{typ:M[w].id,investitionen:j.investitionen.filter(P=>P.typ===M[w].id),values:v.investitionen,onChange:(P,E,L)=>W(E,L,P)}),M[w].id==="optionale"&&e.jsx(Q0,{felder:j.optionale_felder||[],values:v.optionale,onChange:N}),w===M.length-1&&e.jsx(tu,{data:j,values:v})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>_(P=>Math.max(0,P-1)),disabled:w===0,className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Nc,{className:"w-4 h-4"}),"Zurück"]}),w<M.length-1?e.jsxs("button",{onClick:()=>_(P=>Math.min(M.length-1,P+1)),className:"flex items-center gap-2 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:["Weiter",e.jsx(ar,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:A,disabled:o,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:o?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Jh,{className:"w-4 h-4"}),"Speichern"]})})]})]}):e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(ae,{type:"info",children:"Keine Daten verfügbar"})})}function X0({felder:t,values:r,onChange:a}){const s=["einspeisung_kwh","netzbezug_kwh"],n=["globalstrahlung_kwh_m2","sonnenstunden","durchschnittstemperatur"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 text-amber-500"}),"Zählerdaten"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.filter(i=>s.includes(i.feld)).map(i=>e.jsx(xi,{feld:i,value:r[i.feld],onChange:o=>a(i.feld,o)},i.feld))}),e.jsxs("details",{className:"mt-6",children:[e.jsx("summary",{className:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Wetterdaten (optional)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:t.filter(i=>n.includes(i.feld)).map(i=>e.jsx(xi,{feld:i,value:r[i.feld],onChange:o=>a(i.feld,o),compact:!0},i.feld))})]})]})}function Q0({felder:t,values:r,onChange:a}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Fn,{className:"w-5 h-5 text-gray-500"}),"Sonstiges"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Optionale Eingaben für diesen Monat - können auch leer bleiben."}),e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[s.label,s.einheit&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",s.einheit,")"]})]}),s.typ==="text"?e.jsx("textarea",{value:r[s.feld]||"",onChange:n=>a(s.feld,n.target.value||null),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:s.label}):e.jsx("input",{type:"number",step:"0.01",value:r[s.feld]??"",onChange:n=>a(s.feld,n.target.value?parseFloat(n.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:s.label})]},s.feld))})]})}function eu({typ:t,investitionen:r,values:a,onChange:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[nl[t],Rc(t)]}),r.map(n=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:n.bezeichnung})}),e.jsx("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:n.felder.map(i=>{var o;return e.jsx(xi,{feld:i,value:(o=a[n.id])==null?void 0:o[i.feld],onChange:c=>s(n.id,i.feld,c)},i.feld)})})]},n.id))]})}function tu({data:t,values:r}){var n,i;let a=0,s=0;for(const o of t.basis_felder)["einspeisung_kwh","netzbezug_kwh"].includes(o.feld)&&(s++,r.basis[o.feld]!==null&&r.basis[o.feld]!==void 0&&a++);for(const o of t.investitionen)for(const c of o.felder)s++,((n=r.investitionen[o.id])==null?void 0:n[c.feld])!==null&&((i=r.investitionen[o.id])==null?void 0:i[c.feld])!==void 0&&a++;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5 text-green-500"}),"Zusammenfassung"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[a," von ",s," Feldern ausgefüllt"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Zählerdaten"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:t.basis_felder.filter(o=>["einspeisung_kwh","netzbezug_kwh"].includes(o.feld)).map(o=>e.jsx(Jn,{label:o.label,wert:r.basis[o.feld],einheit:o.einheit},o.feld))})]}),t.investitionen.map(o=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[nl[o.typ],e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:o.felder.map(c=>{var h;return e.jsx(Jn,{label:c.label,wert:(h=r.investitionen[o.id])==null?void 0:h[c.feld],einheit:c.einheit},c.feld)})})]},o.id)),t.optionale_felder&&t.optionale_felder.length>0&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(Fn,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:t.optionale_felder.map(o=>e.jsx(Jn,{label:o.label,wert:(o.typ==="text",r.optionale[o.feld]),einheit:o.einheit,isText:o.typ==="text"},o.feld))})]})]})}function xi({feld:t,value:r,onChange:a,compact:s=!1}){const n=t.warnungen.length>0,i=t.vorschlaege.length>0;return e.jsxs("div",{className:s?"":"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.label,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t.einheit,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:r??"",onChange:o=>a(o.target.value?parseFloat(o.target.value):null),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${n?"border-amber-300 focus:border-amber-500":"border-gray-300"}`,placeholder:i?`Vorschlag: ${t.vorschlaege[0].wert}`:""}),i&&r===null&&e.jsx("button",{type:"button",onClick:()=>a(t.vorschlaege[0].wert),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400",children:"Übernehmen"})]}),i&&!s&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:t.vorschlaege.slice(0,3).map((o,c)=>e.jsxs("button",{type:"button",onClick:()=>a(o.wert),className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300",title:o.beschreibung,children:[o.wert," ",t.einheit,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",o.quelle,")"]})]},c))}),n&&e.jsx("div",{className:"mt-1",children:t.warnungen.map((o,c)=>e.jsxs("div",{className:`flex items-center gap-1 text-xs ${o.schwere==="error"?"text-red-600 dark:text-red-400":o.schwere==="warning"?"text-amber-600 dark:text-amber-400":"text-blue-600 dark:text-blue-400"}`,children:[o.schwere==="error"?e.jsx(ft,{className:"w-3 h-3"}):o.schwere==="warning"?e.jsx(ft,{className:"w-3 h-3"}):e.jsx(ot,{className:"w-3 h-3"}),o.meldung]},c))})]})}function Jn({label:t,wert:r,einheit:a,isText:s=!1}){const n=r!=null&&r!=="";return e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n?s?e.jsx("span",{className:"max-w-xs truncate",children:r}):e.jsxs(e.Fragment,{children:[typeof r=="number"?r.toLocaleString("de-DE",{maximumFractionDigits:1}):r," ",a]}):e.jsx("span",{className:"text-gray-400 italic",children:"nicht ausgefüllt"})})]})}function Rc(t){return{"pv-module":"PV-Module",speicher:"Speicher",waermepumpe:"Wärmepumpe","e-auto":"E-Auto",wallbox:"Wallbox",balkonkraftwerk:"Balkonkraftwerk"}[t]||t}function ru(){const t=pr(),[r,a]=m.useState([]),[s,n]=m.useState(null),[i,o]=m.useState(!0),[c,h]=m.useState(!1),[g,l]=m.useState(!1),[u,x]=m.useState(!1),[d,b]=m.useState(null),[p,y]=m.useState(null),[f,j]=m.useState(null),[k,w]=m.useState(null),[_,v]=m.useState(null),[S,V]=m.useState(new Set),[C,I]=m.useState(new Map),[F,M]=m.useState("alle"),[W,N]=m.useState(new Map);m.useEffect(()=>{(async()=>{try{const q=await At.list();a(q.map(re=>({id:re.id,anlagenname:re.anlagenname}))),q.length>0&&n(q[0].id)}catch(q){w("Fehler beim Laden der Anlagen"),console.error(q)}finally{o(!1)}})()},[]),m.useEffect(()=>{(async()=>{h(!0);try{const q=await ur.getStatus();b(q.verfuegbar),y(q.fehler||null)}catch(q){b(!1),y("Fehler bei der Statusprüfung"),console.error(q)}finally{h(!1)}})()},[]);const z=async()=>{if(s){l(!0),w(null),j(null),I(new Map),N(new Map);try{const T=await ur.getImportVorschau(s);j(T);const q=new Map,re=new Map;T.monate.forEach(de=>{const ue=`${de.jahr}-${de.monat}`;q.set(ue,de.aktion==="importieren"||de.aktion==="konflikt");const ee=new Set(Object.keys(de.ha_werte)),pe=new Map;de.investitionen&&de.investitionen.forEach(Be=>{pe.set(Be.investition_id,new Set(Object.keys(Be.ha_werte)))}),re.set(ue,{basis:ee,investitionen:pe})}),I(q),N(re)}catch(T){w("Fehler beim Laden der Vorschau"),console.error(T)}finally{l(!1)}}},A=(T,q)=>{const re=`${T}-${q}`,de=new Map(C);de.set(re,!de.get(re)),I(de)},P=(T,q,re)=>{const de=`${T}-${q}`,ue=new Map(W),ee=ue.get(de)||{basis:new Set,investitionen:new Map},pe=new Set(ee.basis);pe.has(re)?pe.delete(re):pe.add(re),ue.set(de,{...ee,basis:pe}),N(ue),M("manuell")},E=(T,q,re,de)=>{const ue=`${T}-${q}`,ee=new Map(W),pe=ee.get(ue)||{basis:new Set,investitionen:new Map},Be=new Map(pe.investitionen),ie=new Set(Be.get(re)||[]);ie.has(de)?ie.delete(de):ie.add(de),Be.set(re,ie),ee.set(ue,{...pe,investitionen:Be}),N(ee),M("manuell")},L=T=>{if(M(T),!f)return;const q=new Map;f.monate.forEach(re=>{var pe,Be;const de=`${re.jahr}-${re.monat}`;let ue=new Set;const ee=new Map;switch(T){case"alle":ue=new Set(Object.keys(re.ha_werte)),(pe=re.investitionen)==null||pe.forEach(se=>{ee.set(se.investition_id,new Set(Object.keys(se.ha_werte)))});break;case"nur_basis":ue=new Set(Object.keys(re.ha_werte));break;case"nur_komponenten":(Be=re.investitionen)==null||Be.forEach(se=>{ee.set(se.investition_id,new Set(Object.keys(se.ha_werte)))});break;case"manuell":const ie=W.get(de);if(ie){q.set(de,ie);return}break}q.set(de,{basis:ue,investitionen:ee})}),N(q)},R=(f==null?void 0:f.monate.filter(T=>{const q=`${T.jahr}-${T.monat}`;return C.get(q)&&T.aktion!=="ueberspringen"}).length)||0,X=async()=>{if(!s||!f)return;const T=f.monate.filter(q=>{const re=`${q.jahr}-${q.monat}`;return C.get(re)&&q.aktion!=="ueberspringen"}).map(q=>{const re=`${q.jahr}-${q.monat}`,de=W.get(re),ue=de!=null&&de.basis.size?Array.from(de.basis):[],ee={};return de==null||de.investitionen.forEach((pe,Be)=>{pe.size>0&&(ee[String(Be)]=Array.from(pe))}),{jahr:q.jahr,monat:q.monat,basis_felder:ue.length>0?ue:[],investition_felder:Object.keys(ee).length>0?ee:{}}}).filter(q=>q.basis_felder&&q.basis_felder.length>0||q.investition_felder&&Object.keys(q.investition_felder).length>0);if(T.length===0){w("Keine Felder zum Import ausgewählt");return}x(!0),w(null),v(null);try{const q=await ur.importieren(s,{monate:T,ueberschreiben:!0});q.erfolg?(v(`Import erfolgreich: ${q.importiert} Monate importiert`+(q.uebersprungen>0?`, ${q.uebersprungen} übersprungen`:"")+(q.ueberschrieben>0?`, ${q.ueberschrieben} überschrieben`:"")+(q.fehler.length>0?`, ${q.fehler.length} Fehler`:"")),await z()):w(q.fehler.join(", ")||"Import fehlgeschlagen")}catch(q){w("Fehler beim Import"),console.error(q)}finally{x(!1)}},O=T=>{const q=new Set(S);q.has(T)?q.delete(T):q.add(T),V(q)},B=T=>{switch(T){case"importieren":return e.jsx(pt,{className:"w-4 h-4 text-green-500"});case"ueberspringen":return e.jsx(gt,{className:"w-4 h-4 text-gray-400"});case"konflikt":return e.jsx(ft,{className:"w-4 h-4 text-amber-500"});case"ueberschreiben":return e.jsx(ft,{className:"w-4 h-4 text-red-500"});default:return e.jsx(ot,{className:"w-4 h-4 text-blue-500"})}},G=T=>{const q={importieren:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",ueberspringen:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400",konflikt:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300",ueberschreiben:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},re={importieren:"Importieren",ueberspringen:"Übersprungen",konflikt:"Konflikt",ueberschreiben:"Überschreiben"};return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${q[T]||""}`,children:re[T]||T})};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Re,{className:"w-8 h-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(Jr,{className:"w-7 h-7 text-primary-500"}),"HA-Statistik Import"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Importiere historische Monatsdaten aus der Home Assistant Langzeitstatistik-Datenbank."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Datenbank-Status"}),c?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(Re,{className:"w-5 h-5 animate-spin"}),"Prüfe Verbindung..."]}):d?e.jsx(ae,{type:"success",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-5 h-5"}),"Home Assistant Datenbank ist verfügbar"]})}):e.jsx(ae,{type:"error",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5"}),"Home Assistant Datenbank nicht verfügbar"]}),p&&e.jsx("p",{className:"text-sm",children:p}),e.jsxs("p",{className:"text-sm",children:["Stellen Sie sicher, dass das Add-on mit ",e.jsx("code",{children:"config:ro"})," Volume-Mapping installiert ist. Siehe CHANGELOG v2.0.0 für Upgrade-Anleitung."]})]})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Anlage auswählen"}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage"}),e.jsx("select",{value:s||"",onChange:T=>{n(Number(T.target.value)),j(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:r.map(T=>e.jsx("option",{value:T.id,children:T.anlagenname},T.id))})]}),e.jsx("button",{onClick:z,disabled:!s||g,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 animate-spin"}),"Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4"}),"Vorschau laden"]})})]}),!f&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:"Wichtig: Stellen Sie sicher, dass das Sensor-Mapping für diese Anlage konfiguriert ist, damit die HA-Sensoren den EEDC-Feldern zugeordnet werden können."})]}),k&&e.jsx(ae,{type:"error",className:"mb-6",children:k}),_&&e.jsx(ae,{type:"success",className:"mb-6",children:_}),f&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Import-Vorschau"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Ws,{label:"Verfügbare Monate",value:f.anzahl_monate,color:"blue"}),e.jsx(Ws,{label:"Zum Import",value:f.anzahl_importieren,color:"green"}),e.jsx(Ws,{label:"Konflikte",value:f.anzahl_konflikte,color:"amber"}),e.jsx(Ws,{label:"Übersprungen",value:f.anzahl_ueberspringen,color:"gray"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Import-Modus"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>L("alle"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${F==="alle"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Alles importieren"}),e.jsx("button",{onClick:()=>L("nur_basis"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${F==="nur_basis"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Nur Basis (Einspeisung/Netzbezug)"}),e.jsx("button",{onClick:()=>L("nur_komponenten"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${F==="nur_komponenten"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Nur Komponenten"}),F==="manuell"&&e.jsx("span",{className:"px-3 py-1.5 text-sm rounded-lg bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 border border-amber-300 dark:border-amber-700",children:"Manuell (individuelle Auswahl)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Klicken Sie auf einzelne Felder in der Vorschau, um die Auswahl anzupassen."})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Hinweis:"})," Wählen Sie die Monate und Felder aus, die importiert werden sollen. Bei Konflikten (gelb markiert) werden nur die ausgewählten Felder überschrieben."]})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden mb-6",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:f.monate.map(T=>{const q=`${T.jahr}-${T.monat}`;return e.jsx(au,{monat:T,expanded:S.has(q),onToggle:()=>O(q),getAktionIcon:B,getAktionBadge:G,selected:C.get(q)||!1,onSelectionChange:()=>A(T.jahr,T.monat),feldAuswahl:W.get(q),onToggleBasisFeld:re=>P(T.jahr,T.monat,re),onToggleInvFeld:(re,de)=>E(T.jahr,T.monat,re,de)},q)})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:X,disabled:u||R===0,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2 font-medium",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5 animate-spin"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-5 h-5"}),R," Monate importieren"]})})})]})]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx("button",{onClick:()=>t("/einstellungen/sensor-mapping"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"← Zurück zu Sensor-Zuordnung"}),e.jsx("button",{onClick:()=>t("/einstellungen/monatsdaten"),className:"text-primary-600 hover:text-primary-700",children:"Zu Monatsdaten →"})]})]})}function Ws({label:t,value:r,color:a}){const s={blue:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400",green:"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400",amber:"bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400",gray:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400"};return e.jsxs("div",{className:`p-4 rounded-lg ${s[a]}`,children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),e.jsx("div",{className:"text-sm",children:t})]})}function au({monat:t,expanded:r,onToggle:a,getAktionIcon:s,getAktionBadge:n,selected:i,onSelectionChange:o,feldAuswahl:c,onToggleBasisFeld:h,onToggleInvFeld:g}){const l=t.aktion!=="ueberspringen",u=Object.keys(t.ha_werte).length>0||t.vorhandene_werte&&Object.keys(t.vorhandene_werte).length>0||t.investitionen&&t.investitionen.length>0;return e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"px-3 py-3",children:l?e.jsx("input",{type:"checkbox",checked:i,onChange:x=>{x.stopPropagation(),o()},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("button",{onClick:a,className:"flex-1 px-2 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u?r?e.jsx(zr,{className:"w-4 h-4 text-gray-400"}):e.jsx(ar,{className:"w-4 h-4 text-gray-400"}):e.jsx("div",{className:"w-4"}),e.jsx(Mt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.monat_name," ",t.jahr]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s(t.aktion),n(t.aktion)]})]})]}),r&&u&&e.jsxs("div",{className:"px-4 pb-4 pt-2 bg-gray-50 dark:bg-gray-700/30",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t.grund}),(Object.keys(t.ha_werte).length>0||t.vorhandene_werte&&Object.keys(t.vorhandene_werte).length>0)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Basis-Werte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"w-8 py-1"}),e.jsx("th",{className:"text-left py-1 pr-4 font-medium text-gray-600 dark:text-gray-300",children:"Feld"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-gray-600 dark:text-gray-300",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-blue-600 dark:text-blue-400",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-1 pl-2 font-medium text-gray-600 dark:text-gray-300",children:"Diff"})]})}),e.jsx("tbody",{children:Object.keys(t.ha_werte).map(x=>{var j;const d=t.ha_werte[x],b=((j=t.vorhandene_werte)==null?void 0:j[x])??null,p=d!==null&&b!==null?d-b:null,y=p!==null&&Math.abs(p)>=1,f=(c==null?void 0:c.basis.has(x))??!0;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 ${y?"bg-amber-50/50 dark:bg-amber-900/10":""} ${f?"":"opacity-50"}`,onClick:()=>h(x),children:[e.jsx("td",{className:"py-1 pl-2",children:e.jsx("input",{type:"checkbox",checked:f,onChange:()=>{},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"py-1 pr-4 text-gray-700 dark:text-gray-300",children:x}),e.jsx("td",{className:"py-1 px-2 text-right text-gray-600 dark:text-gray-400",children:b!=null?b.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:"py-1 px-2 text-right font-medium text-blue-700 dark:text-blue-300",children:d!==null?d.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:`py-1 pl-2 text-right ${y?"font-medium text-amber-600 dark:text-amber-400":"text-gray-500"}`,children:p!==null?(p>=0?"+":"")+p.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"})]},x)})})]})})]}),t.investitionen&&t.investitionen.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Komponenten"}),t.investitionen.map(x=>{const d=c==null?void 0:c.investitionen.get(x.investition_id);return e.jsxs("div",{className:`rounded-lg border p-3 ${x.hat_abweichung?"border-amber-300 dark:border-amber-700 bg-amber-50/50 dark:bg-amber-900/10":"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:x.bezeichnung}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:x.typ}),x.hat_abweichung&&e.jsx(ft,{className:"w-4 h-4 text-amber-500"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"w-8 py-1"}),e.jsx("th",{className:"text-left py-1 pr-4 font-medium text-gray-600 dark:text-gray-300",children:"Feld"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-gray-600 dark:text-gray-300",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-blue-600 dark:text-blue-400",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-1 pl-2 font-medium text-gray-600 dark:text-gray-300",children:"Diff"})]})}),e.jsx("tbody",{children:Object.keys(x.ha_werte).map(b=>{const p=x.ha_werte[b],y=x.vorhandene_werte[b],f=p!==null&&y!==null?p-y:null,j=f!==null&&Math.abs(f)>=1,k=(d==null?void 0:d.has(b))??!0;return e.jsxs("tr",{className:`cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 ${j?"bg-amber-50/30 dark:bg-amber-900/5":""} ${k?"":"opacity-50"}`,onClick:()=>g(x.investition_id,b),children:[e.jsx("td",{className:"py-1 pl-2",children:e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"py-1 pr-4 text-gray-700 dark:text-gray-300",children:b}),e.jsx("td",{className:"py-1 px-2 text-right text-gray-600 dark:text-gray-400",children:y!=null?y.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:"py-1 px-2 text-right font-medium text-blue-700 dark:text-blue-300",children:p!==null?p.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:`py-1 pl-2 text-right ${j?"font-medium text-amber-600 dark:text-amber-400":"text-gray-500"}`,children:f!==null?(f>=0?"+":"")+f.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"})]},b)})})]})})]},x.investition_id)})]})]})]})}const su={BW:"Baden-Württemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thüringen",AT:"Österreich",CH:"Schweiz",XX:"Unbekannt"};function nu(){const t=pr(),[r,a]=m.useState([]),[s,n]=m.useState(null),[i,o]=m.useState(null),[c,h]=m.useState(null),[g,l]=m.useState(null),[u,x]=m.useState(!0),[d,b]=m.useState(!1),[p,y]=m.useState(!1),[f,j]=m.useState(!1),[k,w]=m.useState(null),[_,v]=m.useState(!1),[S,V]=m.useState(!1),[C,I]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const N=await At.list();a(N),N.length===1&&n(N[0].id)}catch(N){const z=N instanceof Error?N.message:"Fehler beim Laden";w(z)}finally{x(!1)}})()},[]),m.useEffect(()=>{(async()=>{try{const N=await tt.getStatus();o(N)}catch{o({online:!1,url:"https://energy.raunet.eu",error:"Nicht erreichbar"})}})()},[]),m.useEffect(()=>{if(!s){h(null);return}(async()=>{b(!0),w(null);try{const N=await tt.getPreview(s);h(N)}catch(N){const z=N instanceof Error?N.message:"Fehler beim Laden der Vorschau";w(z)}finally{b(!1)}})()},[s]);const F=async()=>{if(s){y(!0),w(null);try{const W=await tt.share(s);l(W)}catch(W){const N=W instanceof Error?W.message:"Fehler beim Teilen";w(N)}finally{y(!1)}}},M=async()=>{if(s){j(!0),w(null);try{const W=await tt.delete(s);if(W.success){const N=await tt.getPreview(s);h(N),V(!1),w(null),alert(`Gelöscht! ${W.anzahl_geloeschte_monate} Monatswerte wurden entfernt.`)}}catch(W){const N=W instanceof Error?W.message:"Fehler beim Löschen";w(N)}finally{j(!1)}}};if(u)return e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx(Re,{className:"h-8 w-8 animate-spin text-blue-500"})});if(r.length===0)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-yellow-800",children:"Keine Anlagen vorhanden. Bitte zuerst eine Anlage anlegen."})})});if(g!=null&&g.success){const W=g.benchmark,N=W?(W.spez_ertrag_anlage-W.spez_ertrag_durchschnitt)/W.spez_ertrag_durchschnitt*100:0;return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx(pt,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"Vielen Dank für deinen Beitrag!"}),e.jsxs("p",{className:"text-green-700",children:[g.anzahl_monate," Monatswerte wurden mit der Community geteilt."]})]}),W&&e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-orange-50 px-4 py-3 border-b",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Tt,{className:"h-5 w-5 text-orange-500"}),"Dein Anlagenvergleich"]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Dein spezifischer Ertrag"}),e.jsxs("p",{className:"text-4xl font-bold text-orange-500",children:[W.spez_ertrag_anlage.toFixed(0),e.jsx("span",{className:"text-lg font-normal text-gray-500 ml-1",children:"kWh/kWp"})]}),e.jsxs("p",{className:`text-sm mt-1 ${N>=0?"text-green-600":"text-red-600"}`,children:[N>=0?"+":"",N.toFixed(1),"% vs. Durchschnitt"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Durchschnitt"}),e.jsxs("p",{className:"text-lg font-semibold",children:[W.spez_ertrag_durchschnitt.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Region"}),e.jsxs("p",{className:"text-lg font-semibold",children:[W.spez_ertrag_region.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ma,{className:"h-4 w-4 text-yellow-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Rang gesamt"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["#",W.rang_gesamt," ",e.jsxs("span",{className:"text-sm text-gray-400",children:["/ ",W.anzahl_anlagen_gesamt]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(_t,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Rang Region"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["#",W.rang_region," ",e.jsxs("span",{className:"text-sm text-gray-400",children:["/ ",W.anzahl_anlagen_region]})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[e.jsxs("a",{href:g!=null&&g.anlage_hash?`${(c==null?void 0:c.community_url)||"https://energy.raunet.eu"}?anlage=${g.anlage_hash}`:(c==null?void 0:c.community_url)||"https://energy.raunet.eu",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-5 py-2.5 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium",children:[e.jsx(Ir,{className:"h-4 w-4"}),"Dein persönliches Benchmark öffnen"]}),e.jsxs("button",{onClick:()=>{l(null),h(null),s&&tt.getPreview(s).then(h)},className:"inline-flex items-center gap-2 px-5 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:[e.jsx(gr,{className:"h-4 w-4"}),"Erneut teilen"]}),e.jsx("button",{onClick:()=>t("/"),className:"px-5 py-2.5 text-gray-500 hover:text-gray-700",children:"Zum Dashboard"})]})]})}return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Uh,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Mit Community teilen"}),e.jsx("p",{className:"text-gray-500",children:"Teile deine anonymisierten Anlagendaten mit der PV-Community"})]})]}),r.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anlage auswählen"}),e.jsxs("select",{value:s||"",onChange:W=>n(Number(W.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"-- Anlage wählen --"}),r.map(W=>e.jsx("option",{value:W.id,children:W.anlagenname},W.id))]})]}),e.jsx("div",{className:`p-4 rounded-lg border ${i!=null&&i.online?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[i!=null&&i.online?e.jsx(pt,{className:"h-5 w-5 text-green-500"}):e.jsx(nt,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:i!=null&&i.online?"text-green-800":"text-red-800",children:["Community-Server: ",i!=null&&i.online?"Online":"Offline"]}),(i==null?void 0:i.version)&&e.jsxs("p",{className:"text-sm text-green-600",children:["Version ",i.version]}),(i==null?void 0:i.error)&&e.jsx("p",{className:"text-sm text-red-600",children:i.error})]})]})}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:k})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($c,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Datenschutz"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Keine persönlichen Daten (Name, Adresse) werden übertragen"}),e.jsx("li",{children:"• PLZ wird auf Bundesland reduziert"}),e.jsx("li",{children:"• Nur aggregierte Monatswerte"}),e.jsx("li",{children:"• Daten sind anonym und können nicht zu dir zurückverfolgt werden"})]})]})]})}),!(c!=null&&c.bereits_geteilt)&&(c==null?void 0:c.anzahl_monate)&&c.anzahl_monate>0&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:W=>I(W.target.checked),className:"mt-1 h-4 w-4 text-orange-500 border-gray-300 rounded focus:ring-orange-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Ich stimme der anonymen Übertragung meiner PV-Anlagendaten an die EEDC Community zu. Die Daten werden gemäß der"," ",e.jsx("a",{href:"https://energy.raunet.eu/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline",children:"Datenschutzerklärung"})," ","verarbeitet. Ich kann meine Daten jederzeit löschen."]})]})}),d&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Re,{className:"h-6 w-6 animate-spin text-orange-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Lade Vorschau..."})]}),c&&!d&&e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>v(!_),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bh,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Datenvorschau"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:_?"Ausblenden":"Anzeigen"})]}),_&&e.jsxs("div",{className:"border-t p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Region"}),e.jsx("p",{className:"font-medium",children:su[c.vorschau.region]||c.vorschau.region})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Leistung"}),e.jsxs("p",{className:"font-medium",children:[c.vorschau.kwp," kWp"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ausrichtung"}),e.jsx("p",{className:"font-medium capitalize",children:c.vorschau.ausrichtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Neigung"}),e.jsxs("p",{className:"font-medium",children:[c.vorschau.neigung_grad,"°"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.vorschau.speicher_kwh&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded text-sm",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Speicher (",c.vorschau.speicher_kwh," kWh)"]}),c.vorschau.hat_waermepumpe&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm",children:[e.jsx(lt,{className:"h-4 w-4"}),"Wärmepumpe"]}),c.vorschau.hat_eauto&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm",children:[e.jsx(Ve,{className:"h-4 w-4"}),"E-Auto"]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:c.anzahl_monate})," Monatswerte werden geteilt",c.vorschau.monatswerte.length>0&&e.jsxs("span",{className:"text-gray-400",children:[" ","(von ",c.vorschau.monatswerte[0].monat,"/",c.vorschau.monatswerte[0].jahr," ","bis ",c.vorschau.monatswerte[c.vorschau.monatswerte.length-1].monat,"/",c.vorschau.monatswerte[c.vorschau.monatswerte.length-1].jahr,")"]})]})})]})]}),(c==null?void 0:c.bereits_geteilt)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Bereits mit Community geteilt"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Deine Daten sind bereits im Community-Dashboard sichtbar. Du kannst sie aktualisieren oder löschen."})]})]}),e.jsx("button",{onClick:()=>V(!0),className:"text-red-600 hover:text-red-800 p-1",title:"Daten löschen",children:e.jsx(Pt,{className:"h-5 w-5"})})]})}),S&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2",children:"Daten wirklich löschen?"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"Alle deine geteilten Daten werden vom Community-Server entfernt. Dies kann nicht rückgängig gemacht werden."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:M,disabled:f,className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin"}),"Wird gelöscht..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"h-4 w-4"}),"Ja, löschen"]})}),e.jsx("button",{onClick:()=>V(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Abbrechen"})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:F,disabled:!(i!=null&&i.online)||p||!(c!=null&&c.anzahl_monate)||!s||!(c!=null&&c.bereits_geteilt)&&!C,className:`
            inline-flex items-center gap-2 px-6 py-3 rounded-lg text-lg font-medium
            ${i!=null&&i.online&&(c!=null&&c.anzahl_monate)&&s&&(c!=null&&c.bereits_geteilt||C)?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}
          `,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-5 w-5 animate-spin"}),"Wird geteilt..."]}):c!=null&&c.bereits_geteilt?e.jsxs(e.Fragment,{children:[e.jsx(gr,{className:"h-5 w-5"}),"Daten aktualisieren"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ac,{className:"h-5 w-5"}),"Jetzt anonym teilen"]})})}),!(c!=null&&c.anzahl_monate)&&s&&!d&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Keine Monatsdaten vorhanden. Bitte zuerst Daten erfassen."}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("a",{href:(c==null?void 0:c.community_url)||"https://energy.raunet.eu",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(Ir,{className:"h-4 w-4"}),"Community-Dashboard ansehen"]})})]})}const iu={BW:"Baden-Württemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thüringen",AT:"Österreich",CH:"Schweiz"},Kr={solarprofi:{name:"Solarprofi",beschreibung:"Top 10% beim spezifischen Ertrag",icon:e.jsx(oe,{className:"h-5 w-5"}),farbe:"yellow"},autarkiemeister:{name:"Autarkiemeister",beschreibung:"Autarkiegrad über 80%",icon:e.jsx($c,{className:"h-5 w-5"}),farbe:"green"},effizienzwunder:{name:"Effizienzwunder",beschreibung:"Speicher-Wirkungsgrad über 90%",icon:e.jsx(Fe,{className:"h-5 w-5"}),farbe:"emerald"},waermekoenig:{name:"Wärmekönig",beschreibung:"Wärmepumpe JAZ über 4.0",icon:e.jsx(lt,{className:"h-5 w-5"}),farbe:"blue"},gruenerfahrer:{name:"Grüner Fahrer",beschreibung:"E-Auto PV-Ladeanteil über 70%",icon:e.jsx(Ve,{className:"h-5 w-5"}),farbe:"purple"},regionalchampion:{name:"Regionalchampion",beschreibung:"Top 3 in deiner Region",icon:e.jsx(_t,{className:"h-5 w-5"}),farbe:"cyan"},dauerbrenner:{name:"Dauerbrenner",beschreibung:"12 Monate in Folge über Durchschnitt",icon:e.jsx(Qe,{className:"h-5 w-5"}),farbe:"orange"}};function lu({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(!1),[o,c]=m.useState(null);m.useEffect(()=>{(async()=>{i(!0),c(null);try{const b=await tt.getBenchmark(t,r);s(b)}catch(b){c(b instanceof Error?b.message:"Fehler beim Laden")}finally{i(!1)}})()},[t,r]);const h=m.useMemo(()=>{if(!a)return null;const{rang_gesamt:d,anzahl_anlagen_gesamt:b}=a.benchmark,p=d/b*100;return p<=10?{label:"Top 10%",color:"bg-yellow-500",textColor:"text-yellow-500"}:p<=25?{label:"Top 25%",color:"bg-gray-400",textColor:"text-gray-500"}:p<=50?{label:"Top 50%",color:"bg-amber-700",textColor:"text-amber-700"}:null},[a]),g=m.useMemo(()=>{var E,L,R,X;if(!a)return{erreichte:[],nichtErreichte:[]};const d=[],b=[],{rang_gesamt:p,anzahl_anlagen_gesamt:y,rang_region:f,anzahl_anlagen_region:j}=a.benchmark,k=p/y*100,w=k<=10,_={id:"solarprofi",...Kr.solarprofi,erreicht:w,fortschritt:w?100:Math.max(0,100-k)};w?d.push(_):b.push(_);const v=f<=3,S={id:"regionalchampion",...Kr.regionalchampion,erreicht:v,fortschritt:v?100:Math.max(0,(1-f/Math.min(10,j))*100)};v?d.push(S):b.push(S);const V=(E=a.anlage.monatswerte)==null?void 0:E[a.anlage.monatswerte.length-1];if((V==null?void 0:V.autarkie_prozent)!==void 0&&V.autarkie_prozent!==null){const O=V.autarkie_prozent>=80,B={id:"autarkiemeister",...Kr.autarkiemeister,erreicht:O,fortschritt:O?100:V.autarkie_prozent/80*100};O?d.push(B):b.push(B)}const C=(L=a.benchmark_erweitert)==null?void 0:L.speicher;if(C!=null&&C.wirkungsgrad){const O=C.wirkungsgrad.wert>=90,B={id:"effizienzwunder",...Kr.effizienzwunder,erreicht:O,fortschritt:O?100:C.wirkungsgrad.wert/90*100};O?d.push(B):b.push(B)}const I=(R=a.benchmark_erweitert)==null?void 0:R.waermepumpe;if(I!=null&&I.jaz){const O=I.jaz.wert>=4,B={id:"waermekoenig",...Kr.waermekoenig,erreicht:O,fortschritt:O?100:I.jaz.wert/4*100};O?d.push(B):b.push(B)}const F=(X=a.benchmark_erweitert)==null?void 0:X.eauto;if(F!=null&&F.pv_anteil){const O=F.pv_anteil.wert>=70,B={id:"gruenerfahrer",...Kr.gruenerfahrer,erreicht:O,fortschritt:O?100:F.pv_anteil.wert/70*100};O?d.push(B):b.push(B)}const W=(a.anlage.monatswerte||[]).slice(-12),N=a.benchmark.spez_ertrag_durchschnitt/12;let z=0;for(const O of W)(O.spez_ertrag_kwh_kwp||0)>N&&z++;const A=z===12&&W.length===12,P={id:"dauerbrenner",...Kr.dauerbrenner,erreicht:A,fortschritt:W.length>0?z/Math.max(12,W.length)*100:0};return A?d.push(P):W.length>=6&&b.push(P),{erreichte:d,nichtErreichte:b}},[a]),{staerken:l,schwaechen:u}=m.useMemo(()=>{var j,k,w,_,v,S,V,C,I,F,M,W;if(!a)return{staerken:[],schwaechen:[]};const d=[],b=(a.benchmark.spez_ertrag_anlage-a.benchmark.spez_ertrag_durchschnitt)/a.benchmark.spez_ertrag_durchschnitt*100;if(d.push({label:"PV-Ertrag",abweichungProzent:b,icon:e.jsx(oe,{className:"h-4 w-4"}),kategorie:"pv"}),(j=a.benchmark_erweitert)!=null&&j.speicher){const N=a.benchmark_erweitert.speicher;if((k=N.wirkungsgrad)!=null&&k.community_avg){const z=(N.wirkungsgrad.wert-N.wirkungsgrad.community_avg)/N.wirkungsgrad.community_avg*100;d.push({label:"Speicher-Effizienz",abweichungProzent:z,icon:e.jsx(Fe,{className:"h-4 w-4"}),kategorie:"speicher"})}if((w=N.netz_anteil)!=null&&w.community_avg){const z=(N.netz_anteil.community_avg-N.netz_anteil.wert)/N.netz_anteil.community_avg*100;d.push({label:"PV-Ladeanteil Speicher",abweichungProzent:z,icon:e.jsx(_e,{className:"h-4 w-4"}),kategorie:"speicher"})}}if((S=(v=(_=a.benchmark_erweitert)==null?void 0:_.waermepumpe)==null?void 0:v.jaz)!=null&&S.community_avg){const N=a.benchmark_erweitert.waermepumpe,z=(N.jaz.wert-N.jaz.community_avg)/N.jaz.community_avg*100;d.push({label:"Wärmepumpe JAZ",abweichungProzent:z,icon:e.jsx(lt,{className:"h-4 w-4"}),kategorie:"waermepumpe"})}if((I=(C=(V=a.benchmark_erweitert)==null?void 0:V.eauto)==null?void 0:C.pv_anteil)!=null&&I.community_avg){const N=a.benchmark_erweitert.eauto,z=(N.pv_anteil.wert-N.pv_anteil.community_avg)/N.pv_anteil.community_avg*100;d.push({label:"E-Auto PV-Anteil",abweichungProzent:z,icon:e.jsx(Ve,{className:"h-4 w-4"}),kategorie:"eauto"})}if((W=(M=(F=a.benchmark_erweitert)==null?void 0:F.wallbox)==null?void 0:M.pv_anteil)!=null&&W.community_avg){const N=a.benchmark_erweitert.wallbox,z=(N.pv_anteil.wert-N.pv_anteil.community_avg)/N.pv_anteil.community_avg*100;d.push({label:"Wallbox PV-Anteil",abweichungProzent:z,icon:e.jsx(Kt,{className:"h-4 w-4"}),kategorie:"wallbox"})}const p=[...d].sort((N,z)=>z.abweichungProzent-N.abweichungProzent),y=p.filter(N=>N.abweichungProzent>0).slice(0,3),f=p.filter(N=>N.abweichungProzent<0).slice(-3).reverse();return{staerken:y,schwaechen:f}},[a]),x=m.useMemo(()=>{var y,f,j,k,w,_,v,S,V,C;if(!a)return[];const d=[],b=Math.max(a.benchmark.spez_ertrag_anlage,a.benchmark.spez_ertrag_durchschnitt)*1.2;d.push({kategorie:"PV-Ertrag",du:a.benchmark.spez_ertrag_anlage/b*100,community:a.benchmark.spez_ertrag_durchschnitt/b*100,fullMark:100});const p=(y=a.anlage.monatswerte)==null?void 0:y[a.anlage.monatswerte.length-1];if(p!=null&&p.autarkie_prozent&&d.push({kategorie:"Autarkie",du:p.autarkie_prozent,community:65,fullMark:100}),p!=null&&p.eigenverbrauch_prozent&&d.push({kategorie:"Eigenverbrauch",du:p.eigenverbrauch_prozent,community:45,fullMark:100}),(k=(j=(f=a.benchmark_erweitert)==null?void 0:f.speicher)==null?void 0:j.wirkungsgrad)!=null&&k.community_avg){const I=a.benchmark_erweitert.speicher;d.push({kategorie:"Speicher",du:I.wirkungsgrad.wert,community:I.wirkungsgrad.community_avg,fullMark:100})}if((v=(_=(w=a.benchmark_erweitert)==null?void 0:w.waermepumpe)==null?void 0:_.jaz)!=null&&v.community_avg){const I=a.benchmark_erweitert.waermepumpe,F=Math.max(I.jaz.wert,I.jaz.community_avg)*1.2;d.push({kategorie:"WP-Effizienz",du:I.jaz.wert/F*100,community:I.jaz.community_avg/F*100,fullMark:100})}if((C=(V=(S=a.benchmark_erweitert)==null?void 0:S.eauto)==null?void 0:V.pv_anteil)!=null&&C.community_avg){const I=a.benchmark_erweitert.eauto;d.push({kategorie:"E-Auto PV",du:I.pv_anteil.wert,community:I.pv_anteil.community_avg,fullMark:100})}return d},[a]);return n?e.jsx(Me,{text:"Lade Community-Daten..."}):o?e.jsx(ae,{type:"error",children:o}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ma,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Dein PV-Ertrag im Vergleich"}),h&&e.jsxs("span",{className:`ml-2 px-3 py-1 rounded-full text-white text-sm font-medium ${h.color}`,children:[e.jsx(fa,{className:"h-4 w-4 inline mr-1"}),h.label]}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center md:col-span-1",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Dein spez. Ertrag"}),e.jsx("p",{className:"text-4xl font-bold text-primary-500",children:a.benchmark.spez_ertrag_anlage.toFixed(0)}),e.jsx("p",{className:"text-gray-500",children:"kWh/kWp"}),e.jsx(ou,{wert:a.benchmark.spez_ertrag_anlage,durchschnitt:a.benchmark.spez_ertrag_durchschnitt})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Fs,{label:"Community Durchschnitt",wert:a.benchmark.spez_ertrag_durchschnitt,einheit:"kWh/kWp",icon:e.jsx(Tt,{className:"h-5 w-5 text-gray-400"})}),e.jsx(Fs,{label:iu[a.anlage.region]||a.anlage.region,wert:a.benchmark.spez_ertrag_region,einheit:"kWh/kWp",icon:e.jsx(_t,{className:"h-5 w-5 text-blue-400"})}),e.jsx(Fs,{label:"Rang gesamt",wert:a.benchmark.rang_gesamt,zusatz:`von ${a.benchmark.anzahl_anlagen_gesamt}`,icon:e.jsx(ma,{className:"h-5 w-5 text-yellow-500"}),isRank:!0}),e.jsx(Fs,{label:"Rang Region",wert:a.benchmark.rang_region,zusatz:`von ${a.benchmark.anzahl_anlagen_region}`,icon:e.jsx(ma,{className:"h-5 w-5 text-blue-500"}),isRank:!0})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(l.length>0||u.length>0)&&e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Deine Performance"}),l.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Qh,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Stärken"})]}),e.jsx("div",{className:"space-y-2",children:l.map((d,b)=>e.jsxs("div",{className:"flex items-center justify-between bg-green-50 dark:bg-green-900/20 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon,e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:d.label})]}),e.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["+",d.abweichungProzent.toFixed(1),"%"]})]},b))})]}),u.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Xh,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Verbesserungspotenzial"})]}),e.jsx("div",{className:"space-y-2",children:u.map((d,b)=>e.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon,e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:d.label})]}),e.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:[d.abweichungProzent.toFixed(1),"%"]})]},b))})]})]}),x.length>=3&&e.jsxs($,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Profil"}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(fh,{data:x,children:[e.jsx(yh,{stroke:"#e5e7eb"}),e.jsx(jh,{dataKey:"kategorie",tick:{fill:"#6b7280",fontSize:11}}),e.jsx(kh,{angle:90,domain:[0,100],tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(Vl,{name:"Du",dataKey:"du",stroke:"var(--color-primary-500, #3b82f6)",fill:"var(--color-primary-500, #3b82f6)",fillOpacity:.3}),e.jsx(Vl,{name:"Community",dataKey:"community",stroke:"#9ca3af",fill:"#9ca3af",fillOpacity:.1}),e.jsx(Ce,{})]})})})]})]}),(g.erreichte.length>0||g.nichtErreichte.length>0)&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(da,{className:"h-5 w-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Achievements"}),g.erreichte.length>0&&e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:[g.erreichte.length," von ",g.erreichte.length+g.nichtErreichte.length," erreicht"]})]}),g.erreichte.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Erreicht"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:g.erreichte.map(d=>e.jsx(uo,{achievement:d},d.id))})]}),g.nichtErreichte.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"In Reichweite"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:g.nichtErreichte.slice(0,4).map(d=>e.jsx(uo,{achievement:d},d.id))})]})]}),a.benchmark_erweitert&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.benchmark_erweitert.speicher&&a.anlage.speicher_kwh&&e.jsxs(Ca,{title:"Speicher",icon:e.jsx(Fe,{className:"h-6 w-6 text-green-500"}),kapazitaet:`${a.anlage.speicher_kwh} kWh`,children:[e.jsx(xt,{label:"Zyklen/Jahr",kpi:a.benchmark_erweitert.speicher.zyklen_jahr,einheit:""}),e.jsx(xt,{label:"Wirkungsgrad",kpi:a.benchmark_erweitert.speicher.wirkungsgrad,einheit:"%"}),e.jsx(xt,{label:"Netzladung",kpi:a.benchmark_erweitert.speicher.netz_anteil,einheit:"%",invertColors:!0})]}),a.benchmark_erweitert.waermepumpe&&a.anlage.hat_waermepumpe&&e.jsxs(Ca,{title:"Wärmepumpe",icon:e.jsx(lt,{className:"h-6 w-6 text-blue-500"}),children:[e.jsx(xt,{label:"JAZ (Jahresarbeitszahl)",kpi:a.benchmark_erweitert.waermepumpe.jaz,einheit:""}),e.jsx(xt,{label:"Stromverbrauch",kpi:a.benchmark_erweitert.waermepumpe.stromverbrauch,einheit:"kWh",hideComparison:!0}),e.jsx(xt,{label:"Wärmeerzeugung",kpi:a.benchmark_erweitert.waermepumpe.waermeerzeugung,einheit:"kWh",hideComparison:!0})]}),a.benchmark_erweitert.eauto&&a.anlage.hat_eauto&&e.jsxs(Ca,{title:"E-Auto",icon:e.jsx(Ve,{className:"h-6 w-6 text-purple-500"}),children:[e.jsx(xt,{label:"PV-Anteil",kpi:a.benchmark_erweitert.eauto.pv_anteil,einheit:"%"}),e.jsx(xt,{label:"Ladung gesamt",kpi:a.benchmark_erweitert.eauto.ladung_gesamt,einheit:"kWh",hideComparison:!0}),e.jsx(xt,{label:"Verbrauch",kpi:a.benchmark_erweitert.eauto.verbrauch_100km,einheit:"kWh/100km",invertColors:!0}),a.benchmark_erweitert.eauto.v2h&&e.jsx(xt,{label:"V2H Entladung",kpi:a.benchmark_erweitert.eauto.v2h,einheit:"kWh",hideComparison:!0})]}),a.benchmark_erweitert.wallbox&&a.anlage.hat_wallbox&&e.jsxs(Ca,{title:"Wallbox",icon:e.jsx(Kt,{className:"h-6 w-6 text-cyan-500"}),kapazitaet:a.anlage.wallbox_kw?`${a.anlage.wallbox_kw} kW`:void 0,children:[e.jsx(xt,{label:"PV-Anteil Ladung",kpi:a.benchmark_erweitert.wallbox.pv_anteil,einheit:"%"}),e.jsx(xt,{label:"Ladung gesamt",kpi:a.benchmark_erweitert.wallbox.ladung,einheit:"kWh",hideComparison:!0}),e.jsx(xt,{label:"Ladevorgänge",kpi:a.benchmark_erweitert.wallbox.ladevorgaenge,einheit:"",hideComparison:!0})]}),a.benchmark_erweitert.balkonkraftwerk&&a.anlage.hat_balkonkraftwerk&&e.jsxs(Ca,{title:"Balkonkraftwerk",icon:e.jsx(oe,{className:"h-6 w-6 text-amber-500"}),kapazitaet:a.anlage.bkw_wp?`${a.anlage.bkw_wp} Wp`:void 0,children:[e.jsx(xt,{label:"Spez. Ertrag",kpi:a.benchmark_erweitert.balkonkraftwerk.spez_ertrag,einheit:"kWh/kWp"}),e.jsx(xt,{label:"Erzeugung",kpi:a.benchmark_erweitert.balkonkraftwerk.erzeugung,einheit:"kWh",hideComparison:!0}),e.jsx(xt,{label:"Eigenverbrauchsquote",kpi:a.benchmark_erweitert.balkonkraftwerk.eigenverbrauch,einheit:"%",hideComparison:!0})]})]})]}):null}function ou({wert:t,durchschnitt:r}){const a=(t-r)/r*100,s=a>=0;return e.jsxs("span",{className:`inline-flex items-center gap-1 mt-2 px-2 py-1 rounded text-sm font-medium ${s?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[s?e.jsx(We,{className:"h-4 w-4"}):e.jsx(qt,{className:"h-4 w-4"}),s?"+":"",a.toFixed(1),"% vs. Durchschnitt"]})}const cu={"Rang gesamt":"Deine Position im Vergleich zu allen teilnehmenden Anlagen","Rang Region":"Deine Position im Vergleich zu Anlagen in deiner Region","Spez. Ertrag":"Dein normierter Ertrag (kWh/kWp) im Vergleichszeitraum"};function Fs({label:t,wert:r,einheit:a,zusatz:s,icon:n,isRank:i,tooltip:o}){const c=o||cu[t];return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n,e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[t,c&&e.jsx(An,{text:c,children:e.jsx(Ji,{className:"h-3 w-3 text-gray-400 opacity-60"})})]})]}),e.jsxs("p",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[i?"#":"",r.toFixed(0),a&&e.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:a}),s&&e.jsx("span",{className:"text-sm font-normal text-gray-400 ml-2",children:s})]})]})}function Ca({title:t,icon:r,kapazitaet:a,children:s}){return e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r,e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),a&&e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]}),e.jsx("div",{className:"space-y-3",children:s})]})}const du={"Spez. Ertrag":"Ertrag normiert auf installierte Leistung (kWh pro kWp)",Autarkie:"Anteil des Eigenverbrauchs am Gesamtverbrauch",Eigenverbrauch:"Anteil der selbst genutzten PV-Erzeugung",Eigenverbrauchsquote:"Anteil der selbst genutzten PV-Erzeugung","Zyklen/Jahr":"Vollständige Lade-/Entladezyklen pro Jahr",Wirkungsgrad:"Verhältnis von Entladung zu Ladung (Effizienz)","Netzlade-Anteil":"Anteil der Speicherladung aus dem Netz statt PV",JAZ:"Jahresarbeitszahl: Wärmeenergie geteilt durch Stromverbrauch",Stromverbrauch:"Gesamter Stromverbrauch der Wärmepumpe",Wärmeerzeugung:"Erzeugte Wärme für Heizung und Warmwasser","PV-Anteil":"Anteil der Ladung aus PV-Überschuss",Ladung:"Gesamte Lademenge im Zeitraum",Verbrauch:"Durchschnittlicher Energieverbrauch",Erzeugung:"Gesamte PV-Erzeugung im Zeitraum"};function xt({label:t,kpi:r,einheit:a,hideComparison:s,invertColors:n,tooltip:i}){if(!r)return null;const o=!s&&r.community_avg!==void 0&&r.community_avg!==null,c=o?(r.wert-r.community_avg)/r.community_avg*100:null,h=c!==null?n?c<0:c>0:null,g=i||du[t];return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[t,g&&e.jsx(An,{text:g,children:e.jsx(Ji,{className:"h-3.5 w-3.5 text-gray-400 opacity-60"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[r.wert.toFixed(a==="%"||a===""?1:0)," ",a]}),o&&c!==null&&e.jsxs("span",{className:`text-sm ${h?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:["(",c>=0?"+":"",c.toFixed(1),"%)"]})]})]})}function uo({achievement:t}){const r={yellow:{bg:t.erreicht?"bg-yellow-100 dark:bg-yellow-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-yellow-300 dark:border-yellow-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-yellow-500":"text-gray-400",text:t.erreicht?"text-yellow-700 dark:text-yellow-300":"text-gray-500"},green:{bg:t.erreicht?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-green-300 dark:border-green-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-green-500":"text-gray-400",text:t.erreicht?"text-green-700 dark:text-green-300":"text-gray-500"},emerald:{bg:t.erreicht?"bg-emerald-100 dark:bg-emerald-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-emerald-300 dark:border-emerald-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-emerald-500":"text-gray-400",text:t.erreicht?"text-emerald-700 dark:text-emerald-300":"text-gray-500"},blue:{bg:t.erreicht?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-blue-300 dark:border-blue-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-blue-500":"text-gray-400",text:t.erreicht?"text-blue-700 dark:text-blue-300":"text-gray-500"},purple:{bg:t.erreicht?"bg-purple-100 dark:bg-purple-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-purple-300 dark:border-purple-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-purple-500":"text-gray-400",text:t.erreicht?"text-purple-700 dark:text-purple-300":"text-gray-500"},cyan:{bg:t.erreicht?"bg-cyan-100 dark:bg-cyan-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-cyan-300 dark:border-cyan-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-cyan-500":"text-gray-400",text:t.erreicht?"text-cyan-700 dark:text-cyan-300":"text-gray-500"},orange:{bg:t.erreicht?"bg-orange-100 dark:bg-orange-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-orange-300 dark:border-orange-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-orange-500":"text-gray-400",text:t.erreicht?"text-orange-700 dark:text-orange-300":"text-gray-500"},indigo:{bg:t.erreicht?"bg-indigo-100 dark:bg-indigo-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-indigo-300 dark:border-indigo-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-indigo-500":"text-gray-400",text:t.erreicht?"text-indigo-700 dark:text-indigo-300":"text-gray-500"}},a=r[t.farbe]||r.yellow;return e.jsxs("div",{className:`relative rounded-xl p-3 border ${a.bg} ${a.border} ${t.erreicht?"":"opacity-70"}`,title:t.beschreibung,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:a.icon,children:t.icon}),e.jsx("span",{className:`text-sm font-medium ${a.text}`,children:t.name})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:t.beschreibung}),!t.erreicht&&t.fortschritt!==void 0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.farbe==="yellow"?"bg-yellow-400":t.farbe==="green"?"bg-green-400":t.farbe==="blue"?"bg-blue-400":t.farbe==="purple"?"bg-purple-400":t.farbe==="cyan"?"bg-cyan-400":t.farbe==="orange"?"bg-orange-400":"bg-gray-400"}`,style:{width:`${Math.min(100,Math.max(0,t.fortschritt))}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t.fortschritt.toFixed(0),"%"]})]}),t.erreicht&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Rh,{className:`h-4 w-4 ${a.icon}`})})]})}function hu({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[h,g]=m.useState(!1),[l,u]=m.useState(null);m.useEffect(()=>{(async()=>{g(!0),u(null);try{const[f,j,k]=await Promise.all([tt.getBenchmark(t,r),tt.getDistribution("spez_ertrag",15).catch(()=>null),tt.getMonthlyAverages(24).catch(()=>null)]);s(f),i(j),c(k)}catch(f){u(f instanceof Error?f.message:"Fehler beim Laden")}finally{g(!1)}})()},[t,r]);const x=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return[];const y=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],f=new Map;return o!=null&&o.monate&&o.monate.forEach(k=>{f.set(`${k.jahr}-${k.monat}`,k.spez_ertrag_avg)}),[...a.anlage.monatswerte].sort((k,w)=>k.jahr-w.jahr||k.monat-w.monat).slice(-12).map(k=>{const w=k.spez_ertrag_kwh_kwp||0;let _=f.get(`${k.jahr}-${k.monat}`);_===void 0&&(_=f.get(`${k.jahr-1}-${k.monat}`)),_===void 0&&(_=a.benchmark.spez_ertrag_durchschnitt/12);const v=_>0?(w-_)/_*100:0;return{name:`${y[k.monat-1]} ${k.jahr%100}`,monat:k.monat,jahr:k.jahr,ertrag:w,durchschnitt:_,abweichung:v,isPositive:v>=0}})},[a,o]),d=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return null;const y=a.anlage.monatswerte;return[...new Set(y.map(j=>j.jahr))].sort().map(j=>{const k=y.filter(v=>v.jahr===j),w=k.reduce((v,S)=>v+(S.spez_ertrag_kwh_kwp||0),0),_=k.length;return{jahr:j,spezErtrag:w,anzahlMonate:_,vollstaendig:_===12}})},[a]),b=m.useMemo(()=>{if(!a)return null;const{rang_gesamt:y,anzahl_anlagen_gesamt:f}=a.benchmark;return Math.round((1-y/f)*100)},[a]),p=m.useMemo(()=>{if(!a)return null;const{spez_ertrag_anlage:y,spez_ertrag_durchschnitt:f,spez_ertrag_region:j}=a.benchmark;return{abweichungGesamt:(y-f)/f*100,abweichungRegion:(y-j)/j*100,differenzAbsolut:y-f}},[a]);return h?e.jsx(Me,{text:"Lade PV-Ertragsdaten..."}):l?e.jsx(ae,{type:"error",children:l}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary-100 dark:bg-primary-900/30",children:e.jsx(fa,{className:"h-5 w-5 text-primary-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Deine Position"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["Top ",100-(b||0),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Besser als ",b,"% der Community"]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${((p==null?void 0:p.abweichungGesamt)||0)>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:((p==null?void 0:p.abweichungGesamt)||0)>=0?e.jsx(We,{className:"h-5 w-5 text-green-500"}):e.jsx(qt,{className:"h-5 w-5 text-red-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Community"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${((p==null?void 0:p.abweichungGesamt)||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[((p==null?void 0:p.abweichungGesamt)||0)>=0?"+":"",p==null?void 0:p.abweichungGesamt.toFixed(1),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[p==null?void 0:p.differenzAbsolut.toFixed(0)," kWh/kWp Differenz"]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${((p==null?void 0:p.abweichungRegion)||0)>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:e.jsx(ui,{className:"h-5 w-5 text-blue-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Region"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${((p==null?void 0:p.abweichungRegion)||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[((p==null?void 0:p.abweichungRegion)||0)>=0?"+":"",p==null?void 0:p.abweichungRegion.toFixed(1),"%"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Vergleich mit deinem Bundesland"})]})]}),x.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatlicher Ertrag vs. Community"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:x,children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ve,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(xe,{formatter:(y,f)=>f==="ertrag"?[`${y.toFixed(1)} kWh/kWp`,"Dein Ertrag"]:f==="durchschnitt"?[`${y.toFixed(1)} kWh/kWp`,"Ø Community"]:[y,f],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(qe,{type:"monotone",dataKey:"durchschnitt",stroke:"#9ca3af",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"durchschnitt"}),e.jsx(le,{dataKey:"ertrag",radius:[4,4,0,0],name:"ertrag",children:x.map((y,f)=>e.jsx(Ge,{fill:y.isPositive?"#22c55e":"#ef4444",fillOpacity:.8},`cell-${f}`))})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Über Monats-Ø"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-red-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unter Monats-Ø"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-0 border-t-2 border-dashed border-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Community Monats-Ø"})]})]})]}),d&&d.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Mt,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Jahresübersicht"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Jahr"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"vs. Community"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Monate"})]})}),e.jsx("tbody",{children:d.map(y=>{const f=(y.spezErtrag-a.benchmark.spez_ertrag_durchschnitt)/a.benchmark.spez_ertrag_durchschnitt*100,j=f>=0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:y.jahr}),!y.vollstaendig&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(unvollständig)"})]}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[y.spezErtrag.toFixed(0)," kWh/kWp"]})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:`font-medium ${j?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[j?"+":"",f.toFixed(1),"%"]})}),e.jsxs("td",{className:"text-right py-3 px-4 text-gray-500 dark:text-gray-400",children:[y.anzahlMonate,"/12"]})]},y.jahr)})})]})})]}),n&&n.bins.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ui,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Verteilung in der Community"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Nt,{data:n.bins.map(y=>({range:`${y.von.toFixed(0)}-${y.bis.toFixed(0)}`,anzahl:y.anzahl,isOwn:a.benchmark.spez_ertrag_anlage>=y.von&&a.benchmark.spez_ertrag_anlage<y.bis})),children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ve,{dataKey:"range",tick:{fill:"#6b7280",fontSize:10},angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12}}),e.jsx(xe,{formatter:y=>[`${y} Anlagen`,"Anzahl"],labelFormatter:y=>`${y} kWh/kWp`,contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(le,{dataKey:"anzahl",radius:[4,4,0,0],children:n.bins.map((y,f)=>{const j=a.benchmark.spez_ertrag_anlage>=y.von&&a.benchmark.spez_ertrag_anlage<y.bis;return e.jsx(Ge,{fill:j?"#8b5cf6":"#d1d5db",fillOpacity:j?1:.7},`cell-${f}`)})})]})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Minimum"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.min.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Durchschnitt"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.durchschnitt.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Median"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.median.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Maximum"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.max.toFixed(0)," kWh/kWp"]})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-purple-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Deine Position"})]})})]}),e.jsx($,{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-primary-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Über den Vergleich"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Der Community-Durchschnitt basiert auf ",a.benchmark.anzahl_anlagen_gesamt," Anlagen. Dein spezifischer Ertrag von ",e.jsxs("strong",{children:[a.benchmark.spez_ertrag_anlage.toFixed(0)," kWh/kWp"]})," liegt"," ",((p==null?void 0:p.abweichungGesamt)||0)>=0?"über":"unter"," dem Durchschnitt von"," ",e.jsxs("strong",{children:[a.benchmark.spez_ertrag_durchschnitt.toFixed(0)," kWh/kWp"]}),". Faktoren wie Ausrichtung (",a.anlage.ausrichtung,"), Neigung (",a.anlage.neigung_grad,"°) und regionale Sonneneinstrahlung beeinflussen die Ergebnisse."]})]})]})})]}):null}function gu({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(!1),[o,c]=m.useState(null),[h,g]=m.useState(null),[l,u]=m.useState(null),[x,d]=m.useState(null);m.useEffect(()=>{(async()=>{i(!0),c(null);try{const y=await tt.getBenchmark(t,r);s(y)}catch(y){c(y instanceof Error?y.message:"Fehler beim Laden")}finally{i(!1)}})()},[t,r]),m.useEffect(()=>{(async()=>{try{const[y,f,j]=await Promise.all([tt.getSpeicherByClass().catch(()=>null),tt.getWaermepumpeByRegion().catch(()=>null),tt.getEAutoByUsage().catch(()=>null)]);g(y),u(f),d(j)}catch{}})()},[]);const b=m.useMemo(()=>{var y,f,j,k,w;if(!a)return[];const p=[];return a.anlage.speicher_kwh&&((y=a.benchmark_erweitert)!=null&&y.speicher)&&p.push("speicher"),a.anlage.hat_waermepumpe&&((f=a.benchmark_erweitert)!=null&&f.waermepumpe)&&p.push("waermepumpe"),a.anlage.hat_eauto&&((j=a.benchmark_erweitert)!=null&&j.eauto)&&p.push("eauto"),a.anlage.hat_wallbox&&((k=a.benchmark_erweitert)!=null&&k.wallbox)&&p.push("wallbox"),a.anlage.hat_balkonkraftwerk&&((w=a.benchmark_erweitert)!=null&&w.balkonkraftwerk)&&p.push("bkw"),p},[a]);return n?e.jsx(Me,{text:"Lade Komponenten-Daten..."}):o?r==="letzter_monat"?e.jsx($,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Fe,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Daten für letzten Monat"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Für den letzten Monat liegen noch keine Komponenten-Daten vor. Wähle einen längeren Zeitraum für den Vergleich."})]})}):e.jsx(ae,{type:"error",children:o}):a?b.length===0?e.jsx($,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 mb-4",children:e.jsx(Fe,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Keine Komponenten-Daten"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:"Für Komponenten-Vergleiche benötigst du mindestens eine Zusatzkomponente (Speicher, Wärmepumpe, E-Auto, Wallbox oder Balkonkraftwerk) mit erfassten Monatsdaten."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Betrachtungszeitraum: ",a.zeitraum_label]})}),b.includes("speicher")&&e.jsx(uu,{benchmark:a,communityStats:h}),b.includes("waermepumpe")&&e.jsx(xu,{benchmark:a,communityStats:l}),b.includes("eauto")&&e.jsx(mu,{benchmark:a,communityStats:x}),b.includes("wallbox")&&e.jsx(pu,{benchmark:a}),b.includes("bkw")&&e.jsx(bu,{benchmark:a})]}):null}const xo=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];function uu({benchmark:t,communityStats:r}){var g,l;const a=(g=t.benchmark_erweitert)==null?void 0:g.speicher;if(!a)return null;const s=t.anlage.speicher_kwh||0,n=m.useMemo(()=>s<=5?"≤5 kWh":s<=10?"5-10 kWh":s<=15?"10-15 kWh":s<=20?"15-20 kWh":">20 kWh",[s]),i=m.useMemo(()=>{var x,d;const u=[];return(x=a.wirkungsgrad)!=null&&x.community_avg&&u.push({name:"Wirkungsgrad",du:a.wirkungsgrad.wert,community:a.wirkungsgrad.community_avg}),(d=a.netz_anteil)!=null&&d.community_avg&&u.push({name:"Netz-Anteil",du:a.netz_anteil.wert,community:a.netz_anteil.community_avg}),u},[a]),o=m.useMemo(()=>r!=null&&r.klassen?r.klassen.filter(u=>u.anzahl>0).map((u,x)=>({name:u.bis_kwh?`${u.von_kwh}-${u.bis_kwh} kWh`:`>${u.von_kwh} kWh`,anzahl:u.anzahl,fill:xo[x%xo.length],avg_zyklen:u.durchschnitt_zyklen??0,avg_wirkungsgrad:u.durchschnitt_wirkungsgrad??0})):[],[r]),c=m.useMemo(()=>r!=null&&r.klassen?r.klassen.reduce((u,x)=>u+x.anzahl,0):0,[r]),h=m.useMemo(()=>{const u=[];return a.netz_anteil&&a.netz_anteil.wert>20&&u.push("Hoher Netzlade-Anteil: Prüfe, ob die PV-Überschussladung optimal konfiguriert ist."),a.wirkungsgrad&&a.wirkungsgrad.wert<85&&u.push("Der Wirkungsgrad liegt unter 85%. Bei älteren Speichern kann die Kapazität nachlassen."),a.zyklen_jahr&&a.zyklen_jahr.wert<200&&u.push("Wenige Zyklen: Der Speicher wird nicht voll genutzt. Überlege, mehr Eigenverbrauch zu priorisieren."),u.length===0&&u.push("Dein Speicher arbeitet im normalen Bereich."),u},[a]);return e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(Fe,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Speicher"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s," kWh Kapazität"]})]})]}),((l=a.zyklen_jahr)==null?void 0:l.rang)&&a.zyklen_jahr.von&&e.jsx(us,{rang:a.zyklen_jahr.rang,von:a.zyklen_jahr.von})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(ut,{label:"Zyklen/Jahr",icon:e.jsx(vc,{className:"h-5 w-5 text-green-500"}),kpi:a.zyklen_jahr,einheit:"",beschreibung:"Vollständige Lade-/Entladezyklen"}),e.jsx(ut,{label:"Wirkungsgrad",icon:e.jsx(ca,{className:"h-5 w-5 text-blue-500"}),kpi:a.wirkungsgrad,einheit:"%",beschreibung:"Entladen / Geladen"}),e.jsx(ut,{label:"Netzlade-Anteil",icon:e.jsx(_e,{className:"h-5 w-5 text-yellow-500"}),kpi:a.netz_anteil,einheit:"%",beschreibung:"Anteil Ladung aus Netz statt PV",invertColors:!0})]}),i.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Vergleich mit Community"}),e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:i,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(ve,{type:"number",domain:[0,100],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:90}),e.jsx(xe,{formatter:u=>[`${u.toFixed(1)}%`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(le,{dataKey:"du",name:"Du",fill:"#22c55e",radius:[0,4,4,0]}),e.jsx(le,{dataKey:"community",name:"Community",fill:"#9ca3af",radius:[0,4,4,0]})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Du"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Community Ø"})]})]})]})]}),o.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: Speicher nach Kapazitätsklasse"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",c," Anlagen)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:o,dataKey:"anzahl",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:u,percent:x})=>`${u} (${(x*100).toFixed(0)}%)`,labelLine:!1,children:o.map((u,x)=>e.jsx(Ge,{fill:u.fill,stroke:u.name===n?"#000":"none",strokeWidth:u.name===n?2:0},`cell-${x}`))}),e.jsx(xe,{formatter:(u,x)=>[`${u} Anlagen`,x]})]})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"text-left pb-2",children:"Klasse"}),e.jsx("th",{className:"text-right pb-2",children:"Ø Zyklen/Jahr"}),e.jsx("th",{className:"text-right pb-2",children:"Ø Wirkungsgrad"})]})}),e.jsx("tbody",{children:o.map(u=>e.jsxs("tr",{className:u.name===n?"bg-primary-50 dark:bg-primary-900/20 font-medium":"",children:[e.jsxs("td",{className:"py-1 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:u.fill}}),u.name,u.name===n&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]}),e.jsx("td",{className:"text-right py-1",children:u.avg_zyklen.toFixed(0)}),e.jsxs("td",{className:"text-right py-1",children:[u.avg_wirkungsgrad.toFixed(1),"%"]})]},u.name))})]})})]})]}),e.jsx(xs,{tipps:h})]})}function xu({benchmark:t,communityStats:r}){var c,h;const a=(c=t.benchmark_erweitert)==null?void 0:c.waermepumpe;if(!a)return null;const s=t.anlage.region,n=m.useMemo(()=>r!=null&&r.regionen?r.regionen.filter(g=>g.anzahl>0&&g.durchschnitt_jaz!=null).sort((g,l)=>(l.durchschnitt_jaz??0)-(g.durchschnitt_jaz??0)).slice(0,10).map(g=>({name:g.region.replace("_"," "),region:g.region,jaz:g.durchschnitt_jaz??0,anzahl:g.anzahl})):[],[r]),i=m.useMemo(()=>r!=null&&r.regionen?r.regionen.reduce((g,l)=>g+l.anzahl,0):0,[r]),o=m.useMemo(()=>{const g=[];return a.jaz&&a.jaz.wert<3&&g.push("JAZ unter 3.0: Prüfe Vorlauftemperaturen und Wärmedämmung. Höhere Temperaturen senken die Effizienz."),i>=3&&a.jaz&&a.jaz.community_avg&&a.jaz.wert<a.jaz.community_avg*.9&&g.push("Deine JAZ liegt deutlich unter dem Community-Durchschnitt. Eine Optimierung der Heizkurve könnte helfen."),g.length===0&&a.jaz&&a.jaz.wert>=3.5?g.push("Gute Effizienz! Eine JAZ von 3.5+ ist ein solider Wert für Wärmepumpen."):g.length===0&&g.push("Deine Wärmepumpe arbeitet im normalen Effizienzbereich."),g},[a,i]);return e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(lt,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Wärmepumpe"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Effizienz-Analyse"})]})]}),((h=a.jaz)==null?void 0:h.rang)&&a.jaz.von&&e.jsx(us,{rang:a.jaz.rang,von:a.jaz.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ut,{label:"Jahresarbeitszahl (JAZ)",icon:e.jsx(Br,{className:"h-5 w-5 text-blue-500"}),kpi:a.jaz,einheit:"",beschreibung:"Wärmeenergie / Stromverbrauch",large:!0}),e.jsx(ut,{label:"Stromverbrauch",icon:e.jsx(_e,{className:"h-5 w-5 text-yellow-500"}),kpi:a.stromverbrauch,einheit:"kWh",beschreibung:"Gesamt im Zeitraum"}),e.jsx(ut,{label:"Wärmeerzeugung",icon:e.jsx(lt,{className:"h-5 w-5 text-red-500"}),kpi:a.waermeerzeugung,einheit:"kWh",beschreibung:"Heizung + Warmwasser"})]}),n.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_t,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: JAZ nach Region"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i," ",i===1?"Anlage":"Anlagen",")"]})]}),i<3?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Noch nicht genug Vergleichsdaten."})," Für einen aussagekräftigen regionalen Vergleich werden mindestens 3 Anlagen mit Wärmepumpe benötigt."]}),n.length===1&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Aktuell: ",n[0].name," mit JAZ ",n[0].jaz.toFixed(2)," (",n[0].anzahl," Anlage)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:n,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(ve,{type:"number",domain:[0,5],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:11},width:120}),e.jsx(xe,{formatter:g=>[`JAZ: ${g.toFixed(2)}`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsxs(le,{dataKey:"jaz",radius:[0,4,4,0],children:[n.map((g,l)=>e.jsx(Ge,{fill:g.region===s?"#3b82f6":"#9ca3af"},`cell-${l}`)),e.jsx(vh,{dataKey:"jaz",position:"right",formatter:g=>g.toFixed(2),style:{fill:"#374151",fontSize:11}})]})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Deine Region"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Andere Regionen"})]})]})]})]}),e.jsx(xs,{tipps:o})]})}const mo=["#22c55e","#3b82f6","#f59e0b","#ef4444"];function mu({benchmark:t,communityStats:r}){var h,g;const a=(h=t.benchmark_erweitert)==null?void 0:h.eauto;if(!a)return null;const s=m.useMemo(()=>{var u;if(!((u=a.km)!=null&&u.wert))return null;const l=a.km.wert/12;return l<=500?"Wenig":l<=1e3?"Normal":l<=2e3?"Viel":"Intensiv"},[a.km]),n=m.useMemo(()=>r!=null&&r.klassen?r.klassen.filter(l=>l.anzahl>0).map((l,u)=>({name:l.klasse.charAt(0).toUpperCase()+l.klasse.slice(1),beschreibung:l.beschreibung,anzahl:l.anzahl,fill:mo[u%mo.length],avg_pv_anteil:l.durchschnitt_pv_anteil??0,avg_verbrauch:l.durchschnitt_verbrauch_100km??0})):[],[r]),i=m.useMemo(()=>r!=null&&r.klassen?r.klassen.reduce((l,u)=>l+u.anzahl,0):0,[r]),o=m.useMemo(()=>{if(!a.pv_anteil)return[];const l=a.pv_anteil.wert;return[{name:"PV",wert:l,fill:"#22c55e"},{name:"Netz/Extern",wert:100-l,fill:"#ef4444"}]},[a]),c=m.useMemo(()=>{const l=[];return a.pv_anteil&&a.pv_anteil.wert<50&&l.push("Unter 50% PV-Anteil: Versuche, das Laden tagsüber bei PV-Überschuss zu priorisieren."),a.verbrauch_100km&&a.verbrauch_100km.wert>20&&l.push("Hoher Verbrauch: Prüfe Reifendruck, Fahrweise und Klimaanlagen-Nutzung."),a.v2h&&a.v2h.wert>0&&l.push("V2H aktiv: Du nutzt dein Auto als zusätzlichen Speicher - sehr gut!"),l.length===0&&l.push("Dein E-Auto ist gut in das Energiesystem integriert."),l},[a]);return e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx(Ve,{className:"h-6 w-6 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"E-Auto"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Lade- und Verbrauchsanalyse"})]})]}),((g=a.pv_anteil)==null?void 0:g.rang)&&a.pv_anteil.von&&e.jsx(us,{rang:a.pv_anteil.rang,von:a.pv_anteil.von})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(ut,{label:"PV-Ladeanteil",icon:e.jsx(oe,{className:"h-5 w-5 text-yellow-500"}),kpi:a.pv_anteil,einheit:"%",beschreibung:"Anteil PV an Gesamtladung"}),e.jsx(ut,{label:"Ladung gesamt",icon:e.jsx(vc,{className:"h-5 w-5 text-purple-500"}),kpi:a.ladung_gesamt,einheit:"kWh",beschreibung:"Gesamte Lademenge"}),e.jsx(ut,{label:"Verbrauch",icon:e.jsx(ca,{className:"h-5 w-5 text-blue-500"}),kpi:a.verbrauch_100km,einheit:"kWh/100km",beschreibung:"Durchschnittsverbrauch",invertColors:!0}),a.km&&e.jsx(ut,{label:"Gefahrene km",icon:e.jsx(qh,{className:"h-5 w-5 text-gray-500"}),kpi:a.km,einheit:"km",beschreibung:"Im Zeitraum"}),a.v2h&&a.v2h.wert>0&&e.jsx(ut,{label:"V2H Entladung",icon:e.jsx(_e,{className:"h-5 w-5 text-green-500"}),kpi:a.v2h,einheit:"kWh",beschreibung:"Rückspeisung ins Haus"})]}),o.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ladequellen-Verteilung"}),e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:o,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(ve,{type:"number",domain:[0,100],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:80}),e.jsx(xe,{formatter:l=>[`${l.toFixed(1)}%`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(le,{dataKey:"wert",radius:[0,4,4,0],children:o.map((l,u)=>e.jsx(Ge,{fill:l.fill},`cell-${u}`))})]})})})]})]}),n.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: E-Autos nach Nutzungsintensität"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i," E-Autos)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-48",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Jt,{children:[e.jsx(Ut,{data:n,dataKey:"anzahl",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:l,percent:u})=>`${l} (${(u*100).toFixed(0)}%)`,labelLine:!1,children:n.map((l,u)=>e.jsx(Ge,{fill:l.fill,stroke:l.name.toLowerCase()===(s==null?void 0:s.toLowerCase())?"#000":"none",strokeWidth:l.name.toLowerCase()===(s==null?void 0:s.toLowerCase())?2:0},`cell-${u}`))}),e.jsx(xe,{formatter:(l,u)=>[`${l} E-Autos`,u]})]})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"text-left pb-2",children:"Nutzung"}),e.jsx("th",{className:"text-right pb-2",children:"Ø Verbrauch"}),e.jsx("th",{className:"text-right pb-2",children:"Ø PV-Anteil"})]})}),e.jsx("tbody",{children:n.map(l=>e.jsxs("tr",{className:l.name.toLowerCase()===(s==null?void 0:s.toLowerCase())?"bg-primary-50 dark:bg-primary-900/20 font-medium":"",children:[e.jsxs("td",{className:"py-1 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:l.fill}}),e.jsx("span",{title:l.beschreibung,children:l.name}),l.name.toLowerCase()===(s==null?void 0:s.toLowerCase())&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]}),e.jsxs("td",{className:"text-right py-1",children:[l.avg_verbrauch.toFixed(1)," kWh/100km"]}),e.jsxs("td",{className:"text-right py-1",children:[l.avg_pv_anteil.toFixed(0),"%"]})]},l.name))})]})})]})]}),e.jsx(xs,{tipps:c})]})}function pu({benchmark:t}){var n,i;const r=(n=t.benchmark_erweitert)==null?void 0:n.wallbox;if(!r)return null;const a=t.anlage.wallbox_kw,s=m.useMemo(()=>{const o=[];return r.pv_anteil&&r.pv_anteil.wert<60&&o.push("Der PV-Anteil könnte höher sein. Nutze PV-geführtes Laden für mehr Eigenverbrauch."),r.pv_anteil&&r.pv_anteil.wert>=80&&o.push("Exzellenter PV-Anteil! Deine Wallbox ist optimal ins PV-System integriert."),o.length===0&&o.push("Deine Wallbox arbeitet im normalen Bereich."),o},[r]);return e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-100 dark:bg-cyan-900/30",children:e.jsx(Kt,{className:"h-6 w-6 text-cyan-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Wallbox"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a?`${a} kW Ladeleistung`:"Ladeverhalten"})]})]}),((i=r.pv_anteil)==null?void 0:i.rang)&&r.pv_anteil.von&&e.jsx(us,{rang:r.pv_anteil.rang,von:r.pv_anteil.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ut,{label:"PV-Ladeanteil",icon:e.jsx(oe,{className:"h-5 w-5 text-yellow-500"}),kpi:r.pv_anteil,einheit:"%",beschreibung:"Anteil PV an Gesamtladung",large:!0}),e.jsx(ut,{label:"Ladung gesamt",icon:e.jsx(_e,{className:"h-5 w-5 text-cyan-500"}),kpi:r.ladung,einheit:"kWh",beschreibung:"Im Zeitraum"}),e.jsx(ut,{label:"Ladevorgänge",icon:e.jsx(Tt,{className:"h-5 w-5 text-gray-500"}),kpi:r.ladevorgaenge,einheit:"",beschreibung:"Anzahl"})]}),e.jsx(xs,{tipps:s})]})}function bu({benchmark:t}){var n,i;const r=(n=t.benchmark_erweitert)==null?void 0:n.balkonkraftwerk;if(!r)return null;const a=t.anlage.bkw_wp,s=m.useMemo(()=>{const o=[];return r.spez_ertrag&&r.spez_ertrag.community_avg&&(r.spez_ertrag.wert-r.spez_ertrag.community_avg)/r.spez_ertrag.community_avg*100<-15&&o.push("Dein spezifischer Ertrag liegt deutlich unter dem Durchschnitt. Prüfe Verschattung und Ausrichtung."),r.eigenverbrauch&&r.eigenverbrauch.wert<70&&o.push("Der Eigenverbrauchsanteil könnte höher sein. Versuche, Verbraucher tagsüber zu nutzen."),o.length===0&&o.push("Dein Balkonkraftwerk arbeitet gut!"),o},[r]);return e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(oe,{className:"h-6 w-6 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Balkonkraftwerk"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a?`${a} Wp`:"Mini-PV"})]})]}),((i=r.spez_ertrag)==null?void 0:i.rang)&&r.spez_ertrag.von&&e.jsx(us,{rang:r.spez_ertrag.rang,von:r.spez_ertrag.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ut,{label:"Spezifischer Ertrag",icon:e.jsx(We,{className:"h-5 w-5 text-amber-500"}),kpi:r.spez_ertrag,einheit:"kWh/kWp",beschreibung:"Normierter Ertrag",large:!0}),e.jsx(ut,{label:"Erzeugung",icon:e.jsx(_e,{className:"h-5 w-5 text-yellow-500"}),kpi:r.erzeugung,einheit:"kWh",beschreibung:"Im Zeitraum"}),e.jsx(ut,{label:"Eigenverbrauch",icon:e.jsx(lt,{className:"h-5 w-5 text-green-500"}),kpi:r.eigenverbrauch,einheit:"%",beschreibung:"Direkt genutzt"})]}),e.jsx(xs,{tipps:s})]})}function us({rang:t,von:r}){const a=t/r*100;let s="bg-gray-100 dark:bg-gray-800",n="text-gray-600 dark:text-gray-400";return a<=10?(s="bg-yellow-100 dark:bg-yellow-900/30",n="text-yellow-600 dark:text-yellow-400"):a<=25?(s="bg-blue-100 dark:bg-blue-900/30",n="text-blue-600 dark:text-blue-400"):a<=50&&(s="bg-green-100 dark:bg-green-900/30",n="text-green-600 dark:text-green-400"),e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full ${s}`,children:[e.jsx(fa,{className:`h-4 w-4 ${n}`}),e.jsxs("span",{className:`text-sm font-medium ${n}`,children:["#",t," von ",r]})]})}function ut({label:t,icon:r,kpi:a,einheit:s,beschreibung:n,invertColors:i,large:o}){if(!a)return null;const c=a.community_avg!==void 0&&a.community_avg!==null,h=c?(a.wert-a.community_avg)/a.community_avg*100:null,g=h!==null?i?h<0:h>0:null;return e.jsxs("div",{className:`bg-gray-50 dark:bg-gray-800 rounded-lg p-4 ${o?"md:col-span-1":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r,e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`font-bold text-gray-900 dark:text-white ${o?"text-3xl":"text-xl"}`,children:a.wert.toFixed(s==="%"||s===""?1:0)}),s&&e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:s})]}),c&&h!==null&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-sm ${g?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[g?e.jsx(We,{className:"h-3 w-3"}):e.jsx(qt,{className:"h-3 w-3"}),e.jsxs("span",{children:[h>=0?"+":"",h.toFixed(1),"% vs. Ø"]})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]})}function xs({tipps:t}){return e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Oh,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Tipps"})]}),e.jsx("ul",{className:"space-y-2",children:t.map((r,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-primary-500 mt-0.5",children:"•"}),e.jsx("span",{children:r})]},a))})]})}class bt{constructor(){this._partials=new Float64Array(32),this._n=0}add(r){const a=this._partials;let s=0;for(let n=0;n<this._n&&n<32;n++){const i=a[n],o=r+i,c=Math.abs(r)<Math.abs(i)?r-(o-i):i-(o-r);c&&(a[s++]=c),r=o}return a[s]=r,this._n=s+1,this}valueOf(){const r=this._partials;let a=this._n,s,n,i,o=0;if(a>0){for(o=r[--a];a>0&&(s=o,n=r[--a],o=s+n,i=n-(o-s),!i););a>0&&(i<0&&r[a-1]<0||i>0&&r[a-1]>0)&&(n=i*2,s=o+n,n==s-o&&(o=s))}return o}}function*fu(t){for(const r of t)yield*r}function Tc(t){return Array.from(fu(t))}function ga(t,r,a){t=+t,r=+r,a=(n=arguments.length)<2?(r=t,t=0,1):n<3?1:+a;for(var s=-1,n=Math.max(0,Math.ceil((r-t)/a))|0,i=new Array(n);++s<n;)i[s]=t+s*a;return i}var we=1e-6,es=1e-12,$e=Math.PI,rt=$e/2,tn=$e/4,zt=$e*2,He=180/$e,Ne=$e/180,Le=Math.abs,Sa=Math.atan,St=Math.atan2,ye=Math.cos,As=Math.ceil,Kc=Math.exp,mi=Math.hypot,rn=Math.log,Un=Math.pow,me=Math.sin,Zt=Math.sign||function(t){return t>0?1:t<0?-1:0},ct=Math.sqrt,il=Math.tan;function Hc(t){return t>1?0:t<-1?$e:Math.acos(t)}function Et(t){return t>1?rt:t<-1?-rt:Math.asin(t)}function po(t){return(t=me(t/2))*t}function Ue(){}function an(t,r){t&&fo.hasOwnProperty(t.type)&&fo[t.type](t,r)}var bo={Feature:function(t,r){an(t.geometry,r)},FeatureCollection:function(t,r){for(var a=t.features,s=-1,n=a.length;++s<n;)an(a[s].geometry,r)}},fo={Sphere:function(t,r){r.sphere()},Point:function(t,r){t=t.coordinates,r.point(t[0],t[1],t[2])},MultiPoint:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)t=a[s],r.point(t[0],t[1],t[2])},LineString:function(t,r){pi(t.coordinates,r,0)},MultiLineString:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)pi(a[s],r,0)},Polygon:function(t,r){yo(t.coordinates,r)},MultiPolygon:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)yo(a[s],r)},GeometryCollection:function(t,r){for(var a=t.geometries,s=-1,n=a.length;++s<n;)an(a[s],r)}};function pi(t,r,a){var s=-1,n=t.length-a,i;for(r.lineStart();++s<n;)i=t[s],r.point(i[0],i[1],i[2]);r.lineEnd()}function yo(t,r){var a=-1,s=t.length;for(r.polygonStart();++a<s;)pi(t[a],r,1);r.polygonEnd()}function tr(t,r){t&&bo.hasOwnProperty(t.type)?bo[t.type](t,r):an(t,r)}var sn=new bt,nn=new bt,Gc,Zc,bi,fi,yi,mr={point:Ue,lineStart:Ue,lineEnd:Ue,polygonStart:function(){sn=new bt,mr.lineStart=yu,mr.lineEnd=ju},polygonEnd:function(){var t=+sn;nn.add(t<0?zt+t:t),this.lineStart=this.lineEnd=this.point=Ue},sphere:function(){nn.add(zt)}};function yu(){mr.point=ku}function ju(){qc(Gc,Zc)}function ku(t,r){mr.point=qc,Gc=t,Zc=r,t*=Ne,r*=Ne,bi=t,fi=ye(r=r/2+tn),yi=me(r)}function qc(t,r){t*=Ne,r*=Ne,r=r/2+tn;var a=t-bi,s=a>=0?1:-1,n=s*a,i=ye(r),o=me(r),c=yi*o,h=fi*i+c*ye(n),g=c*s*me(n);sn.add(St(g,h)),bi=t,fi=i,yi=o}function vu(t){return nn=new bt,tr(t,mr),nn*2}function ln(t){return[St(t[1],t[0]),Et(t[2])]}function ea(t){var r=t[0],a=t[1],s=ye(a);return[s*ye(r),s*me(r),me(a)]}function $s(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function va(t,r){return[t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]]}function Yn(t,r){t[0]+=r[0],t[1]+=r[1],t[2]+=r[2]}function Cs(t,r){return[t[0]*r,t[1]*r,t[2]*r]}function on(t){var r=ct(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=r,t[1]/=r,t[2]/=r}var Je,Ft,Ye,Bt,Zr,Jc,Uc,pa,Ga,Ar,Er,jr={point:ji,lineStart:jo,lineEnd:ko,polygonStart:function(){jr.point=Xc,jr.lineStart=wu,jr.lineEnd=Nu,Ga=new bt,mr.polygonStart()},polygonEnd:function(){mr.polygonEnd(),jr.point=ji,jr.lineStart=jo,jr.lineEnd=ko,sn<0?(Je=-(Ye=180),Ft=-(Bt=90)):Ga>we?Bt=90:Ga<-we&&(Ft=-90),Er[0]=Je,Er[1]=Ye},sphere:function(){Je=-(Ye=180),Ft=-(Bt=90)}};function ji(t,r){Ar.push(Er=[Je=t,Ye=t]),r<Ft&&(Ft=r),r>Bt&&(Bt=r)}function Yc(t,r){var a=ea([t*Ne,r*Ne]);if(pa){var s=va(pa,a),n=[s[1],-s[0],0],i=va(n,s);on(i),i=ln(i);var o=t-Zr,c=o>0?1:-1,h=i[0]*He*c,g,l=Le(o)>180;l^(c*Zr<h&&h<c*t)?(g=i[1]*He,g>Bt&&(Bt=g)):(h=(h+360)%360-180,l^(c*Zr<h&&h<c*t)?(g=-i[1]*He,g<Ft&&(Ft=g)):(r<Ft&&(Ft=r),r>Bt&&(Bt=r))),l?t<Zr?Vt(Je,t)>Vt(Je,Ye)&&(Ye=t):Vt(t,Ye)>Vt(Je,Ye)&&(Je=t):Ye>=Je?(t<Je&&(Je=t),t>Ye&&(Ye=t)):t>Zr?Vt(Je,t)>Vt(Je,Ye)&&(Ye=t):Vt(t,Ye)>Vt(Je,Ye)&&(Je=t)}else Ar.push(Er=[Je=t,Ye=t]);r<Ft&&(Ft=r),r>Bt&&(Bt=r),pa=a,Zr=t}function jo(){jr.point=Yc}function ko(){Er[0]=Je,Er[1]=Ye,jr.point=ji,pa=null}function Xc(t,r){if(pa){var a=t-Zr;Ga.add(Le(a)>180?a+(a>0?360:-360):a)}else Jc=t,Uc=r;mr.point(t,r),Yc(t,r)}function wu(){mr.lineStart()}function Nu(){Xc(Jc,Uc),mr.lineEnd(),Le(Ga)>we&&(Je=-(Ye=180)),Er[0]=Je,Er[1]=Ye,pa=null}function Vt(t,r){return(r-=t)<0?r+360:r}function _u(t,r){return t[0]-r[0]}function vo(t,r){return t[0]<=t[1]?t[0]<=r&&r<=t[1]:r<t[0]||t[1]<r}function zu(t){var r,a,s,n,i,o,c;if(Bt=Ye=-(Je=Ft=1/0),Ar=[],tr(t,jr),a=Ar.length){for(Ar.sort(_u),r=1,s=Ar[0],i=[s];r<a;++r)n=Ar[r],vo(s,n[0])||vo(s,n[1])?(Vt(s[0],n[1])>Vt(s[0],s[1])&&(s[1]=n[1]),Vt(n[0],s[1])>Vt(s[0],s[1])&&(s[0]=n[0])):i.push(s=n);for(o=-1/0,a=i.length-1,r=0,s=i[a];r<=a;s=n,++r)n=i[r],(c=Vt(s[1],n[0]))>o&&(o=c,Je=n[0],Ye=s[1])}return Ar=Er=null,Je===1/0||Ft===1/0?[[NaN,NaN],[NaN,NaN]]:[[Je,Ft],[Ye,Bt]]}var Ia,cn,dn,hn,gn,un,xn,mn,ki,vi,wi,Qc,ed,kt,vt,wt,rr={sphere:Ue,point:ll,lineStart:wo,lineEnd:No,polygonStart:function(){rr.lineStart=Mu,rr.lineEnd=Wu},polygonEnd:function(){rr.lineStart=wo,rr.lineEnd=No}};function ll(t,r){t*=Ne,r*=Ne;var a=ye(r);ms(a*ye(t),a*me(t),me(r))}function ms(t,r,a){++Ia,dn+=(t-dn)/Ia,hn+=(r-hn)/Ia,gn+=(a-gn)/Ia}function wo(){rr.point=Su}function Su(t,r){t*=Ne,r*=Ne;var a=ye(r);kt=a*ye(t),vt=a*me(t),wt=me(r),rr.point=Eu,ms(kt,vt,wt)}function Eu(t,r){t*=Ne,r*=Ne;var a=ye(r),s=a*ye(t),n=a*me(t),i=me(r),o=St(ct((o=vt*i-wt*n)*o+(o=wt*s-kt*i)*o+(o=kt*n-vt*s)*o),kt*s+vt*n+wt*i);cn+=o,un+=o*(kt+(kt=s)),xn+=o*(vt+(vt=n)),mn+=o*(wt+(wt=i)),ms(kt,vt,wt)}function No(){rr.point=ll}function Mu(){rr.point=Fu}function Wu(){td(Qc,ed),rr.point=ll}function Fu(t,r){Qc=t,ed=r,t*=Ne,r*=Ne,rr.point=td;var a=ye(r);kt=a*ye(t),vt=a*me(t),wt=me(r),ms(kt,vt,wt)}function td(t,r){t*=Ne,r*=Ne;var a=ye(r),s=a*ye(t),n=a*me(t),i=me(r),o=vt*i-wt*n,c=wt*s-kt*i,h=kt*n-vt*s,g=mi(o,c,h),l=Et(g),u=g&&-l/g;ki.add(u*o),vi.add(u*c),wi.add(u*h),cn+=l,un+=l*(kt+(kt=s)),xn+=l*(vt+(vt=n)),mn+=l*(wt+(wt=i)),ms(kt,vt,wt)}function Au(t){Ia=cn=dn=hn=gn=un=xn=mn=0,ki=new bt,vi=new bt,wi=new bt,tr(t,rr);var r=+ki,a=+vi,s=+wi,n=mi(r,a,s);return n<es&&(r=un,a=xn,s=mn,cn<we&&(r=dn,a=hn,s=gn),n=mi(r,a,s),n<es)?[NaN,NaN]:[St(a,r)*He,Et(s/n)*He]}function la(t){return function(){return t}}function Ni(t,r){function a(s,n){return s=t(s,n),r(s[0],s[1])}return t.invert&&r.invert&&(a.invert=function(s,n){return s=r.invert(s,n),s&&t.invert(s[0],s[1])}),a}function _i(t,r){return[Le(t)>$e?t+Math.round(-t/zt)*zt:t,r]}_i.invert=_i;function ol(t,r,a){return(t%=zt)?r||a?Ni(zo(t),So(r,a)):zo(t):r||a?So(r,a):_i}function _o(t){return function(r,a){return r+=t,[r>$e?r-zt:r<-$e?r+zt:r,a]}}function zo(t){var r=_o(t);return r.invert=_o(-t),r}function So(t,r){var a=ye(t),s=me(t),n=ye(r),i=me(r);function o(c,h){var g=ye(h),l=ye(c)*g,u=me(c)*g,x=me(h),d=x*a+l*s;return[St(u*n-d*i,l*a-x*s),Et(d*n+u*i)]}return o.invert=function(c,h){var g=ye(h),l=ye(c)*g,u=me(c)*g,x=me(h),d=x*n-u*i;return[St(u*n+x*i,l*a+d*s),Et(d*a-l*s)]},o}function rd(t){t=ol(t[0]*Ne,t[1]*Ne,t.length>2?t[2]*Ne:0);function r(a){return a=t(a[0]*Ne,a[1]*Ne),a[0]*=He,a[1]*=He,a}return r.invert=function(a){return a=t.invert(a[0]*Ne,a[1]*Ne),a[0]*=He,a[1]*=He,a},r}function ad(t,r,a,s,n,i){if(a){var o=ye(r),c=me(r),h=s*a;n==null?(n=r+s*zt,i=r-h/2):(n=Eo(o,n),i=Eo(o,i),(s>0?n<i:n>i)&&(n+=s*zt));for(var g,l=n;s>0?l>i:l<i;l-=h)g=ln([o,-c*ye(l),-c*me(l)]),t.point(g[0],g[1])}}function Eo(t,r){r=ea(r),r[0]-=t,on(r);var a=Hc(-r[1]);return((-r[2]<0?-a:a)+zt-we)%zt}function $u(){var t=la([0,0]),r=la(90),a=la(6),s,n,i={point:o};function o(h,g){s.push(h=n(h,g)),h[0]*=He,h[1]*=He}function c(){var h=t.apply(this,arguments),g=r.apply(this,arguments)*Ne,l=a.apply(this,arguments)*Ne;return s=[],n=ol(-h[0]*Ne,-h[1]*Ne,0).invert,ad(i,g,l,1),h={type:"Polygon",coordinates:[s]},s=n=null,h}return c.center=function(h){return arguments.length?(t=typeof h=="function"?h:la([+h[0],+h[1]]),c):t},c.radius=function(h){return arguments.length?(r=typeof h=="function"?h:la(+h),c):r},c.precision=function(h){return arguments.length?(a=typeof h=="function"?h:la(+h),c):a},c}function sd(){var t=[],r;return{point:function(a,s,n){r.push([a,s,n])},lineStart:function(){t.push(r=[])},lineEnd:Ue,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var a=t;return t=[],r=null,a}}}function Hs(t,r){return Le(t[0]-r[0])<we&&Le(t[1]-r[1])<we}function Ps(t,r,a,s){this.x=t,this.z=r,this.o=a,this.e=s,this.v=!1,this.n=this.p=null}function nd(t,r,a,s,n){var i=[],o=[],c,h;if(t.forEach(function(b){if(!((p=b.length-1)<=0)){var p,y=b[0],f=b[p],j;if(Hs(y,f)){if(!y[2]&&!f[2]){for(n.lineStart(),c=0;c<p;++c)n.point((y=b[c])[0],y[1]);n.lineEnd();return}f[0]+=2*we}i.push(j=new Ps(y,b,null,!0)),o.push(j.o=new Ps(y,null,j,!1)),i.push(j=new Ps(f,b,null,!1)),o.push(j.o=new Ps(f,null,j,!0))}}),!!i.length){for(o.sort(r),Mo(i),Mo(o),c=0,h=o.length;c<h;++c)o[c].e=a=!a;for(var g=i[0],l,u;;){for(var x=g,d=!0;x.v;)if((x=x.n)===g)return;l=x.z,n.lineStart();do{if(x.v=x.o.v=!0,x.e){if(d)for(c=0,h=l.length;c<h;++c)n.point((u=l[c])[0],u[1]);else s(x.x,x.n.x,1,n);x=x.n}else{if(d)for(l=x.p.z,c=l.length-1;c>=0;--c)n.point((u=l[c])[0],u[1]);else s(x.x,x.p.x,-1,n);x=x.p}x=x.o,l=x.z,d=!d}while(!x.v);n.lineEnd()}}}function Mo(t){if(r=t.length){for(var r,a=0,s=t[0],n;++a<r;)s.n=n=t[a],n.p=s,s=n;s.n=n=t[0],n.p=s}}function Xn(t){return Le(t[0])<=$e?t[0]:Zt(t[0])*((Le(t[0])+$e)%zt-$e)}function id(t,r){var a=Xn(r),s=r[1],n=me(s),i=[me(a),-ye(a),0],o=0,c=0,h=new bt;n===1?s=rt+we:n===-1&&(s=-rt-we);for(var g=0,l=t.length;g<l;++g)if(x=(u=t[g]).length)for(var u,x,d=u[x-1],b=Xn(d),p=d[1]/2+tn,y=me(p),f=ye(p),j=0;j<x;++j,b=w,y=v,f=S,d=k){var k=u[j],w=Xn(k),_=k[1]/2+tn,v=me(_),S=ye(_),V=w-b,C=V>=0?1:-1,I=C*V,F=I>$e,M=y*v;if(h.add(St(M*C*me(I),f*S+M*ye(I))),o+=F?V+C*zt:V,F^b>=a^w>=a){var W=va(ea(d),ea(k));on(W);var N=va(i,W);on(N);var z=(F^V>=0?-1:1)*Et(N[2]);(s>z||s===z&&(W[0]||W[1]))&&(c+=F^V>=0?1:-1)}}return(o<-we||o<we&&h<-es)^c&1}function ld(t,r,a,s){return function(n){var i=r(n),o=sd(),c=r(o),h=!1,g,l,u,x={point:d,lineStart:p,lineEnd:y,polygonStart:function(){x.point=f,x.lineStart=j,x.lineEnd=k,l=[],g=[]},polygonEnd:function(){x.point=d,x.lineStart=p,x.lineEnd=y,l=Tc(l);var w=id(g,s);l.length?(h||(n.polygonStart(),h=!0),nd(l,Pu,w,a,n)):w&&(h||(n.polygonStart(),h=!0),n.lineStart(),a(null,null,1,n),n.lineEnd()),h&&(n.polygonEnd(),h=!1),l=g=null},sphere:function(){n.polygonStart(),n.lineStart(),a(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function d(w,_){t(w,_)&&n.point(w,_)}function b(w,_){i.point(w,_)}function p(){x.point=b,i.lineStart()}function y(){x.point=d,i.lineEnd()}function f(w,_){u.push([w,_]),c.point(w,_)}function j(){c.lineStart(),u=[]}function k(){f(u[0][0],u[0][1]),c.lineEnd();var w=c.clean(),_=o.result(),v,S=_.length,V,C,I;if(u.pop(),g.push(u),u=null,!!S){if(w&1){if(C=_[0],(V=C.length-1)>0){for(h||(n.polygonStart(),h=!0),n.lineStart(),v=0;v<V;++v)n.point((I=C[v])[0],I[1]);n.lineEnd()}return}S>1&&w&2&&_.push(_.pop().concat(_.shift())),l.push(_.filter(Cu))}}return x}}function Cu(t){return t.length>1}function Pu(t,r){return((t=t.x)[0]<0?t[1]-rt-we:rt-t[1])-((r=r.x)[0]<0?r[1]-rt-we:rt-r[1])}const zi=ld(function(){return!0},Du,Iu,[-$e,-rt]);function Du(t){var r=NaN,a=NaN,s=NaN,n;return{lineStart:function(){t.lineStart(),n=1},point:function(i,o){var c=i>0?$e:-$e,h=Le(i-r);Le(h-$e)<we?(t.point(r,a=(a+o)/2>0?rt:-rt),t.point(s,a),t.lineEnd(),t.lineStart(),t.point(c,a),t.point(i,a),n=0):s!==c&&h>=$e&&(Le(r-s)<we&&(r-=s*we),Le(i-c)<we&&(i-=c*we),a=Lu(r,a,i,o),t.point(s,a),t.lineEnd(),t.lineStart(),t.point(c,a),n=0),t.point(r=i,a=o),s=c},lineEnd:function(){t.lineEnd(),r=a=NaN},clean:function(){return 2-n}}}function Lu(t,r,a,s){var n,i,o=me(t-a);return Le(o)>we?Sa((me(r)*(i=ye(s))*me(a)-me(s)*(n=ye(r))*me(t))/(n*i*o)):(r+s)/2}function Iu(t,r,a,s){var n;if(t==null)n=a*rt,s.point(-$e,n),s.point(0,n),s.point($e,n),s.point($e,0),s.point($e,-n),s.point(0,-n),s.point(-$e,-n),s.point(-$e,0),s.point(-$e,n);else if(Le(t[0]-r[0])>we){var i=t[0]<r[0]?$e:-$e;n=a*i/2,s.point(-i,n),s.point(0,n),s.point(i,n)}else s.point(r[0],r[1])}function od(t){var r=ye(t),a=6*Ne,s=r>0,n=Le(r)>we;function i(l,u,x,d){ad(d,t,a,x,l,u)}function o(l,u){return ye(l)*ye(u)>r}function c(l){var u,x,d,b,p;return{lineStart:function(){b=d=!1,p=1},point:function(y,f){var j=[y,f],k,w=o(y,f),_=s?w?0:g(y,f):w?g(y+(y<0?$e:-$e),f):0;if(!u&&(b=d=w)&&l.lineStart(),w!==d&&(k=h(u,j),(!k||Hs(u,k)||Hs(j,k))&&(j[2]=1)),w!==d)p=0,w?(l.lineStart(),k=h(j,u),l.point(k[0],k[1])):(k=h(u,j),l.point(k[0],k[1],2),l.lineEnd()),u=k;else if(n&&u&&s^w){var v;!(_&x)&&(v=h(j,u,!0))&&(p=0,s?(l.lineStart(),l.point(v[0][0],v[0][1]),l.point(v[1][0],v[1][1]),l.lineEnd()):(l.point(v[1][0],v[1][1]),l.lineEnd(),l.lineStart(),l.point(v[0][0],v[0][1],3)))}w&&(!u||!Hs(u,j))&&l.point(j[0],j[1]),u=j,d=w,x=_},lineEnd:function(){d&&l.lineEnd(),u=null},clean:function(){return p|(b&&d)<<1}}}function h(l,u,x){var d=ea(l),b=ea(u),p=[1,0,0],y=va(d,b),f=$s(y,y),j=y[0],k=f-j*j;if(!k)return!x&&l;var w=r*f/k,_=-r*j/k,v=va(p,y),S=Cs(p,w),V=Cs(y,_);Yn(S,V);var C=v,I=$s(S,C),F=$s(C,C),M=I*I-F*($s(S,S)-1);if(!(M<0)){var W=ct(M),N=Cs(C,(-I-W)/F);if(Yn(N,S),N=ln(N),!x)return N;var z=l[0],A=u[0],P=l[1],E=u[1],L;A<z&&(L=z,z=A,A=L);var R=A-z,X=Le(R-$e)<we,O=X||R<we;if(!X&&E<P&&(L=P,P=E,E=L),O?X?P+E>0^N[1]<(Le(N[0]-z)<we?P:E):P<=N[1]&&N[1]<=E:R>$e^(z<=N[0]&&N[0]<=A)){var B=Cs(C,(-I+W)/F);return Yn(B,S),[N,ln(B)]}}}function g(l,u){var x=s?t:$e-t,d=0;return l<-x?d|=1:l>x&&(d|=2),u<-x?d|=4:u>x&&(d|=8),d}return ld(o,c,i,s?[0,-t]:[-$e,t-$e])}function Vu(t,r,a,s,n,i){var o=t[0],c=t[1],h=r[0],g=r[1],l=0,u=1,x=h-o,d=g-c,b;if(b=a-o,!(!x&&b>0)){if(b/=x,x<0){if(b<l)return;b<u&&(u=b)}else if(x>0){if(b>u)return;b>l&&(l=b)}if(b=n-o,!(!x&&b<0)){if(b/=x,x<0){if(b>u)return;b>l&&(l=b)}else if(x>0){if(b<l)return;b<u&&(u=b)}if(b=s-c,!(!d&&b>0)){if(b/=d,d<0){if(b<l)return;b<u&&(u=b)}else if(d>0){if(b>u)return;b>l&&(l=b)}if(b=i-c,!(!d&&b<0)){if(b/=d,d<0){if(b>u)return;b>l&&(l=b)}else if(d>0){if(b<l)return;b<u&&(u=b)}return l>0&&(t[0]=o+l*x,t[1]=c+l*d),u<1&&(r[0]=o+u*x,r[1]=c+u*d),!0}}}}}var Va=1e9,Ds=-Va;function Pn(t,r,a,s){function n(g,l){return t<=g&&g<=a&&r<=l&&l<=s}function i(g,l,u,x){var d=0,b=0;if(g==null||(d=o(g,u))!==(b=o(l,u))||h(g,l)<0^u>0)do x.point(d===0||d===3?t:a,d>1?s:r);while((d=(d+u+4)%4)!==b);else x.point(l[0],l[1])}function o(g,l){return Le(g[0]-t)<we?l>0?0:3:Le(g[0]-a)<we?l>0?2:1:Le(g[1]-r)<we?l>0?1:0:l>0?3:2}function c(g,l){return h(g.x,l.x)}function h(g,l){var u=o(g,1),x=o(l,1);return u!==x?u-x:u===0?l[1]-g[1]:u===1?g[0]-l[0]:u===2?g[1]-l[1]:l[0]-g[0]}return function(g){var l=g,u=sd(),x,d,b,p,y,f,j,k,w,_,v,S={point:V,lineStart:M,lineEnd:W,polygonStart:I,polygonEnd:F};function V(z,A){n(z,A)&&l.point(z,A)}function C(){for(var z=0,A=0,P=d.length;A<P;++A)for(var E=d[A],L=1,R=E.length,X=E[0],O,B,G=X[0],T=X[1];L<R;++L)O=G,B=T,X=E[L],G=X[0],T=X[1],B<=s?T>s&&(G-O)*(s-B)>(T-B)*(t-O)&&++z:T<=s&&(G-O)*(s-B)<(T-B)*(t-O)&&--z;return z}function I(){l=u,x=[],d=[],v=!0}function F(){var z=C(),A=v&&z,P=(x=Tc(x)).length;(A||P)&&(g.polygonStart(),A&&(g.lineStart(),i(null,null,1,g),g.lineEnd()),P&&nd(x,c,z,i,g),g.polygonEnd()),l=g,x=d=b=null}function M(){S.point=N,d&&d.push(b=[]),_=!0,w=!1,j=k=NaN}function W(){x&&(N(p,y),f&&w&&u.rejoin(),x.push(u.result())),S.point=V,w&&l.lineEnd()}function N(z,A){var P=n(z,A);if(d&&b.push([z,A]),_)p=z,y=A,f=P,_=!1,P&&(l.lineStart(),l.point(z,A));else if(P&&w)l.point(z,A);else{var E=[j=Math.max(Ds,Math.min(Va,j)),k=Math.max(Ds,Math.min(Va,k))],L=[z=Math.max(Ds,Math.min(Va,z)),A=Math.max(Ds,Math.min(Va,A))];Vu(E,L,t,r,a,s)?(w||(l.lineStart(),l.point(E[0],E[1])),l.point(L[0],L[1]),P||l.lineEnd(),v=!1):P&&(l.lineStart(),l.point(z,A),v=!1)}j=z,k=A,w=P}return S}}function Bu(){var t=0,r=0,a=960,s=500,n,i,o;return o={stream:function(c){return n&&i===c?n:n=Pn(t,r,a,s)(i=c)},extent:function(c){return arguments.length?(t=+c[0][0],r=+c[0][1],a=+c[1][0],s=+c[1][1],n=i=null,o):[[t,r],[a,s]]}}}var Si,Ei,Gs,Zs,wa={sphere:Ue,point:Ue,lineStart:Ou,lineEnd:Ue,polygonStart:Ue,polygonEnd:Ue};function Ou(){wa.point=Tu,wa.lineEnd=Ru}function Ru(){wa.point=wa.lineEnd=Ue}function Tu(t,r){t*=Ne,r*=Ne,Ei=t,Gs=me(r),Zs=ye(r),wa.point=Ku}function Ku(t,r){t*=Ne,r*=Ne;var a=me(r),s=ye(r),n=Le(t-Ei),i=ye(n),o=me(n),c=s*o,h=Zs*a-Gs*s*i,g=Gs*a+Zs*s*i;Si.add(St(ct(c*c+h*h),g)),Ei=t,Gs=a,Zs=s}function cd(t){return Si=new bt,tr(t,wa),+Si}var Mi=[null,null],Hu={type:"LineString",coordinates:Mi};function pn(t,r){return Mi[0]=t,Mi[1]=r,cd(Hu)}var Wo={Feature:function(t,r){return bn(t.geometry,r)},FeatureCollection:function(t,r){for(var a=t.features,s=-1,n=a.length;++s<n;)if(bn(a[s].geometry,r))return!0;return!1}},Fo={Sphere:function(){return!0},Point:function(t,r){return Ao(t.coordinates,r)},MultiPoint:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)if(Ao(a[s],r))return!0;return!1},LineString:function(t,r){return $o(t.coordinates,r)},MultiLineString:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)if($o(a[s],r))return!0;return!1},Polygon:function(t,r){return Co(t.coordinates,r)},MultiPolygon:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)if(Co(a[s],r))return!0;return!1},GeometryCollection:function(t,r){for(var a=t.geometries,s=-1,n=a.length;++s<n;)if(bn(a[s],r))return!0;return!1}};function bn(t,r){return t&&Fo.hasOwnProperty(t.type)?Fo[t.type](t,r):!1}function Ao(t,r){return pn(t,r)===0}function $o(t,r){for(var a,s,n,i=0,o=t.length;i<o;i++){if(s=pn(t[i],r),s===0||i>0&&(n=pn(t[i],t[i-1]),n>0&&a<=n&&s<=n&&(a+s-n)*(1-Math.pow((a-s)/n,2))<es*n))return!0;a=s}return!1}function Co(t,r){return!!id(t.map(Gu),dd(r))}function Gu(t){return t=t.map(dd),t.pop(),t}function dd(t){return[t[0]*Ne,t[1]*Ne]}function Zu(t,r){return(t&&Wo.hasOwnProperty(t.type)?Wo[t.type]:bn)(t,r)}function Po(t,r,a){var s=ga(t,r-we,a).concat(r);return function(n){return s.map(function(i){return[n,i]})}}function Do(t,r,a){var s=ga(t,r-we,a).concat(r);return function(n){return s.map(function(i){return[i,n]})}}function cl(){var t,r,a,s,n,i,o,c,h=10,g=h,l=90,u=360,x,d,b,p,y=2.5;function f(){return{type:"MultiLineString",coordinates:j()}}function j(){return ga(As(s/l)*l,a,l).map(b).concat(ga(As(c/u)*u,o,u).map(p)).concat(ga(As(r/h)*h,t,h).filter(function(k){return Le(k%l)>we}).map(x)).concat(ga(As(i/g)*g,n,g).filter(function(k){return Le(k%u)>we}).map(d))}return f.lines=function(){return j().map(function(k){return{type:"LineString",coordinates:k}})},f.outline=function(){return{type:"Polygon",coordinates:[b(s).concat(p(o).slice(1),b(a).reverse().slice(1),p(c).reverse().slice(1))]}},f.extent=function(k){return arguments.length?f.extentMajor(k).extentMinor(k):f.extentMinor()},f.extentMajor=function(k){return arguments.length?(s=+k[0][0],a=+k[1][0],c=+k[0][1],o=+k[1][1],s>a&&(k=s,s=a,a=k),c>o&&(k=c,c=o,o=k),f.precision(y)):[[s,c],[a,o]]},f.extentMinor=function(k){return arguments.length?(r=+k[0][0],t=+k[1][0],i=+k[0][1],n=+k[1][1],r>t&&(k=r,r=t,t=k),i>n&&(k=i,i=n,n=k),f.precision(y)):[[r,i],[t,n]]},f.step=function(k){return arguments.length?f.stepMajor(k).stepMinor(k):f.stepMinor()},f.stepMajor=function(k){return arguments.length?(l=+k[0],u=+k[1],f):[l,u]},f.stepMinor=function(k){return arguments.length?(h=+k[0],g=+k[1],f):[h,g]},f.precision=function(k){return arguments.length?(y=+k,x=Po(i,n,90),d=Do(r,t,y),b=Po(c,o,90),p=Do(s,a,y),f):y},f.extentMajor([[-180,-90+we],[180,90-we]]).extentMinor([[-180,-80-we],[180,80+we]])}function qu(){return cl()()}function Ju(t,r){var a=t[0]*Ne,s=t[1]*Ne,n=r[0]*Ne,i=r[1]*Ne,o=ye(s),c=me(s),h=ye(i),g=me(i),l=o*ye(a),u=o*me(a),x=h*ye(n),d=h*me(n),b=2*Et(ct(po(i-s)+o*h*po(n-a))),p=me(b),y=b?function(f){var j=me(f*=b)/p,k=me(b-f)/p,w=k*l+j*x,_=k*u+j*d,v=k*c+j*g;return[St(_,w)*He,St(v,ct(w*w+_*_))*He]}:function(){return[a*He,s*He]};return y.distance=b,y}const ts=t=>t;var Qn=new bt,Wi=new bt,hd,gd,Fi,Ai,kr={point:Ue,lineStart:Ue,lineEnd:Ue,polygonStart:function(){kr.lineStart=Uu,kr.lineEnd=Xu},polygonEnd:function(){kr.lineStart=kr.lineEnd=kr.point=Ue,Qn.add(Le(Wi)),Wi=new bt},result:function(){var t=Qn/2;return Qn=new bt,t}};function Uu(){kr.point=Yu}function Yu(t,r){kr.point=ud,hd=Fi=t,gd=Ai=r}function ud(t,r){Wi.add(Ai*t-Fi*r),Fi=t,Ai=r}function Xu(){ud(hd,gd)}var Na=1/0,fn=Na,rs=-Na,yn=rs,jn={point:Qu,lineStart:Ue,lineEnd:Ue,polygonStart:Ue,polygonEnd:Ue,result:function(){var t=[[Na,fn],[rs,yn]];return rs=yn=-(fn=Na=1/0),t}};function Qu(t,r){t<Na&&(Na=t),t>rs&&(rs=t),r<fn&&(fn=r),r>yn&&(yn=r)}var $i=0,Ci=0,Ba=0,kn=0,vn=0,ua=0,Pi=0,Di=0,Oa=0,xd,md,or,cr,Gt={point:ta,lineStart:Lo,lineEnd:Io,polygonStart:function(){Gt.lineStart=rx,Gt.lineEnd=ax},polygonEnd:function(){Gt.point=ta,Gt.lineStart=Lo,Gt.lineEnd=Io},result:function(){var t=Oa?[Pi/Oa,Di/Oa]:ua?[kn/ua,vn/ua]:Ba?[$i/Ba,Ci/Ba]:[NaN,NaN];return $i=Ci=Ba=kn=vn=ua=Pi=Di=Oa=0,t}};function ta(t,r){$i+=t,Ci+=r,++Ba}function Lo(){Gt.point=ex}function ex(t,r){Gt.point=tx,ta(or=t,cr=r)}function tx(t,r){var a=t-or,s=r-cr,n=ct(a*a+s*s);kn+=n*(or+t)/2,vn+=n*(cr+r)/2,ua+=n,ta(or=t,cr=r)}function Io(){Gt.point=ta}function rx(){Gt.point=sx}function ax(){pd(xd,md)}function sx(t,r){Gt.point=pd,ta(xd=or=t,md=cr=r)}function pd(t,r){var a=t-or,s=r-cr,n=ct(a*a+s*s);kn+=n*(or+t)/2,vn+=n*(cr+r)/2,ua+=n,n=cr*t-or*r,Pi+=n*(or+t),Di+=n*(cr+r),Oa+=n*3,ta(or=t,cr=r)}function bd(t){this._context=t}bd.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,r){switch(this._point){case 0:{this._context.moveTo(t,r),this._point=1;break}case 1:{this._context.lineTo(t,r);break}default:{this._context.moveTo(t+this._radius,r),this._context.arc(t,r,this._radius,0,zt);break}}},result:Ue};var Li=new bt,ei,fd,yd,Ra,Ta,as={point:Ue,lineStart:function(){as.point=nx},lineEnd:function(){ei&&jd(fd,yd),as.point=Ue},polygonStart:function(){ei=!0},polygonEnd:function(){ei=null},result:function(){var t=+Li;return Li=new bt,t}};function nx(t,r){as.point=jd,fd=Ra=t,yd=Ta=r}function jd(t,r){Ra-=t,Ta-=r,Li.add(ct(Ra*Ra+Ta*Ta)),Ra=t,Ta=r}function kd(){this._string=[]}kd.prototype={_radius:4.5,_circle:Vo(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(t,r){switch(this._point){case 0:{this._string.push("M",t,",",r),this._point=1;break}case 1:{this._string.push("L",t,",",r);break}default:{this._circle==null&&(this._circle=Vo(this._radius)),this._string.push("M",t,",",r,this._circle);break}}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}else return null}};function Vo(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function vd(t,r){var a=4.5,s,n;function i(o){return o&&(typeof a=="function"&&n.pointRadius(+a.apply(this,arguments)),tr(o,s(n))),n.result()}return i.area=function(o){return tr(o,s(kr)),kr.result()},i.measure=function(o){return tr(o,s(as)),as.result()},i.bounds=function(o){return tr(o,s(jn)),jn.result()},i.centroid=function(o){return tr(o,s(Gt)),Gt.result()},i.projection=function(o){return arguments.length?(s=o==null?(t=null,ts):(t=o).stream,i):t},i.context=function(o){return arguments.length?(n=o==null?(r=null,new kd):new bd(r=o),typeof a!="function"&&n.pointRadius(a),i):r},i.pointRadius=function(o){return arguments.length?(a=typeof o=="function"?o:(n.pointRadius(+o),+o),i):a},i.projection(t).context(r)}function ix(t){return{stream:ps(t)}}function ps(t){return function(r){var a=new Ii;for(var s in t)a[s]=t[s];return a.stream=r,a}}function Ii(){}Ii.prototype={constructor:Ii,point:function(t,r){this.stream.point(t,r)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function dl(t,r,a){var s=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),s!=null&&t.clipExtent(null),tr(a,t.stream(jn)),r(jn.result()),s!=null&&t.clipExtent(s),t}function Dn(t,r,a){return dl(t,function(s){var n=r[1][0]-r[0][0],i=r[1][1]-r[0][1],o=Math.min(n/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),c=+r[0][0]+(n-o*(s[1][0]+s[0][0]))/2,h=+r[0][1]+(i-o*(s[1][1]+s[0][1]))/2;t.scale(150*o).translate([c,h])},a)}function hl(t,r,a){return Dn(t,[[0,0],r],a)}function gl(t,r,a){return dl(t,function(s){var n=+r,i=n/(s[1][0]-s[0][0]),o=(n-i*(s[1][0]+s[0][0]))/2,c=-i*s[0][1];t.scale(150*i).translate([o,c])},a)}function ul(t,r,a){return dl(t,function(s){var n=+r,i=n/(s[1][1]-s[0][1]),o=-i*s[0][0],c=(n-i*(s[1][1]+s[0][1]))/2;t.scale(150*i).translate([o,c])},a)}var Bo=16,lx=ye(30*Ne);function Oo(t,r){return+r?cx(t,r):ox(t)}function ox(t){return ps({point:function(r,a){r=t(r,a),this.stream.point(r[0],r[1])}})}function cx(t,r){function a(s,n,i,o,c,h,g,l,u,x,d,b,p,y){var f=g-s,j=l-n,k=f*f+j*j;if(k>4*r&&p--){var w=o+x,_=c+d,v=h+b,S=ct(w*w+_*_+v*v),V=Et(v/=S),C=Le(Le(v)-1)<we||Le(i-u)<we?(i+u)/2:St(_,w),I=t(C,V),F=I[0],M=I[1],W=F-s,N=M-n,z=j*W-f*N;(z*z/k>r||Le((f*W+j*N)/k-.5)>.3||o*x+c*d+h*b<lx)&&(a(s,n,i,o,c,h,F,M,C,w/=S,_/=S,v,p,y),y.point(F,M),a(F,M,C,w,_,v,g,l,u,x,d,b,p,y))}}return function(s){var n,i,o,c,h,g,l,u,x,d,b,p,y={point:f,lineStart:j,lineEnd:w,polygonStart:function(){s.polygonStart(),y.lineStart=_},polygonEnd:function(){s.polygonEnd(),y.lineStart=j}};function f(V,C){V=t(V,C),s.point(V[0],V[1])}function j(){u=NaN,y.point=k,s.lineStart()}function k(V,C){var I=ea([V,C]),F=t(V,C);a(u,x,l,d,b,p,u=F[0],x=F[1],l=V,d=I[0],b=I[1],p=I[2],Bo,s),s.point(u,x)}function w(){y.point=f,s.lineEnd()}function _(){j(),y.point=v,y.lineEnd=S}function v(V,C){k(n=V,C),i=u,o=x,c=d,h=b,g=p,y.point=k}function S(){a(u,x,l,d,b,p,i,o,n,c,h,g,Bo,s),y.lineEnd=w,w()}return y}}var dx=ps({point:function(t,r){this.stream.point(t*Ne,r*Ne)}});function hx(t){return ps({point:function(r,a){var s=t(r,a);return this.stream.point(s[0],s[1])}})}function gx(t,r,a,s,n){function i(o,c){return o*=s,c*=n,[r+t*o,a-t*c]}return i.invert=function(o,c){return[(o-r)/t*s,(a-c)/t*n]},i}function Ro(t,r,a,s,n,i){if(!i)return gx(t,r,a,s,n);var o=ye(i),c=me(i),h=o*t,g=c*t,l=o/t,u=c/t,x=(c*a-o*r)/t,d=(c*r+o*a)/t;function b(p,y){return p*=s,y*=n,[h*p-g*y+r,a-g*p-h*y]}return b.invert=function(p,y){return[s*(l*p-u*y+x),n*(d-u*p-l*y)]},b}function br(t){return xl(function(){return t})()}function xl(t){var r,a=150,s=480,n=250,i=0,o=0,c=0,h=0,g=0,l,u=0,x=1,d=1,b=null,p=zi,y=null,f,j,k,w=ts,_=.5,v,S,V,C,I;function F(z){return V(z[0]*Ne,z[1]*Ne)}function M(z){return z=V.invert(z[0],z[1]),z&&[z[0]*He,z[1]*He]}F.stream=function(z){return C&&I===z?C:C=dx(hx(l)(p(v(w(I=z)))))},F.preclip=function(z){return arguments.length?(p=z,b=void 0,N()):p},F.postclip=function(z){return arguments.length?(w=z,y=f=j=k=null,N()):w},F.clipAngle=function(z){return arguments.length?(p=+z?od(b=z*Ne):(b=null,zi),N()):b*He},F.clipExtent=function(z){return arguments.length?(w=z==null?(y=f=j=k=null,ts):Pn(y=+z[0][0],f=+z[0][1],j=+z[1][0],k=+z[1][1]),N()):y==null?null:[[y,f],[j,k]]},F.scale=function(z){return arguments.length?(a=+z,W()):a},F.translate=function(z){return arguments.length?(s=+z[0],n=+z[1],W()):[s,n]},F.center=function(z){return arguments.length?(i=z[0]%360*Ne,o=z[1]%360*Ne,W()):[i*He,o*He]},F.rotate=function(z){return arguments.length?(c=z[0]%360*Ne,h=z[1]%360*Ne,g=z.length>2?z[2]%360*Ne:0,W()):[c*He,h*He,g*He]},F.angle=function(z){return arguments.length?(u=z%360*Ne,W()):u*He},F.reflectX=function(z){return arguments.length?(x=z?-1:1,W()):x<0},F.reflectY=function(z){return arguments.length?(d=z?-1:1,W()):d<0},F.precision=function(z){return arguments.length?(v=Oo(S,_=z*z),N()):ct(_)},F.fitExtent=function(z,A){return Dn(F,z,A)},F.fitSize=function(z,A){return hl(F,z,A)},F.fitWidth=function(z,A){return gl(F,z,A)},F.fitHeight=function(z,A){return ul(F,z,A)};function W(){var z=Ro(a,0,0,x,d,u).apply(null,r(i,o)),A=Ro(a,s-z[0],n-z[1],x,d,u);return l=ol(c,h,g),S=Ni(r,A),V=Ni(l,S),v=Oo(S,_),N()}function N(){return C=I=null,F}return function(){return r=t.apply(this,arguments),F.invert=r.invert&&M,W()}}function ml(t){var r=0,a=$e/3,s=xl(t),n=s(r,a);return n.parallels=function(i){return arguments.length?s(r=i[0]*Ne,a=i[1]*Ne):[r*He,a*He]},n}function ux(t){var r=ye(t);function a(s,n){return[s*r,me(n)/r]}return a.invert=function(s,n){return[s/r,Et(n*r)]},a}function wd(t,r){var a=me(t),s=(a+me(r))/2;if(Le(s)<we)return ux(t);var n=1+a*(2*s-a),i=ct(n)/s;function o(c,h){var g=ct(n-2*s*me(h))/s;return[g*me(c*=s),i-g*ye(c)]}return o.invert=function(c,h){var g=i-h,l=St(c,Le(g))*Zt(g);return g*s<0&&(l-=$e*Zt(c)*Zt(g)),[l/s,Et((n-(c*c+g*g)*s*s)/(2*s))]},o}function wn(){return ml(wd).scale(155.424).center([0,33.6442])}function Nd(){return wn().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function xx(t){var r=t.length;return{point:function(a,s){for(var n=-1;++n<r;)t[n].point(a,s)},sphere:function(){for(var a=-1;++a<r;)t[a].sphere()},lineStart:function(){for(var a=-1;++a<r;)t[a].lineStart()},lineEnd:function(){for(var a=-1;++a<r;)t[a].lineEnd()},polygonStart:function(){for(var a=-1;++a<r;)t[a].polygonStart()},polygonEnd:function(){for(var a=-1;++a<r;)t[a].polygonEnd()}}}function mx(){var t,r,a=Nd(),s,n=wn().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i,o=wn().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c,h,g={point:function(x,d){h=[x,d]}};function l(x){var d=x[0],b=x[1];return h=null,s.point(d,b),h||(i.point(d,b),h)||(c.point(d,b),h)}l.invert=function(x){var d=a.scale(),b=a.translate(),p=(x[0]-b[0])/d,y=(x[1]-b[1])/d;return(y>=.12&&y<.234&&p>=-.425&&p<-.214?n:y>=.166&&y<.234&&p>=-.214&&p<-.115?o:a).invert(x)},l.stream=function(x){return t&&r===x?t:t=xx([a.stream(r=x),n.stream(x),o.stream(x)])},l.precision=function(x){return arguments.length?(a.precision(x),n.precision(x),o.precision(x),u()):a.precision()},l.scale=function(x){return arguments.length?(a.scale(x),n.scale(x*.35),o.scale(x),l.translate(a.translate())):a.scale()},l.translate=function(x){if(!arguments.length)return a.translate();var d=a.scale(),b=+x[0],p=+x[1];return s=a.translate(x).clipExtent([[b-.455*d,p-.238*d],[b+.455*d,p+.238*d]]).stream(g),i=n.translate([b-.307*d,p+.201*d]).clipExtent([[b-.425*d+we,p+.12*d+we],[b-.214*d-we,p+.234*d-we]]).stream(g),c=o.translate([b-.205*d,p+.212*d]).clipExtent([[b-.214*d+we,p+.166*d+we],[b-.115*d-we,p+.234*d-we]]).stream(g),u()},l.fitExtent=function(x,d){return Dn(l,x,d)},l.fitSize=function(x,d){return hl(l,x,d)},l.fitWidth=function(x,d){return gl(l,x,d)},l.fitHeight=function(x,d){return ul(l,x,d)};function u(){return t=r=null,l}return l.scale(1070)}function _d(t){return function(r,a){var s=ye(r),n=ye(a),i=t(s*n);return i===1/0?[2,0]:[i*n*me(r),i*me(a)]}}function bs(t){return function(r,a){var s=ct(r*r+a*a),n=t(s),i=me(n),o=ye(n);return[St(r*i,s*o),Et(s&&a*i/s)]}}var pl=_d(function(t){return ct(2/(1+t))});pl.invert=bs(function(t){return 2*Et(t/2)});function px(){return br(pl).scale(124.75).clipAngle(180-.001)}var bl=_d(function(t){return(t=Hc(t))&&t/me(t)});bl.invert=bs(function(t){return t});function bx(){return br(bl).scale(79.4188).clipAngle(180-.001)}function fs(t,r){return[t,rn(il((rt+r)/2))]}fs.invert=function(t,r){return[t,2*Sa(Kc(r))-rt]};function fx(){return zd(fs).scale(961/zt)}function zd(t){var r=br(t),a=r.center,s=r.scale,n=r.translate,i=r.clipExtent,o=null,c,h,g;r.scale=function(u){return arguments.length?(s(u),l()):s()},r.translate=function(u){return arguments.length?(n(u),l()):n()},r.center=function(u){return arguments.length?(a(u),l()):a()},r.clipExtent=function(u){return arguments.length?(u==null?o=c=h=g=null:(o=+u[0][0],c=+u[0][1],h=+u[1][0],g=+u[1][1]),l()):o==null?null:[[o,c],[h,g]]};function l(){var u=$e*s(),x=r(rd(r.rotate()).invert([0,0]));return i(o==null?[[x[0]-u,x[1]-u],[x[0]+u,x[1]+u]]:t===fs?[[Math.max(x[0]-u,o),c],[Math.min(x[0]+u,h),g]]:[[o,Math.max(x[1]-u,c)],[h,Math.min(x[1]+u,g)]])}return l()}function Ls(t){return il((rt+t)/2)}function Sd(t,r){var a=ye(t),s=t===r?me(t):rn(a/ye(r))/rn(Ls(r)/Ls(t)),n=a*Un(Ls(t),s)/s;if(!s)return fs;function i(o,c){n>0?c<-rt+we&&(c=-rt+we):c>rt-we&&(c=rt-we);var h=n/Un(Ls(c),s);return[h*me(s*o),n-h*ye(s*o)]}return i.invert=function(o,c){var h=n-c,g=Zt(s)*ct(o*o+h*h),l=St(o,Le(h))*Zt(h);return h*s<0&&(l-=$e*Zt(o)*Zt(h)),[l/s,2*Sa(Un(n/g,1/s))-rt]},i}function yx(){return ml(Sd).scale(109.5).parallels([30,30])}function ss(t,r){return[t,r]}ss.invert=ss;function jx(){return br(ss).scale(152.63)}function Ed(t,r){var a=ye(t),s=t===r?me(t):(a-ye(r))/(r-t),n=a/s+t;if(Le(s)<we)return ss;function i(o,c){var h=n-c,g=s*o;return[h*me(g),n-h*ye(g)]}return i.invert=function(o,c){var h=n-c,g=St(o,Le(h))*Zt(h);return h*s<0&&(g-=$e*Zt(o)*Zt(h)),[g/s,n-Zt(s)*ct(o*o+h*h)]},i}function kx(){return ml(Ed).scale(131.154).center([0,13.9389])}var Za=1.340264,qa=-.081106,Ja=893e-6,Ua=.003796,Nn=ct(3)/2,vx=12;function fl(t,r){var a=Et(Nn*me(r)),s=a*a,n=s*s*s;return[t*ye(a)/(Nn*(Za+3*qa*s+n*(7*Ja+9*Ua*s))),a*(Za+qa*s+n*(Ja+Ua*s))]}fl.invert=function(t,r){for(var a=r,s=a*a,n=s*s*s,i=0,o,c,h;i<vx&&(c=a*(Za+qa*s+n*(Ja+Ua*s))-r,h=Za+3*qa*s+n*(7*Ja+9*Ua*s),a-=o=c/h,s=a*a,n=s*s*s,!(Le(o)<es));++i);return[Nn*t*(Za+3*qa*s+n*(7*Ja+9*Ua*s))/ye(a),Et(me(a)/Nn)]};function wx(){return br(fl).scale(177.158)}function yl(t,r){var a=ye(r),s=ye(t)*a;return[a*me(t)/s,me(r)/s]}yl.invert=bs(Sa);function Nx(){return br(yl).scale(144.049).clipAngle(60)}function _x(){var t=1,r=0,a=0,s=1,n=1,i=0,o,c,h=null,g,l,u,x=1,d=1,b=ps({point:function(w,_){var v=k([w,_]);this.stream.point(v[0],v[1])}}),p=ts,y,f;function j(){return x=t*s,d=t*n,y=f=null,k}function k(w){var _=w[0]*x,v=w[1]*d;if(i){var S=v*o-_*c;_=_*o+v*c,v=S}return[_+r,v+a]}return k.invert=function(w){var _=w[0]-r,v=w[1]-a;if(i){var S=v*o+_*c;_=_*o-v*c,v=S}return[_/x,v/d]},k.stream=function(w){return y&&f===w?y:y=b(p(f=w))},k.postclip=function(w){return arguments.length?(p=w,h=g=l=u=null,j()):p},k.clipExtent=function(w){return arguments.length?(p=w==null?(h=g=l=u=null,ts):Pn(h=+w[0][0],g=+w[0][1],l=+w[1][0],u=+w[1][1]),j()):h==null?null:[[h,g],[l,u]]},k.scale=function(w){return arguments.length?(t=+w,j()):t},k.translate=function(w){return arguments.length?(r=+w[0],a=+w[1],j()):[r,a]},k.angle=function(w){return arguments.length?(i=w%360*Ne,c=me(i),o=ye(i),j()):i*He},k.reflectX=function(w){return arguments.length?(s=w?-1:1,j()):s<0},k.reflectY=function(w){return arguments.length?(n=w?-1:1,j()):n<0},k.fitExtent=function(w,_){return Dn(k,w,_)},k.fitSize=function(w,_){return hl(k,w,_)},k.fitWidth=function(w,_){return gl(k,w,_)},k.fitHeight=function(w,_){return ul(k,w,_)},k}function jl(t,r){var a=r*r,s=a*a;return[t*(.8707-.131979*a+s*(-.013791+s*(.003971*a-.001529*s))),r*(1.007226+a*(.015085+s*(-.044475+.028874*a-.005916*s)))]}jl.invert=function(t,r){var a=r,s=25,n;do{var i=a*a,o=i*i;a-=n=(a*(1.007226+i*(.015085+o*(-.044475+.028874*i-.005916*o)))-r)/(1.007226+i*(.015085*3+o*(-.044475*7+.028874*9*i-.005916*11*o)))}while(Le(n)>we&&--s>0);return[t/(.8707+(i=a*a)*(-.131979+i*(-.013791+i*i*i*(.003971-.001529*i)))),a]};function zx(){return br(jl).scale(175.295)}function kl(t,r){return[ye(r)*me(t),me(r)]}kl.invert=bs(Et);function Sx(){return br(kl).scale(249.5).clipAngle(90+we)}function vl(t,r){var a=ye(r),s=1+ye(t)*a;return[a*me(t)/s,me(r)/s]}vl.invert=bs(function(t){return 2*Sa(t)});function Ex(){return br(vl).scale(250).clipAngle(142)}function wl(t,r){return[rn(il((rt+r)/2)),-t]}wl.invert=function(t,r){return[-r,2*Sa(Kc(t))-rt]};function Mx(){var t=zd(wl),r=t.center,a=t.rotate;return t.center=function(s){return arguments.length?r([-s[1],s[0]]):(s=r(),[s[1],-s[0]])},t.rotate=function(s){return arguments.length?a([s[0],s[1],s.length>2?s[2]+90:90]):(s=a(),[s[0],s[1],s[2]-90])},a([0,0,90]).scale(159.155)}const Wx=Object.freeze(Object.defineProperty({__proto__:null,geoAlbers:Nd,geoAlbersUsa:mx,geoArea:vu,geoAzimuthalEqualArea:px,geoAzimuthalEqualAreaRaw:pl,geoAzimuthalEquidistant:bx,geoAzimuthalEquidistantRaw:bl,geoBounds:zu,geoCentroid:Au,geoCircle:$u,geoClipAntimeridian:zi,geoClipCircle:od,geoClipExtent:Bu,geoClipRectangle:Pn,geoConicConformal:yx,geoConicConformalRaw:Sd,geoConicEqualArea:wn,geoConicEqualAreaRaw:wd,geoConicEquidistant:kx,geoConicEquidistantRaw:Ed,geoContains:Zu,geoDistance:pn,geoEqualEarth:wx,geoEqualEarthRaw:fl,geoEquirectangular:jx,geoEquirectangularRaw:ss,geoGnomonic:Nx,geoGnomonicRaw:yl,geoGraticule:cl,geoGraticule10:qu,geoIdentity:_x,geoInterpolate:Ju,geoLength:cd,geoMercator:fx,geoMercatorRaw:fs,geoNaturalEarth1:zx,geoNaturalEarth1Raw:jl,geoOrthographic:Sx,geoOrthographicRaw:kl,geoPath:vd,geoProjection:br,geoProjectionMutator:xl,geoRotation:rd,geoStereographic:Ex,geoStereographicRaw:vl,geoStream:tr,geoTransform:ix,geoTransverseMercator:Mx,geoTransverseMercatorRaw:wl},Symbol.toStringTag,{value:"Module"}));function Fx(t){return t}function Ax(t){if(t==null)return Fx;var r,a,s=t.scale[0],n=t.scale[1],i=t.translate[0],o=t.translate[1];return function(c,h){h||(r=a=0);var g=2,l=c.length,u=new Array(l);for(u[0]=(r+=c[0])*s+i,u[1]=(a+=c[1])*n+o;g<l;)u[g]=c[g],++g;return u}}function $x(t,r){for(var a,s=t.length,n=s-r;n<--s;)a=t[n],t[n++]=t[s],t[s]=a}function Cx(t,r){return typeof r=="string"&&(r=t.objects[r]),r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(a){return To(t,a)})}:To(t,r)}function To(t,r){var a=r.id,s=r.bbox,n=r.properties==null?{}:r.properties,i=Md(t,r);return a==null&&s==null?{type:"Feature",properties:n,geometry:i}:s==null?{type:"Feature",id:a,properties:n,geometry:i}:{type:"Feature",id:a,bbox:s,properties:n,geometry:i}}function Md(t,r){var a=Ax(t.transform),s=t.arcs;function n(l,u){u.length&&u.pop();for(var x=s[l<0?~l:l],d=0,b=x.length;d<b;++d)u.push(a(x[d],d));l<0&&$x(u,b)}function i(l){return a(l)}function o(l){for(var u=[],x=0,d=l.length;x<d;++x)n(l[x],u);return u.length<2&&u.push(u[0]),u}function c(l){for(var u=o(l);u.length<4;)u.push(u[0]);return u}function h(l){return l.map(c)}function g(l){var u=l.type,x;switch(u){case"GeometryCollection":return{type:u,geometries:l.geometries.map(g)};case"Point":x=i(l.coordinates);break;case"MultiPoint":x=l.coordinates.map(i);break;case"LineString":x=o(l.arcs);break;case"MultiLineString":x=l.arcs.map(o);break;case"Polygon":x=h(l.arcs);break;case"MultiPolygon":x=l.arcs.map(h);break;default:return null}return{type:u,coordinates:x}}return g(r)}function Px(t,r){var a={},s={},n={},i=[],o=-1;r.forEach(function(g,l){var u=t.arcs[g<0?~g:g],x;u.length<3&&!u[1][0]&&!u[1][1]&&(x=r[++o],r[o]=g,r[l]=x)}),r.forEach(function(g){var l=c(g),u=l[0],x=l[1],d,b;if(d=n[u])if(delete n[d.end],d.push(g),d.end=x,b=s[x]){delete s[b.start];var p=b===d?d:d.concat(b);s[p.start=d.start]=n[p.end=b.end]=p}else s[d.start]=n[d.end]=d;else if(d=s[x])if(delete s[d.start],d.unshift(g),d.start=u,b=n[u]){delete n[b.end];var y=b===d?d:b.concat(d);s[y.start=b.start]=n[y.end=d.end]=y}else s[d.start]=n[d.end]=d;else d=[g],s[d.start=u]=n[d.end=x]=d});function c(g){var l=t.arcs[g<0?~g:g],u=l[0],x;return t.transform?(x=[0,0],l.forEach(function(d){x[0]+=d[0],x[1]+=d[1]})):x=l[l.length-1],g<0?[x,u]:[u,x]}function h(g,l){for(var u in g){var x=g[u];delete l[x.start],delete x.start,delete x.end,x.forEach(function(d){a[d<0?~d:d]=1}),i.push(x)}}return h(n,s),h(s,n),r.forEach(function(g){a[g<0?~g:g]||i.push([g])}),i}function Ko(t){return Md(t,Dx.apply(this,arguments))}function Dx(t,r,a){var s,n,i;if(arguments.length>1)s=Lx(t,r,a);else for(n=0,s=new Array(i=t.arcs.length);n<i;++n)s[n]=n;return{type:"MultiLineString",arcs:Px(t,s)}}function Lx(t,r,a){var s=[],n=[],i;function o(u){var x=u<0?~u:u;(n[x]||(n[x]=[])).push({i:u,g:i})}function c(u){u.forEach(o)}function h(u){u.forEach(c)}function g(u){u.forEach(h)}function l(u){switch(i=u,u.type){case"GeometryCollection":u.geometries.forEach(l);break;case"LineString":c(u.arcs);break;case"MultiLineString":case"Polygon":h(u.arcs);break;case"MultiPolygon":g(u.arcs);break}}return l(r),n.forEach(a==null?function(u){s.push(u[0].i)}:function(u){a(u[0].g,u[u.length-1].g)&&s.push(u[0].i)}),s}var Ix={value:()=>{}};function Nl(){for(var t=0,r=arguments.length,a={},s;t<r;++t){if(!(s=arguments[t]+"")||s in a||/[\s.]/.test(s))throw new Error("illegal type: "+s);a[s]=[]}return new qs(a)}function qs(t){this._=t}function Vx(t,r){return t.trim().split(/^|\s+/).map(function(a){var s="",n=a.indexOf(".");if(n>=0&&(s=a.slice(n+1),a=a.slice(0,n)),a&&!r.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:s}})}qs.prototype=Nl.prototype={constructor:qs,on:function(t,r){var a=this._,s=Vx(t+"",a),n,i=-1,o=s.length;if(arguments.length<2){for(;++i<o;)if((n=(t=s[i]).type)&&(n=Bx(a[n],t.name)))return n;return}if(r!=null&&typeof r!="function")throw new Error("invalid callback: "+r);for(;++i<o;)if(n=(t=s[i]).type)a[n]=Ho(a[n],t.name,r);else if(r==null)for(n in a)a[n]=Ho(a[n],t.name,null);return this},copy:function(){var t={},r=this._;for(var a in r)t[a]=r[a].slice();return new qs(t)},call:function(t,r){if((n=arguments.length-2)>0)for(var a=new Array(n),s=0,n,i;s<n;++s)a[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],s=0,n=i.length;s<n;++s)i[s].value.apply(r,a)},apply:function(t,r,a){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var s=this._[t],n=0,i=s.length;n<i;++n)s[n].value.apply(r,a)}};function Bx(t,r){for(var a=0,s=t.length,n;a<s;++a)if((n=t[a]).name===r)return n.value}function Ho(t,r,a){for(var s=0,n=t.length;s<n;++s)if(t[s].name===r){t[s]=Ix,t=t.slice(0,s).concat(t.slice(s+1));break}return a!=null&&t.push({name:r,value:a}),t}var Vi="http://www.w3.org/1999/xhtml";const Go={svg:"http://www.w3.org/2000/svg",xhtml:Vi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ln(t){var r=t+="",a=r.indexOf(":");return a>=0&&(r=t.slice(0,a))!=="xmlns"&&(t=t.slice(a+1)),Go.hasOwnProperty(r)?{space:Go[r],local:t}:t}function Ox(t){return function(){var r=this.ownerDocument,a=this.namespaceURI;return a===Vi&&r.documentElement.namespaceURI===Vi?r.createElement(t):r.createElementNS(a,t)}}function Rx(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Wd(t){var r=Ln(t);return(r.local?Rx:Ox)(r)}function Tx(){}function _l(t){return t==null?Tx:function(){return this.querySelector(t)}}function Kx(t){typeof t!="function"&&(t=_l(t));for(var r=this._groups,a=r.length,s=new Array(a),n=0;n<a;++n)for(var i=r[n],o=i.length,c=s[n]=new Array(o),h,g,l=0;l<o;++l)(h=i[l])&&(g=t.call(h,h.__data__,l,i))&&("__data__"in h&&(g.__data__=h.__data__),c[l]=g);return new Dt(s,this._parents)}function Fd(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Hx(){return[]}function Ad(t){return t==null?Hx:function(){return this.querySelectorAll(t)}}function Gx(t){return function(){var r=t.apply(this,arguments);return r==null?[]:Fd(r)}}function Zx(t){typeof t=="function"?t=Gx(t):t=Ad(t);for(var r=this._groups,a=r.length,s=[],n=[],i=0;i<a;++i)for(var o=r[i],c=o.length,h,g=0;g<c;++g)(h=o[g])&&(s.push(t.call(h,h.__data__,g,o)),n.push(h));return new Dt(s,n)}function $d(t){return function(){return this.matches(t)}}function Cd(t){return function(r){return r.matches(t)}}var qx=Array.prototype.find;function Jx(t){return function(){return qx.call(this.children,t)}}function Ux(){return this.firstElementChild}function Yx(t){return this.select(t==null?Ux:Jx(typeof t=="function"?t:Cd(t)))}var Xx=Array.prototype.filter;function Qx(){return this.children}function em(t){return function(){return Xx.call(this.children,t)}}function tm(t){return this.selectAll(t==null?Qx:em(typeof t=="function"?t:Cd(t)))}function rm(t){typeof t!="function"&&(t=$d(t));for(var r=this._groups,a=r.length,s=new Array(a),n=0;n<a;++n)for(var i=r[n],o=i.length,c=s[n]=[],h,g=0;g<o;++g)(h=i[g])&&t.call(h,h.__data__,g,i)&&c.push(h);return new Dt(s,this._parents)}function Pd(t){return new Array(t.length)}function am(){return new Dt(this._enter||this._groups.map(Pd),this._parents)}function _n(t,r){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=r}_n.prototype={constructor:_n,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,r){return this._parent.insertBefore(t,r)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function sm(t){return function(){return t}}function nm(t,r,a,s,n,i){for(var o=0,c,h=r.length,g=i.length;o<g;++o)(c=r[o])?(c.__data__=i[o],s[o]=c):a[o]=new _n(t,i[o]);for(;o<h;++o)(c=r[o])&&(n[o]=c)}function im(t,r,a,s,n,i,o){var c,h,g=new Map,l=r.length,u=i.length,x=new Array(l),d;for(c=0;c<l;++c)(h=r[c])&&(x[c]=d=o.call(h,h.__data__,c,r)+"",g.has(d)?n[c]=h:g.set(d,h));for(c=0;c<u;++c)d=o.call(t,i[c],c,i)+"",(h=g.get(d))?(s[c]=h,h.__data__=i[c],g.delete(d)):a[c]=new _n(t,i[c]);for(c=0;c<l;++c)(h=r[c])&&g.get(x[c])===h&&(n[c]=h)}function lm(t){return t.__data__}function om(t,r){if(!arguments.length)return Array.from(this,lm);var a=r?im:nm,s=this._parents,n=this._groups;typeof t!="function"&&(t=sm(t));for(var i=n.length,o=new Array(i),c=new Array(i),h=new Array(i),g=0;g<i;++g){var l=s[g],u=n[g],x=u.length,d=Fd(t.call(l,l&&l.__data__,g,s)),b=d.length,p=c[g]=new Array(b),y=o[g]=new Array(b),f=h[g]=new Array(x);a(l,u,p,y,f,d,r);for(var j=0,k=0,w,_;j<b;++j)if(w=p[j]){for(j>=k&&(k=j+1);!(_=y[k])&&++k<b;);w._next=_||null}}return o=new Dt(o,s),o._enter=c,o._exit=h,o}function cm(){return new Dt(this._exit||this._groups.map(Pd),this._parents)}function dm(t,r,a){var s=this.enter(),n=this,i=this.exit();return s=typeof t=="function"?t(s):s.append(t+""),r!=null&&(n=r(n)),a==null?i.remove():a(i),s&&n?s.merge(n).order():n}function hm(t){if(!(t instanceof Dt))throw new Error("invalid merge");for(var r=this._groups,a=t._groups,s=r.length,n=a.length,i=Math.min(s,n),o=new Array(s),c=0;c<i;++c)for(var h=r[c],g=a[c],l=h.length,u=o[c]=new Array(l),x,d=0;d<l;++d)(x=h[d]||g[d])&&(u[d]=x);for(;c<s;++c)o[c]=r[c];return new Dt(o,this._parents)}function gm(){for(var t=this._groups,r=-1,a=t.length;++r<a;)for(var s=t[r],n=s.length-1,i=s[n],o;--n>=0;)(o=s[n])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function um(t){t||(t=xm);function r(u,x){return u&&x?t(u.__data__,x.__data__):!u-!x}for(var a=this._groups,s=a.length,n=new Array(s),i=0;i<s;++i){for(var o=a[i],c=o.length,h=n[i]=new Array(c),g,l=0;l<c;++l)(g=o[l])&&(h[l]=g);h.sort(r)}return new Dt(n,this._parents).order()}function xm(t,r){return t<r?-1:t>r?1:t>=r?0:NaN}function mm(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function pm(){return Array.from(this)}function bm(){for(var t=this._groups,r=0,a=t.length;r<a;++r)for(var s=t[r],n=0,i=s.length;n<i;++n){var o=s[n];if(o)return o}return null}function fm(){let t=0;for(const r of this)++t;return t}function ym(){return!this.node()}function jm(t){for(var r=this._groups,a=0,s=r.length;a<s;++a)for(var n=r[a],i=0,o=n.length,c;i<o;++i)(c=n[i])&&t.call(c,c.__data__,i,n);return this}function km(t){return function(){this.removeAttribute(t)}}function vm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function wm(t,r){return function(){this.setAttribute(t,r)}}function Nm(t,r){return function(){this.setAttributeNS(t.space,t.local,r)}}function _m(t,r){return function(){var a=r.apply(this,arguments);a==null?this.removeAttribute(t):this.setAttribute(t,a)}}function zm(t,r){return function(){var a=r.apply(this,arguments);a==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,a)}}function Sm(t,r){var a=Ln(t);if(arguments.length<2){var s=this.node();return a.local?s.getAttributeNS(a.space,a.local):s.getAttribute(a)}return this.each((r==null?a.local?vm:km:typeof r=="function"?a.local?zm:_m:a.local?Nm:wm)(a,r))}function Dd(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Em(t){return function(){this.style.removeProperty(t)}}function Mm(t,r,a){return function(){this.style.setProperty(t,r,a)}}function Wm(t,r,a){return function(){var s=r.apply(this,arguments);s==null?this.style.removeProperty(t):this.style.setProperty(t,s,a)}}function Fm(t,r,a){return arguments.length>1?this.each((r==null?Em:typeof r=="function"?Wm:Mm)(t,r,a??"")):_a(this.node(),t)}function _a(t,r){return t.style.getPropertyValue(r)||Dd(t).getComputedStyle(t,null).getPropertyValue(r)}function Am(t){return function(){delete this[t]}}function $m(t,r){return function(){this[t]=r}}function Cm(t,r){return function(){var a=r.apply(this,arguments);a==null?delete this[t]:this[t]=a}}function Pm(t,r){return arguments.length>1?this.each((r==null?Am:typeof r=="function"?Cm:$m)(t,r)):this.node()[t]}function Ld(t){return t.trim().split(/^|\s+/)}function zl(t){return t.classList||new Id(t)}function Id(t){this._node=t,this._names=Ld(t.getAttribute("class")||"")}Id.prototype={add:function(t){var r=this._names.indexOf(t);r<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var r=this._names.indexOf(t);r>=0&&(this._names.splice(r,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Vd(t,r){for(var a=zl(t),s=-1,n=r.length;++s<n;)a.add(r[s])}function Bd(t,r){for(var a=zl(t),s=-1,n=r.length;++s<n;)a.remove(r[s])}function Dm(t){return function(){Vd(this,t)}}function Lm(t){return function(){Bd(this,t)}}function Im(t,r){return function(){(r.apply(this,arguments)?Vd:Bd)(this,t)}}function Vm(t,r){var a=Ld(t+"");if(arguments.length<2){for(var s=zl(this.node()),n=-1,i=a.length;++n<i;)if(!s.contains(a[n]))return!1;return!0}return this.each((typeof r=="function"?Im:r?Dm:Lm)(a,r))}function Bm(){this.textContent=""}function Om(t){return function(){this.textContent=t}}function Rm(t){return function(){var r=t.apply(this,arguments);this.textContent=r??""}}function Tm(t){return arguments.length?this.each(t==null?Bm:(typeof t=="function"?Rm:Om)(t)):this.node().textContent}function Km(){this.innerHTML=""}function Hm(t){return function(){this.innerHTML=t}}function Gm(t){return function(){var r=t.apply(this,arguments);this.innerHTML=r??""}}function Zm(t){return arguments.length?this.each(t==null?Km:(typeof t=="function"?Gm:Hm)(t)):this.node().innerHTML}function qm(){this.nextSibling&&this.parentNode.appendChild(this)}function Jm(){return this.each(qm)}function Um(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ym(){return this.each(Um)}function Xm(t){var r=typeof t=="function"?t:Wd(t);return this.select(function(){return this.appendChild(r.apply(this,arguments))})}function Qm(){return null}function ep(t,r){var a=typeof t=="function"?t:Wd(t),s=r==null?Qm:typeof r=="function"?r:_l(r);return this.select(function(){return this.insertBefore(a.apply(this,arguments),s.apply(this,arguments)||null)})}function tp(){var t=this.parentNode;t&&t.removeChild(this)}function rp(){return this.each(tp)}function ap(){var t=this.cloneNode(!1),r=this.parentNode;return r?r.insertBefore(t,this.nextSibling):t}function sp(){var t=this.cloneNode(!0),r=this.parentNode;return r?r.insertBefore(t,this.nextSibling):t}function np(t){return this.select(t?sp:ap)}function ip(t){return arguments.length?this.property("__data__",t):this.node().__data__}function lp(t){return function(r){t.call(this,r,this.__data__)}}function op(t){return t.trim().split(/^|\s+/).map(function(r){var a="",s=r.indexOf(".");return s>=0&&(a=r.slice(s+1),r=r.slice(0,s)),{type:r,name:a}})}function cp(t){return function(){var r=this.__on;if(r){for(var a=0,s=-1,n=r.length,i;a<n;++a)i=r[a],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):r[++s]=i;++s?r.length=s:delete this.__on}}}function dp(t,r,a){return function(){var s=this.__on,n,i=lp(r);if(s){for(var o=0,c=s.length;o<c;++o)if((n=s[o]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=i,n.options=a),n.value=r;return}}this.addEventListener(t.type,i,a),n={type:t.type,name:t.name,value:r,listener:i,options:a},s?s.push(n):this.__on=[n]}}function hp(t,r,a){var s=op(t+""),n,i=s.length,o;if(arguments.length<2){var c=this.node().__on;if(c){for(var h=0,g=c.length,l;h<g;++h)for(n=0,l=c[h];n<i;++n)if((o=s[n]).type===l.type&&o.name===l.name)return l.value}return}for(c=r?dp:cp,n=0;n<i;++n)this.each(c(s[n],r,a));return this}function Od(t,r,a){var s=Dd(t),n=s.CustomEvent;typeof n=="function"?n=new n(r,a):(n=s.document.createEvent("Event"),a?(n.initEvent(r,a.bubbles,a.cancelable),n.detail=a.detail):n.initEvent(r,!1,!1)),t.dispatchEvent(n)}function gp(t,r){return function(){return Od(this,t,r)}}function up(t,r){return function(){return Od(this,t,r.apply(this,arguments))}}function xp(t,r){return this.each((typeof r=="function"?up:gp)(t,r))}function*mp(){for(var t=this._groups,r=0,a=t.length;r<a;++r)for(var s=t[r],n=0,i=s.length,o;n<i;++n)(o=s[n])&&(yield o)}var Rd=[null];function Dt(t,r){this._groups=t,this._parents=r}function ys(){return new Dt([[document.documentElement]],Rd)}function pp(){return this}Dt.prototype=ys.prototype={constructor:Dt,select:Kx,selectAll:Zx,selectChild:Yx,selectChildren:tm,filter:rm,data:om,enter:am,exit:cm,join:dm,merge:hm,selection:pp,order:gm,sort:um,call:mm,nodes:pm,node:bm,size:fm,empty:ym,each:jm,attr:Sm,style:Fm,property:Pm,classed:Vm,text:Tm,html:Zm,raise:Jm,lower:Ym,append:Xm,insert:ep,remove:rp,clone:np,datum:ip,on:hp,dispatch:xp,[Symbol.iterator]:mp};function vr(t){return typeof t=="string"?new Dt([[document.querySelector(t)]],[document.documentElement]):new Dt([[t]],Rd)}function bp(t){let r;for(;r=t.sourceEvent;)t=r;return t}function Hr(t,r){if(t=bp(t),r===void 0&&(r=t.currentTarget),r){var a=r.ownerSVGElement||r;if(a.createSVGPoint){var s=a.createSVGPoint();return s.x=t.clientX,s.y=t.clientY,s=s.matrixTransform(r.getScreenCTM().inverse()),[s.x,s.y]}if(r.getBoundingClientRect){var n=r.getBoundingClientRect();return[t.clientX-n.left-r.clientLeft,t.clientY-n.top-r.clientTop]}}return[t.pageX,t.pageY]}function Bi(t){t.preventDefault(),t.stopImmediatePropagation()}function fp(t){var r=t.document.documentElement,a=vr(t).on("dragstart.drag",Bi,!0);"onselectstart"in r?a.on("selectstart.drag",Bi,!0):(r.__noselect=r.style.MozUserSelect,r.style.MozUserSelect="none")}function yp(t,r){var a=t.document.documentElement,s=vr(t).on("dragstart.drag",null);r&&(s.on("click.drag",Bi,!0),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in a?s.on("selectstart.drag",null):(a.style.MozUserSelect=a.__noselect,delete a.__noselect)}var jp=1e-12;function Zo(t){return((t=Math.exp(t))+1/t)/2}function kp(t){return((t=Math.exp(t))-1/t)/2}function vp(t){return((t=Math.exp(2*t))-1)/(t+1)}const wp=function t(r,a,s){function n(i,o){var c=i[0],h=i[1],g=i[2],l=o[0],u=o[1],x=o[2],d=l-c,b=u-h,p=d*d+b*b,y,f;if(p<jp)f=Math.log(x/g)/r,y=function(S){return[c+S*d,h+S*b,g*Math.exp(r*S*f)]};else{var j=Math.sqrt(p),k=(x*x-g*g+s*p)/(2*g*a*j),w=(x*x-g*g-s*p)/(2*x*a*j),_=Math.log(Math.sqrt(k*k+1)-k),v=Math.log(Math.sqrt(w*w+1)-w);f=(v-_)/r,y=function(S){var V=S*f,C=Zo(_),I=g/(a*j)*(C*vp(r*V+_)-kp(_));return[c+I*d,h+I*b,g*C/Zo(r*V+_)]}}return y.duration=f*1e3*r/Math.SQRT2,y}return n.rho=function(i){var o=Math.max(.001,+i),c=o*o,h=c*c;return t(o,c,h)},n}(Math.SQRT2,2,4);var za=0,Ka=0,Pa=0,Td=1e3,zn,Ha,Sn=0,ra=0,In=0,ns=typeof performance=="object"&&performance.now?performance:Date,Kd=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Sl(){return ra||(Kd(Np),ra=ns.now()+In)}function Np(){ra=0}function En(){this._call=this._time=this._next=null}En.prototype=Hd.prototype={constructor:En,restart:function(t,r,a){if(typeof t!="function")throw new TypeError("callback is not a function");a=(a==null?Sl():+a)+(r==null?0:+r),!this._next&&Ha!==this&&(Ha?Ha._next=this:zn=this,Ha=this),this._call=t,this._time=a,Oi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Oi())}};function Hd(t,r,a){var s=new En;return s.restart(t,r,a),s}function _p(){Sl(),++za;for(var t=zn,r;t;)(r=ra-t._time)>=0&&t._call.call(null,r),t=t._next;--za}function qo(){ra=(Sn=ns.now())+In,za=Ka=0;try{_p()}finally{za=0,Sp(),ra=0}}function zp(){var t=ns.now(),r=t-Sn;r>Td&&(In-=r,Sn=t)}function Sp(){for(var t,r=zn,a,s=1/0;r;)r._call?(s>r._time&&(s=r._time),t=r,r=r._next):(a=r._next,r._next=null,r=t?t._next=a:zn=a);Ha=t,Oi(s)}function Oi(t){if(!za){Ka&&(Ka=clearTimeout(Ka));var r=t-ra;r>24?(t<1/0&&(Ka=setTimeout(qo,t-ns.now()-In)),Pa&&(Pa=clearInterval(Pa))):(Pa||(Sn=ns.now(),Pa=setInterval(zp,Td)),za=1,Kd(qo))}}function Jo(t,r,a){var s=new En;return r=r==null?0:+r,s.restart(n=>{s.stop(),t(n+r)},r,a),s}var Ep=Nl("start","end","cancel","interrupt"),Mp=[],Gd=0,Uo=1,Ri=2,Js=3,Yo=4,Ti=5,Us=6;function Vn(t,r,a,s,n,i){var o=t.__transition;if(!o)t.__transition={};else if(a in o)return;Wp(t,a,{name:r,index:s,group:n,on:Ep,tween:Mp,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Gd})}function El(t,r){var a=sr(t,r);if(a.state>Gd)throw new Error("too late; already scheduled");return a}function fr(t,r){var a=sr(t,r);if(a.state>Js)throw new Error("too late; already running");return a}function sr(t,r){var a=t.__transition;if(!a||!(a=a[r]))throw new Error("transition not found");return a}function Wp(t,r,a){var s=t.__transition,n;s[r]=a,a.timer=Hd(i,0,a.time);function i(g){a.state=Uo,a.timer.restart(o,a.delay,a.time),a.delay<=g&&o(g-a.delay)}function o(g){var l,u,x,d;if(a.state!==Uo)return h();for(l in s)if(d=s[l],d.name===a.name){if(d.state===Js)return Jo(o);d.state===Yo?(d.state=Us,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete s[l]):+l<r&&(d.state=Us,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete s[l])}if(Jo(function(){a.state===Js&&(a.state=Yo,a.timer.restart(c,a.delay,a.time),c(g))}),a.state=Ri,a.on.call("start",t,t.__data__,a.index,a.group),a.state===Ri){for(a.state=Js,n=new Array(x=a.tween.length),l=0,u=-1;l<x;++l)(d=a.tween[l].value.call(t,t.__data__,a.index,a.group))&&(n[++u]=d);n.length=u+1}}function c(g){for(var l=g<a.duration?a.ease.call(null,g/a.duration):(a.timer.restart(h),a.state=Ti,1),u=-1,x=n.length;++u<x;)n[u].call(t,l);a.state===Ti&&(a.on.call("end",t,t.__data__,a.index,a.group),h())}function h(){a.state=Us,a.timer.stop(),delete s[r];for(var g in s)return;delete t.__transition}}function Ys(t,r){var a=t.__transition,s,n,i=!0,o;if(a){r=r==null?null:r+"";for(o in a){if((s=a[o]).name!==r){i=!1;continue}n=s.state>Ri&&s.state<Ti,s.state=Us,s.timer.stop(),s.on.call(n?"interrupt":"cancel",t,t.__data__,s.index,s.group),delete a[o]}i&&delete t.__transition}}function Fp(t){return this.each(function(){Ys(this,t)})}function Ml(t,r,a){t.prototype=r.prototype=a,a.constructor=t}function Zd(t,r){var a=Object.create(t.prototype);for(var s in r)a[s]=r[s];return a}function js(){}var is=.7,Mn=1/is,ba="\\s*([+-]?\\d+)\\s*",ls="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",xr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ap=/^#([0-9a-f]{3,8})$/,$p=new RegExp("^rgb\\("+[ba,ba,ba]+"\\)$"),Cp=new RegExp("^rgb\\("+[xr,xr,xr]+"\\)$"),Pp=new RegExp("^rgba\\("+[ba,ba,ba,ls]+"\\)$"),Dp=new RegExp("^rgba\\("+[xr,xr,xr,ls]+"\\)$"),Lp=new RegExp("^hsl\\("+[ls,xr,xr]+"\\)$"),Ip=new RegExp("^hsla\\("+[ls,xr,xr,ls]+"\\)$"),Xo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ml(js,os,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Qo,formatHex:Qo,formatHsl:Vp,formatRgb:ec,toString:ec});function Qo(){return this.rgb().formatHex()}function Vp(){return qd(this).formatHsl()}function ec(){return this.rgb().formatRgb()}function os(t){var r,a;return t=(t+"").trim().toLowerCase(),(r=Ap.exec(t))?(a=r[1].length,r=parseInt(r[1],16),a===6?tc(r):a===3?new Rt(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):a===8?Is(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):a===4?Is(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=$p.exec(t))?new Rt(r[1],r[2],r[3],1):(r=Cp.exec(t))?new Rt(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=Pp.exec(t))?Is(r[1],r[2],r[3],r[4]):(r=Dp.exec(t))?Is(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=Lp.exec(t))?sc(r[1],r[2]/100,r[3]/100,1):(r=Ip.exec(t))?sc(r[1],r[2]/100,r[3]/100,r[4]):Xo.hasOwnProperty(t)?tc(Xo[t]):t==="transparent"?new Rt(NaN,NaN,NaN,0):null}function tc(t){return new Rt(t>>16&255,t>>8&255,t&255,1)}function Is(t,r,a,s){return s<=0&&(t=r=a=NaN),new Rt(t,r,a,s)}function Bp(t){return t instanceof js||(t=os(t)),t?(t=t.rgb(),new Rt(t.r,t.g,t.b,t.opacity)):new Rt}function Ki(t,r,a,s){return arguments.length===1?Bp(t):new Rt(t,r,a,s??1)}function Rt(t,r,a,s){this.r=+t,this.g=+r,this.b=+a,this.opacity=+s}Ml(Rt,Ki,Zd(js,{brighter:function(t){return t=t==null?Mn:Math.pow(Mn,t),new Rt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?is:Math.pow(is,t),new Rt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rc,formatHex:rc,formatRgb:ac,toString:ac}));function rc(){return"#"+ti(this.r)+ti(this.g)+ti(this.b)}function ac(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function ti(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function sc(t,r,a,s){return s<=0?t=r=a=NaN:a<=0||a>=1?t=r=NaN:r<=0&&(t=NaN),new dr(t,r,a,s)}function qd(t){if(t instanceof dr)return new dr(t.h,t.s,t.l,t.opacity);if(t instanceof js||(t=os(t)),!t)return new dr;if(t instanceof dr)return t;t=t.rgb();var r=t.r/255,a=t.g/255,s=t.b/255,n=Math.min(r,a,s),i=Math.max(r,a,s),o=NaN,c=i-n,h=(i+n)/2;return c?(r===i?o=(a-s)/c+(a<s)*6:a===i?o=(s-r)/c+2:o=(r-a)/c+4,c/=h<.5?i+n:2-i-n,o*=60):c=h>0&&h<1?0:o,new dr(o,c,h,t.opacity)}function Op(t,r,a,s){return arguments.length===1?qd(t):new dr(t,r,a,s??1)}function dr(t,r,a,s){this.h=+t,this.s=+r,this.l=+a,this.opacity=+s}Ml(dr,Op,Zd(js,{brighter:function(t){return t=t==null?Mn:Math.pow(Mn,t),new dr(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?is:Math.pow(is,t),new dr(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,r=isNaN(t)||isNaN(this.s)?0:this.s,a=this.l,s=a+(a<.5?a:1-a)*r,n=2*a-s;return new Rt(ri(t>=240?t-240:t+120,n,s),ri(t,n,s),ri(t<120?t+240:t-120,n,s),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function ri(t,r,a){return(t<60?r+(a-r)*t/60:t<180?a:t<240?r+(a-r)*(240-t)/60:r)*255}const Jd=t=>()=>t;function Rp(t,r){return function(a){return t+a*r}}function Tp(t,r,a){return t=Math.pow(t,a),r=Math.pow(r,a)-t,a=1/a,function(s){return Math.pow(t+s*r,a)}}function Kp(t){return(t=+t)==1?Ud:function(r,a){return a-r?Tp(r,a,t):Jd(isNaN(r)?a:r)}}function Ud(t,r){var a=r-t;return a?Rp(t,a):Jd(isNaN(t)?r:t)}const nc=function t(r){var a=Kp(r);function s(n,i){var o=a((n=Ki(n)).r,(i=Ki(i)).r),c=a(n.g,i.g),h=a(n.b,i.b),g=Ud(n.opacity,i.opacity);return function(l){return n.r=o(l),n.g=c(l),n.b=h(l),n.opacity=g(l),n+""}}return s.gamma=t,s}(1);function $r(t,r){return t=+t,r=+r,function(a){return t*(1-a)+r*a}}var Hi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ai=new RegExp(Hi.source,"g");function Hp(t){return function(){return t}}function Gp(t){return function(r){return t(r)+""}}function Zp(t,r){var a=Hi.lastIndex=ai.lastIndex=0,s,n,i,o=-1,c=[],h=[];for(t=t+"",r=r+"";(s=Hi.exec(t))&&(n=ai.exec(r));)(i=n.index)>a&&(i=r.slice(a,i),c[o]?c[o]+=i:c[++o]=i),(s=s[0])===(n=n[0])?c[o]?c[o]+=n:c[++o]=n:(c[++o]=null,h.push({i:o,x:$r(s,n)})),a=ai.lastIndex;return a<r.length&&(i=r.slice(a),c[o]?c[o]+=i:c[++o]=i),c.length<2?h[0]?Gp(h[0].x):Hp(r):(r=h.length,function(g){for(var l=0,u;l<r;++l)c[(u=h[l]).i]=u.x(g);return c.join("")})}var ic=180/Math.PI,Gi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yd(t,r,a,s,n,i){var o,c,h;return(o=Math.sqrt(t*t+r*r))&&(t/=o,r/=o),(h=t*a+r*s)&&(a-=t*h,s-=r*h),(c=Math.sqrt(a*a+s*s))&&(a/=c,s/=c,h/=c),t*s<r*a&&(t=-t,r=-r,h=-h,o=-o),{translateX:n,translateY:i,rotate:Math.atan2(r,t)*ic,skewX:Math.atan(h)*ic,scaleX:o,scaleY:c}}var Vs;function qp(t){const r=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return r.isIdentity?Gi:Yd(r.a,r.b,r.c,r.d,r.e,r.f)}function Jp(t){return t==null||(Vs||(Vs=document.createElementNS("http://www.w3.org/2000/svg","g")),Vs.setAttribute("transform",t),!(t=Vs.transform.baseVal.consolidate()))?Gi:(t=t.matrix,Yd(t.a,t.b,t.c,t.d,t.e,t.f))}function Xd(t,r,a,s){function n(g){return g.length?g.pop()+" ":""}function i(g,l,u,x,d,b){if(g!==u||l!==x){var p=d.push("translate(",null,r,null,a);b.push({i:p-4,x:$r(g,u)},{i:p-2,x:$r(l,x)})}else(u||x)&&d.push("translate("+u+r+x+a)}function o(g,l,u,x){g!==l?(g-l>180?l+=360:l-g>180&&(g+=360),x.push({i:u.push(n(u)+"rotate(",null,s)-2,x:$r(g,l)})):l&&u.push(n(u)+"rotate("+l+s)}function c(g,l,u,x){g!==l?x.push({i:u.push(n(u)+"skewX(",null,s)-2,x:$r(g,l)}):l&&u.push(n(u)+"skewX("+l+s)}function h(g,l,u,x,d,b){if(g!==u||l!==x){var p=d.push(n(d)+"scale(",null,",",null,")");b.push({i:p-4,x:$r(g,u)},{i:p-2,x:$r(l,x)})}else(u!==1||x!==1)&&d.push(n(d)+"scale("+u+","+x+")")}return function(g,l){var u=[],x=[];return g=t(g),l=t(l),i(g.translateX,g.translateY,l.translateX,l.translateY,u,x),o(g.rotate,l.rotate,u,x),c(g.skewX,l.skewX,u,x),h(g.scaleX,g.scaleY,l.scaleX,l.scaleY,u,x),g=l=null,function(d){for(var b=-1,p=x.length,y;++b<p;)u[(y=x[b]).i]=y.x(d);return u.join("")}}}var Up=Xd(qp,"px, ","px)","deg)"),Yp=Xd(Jp,", ",")",")");function Xp(t,r){var a,s;return function(){var n=fr(this,t),i=n.tween;if(i!==a){s=a=i;for(var o=0,c=s.length;o<c;++o)if(s[o].name===r){s=s.slice(),s.splice(o,1);break}}n.tween=s}}function Qp(t,r,a){var s,n;if(typeof a!="function")throw new Error;return function(){var i=fr(this,t),o=i.tween;if(o!==s){n=(s=o).slice();for(var c={name:r,value:a},h=0,g=n.length;h<g;++h)if(n[h].name===r){n[h]=c;break}h===g&&n.push(c)}i.tween=n}}function eb(t,r){var a=this._id;if(t+="",arguments.length<2){for(var s=sr(this.node(),a).tween,n=0,i=s.length,o;n<i;++n)if((o=s[n]).name===t)return o.value;return null}return this.each((r==null?Xp:Qp)(a,t,r))}function Wl(t,r,a){var s=t._id;return t.each(function(){var n=fr(this,s);(n.value||(n.value={}))[r]=a.apply(this,arguments)}),function(n){return sr(n,s).value[r]}}function Qd(t,r){var a;return(typeof r=="number"?$r:r instanceof os?nc:(a=os(r))?(r=a,nc):Zp)(t,r)}function tb(t){return function(){this.removeAttribute(t)}}function rb(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ab(t,r,a){var s,n=a+"",i;return function(){var o=this.getAttribute(t);return o===n?null:o===s?i:i=r(s=o,a)}}function sb(t,r,a){var s,n=a+"",i;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===s?i:i=r(s=o,a)}}function nb(t,r,a){var s,n,i;return function(){var o,c=a(this),h;return c==null?void this.removeAttribute(t):(o=this.getAttribute(t),h=c+"",o===h?null:o===s&&h===n?i:(n=h,i=r(s=o,c)))}}function ib(t,r,a){var s,n,i;return function(){var o,c=a(this),h;return c==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),h=c+"",o===h?null:o===s&&h===n?i:(n=h,i=r(s=o,c)))}}function lb(t,r){var a=Ln(t),s=a==="transform"?Yp:Qd;return this.attrTween(t,typeof r=="function"?(a.local?ib:nb)(a,s,Wl(this,"attr."+t,r)):r==null?(a.local?rb:tb)(a):(a.local?sb:ab)(a,s,r))}function ob(t,r){return function(a){this.setAttribute(t,r.call(this,a))}}function cb(t,r){return function(a){this.setAttributeNS(t.space,t.local,r.call(this,a))}}function db(t,r){var a,s;function n(){var i=r.apply(this,arguments);return i!==s&&(a=(s=i)&&cb(t,i)),a}return n._value=r,n}function hb(t,r){var a,s;function n(){var i=r.apply(this,arguments);return i!==s&&(a=(s=i)&&ob(t,i)),a}return n._value=r,n}function gb(t,r){var a="attr."+t;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(r==null)return this.tween(a,null);if(typeof r!="function")throw new Error;var s=Ln(t);return this.tween(a,(s.local?db:hb)(s,r))}function ub(t,r){return function(){El(this,t).delay=+r.apply(this,arguments)}}function xb(t,r){return r=+r,function(){El(this,t).delay=r}}function mb(t){var r=this._id;return arguments.length?this.each((typeof t=="function"?ub:xb)(r,t)):sr(this.node(),r).delay}function pb(t,r){return function(){fr(this,t).duration=+r.apply(this,arguments)}}function bb(t,r){return r=+r,function(){fr(this,t).duration=r}}function fb(t){var r=this._id;return arguments.length?this.each((typeof t=="function"?pb:bb)(r,t)):sr(this.node(),r).duration}function yb(t,r){if(typeof r!="function")throw new Error;return function(){fr(this,t).ease=r}}function jb(t){var r=this._id;return arguments.length?this.each(yb(r,t)):sr(this.node(),r).ease}function kb(t,r){return function(){var a=r.apply(this,arguments);if(typeof a!="function")throw new Error;fr(this,t).ease=a}}function vb(t){if(typeof t!="function")throw new Error;return this.each(kb(this._id,t))}function wb(t){typeof t!="function"&&(t=$d(t));for(var r=this._groups,a=r.length,s=new Array(a),n=0;n<a;++n)for(var i=r[n],o=i.length,c=s[n]=[],h,g=0;g<o;++g)(h=i[g])&&t.call(h,h.__data__,g,i)&&c.push(h);return new Mr(s,this._parents,this._name,this._id)}function Nb(t){if(t._id!==this._id)throw new Error;for(var r=this._groups,a=t._groups,s=r.length,n=a.length,i=Math.min(s,n),o=new Array(s),c=0;c<i;++c)for(var h=r[c],g=a[c],l=h.length,u=o[c]=new Array(l),x,d=0;d<l;++d)(x=h[d]||g[d])&&(u[d]=x);for(;c<s;++c)o[c]=r[c];return new Mr(o,this._parents,this._name,this._id)}function _b(t){return(t+"").trim().split(/^|\s+/).every(function(r){var a=r.indexOf(".");return a>=0&&(r=r.slice(0,a)),!r||r==="start"})}function zb(t,r,a){var s,n,i=_b(r)?El:fr;return function(){var o=i(this,t),c=o.on;c!==s&&(n=(s=c).copy()).on(r,a),o.on=n}}function Sb(t,r){var a=this._id;return arguments.length<2?sr(this.node(),a).on.on(t):this.each(zb(a,t,r))}function Eb(t){return function(){var r=this.parentNode;for(var a in this.__transition)if(+a!==t)return;r&&r.removeChild(this)}}function Mb(){return this.on("end.remove",Eb(this._id))}function Wb(t){var r=this._name,a=this._id;typeof t!="function"&&(t=_l(t));for(var s=this._groups,n=s.length,i=new Array(n),o=0;o<n;++o)for(var c=s[o],h=c.length,g=i[o]=new Array(h),l,u,x=0;x<h;++x)(l=c[x])&&(u=t.call(l,l.__data__,x,c))&&("__data__"in l&&(u.__data__=l.__data__),g[x]=u,Vn(g[x],r,a,x,g,sr(l,a)));return new Mr(i,this._parents,r,a)}function Fb(t){var r=this._name,a=this._id;typeof t!="function"&&(t=Ad(t));for(var s=this._groups,n=s.length,i=[],o=[],c=0;c<n;++c)for(var h=s[c],g=h.length,l,u=0;u<g;++u)if(l=h[u]){for(var x=t.call(l,l.__data__,u,h),d,b=sr(l,a),p=0,y=x.length;p<y;++p)(d=x[p])&&Vn(d,r,a,p,x,b);i.push(x),o.push(l)}return new Mr(i,o,r,a)}var Ab=ys.prototype.constructor;function $b(){return new Ab(this._groups,this._parents)}function Cb(t,r){var a,s,n;return function(){var i=_a(this,t),o=(this.style.removeProperty(t),_a(this,t));return i===o?null:i===a&&o===s?n:n=r(a=i,s=o)}}function eh(t){return function(){this.style.removeProperty(t)}}function Pb(t,r,a){var s,n=a+"",i;return function(){var o=_a(this,t);return o===n?null:o===s?i:i=r(s=o,a)}}function Db(t,r,a){var s,n,i;return function(){var o=_a(this,t),c=a(this),h=c+"";return c==null&&(h=c=(this.style.removeProperty(t),_a(this,t))),o===h?null:o===s&&h===n?i:(n=h,i=r(s=o,c))}}function Lb(t,r){var a,s,n,i="style."+r,o="end."+i,c;return function(){var h=fr(this,t),g=h.on,l=h.value[i]==null?c||(c=eh(r)):void 0;(g!==a||n!==l)&&(s=(a=g).copy()).on(o,n=l),h.on=s}}function Ib(t,r,a){var s=(t+="")=="transform"?Up:Qd;return r==null?this.styleTween(t,Cb(t,s)).on("end.style."+t,eh(t)):typeof r=="function"?this.styleTween(t,Db(t,s,Wl(this,"style."+t,r))).each(Lb(this._id,t)):this.styleTween(t,Pb(t,s,r),a).on("end.style."+t,null)}function Vb(t,r,a){return function(s){this.style.setProperty(t,r.call(this,s),a)}}function Bb(t,r,a){var s,n;function i(){var o=r.apply(this,arguments);return o!==n&&(s=(n=o)&&Vb(t,o,a)),s}return i._value=r,i}function Ob(t,r,a){var s="style."+(t+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(r==null)return this.tween(s,null);if(typeof r!="function")throw new Error;return this.tween(s,Bb(t,r,a??""))}function Rb(t){return function(){this.textContent=t}}function Tb(t){return function(){var r=t(this);this.textContent=r??""}}function Kb(t){return this.tween("text",typeof t=="function"?Tb(Wl(this,"text",t)):Rb(t==null?"":t+""))}function Hb(t){return function(r){this.textContent=t.call(this,r)}}function Gb(t){var r,a;function s(){var n=t.apply(this,arguments);return n!==a&&(r=(a=n)&&Hb(n)),r}return s._value=t,s}function Zb(t){var r="text";if(arguments.length<1)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Gb(t))}function qb(){for(var t=this._name,r=this._id,a=th(),s=this._groups,n=s.length,i=0;i<n;++i)for(var o=s[i],c=o.length,h,g=0;g<c;++g)if(h=o[g]){var l=sr(h,r);Vn(h,t,a,g,o,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new Mr(s,this._parents,t,a)}function Jb(){var t,r,a=this,s=a._id,n=a.size();return new Promise(function(i,o){var c={value:o},h={value:function(){--n===0&&i()}};a.each(function(){var g=fr(this,s),l=g.on;l!==t&&(r=(t=l).copy(),r._.cancel.push(c),r._.interrupt.push(c),r._.end.push(h)),g.on=r}),n===0&&i()})}var Ub=0;function Mr(t,r,a,s){this._groups=t,this._parents=r,this._name=a,this._id=s}function th(){return++Ub}var Gr=ys.prototype;Mr.prototype={constructor:Mr,select:Wb,selectAll:Fb,filter:wb,merge:Nb,selection:$b,transition:qb,call:Gr.call,nodes:Gr.nodes,node:Gr.node,size:Gr.size,empty:Gr.empty,each:Gr.each,on:Sb,attr:lb,attrTween:gb,style:Ib,styleTween:Ob,text:Kb,textTween:Zb,remove:Mb,tween:eb,delay:mb,duration:fb,ease:jb,easeVarying:vb,end:Jb,[Symbol.iterator]:Gr[Symbol.iterator]};function Yb(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Xb={time:null,delay:0,duration:250,ease:Yb};function Qb(t,r){for(var a;!(a=t.__transition)||!(a=a[r]);)if(!(t=t.parentNode))throw new Error(`transition ${r} not found`);return a}function ef(t){var r,a;t instanceof Mr?(r=t._id,t=t._name):(r=th(),(a=Xb).time=Sl(),t=t==null?null:t+"");for(var s=this._groups,n=s.length,i=0;i<n;++i)for(var o=s[i],c=o.length,h,g=0;g<c;++g)(h=o[g])&&Vn(h,t,r,g,o,a||Qb(h,r));return new Mr(s,this._parents,t,r)}ys.prototype.interrupt=Fp;ys.prototype.transition=ef;const Bs=t=>()=>t;function tf(t,{sourceEvent:r,target:a,transform:s,dispatch:n}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:r,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:n}})}function Nr(t,r,a){this.k=t,this.x=r,this.y=a}Nr.prototype={constructor:Nr,scale:function(t){return t===1?this:new Nr(this.k*t,this.x,this.y)},translate:function(t,r){return t===0&r===0?this:new Nr(this.k,this.x+this.k*t,this.y+this.k*r)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Fl=new Nr(1,0,0);Nr.prototype;function si(t){t.stopImmediatePropagation()}function Da(t){t.preventDefault(),t.stopImmediatePropagation()}function rf(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function af(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function lc(){return this.__zoom||Fl}function sf(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function nf(){return navigator.maxTouchPoints||"ontouchstart"in this}function lf(t,r,a){var s=t.invertX(r[0][0])-a[0][0],n=t.invertX(r[1][0])-a[1][0],i=t.invertY(r[0][1])-a[0][1],o=t.invertY(r[1][1])-a[1][1];return t.translate(n>s?(s+n)/2:Math.min(0,s)||Math.max(0,n),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function of(){var t=rf,r=af,a=lf,s=sf,n=nf,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],c=250,h=wp,g=Nl("start","zoom","end"),l,u,x,d=500,b=150,p=0,y=10;function f(N){N.property("__zoom",lc).on("wheel.zoom",V).on("mousedown.zoom",C).on("dblclick.zoom",I).filter(n).on("touchstart.zoom",F).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",W).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}f.transform=function(N,z,A,P){var E=N.selection?N.selection():N;E.property("__zoom",lc),N!==E?_(N,z,A,P):E.interrupt().each(function(){v(this,arguments).event(P).start().zoom(null,typeof z=="function"?z.apply(this,arguments):z).end()})},f.scaleBy=function(N,z,A,P){f.scaleTo(N,function(){var E=this.__zoom.k,L=typeof z=="function"?z.apply(this,arguments):z;return E*L},A,P)},f.scaleTo=function(N,z,A,P){f.transform(N,function(){var E=r.apply(this,arguments),L=this.__zoom,R=A==null?w(E):typeof A=="function"?A.apply(this,arguments):A,X=L.invert(R),O=typeof z=="function"?z.apply(this,arguments):z;return a(k(j(L,O),R,X),E,o)},A,P)},f.translateBy=function(N,z,A,P){f.transform(N,function(){return a(this.__zoom.translate(typeof z=="function"?z.apply(this,arguments):z,typeof A=="function"?A.apply(this,arguments):A),r.apply(this,arguments),o)},null,P)},f.translateTo=function(N,z,A,P,E){f.transform(N,function(){var L=r.apply(this,arguments),R=this.__zoom,X=P==null?w(L):typeof P=="function"?P.apply(this,arguments):P;return a(Fl.translate(X[0],X[1]).scale(R.k).translate(typeof z=="function"?-z.apply(this,arguments):-z,typeof A=="function"?-A.apply(this,arguments):-A),L,o)},P,E)};function j(N,z){return z=Math.max(i[0],Math.min(i[1],z)),z===N.k?N:new Nr(z,N.x,N.y)}function k(N,z,A){var P=z[0]-A[0]*N.k,E=z[1]-A[1]*N.k;return P===N.x&&E===N.y?N:new Nr(N.k,P,E)}function w(N){return[(+N[0][0]+ +N[1][0])/2,(+N[0][1]+ +N[1][1])/2]}function _(N,z,A,P){N.on("start.zoom",function(){v(this,arguments).event(P).start()}).on("interrupt.zoom end.zoom",function(){v(this,arguments).event(P).end()}).tween("zoom",function(){var E=this,L=arguments,R=v(E,L).event(P),X=r.apply(E,L),O=A==null?w(X):typeof A=="function"?A.apply(E,L):A,B=Math.max(X[1][0]-X[0][0],X[1][1]-X[0][1]),G=E.__zoom,T=typeof z=="function"?z.apply(E,L):z,q=h(G.invert(O).concat(B/G.k),T.invert(O).concat(B/T.k));return function(re){if(re===1)re=T;else{var de=q(re),ue=B/de[2];re=new Nr(ue,O[0]-de[0]*ue,O[1]-de[1]*ue)}R.zoom(null,re)}})}function v(N,z,A){return!A&&N.__zooming||new S(N,z)}function S(N,z){this.that=N,this.args=z,this.active=0,this.sourceEvent=null,this.extent=r.apply(N,z),this.taps=0}S.prototype={event:function(N){return N&&(this.sourceEvent=N),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(N,z){return this.mouse&&N!=="mouse"&&(this.mouse[1]=z.invert(this.mouse[0])),this.touch0&&N!=="touch"&&(this.touch0[1]=z.invert(this.touch0[0])),this.touch1&&N!=="touch"&&(this.touch1[1]=z.invert(this.touch1[0])),this.that.__zoom=z,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(N){var z=vr(this.that).datum();g.call(N,this.that,new tf(N,{sourceEvent:this.sourceEvent,target:f,transform:this.that.__zoom,dispatch:g}),z)}};function V(N,...z){if(!t.apply(this,arguments))return;var A=v(this,z).event(N),P=this.__zoom,E=Math.max(i[0],Math.min(i[1],P.k*Math.pow(2,s.apply(this,arguments)))),L=Hr(N);if(A.wheel)(A.mouse[0][0]!==L[0]||A.mouse[0][1]!==L[1])&&(A.mouse[1]=P.invert(A.mouse[0]=L)),clearTimeout(A.wheel);else{if(P.k===E)return;A.mouse=[L,P.invert(L)],Ys(this),A.start()}Da(N),A.wheel=setTimeout(R,b),A.zoom("mouse",a(k(j(P,E),A.mouse[0],A.mouse[1]),A.extent,o));function R(){A.wheel=null,A.end()}}function C(N,...z){if(x||!t.apply(this,arguments))return;var A=v(this,z,!0).event(N),P=vr(N.view).on("mousemove.zoom",O,!0).on("mouseup.zoom",B,!0),E=Hr(N,L),L=N.currentTarget,R=N.clientX,X=N.clientY;fp(N.view),si(N),A.mouse=[E,this.__zoom.invert(E)],Ys(this),A.start();function O(G){if(Da(G),!A.moved){var T=G.clientX-R,q=G.clientY-X;A.moved=T*T+q*q>p}A.event(G).zoom("mouse",a(k(A.that.__zoom,A.mouse[0]=Hr(G,L),A.mouse[1]),A.extent,o))}function B(G){P.on("mousemove.zoom mouseup.zoom",null),yp(G.view,A.moved),Da(G),A.event(G).end()}}function I(N,...z){if(t.apply(this,arguments)){var A=this.__zoom,P=Hr(N.changedTouches?N.changedTouches[0]:N,this),E=A.invert(P),L=A.k*(N.shiftKey?.5:2),R=a(k(j(A,L),P,E),r.apply(this,z),o);Da(N),c>0?vr(this).transition().duration(c).call(_,R,P,N):vr(this).call(f.transform,R,P,N)}}function F(N,...z){if(t.apply(this,arguments)){var A=N.touches,P=A.length,E=v(this,z,N.changedTouches.length===P).event(N),L,R,X,O;for(si(N),R=0;R<P;++R)X=A[R],O=Hr(X,this),O=[O,this.__zoom.invert(O),X.identifier],E.touch0?!E.touch1&&E.touch0[2]!==O[2]&&(E.touch1=O,E.taps=0):(E.touch0=O,L=!0,E.taps=1+!!l);l&&(l=clearTimeout(l)),L&&(E.taps<2&&(u=O[0],l=setTimeout(function(){l=null},d)),Ys(this),E.start())}}function M(N,...z){if(this.__zooming){var A=v(this,z).event(N),P=N.changedTouches,E=P.length,L,R,X,O;for(Da(N),L=0;L<E;++L)R=P[L],X=Hr(R,this),A.touch0&&A.touch0[2]===R.identifier?A.touch0[0]=X:A.touch1&&A.touch1[2]===R.identifier&&(A.touch1[0]=X);if(R=A.that.__zoom,A.touch1){var B=A.touch0[0],G=A.touch0[1],T=A.touch1[0],q=A.touch1[1],re=(re=T[0]-B[0])*re+(re=T[1]-B[1])*re,de=(de=q[0]-G[0])*de+(de=q[1]-G[1])*de;R=j(R,Math.sqrt(re/de)),X=[(B[0]+T[0])/2,(B[1]+T[1])/2],O=[(G[0]+q[0])/2,(G[1]+q[1])/2]}else if(A.touch0)X=A.touch0[0],O=A.touch0[1];else return;A.zoom("touch",a(k(R,X,O),A.extent,o))}}function W(N,...z){if(this.__zooming){var A=v(this,z).event(N),P=N.changedTouches,E=P.length,L,R;for(si(N),x&&clearTimeout(x),x=setTimeout(function(){x=null},d),L=0;L<E;++L)R=P[L],A.touch0&&A.touch0[2]===R.identifier?delete A.touch0:A.touch1&&A.touch1[2]===R.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(R=Hr(R,this),Math.hypot(u[0]-R[0],u[1]-R[1])<y)){var X=vr(this).on("dblclick.zoom");X&&X.apply(this,arguments)}}}return f.wheelDelta=function(N){return arguments.length?(s=typeof N=="function"?N:Bs(+N),f):s},f.filter=function(N){return arguments.length?(t=typeof N=="function"?N:Bs(!!N),f):t},f.touchable=function(N){return arguments.length?(n=typeof N=="function"?N:Bs(!!N),f):n},f.extent=function(N){return arguments.length?(r=typeof N=="function"?N:Bs([[+N[0][0],+N[0][1]],[+N[1][0],+N[1][1]]]),f):r},f.scaleExtent=function(N){return arguments.length?(i[0]=+N[0],i[1]=+N[1],f):[i[0],i[1]]},f.translateExtent=function(N){return arguments.length?(o[0][0]=+N[0][0],o[1][0]=+N[1][0],o[0][1]=+N[0][1],o[1][1]=+N[1][1],f):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},f.constrain=function(N){return arguments.length?(a=N,f):a},f.duration=function(N){return arguments.length?(c=+N,f):c},f.interpolate=function(N){return arguments.length?(h=N,f):h},f.on=function(){var N=g.on.apply(g,arguments);return N===g?f:N},f.clickDistance=function(N){return arguments.length?(p=(N=+N)*N,f):Math.sqrt(p)},f.tapDistance=function(N){return arguments.length?(y=+N,f):y},f}function oc(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),a.push.apply(a,s)}return a}function xa(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?oc(Object(a),!0).forEach(function(s){cf(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):oc(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function Zi(t){"@babel/helpers - typeof";return Zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Zi(t)}function cf(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function Lt(){return Lt=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},Lt.apply(this,arguments)}function df(t,r){if(t==null)return{};var a={},s=Object.keys(t),n,i;for(i=0;i<s.length;i++)n=s[i],!(r.indexOf(n)>=0)&&(a[n]=t[n]);return a}function Yt(t,r){if(t==null)return{};var a=df(t,r),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(a[s]=t[s])}return a}function ht(t,r){return hf(t)||gf(t,r)||uf(t,r)||xf()}function hf(t){if(Array.isArray(t))return t}function gf(t,r){var a=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(a!=null){var s=[],n=!0,i=!1,o,c;try{for(a=a.call(t);!(n=(o=a.next()).done)&&(s.push(o.value),!(r&&s.length===r));n=!0);}catch(h){i=!0,c=h}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw c}}return s}}function uf(t,r){if(t){if(typeof t=="string")return cc(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cc(t,r)}}function cc(t,r){(r==null||r>t.length)&&(r=t.length);for(var a=0,s=new Array(r);a<r;a++)s[a]=t[a];return s}function xf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var mf=["width","height","projection","projectionConfig"],pf=vd,bf=Yt(Wx,["geoPath"]),yr=m.createContext(),ff=function(r){var a=r.projectionConfig,s=a===void 0?{}:a,n=r.projection,i=n===void 0?"geoEqualEarth":n,o=r.width,c=o===void 0?800:o,h=r.height,g=h===void 0?600:h,l=typeof i=="function";if(l)return i;var u=bf[i]().translate([c/2,g/2]),x=[u.center?"center":null,u.rotate?"rotate":null,u.scale?"scale":null,u.parallels?"parallels":null];return x.forEach(function(d){d&&(u=u[d](s[d]||u[d]()))}),u},rh=function(r){var a=r.width,s=r.height,n=r.projection,i=r.projectionConfig,o=Yt(r,mf),c=i.center||[],h=ht(c,2),g=h[0],l=h[1],u=i.rotate||[],x=ht(u,3),d=x[0],b=x[1],p=x[2],y=i.parallels||[],f=ht(y,2),j=f[0],k=f[1],w=i.scale||null,_=m.useMemo(function(){return ff({projectionConfig:{center:g||g===0||l||l===0?[g,l]:null,rotate:d||d===0||b||b===0?[d,b,p]:null,parallels:j||j===0||k||k===0?[j,k]:null,scale:w},projection:n,width:a,height:s})},[a,s,n,g,l,d,b,p,j,k,w]),v=m.useCallback(_,[_]),S=m.useMemo(function(){return{width:a,height:s,projection:v,path:pf().projection(v)}},[a,s,v]);return at.createElement(yr.Provider,Lt({value:S},o))};rh.propTypes={width:ne.number,height:ne.number,projection:ne.oneOfType([ne.string,ne.func]),projectionConfig:ne.object};var yf=["width","height","projection","projectionConfig","className"],Al=m.forwardRef(function(t,r){var a=t.width,s=a===void 0?800:a,n=t.height,i=n===void 0?600:n,o=t.projection,c=o===void 0?"geoEqualEarth":o,h=t.projectionConfig,g=h===void 0?{}:h,l=t.className,u=l===void 0?"":l,x=Yt(t,yf);return at.createElement(rh,{width:s,height:i,projection:c,projectionConfig:g},at.createElement("svg",Lt({ref:r,viewBox:"0 0 ".concat(s," ").concat(i),className:"rsm-svg ".concat(u)},x)))});Al.displayName="ComposableMap";Al.propTypes={width:ne.number,height:ne.number,projection:ne.oneOfType([ne.string,ne.func]),projectionConfig:ne.object,className:ne.string};function dc(t,r,a){var s=(t*a.k-t)/2,n=(r*a.k-r)/2;return[t/2-(s+a.x)/a.k,r/2-(n+a.y)/a.k]}function jf(t){return fetch(t).then(function(r){if(!r.ok)throw Error(r.statusText);return r.json()}).catch(function(r){console.log("There was a problem when fetching the data: ",r)})}function hc(t,r){var a=t.type==="Topology";if(!a)return r?r(t.features||t):t.features||t;var s=Cx(t,t.objects[Object.keys(t.objects)[0]]).features;return r?r(s):s}function gc(t){var r=t.type==="Topology";if(!r)return null;var a=Ko(t,t.objects[Object.keys(t.objects)[0]],function(n,i){return n===i}),s=Ko(t,t.objects[Object.keys(t.objects)[0]],function(n,i){return n!==i});return{outline:a,borders:s}}function kf(t,r,a){return t&&r?{outline:xa(xa({},t),{},{rsmKey:"outline",svgPath:a(t)}),borders:xa(xa({},r),{},{rsmKey:"borders",svgPath:a(r)})}:{}}function vf(t,r){return t?t.map(function(a,s){return xa(xa({},a),{},{rsmKey:"geo-".concat(s),svgPath:r(a)})}):[]}function wf(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:30,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:30,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.5,s=Array.isArray(a)?a:[a,a],n=t/2*s[0],i=r/2*s[1];return"M".concat(0,",",0," Q",-t/2-n,",").concat(-r/2+i," ").concat(-t,",").concat(-r)}function Nf(t){return typeof t=="string"}function _f(t){var r=t.geography,a=t.parseGeographies,s=m.useContext(yr),n=s.path,i=m.useState({}),o=ht(i,2),c=o[0],h=o[1];m.useEffect(function(){(typeof window>"u"?"undefined":Zi(window))!=="undefined"&&r&&(Nf(r)?jf(r).then(function(d){d&&h({geographies:hc(d,a),mesh:gc(d)})}):h({geographies:hc(r,a),mesh:gc(r)}))},[r,a]);var g=m.useMemo(function(){var d=c.mesh||{},b=kf(d.outline,d.borders,n);return{geographies:vf(c.geographies,n),outline:b.outline,borders:b.borders}},[c,n]),l=g.geographies,u=g.outline,x=g.borders;return{geographies:l,outline:u,borders:x}}var zf=["geography","children","parseGeographies","className"],$l=m.forwardRef(function(t,r){var a=t.geography,s=t.children,n=t.parseGeographies,i=t.className,o=i===void 0?"":i,c=Yt(t,zf),h=m.useContext(yr),g=h.path,l=h.projection,u=_f({geography:a,parseGeographies:n}),x=u.geographies,d=u.outline,b=u.borders;return at.createElement("g",Lt({ref:r,className:"rsm-geographies ".concat(o)},c),x&&x.length>0&&s({geographies:x,outline:d,borders:b,path:g,projection:l}))});$l.displayName="Geographies";$l.propTypes={geography:ne.oneOfType([ne.string,ne.object,ne.array]),children:ne.func,parseGeographies:ne.func,className:ne.string};var Sf=["geography","onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onFocus","onBlur","style","className"],Cl=m.forwardRef(function(t,r){var a=t.geography,s=t.onMouseEnter,n=t.onMouseLeave,i=t.onMouseDown,o=t.onMouseUp,c=t.onFocus,h=t.onBlur,g=t.style,l=g===void 0?{}:g,u=t.className,x=u===void 0?"":u,d=Yt(t,Sf),b=m.useState(!1),p=ht(b,2),y=p[0],f=p[1],j=m.useState(!1),k=ht(j,2),w=k[0],_=k[1];function v(M){_(!0),s&&s(M)}function S(M){_(!1),y&&f(!1),n&&n(M)}function V(M){_(!0),c&&c(M)}function C(M){_(!1),y&&f(!1),h&&h(M)}function I(M){f(!0),i&&i(M)}function F(M){f(!1),o&&o(M)}return at.createElement("path",Lt({ref:r,tabIndex:"0",className:"rsm-geography ".concat(x),d:a.svgPath,onMouseEnter:v,onMouseLeave:S,onFocus:V,onBlur:C,onMouseDown:I,onMouseUp:F,style:l[y||w?y?"pressed":"hover":"default"]},d))});Cl.displayName="Geography";Cl.propTypes={geography:ne.object,onMouseEnter:ne.func,onMouseLeave:ne.func,onMouseDown:ne.func,onMouseUp:ne.func,onFocus:ne.func,onBlur:ne.func,style:ne.object,className:ne.string};var Ef=m.memo(Cl),Mf=["fill","stroke","step","className"],Pl=m.forwardRef(function(t,r){var a=t.fill,s=a===void 0?"transparent":a,n=t.stroke,i=n===void 0?"currentcolor":n,o=t.step,c=o===void 0?[10,10]:o,h=t.className,g=h===void 0?"":h,l=Yt(t,Mf),u=m.useContext(yr),x=u.path;return at.createElement("path",Lt({ref:r,d:x(cl().step(c)()),fill:s,stroke:i,className:"rsm-graticule ".concat(g)},l))});Pl.displayName="Graticule";Pl.propTypes={fill:ne.string,stroke:ne.string,step:ne.array,className:ne.string};m.memo(Pl);var Wf=["value"],Ff=m.createContext(),Af={x:0,y:0,k:1,transformString:"translate(0 0) scale(1)"},ah=function(r){var a=r.value,s=a===void 0?Af:a,n=Yt(r,Wf);return at.createElement(Ff.Provider,Lt({value:s},n))};ah.propTypes={x:ne.number,y:ne.number,k:ne.number,transformString:ne.string};function $f(t){var r=t.center,a=t.filterZoomEvent,s=t.onMoveStart,n=t.onMoveEnd,i=t.onMove,o=t.translateExtent,c=o===void 0?[[-1/0,-1/0],[1/0,1/0]]:o,h=t.scaleExtent,g=h===void 0?[1,8]:h,l=t.zoom,u=l===void 0?1:l,x=m.useContext(yr),d=x.width,b=x.height,p=x.projection,y=ht(r,2),f=y[0],j=y[1],k=m.useState({x:0,y:0,k:1}),w=ht(k,2),_=w[0],v=w[1],S=m.useRef({x:0,y:0,k:1}),V=m.useRef(),C=m.useRef(),I=m.useRef(!1),F=ht(c,2),M=F[0],W=F[1],N=ht(M,2),z=N[0],A=N[1],P=ht(W,2),E=P[0],L=P[1],R=ht(g,2),X=R[0],O=R[1];return m.useEffect(function(){var B=vr(V.current);function G(ue){!s||I.current||s({coordinates:p.invert(dc(d,b,ue.transform)),zoom:ue.transform.k},ue)}function T(ue){if(!I.current){var ee=ue.transform,pe=ue.sourceEvent;v({x:ee.x,y:ee.y,k:ee.k,dragging:pe}),i&&i({x:ee.x,y:ee.y,zoom:ee.k,dragging:pe},ue)}}function q(ue){if(I.current){I.current=!1;return}var ee=p.invert(dc(d,b,ue.transform)),pe=ht(ee,2),Be=pe[0],ie=pe[1];S.current={x:Be,y:ie,k:ue.transform.k},n&&n({coordinates:[Be,ie],zoom:ue.transform.k},ue)}function re(ue){return a?a(ue):ue?!ue.ctrlKey&&!ue.button:!1}var de=of().filter(re).scaleExtent([X,O]).translateExtent([[z,A],[E,L]]).on("start",G).on("zoom",T).on("end",q);C.current=de,B.call(de)},[d,b,z,A,E,L,X,O,p,s,i,n,a]),m.useEffect(function(){if(!(f===S.current.x&&j===S.current.y&&u===S.current.k)){var B=p([f,j]),G=B[0]*u,T=B[1]*u,q=vr(V.current);I.current=!0,q.call(C.current.transform,Fl.translate(d/2-G,b/2-T).scale(u)),v({x:d/2-G,y:b/2-T,k:u}),S.current={x:f,y:j,k:u}}},[f,j,u,d,b,p]),{mapRef:V,position:_,transformString:"translate(".concat(_.x," ").concat(_.y,") scale(").concat(_.k,")")}}var Cf=["center","zoom","minZoom","maxZoom","translateExtent","filterZoomEvent","onMoveStart","onMove","onMoveEnd","className"],sh=m.forwardRef(function(t,r){var a=t.center,s=a===void 0?[0,0]:a,n=t.zoom,i=n===void 0?1:n,o=t.minZoom,c=o===void 0?1:o,h=t.maxZoom,g=h===void 0?8:h,l=t.translateExtent,u=t.filterZoomEvent,x=t.onMoveStart,d=t.onMove,b=t.onMoveEnd,p=t.className,y=Yt(t,Cf),f=m.useContext(yr),j=f.width,k=f.height,w=$f({center:s,filterZoomEvent:u,onMoveStart:x,onMove:d,onMoveEnd:b,scaleExtent:[c,g],translateExtent:l,zoom:i}),_=w.mapRef,v=w.transformString,S=w.position;return at.createElement(ah,{value:{x:S.x,y:S.y,k:S.k,transformString:v}},at.createElement("g",{ref:_},at.createElement("rect",{width:j,height:k,fill:"transparent"}),at.createElement("g",Lt({ref:r,transform:v,className:"rsm-zoomable-group ".concat(p)},y))))});sh.displayName="ZoomableGroup";sh.propTypes={center:ne.array,zoom:ne.number,minZoom:ne.number,maxZoom:ne.number,translateExtent:ne.arrayOf(ne.array),onMoveStart:ne.func,onMove:ne.func,onMoveEnd:ne.func,className:ne.string};var Pf=["id","fill","stroke","strokeWidth","className"],Dl=m.forwardRef(function(t,r){var a=t.id,s=a===void 0?"rsm-sphere":a,n=t.fill,i=n===void 0?"transparent":n,o=t.stroke,c=o===void 0?"currentcolor":o,h=t.strokeWidth,g=h===void 0?.5:h,l=t.className,u=l===void 0?"":l,x=Yt(t,Pf),d=m.useContext(yr),b=d.path,p=m.useMemo(function(){return b({type:"Sphere"})},[b]);return at.createElement(m.Fragment,null,at.createElement("defs",null,at.createElement("clipPath",{id:s},at.createElement("path",{d:p}))),at.createElement("path",Lt({ref:r,d:p,fill:i,stroke:c,strokeWidth:g,style:{pointerEvents:"none"},className:"rsm-sphere ".concat(u)},x)))});Dl.displayName="Sphere";Dl.propTypes={id:ne.string,fill:ne.string,stroke:ne.string,strokeWidth:ne.number,className:ne.string};m.memo(Dl);var Df=["coordinates","children","onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onFocus","onBlur","style","className"],nh=m.forwardRef(function(t,r){var a=t.coordinates,s=t.children,n=t.onMouseEnter,i=t.onMouseLeave,o=t.onMouseDown,c=t.onMouseUp,h=t.onFocus,g=t.onBlur,l=t.style,u=l===void 0?{}:l,x=t.className,d=x===void 0?"":x,b=Yt(t,Df),p=m.useContext(yr),y=p.projection,f=m.useState(!1),j=ht(f,2),k=j[0],w=j[1],_=m.useState(!1),v=ht(_,2),S=v[0],V=v[1],C=y(a),I=ht(C,2),F=I[0],M=I[1];function W(L){V(!0),n&&n(L)}function N(L){V(!1),k&&w(!1),i&&i(L)}function z(L){V(!0),h&&h(L)}function A(L){V(!1),k&&w(!1),g&&g(L)}function P(L){w(!0),o&&o(L)}function E(L){w(!1),c&&c(L)}return at.createElement("g",Lt({ref:r,transform:"translate(".concat(F,", ").concat(M,")"),className:"rsm-marker ".concat(d),onMouseEnter:W,onMouseLeave:N,onFocus:z,onBlur:A,onMouseDown:P,onMouseUp:E,style:u[k||S?k?"pressed":"hover":"default"]},b),s)});nh.displayName="Marker";nh.propTypes={coordinates:ne.array,children:ne.oneOfType([ne.node,ne.arrayOf(ne.node)]),onMouseEnter:ne.func,onMouseLeave:ne.func,onMouseDown:ne.func,onMouseUp:ne.func,onFocus:ne.func,onBlur:ne.func,style:ne.object,className:ne.string};var Lf=["from","to","coordinates","stroke","strokeWidth","fill","className"],ih=m.forwardRef(function(t,r){var a=t.from,s=a===void 0?[0,0]:a,n=t.to,i=n===void 0?[0,0]:n,o=t.coordinates,c=t.stroke,h=c===void 0?"currentcolor":c,g=t.strokeWidth,l=g===void 0?3:g,u=t.fill,x=u===void 0?"transparent":u,d=t.className,b=d===void 0?"":d,p=Yt(t,Lf),y=m.useContext(yr),f=y.path,j={type:"LineString",coordinates:o||[s,i]};return at.createElement("path",Lt({ref:r,d:f(j),className:"rsm-line ".concat(b),stroke:h,strokeWidth:l,fill:x},p))});ih.displayName="Line";ih.propTypes={from:ne.array,to:ne.array,coordinates:ne.array,stroke:ne.string,strokeWidth:ne.number,fill:ne.string,className:ne.string};var If=["subject","children","connectorProps","dx","dy","curve","className"],lh=m.forwardRef(function(t,r){var a=t.subject,s=t.children,n=t.connectorProps,i=t.dx,o=i===void 0?30:i,c=t.dy,h=c===void 0?30:c,g=t.curve,l=g===void 0?0:g,u=t.className,x=u===void 0?"":u,d=Yt(t,If),b=m.useContext(yr),p=b.projection,y=p(a),f=ht(y,2),j=f[0],k=f[1],w=wf(o,h,l);return at.createElement("g",Lt({ref:r,transform:"translate(".concat(j+o,", ").concat(k+h,")"),className:"rsm-annotation ".concat(x)},d),at.createElement("path",Lt({d:w,fill:"transparent",stroke:"#000"},n)),s)});lh.displayName="Annotation";lh.propTypes={subject:ne.array,children:ne.oneOfType([ne.node,ne.arrayOf(ne.node)]),dx:ne.number,dy:ne.number,curve:ne.number,connectorProps:ne.object,className:ne.string};const ni={BW:{name:"Baden-Württemberg",kurzname:"BaWü"},BY:{name:"Bayern",kurzname:"Bayern"},BE:{name:"Berlin",kurzname:"Berlin"},BB:{name:"Brandenburg",kurzname:"Brandenb."},HB:{name:"Bremen",kurzname:"Bremen"},HH:{name:"Hamburg",kurzname:"Hamburg"},HE:{name:"Hessen",kurzname:"Hessen"},MV:{name:"Mecklenburg-Vorpommern",kurzname:"MeckPom"},NI:{name:"Niedersachsen",kurzname:"Nieders."},NW:{name:"Nordrhein-Westfalen",kurzname:"NRW"},RP:{name:"Rheinland-Pfalz",kurzname:"RhPf"},SL:{name:"Saarland",kurzname:"Saarland"},SN:{name:"Sachsen",kurzname:"Sachsen"},ST:{name:"Sachsen-Anhalt",kurzname:"SaAnh"},SH:{name:"Schleswig-Holstein",kurzname:"SchlHol"},TH:{name:"Thüringen",kurzname:"Thüring."},AT:{name:"Österreich",kurzname:"Österr."},CH:{name:"Schweiz",kurzname:"Schweiz"}};function ii(t,r,a){if(a===r)return"#fbbf24";const s=Math.max(0,Math.min(1,(t-r)/(a-r))),n=Math.round(219+32*s),i=Math.round(234+-43*s),o=Math.round(254+-218*s);return`rgb(${n},${i},${o})`}function Vf({allRegions:t,eigeneRegion:r}){var h;const[a,s]=m.useState(null),n=m.useMemo(()=>{const g={};return t.forEach(l=>{g[l.region]=l.durchschnitt_spez_ertrag}),g},[t]),i=m.useMemo(()=>{const g={};return t.forEach(l=>{g[l.region]=l}),g},[t]),{min:o,max:c}=m.useMemo(()=>{const g=t.map(l=>l.durchschnitt_spez_ertrag);return{min:Math.min(...g),max:Math.max(...g)}},[t]);return e.jsxs("div",{className:"relative",children:[e.jsx(Al,{projection:"geoMercator",projectionConfig:{center:[10.4515,51.2],scale:2800},width:500,height:560,style:{width:"100%",height:"auto"},children:e.jsx($l,{geography:"/deutschland-bundeslaender.geo.json",children:({geographies:g})=>g.map(l=>{const u=l.properties.id.replace("DE-",""),x=n[u],d=u===r;return e.jsx(Ef,{geography:l,fill:x!==void 0?ii(x,o,c):"#e5e7eb",stroke:d?"#1d4ed8":"#fff",strokeWidth:d?2.5:.8,style:{default:{outline:"none"},hover:{outline:"none",opacity:.85,cursor:"pointer"},pressed:{outline:"none"}},onMouseEnter:b=>{x!==void 0&&s({name:l.properties.name,region:i[u]??null,wert:x,x:b.clientX,y:b.clientY})},onMouseMove:b=>{a&&s(p=>p?{...p,x:b.clientX,y:b.clientY}:null)},onMouseLeave:()=>s(null)},l.rsmKey)})})}),a&&e.jsxs("div",{className:"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-2 shadow-lg pointer-events-none text-sm",style:{left:a.x+12,top:a.y-40},children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-medium",children:[a.wert.toFixed(0)," kWh/kWp"]}),a.region&&e.jsxs("div",{className:"mt-1 pt-1 border-t border-gray-100 dark:border-gray-700 space-y-0.5 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("p",{children:[a.region.anzahl_anlagen," Anlage",a.region.anzahl_anlagen!==1?"n":""," · Ø ",a.region.durchschnitt_kwp.toFixed(1)," kWp"]}),a.region.avg_speicher_ladung_kwh!=null&&e.jsxs("p",{children:["🔋 ",a.region.avg_speicher_ladung_kwh.toFixed(0)," ↑ / ",((h=a.region.avg_speicher_entladung_kwh)==null?void 0:h.toFixed(0))??"–"," ↓ kWh/Mon"]}),a.region.avg_wp_jaz!=null&&e.jsxs("p",{children:["♨️ JAZ ",a.region.avg_wp_jaz.toFixed(1)]}),a.region.avg_eauto_km!=null&&e.jsxs("p",{children:["🚗 ",a.region.avg_eauto_km.toFixed(0)," km/Mon · ",a.region.avg_eauto_ladung_kwh!=null?`${a.region.avg_eauto_ladung_kwh.toFixed(0)} kWh zuhause`:"–"]}),a.region.avg_wallbox_kwh!=null&&e.jsxs("p",{children:["🔌 ",a.region.avg_wallbox_kwh.toFixed(0)," kWh/Mon",a.region.avg_wallbox_pv_anteil!=null?` · ${a.region.avg_wallbox_pv_anteil.toFixed(0)}% PV`:""]}),a.region.avg_bkw_kwh!=null&&e.jsxs("p",{children:["🪟 ",a.region.avg_bkw_kwh.toFixed(0)," kWh/Mon"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 justify-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:o.toFixed(0)}),e.jsx("div",{className:"h-3 w-32 rounded",style:{background:`linear-gradient(to right, ${ii(o,o,c)}, ${ii(c,o,c)})`}}),e.jsxs("span",{className:"text-xs text-gray-500",children:[c.toFixed(0)," kWh/kWp"]})]}),r&&e.jsx("p",{className:"text-xs text-center text-blue-600 dark:text-blue-400 mt-1",children:"Dein Bundesland: blauer Rahmen"})]})}function Bf({anlageId:t,zeitraum:r}){var x;const[a,s]=m.useState(null),[n,i]=m.useState([]),[o,c]=m.useState(!1),[h,g]=m.useState(null);m.useEffect(()=>{(async()=>{c(!0),g(null);try{const[b,p]=await Promise.all([tt.getBenchmark(t,r),tt.getRegionalStatistics().catch(()=>[])]);s(b),i(p)}catch(b){g(b instanceof Error?b.message:"Fehler beim Laden")}finally{c(!1)}})()},[t,r]);const l=m.useMemo(()=>{var k;if(!a)return null;const{spez_ertrag_anlage:d,spez_ertrag_region:b,spez_ertrag_durchschnitt:p,rang_region:y,anzahl_anlagen_region:f}=a.benchmark,j=a.anlage.region;return{region:j,regionName:((k=ni[j])==null?void 0:k.name)||j,spezErtrag:d,regionDurchschnitt:b,communityDurchschnitt:p,rang:y,anzahlAnlagen:f,abweichungRegion:(d-b)/b*100,abweichungCommunity:(b-p)/p*100,perzentilRegion:Math.round((1-y/f)*100)}},[a]),u=m.useMemo(()=>l?[{name:"Du",wert:l.spezErtrag,fill:"var(--color-primary-500, #3b82f6)"},{name:l.regionName,wert:l.regionDurchschnitt,fill:"#60a5fa"},{name:"Community",wert:l.communityDurchschnitt,fill:"#9ca3af"}]:[],[l]);return o?e.jsx(Me,{text:"Lade regionale Daten..."}):h?e.jsx(ae,{type:"error",children:h}):!a||!l?null:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Betrachtungszeitraum: ",a.zeitraum_label]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(_t,{className:"h-5 w-5 text-blue-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Dein Standort"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.regionName})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[l.anzahlAnlagen," Anlagen in der Region"]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900/30",children:e.jsx(ma,{className:"h-5 w-5 text-yellow-500"})}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rang in ",((x=ni[l.region])==null?void 0:x.kurzname)||l.region]})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["#",l.rang]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["von ",l.anzahlAnlagen]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Besser als ",l.perzentilRegion,"% in deiner Region"]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${l.abweichungRegion>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:l.abweichungRegion>=0?e.jsx(We,{className:"h-5 w-5 text-green-500"}):e.jsx(qt,{className:"h-5 w-5 text-red-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Region"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${l.abweichungRegion>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[l.abweichungRegion>=0?"+":"",l.abweichungRegion.toFixed(1),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Ø Region: ",l.regionDurchschnitt.toFixed(0)," kWh/kWp"]})]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(oe,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Spezifischer Ertrag im Vergleich"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:u,layout:"vertical",children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!0,vertical:!1}),e.jsx(ve,{type:"number",tick:{fill:"#6b7280",fontSize:12},domain:[0,"auto"],label:{value:"kWh/kWp",position:"bottom",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:100}),e.jsx(xe,{formatter:d=>[`${d.toFixed(0)} kWh/kWp`,"Spez. Ertrag"],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(le,{dataKey:"wert",radius:[0,4,4,0],children:u.map((d,b)=>e.jsx(Ge,{fill:d.fill},`cell-${b}`))})]})})})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_r,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Regionale Einordnung"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:[l.regionName," vs. Community"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`text-lg font-semibold ${l.abweichungCommunity>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[l.abweichungCommunity>=0?"+":"",l.abweichungCommunity.toFixed(1),"%"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[l.abweichungCommunity>=0?"über":"unter"," dem Durchschnitt"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Deine Region liegt ",l.abweichungCommunity>=0?"über":"unter"," dem bundesweiten Community-Durchschnitt von ",l.communityDurchschnitt.toFixed(0)," kWh/kWp."]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Deine Anlage"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Ausrichtung:"}),e.jsx("span",{className:"text-gray-900 dark:text-white capitalize",children:a.anlage.ausrichtung})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Neigung:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[a.anlage.neigung_grad,"°"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Leistung:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[a.anlage.kwp," kWp"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Installation:"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:a.anlage.installation_jahr})]})]})]})]})]}),n.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_t,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Spezifischer Ertrag nach Bundesland"})]}),e.jsx(Vf,{allRegions:n,eigeneRegion:(a==null?void 0:a.anlage.region)??null})]}),n.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_t,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Alle Regionen im Vergleich"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Region"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Anlagen"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Ø kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Ø kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:"Ø Ladung ↑ / Entladung ↓ pro Monat (kWh)",children:"🔋 Ladung/Entl."}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:"Ø Jahresarbeitszahl (Σ Wärme ÷ Σ Strom)",children:"♨️ JAZ"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:"Ø km/Mon · Ø kWh zuhause geladen",children:"🚗 km / kWh"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:"Ø kWh geladen/Mon · davon PV-Anteil (wo messbar)",children:"🔌 kWh / PV%"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:"Ø BKW-Ertrag pro Monat (kWh)",children:"🪟 kWh/Mon"})]})}),e.jsx("tbody",{children:n.sort((d,b)=>b.durchschnitt_spez_ertrag-d.durchschnitt_spez_ertrag).map((d,b)=>{var y,f;const p=d.region===(a==null?void 0:a.anlage.region);return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${p?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-medium w-5 text-center ${b<3?"text-yellow-600":"text-gray-400"}`,children:b+1}),e.jsx("span",{className:`font-medium ${p?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white"}`,children:((y=ni[d.region])==null?void 0:y.name)||d.region}),p&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]})}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.anzahl_anlagen}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.durchschnitt_kwp.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900 dark:text-white",children:d.durchschnitt_spez_ertrag.toFixed(0)}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400 leading-tight",children:d.avg_speicher_ladung_kwh!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.avg_speicher_ladung_kwh.toFixed(0)," ↑"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[((f=d.avg_speicher_entladung_kwh)==null?void 0:f.toFixed(0))??"–"," ↓ kWh"]})]}):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.avg_wp_jaz!=null?d.avg_wp_jaz.toFixed(1):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400 leading-tight",children:d.avg_eauto_km!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.avg_eauto_km.toFixed(0)," km"]}),e.jsx("div",{className:"text-xs text-gray-400",children:d.avg_eauto_ladung_kwh!=null?`${d.avg_eauto_ladung_kwh.toFixed(0)} kWh`:"–"})]}):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400 leading-tight",children:d.avg_wallbox_kwh!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.avg_wallbox_kwh.toFixed(0)," kWh"]}),e.jsx("div",{className:"text-xs text-gray-400",children:d.avg_wallbox_pv_anteil!=null?`${d.avg_wallbox_pv_anteil.toFixed(0)}% PV`:"–"})]}):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.avg_bkw_kwh!=null?`${d.avg_bkw_kwh.toFixed(0)} kWh`:"-"})]},d.region)})})]})})]})]})}const li=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Of=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],uc={fruehling:{name:"Frühling",monate:[3,4,5],icon:mt,color:"green"},sommer:{name:"Sommer",monate:[6,7,8],icon:oe,color:"yellow"},herbst:{name:"Herbst",monate:[9,10,11],icon:Lr,color:"orange"},winter:{name:"Winter",monate:[12,1,2],icon:Yh,color:"blue"}};function Rf({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[h,g]=m.useState(!1),[l,u]=m.useState(null);m.useEffect(()=>{(async()=>{g(!0),u(null);try{const[f,j,k]=await Promise.all([tt.getBenchmark(t,r),tt.getTrends("12_monate").catch(()=>null),tt.getDegradation().catch(()=>null)]);s(f),i(j),c(k)}catch(f){u(f instanceof Error?f.message:"Fehler beim Laden")}finally{g(!1)}})()},[t,r]);const x=m.useMemo(()=>a!=null&&a.anlage.monatswerte?[...a.anlage.monatswerte].sort((f,j)=>f.jahr-j.jahr||f.monat-j.monat).map(f=>({name:`${li[f.monat-1]} ${f.jahr%100}`,monat:f.monat,jahr:f.jahr,ertrag:f.spez_ertrag_kwh_kwp||0,autarkie:f.autarkie_prozent||null,eigenverbrauch:f.eigenverbrauch_prozent||null})):[],[a]),d=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return null;const y=a.anlage.monatswerte,f=[...new Set(y.map(I=>I.jahr))].sort();if(f.length<2)return null;const j={};y.forEach(I=>{j[I.jahr]||(j[I.jahr]={summe:0,anzahl:0}),j[I.jahr].summe+=I.spez_ertrag_kwh_kwp||0,j[I.jahr].anzahl+=1});const k=f.filter(I=>j[I].anzahl===12);if(k.length<2)return null;const w=k[k.length-1],_=k[k.length-2],v=j[w].summe,S=j[_].summe,V=v-S,C=V/S*100;return{letztesJahr:w,vorletztesJahr:_,ertragLetzt:v,ertragVorletzt:S,differenz:V,differenzProzent:C}},[a]),b=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return null;const y=a.anlage.monatswerte,f={};return Object.entries(uc).forEach(([j,k])=>{f[j]={summe:0,anzahl:0},y.forEach(w=>{k.monate.includes(w.monat)&&(f[j].summe+=w.spez_ertrag_kwh_kwp||0,f[j].anzahl+=1)})}),Object.entries(uc).map(([j,k])=>{const w=f[j],_=w.anzahl>0?w.summe/w.anzahl:0;return{key:j,name:k.name,icon:k.icon,color:k.color,durchschnittMonat:_,anzahlMonate:w.anzahl}})},[a]),p=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return[];const y=a.anlage.monatswerte,f={};for(let j=1;j<=12;j++)f[j]={summe:0,anzahl:0};return y.forEach(j=>{f[j.monat].summe+=j.spez_ertrag_kwh_kwp||0,f[j.monat].anzahl+=1}),Object.entries(f).map(([j,k])=>({monat:parseInt(j),name:li[parseInt(j)-1],durchschnitt:k.anzahl>0?k.summe/k.anzahl:0,anzahl:k.anzahl}))},[a]);return h?e.jsx(Me,{text:"Lade Trend-Daten..."}):l?e.jsx(ae,{type:"error",children:l}):a?e.jsxs("div",{className:"space-y-6",children:[x.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ertragsverlauf"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Or,{data:x,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorErtrag",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-primary-500, #3b82f6)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-primary-500, #3b82f6)",stopOpacity:0})]})}),e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ve,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11},interval:Math.floor(x.length/12)}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(xe,{formatter:y=>[`${y.toFixed(1)} kWh/kWp`,"Spez. Ertrag"],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx($t,{type:"monotone",dataKey:"ertrag",stroke:"var(--color-primary-500, #3b82f6)",strokeWidth:2,fill:"url(#colorErtrag)"})]})})})]}),b&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Mt,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Saisonale Performance"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:b.map(y=>{const f=y.icon,k={green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",icon:"text-green-500"},yellow:{bg:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-700 dark:text-yellow-300",icon:"text-yellow-500"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-700 dark:text-orange-300",icon:"text-orange-500"},blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-300",icon:"text-blue-500"}}[y.color];return e.jsxs("div",{className:`rounded-xl p-4 ${k.bg}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(f,{className:`h-5 w-5 ${k.icon}`}),e.jsx("span",{className:`font-medium ${k.text}`,children:y.name})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y.durchschnittMonat.toFixed(0)}),e.jsx("span",{className:"text-sm text-gray-500",children:"kWh/kWp"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Ø pro Monat (",y.anzahlMonate," Monate)"]})]},y.key)})})]}),d&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Tt,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:d.vorletztesJahr}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.ertragVorletzt.toFixed(0)}),e.jsx("span",{className:"text-sm text-gray-500",children:"kWh/kWp"})]})]}),e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-primary-600 dark:text-primary-400 mb-1",children:d.letztesJahr}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",children:d.ertragLetzt.toFixed(0)}),e.jsx("span",{className:"text-sm text-primary-500",children:"kWh/kWp"})]})]}),e.jsxs("div",{className:`rounded-xl p-4 ${d.differenzProzent>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Veränderung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.differenzProzent>=0?e.jsx(Ah,{className:"h-6 w-6 text-green-500"}):d.differenzProzent<=-.5?e.jsx(Fh,{className:"h-6 w-6 text-red-500"}):e.jsx(Xs,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("span",{className:`text-2xl font-bold ${d.differenzProzent>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[d.differenzProzent>=0?"+":"",d.differenzProzent.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[d.differenz>=0?"+":"",d.differenz.toFixed(0)," kWh/kWp"]})]})]})]})]})]}),p.some(y=>y.anzahl>1)&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(oe,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Typischer Monatsverlauf"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:p,children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ve,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},domain:[0,"auto"]}),e.jsx(xe,{formatter:(y,f)=>f==="durchschnitt"?[`${y.toFixed(1)} kWh/kWp`,"Ø Ertrag"]:[y,f],labelFormatter:y=>Of[li.indexOf(y)],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ce,{formatter:()=>"Durchschnittlicher Ertrag"}),e.jsx(qe,{type:"monotone",dataKey:"durchschnitt",stroke:"var(--color-primary-500, #3b82f6)",strokeWidth:3,dot:{fill:"var(--color-primary-500, #3b82f6)",strokeWidth:2},activeDot:{r:6}})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 text-center mt-2",children:["Basierend auf ",x.length," Monaten Daten"]})]}),n&&n.trends.speicher_quote.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(We,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Community-Entwicklung"})]}),e.jsx("div",{className:"h-72",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:n.trends.speicher_quote.map((y,f)=>{var j,k;return{monat:y.monat,speicher:y.wert,waermepumpe:((j=n.trends.waermepumpe_quote[f])==null?void 0:j.wert)||0,eauto:((k=n.trends.eauto_quote[f])==null?void 0:k.wert)||0}}),children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ve,{dataKey:"monat",tick:{fill:"#6b7280",fontSize:10},interval:1}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},domain:[0,100],unit:"%"}),e.jsx(xe,{formatter:(y,f)=>{const j={speicher:"Speicher",waermepumpe:"Wärmepumpe",eauto:"E-Auto"};return[`${y.toFixed(1)}%`,j[f]||f]},contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ce,{formatter:y=>({speicher:"Speicher-Quote",waermepumpe:"Wärmepumpen-Quote",eauto:"E-Auto-Quote"})[y]||y}),e.jsx(qe,{type:"monotone",dataKey:"speicher",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(qe,{type:"monotone",dataKey:"waermepumpe",stroke:"#3b82f6",strokeWidth:2,dot:!1}),e.jsx(qe,{type:"monotone",dataKey:"eauto",stroke:"#a855f7",strokeWidth:2,dot:!1})]})})}),e.jsx("p",{className:"text-sm text-gray-500 text-center mt-2",children:"Anteil der Community-Anlagen mit jeweiliger Ausstattung"})]}),o&&o.nach_alter.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Tt,{className:"h-5 w-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Degradation nach Anlagenalter"})]}),e.jsx("div",{className:"h-64",children:e.jsx(ge,{width:"100%",height:"100%",children:e.jsxs(Dr,{data:o.nach_alter,children:[e.jsx(ke,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ve,{dataKey:"alter_jahre",tick:{fill:"#6b7280",fontSize:12},label:{value:"Anlagenalter (Jahre)",position:"bottom",offset:-5,fill:"#6b7280"}}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},domain:["dataMin - 50","dataMax + 50"],label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280"}}}),e.jsx(xe,{formatter:(y,f)=>f==="durchschnitt_spez_ertrag"?[`${y.toFixed(0)} kWh/kWp`,"Ø Ertrag"]:f==="anzahl"?[y,"Anlagen"]:[y,f],labelFormatter:y=>`${y} Jahre alt`,contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ce,{formatter:()=>"Durchschnittlicher spez. Ertrag"}),e.jsx(qe,{type:"monotone",dataKey:"durchschnitt_spez_ertrag",stroke:"#f97316",strokeWidth:3,dot:{fill:"#f97316",strokeWidth:2},activeDot:{r:6}})]})})}),e.jsxs("div",{className:"mt-4 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-medium text-orange-900 dark:text-orange-100",children:["Durchschnittliche Degradation: ",o.durchschnittliche_degradation_prozent_jahr.toFixed(2),"% / Jahr"]})]}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 mt-1",children:["Basierend auf ",o.nach_alter.reduce((y,f)=>y+f.anzahl,0)," Anlagen unterschiedlichen Alters"]})]})]})]}):null}const xc={BW:"Baden-Württemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thüringen",AT:"Österreich",CH:"Schweiz"};function Tf({anlageId:t,zeitraum:r}){var p;const[a,s]=m.useState(null),[n,i]=m.useState(null),[o,c]=m.useState(null),[h,g]=m.useState(!1),[l,u]=m.useState(null);m.useEffect(()=>{(async()=>{g(!0),u(null);try{const[f,j,k]=await Promise.all([tt.getBenchmark(t,r),tt.getGlobalStatistics().catch(()=>null),tt.getRanking("spez_ertrag",10).catch(()=>null)]);s(f),i(j),c(k)}catch(f){u(f instanceof Error?f.message:"Fehler beim Laden")}finally{g(!1)}})()},[t,r]);const x=m.useMemo(()=>a?{anzahlAnlagen:a.benchmark.anzahl_anlagen_gesamt,anzahlRegion:a.benchmark.anzahl_anlagen_region,durchschnittErtrag:a.benchmark.spez_ertrag_durchschnitt,regionErtrag:a.benchmark.spez_ertrag_region,region:a.anlage.region,regionName:xc[a.anlage.region]||a.anlage.region}:null,[a]),d=m.useMemo(()=>a?[{name:"Speicher",icon:e.jsx(Fe,{className:"h-5 w-5"}),vorhanden:!!a.anlage.speicher_kwh,details:a.anlage.speicher_kwh?`${a.anlage.speicher_kwh} kWh`:null,color:"green"},{name:"Wärmepumpe",icon:e.jsx(lt,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_waermepumpe,details:null,color:"blue"},{name:"E-Auto",icon:e.jsx(Ve,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_eauto,details:null,color:"purple"},{name:"Wallbox",icon:e.jsx(Kt,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_wallbox,details:a.anlage.wallbox_kw?`${a.anlage.wallbox_kw} kW`:null,color:"cyan"},{name:"Balkonkraftwerk",icon:e.jsx(oe,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_balkonkraftwerk,details:a.anlage.bkw_wp?`${a.anlage.bkw_wp} Wp`:null,color:"amber"}]:[],[a]),b=m.useMemo(()=>{if(!a)return null;const{rang_gesamt:y,anzahl_anlagen_gesamt:f,rang_region:j,anzahl_anlagen_region:k}=a.benchmark,w=Math.round((1-y/f)*100),_=Math.round((1-j/k)*100);return{rangGesamt:y,vonGesamt:f,perzentilGesamt:w,rangRegion:j,vonRegion:k,perzentilRegion:_}},[a]);return h?e.jsx(Me,{text:"Lade Community-Statistiken..."}):l?e.jsx(ae,{type:"error",children:l}):!a||!x?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(_r,{className:"h-6 w-6 text-primary-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Community-Übersicht"}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Os,{label:"Anlagen gesamt",value:x.anzahlAnlagen,icon:e.jsx(_r,{className:"h-5 w-5 text-primary-500"})}),e.jsx(Os,{label:"Ø Spez. Ertrag",value:x.durchschnittErtrag,suffix:"kWh/kWp",icon:e.jsx(oe,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(Os,{label:`In ${x.regionName}`,value:x.anzahlRegion,suffix:"Anlagen",icon:e.jsx(_t,{className:"h-5 w-5 text-blue-500"})}),e.jsx(Os,{label:"Ø Region",value:x.regionErtrag,suffix:"kWh/kWp",icon:e.jsx(Tt,{className:"h-5 w-5 text-green-500"})})]})]}),b&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(fa,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Deine Position in der Community"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100 dark:from-primary-900/20 dark:to-primary-800/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_r,{className:"h-5 w-5 text-primary-500"}),e.jsx("span",{className:"text-primary-700 dark:text-primary-300 font-medium",children:"Community-weit"})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-4xl font-bold text-primary-600 dark:text-primary-400",children:["#",b.rangGesamt]}),e.jsxs("span",{className:"text-primary-500 dark:text-primary-400",children:["von ",b.vonGesamt]})]}),e.jsx(mc,{value:b.perzentilGesamt,color:"primary"}),e.jsxs("p",{className:"text-sm text-primary-600 dark:text-primary-400 mt-2",children:["Besser als ",b.perzentilGesamt,"% der Community"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_t,{className:"h-5 w-5 text-blue-500"}),e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:["In ",x.regionName]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-4xl font-bold text-blue-600 dark:text-blue-400",children:["#",b.rangRegion]}),e.jsxs("span",{className:"text-blue-500 dark:text-blue-400",children:["von ",b.vonRegion]})]}),e.jsx(mc,{value:b.perzentilRegion,color:"blue"}),e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Besser als ",b.perzentilRegion,"% in deiner Region"]})]})]})]}),e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(_e,{className:"h-6 w-6 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Deine Anlage"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Rs,{label:"Leistung",value:`${a.anlage.kwp} kWp`,icon:e.jsx(oe,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(Rs,{label:"Ausrichtung",value:a.anlage.ausrichtung,icon:e.jsx(We,{className:"h-5 w-5 text-blue-500"}),capitalize:!0}),e.jsx(Rs,{label:"Neigung",value:`${a.anlage.neigung_grad}°`,icon:e.jsx(Tt,{className:"h-5 w-5 text-green-500"})}),e.jsx(Rs,{label:"Installation",value:String(a.anlage.installation_jahr),icon:e.jsx(Mt,{className:"h-5 w-5 text-gray-500"})})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ausstattung"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:d.map(y=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${y.vorhanden?`bg-${y.color}-50 dark:bg-${y.color}-900/20 border border-${y.color}-200 dark:border-${y.color}-800`:"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:y.vorhanden?`text-${y.color}-500`:"text-gray-400",children:y.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${y.vorhanden?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-500"}`,children:y.name}),y.details&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:y.details})]}),y.vorhanden?e.jsx(wr,{className:`h-4 w-4 text-${y.color}-500`}):e.jsx(cs,{className:"h-4 w-4 text-gray-300 dark:text-gray-600"})]},y.name))})]}),n&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Tt,{className:"h-6 w-6 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ausstattungsquoten der Community"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(La,{label:"Speicher",value:n.ausstattungsquoten.speicher,color:"green"}),e.jsx(La,{label:"Wärmepumpe",value:n.ausstattungsquoten.waermepumpe,color:"blue"}),e.jsx(La,{label:"E-Auto",value:n.ausstattungsquoten.eauto,color:"purple"}),e.jsx(La,{label:"Wallbox",value:n.ausstattungsquoten.wallbox,color:"cyan"}),e.jsx(La,{label:"Balkonkraftwerk",value:n.ausstattungsquoten.balkonkraftwerk,color:"amber"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Die typische Community-Anlage"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Leistung:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.typische_anlage.kwp," kWp"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ausrichtung:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:n.typische_anlage.ausrichtung})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Neigung:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.typische_anlage.neigung_grad,"°"]})]}),n.typische_anlage.speicher_kwh&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Speicher:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.typische_anlage.speicher_kwh," kWh"]})]})]})]})]}),o&&o.ranking.length>0&&e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(fa,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Top 10 - Spezifischer Ertrag"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Rang"}),e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Region"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"kWh/kWp"})]})}),e.jsx("tbody",{children:o.ranking.map(y=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${y.rang===1?"bg-yellow-100 text-yellow-700":y.rang===2?"bg-gray-200 text-gray-700":y.rang===3?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600"}`,children:y.rang})}),e.jsx("td",{className:"py-2 px-3 text-gray-900 dark:text-white",children:xc[y.region]||y.region}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:y.kwp.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900 dark:text-white",children:y.wert.toFixed(0)})]},y.rang))})]})}),o.eigener_rang&&e.jsx("div",{className:"mt-4 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-center",children:e.jsxs("span",{className:"text-primary-700 dark:text-primary-300",children:["Dein Rang: ",e.jsxs("strong",{children:["#",o.eigener_rang]})," mit ",e.jsxs("strong",{children:[(p=o.eigener_wert)==null?void 0:p.toFixed(0)," kWh/kWp"]})]})})]})]})}function La({label:t,value:r,color:a}){return e.jsxs("div",{className:`p-4 rounded-lg bg-${a}-50 dark:bg-${a}-900/20`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t}),e.jsxs("p",{className:`text-2xl font-bold text-${a}-600 dark:text-${a}-400`,children:[r.toFixed(1),"%"]})]})}function Os({label:t,value:r,suffix:a,icon:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s,e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:typeof r=="number"&&r>=1e3?r.toLocaleString("de-DE"):r.toFixed(r<10?1:0)}),a&&e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]})}function Rs({label:t,value:r,icon:a,capitalize:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a,e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t})]}),e.jsx("span",{className:`text-lg font-semibold text-gray-900 dark:text-white ${s?"capitalize":""}`,children:r})]})}function mc({value:t,color:r}){const a={primary:"bg-primary-500",blue:"bg-blue-500"};return e.jsx("div",{className:"w-full bg-white/50 dark:bg-gray-700/50 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a[r]} transition-all duration-500`,style:{width:`${Math.min(100,Math.max(0,t))}%`}})})}const pc=[{value:"letzter_monat",label:"Letzter Monat",tooltip:"Daten des letzten vollständigen Monats"},{value:"letzte_12_monate",label:"Letzte 12 Monate",tooltip:"Rollierender 12-Monats-Zeitraum bis heute"},{value:"letztes_vollstaendiges_jahr",label:"Letztes Jahr",tooltip:"Das letzte vollständige Kalenderjahr"},{value:"seit_installation",label:"Seit Installation",tooltip:"Alle Daten seit Inbetriebnahme der Anlage"}];function Kf(){var y,f,j;const t=pr(),[r,a]=m.useState("uebersicht"),[s,n]=m.useState("letzte_12_monate"),{anlagen:i,loading:o}=it(),[c,h]=m.useState(null),[g,l]=m.useState(null),[u,x]=m.useState(!0),d=c??((y=i[0])==null?void 0:y.id);if(m.useEffect(()=>{if(!d){x(!1);return}(async()=>{x(!0);try{const w=await At.get(d);l(w.community_hash||null)}catch{l(null)}finally{x(!1)}})()},[d]),o||u)return e.jsx(Me,{text:"Lade Community..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"}),e.jsx(ae,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(!g)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_r,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"})]}),e.jsx($,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(nt,{className:"h-16 w-16 text-primary-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Teile erst deine Daten"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Um den Community-Vergleich nutzen zu können, musst du zuerst deine anonymisierten Anlagendaten mit der Community teilen. So können wir dir zeigen, wie deine Anlage im Vergleich zu anderen abschneidet."}),e.jsxs("button",{onClick:()=>t("/einstellungen/community"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 font-medium",children:[e.jsx(Ir,{className:"h-5 w-5"}),"Jetzt teilen"]})]})})]});const b=[{key:"uebersicht",label:"Übersicht",icon:ma,hatZeitraum:!0},{key:"pv-ertrag",label:"PV-Ertrag",icon:oe,hatZeitraum:!0},{key:"komponenten",label:"Komponenten",icon:Fe,hatZeitraum:!0},{key:"regional",label:"Regional",icon:_t,hatZeitraum:!0},{key:"trends",label:"Trends",icon:We,hatZeitraum:!1},{key:"statistiken",label:"Statistiken",icon:Tt,hatZeitraum:!1}],p=((f=b.find(k=>k.key===r))==null?void 0:f.hatZeitraum)??!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_r,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i.length>1&&e.jsx("select",{value:d??"",onChange:k=>h(Number(k.target.value)),className:"input w-auto",children:i.map(k=>e.jsx("option",{value:k.id,children:k.anlagenname},k.id))}),p&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:s,onChange:k=>n(k.target.value),className:"input w-auto",children:pc.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsx(An,{text:((j=pc.find(k=>k.value===s))==null?void 0:j.tooltip)||"Betrachtungszeitraum wählen",children:e.jsx(Ji,{className:"h-4 w-4 text-gray-400 cursor-help"})})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4 overflow-x-auto",children:b.map(k=>{const w=k.icon;return e.jsxs("button",{onClick:()=>a(k.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap ${r===k.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(w,{className:"h-4 w-4"}),k.label]},k.key)})})})]}),d&&e.jsxs(e.Fragment,{children:[r==="uebersicht"&&e.jsx(lu,{anlageId:d,zeitraum:s}),r==="pv-ertrag"&&e.jsx(hu,{anlageId:d,zeitraum:s}),r==="komponenten"&&e.jsx(gu,{anlageId:d,zeitraum:s}),r==="regional"&&e.jsx(Bf,{anlageId:d,zeitraum:s}),r==="trends"&&e.jsx(Rf,{anlageId:d,zeitraum:s}),r==="statistiken"&&e.jsx(Tf,{anlageId:d,zeitraum:s})]})]})}function Hf(){return e.jsx(mh,{children:e.jsx(ph,{children:e.jsxs(ze,{path:"/",element:e.jsx(ug,{}),children:[e.jsx(ze,{index:!0,element:e.jsx(st,{to:"/cockpit",replace:!0})}),e.jsx(ze,{path:"cockpit",element:e.jsx(zg,{})}),e.jsx(ze,{path:"cockpit/pv-anlage",element:e.jsx(Mg,{})}),e.jsx(ze,{path:"cockpit/e-auto",element:e.jsx(Wg,{})}),e.jsx(ze,{path:"cockpit/waermepumpe",element:e.jsx(Ag,{})}),e.jsx(ze,{path:"cockpit/speicher",element:e.jsx(Pg,{})}),e.jsx(ze,{path:"cockpit/wallbox",element:e.jsx(Lg,{})}),e.jsx(ze,{path:"cockpit/balkonkraftwerk",element:e.jsx(Bg,{})}),e.jsx(ze,{path:"cockpit/sonstiges",element:e.jsx(Rg,{})}),e.jsx(ze,{path:"auswertungen",element:e.jsx(Yl,{})}),e.jsx(ze,{path:"auswertungen/roi",element:e.jsx(r0,{})}),e.jsx(ze,{path:"auswertungen/prognose",element:e.jsx(s0,{})}),e.jsx(ze,{path:"auswertungen/export",element:e.jsx(Yl,{})})," ",e.jsx(ze,{path:"aussichten",element:e.jsx(h0,{})}),e.jsx(ze,{path:"community",element:e.jsx(Kf,{})}),e.jsx(ze,{path:"einstellungen/anlage",element:e.jsx(m0,{})}),e.jsx(ze,{path:"einstellungen/strompreise",element:e.jsx(p0,{})}),e.jsx(ze,{path:"einstellungen/investitionen",element:e.jsx(_0,{})}),e.jsx(ze,{path:"einstellungen/monatsdaten",element:e.jsx(A0,{})}),e.jsx(ze,{path:"einstellungen/monatsabschluss",element:e.jsx(qn,{})}),e.jsx(ze,{path:"monatsabschluss/:anlageId",element:e.jsx(qn,{})}),e.jsx(ze,{path:"monatsabschluss/:anlageId/:jahr/:monat",element:e.jsx(qn,{})}),e.jsx(ze,{path:"einstellungen/import",element:e.jsx(lo,{})}),e.jsx(ze,{path:"einstellungen/demo",element:e.jsx(lo,{})})," ",e.jsx(ze,{path:"einstellungen/solarprognose",element:e.jsx(D0,{})}),e.jsx(ze,{path:"einstellungen/pvgis",element:e.jsx(st,{to:"/einstellungen/solarprognose",replace:!0})}),e.jsx(ze,{path:"einstellungen/datenerfassung",element:e.jsx(L0,{})}),e.jsx(ze,{path:"einstellungen/ha-import",element:e.jsx(st,{to:"/einstellungen/datenerfassung",replace:!0})}),e.jsx(ze,{path:"einstellungen/ha-export",element:e.jsx(I0,{})}),e.jsx(ze,{path:"einstellungen/sensor-mapping",element:e.jsx(U0,{})}),e.jsx(ze,{path:"einstellungen/ha-statistik-import",element:e.jsx(ru,{})}),e.jsx(ze,{path:"einstellungen/allgemein",element:e.jsx(P0,{})}),e.jsx(ze,{path:"einstellungen/community",element:e.jsx(nu,{})}),e.jsx(ze,{path:"auswertungen/community",element:e.jsx(st,{to:"/community",replace:!0})}),e.jsx(ze,{path:"dashboard",element:e.jsx(st,{to:"/cockpit",replace:!0})}),e.jsx(ze,{path:"anlagen",element:e.jsx(st,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(ze,{path:"monatsdaten",element:e.jsx(st,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(ze,{path:"strompreise",element:e.jsx(st,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(ze,{path:"investitionen",element:e.jsx(st,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(ze,{path:"auswertung",element:e.jsx(st,{to:"/auswertungen",replace:!0})}),e.jsx(ze,{path:"roi",element:e.jsx(st,{to:"/auswertungen/roi",replace:!0})}),e.jsx(ze,{path:"e-auto",element:e.jsx(st,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(ze,{path:"waermepumpe",element:e.jsx(st,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(ze,{path:"speicher",element:e.jsx(st,{to:"/cockpit/speicher",replace:!0})}),e.jsx(ze,{path:"wallbox",element:e.jsx(st,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(ze,{path:"balkonkraftwerk",element:e.jsx(st,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(ze,{path:"sonstiges",element:e.jsx(st,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(ze,{path:"import",element:e.jsx(st,{to:"/einstellungen/import",replace:!0})}),e.jsx(ze,{path:"settings",element:e.jsx(st,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function Gf({onNext:t,onLoadDemo:r,onImportComplete:a}){const[s,n]=m.useState(!1),[i,o]=m.useState(null),[c,h]=m.useState(!1),[g,l]=m.useState(null),[u,x]=m.useState(null),d=m.useRef(null),b=async()=>{if(r){n(!0),o(null);try{await r()}catch(f){o(f instanceof Error?f.message:"Fehler beim Laden der Demo-Daten"),n(!1)}}},p=async f=>{var k;const j=(k=f.target.files)==null?void 0:k[0];if(j){h(!0),l(null),x(null);try{const w=await ir.importJSON(j,!1);x(`Anlage "${w.anlage_name}" erfolgreich importiert!`),setTimeout(()=>{a==null||a()},1500)}catch(w){l(w instanceof Error?w.message:"Fehler beim Importieren")}finally{h(!1),d.current&&(d.current.value="")}}},y=()=>{var f;(f=d.current)==null||f.click()};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(oe,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persönliches Energie Effizienz Data Center für die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(oi,{icon:e.jsx(Tt,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(oi,{icon:e.jsx(Yr,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen für alle Ihre Energie-Investitionen"}),e.jsx(oi,{icon:e.jsx(We,{className:"w-6 h-6"}),title:"Prognosen",description:"Wetterbasierte Vorhersagen und PVGIS-Vergleiche"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(Ts,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(Ts,{number:2,text:"Stromtarif konfigurieren (mit Vorschlägen)"}),e.jsx(Ts,{number:3,text:"Wechselrichter und PV-Module erfassen"}),e.jsx(Ts,{number:4,text:"Optional: Speicher, Wärmepumpe, E-Auto hinzufügen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(gt,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Haben Sie eine JSON-Sicherung? Stellen Sie Ihre Daten wieder her:"}),e.jsx("input",{ref:d,type:"file",accept:".json",onChange:p,className:"hidden"}),e.jsx("button",{onClick:y,disabled:c,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium rounded-xl hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all disabled:opacity-50",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5 animate-spin"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"w-5 h-5"}),"JSON-Backup importieren"]})}),g&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:g}),u&&e.jsx("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:u}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Importiert Anlage, Strompreise, Investitionen, Monatsdaten und Sensor-Mapping"})]}),r&&e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:b,disabled:s,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Gh,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),i&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:i}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enthält 24 Monate Beispieldaten, Wechselrichter, PV-Module, Speicher, Wärmepumpe u.v.m."})]})]})]})}function oi({icon:t,title:r,description:a}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a})]})}function Ts({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}function Zf({isLoading:t,error:r,onSubmit:a,onGeocode:s,onBack:n}){const[i,o]=m.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:""}),[c,h]=m.useState(null),[g,l]=m.useState(!1),[u,x]=m.useState(!1),d=f=>{const{name:j,value:k}=f.target;o(w=>({...w,[j]:k})),h(null),(j==="standort_plz"||j==="standort_ort")&&x(!1)},b=async()=>{if(!i.standort_plz){h("Bitte geben Sie eine PLZ ein");return}l(!0),h(null),x(!1);try{const f=await s(i.standort_plz,i.standort_ort||void 0);f?(o(j=>({...j,latitude:f.latitude.toFixed(6),longitude:f.longitude.toFixed(6)})),x(!0)):h("Koordinaten konnten nicht ermittelt werden. Bitte prüfen Sie PLZ/Ort.")}catch{h("Fehler beim Ermitteln der Koordinaten")}finally{l(!1)}},p=async f=>{if(f.preventDefault(),h(null),!i.anlagenname.trim()){h("Bitte geben Sie einen Namen für Ihre Anlage ein");return}if(!i.leistung_kwp||parseFloat(i.leistung_kwp)<=0){h("Bitte geben Sie die Anlagenleistung in kWp ein");return}await a({anlagenname:i.anlagenname.trim(),leistung_kwp:parseFloat(i.leistung_kwp),installationsdatum:i.installationsdatum||void 0,standort_plz:i.standort_plz||void 0,standort_ort:i.standort_ort||void 0,latitude:i.latitude?parseFloat(i.latitude):void 0,longitude:i.longitude?parseFloat(i.longitude):void 0})},y=c||r;return e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),y&&e.jsx(ae,{type:"error",className:"mb-6",children:y}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:i.anlagenname,onChange:d,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:i.leistung_kwp,onChange:d,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Mt,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:i.installationsdatum,onChange:d,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für korrekten Start der Stromtarif-Gültigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(_t,{className:"w-4 h-4 text-gray-500"}),"Standort (für PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:i.standort_plz,onChange:d,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:i.standort_ort,onChange:d,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:b,disabled:g||!i.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):u?e.jsxs(e.Fragment,{children:[e.jsx(wr,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(Fc,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:i.latitude,onChange:d,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Längengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:i.longitude,onChange:d,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(ot,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden für die PVGIS-Ertragsprognose benötigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(gt,{className:"w-4 h-4"})]})})]})]})}function qf({anlage:t,isLoading:r,error:a,onSubmit:s,onUseDefaults:n,onBack:i}){const o=t?Vc(t.leistung_kwp):qr.einspeiseverguetung_cent_kwh,[c,h]=m.useState({netzbezug_arbeitspreis_cent_kwh:qr.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:o.toString(),grundpreis_euro_monat:qr.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[g,l]=m.useState(null),u=b=>{const{name:p,value:y}=b.target;h(f=>({...f,[p]:y})),l(null)},x=async b=>{if(b.preventDefault(),l(null),!c.netzbezug_arbeitspreis_cent_kwh||parseFloat(c.netzbezug_arbeitspreis_cent_kwh)<0){l("Bitte geben Sie einen gültigen Netzbezugspreis ein");return}if(!c.gueltig_ab){l("Bitte geben Sie ein Gültigkeitsdatum ein");return}await s({netzbezug_arbeitspreis_cent_kwh:parseFloat(c.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(c.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:c.grundpreis_euro_monat?parseFloat(c.grundpreis_euro_monat):void 0,gueltig_ab:c.gueltig_ab,tarifname:c.tarifname||void 0,anbieter:c.anbieter||void 0})},d=g||a;return e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Für korrekte Wirtschaftlichkeitsberechnungen"})]})]}),d&&e.jsx(ae,{type:"error",className:"mb-6",children:d}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:n,disabled:r,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(da,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[qr.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",o," ct Einspeisung |"," ",qr.grundpreis_euro_monat," € Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:c.netzbezug_arbeitspreis_cent_kwh,onChange:u,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergütung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:c.einspeiseverguetung_cent_kwh,onChange:u,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"≤10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (€/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:c.grundpreis_euro_monat,onChange:u,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gültig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:c.gueltig_ab,onChange:u,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:c.tarifname,onChange:u,placeholder:"z.B. Ökostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:c.anbieter,onChange:u,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(ot,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können später weitere Stromtarife mit unterschiedlichen Gültigkeitszeiträumen hinzufügen, z.B. bei Tarifwechsel oder Preisänderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(gt,{className:"w-4 h-4"})]})})]})]})}function Ya(t){switch(t){case"e-auto":return e.jsx(Ve,{className:"w-5 h-5"});case"speicher":return e.jsx(Fe,{className:"w-5 h-5"});case"wallbox":return e.jsx(Kt,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(qi,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(Qe,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(oe,{className:"w-5 h-5"});default:return e.jsx(Wc,{className:"w-5 h-5"})}}function Jf({investition:t,allInvestitionen:r,anlage:a,onUpdate:s,onDelete:n,isNew:i=!1}){const[o,c]=m.useState(!0);m.useEffect(()=>{i&&c(!0)},[i]);const[h,g]=m.useState(!1),l=wg[t.typ],u=l?r.filter(p=>p.typ===l&&p.id!==t.id):[],x=p=>{var y;return(y=t.parameter)==null?void 0:y[p]},d=p=>{var y;return((y=t.parameter)==null?void 0:y[p])===!0},b=(p,y)=>{s({parameter:{...t.parameter,[p]:y}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>c(!o),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:Ya(t.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung||er[t.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[er[t.typ],t.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:["• ",t.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]})]}),o?e.jsx(zr,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(ar,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),o&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:t.bezeichnung,onChange:p=>s({bezeichnung:p.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:t.anschaffungsdatum||"",onChange:p=>s({anschaffungsdatum:p.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (€) *"}),e.jsx("input",{type:"number",value:t.anschaffungskosten_gesamt??"",onChange:p=>s({anschaffungskosten_gesamt:parseFloat(p.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),l&&e.jsx("div",{children:(()=>{const p=Ng.includes(t.typ),y=u.length>0,f=p&&!t.parent_investition_id&&y;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",er[l],")",p?" *":" (optional)"]}),y?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.parent_investition_id||"",onChange:j=>s({parent_investition_id:j.target.value?parseInt(j.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${f?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:p?"-- Bitte wählen --":"-- Keine Zuordnung --"}),u.map(j=>e.jsx("option",{value:j.id,children:j.bezeichnung},j.id))]}),f&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(nt,{className:"w-4 h-4"}),"PV-Module müssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0"}),p?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen können."]}):e.jsxs("span",{children:["Kein ",er[l]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),t.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW) *"}),e.jsx("input",{type:"number",value:x("leistung_kw")??"",onChange:p=>b("leistung_kw",parseFloat(p.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:t.leistung_kwp??"",onChange:p=>s({leistung_kwp:parseFloat(p.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:t.ausrichtung||(a==null?void 0:a.ausrichtung)||"",onChange:p=>s({ausrichtung:p.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:t.neigung_grad??(a==null?void 0:a.neigung_grad)??"",onChange:p=>s({neigung_grad:parseFloat(p.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="speicher"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazität (kWh) *"}),e.jsx("input",{type:"number",value:x("kapazitaet_kwh")??"",onChange:p=>b("kapazitaet_kwh",parseFloat(p.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("arbitrage"),onChange:p=>b("arbitrage",p.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Arbitrage"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Netzstrom günstig laden, teuer einspeisen"})]})]})})]}),t.typ==="wallbox"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW) *"}),e.jsx("input",{type:"number",value:x("leistung_kw")??"",onChange:p=>b("leistung_kw",parseFloat(p.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("v2h"),onChange:p=>b("v2h",p.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-fähig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Bidirektionales Laden (Vehicle-to-Home)"})]})]})})]}),t.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazität (kWh) *"}),e.jsx("input",{type:"number",value:x("batterie_kwh")??"",onChange:p=>b("batterie_kwh",parseFloat(p.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km) *"}),e.jsx("input",{type:"number",value:x("verbrauch_kwh_100km")??"",onChange:p=>b("verbrauch_kwh_100km",parseFloat(p.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"md:col-span-2 flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("v2h"),onChange:p=>b("v2h",p.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-fähig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Fahrzeug kann Strom ans Haus abgeben (Vehicle-to-Home)"})]})]})})]}),t.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW) *"}),e.jsx("input",{type:"number",value:x("leistung_kw")??"",onChange:p=>b("leistung_kw",parseFloat(p.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl) *"}),e.jsx("input",{type:"number",value:x("cop")??"3.5",onChange:p=>b("cop",parseFloat(p.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung pro Modul (Wp) *"}),e.jsx("input",{type:"number",value:x("leistung_wp")??"",onChange:p=>b("leistung_wp",parseFloat(p.target.value)||void 0),placeholder:"z.B. 400",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module *"}),e.jsx("input",{type:"number",value:x("anzahl")??"",onChange:p=>b("anzahl",parseInt(p.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:x("ausrichtung")||"",onChange:p=>b("ausrichtung",p.target.value||void 0),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:x("neigung_grad")??"",onChange:p=>b("neigung_grad",parseFloat(p.target.value)||void 0),placeholder:"z.B. 30",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"0° = flach, 90° = senkrecht (Balkon)"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("hat_speicher"),onChange:p=>b("hat_speicher",p.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mit Speicher"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"z.B. Anker SOLIX, Zendure, EcoFlow"})]})]}),d("hat_speicher")&&e.jsxs("div",{className:"mt-3 ml-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Speicher-Kapazität (Wh) *"}),e.jsx("input",{type:"number",value:x("speicher_kapazitaet_wh")??"",onChange:p=>b("speicher_kapazitaet_wh",parseFloat(p.target.value)||void 0),placeholder:"z.B. 1600",min:"0",step:"100",className:"w-full max-w-xs px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"z.B. 1600 Wh für Anker SOLIX"})]})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:h?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich löschen?"}),e.jsx("button",{type:"button",onClick:()=>{n(),g(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, löschen"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>g(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Investition löschen"]})})]})]})}function bc({onAdd:t}){const[r,a]=m.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>a(!r),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Sr,{className:"w-5 h-5"}),"Investition hinzufügen"]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:Bc.map(s=>e.jsxs("button",{type:"button",onClick:()=>{t(s),a(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Ya(s)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:er[s]})]},s))})]})]})}function Uf({investitionen:t,anlage:r,isLoading:a,error:s,onUpdateInvestition:n,onDeleteInvestition:i,onAddInvestition:o,onCreateDefaultPVSystem:c,onNext:h,onBack:g}){const[l,u]=m.useState(null),[x,d]=m.useState(null),b=m.useRef(null);m.useEffect(()=>{if(x&&b.current){b.current.scrollIntoView({behavior:"smooth",block:"center"});const f=setTimeout(()=>d(null),2e3);return()=>clearTimeout(f)}},[x]);const p=Bc.reduce((f,j)=>{const k=t.filter(w=>w.typ===j);return k.length>0&&f.push({typ:j,items:k}),f},[]),y=async f=>{u(f);try{const j=await o(f);j!=null&&j.id&&d(j.id)}finally{u(null)}};return t.length===0&&!a?e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(oe,{className:"w-8 h-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"PV-System einrichten"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:"Erfassen Sie Ihre PV-Komponenten für die Ertragsanalyse und ROI-Berechnung."})]}),c&&e.jsx("div",{className:"mb-8",children:e.jsx("button",{type:"button",onClick:c,disabled:a,className:"w-full p-6 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-amber-200 dark:border-amber-800 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-all group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-amber-500 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform",children:e.jsx(oe,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg",children:"PV-System anlegen (empfohlen)"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Erstellt automatisch Wechselrichter + PV-Module mit ",(r==null?void 0:r.leistung_kwp)||0," kWp"]})]}),e.jsx(gt,{className:"w-5 h-5 text-amber-500 group-hover:translate-x-1 transition-transform"})]})})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder einzeln hinzufügen"})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-6",children:["balkonkraftwerk","speicher","wallbox","waermepumpe","e-auto"].map(f=>e.jsxs("button",{type:"button",onClick:()=>y(f),disabled:l!==null,className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10 transition-all text-center",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-600 dark:text-gray-400",children:Ya(f)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:er[f]})]},f))}),e.jsx("div",{className:"text-center",children:e.jsx(bc,{onAdd:y})}),l&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400 text-center",children:["Füge ",er[l]," hinzu..."]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 px-6 py-2.5 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:["Überspringen",e.jsx(gt,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollständigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergänzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden für die ROI-Berechnung benötigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length," Investition",t.length!==1?"en":""]})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(nt,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:s})]}),a&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!a&&e.jsxs("div",{className:"space-y-6",children:[p.map(({typ:f,items:j})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Ya(f)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[er[f]," (",j.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:j.map(k=>e.jsx("div",{ref:k.id===x?b:void 0,className:`transition-all duration-500 ${k.id===x?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(Jf,{investition:k,allInvestitionen:t,anlage:r,onUpdate:w=>n(k.id,w),onDelete:()=>i(k.id),isNew:k.id===x})},k.id))})]},f)),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Sr,{className:"w-4 h-4 text-amber-500"}),"Weitere Komponenten hinzufügen"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:["speicher","wallbox","waermepumpe","e-auto","balkonkraftwerk"].map(f=>{const j=t.some(k=>k.typ===f);return e.jsxs("button",{type:"button",onClick:()=>y(f),disabled:l!==null,className:`p-3 border rounded-xl transition-all text-center ${j?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10"}`,children:[e.jsx("div",{className:`w-8 h-8 mx-auto mb-1 rounded-lg flex items-center justify-center ${j?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:Ya(f)}),e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[er[f],j&&" ✓"]})]},f)})}),e.jsx(bc,{onAdd:y}),l&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",er[l]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(ot,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig für die Amortisationsberechnung. Sie können alle Angaben später jederzeit unter Einstellungen → Investitionen ändern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:h,disabled:a,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(gt,{className:"w-4 h-4"})]})]})]})}function Yf(t){switch(t){case"e-auto":return e.jsx(Ve,{className:"w-4 h-4"});case"speicher":return e.jsx(Fe,{className:"w-4 h-4"});case"wallbox":return e.jsx(Kt,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(qi,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(Qe,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(oe,{className:"w-4 h-4"});default:return e.jsx(Wc,{className:"w-4 h-4"})}}function Xf({anlage:t,strompreis:r,investitionen:a,pvgisPrognose:s,pvgisError:n,canFetchPvgis:i,isLoading:o,onFetchPvgis:c,onComplete:h,onBack:g}){const[l,u]=m.useState(!1),x=!!t,d=!!r,b=a.length>0,p=!!s,y=a.reduce((j,k)=>j+(k.anschaffungskosten_gesamt||0),0),f=async()=>{u(!0);try{await c()}finally{u(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(wr,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschließen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Überprüfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ks,{icon:e.jsx(oe,{className:"w-5 h-5"}),title:"PV-Anlage",status:x?"success":"warning",children:x?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&` • ${t.standort_ort}`,t.latitude&&t.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(Ks,{icon:e.jsx(_e,{className:"w-5 h-5"}),title:"Stromtarif",status:d?"success":"warning",children:d?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:r.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:r.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),r.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.tarifname,r.anbieter&&` (${r.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollständig"})}),e.jsx(Ks,{icon:e.jsx(qi,{className:"w-5 h-5"}),title:"Investitionen",status:b?"success":"neutral",children:b?e.jsxs("div",{className:"space-y-2",children:[a.slice(0,5).map(j=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:Yf(j.typ)}),e.jsx("span",{className:"truncate",children:j.bezeichnung}),j.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[j.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]},j.id)),a.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",a.length-5," weitere"]}),y>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",y.toLocaleString("de-DE")," €"]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - können später hinzugefügt werden"})}),e.jsx(Ks,{icon:e.jsx(Rl,{className:"w-5 h-5"}),title:"PVGIS Ertragsprognose",status:p?"success":i?"neutral":"warning",children:p?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(s.jahresertrag_kwh).toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp",e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(PVGIS-Daten gespeichert)"})]})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ertragsprognose von PVGIS abrufen für SOLL-IST Vergleiche"}),n&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm",children:n}),e.jsx("button",{type:"button",onClick:f,disabled:l||o,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 animate-spin"}),"Rufe PVGIS ab..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Rl,{className:"w-4 h-4"}),"PVGIS-Prognose abrufen"]})})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400 text-sm",children:!(t!=null&&t.latitude)||!(t!=null&&t.longitude)?"Koordinaten fehlen - bitte Standort mit PLZ ermitteln":"PV-Module fehlen - bitte unter Komponenten anlegen"})})]}),e.jsx(Qf,{hasPvgis:p,investitionen:a})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Xa,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:[e.jsx(Ur,{className:"w-5 h-5"}),"Weiter zur Datenerfassung"]})]})]})}function Ks({icon:t,title:r,status:a,children:s}){const n={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${n[a]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[a]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r}),a==="success"&&e.jsx(wr,{className:"w-4 h-4 text-green-500"}),a==="warning"&&e.jsx(nt,{className:"w-4 h-4 text-amber-500"})]}),s]})]})})}function Qf({hasPvgis:t,investitionen:r}){const a=r.some(n=>n.typ==="wechselrichter"),s=r.some(n=>n.typ==="pv-module");return e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-500"}),"Wie geht es weiter?"]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ur,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Zählerstände (Einspeisung, Netzbezug) und Verbrauchsdaten der Komponenten. Sie können die Daten manuell eingeben oder eine CSV-Datei importieren."})]})]})}),(!s||!a)&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," ",!s&&!a?"Wechselrichter und PV-Module fehlen noch.":s?"Wechselrichter fehlt noch.":"PV-Module fehlen noch."," Diese können Sie jederzeit unter Einstellungen → Investitionen ergänzen."]})}),!t&&s&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Tipp:"})," Rufen Sie oben die PVGIS-Prognose ab, um später SOLL-IST Vergleiche Ihrer PV-Erträge zu sehen."]})})]})}function ey({anlage:t,onGoToDashboard:r}){const a=()=>{r(),setTimeout(()=>{window.location.href="/einstellungen/monatsdaten"},100)};return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(oe,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(Kh,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6 mb-8 max-w-md mx-auto text-left border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ur,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"Nächster Schritt: Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Zählerstände (Einspeisung, Netzbezug) und Verbrauchsdaten. Die Daten können manuell eingegeben oder per CSV importiert werden."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:[e.jsx(Ur,{className:"w-5 h-5"}),"Monatsdaten erfassen"]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center justify-center gap-3 px-6 py-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(Ui,{className:"w-5 h-5"}),"Zum Cockpit"]})]})]})}const oa=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"investitionen",label:"Komponenten",shortLabel:"Komp."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function ty({onComplete:t}){var o;const r=_g(),a=async()=>{await ir.createDemoData(),t()},s=()=>{t()};m.useEffect(()=>{if(r.step==="complete"){const c=setTimeout(t,100);return()=>clearTimeout(c)}},[r.step,t]);const n=oa.findIndex(c=>c.key===r.step),i=r.step!=="welcome"&&r.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:Lc,alt:"eedc",className:"w-10 h-10"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),i&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",n+1," von ",oa.length]})]})})}),i&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:oa.map((c,h)=>{const g=h<n,l=h===n;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${g?"bg-green-500 text-white":l?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:g?e.jsx(wr,{className:"w-5 h-5"}):h+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${l?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:c.label})]}),h<oa.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${g?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},c.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(o=oa[n])==null?void 0:o.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n+1,"/",oa.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${r.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[r.step==="welcome"&&e.jsx(Gf,{onNext:r.nextStep,onLoadDemo:a,onImportComplete:s}),r.step==="anlage"&&e.jsx(Zf,{isLoading:r.isLoading,error:r.error,onSubmit:r.createAnlage,onGeocode:r.geocodeAddress,onBack:r.prevStep}),r.step==="strompreise"&&e.jsx(qf,{anlage:r.anlage,isLoading:r.isLoading,error:r.error,onSubmit:r.createStrompreis,onUseDefaults:r.useDefaultStrompreise,onBack:r.prevStep}),r.step==="investitionen"&&e.jsx(Uf,{investitionen:r.investitionen,anlage:r.anlage,isLoading:r.isLoading,error:r.error,onUpdateInvestition:r.updateInvestition,onDeleteInvestition:r.deleteInvestition,onAddInvestition:r.addInvestition,onCreateDefaultPVSystem:r.createDefaultPVSystem,onNext:r.nextStep,onBack:r.prevStep}),r.step==="summary"&&e.jsx(Xf,{anlage:r.anlage,strompreis:r.strompreis,investitionen:r.investitionen,pvgisPrognose:r.pvgisPrognose,pvgisError:r.pvgisError,canFetchPvgis:r.canFetchPvgis,isLoading:r.isLoading,onFetchPvgis:r.fetchPvgisPrognose,onComplete:r.completeWizard,onBack:r.prevStep}),r.step==="complete"&&e.jsx(ey,{anlage:r.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc – Energie Effizienz Data Center"})]})}const ci="eedc_setup_wizard_completed";function ry({children:t}){const[r,a]=m.useState(!0),[s,n]=m.useState(!1);m.useEffect(()=>{i()},[]);const i=async()=>{try{(await At.list()).length===0?(localStorage.removeItem(ci),localStorage.removeItem("eedc_setup_wizard_state"),n(!0)):(localStorage.setItem(ci,"true"),n(!1))}catch(c){console.error("Fehler beim Prüfen des Setup-Status:",c),n(!1)}finally{a(!1)}},o=()=>{localStorage.setItem(ci,"true"),n(!1)};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):s?e.jsx(ty,{onComplete:o}):e.jsx(e.Fragment,{children:t})}hi.createRoot(document.getElementById("root")).render(e.jsx(at.StrictMode,{children:e.jsx(tg,{children:e.jsx(ry,{children:e.jsx(Hf,{})})})}));
