var Va=Object.defineProperty;var Ba=(r,s,t)=>s in r?Va(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var As=(r,s,t)=>Ba(r,typeof s!="symbol"?s+"":s,t);import{r as l,a as Oa,u as ma,N as ms,O as Ka,b as Ft,d as Ta,e as Ra,L as Ha,H as Ga,f as Ja,h as ke,i as He,R as Za}from"./vendor--Y_1AvlA.js";import{R as de,B as Ve,C as be,X as je,Y as ge,T as ce,L as Ee,a as se,b as nt,A as ct,c as Be,P as yt,d as kt,e as Ie,f as Ht,g as Bt,h as qa,i as Ua,j as Ya,k as Qa,l as Xa,m as Cs,n as en}from"./charts-xp70nuFl.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&n(x)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();var ua={exports:{}},qr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tn=l,rn=Symbol.for("react.element"),sn=Symbol.for("react.fragment"),an=Object.prototype.hasOwnProperty,nn=tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ln={key:!0,ref:!0,__self:!0,__source:!0};function pa(r,s,t){var n,a={},i=null,x=null;t!==void 0&&(i=""+t),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(x=s.ref);for(n in s)an.call(s,n)&&!ln.hasOwnProperty(n)&&(a[n]=s[n]);if(r&&r.defaultProps)for(n in s=r.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:rn,type:r,key:i,ref:x,props:a,_owner:nn.current}}qr.Fragment=sn;qr.jsx=pa;qr.jsxs=pa;ua.exports=qr;var e=ua.exports,us={},$s=Oa;us.createRoot=$s.createRoot,us.hydrateRoot=$s.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var dn={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),T=(r,s)=>{const t=l.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:x,className:c="",children:g,...u},d)=>l.createElement("svg",{ref:d,...dn,width:a,height:a,stroke:n,strokeWidth:x?Number(i)*24/Number(a):i,className:["lucide",`lucide-${cn(r)}`,c].join(" "),...u},[...s.map(([p,m])=>l.createElement(p,m)),...Array.isArray(g)?g:[g]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=T("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=T("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=T("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=T("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=T("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=T("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=T("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=T("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=T("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=T("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=T("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=T("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=T("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=T("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=T("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=T("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=T("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=T("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=T("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=T("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=T("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=T("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=T("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=T("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=T("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=T("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=T("CloudSnow",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=T("CloudSun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=T("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=T("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=T("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=T("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=T("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=T("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=T("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=T("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=T("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=T("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=T("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=T("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=T("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=T("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=T("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=T("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=T("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=T("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=T("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=T("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=T("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=T("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=T("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=T("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=T("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=T("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=T("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=T("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=T("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=T("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=T("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=T("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=T("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=T("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=T("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=T("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=T("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=T("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=T("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=T("PlugZap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=T("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=T("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=T("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=T("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=T("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=T("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=T("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=T("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=T("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=T("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=T("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=T("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=T("Snowflake",[["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"m20 16-4-4 4-4",key:"rquw4f"}],["path",{d:"m4 8 4 4-4 4",key:"12s3z9"}],["path",{d:"m16 4-4 4-4-4",key:"1tumq1"}],["path",{d:"m8 20 4-4 4 4",key:"9p200w"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=T("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=T("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=T("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=T("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=T("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=T("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=T("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=T("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=T("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=T("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=T("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=T("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=T("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=T("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ma=T("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=T("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=T("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=T("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=T("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Fa=l.createContext(void 0);function $n({children:r}){const[s,t]=l.useState(()=>localStorage.getItem("eedc-theme")||"system"),[n,a]=l.useState(!1);return l.useEffect(()=>{localStorage.setItem("eedc-theme",s);const i=window.document.documentElement;if(s==="system"){const x=window.matchMedia("(prefers-color-scheme: dark)").matches;a(x),i.classList.toggle("dark",x)}else a(s==="dark"),i.classList.toggle("dark",s==="dark")},[s]),l.useEffect(()=>{if(s!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),x=c=>{a(c.matches),document.documentElement.classList.toggle("dark",c.matches)};return i.addEventListener("change",x),()=>i.removeEventListener("change",x)},[s]),e.jsx(Fa.Provider,{value:{theme:s,setTheme:t,isDark:n},children:r})}function Aa(){const r=l.useContext(Fa);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r}const Ca="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgODAgODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImczIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzA2YjZkNCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMzNGQzOTkiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8c3R5bGU+CiAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PU91dGZpdDp3Z2h0QDMwMDs3MDAmYW1wO2Rpc3BsYXk9c3dhcCcpOwogICAgPC9zdHlsZT4KICA8L2RlZnM+CgogIDxyZWN0IHg9IjIiIHk9IjIiIHdpZHRoPSI3NiIgaGVpZ2h0PSI3NiIgcng9IjE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuOCIvPgogIDx0ZXh0IHg9IjEyIiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjcwMCIgZm9udC1zaXplPSIzNiIgZmlsbD0idXJsKCNnMykiPmVlPC90ZXh0PgogIDx0ZXh0IHg9IjQ1IiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjMwMCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY0NzQ4YiI+ZGM8L3RleHQ+CiAgPHBhdGggZD0iTTE2IDE2IFE0MCAzIDYyIDE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGNpcmNsZSBjeD0iNjIiIGN5PSIxNiIgcj0iMi44IiBmaWxsPSIjMzRkMzk5Ii8+Cjwvc3ZnPgo=",Dn=[{name:"Cockpit",basePath:"/cockpit",icon:fs},{name:"Auswertungen",basePath:"/auswertungen",icon:ut},{name:"Aussichten",basePath:"/aussichten",icon:_e},{name:"Community",basePath:"/community",icon:Ct}],Ln=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Monatsabschluss",href:"/einstellungen/monatsabschluss"},{name:"Import",href:"/einstellungen/import"},{name:"Datenerfassung",href:"/einstellungen/datenerfassung"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"Solarprognose",href:"/einstellungen/solarprognose"},{name:"Allgemein",href:"/einstellungen/allgemein"}]},{category:"Home Assistant",items:[{name:"Sensor-Zuordnung",href:"/einstellungen/sensor-mapping"},{name:"Statistik-Import",href:"/einstellungen/ha-statistik-import"},{name:"MQTT-Export",href:"/einstellungen/ha-export"}]},{category:"Community",items:[{name:"Daten teilen",href:"/einstellungen/community"}]}];function Pn(){const{theme:r,setTheme:s}=Aa(),t=ma(),[n,a]=l.useState(!1),i=l.useRef(null),c=t.pathname.startsWith("/cockpit")?"Cockpit":t.pathname.startsWith("/auswertungen")?"Auswertungen":t.pathname.startsWith("/aussichten")?"Aussichten":t.pathname.startsWith("/community")?"Community":t.pathname.startsWith("/einstellungen")?null:"Cockpit";l.useEffect(()=>{const d=p=>{i.current&&!i.current.contains(p.target)&&a(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const g=()=>{s(r==="light"?"dark":r==="dark"?"system":"light")},u=d=>t.pathname===d;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-14",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:Ca,alt:"eedc",className:"h-10 w-10"}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"}),e.jsx("nav",{className:"ml-8 flex space-x-1",children:Dn.map(d=>{const p=d.icon;return e.jsxs(ms,{to:d.basePath,className:()=>`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===d.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(p,{className:"h-4 w-4"}),d.name]},d.name)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:g,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${r}`,children:[r==="light"&&e.jsx(ae,{className:"h-5 w-5"}),r==="dark"&&e.jsx(_a,{className:"h-5 w-5"}),r==="system"&&e.jsx(va,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>a(!n),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${t.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx($t,{className:`h-4 w-4 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:Ln.map((d,p)=>e.jsxs("div",{children:[p>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:d.category})}),d.items.map(m=>e.jsx(ms,{to:m.href,onClick:()=>a(!1),className:`block px-4 py-2 text-sm transition-colors ${u(m.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:m.name},m.href))]},d.category))})]})]})]})})})}const In=[{name:"Übersicht",href:"/cockpit",icon:fs,exact:!0},{name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:ae},{name:"E-Auto",href:"/cockpit/e-auto",icon:Ae},{name:"Wärmepumpe",href:"/cockpit/waermepumpe",icon:Ke},{name:"Speicher",href:"/cockpit/speicher",icon:ze},{name:"Wallbox",href:"/cockpit/wallbox",icon:pt},{name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:ae},{name:"Sonstiges",href:"/cockpit/sonstiges",icon:Zr}],Vn=[],Bn=[{name:"Anlage",href:"/einstellungen/anlage",icon:Ze},{name:"Strompreise",href:"/einstellungen/strompreise",icon:ye},{name:"Investitionen",href:"/einstellungen/investitionen",icon:Qt},{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:Ut},{name:"Import/Export",href:"/einstellungen/import",icon:gr},{name:"Solarprognose",href:"/einstellungen/solarprognose",icon:ae},{name:"Allgemein",href:"/einstellungen/allgemein",icon:ws}];function On(){const r=ma(),t=r.pathname.startsWith("/cockpit")?In:r.pathname.startsWith("/auswertungen")?Vn:r.pathname.startsWith("/einstellungen")?Bn:null;return!t||t.length===0?null:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:t.map(n=>e.jsxs(ms,{to:n.href,end:n.exact,className:({isActive:a})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${a?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(n.icon,{className:"h-4 w-4"}),n.name]},n.href))})})})}const Kn="2.1.0",Tn="eedc",Rn="Energie Effizienz Data Center",Hn=`${Tn} v${Kn} – ${Rn}`;function Gn(){return e.jsxs("div",{className:"h-screen bg-gray-50 dark:bg-gray-900 flex flex-col overflow-hidden",children:[e.jsx(Pn,{}),e.jsx(On,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(Ka,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:Hn})})]})}const le=l.forwardRef(({className:r="",variant:s="primary",size:t="md",loading:n,disabled:a,children:i,...x},c)=>{const g="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",u={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},d={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:c,className:`${g} ${u[s]} ${d[t]} ${r}`,disabled:a||n,...x,children:[n&&e.jsx($e,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});le.displayName="Button";const O=l.forwardRef(({className:r="",label:s,error:t,hint:n,id:a,...i},x)=>{const c=a||i.name;return e.jsxs("div",{className:"w-full",children:[s&&e.jsxs("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:x,id:c,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${t?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${r}
          `,...i}),n&&!t&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n}),t&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t})]})});O.displayName="Input";const bt=l.forwardRef(({className:r="",label:s,error:t,options:n,placeholder:a,id:i,...x},c)=>{const g=i||x.name;return e.jsxs("div",{className:"w-full",children:[s&&e.jsxs("label",{htmlFor:g,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[s,x.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:c,id:g,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${t?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${r}
          `,...x,children:[a&&e.jsx("option",{value:"",children:a}),n.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))]}),t&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t})]})});bt.displayName="Select";function mt({isOpen:r,onClose:s,title:t,children:n,size:a="md"}){if(l.useEffect(()=>{const x=c=>{c.key==="Escape"&&s()};return r&&(document.addEventListener("keydown",x),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",x),document.body.style.overflow=""}},[r,s]),!r)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:s}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[a]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),e.jsx("button",{onClick:s,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Xt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:n})]})})]})}function E({children:r,className:s="",padding:t="md"}){const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${n[t]}
        ${s}
      `,children:r})}function Bs({title:r,subtitle:s,action:t}){return e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r}),s&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s})]}),t&&e.jsx("div",{children:t})]})}function Q({type:r,title:s,children:t,onClose:n,className:a=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:qe},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:tt},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:Ge},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:_r}},{bg:x,border:c,text:g,icon:u}=i[r];return e.jsx("div",{className:`${x} ${c} border rounded-lg p-4 relative ${a}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(u,{className:`w-5 h-5 ${g} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[s&&e.jsx("h4",{className:`text-sm font-medium ${g}`,children:s}),e.jsx("div",{className:`text-sm ${g} ${s?"mt-1":""}`,children:t})]}),n&&e.jsx("button",{onClick:n,className:`ml-3 ${g} hover:opacity-70 transition-opacity`,children:e.jsx(Xt,{className:"w-4 h-4"})})]})})}function vs({children:r,className:s=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${s}`,children:r})})}function _s({children:r}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:r})}function zs({children:r}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:r})}function hr({children:r,onClick:s,className:t=""}){return e.jsx("tr",{className:`${s?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${t}`,onClick:s,children:r})}function st({children:r,className:s=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${s}`,children:r})}function at({children:r,className:s=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${s}`,children:r})}function xr({icon:r,title:s,description:t,action:n}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(r,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:s}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:t}),n&&e.jsx("div",{children:n})]})}function ve({size:r="md",text:s}){const t={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx($e,{className:`${t[r]} text-primary-600 animate-spin`}),s&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:s})]})}function It({children:r,formel:s,berechnung:t,ergebnis:n,className:a="",showIcon:i=!0}){const[x,c]=l.useState(!1),[g,u]=l.useState("top"),d=l.useRef(null);return l.useEffect(()=>{if(x&&d.current){const p=d.current.getBoundingClientRect();u(p.top<120?"bottom":"top")}},[x]),e.jsxs("span",{ref:d,className:`relative inline-block cursor-help ${a}`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[r,i&&e.jsx(qe,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),x&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${g==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${g==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:s}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:t})]}),n&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:n})]})]})]})}function F(r,s=2){return r==null||isNaN(r)?"?":r.toLocaleString("de-DE",{minimumFractionDigits:s,maximumFractionDigits:s})}function Yr({children:r,text:s,className:t="",position:n="auto"}){const[a,i]=l.useState(!1),[x,c]=l.useState("bottom"),[g,u]=l.useState({top:0,left:0}),d=l.useRef(null);return l.useEffect(()=>{if(a&&d.current){const p=d.current.getBoundingClientRect();c(n==="auto"?p.top<60?"bottom":"top":n),u({top:x==="bottom"?p.bottom+6:p.top-6,left:p.left+p.width/2})}},[a,n,x]),e.jsxs("span",{ref:d,className:`relative inline-block cursor-help ${t}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[r,a&&e.jsxs("div",{className:"fixed z-[9999] px-2 py-1 text-xs bg-gray-800 text-white rounded shadow-lg whitespace-nowrap",style:{top:x==="bottom"?g.top:"auto",bottom:x==="top"?`calc(100vh - ${g.top}px)`:"auto",left:g.left,transform:"translateX(-50%)"},children:[s,e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[4px] border-l-transparent
              border-r-[4px] border-r-transparent
              ${x==="top"?"top-full border-t-[4px] border-t-gray-800":"bottom-full border-b-[4px] border-b-gray-800"}`})]})]})}const Jn={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function Me({title:r,value:s,unit:t,subtitle:n,icon:a,color:i="blue",trend:x,formel:c,berechnung:g,ergebnis:u}){const d=Jn[i],p=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof s=="number"?s.toLocaleString("de-DE"):s,t&&e.jsx("span",{className:"text-sm font-normal ml-1",children:t}),x==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"↑"}),x==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"↓"})]});return e.jsx(E,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:r}),e.jsx("div",{className:"mt-1",children:c?e.jsx(It,{formel:c,berechnung:g,ergebnis:u,children:p}):p}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${d.bg} ml-3 flex-shrink-0`,children:e.jsx(a,{className:`h-6 w-6 ${d.icon}`})})]})})}const Zn="./api";class qn{constructor(s=Zn){As(this,"baseUrl");this.baseUrl=s}async request(s,t={}){const n=`${this.baseUrl}${s}`,a={headers:{"Content-Type":"application/json",...t.headers},...t},i=await fetch(n,a);if(!i.ok){const x={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const c=await i.json();x.detail=c.detail||x.detail}catch{}throw x}if(i.status!==204)return i.json()}async get(s){return this.request(s,{method:"GET"})}async post(s,t){return this.request(s,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(s,t){return this.request(s,{method:"PUT",body:JSON.stringify(t)})}async delete(s){return this.request(s,{method:"DELETE"})}async patch(s,t){return this.request(s,{method:"PATCH",body:JSON.stringify(t)})}async upload(s,t,n="file"){const a=new FormData;return a.append(n,t),this.request(s,{method:"POST",headers:{},body:a})}}const B=new qn,dt={async list(){return B.get("/anlagen/")},async get(r){return B.get(`/anlagen/${r}`)},async create(r){return B.post("/anlagen/",r)},async update(r,s){return B.put(`/anlagen/${r}`,s)},async delete(r){return B.delete(`/anlagen/${r}`)},async getSensorConfig(r){return B.get(`/anlagen/${r}/sensors`)},async updateSensorConfig(r,s){return B.patch(`/anlagen/${r}/sensors`,s)},async geocode(r,s){const t=new URLSearchParams({plz:r});return s&&t.append("ort",s),B.get(`/anlagen/geocode/lookup?${t}`)}},Vt={async list(r,s){const t=new URLSearchParams;r&&t.append("anlage_id",r.toString()),s&&t.append("jahr",s.toString());const n=t.toString();return B.get(`/monatsdaten/${n?"?"+n:""}`)},async get(r){return B.get(`/monatsdaten/${r}`)},async create(r){return B.post("/monatsdaten/",r)},async update(r,s){return B.put(`/monatsdaten/${r}`,s)},async delete(r){return B.delete(`/monatsdaten/${r}`)},async listAggregiert(r,s){const t=s?`?jahr=${s}`:"";return B.get(`/monatsdaten/aggregiert/${r}${t}`)}},Te={async getTypen(){return B.get("/investitionen/typen")},async list(r,s,t){const n=new URLSearchParams;r&&n.append("anlage_id",r.toString()),s&&n.append("typ",s),t!==void 0&&n.append("aktiv",t.toString());const a=n.toString();return B.get(`/investitionen/${a?"?"+a:""}`)},async get(r){return B.get(`/investitionen/${r}`)},async create(r){return B.post("/investitionen/",r)},async update(r,s){return B.put(`/investitionen/${r}`,s)},async delete(r){return B.delete(`/investitionen/${r}`)},async getROIDashboard(r,s,t,n,a){const i=new URLSearchParams;s&&i.append("strompreis_cent",s.toString()),t&&i.append("einspeiseverguetung_cent",t.toString()),n&&i.append("benzinpreis_euro",n.toString()),a&&a!=="all"&&i.append("jahr",a.toString());const x=i.toString();return B.get(`/investitionen/roi/${r}${x?"?"+x:""}`)},async getEAutoDashboard(r,s,t){const n=new URLSearchParams;s&&n.append("strompreis_cent",s.toString()),t&&n.append("benzinpreis_euro",t.toString());const a=n.toString();return B.get(`/investitionen/dashboard/e-auto/${r}${a?"?"+a:""}`)},async getWaermepumpeDashboard(r,s){const t=new URLSearchParams;s&&t.append("strompreis_cent",s.toString());const n=t.toString();return B.get(`/investitionen/dashboard/waermepumpe/${r}${n?"?"+n:""}`)},async getSpeicherDashboard(r,s,t){const n=new URLSearchParams;s&&n.append("strompreis_cent",s.toString()),t&&n.append("einspeiseverguetung_cent",t.toString());const a=n.toString();return B.get(`/investitionen/dashboard/speicher/${r}${a?"?"+a:""}`)},async getWallboxDashboard(r){return B.get(`/investitionen/dashboard/wallbox/${r}`)},async getBalkonkraftwerkDashboard(r,s,t){const n=new URLSearchParams;s&&n.append("strompreis_cent",s.toString()),t&&n.append("einspeiseverguetung_cent",t.toString());const a=n.toString();return B.get(`/investitionen/dashboard/balkonkraftwerk/${r}${a?"?"+a:""}`)},async getSonstigesDashboard(r,s,t){const n=new URLSearchParams;s&&n.append("strompreis_cent",s.toString()),t&&n.append("einspeiseverguetung_cent",t.toString());const a=n.toString();return B.get(`/investitionen/dashboard/sonstiges/${r}${a?"?"+a:""}`)},async getMonatsdatenByMonth(r,s,t){return B.get(`/investitionen/monatsdaten/${r}/${s}/${t}`)}},dr={async list(r,s){const t=new URLSearchParams;r&&t.append("anlage_id",r.toString()),s&&t.append("aktuell","true");const n=t.toString();return B.get(`/strompreise/${n?"?"+n:""}`)},async getAktuell(r){return B.get(`/strompreise/aktuell/${r}`)},async get(r){return B.get(`/strompreise/${r}`)},async create(r){return B.post("/strompreise/",r)},async update(r,s){return B.put(`/strompreise/${r}`,s)},async delete(r){return B.delete(`/strompreise/${r}`)}},_t="./api",zt={async getTemplateInfo(r){const s=await fetch(`${_t}/import/template/${r}`);if(!s.ok)throw new Error("Fehler beim Laden des Templates");return s.json()},getTemplateDownloadUrl(r){return`${_t}/import/template/${r}/download`},async importCSV(r,s,t=!1){const n=new FormData;n.append("file",s);const a=new URLSearchParams;t&&a.append("ueberschreiben","true");const i=await fetch(`${_t}/import/csv/${r}?${a.toString()}`,{method:"POST",body:n});if(!i.ok){const x=await i.json();throw new Error(x.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(r,s){const t=new URLSearchParams;s&&t.append("jahr",s.toString());const n=t.toString();return`${_t}/import/export/${r}${n?"?"+n:""}`},async createDemoData(){const r=await fetch(`${_t}/import/demo`,{method:"POST"});if(!r.ok){const s=await r.json();throw new Error(s.detail||"Demo-Daten konnten nicht erstellt werden")}return r.json()},async deleteDemoData(){const r=await fetch(`${_t}/import/demo`,{method:"DELETE"});if(!r.ok){const s=await r.json();throw new Error(s.detail||"Demo-Daten konnten nicht gelöscht werden")}return r.json()},getFullExportUrl(r){return`${_t}/import/export/${r}/full`},async importJSON(r,s=!1){const t=new FormData;t.append("file",r);const n=new URLSearchParams;s&&n.append("ueberschreiben","true");const a=await fetch(`${_t}/import/json?${n.toString()}`,{method:"POST",body:t});if(!a.ok){const i=await a.json();throw new Error(i.detail||"JSON-Import fehlgeschlagen")}return a.json()},getPdfExportUrl(r,s){return s?`${_t}/import/pdf/${r}?jahr=${s}`:`${_t}/import/pdf/${r}`}},Os={async health(){return B.get("/health")},async getSettings(){return B.get("/settings")},async getStats(){return B.get("/stats")}},ft={async getPrognose(r,s={}){const t=new URLSearchParams;s.system_losses!==void 0&&t.set("system_losses",s.system_losses.toString());const n=t.toString();return B.get(`/pvgis/prognose/${r}${n?`?${n}`:""}`)},async getModulPrognose(r,s={}){const t=new URLSearchParams;s.system_losses!==void 0&&t.set("system_losses",s.system_losses.toString());const n=t.toString();return B.get(`/pvgis/modul/${r}${n?`?${n}`:""}`)},async speicherePrognose(r,s={}){const t=new URLSearchParams;s.system_losses!==void 0&&t.set("system_losses",s.system_losses.toString());const n=t.toString();return B.post(`/pvgis/prognose/${r}/speichern${n?`?${n}`:""}`)},async listeGespeichertePrognosen(r){return B.get(`/pvgis/prognose/${r}/gespeichert`)},async getAktivePrognose(r){return B.get(`/pvgis/prognose/${r}/aktiv`)},async aktivierePrognose(r){return B.put(`/pvgis/prognose/${r}/aktivieren`,{})},async loeschePrognose(r){return B.delete(`/pvgis/prognose/${r}`)},async getOptimum(r){return B.get(`/pvgis/optimum/${r}`)}},Pt={async getStatus(){return B.get("/ha/status")},async getSensors(){return B.get("/ha/sensors")},async getMapping(){return B.get("/ha/mapping")},async getMqttConfig(){return B.get("/ha/export/mqtt/config")},async getExportSensors(){return B.get("/ha/export/sensors")},async getAnlageSensors(r){return B.get(`/ha/export/sensors/${r}`)},async getYamlSnippet(r){return B.get(`/ha/export/yaml/${r}`)},async getSensorDefinitions(){return B.get("/ha/export/definitions")},async testMqtt(r){return B.post("/ha/export/mqtt/test",r||{})},async publishMqtt(r,s){return B.post(`/ha/export/mqtt/publish/${r}`,s||{})},async removeMqtt(r,s){return B.delete(`/ha/export/mqtt/remove/${r}`)}},er={async getUebersicht(r,s){const t=s?`?jahr=${s}`:"";return B.get(`/cockpit/uebersicht/${r}${t}`)},async getPrognoseVsIst(r,s){return B.get(`/cockpit/prognose-vs-ist/${r}?jahr=${s}`)},async getNachhaltigkeit(r){return B.get(`/cockpit/nachhaltigkeit/${r}`)},async getKomponentenZeitreihe(r,s){const t=s?`?jahr=${s}`:"";return B.get(`/cockpit/komponenten-zeitreihe/${r}${t}`)},async getPVStrings(r,s){const t=s?`?jahr=${s}`:"";return B.get(`/cockpit/pv-strings/${r}${t}`)},async getPVStringsGesamtlaufzeit(r){return B.get(`/cockpit/pv-strings-gesamtlaufzeit/${r}`)}},Qr={async getMonatsdaten(r,s,t,n="auto"){return B.get(`/wetter/monat/${r}/${s}/${t}?provider=${n}`)},async getMonatsdatenByCoords(r,s,t,n,a="auto"){return B.get(`/wetter/monat/koordinaten/${r}/${s}/${t}/${n}?provider=${a}`)},async getProvider(r){return B.get(`/wetter/provider/${r}`)},async getVergleich(r,s,t){return B.get(`/wetter/vergleich/${r}/${s}/${t}`)},async getSolarPrognose(r,s=7,t=!1){const n=await B.get(`/solar-prognose/${r}?tage=${s}&pro_string=${t}`);return{...n,tage:n.tageswerte,anlage:{id:n.anlage_id,name:n.anlagenname,leistung_kwp:n.kwp_gesamt,neigung:n.neigung,azimut:n.ausrichtung}}}},ur={async getMapping(r){return B.get(`/sensor-mapping/${r}`)},async getAvailableSensors(r,s=!0){const t=new URLSearchParams;s||t.set("filter_energy","false");const n=t.toString()?`?${t.toString()}`:"";return B.get(`/sensor-mapping/${r}/available-sensors${n}`)},async saveMapping(r,s){return B.post(`/sensor-mapping/${r}`,s)},async deleteMapping(r){await B.delete(`/sensor-mapping/${r}`)},async getStatus(r){return B.get(`/sensor-mapping/${r}/status`)},async initStartValues(r){return B.post(`/sensor-mapping/${r}/init-start-values`,{})}},ts={async getStatus(r,s,t){return B.get(`/monatsabschluss/${r}/${s}/${t}`)},async save(r,s,t,n){return B.post(`/monatsabschluss/${r}/${s}/${t}`,n)},async getNaechsterMonat(r){try{return await B.get(`/monatsabschluss/naechster/${r}`)}catch{return null}},async getHistorie(r,s=12){return B.get(`/monatsabschluss/historie/${r}?limit=${s}`)}};function Un(r){return{jahr:r.jahr,monat:r.monat,monat_name:r.monat_name,basis:r.basis.map(s=>({feld:s.feld,label:s.feld_label,wert:s.differenz,einheit:s.einheit,sensor_id:s.sensor_id})),investitionen:r.investitionen.map(s=>({investition_id:s.investition_id,bezeichnung:s.bezeichnung,typ:s.typ,felder:s.felder.map(t=>({feld:t.feld,label:t.feld_label,wert:t.differenz,einheit:t.einheit,sensor_id:t.sensor_id}))}))}}const Mt={async getStatus(){return B.get("/ha-statistics/status")},async getMonatswerte(r,s,t){const n=await B.get(`/ha-statistics/monatswerte/${r}/${s}/${t}`);return Un(n)},async getVerfuegbareMonate(r){return(await B.get(`/ha-statistics/verfuegbare-monate/${r}`)).monate.map(t=>({...t,hat_daten:!0}))},async getAlleMonatswerte(r){return B.get(`/ha-statistics/alle-monatswerte/${r}`)},async getMonatsanfangWerte(r,s,t){return B.get(`/ha-statistics/monatsanfang/${r}/${s}/${t}`)},async getImportVorschau(r){return B.get(`/ha-statistics/import-vorschau/${r}`)},async importieren(r,s){return B.post(`/ha-statistics/import/${r}`,s)}},Re={async getStatus(){return B.get("/community/status")},async getPreview(r){return B.get(`/community/preview/${r}`)},async share(r){return B.post(`/community/share/${r}`)},async delete(r){return B.delete(`/community/delete/${r}`)},async getBenchmark(r,s="letzte_12_monate",t){const n=new URLSearchParams({zeitraum:s});return t&&n.append("jahr",t.toString()),B.get(`/community/benchmark/${r}?${n.toString()}`)},async getGlobalStatistics(){return B.get("/community/statistics/global")},async getMonthlyAverages(r=12){return B.get(`/community/statistics/monthly-averages?monate=${r}`)},async getRegionalStatistics(){return B.get("/community/statistics/regional")},async getRegionalDetails(r){return B.get(`/community/statistics/regional/${r}`)},async getDistribution(r,s=10){return B.get(`/community/statistics/distributions/${r}?bins=${s}`)},async getRanking(r,s=10){return B.get(`/community/statistics/rankings/${r}?limit=${s}`)},async getSpeicherByClass(){return B.get("/community/components/speicher/by-class")},async getWaermepumpeByRegion(){return B.get("/community/components/waermepumpe/by-region")},async getEAutoByUsage(){return B.get("/community/components/eauto/by-usage")},async getTrends(r){return B.get(`/community/trends/${r}`)},async getDegradation(){return B.get("/community/trends/degradation")}};function Je(){const[r,s]=l.useState([]),[t,n]=l.useState(!0),[a,i]=l.useState(null),x=l.useCallback(async()=>{try{n(!0),i(null);const d=await dt.list();s(d)}catch(d){i(d instanceof Error?d.message:"Fehler beim Laden der Anlagen")}finally{n(!1)}},[]);l.useEffect(()=>{x()},[x]);const c=l.useCallback(async d=>{const p=await dt.create(d);return s(m=>[...m,p]),p},[]),g=l.useCallback(async(d,p)=>{const m=await dt.update(d,p);return s(o=>o.map(b=>b.id===d?m:b)),m},[]),u=l.useCallback(async d=>{await dt.delete(d),s(p=>p.filter(m=>m.id!==d))},[]);return{anlagen:r,loading:t,error:a,refresh:x,createAnlage:c,updateAnlage:g,deleteAnlage:u}}function Yn(r,s){const[t,n]=l.useState([]),[a,i]=l.useState(!0),[x,c]=l.useState(null),g=l.useCallback(async()=>{try{i(!0),c(null);const m=await Vt.list(r,s);n(m)}catch(m){c(m instanceof Error?m.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[r,s]);l.useEffect(()=>{g()},[g]);const u=l.useCallback(async m=>{const o=await Vt.create(m);return n(b=>[o,...b]),o},[]),d=l.useCallback(async(m,o)=>{const b=await Vt.update(m,o);return n(h=>h.map(y=>y.id===m?b:y)),b},[]),p=l.useCallback(async m=>{await Vt.delete(m),n(o=>o.filter(b=>b.id!==m))},[]);return{monatsdaten:t,loading:a,error:x,refresh:g,createMonatsdaten:u,updateMonatsdaten:d,deleteMonatsdaten:p}}function Qn(r,s){const[t,n]=l.useState([]),[a,i]=l.useState(!0),[x,c]=l.useState(null),g=l.useCallback(async()=>{if(!r){n([]),i(!1);return}try{i(!0),c(null);const u=await Vt.listAggregiert(r,s);n(u)}catch(u){c(u instanceof Error?u.message:"Fehler beim Laden der aggregierten Daten")}finally{i(!1)}},[r,s]);return l.useEffect(()=>{g()},[g]),{daten:t,loading:a,error:x,refresh:g}}function Xn(r){return{gesamtErzeugung:r.reduce((s,t)=>s+(t.pv_erzeugung_kwh||0),0),gesamtEinspeisung:r.reduce((s,t)=>s+t.einspeisung_kwh,0),gesamtNetzbezug:r.reduce((s,t)=>s+t.netzbezug_kwh,0),gesamtEigenverbrauch:r.reduce((s,t)=>s+(t.eigenverbrauch_kwh||0),0),gesamtDirektverbrauch:r.reduce((s,t)=>s+(t.direktverbrauch_kwh||0),0),gesamtSpeicherLadung:r.reduce((s,t)=>s+(t.speicher_ladung_kwh||0),0),gesamtSpeicherEntladung:r.reduce((s,t)=>s+(t.speicher_entladung_kwh||0),0),gesamtWpStrom:r.reduce((s,t)=>s+(t.wp_strom_kwh||0),0),gesamtWpHeizung:r.reduce((s,t)=>s+(t.wp_heizung_kwh||0),0),gesamtEautoLadung:r.reduce((s,t)=>s+(t.eauto_ladung_kwh||0),0),gesamtEautoKm:r.reduce((s,t)=>s+(t.eauto_km||0),0),durchschnittAutarkie:r.length>0?r.reduce((s,t)=>s+(t.autarkie_prozent||0),0)/r.length:0,anzahlMonate:r.length}}function zr(r,s){const[t,n]=l.useState([]),[a,i]=l.useState(!0),[x,c]=l.useState(null),g=l.useCallback(async()=>{try{i(!0),c(null);const m=await Te.list(r,s);n(m)}catch(m){c(m instanceof Error?m.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[r,s]);l.useEffect(()=>{g()},[g]);const u=l.useCallback(async m=>{const o=await Te.create(m);return n(b=>[...b,o]),o},[]),d=l.useCallback(async(m,o)=>{const b=await Te.update(m,o);return n(h=>h.map(y=>y.id===m?b:y)),b},[]),p=l.useCallback(async m=>{await Te.delete(m),n(o=>o.filter(b=>b.id!==m))},[]);return{investitionen:t,loading:a,error:x,refresh:g,createInvestition:u,updateInvestition:d,deleteInvestition:p}}function ei(r){return r.reduce((t,n)=>(t[n.typ]||(t[n.typ]=[]),t[n.typ].push(n),t),{})}function ti(r){const[s,t]=l.useState([]),[n,a]=l.useState(!0),[i,x]=l.useState(null),c=l.useCallback(async()=>{try{a(!0),x(null);const p=await dr.list(r);t(p)}catch(p){x(p instanceof Error?p.message:"Fehler beim Laden der Strompreise")}finally{a(!1)}},[r]);l.useEffect(()=>{c()},[c]);const g=l.useCallback(async p=>{const m=await dr.create(p);return t(o=>[m,...o]),m},[]),u=l.useCallback(async(p,m)=>{const o=await dr.update(p,m);return t(b=>b.map(h=>h.id===p?o:h)),o},[]),d=l.useCallback(async p=>{await dr.delete(p),t(m=>m.filter(o=>o.id!==p))},[]);return{strompreise:s,loading:n,error:i,refresh:c,createStrompreis:g,updateStrompreis:u,deleteStrompreis:d}}function $a(r){const[s,t]=l.useState(null),[n,a]=l.useState(!1),[i,x]=l.useState(null);return l.useEffect(()=>{if(r===null){t(null);return}(async()=>{try{a(!0),x(null);const g=await dr.getAktuell(r);t(g)}catch{t(null)}finally{a(!1)}})()},[r]),{strompreis:s,loading:n,error:i}}const qt={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function Da(r){return r<=10?8.2:r<=40?7.1:5.8}const rs="eedc_setup_wizard_state",Ks={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},Gt=["welcome","anlage","strompreise","investitionen","summary","complete"],La=["wechselrichter","pv-module","speicher","balkonkraftwerk","waermepumpe","e-auto","wallbox","sonstiges"],Nt={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},ri={"pv-module":"wechselrichter",speicher:"wechselrichter"},si=["pv-module"];function ai(){const[r,s]=l.useState(()=>{try{const $=localStorage.getItem(rs);if($)return JSON.parse($)}catch{}return Ks}),[t,n]=l.useState(r.currentStep),[a,i]=l.useState(!1),[x,c]=l.useState(null),[g,u]=l.useState(null),[d,p]=l.useState(null),[m,o]=l.useState([]),[b,h]=l.useState(null),[y,k]=l.useState(null),j=l.useRef(new Map);l.useEffect(()=>{localStorage.setItem(rs,JSON.stringify({...r,currentStep:t}))},[r,t]),l.useEffect(()=>{r.anlageId&&!g&&dt.get(r.anlageId).then(u).catch(()=>{})},[r.anlageId,g]);const w=l.useCallback(async()=>{if(r.anlageId)try{const $=await Te.list(r.anlageId);o($)}catch{}},[r.anlageId]);l.useEffect(()=>{w()},[w]);const v=l.useCallback($=>{n($),c(null)},[]),N=l.useCallback(async()=>{const $=j.current;if($.size===0)return;const Z=[];$.forEach(({data:G,timer:U},ne)=>{clearTimeout(U),Z.push(Te.update(ne,G).catch(xe=>{console.error(`Fehler beim Update von Investition ${ne}:`,xe)}))}),$.clear(),await Promise.all(Z),await w()},[w]),f=l.useCallback(async()=>{await N();const $=Gt.indexOf(t);$<Gt.length-1&&v(Gt[$+1])},[t,v,N]),_=l.useCallback(()=>{const $=Gt.indexOf(t);$>0&&v(Gt[$-1])},[t,v]),I=l.useCallback(()=>{s($=>({...$,skippedSteps:[...$.skippedSteps,t]})),f()},[t,f]),C=l.useCallback(async($,Z)=>{try{const G=await dt.geocode($,Z);return{latitude:G.latitude,longitude:G.longitude}}catch{return null}},[]),P=l.useCallback(async $=>{i(!0),c(null);try{const Z=await dt.create($);u(Z),s(G=>({...G,anlageId:Z.id})),f()}catch(Z){c(Z instanceof Error?Z.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[f]),A=l.useCallback(async $=>{if(!r.anlageId){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const Z=await dr.create({anlage_id:r.anlageId,...$});p(Z),s(G=>({...G,strompreisId:Z.id})),f()}catch(Z){c(Z instanceof Error?Z.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[r.anlageId,f]),z=l.useCallback(async()=>{if(!r.anlageId||!g){c("Keine Anlage vorhanden");return}const $=Da(g.leistung_kwp);await A({netzbezug_arbeitspreis_cent_kwh:qt.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:$,grundpreis_euro_monat:qt.grundpreis_euro_monat,gueltig_ab:g.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[r.anlageId,g,A]),S=l.useCallback(async($,Z)=>{o(xe=>xe.map(Ne=>Ne.id!==$?Ne:{...Ne,...Z,parameter:Z.parameter?{...Ne.parameter||{},...Z.parameter}:Ne.parameter}));const G=j.current.get($);G!=null&&G.timer&&clearTimeout(G.timer);const U=G!=null&&G.data?{...G.data,...Z,parameter:Z.parameter?{...G.data.parameter||{},...Z.parameter}:G.data.parameter}:Z,ne=setTimeout(async()=>{j.current.delete($);try{await Te.update($,U)}catch(xe){c(xe instanceof Error?xe.message:"Fehler beim Aktualisieren"),await w()}},500);j.current.set($,{data:U,timer:ne})},[w]),W=l.useCallback(async $=>{try{await Te.delete($),await w()}catch(Z){c(Z instanceof Error?Z.message:"Fehler beim Löschen")}},[w]),V=l.useCallback(async $=>{if(!r.anlageId)throw new Error("Keine Anlage vorhanden");c(null);try{const Z=await Te.create({anlage_id:r.anlageId,typ:$,bezeichnung:`Neue ${Nt[$]}`,aktiv:!0});return await w(),Z}catch(Z){const G=Z instanceof Error?Z.message:"Fehler beim Hinzufügen";throw c(G),Z}},[r.anlageId,w]),oe=l.useCallback(async()=>{if(!r.anlageId||!g){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const $=await Te.create({anlage_id:r.anlageId,typ:"wechselrichter",bezeichnung:"Wechselrichter",aktiv:!0,anschaffungsdatum:g.installationsdatum});await Te.create({anlage_id:r.anlageId,typ:"pv-module",bezeichnung:"PV-Module",leistung_kwp:g.leistung_kwp,ausrichtung:g.ausrichtung,neigung_grad:g.neigung_grad,parent_investition_id:$.id,aktiv:!0,anschaffungsdatum:g.installationsdatum}),s(Z=>({...Z,createdInvestitionen:[...Z.createdInvestitionen,$.id]})),await w()}catch($){c($ instanceof Error?$.message:"Fehler beim Erstellen des PV-Systems")}finally{i(!1)}},[r.anlageId,g,w]),R=l.useCallback(async()=>{if(!r.anlageId||!g)return;if(!g.latitude||!g.longitude){k("Keine Koordinaten vorhanden");return}if(!m.some(Z=>Z.typ==="pv-module")){k("Keine PV-Module vorhanden");return}i(!0),k(null);try{const Z=await ft.speicherePrognose(r.anlageId);h(Z)}catch(Z){const G=Z instanceof Error?Z.message:"Fehler beim Abrufen der PVGIS-Prognose";k(G)}finally{i(!1)}},[r.anlageId,g,m]),M=l.useCallback(()=>{s($=>({...$,completed:!0,currentStep:"complete"})),n("complete")},[]),H=l.useCallback(()=>{localStorage.removeItem(rs),s(Ks),n("welcome"),u(null),p(null),o([]),c(null)},[]),re=(()=>{switch(t){case"welcome":return!0;case"anlage":return!!r.anlageId;case"strompreise":return!!r.strompreisId;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),me=Math.round(Gt.indexOf(t)/(Gt.length-1)*100),q=!!(g!=null&&g.latitude&&(g!=null&&g.longitude)&&m.some($=>$.typ==="pv-module"));return{step:t,wizardState:r,isLoading:a,error:x,anlage:g,strompreis:d,pvgisPrognose:b,pvgisError:y,investitionen:m,refreshInvestitionen:w,goToStep:v,nextStep:f,prevStep:_,skipStep:I,createAnlage:P,geocodeAddress:C,createStrompreis:A,useDefaultStrompreise:z,updateInvestition:S,deleteInvestition:W,addInvestition:V,createDefaultPVSystem:oe,fetchPvgisPrognose:R,completeWizard:M,resetWizard:H,canProceed:re,progress:me,canFetchPvgis:q}}function ni(){var h,y,k,j,w,v,N;const r=Ft(),{anlagen:s,loading:t}=Je(),[n,a]=l.useState(null),[i,x]=l.useState(!0),[c,g]=l.useState(null),[u,d]=l.useState(void 0),[p,m]=l.useState([]),o=(h=s[0])==null?void 0:h.id;if(l.useEffect(()=>{if(!o)return;(async()=>{x(!0),g(null);try{const _=await er.getUebersicht(o,u);if(a(_),_.zeitraum_von&&_.zeitraum_bis){const I=parseInt(_.zeitraum_von.split("-")[0]),C=parseInt(_.zeitraum_bis.split("-")[0]),P=[];for(let A=I;A<=C;A++)P.push(A);m(P)}}catch(_){g("Fehler beim Laden der Daten"),console.error(_)}finally{x(!1)}})()},[o,u]),t||i)return e.jsx(ve,{text:"Lade Dashboard..."});if(s.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsx(ii,{})]});if(c||!n)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs(E,{children:[e.jsx("p",{className:"text-red-500",children:c||"Keine Daten verfügbar"}),e.jsx(le,{onClick:()=>r("/einstellungen/monatsdaten"),className:"mt-4",children:"Monatsdaten erfassen"})]})]});const b=s[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{className:"h-8 w-8 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[b.anlagenname," • ",n.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:u||"",onChange:f=>d(f.target.value?parseInt(f.target.value):void 0),className:"input py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Alle Jahre"}),p.map(f=>e.jsx("option",{value:f,children:f},f))]})]})]}),n.zeitraum_von&&n.zeitraum_bis&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Zeitraum: ",n.zeitraum_von," bis ",n.zeitraum_bis," (",n.anzahl_monate," Monate)"]}),e.jsx(Ar,{title:"Energie-Bilanz",icon:ye,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"PV-Erzeugung",value:(n.pv_erzeugung_kwh/1e3).toFixed(1),unit:"MWh",icon:ae,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>r("/cockpit/pv-anlage"),formel:"Σ PV-Erzeugung aller Monate",berechnung:`${F(n.pv_erzeugung_kwh,0)} kWh`,ergebnis:`= ${F(n.pv_erzeugung_kwh/1e3,1)} MWh`}),e.jsx(De,{title:"Gesamtverbrauch",value:(n.gesamtverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:Ze,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch + Netzbezug",berechnung:`${F(n.eigenverbrauch_kwh,0)} + ${F(n.netzbezug_kwh,0)} kWh`,ergebnis:`= ${F(n.gesamtverbrauch_kwh/1e3,1)} MWh`}),e.jsx(De,{title:"Netzbezug",value:(n.netzbezug_kwh/1e3).toFixed(1),unit:"MWh",icon:Ds,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Netzbezug aller Monate",berechnung:`${F(n.netzbezug_kwh,0)} kWh`,ergebnis:`= ${F(n.netzbezug_kwh/1e3,1)} MWh`}),e.jsx(De,{title:"Einspeisung",value:(n.einspeisung_kwh/1e3).toFixed(1),unit:"MWh",icon:es,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einspeisung aller Monate",berechnung:`${F(n.einspeisung_kwh,0)} kWh`,ergebnis:`= ${F(n.einspeisung_kwh/1e3,1)} MWh`})]})}),e.jsx(Ar,{title:"Effizienz-Quoten",icon:vr,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Autarkie",value:n.autarkie_prozent.toFixed(1),unit:"%",subtitle:"Unabhängigkeit vom Netz",icon:ir,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:`${F(n.eigenverbrauch_kwh,0)} ÷ ${F(n.gesamtverbrauch_kwh,0)} × 100`,ergebnis:`= ${F(n.autarkie_prozent,1)} %`}),e.jsx(De,{title:"Eigenverbrauchsquote",value:n.eigenverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Selbst genutzte PV",icon:ye,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${F(n.eigenverbrauch_kwh,0)} ÷ ${F(n.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${F(n.eigenverbrauch_quote_prozent,1)} %`}),e.jsx(De,{title:"Direktverbrauchsquote",value:n.direktverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Ohne Speicher-Umweg",icon:_e,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Direktverbrauch ÷ Erzeugung × 100",berechnung:`${F(n.direktverbrauch_kwh,0)} ÷ ${F(n.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${F(n.direktverbrauch_quote_prozent,1)} %`}),e.jsx(De,{title:"Spez. Ertrag",value:((y=n.spezifischer_ertrag_kwh_kwp)==null?void 0:y.toFixed(0))||"---",unit:"kWh/kWp",subtitle:"Anlageneffizienz",icon:ae,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Erzeugung ÷ Anlagenleistung",berechnung:`${F(n.pv_erzeugung_kwh,0)} kWh ÷ ${F(n.anlagenleistung_kwp,2)} kWp`,ergebnis:`= ${F(n.spezifischer_ertrag_kwh_kwp||0,0)} kWh/kWp`})]})}),n.hat_speicher&&e.jsx(ss,{title:"Speicher",icon:ze,onClick:()=>r("/cockpit/speicher"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Ladung gesamt",value:(n.speicher_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Ds,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung",berechnung:`${F(n.speicher_ladung_kwh,0)} kWh`,ergebnis:`= ${F(n.speicher_ladung_kwh/1e3,2)} MWh`}),e.jsx(De,{title:"Entladung gesamt",value:(n.speicher_entladung_kwh/1e3).toFixed(2),unit:"MWh",icon:es,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung",berechnung:`${F(n.speicher_entladung_kwh,0)} kWh`,ergebnis:`= ${F(n.speicher_entladung_kwh/1e3,2)} MWh`}),e.jsx(De,{title:"Ø Effizienz",value:((k=n.speicher_effizienz_prozent)==null?void 0:k.toFixed(1))||"---",unit:"%",icon:ir,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${F(n.speicher_entladung_kwh,0)} ÷ ${F(n.speicher_ladung_kwh,0)} × 100`,ergebnis:`= ${F(n.speicher_effizienz_prozent||0,1)} %`}),e.jsx(De,{title:"Vollzyklen",value:((j=n.speicher_vollzyklen)==null?void 0:j.toFixed(0))||"---",unit:"",subtitle:`${n.speicher_kapazitaet_kwh.toFixed(1)} kWh Kapazität`,icon:ze,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Ladung ÷ Kapazität",berechnung:`${F(n.speicher_ladung_kwh,0)} kWh ÷ ${F(n.speicher_kapazitaet_kwh,1)} kWh`,ergebnis:`= ${F(n.speicher_vollzyklen||0,0)} Zyklen`})]})}),n.hat_waermepumpe&&e.jsx(ss,{title:"Wärmepumpe",icon:Ke,onClick:()=>r("/cockpit/waermepumpe"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Wärme erzeugt",value:(n.wp_waerme_kwh/1e3).toFixed(2),unit:"MWh",icon:Ke,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizung + Warmwasser",berechnung:`${F(n.wp_waerme_kwh,0)} kWh`,ergebnis:`= ${F(n.wp_waerme_kwh/1e3,2)} MWh`}),e.jsx(De,{title:"Strom verbraucht",value:(n.wp_strom_kwh/1e3).toFixed(2),unit:"MWh",icon:ye,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Stromverbrauch",berechnung:`${F(n.wp_strom_kwh,0)} kWh`,ergebnis:`= ${F(n.wp_strom_kwh/1e3,2)} MWh`}),e.jsx(De,{title:"Ø COP",value:((w=n.wp_cop)==null?void 0:w.toFixed(1))||"---",unit:"",icon:ir,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${F(n.wp_waerme_kwh,0)} ÷ ${F(n.wp_strom_kwh,0)}`,ergebnis:`= ${F(n.wp_cop||0,1)}`}),e.jsx(De,{title:"Ersparnis vs. Gas",value:n.wp_ersparnis_euro.toFixed(0),unit:"€",icon:St,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Gaskosten - Stromkosten",berechnung:`(${F(n.wp_waerme_kwh,0)} kWh ÷ 0.9 × 10ct) - (${F(n.wp_strom_kwh,0)} kWh × Strompreis)`,ergebnis:`= ${F(n.wp_ersparnis_euro,0)} €`})]})}),n.hat_emobilitaet&&e.jsx(ss,{title:"E-Mobilität",icon:Ae,onClick:()=>r("/cockpit/e-auto"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Gefahrene km",value:(n.emob_km/1e3).toFixed(1),unit:"Tkm",icon:Ae,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene Kilometer",berechnung:`${F(n.emob_km,0)} km`,ergebnis:`= ${F(n.emob_km/1e3,1)} Tkm`}),e.jsx(De,{title:"Ladung gesamt",value:(n.emob_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:ye,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Heim + Extern Ladung",berechnung:`${F(n.emob_ladung_kwh,0)} kWh`,ergebnis:`= ${F(n.emob_ladung_kwh/1e3,2)} MWh`}),e.jsx(De,{title:"PV-Anteil",value:((v=n.emob_pv_anteil_prozent)==null?void 0:v.toFixed(0))||"---",unit:"%",icon:ae,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"PV-Ladung ÷ Heimladung × 100",berechnung:"PV-geladene kWh ÷ Gesamt-Ladung",ergebnis:`= ${F(n.emob_pv_anteil_prozent||0,0)} %`}),e.jsx(De,{title:"Ersparnis vs. Benzin",value:n.emob_ersparnis_euro.toFixed(0),unit:"€",icon:St,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Benzinkosten - Stromkosten",berechnung:"Benzin (7L/100km × 1.80€) - Strom",ergebnis:`= ${F(n.emob_ersparnis_euro,0)} €`})]})}),e.jsx(Ar,{title:"Finanzen",icon:St,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"Einspeiseerlös",value:n.einspeise_erloes_euro.toFixed(0),unit:"€",icon:es,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Vergütung",berechnung:`${F(n.einspeisung_kwh,0)} kWh × 8.2 ct/kWh`,ergebnis:`= ${F(n.einspeise_erloes_euro,0)} €`}),e.jsx(De,{title:"EV-Ersparnis",value:n.ev_ersparnis_euro.toFixed(0),unit:"€",icon:ye,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Strompreis",berechnung:`${F(n.eigenverbrauch_kwh,0)} kWh × Strompreis`,ergebnis:`= ${F(n.ev_ersparnis_euro,0)} €`}),e.jsx(De,{title:"Netto-Ertrag",value:n.netto_ertrag_euro.toFixed(0),unit:"€",icon:_e,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Erlös + Ersparnis",berechnung:`${F(n.einspeise_erloes_euro,0)} + ${F(n.ev_ersparnis_euro,0)} €`,ergebnis:`= ${F(n.netto_ertrag_euro,0)} €`}),e.jsx(De,{title:"Jahres-Rendite",value:((N=n.jahres_rendite_prozent)==null?void 0:N.toFixed(1))||"---",unit:"%",subtitle:`von ${n.investition_gesamt_euro.toFixed(0)} € Invest`,icon:ir,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",onClick:()=>r("/auswertungen/roi"),formel:"Jahres-Ertrag ÷ Investition × 100",berechnung:`${F(n.netto_ertrag_euro,0)} € ÷ ${F(n.investition_gesamt_euro,0)} €`,ergebnis:`= ${F(n.jahres_rendite_prozent||0,1)} % p.a.`})]})}),e.jsx(Ar,{title:"CO₂-Bilanz",icon:et,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(De,{title:"CO₂ PV",value:(n.co2_pv_kg/1e3).toFixed(1),unit:"t",subtitle:"Vermiedene Emissionen",icon:ae,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Eigenverbrauch × CO₂-Faktor",berechnung:`${F(n.eigenverbrauch_kwh,0)} kWh × 0.38 kg/kWh`,ergebnis:`= ${F(n.co2_pv_kg,0)} kg`}),e.jsx(De,{title:"CO₂ Wärmepumpe",value:(n.co2_wp_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Gas-Heizung",icon:Ke,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO₂ Gas - CO₂ Strom",berechnung:"Gasverbrauch × 0.201 - WP-Strom × 0.38",ergebnis:`= ${F(n.co2_wp_kg,0)} kg`}),e.jsx(De,{title:"CO₂ E-Mobilität",value:(n.co2_emob_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Verbrenner",icon:Ae,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"CO₂ Benzin - CO₂ Strom",berechnung:"Benzinverbrauch × 2.37 - Stromverbrauch × 0.38",ergebnis:`= ${F(n.co2_emob_kg,0)} kg`}),e.jsx(De,{title:"CO₂ gesamt",value:(n.co2_gesamt_kg/1e3).toFixed(1),unit:"t",subtitle:"Gesamte Einsparung",icon:et,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ aller CO₂-Einsparungen",berechnung:`${F(n.co2_pv_kg,0)} + ${F(n.co2_wp_kg,0)} + ${F(n.co2_emob_kg,0)} kg`,ergebnis:`= ${F(n.co2_gesamt_kg/1e3,1)} t`})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(as,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>r("/einstellungen/monatsdaten")}),e.jsx(as,{title:"Auswertungen",description:"Detaillierte Analysen und Zeitverläufe",onClick:()=>r("/auswertungen")}),e.jsx(as,{title:"Investitionen",description:"Komponenten verwalten",onClick:()=>r("/einstellungen/investitionen")})]})]})}function Ar({title:r,icon:s,children:t}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r})]}),t]})}function ss({title:r,icon:s,onClick:t,children:n}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:[e.jsx(s,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r}),e.jsx(vt,{className:"h-4 w-4 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),n]})}function De({title:r,value:s,unit:t,subtitle:n,icon:a,color:i,bgColor:x,onClick:c,formel:g,berechnung:u,ergebnis:d}){const p=e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:t})]}),m=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:r}),e.jsx("div",{className:"mt-0.5",children:g?e.jsx(It,{formel:g,berechnung:u,ergebnis:d,children:p}):p}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate",children:n})]}),e.jsx("div",{className:`p-2 rounded-lg ${x} ml-2 flex-shrink-0`,children:e.jsx(a,{className:`h-5 w-5 ${i}`})})]});return c?e.jsx("button",{onClick:c,className:"card p-3 text-left hover:shadow-md transition-shadow w-full",children:m}):e.jsx(E,{className:"p-3",children:m})}function as({title:r,description:s,onClick:t}){return e.jsx("button",{onClick:t,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:r}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]}),e.jsx(Ye,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function ii(){const r=Ft();return e.jsxs(E,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(le,{onClick:()=>r("/einstellungen/anlage"),children:["Jetzt starten",e.jsx(Ye,{className:"h-4 w-4 ml-2"})]})]})}const Lt=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function li({anlageId:r}){var d;const[s,t]=l.useState(null),[n,a]=l.useState(!0),[i,x]=l.useState(null);l.useEffect(()=>{let p=!1;return(async()=>{a(!0),x(null);try{const o=await er.getPVStringsGesamtlaufzeit(r);p||t(o)}catch(o){if(!p){const b=o&&typeof o=="object"&&"detail"in o?String(o.detail):"Fehler beim Laden der String-Daten";x(b),console.error("PVStringVergleich Fehler:",o)}}finally{p||a(!1)}})(),()=>{p=!0}},[r]);const c=l.useMemo(()=>{if(!(s!=null&&s.strings)||s.strings.length===0)return[];const p={};for(const m of s.strings)for(const o of m.jahreswerte)p[o.jahr]||(p[o.jahr]={}),p[o.jahr][m.bezeichnung]={soll:o.prognose_kwh,ist:o.ist_kwh};return Object.entries(p).sort(([m],[o])=>Number(m)-Number(o)).map(([m,o])=>{const b={name:m};for(const h of s.strings){const y=o[h.bezeichnung];y&&(b[`${h.bezeichnung} SOLL`]=Math.round(y.soll),b[`${h.bezeichnung} IST`]=Math.round(y.ist))}return b})},[s]),g=l.useMemo(()=>s!=null&&s.saisonal_aggregiert?s.saisonal_aggregiert.map(p=>({name:p.monat_name.slice(0,3),SOLL:Math.round(p.prognose_kwh),"IST Ø":Math.round(p.ist_durchschnitt_kwh),"IST Summe":Math.round(p.ist_summe_kwh)})):[],[s]);if(n)return e.jsx(ve,{text:"Lade String-Vergleich..."});if(i)return e.jsx(Q,{type:"error",children:i});if(!s||!s.strings||s.strings.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen → Investitionen anlegen."})]});if(!s.hat_prognose)return e.jsx(Q,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen → PVGIS eine Prognose abrufen."})]})});const u=({ratio:p})=>{if(p==null)return e.jsx("span",{className:"text-gray-400",children:"-"});const m=p*100,o=m>=95?"text-green-600":m<85?"text-red-600":"text-amber-600",b=m>=95?_e:m<85?jt:null;return e.jsxs("span",{className:`flex items-center gap-1 ${o}`,children:[b&&e.jsx(b,{className:"h-3 w-3"}),m.toFixed(0),"%"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"SOLL (Prognose)"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:[(s.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("p",{className:"text-xs text-blue-500",children:[s.anzahl_jahre," Jahre × PVGIS"]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"IST (Erzeugt)"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(s.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("p",{className:"text-xs text-amber-500",children:[s.anzahl_monate," Monate erfasst"]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${(s.abweichung_gesamt_prozent??0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Abweichung"}),e.jsxs("p",{className:`text-xl font-bold ${(s.abweichung_gesamt_prozent??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(s.abweichung_gesamt_prozent??0)>=0?"+":"",((d=s.abweichung_gesamt_prozent)==null?void 0:d.toFixed(1))??"0","%"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-700 dark:text-gray-300",children:[s.erstes_jahr," - ",s.letztes_jahr]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.anlagen_leistung_kwp.toFixed(1)," kWp"]})]})]}),s.strings.length>1&&(s.bester_string||s.schlechtester_string)&&e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[s.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full",children:[e.jsx(_e,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300",children:["Beste Performance: ",e.jsx("strong",{children:s.bester_string})]})]}),s.schlechtester_string&&s.schlechtester_string!==s.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-full",children:[e.jsx(jt,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-red-700 dark:text-red-300",children:["Schwächster: ",e.jsx("strong",{children:s.schlechtester_string})]})]})]}),c.length>0&&e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(it,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro Jahr"]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:c,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name"}),e.jsx(ge,{unit:" kWh"}),e.jsx(ce,{formatter:p=>[`${p.toLocaleString()} kWh`]}),e.jsx(Ee,{}),s.strings.map((p,m)=>e.jsx(se,{dataKey:`${p.bezeichnung} SOLL`,fill:Lt[m%Lt.length],opacity:.4,name:`${p.bezeichnung} SOLL`},`${p.investition_id}-soll`)),s.strings.map((p,m)=>e.jsx(se,{dataKey:`${p.bezeichnung} IST`,fill:Lt[m%Lt.length],name:`${p.bezeichnung} IST`},`${p.investition_id}-ist`))]})})})]}),g.length>0&&e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5 text-green-500"}),"Saisonaler Vergleich (Jan - Dez)"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Vergleicht die monatliche PVGIS-Prognose mit dem Durchschnitt der tatsächlichen Erzeugung über alle Jahre."}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:g,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name"}),e.jsx(ge,{unit:" kWh"}),e.jsx(ce,{formatter:p=>[`${p.toLocaleString()} kWh`]}),e.jsx(Ee,{}),e.jsx(ct,{type:"monotone",dataKey:"SOLL",fill:"#3b82f6",stroke:"#3b82f6",fillOpacity:.2,name:"PVGIS Prognose"}),e.jsx(Be,{type:"monotone",dataKey:"IST Ø",stroke:"#f59e0b",strokeWidth:3,dot:{r:4},name:"IST Durchschnitt"})]})})})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einzelne Strings / Module (Gesamtlaufzeit)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String / Modul"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abw."}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Performance"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.strings.map((p,m)=>{var o,b;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:Lt[m%Lt.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:p.bezeichnung})]}),p.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:["→ ",p.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:p.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3 text-gray-600 dark:text-gray-400",children:[p.ausrichtung||"-",p.neigung_grad!=null&&` / ${p.neigung_grad}°`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600 dark:text-blue-400",children:[(p.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right font-medium",style:{color:Lt[m%Lt.length]},children:[(p.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right ${(p.abweichung_gesamt_prozent??0)>=0?"text-green-600":"text-red-600"}`,children:[(p.abweichung_gesamt_prozent??0)>=0?"+":"",((o=p.abweichung_gesamt_prozent)==null?void 0:o.toFixed(1))??"0","%"]}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(u,{ratio:p.performance_ratio_gesamt})}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:((b=p.spezifischer_ertrag_kwh_kwp)==null?void 0:b.toFixed(0))??"-"})]},p.investition_id)})})]})})]})]})}const pr={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"};function di(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState(null),[x,c]=l.useState([]),[g,u]=l.useState(!0);l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]);const{investitionen:d,loading:p}=zr(t);l.useEffect(()=>{if(!t)return;(async()=>{u(!0);try{const[W,V]=await Promise.all([er.getUebersicht(t),Vt.listAggregiert(t)]);i(W),c(V)}catch(W){console.error("Fehler beim Laden der Daten:",W)}finally{u(!1)}})()},[t]);const{pvSysteme:m,orphanModule:o}=l.useMemo(()=>{const S=[],W=[],V=d.filter(M=>M.typ==="wechselrichter"),oe=d.filter(M=>M.typ==="pv-module"),R=d.filter(M=>M.typ==="speicher");for(const M of V){const H=oe.filter(q=>q.parent_investition_id===M.id),re=R.filter(q=>q.parent_investition_id===M.id),me=H.reduce((q,$)=>q+($.leistung_kwp||0),0);S.push({wechselrichter:M,pvModule:H,speicher:re,gesamtKwp:me})}for(const M of oe)(!M.parent_investition_id||!V.find(H=>H.id===M.parent_investition_id))&&W.push(M);return{pvSysteme:S,orphanModule:W}},[d]),b=(a==null?void 0:a.anlagenleistung_kwp)||0,h=(a==null?void 0:a.pv_erzeugung_kwh)||0,y=(a==null?void 0:a.eigenverbrauch_kwh)||0,k=(a==null?void 0:a.einspeisung_kwh)||0,j=(a==null?void 0:a.spezifischer_ertrag_kwh_kwp)||0,w=(a==null?void 0:a.eigenverbrauch_quote_prozent)||0,v=(a==null?void 0:a.anzahl_monate)||0,N=a==null?void 0:a.zeitraum_von,f=a==null?void 0:a.zeitraum_bis,_=l.useMemo(()=>{if(x.length===0)return[];const S=new Map;for(const W of x){S.has(W.jahr)||S.set(W.jahr,{erzeugung:0,eigenverbrauch:0,einspeisung:0});const V=S.get(W.jahr);V.erzeugung+=W.pv_erzeugung_kwh||0,V.eigenverbrauch+=W.eigenverbrauch_kwh||0,V.einspeisung+=W.einspeisung_kwh||0}return[...S.entries()].sort((W,V)=>W[0]-V[0]).map(([W,V])=>({name:W.toString(),Erzeugung:Math.round(V.erzeugung),Eigenverbrauch:Math.round(V.eigenverbrauch),Einspeisung:Math.round(V.einspeisung)}))},[x]),I=l.useMemo(()=>h===0?[]:[{name:"Eigenverbrauch",value:y,color:pr.consumption},{name:"Einspeisung",value:k,color:pr.feedin}],[h,y,k]),C=s||p||g,P=h>0,A=m.length>0||o.length>0,z=_.length>1;return C?e.jsx(ve,{text:"Lade PV-Anlage..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),N&&f&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Gesamtlaufzeit: ",N," bis ",f," (",v," Monate)"]})]})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:S=>n(parseInt(S.target.value)),options:r.map(S=>({value:S.id.toString(),label:S.anlagenname}))})]}),o.length>0&&e.jsx(Q,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsxs("span",{children:[o.length," PV-Modul(e) ohne Wechselrichter-Zuordnung."]})]})}),!A&&e.jsx(Q,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen → Investitionen anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Me,{title:"Anlagenleistung",value:b>0?b.toFixed(1):"---",unit:"kWp",subtitle:`${m.length} WR, ${m.reduce((S,W)=>S+W.pvModule.length,0)+o.length} Module`,icon:ae,color:"yellow"}),e.jsx(Me,{title:"Gesamterzeugung",value:h>0?(h/1e3).toFixed(1):"---",unit:"MWh",subtitle:v>0?`${v} Monate Gesamtlaufzeit`:void 0,icon:ye,color:"green"}),e.jsx(Me,{title:"Spez. Ertrag",value:j>0?j.toFixed(0):"---",unit:"kWh/kWp",subtitle:"Durchschnitt Gesamtlaufzeit",icon:_e,color:"blue",formel:"Spez. Ertrag = Erzeugung ÷ Leistung",berechnung:`${F(h,0)} kWh ÷ ${F(b,1)} kWp`,ergebnis:`= ${F(j,0)} kWh/kWp`}),e.jsx(Me,{title:"Eigenverbrauch",value:w>0?w.toFixed(1):"---",unit:"%",subtitle:y>0?`${(y/1e3).toFixed(1)} MWh`:void 0,icon:ba,color:"purple"})]}),A&&e.jsxs(E,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsx("div",{className:"space-y-4",children:m.map(S=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:S.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[S.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[S.pvModule.map(W=>{var V;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(ae,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:W.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(V=W.leistung_kwp)==null?void 0:V.toFixed(1)," kWp",W.ausrichtung&&` • ${W.ausrichtung}`]})]},W.id)}),S.speicher.map(W=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(ye,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:W.bezeichnung})]},W.id))]})]},S.wechselrichter.id))})]}),P&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(E,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:z?"Jahresübersicht (Gesamtlaufzeit)":"Jahresübersicht"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:_,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name"}),e.jsx(ge,{unit:" kWh"}),e.jsx(ce,{formatter:S=>[`${S.toLocaleString()} kWh`]}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"Erzeugung",fill:pr.solar}),e.jsx(se,{dataKey:"Eigenverbrauch",fill:pr.consumption}),e.jsx(se,{dataKey:"Einspeisung",fill:pr.feedin})]})})})]}),e.jsxs(E,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:I,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:S,percent:W})=>`${S}: ${(W*100).toFixed(0)}%`,labelLine:!1,children:I.map((S,W)=>e.jsx(Ie,{fill:S.color},`cell-${W}`))}),e.jsx(ce,{formatter:S=>[`${S.toLocaleString()} kWh`]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(y/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(k/1e3).toFixed(1)," MWh"]})]})]})]})]}),!P&&A&&e.jsxs(E,{className:"text-center py-12",children:[e.jsx(ut,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]}),A&&P&&t&&e.jsx(li,{anlageId:t})]})}const Ts=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function ci(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);return l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{if(!t)return;(async()=>{c(!0),u(null);try{const p=await Te.getEAutoDashboard(t);i(p)}catch(p){u(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t]),s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:r.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),g&&e.jsx(Q,{type:"error",children:g}),x?e.jsx(ve,{text:"Lade E-Auto Daten..."}):a.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein E-Auto unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(oi,{dashboard:d},d.investition.id))]})}function oi({dashboard:r}){var g;const{investition:s,monatsdaten:t,zusammenfassung:n}=r,a=n,i=t.map(u=>({name:`${Ts[u.monat]} ${u.jahr.toString().slice(2)}`,km:u.verbrauch_daten.km_gefahren||0,verbrauch:u.verbrauch_daten.verbrauch_kwh||0,pv:u.verbrauch_daten.ladung_pv_kwh||0,netz:u.verbrauch_daten.ladung_netz_kwh||0,extern:u.verbrauch_daten.ladung_extern_kwh||0,v2h:u.verbrauch_daten.v2h_entladung_kwh||0})),x=[{name:"Heim: PV",value:a.ladung_pv_kwh||0},{name:"Heim: Netz",value:a.ladung_netz_kwh||0},{name:"Extern",value:a.ladung_extern_kwh||0}].filter(u=>u.value>0),c=[{name:"E-Auto (Strom)",value:a.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:a.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ae,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Gefahren",value:((g=a.gesamt_km)==null?void 0:g.toLocaleString("de-DE"))||"0",unit:"km",icon:Ae,color:"blue",formel:"Σ km gefahren",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(Me,{title:"Verbrauch",value:(a.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:ye,color:"yellow",formel:"Verbrauch = kWh ÷ km × 100",berechnung:`${(a.gesamt_verbrauch_kwh||0).toFixed(0)} kWh ÷ ${a.gesamt_km||0} km × 100`,ergebnis:`= ${(a.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(Me,{title:"PV-Anteil (Heim)",value:(a.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(a.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:et,color:"green",formel:"PV-Anteil = PV-Ladung ÷ Heimladung × 100",berechnung:`${(a.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(a.ladung_heim_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(a.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(Me,{title:"Ersparnis vs. Benzin",value:(a.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",subtitle:`+ Wallbox: ${(a.wallbox_ersparnis_euro||0).toFixed(0)} €`,icon:_e,color:"green",trend:(a.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten − Stromkosten",berechnung:`${(a.benzin_kosten_alternativ_euro||0).toFixed(0)} € − ${(a.strom_kosten_gesamt_euro||0).toFixed(0)} €`,ergebnis:`= ${(a.ersparnis_vs_benzin_euro||0).toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsxs(kt,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:u,percent:d})=>`${u}: ${(d*100).toFixed(0)}%`,children:[e.jsx(Ie,{fill:"#22c55e"})," ",e.jsx(Ie,{fill:"#f97316"})," ",e.jsx(Ie,{fill:"#ef4444"})," "]}),e.jsx(ce,{formatter:u=>`${u.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(a.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(a.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(a.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(a.ladung_extern_kwh||0).toFixed(0)," kWh (",(a.ladung_extern_euro||0).toFixed(2)," €)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:c,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{type:"number",tickFormatter:u=>`${u}€`}),e.jsx(ge,{type:"category",dataKey:"name",width:120}),e.jsx(ce,{formatter:u=>`${u.toFixed(2)} €`}),e.jsx(se,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(a.ersparnis_vs_benzin_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(se,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(se,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(se,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(a.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(a.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(a.v2h_ersparnis_euro||0).toFixed(2)," €"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(a.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:t.map(u=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Ts[u.monat]," ",u.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:u.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(u.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(u.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(u.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(u.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},u.id))})]})})]})]})}const Rs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function gi(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);return l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{if(!t)return;(async()=>{c(!0),u(null);try{const p=await Te.getWaermepumpeDashboard(t);i(p)}catch(p){u(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t]),s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:r.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),g&&e.jsx(Q,{type:"error",children:g}),x?e.jsx(ve,{text:"Lade Wärmepumpe Daten..."}):a.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ke,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wärmepumpe für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wärmepumpe unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(hi,{dashboard:d},d.investition.id))]})}function hi({dashboard:r}){const{investition:s,monatsdaten:t,zusammenfassung:n}=r,a=n,i=t.map(g=>({name:`${Rs[g.monat]} ${g.jahr.toString().slice(2)}`,strom:g.verbrauch_daten.stromverbrauch_kwh||0,heizung:g.verbrauch_daten.heizenergie_kwh||0,warmwasser:g.verbrauch_daten.warmwasser_kwh||0,cop:((g.verbrauch_daten.heizenergie_kwh||0)+(g.verbrauch_daten.warmwasser_kwh||0))/(g.verbrauch_daten.stromverbrauch_kwh||1)})),x=[{name:"Heizung",value:a.gesamt_heizenergie_kwh},{name:"Warmwasser",value:a.gesamt_warmwasser_kwh}],c=[{name:"Wärmepumpe",value:a.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/Öl",value:a.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ke,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Ø COP",value:a.durchschnitt_cop.toFixed(2),icon:Rt,color:"orange",formel:"COP = Wärme ÷ Strom",berechnung:`${a.gesamt_waerme_kwh.toFixed(0)} kWh ÷ ${a.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${a.durchschnitt_cop.toFixed(2)}`}),e.jsx(Me,{title:"Wärme erzeugt",value:(a.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:Ke,color:"red",formel:"Wärme = Heizung + Warmwasser",berechnung:`${a.gesamt_heizenergie_kwh.toFixed(0)} + ${a.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${a.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(Me,{title:"Strom verbraucht",value:(a.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:ye,color:"yellow",formel:"Σ Stromverbrauch WP",berechnung:`${a.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(a.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(Me,{title:"Ersparnis",value:a.ersparnis_euro.toFixed(0),unit:"€",icon:_e,color:"green",trend:a.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/Öl-Kosten − WP-Kosten",berechnung:`${a.alte_heizung_kosten_euro.toFixed(0)} € − ${a.wp_kosten_euro.toFixed(0)} €`,ergebnis:`= ${a.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsxs(kt,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:g,percent:u})=>`${g}: ${(u*100).toFixed(0)}%`,children:[e.jsx(Ie,{fill:"#ef4444"}),e.jsx(Ie,{fill:"#3b82f6"})]}),e.jsx(ce,{formatter:g=>`${g.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",a.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",a.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/Öl"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:c,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{type:"number",tickFormatter:g=>`${g}€`}),e.jsx(ge,{type:"category",dataKey:"name",width:100}),e.jsx(ce,{formatter:g=>`${g.toFixed(2)} €`}),e.jsx(se,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",a.ersparnis_euro.toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(ct,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(ct,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{domain:[0,6]}),e.jsx(ce,{formatter:g=>g.toFixed(2)}),e.jsx(se,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(et,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis gegenüber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:t.map(g=>{const u=g.verbrauch_daten.stromverbrauch_kwh||0,d=g.verbrauch_daten.heizenergie_kwh||0,p=g.verbrauch_daten.warmwasser_kwh||0,m=u>0?(d+p)/u:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Rs[g.monat]," ",g.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:u.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:d.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:p.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:m.toFixed(2)})]},g.id)})})]})})]})]})}const xi=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function mi(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);return l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{if(!t)return;(async()=>{c(!0),u(null);try{const p=await Te.getSpeicherDashboard(t);i(p)}catch(p){u(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t]),s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:r.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),g&&e.jsx(Q,{type:"error",children:g}),x?e.jsx(ve,{text:"Lade Speicher Daten..."}):a.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ze,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge einen Speicher unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(ui,{dashboard:d},d.investition.id))]})}function ui({dashboard:r}){var x;const{investition:s,monatsdaten:t,zusammenfassung:n}=r,a=n,i=t.map(c=>{const g=c.verbrauch_daten.ladung_kwh||0,u=c.verbrauch_daten.entladung_kwh||0,d=c.verbrauch_daten.speicher_ladung_netz_kwh||0;return{name:`${xi[c.monat]} ${c.jahr.toString().slice(2)}`,ladung:g,entladung:u,arbitrage:d,pvLadung:g-d,zyklen:a.kapazitaet_kwh>0?g/a.kapazitaet_kwh:0,effizienz:g>0?u/g*100:0}});return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.kapazitaet_kwh," kWh Kapazität • ",a.anzahl_monate," Monate Daten"]})]}),e.jsx(ze,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Vollzyklen",value:a.vollzyklen.toFixed(0),icon:zn,color:"blue",formel:"Vollzyklen = Ladung ÷ Kapazität",berechnung:`${a.gesamt_ladung_kwh.toFixed(0)} kWh ÷ ${a.kapazitaet_kwh} kWh`,ergebnis:`= ${a.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(Me,{title:"Effizienz",value:a.effizienz_prozent.toFixed(1),unit:"%",icon:ba,color:"green",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh ÷ ${a.gesamt_ladung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${a.effizienz_prozent.toFixed(1)} %`}),e.jsx(Me,{title:"Durchsatz",value:(a.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:ye,color:"yellow",formel:"Durchsatz = Σ Entladung",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(a.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(Me,{title:"Ersparnis",value:a.ersparnis_euro.toFixed(0),unit:"€",icon:_e,color:"green",trend:a.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${a.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[a.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:a.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(a.gesamt_ladung_kwh-a.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),a.arbitrage_faehig&&a.arbitrage_kwh>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(jn,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h3",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Arbitrage (Netzladung)"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Netzladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[a.arbitrage_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Ø Ladepreis"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[((x=a.arbitrage_avg_preis_cent)==null?void 0:x.toFixed(1))||"-"," ct/kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Anteil an Ladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(a.arbitrage_kwh/a.gesamt_ladung_kwh*100).toFixed(0)," %"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Arbitrage-Gewinn"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:["+",a.arbitrage_gewinn_euro.toFixed(0)," €"]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),a.arbitrage_faehig&&a.arbitrage_kwh>0?e.jsxs(e.Fragment,{children:[e.jsx(se,{dataKey:"pvLadung",stackId:"ladung",fill:"#3b82f6",name:"PV-Ladung"}),e.jsx(se,{dataKey:"arbitrage",stackId:"ladung",fill:"#f59e0b",name:"Netz-Ladung"})]}):e.jsx(se,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(se,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{formatter:c=>c.toFixed(1)}),e.jsx(ct,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{domain:[80,100]}),e.jsx(ce,{formatter:c=>`${c.toFixed(1)}%`}),e.jsx(Be,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((c,g)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:c.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:c.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:c.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:c.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[c.effizienz.toFixed(1),"%"]})]},g))})]})})]})]})}function pi(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);return l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{if(!t)return;(async()=>{c(!0),u(null);try{const p=await Te.getWallboxDashboard(t);i(p)}catch(p){u(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t]),s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pt,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:r.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),g&&e.jsx(Q,{type:"error",children:g}),x?e.jsx(ve,{text:"Lade Wallbox Daten..."}):a.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(pt,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wallbox unter "Einstellungen → Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(bi,{dashboard:d},d.investition.id))]})}function bi({dashboard:r}){const{investition:s,zusammenfassung:t}=r,n=t,a=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.extern_ladung_kwh||0}].filter(g=>g.value>0),i=[{name:"Heimladung (tatsächlich)",value:n.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:n.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],x=n.leistung_kw||11,c=(n.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[x," kW Ladeleistung • ",n.anzahl_monate||0," Monate Daten"]})]}),e.jsx(pt,{className:"h-10 w-10 text-purple-500"})]}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Heimladung",value:((n.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:Ze,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} + ${(n.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(Me,{title:"PV-Anteil",value:(n.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:et,color:"green",formel:"PV-Anteil = PV ÷ Heimladung × 100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(n.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(Me,{title:"Ersparnis vs. Extern",value:(n.ersparnis_vs_extern_euro||0).toFixed(0),unit:"€",subtitle:"Wallbox-ROI",icon:_e,color:"green",trend:(n.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten − Heim-Kosten",berechnung:`${(n.heim_als_extern_kosten_euro||0).toFixed(0)} € − ${(n.heim_kosten_euro||0).toFixed(0)} €`,ergebnis:`= ${(n.ersparnis_vs_extern_euro||0).toFixed(2)} €`}),e.jsx(Me,{title:"Ladevorgänge",value:(n.gesamt_ladevorgaenge||0).toString(),subtitle:`Ø ${(n.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:ye,color:"blue",formel:"Σ Ladevorgänge",berechnung:`${n.anzahl_monate||0} Monate`,ergebnis:`= ${n.gesamt_ladevorgaenge||0} Vorgänge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsxs(kt,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:g,percent:u})=>`${g}: ${(u*100).toFixed(0)}%`,children:[e.jsx(Ie,{fill:"#22c55e"})," ",e.jsx(Ie,{fill:"#f97316"})," ",e.jsx(Ie,{fill:"#ef4444"})," "]}),e.jsx(ce,{formatter:g=>`${g.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(n.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"h-4 w-4 text-red-500"}),"Extern: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{type:"number",tickFormatter:g=>`${g}€`}),e.jsx(ge,{type:"category",dataKey:"name",width:150}),e.jsx(ce,{formatter:g=>`${g.toFixed(2)} €`}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(n.ersparnis_vs_extern_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklärt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(n.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(n.ladung_netz_kwh||0).toFixed(0)," kWh = ",(n.heim_kosten_euro||0).toFixed(2)," €)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(n.extern_preis_kwh_euro||.5).toFixed(2)," €/kWh"]})]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatsächliche externe Ladung: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh für ",(n.extern_kosten_euro||0).toFixed(2)," €"]})]}),s.anschaffungskosten_gesamt&&s.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.anzahl_monate&&n.anzahl_monate>0?((n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12).toFixed(0):0," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const g=n.anzahl_monate&&n.anzahl_monate>0?(n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12:0;return g<=0?"∞":`${(s.anschaffungskosten_gesamt/g).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen → Monatsdaten".'})})]})}const ji=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function yi(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);return l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{if(!t)return;(async()=>{c(!0),u(null);try{const p=await Te.getBalkonkraftwerkDashboard(t);i(p)}catch(p){u(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t]),s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:r.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),g&&e.jsx(Q,{type:"error",children:g}),x?e.jsx(ve,{text:"Lade Balkonkraftwerk Daten..."}):a.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(ki,{dashboard:d},d.investition.id))]})}function ki({dashboard:r}){const{investition:s,monatsdaten:t,zusammenfassung:n}=r,a=n,i=t.map(g=>({name:`${ji[g.monat]} ${g.jahr.toString().slice(2)}`,erzeugung:g.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:g.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:g.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:g.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:g.verbrauch_daten.speicher_entladung_kwh||0})),x=[{name:"Eigenverbrauch",value:a.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:a.gesamt_einspeisung_kwh}],c=["#22c55e","#f59e0b"];return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.leistung_wp," Wp • ",a.anzahl_module," Module • ",a.anzahl_monate," Monate Daten",a.hat_speicher&&` • ${a.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(ae,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Erzeugung",value:a.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:ye,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${a.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(Me,{title:"Eigenverbrauch",value:a.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:Ze,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh ÷ ${a.gesamt_erzeugung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${a.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(Me,{title:"Ersparnis",value:a.gesamt_ersparnis_euro.toFixed(0),unit:"€",icon:_e,color:"green",trend:a.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${a.gesamt_ersparnis_euro.toFixed(2)} €`}),e.jsx(Me,{title:"CO₂ gespart",value:a.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:et,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × 0.4`,ergebnis:`= ${a.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[a.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["Einspeisung",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(unvergütet)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[a.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Entgangener Erlös",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(8 ct/kWh)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-500 dark:text-gray-400",children:[(a.gesamt_einspeisung_kwh*.08).toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:g,percent:u})=>`${g}: ${(u*100).toFixed(0)}%`,children:x.map((g,u)=>e.jsx(Ie,{fill:c[u%c.length]},`cell-${u}`))}),e.jsx(ce,{formatter:g=>`${g.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",a.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",a.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(ct,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(ct,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),a.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ze,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",a.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(se,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(et,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),a.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:i.map((g,u)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:g.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:g.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:g.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:g.einspeisung.toFixed(1)}),a.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:g.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:g.speicher_entladung.toFixed(1)})]})]},u))})]})})]})]})}const Ss=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Es={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function fi(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);return l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{if(!t)return;(async()=>{c(!0),u(null);try{const p=await Te.getSonstigesDashboard(t);i(p)}catch(p){u(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t]),s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Zr,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:r.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),g&&e.jsx(Q,{type:"error",children:g}),x?e.jsx(ve,{text:"Lade Daten..."}):a.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Zr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):a.map(d=>e.jsx(wi,{dashboard:d},d.investition.id))]})}function wi({dashboard:r}){const{investition:s,monatsdaten:t,zusammenfassung:n}=r,a=n,i=a.kategorie;return i==="erzeuger"?e.jsx(Ni,{investition:s,monatsdaten:t,zusammenfassung:a}):i==="verbraucher"?e.jsx(vi,{investition:s,monatsdaten:t,zusammenfassung:a}):e.jsx(_i,{investition:s,monatsdaten:t,zusammenfassung:a})}function Ni({investition:r,monatsdaten:s,zusammenfassung:t}){const n=s.map(i=>({name:`${Ss[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0})),a=[{name:"Eigenverbrauch",value:t.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:t.gesamt_einspeisung_kwh||0}];return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:Es[t.kategorie]})]}),t.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.anzahl_monate," Monate Daten"]})]}),e.jsx(ye,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Erzeugung",value:(t.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:ye,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${t.anzahl_monate} Monate`,ergebnis:`= ${(t.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(Me,{title:"Eigenverbrauch",value:(t.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:Ze,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${(t.gesamt_eigenverbrauch_kwh||0).toFixed(0)} ÷ ${(t.gesamt_erzeugung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(t.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(Me,{title:"Ersparnis",value:(t.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",icon:_e,color:"green",trend:(t.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${(t.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(t.gesamt_ersparnis_euro||0).toFixed(2)} €`}),e.jsx(Me,{title:"CO₂ gespart",value:(t.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:et,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${(t.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × 0.4`,ergebnis:`= ${(t.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),t.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ge,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[t.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsxs(kt,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:x})=>`${i}: ${(x*100).toFixed(0)}%`,children:[e.jsx(Ie,{fill:"#22c55e"}),e.jsx(Ie,{fill:"#f59e0b"})]}),e.jsx(ce,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:n,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(ct,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(ct,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:n.map((i,x)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)})]},x))})]})})]})]})}function vi({investition:r,monatsdaten:s,zusammenfassung:t}){const n=s.map(i=>({name:`${Ss[i.monat]} ${i.jahr.toString().slice(2)}`,verbrauch:i.verbrauch_daten.verbrauch_kwh||0,bezug_pv:i.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:i.verbrauch_daten.bezug_netz_kwh||0})),a=[{name:"PV-Strom",value:t.bezug_pv_kwh||0},{name:"Netzstrom",value:t.bezug_netz_kwh||0}];return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:Es[t.kategorie]})]}),t.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.anzahl_monate," Monate Daten"]})]}),e.jsx(ye,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Verbrauch",value:(t.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:ye,color:"blue",formel:"Σ Verbrauch alle Monate",berechnung:`${t.anzahl_monate} Monate`,ergebnis:`= ${(t.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(Me,{title:"PV-Anteil",value:(t.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:Ze,color:"green",formel:"PV-Anteil = PV-Bezug ÷ Verbrauch × 100",berechnung:`${(t.bezug_pv_kwh||0).toFixed(0)} ÷ ${(t.gesamt_verbrauch_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(t.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(Me,{title:"Netzkosten",value:(t.kosten_netz_euro||0).toFixed(0),unit:"€",icon:_e,color:"red",formel:"Netzkosten = Netzbezug × Strompreis",berechnung:`${(t.bezug_netz_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(t.kosten_netz_euro||0).toFixed(2)} €`}),e.jsx(Me,{title:"PV-Ersparnis",value:(t.ersparnis_pv_euro||0).toFixed(0),unit:"€",icon:et,color:"green",trend:(t.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug × Strompreis",berechnung:`${(t.bezug_pv_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(t.ersparnis_pv_euro||0).toFixed(2)} €`})]}),t.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ge,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[t.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsxs(kt,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:x})=>`${i}: ${(x*100).toFixed(0)}%`,children:[e.jsx(Ie,{fill:"#22c55e"}),e.jsx(Ie,{fill:"#ef4444"})]}),e.jsx(ce,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:n,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(se,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:n.map((i,x)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:i.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:i.bezug_netz.toFixed(1)})]},x))})]})})]})]})}function _i({investition:r,monatsdaten:s,zusammenfassung:t}){const n=s.map(a=>({name:`${Ss[a.monat]} ${a.jahr.toString().slice(2)}`,ladung:a.verbrauch_daten.ladung_kwh||0,entladung:a.verbrauch_daten.entladung_kwh||0}));return e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:Es[t.kategorie]})]}),t.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.anzahl_monate," Monate Daten"]})]}),e.jsx(ze,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Me,{title:"Ladung",value:(t.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:ze,color:"purple",formel:"Σ Ladung alle Monate",berechnung:`${t.anzahl_monate} Monate`,ergebnis:`= ${(t.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(Me,{title:"Entladung",value:(t.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:ye,color:"green",formel:"Σ Entladung alle Monate",berechnung:`${t.anzahl_monate} Monate`,ergebnis:`= ${(t.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(Me,{title:"Effizienz",value:(t.effizienz_prozent||0).toFixed(1),unit:"%",icon:_e,color:"blue",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${(t.gesamt_entladung_kwh||0).toFixed(0)} ÷ ${(t.gesamt_ladung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(t.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(Me,{title:"Ersparnis",value:(t.ersparnis_euro||0).toFixed(0),unit:"€",icon:_e,color:"green",trend:(t.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${(t.gesamt_entladung_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(t.ersparnis_euro||0).toFixed(2)} €`})]}),t.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ge,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[t.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:n,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{}),e.jsx(ce,{}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(se,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:n.map((a,i)=>{const x=a.ladung>0?a.entladung/a.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:a.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:a.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:a.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[x.toFixed(1),"%"]})]},i)})})]})})]})]})}function zi(r,s){const t=URL.createObjectURL(r),n=document.createElement("a");n.href=t,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}function Sr(r,s,t){const n=r.join(";"),a=s.map(c=>c.map(g=>g==null||g===""?"":typeof g=="number"?g.toString().replace(".",","):typeof g=="string"&&(g.includes(";")||g.includes('"'))?`"${g.replace(/"/g,'""')}"`:String(g)).join(";")),i=[n,...a].join(`
`),x=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8"});zi(x,t)}function fe({title:r,value:s,unit:t,subtitle:n,icon:a,color:i,bgColor:x,formel:c,berechnung:g,ergebnis:u}){const d=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s," ",e.jsx("span",{className:"text-sm font-normal",children:t})]});return e.jsx(E,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),e.jsx("div",{className:"mt-1",children:c?e.jsx(It,{formel:c,berechnung:g,ergebnis:u,children:d}):d}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${x}`,children:e.jsx(a,{className:`h-6 w-6 ${i}`})})]})})}const Pa=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],wt={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},lt={erzeugung:"#f59e0b",eigenverbrauch:"#8b5cf6",einspeisung:"#10b981",netzbezug:"#ef4444",autarkie:"#3b82f6",evQuote:"#a855f7",spezErtrag:"#eab308",speicherLadung:"#22c55e",speicherEntladung:"#3b82f6",speicherEffizienz:"#06b6d4",wpWaerme:"#ef4444",wpStrom:"#8b5cf6",wpCop:"#f97316",emobPvAnteil:"#10b981"},Jt={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},br={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function Ws(r,s,t){return[...r].sort((a,i)=>a.jahr!==i.jahr?a.jahr-i.jahr:a.monat-i.monat).map(a=>{const i=a.pv_erzeugung_kwh||0,x=a.eigenverbrauch_kwh||0,c=a.gesamtverbrauch_kwh||x+a.netzbezug_kwh,g=a.direktverbrauch_kwh||0,u=a.autarkie_prozent??(c>0?x/c*100:0),d=a.eigenverbrauchsquote_prozent??(i>0?x/i*100:0),p=s!=null&&s.leistung_kwp?i/s.leistung_kwp:0,m=a.speicher_ladung_kwh||0,o=a.speicher_entladung_kwh||0,b=m>0?o/m*100:null,h=(a.wp_heizung_kwh||0)+(a.wp_warmwasser_kwh||0),y=a.wp_strom_kwh||0,k=y>0?h/y:null,j=a.eauto_km||0,w=a.eauto_ladung_kwh||0,v=null,N=t?a.einspeisung_kwh*t.einspeiseverguetung_cent_kwh/100:0,f=t?x*t.netzbezug_arbeitspreis_cent_kwh/100:0,_=t?a.netzbezug_kwh*t.netzbezug_arbeitspreis_cent_kwh/100:0,I=N+f,P=i*.38;return{name:`${Pa[a.monat]} ${a.jahr.toString().slice(-2)}`,jahr:a.jahr,monat:a.monat,erzeugung:i,eigenverbrauch:x,einspeisung:a.einspeisung_kwh,netzbezug:a.netzbezug_kwh,gesamtverbrauch:c,direktverbrauch:g,autarkie:u,evQuote:d,spezErtrag:p,speicher_ladung:m,speicher_entladung:o,speicher_effizienz:b,wp_waerme:h,wp_strom:y,wp_cop:k,eauto_km:j,eauto_ladung:w,eauto_pv_anteil:v,einspeise_erloes:N,ev_ersparnis:f,netzbezug_kosten:_,netto_ertrag:I,co2_einsparung:P}})}function Si({data:r,stats:s,anlage:t,strompreis:n,zeitraumLabel:a}){const i=l.useMemo(()=>Ws(r,t,n),[r,t,n]),x=()=>{const g=["Monat","Erzeugung (kWh)","Eigenverbrauch (kWh)","Einspeisung (kWh)","Netzbezug (kWh)","Autarkie (%)","EV-Quote (%)","Spez. Ertrag (kWh/kWp)"],u=i.map(d=>[d.name,d.erzeugung,d.eigenverbrauch,d.einspeisung,d.netzbezug,d.autarkie,d.evQuote,d.spezErtrag]);Sr(g,u,`energie_${(t==null?void 0:t.anlagenname)||"export"}.csv`)},c=l.useMemo(()=>{if(!n)return null;const g=s.gesamtEinspeisung*n.einspeiseverguetung_cent_kwh/100,u=s.gesamtEigenverbrauch*n.netzbezug_arbeitspreis_cent_kwh/100;return g+u},[s,n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","•"," ",s.anzahlMonate," Monate"]}),e.jsxs(le,{variant:"secondary",size:"sm",onClick:x,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"PV-Erzeugung",value:(s.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:ae,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${F(s.gesamtErzeugung,0)} kWh`,ergebnis:`= ${F(s.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(fe,{title:"Eigenverbrauch",value:s.gesamtErzeugung>0?(s.gesamtEigenverbrauch/s.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(s.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:ye,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${F(s.gesamtEigenverbrauch,0)} kWh ÷ ${F(s.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${F(s.gesamtEigenverbrauch/s.gesamtErzeugung*100,1)} %`}),e.jsx(fe,{title:"Autarkie",value:s.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:_e,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${F(s.durchschnittAutarkie,1)} %`}),e.jsx(fe,{title:"Spez. Ertrag",value:t!=null&&t.leistung_kwp?(s.gesamtErzeugung/t.leistung_kwp).toFixed(0):"---",unit:"kWh/kWp",subtitle:t!=null&&t.leistung_kwp?`${t.leistung_kwp} kWp`:void 0,icon:ae,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"PV-Erzeugung ÷ Anlagenleistung",berechnung:t!=null&&t.leistung_kwp?`${F(s.gesamtErzeugung,0)} kWh ÷ ${t.leistung_kwp} kWp`:void 0,ergebnis:t!=null&&t.leistung_kwp?`= ${F(s.gesamtErzeugung/t.leistung_kwp,0)} kWh/kWp`:void 0})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-blue-500"}),"Energie-Bilanz pro Monat"]}),e.jsx("div",{className:"h-80",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{tickFormatter:g=>`${g.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ce,{formatter:(g,u)=>[`${g.toFixed(0)} kWh`,u],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"eigenverbrauch",name:"Eigenverbrauch",fill:lt.eigenverbrauch,stackId:"pv"}),e.jsx(se,{dataKey:"einspeisung",name:"Einspeisung",fill:lt.einspeisung,stackId:"pv"}),e.jsx(se,{dataKey:"netzbezug",name:"Netzbezug",fill:lt.netzbezug})]})})})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-green-500"}),"Effizienz-Trends"]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{yAxisId:"left",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ge,{yAxisId:"right",orientation:"right",tickFormatter:g=>`${g.toFixed(0)}`,unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(ce,{formatter:(g,u)=>u.includes("kWh/kWp")?[`${g.toFixed(0)} kWh/kWp`,u]:[`${g.toFixed(1)}%`,u],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),e.jsx(Be,{yAxisId:"left",type:"monotone",dataKey:"autarkie",name:"Autarkie (%)",stroke:lt.autarkie,strokeWidth:2,dot:!1}),e.jsx(Be,{yAxisId:"left",type:"monotone",dataKey:"evQuote",name:"EV-Quote (%)",stroke:lt.evQuote,strokeWidth:2,dot:!1}),e.jsx(se,{yAxisId:"right",dataKey:"spezErtrag",name:"Spez. Ertrag (kWh/kWp)",fill:lt.spezErtrag,opacity:.7})]})})})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-yellow-500"}),"PV-Erzeugung Verlauf"]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ce,{formatter:g=>[`${g.toFixed(0)} kWh`,"Erzeugung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Be,{type:"monotone",dataKey:"erzeugung",name:"PV-Erzeugung",stroke:lt.erzeugung,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[s.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(t==null?void 0:t.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Netto-Ertrag"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:c?`${c.toFixed(0)} €`:"---"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(s.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function Ei({anlage:r,strompreis:s,selectedYear:t,zeitraumLabel:n}){var j,w,v;const[a,i]=l.useState(null),[x,c]=l.useState(!0),[g,u]=l.useState(null);l.useEffect(()=>{if(!(r!=null&&r.id))return;(async()=>{c(!0),u(null);try{const f=t&&t!=="all"?t:void 0,_=await er.getKomponentenZeitreihe(r.id,f);i(_)}catch(f){u("Fehler beim Laden der Komponentendaten"),console.error(f)}finally{c(!1)}})()},[r==null?void 0:r.id,t]);const d=l.useMemo(()=>a!=null&&a.monatswerte?a.monatswerte.map(N=>({...N,name:`${Pa[N.monat]} ${N.jahr.toString().slice(-2)}`})):[],[a]),p=l.useMemo(()=>{if(!d.length)return{ladung:0,entladung:0,effizienz:null,arbitrage:0};const N=d.reduce((I,C)=>I+C.speicher_ladung_kwh,0),f=d.reduce((I,C)=>I+C.speicher_entladung_kwh,0),_=d.reduce((I,C)=>I+C.speicher_arbitrage_kwh,0);return{ladung:N,entladung:f,effizienz:N>0?f/N*100:null,arbitrage:_}},[d]),m=l.useMemo(()=>{if(!d.length)return{waerme:0,strom:0,cop:null,heizung:0,warmwasser:0};const N=d.reduce((C,P)=>C+P.wp_waerme_kwh,0),f=d.reduce((C,P)=>C+P.wp_strom_kwh,0),_=d.reduce((C,P)=>C+P.wp_heizung_kwh,0),I=d.reduce((C,P)=>C+P.wp_warmwasser_kwh,0);return{waerme:N,strom:f,cop:f>0?N/f:null,heizung:_,warmwasser:I}},[d]),o=l.useMemo(()=>{if(!d.length)return{km:0,ladung:0,pvAnteil:null,pvLadung:0,netzLadung:0,externLadung:0,externEuro:0,v2h:0};const N=d.reduce((S,W)=>S+W.emob_km,0),f=d.reduce((S,W)=>S+W.emob_ladung_kwh,0),_=d.reduce((S,W)=>S+W.emob_ladung_pv_kwh,0),I=d.reduce((S,W)=>S+W.emob_ladung_netz_kwh,0),C=d.reduce((S,W)=>S+W.emob_ladung_extern_kwh,0),P=d.reduce((S,W)=>S+W.emob_ladung_extern_euro,0),A=d.reduce((S,W)=>S+W.emob_v2h_kwh,0),z=f>0?_/f*100:null;return{km:N,ladung:f,pvAnteil:z,pvLadung:_,netzLadung:I,externLadung:C,externEuro:P,v2h:A}},[d]),b=l.useMemo(()=>d.length?{erzeugung:d.reduce((N,f)=>N+f.bkw_erzeugung_kwh,0),eigenverbrauch:d.reduce((N,f)=>N+f.bkw_eigenverbrauch_kwh,0),speicherLadung:d.reduce((N,f)=>N+f.bkw_speicher_ladung_kwh,0),speicherEntladung:d.reduce((N,f)=>N+f.bkw_speicher_entladung_kwh,0)}:{erzeugung:0,eigenverbrauch:0,speicherLadung:0,speicherEntladung:0},[d]),h=l.useMemo(()=>d.length?{erzeugung:d.reduce((N,f)=>N+f.sonstiges_erzeugung_kwh,0),verbrauch:d.reduce((N,f)=>N+f.sonstiges_verbrauch_kwh,0)}:{erzeugung:0,verbrauch:0},[d]);l.useMemo(()=>d.length?d.reduce((N,f)=>N+f.sonderkosten_euro,0):0,[d]);const y=()=>{if(!d.length)return;const N=["Monat"];a!=null&&a.hat_speicher&&N.push("Speicher Ladung (kWh)","Speicher Entladung (kWh)","Speicher Effizienz (%)"),a!=null&&a.hat_waermepumpe&&N.push("WP Wärme (kWh)","WP Strom (kWh)","WP COP"),a!=null&&a.hat_emobilitaet&&N.push("E-Auto km","E-Auto Ladung (kWh)","E-Auto PV-Anteil (%)"),a!=null&&a.hat_balkonkraftwerk&&N.push("BKW Erzeugung (kWh)","BKW Eigenverbrauch (kWh)"),a!=null&&a.hat_sonstiges&&N.push("Sonstiges Erzeugung (kWh)","Sonstiges Verbrauch (kWh)");const f=d.map(_=>{const I=[_.name];return a!=null&&a.hat_speicher&&I.push(_.speicher_ladung_kwh,_.speicher_entladung_kwh,_.speicher_effizienz_prozent??""),a!=null&&a.hat_waermepumpe&&I.push(_.wp_waerme_kwh,_.wp_strom_kwh,_.wp_cop??""),a!=null&&a.hat_emobilitaet&&I.push(_.emob_km,_.emob_ladung_kwh,_.emob_pv_anteil_prozent??""),a!=null&&a.hat_balkonkraftwerk&&I.push(_.bkw_erzeugung_kwh,_.bkw_eigenverbrauch_kwh),a!=null&&a.hat_sonstiges&&I.push(_.sonstiges_erzeugung_kwh,_.sonstiges_verbrauch_kwh),I});Sr(N,f,`komponenten_${(r==null?void 0:r.anlagenname)||"export"}.csv`)};return x?e.jsxs(E,{className:"text-center py-12",children:[e.jsx(Wt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Komponentendaten..."})]}):g?e.jsxs(E,{className:"text-center py-12",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:g})]}):a&&(a.hat_speicher||a.hat_waermepumpe||a.hat_emobilitaet||a.hat_balkonkraftwerk||a.hat_sonstiges)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","•"," ",(a==null?void 0:a.anzahl_monate)||0," Monate"]}),e.jsxs(le,{variant:"secondary",size:"sm",onClick:y,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),(a==null?void 0:a.hat_speicher)&&p.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ze,{className:"h-6 w-6 text-green-500"}),"Speicher",a.hat_arbitrage&&e.jsx("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded",children:"Arbitrage"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Ladung gesamt",value:(p.ladung/1e3).toFixed(2),unit:"MWh",icon:ze,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung aller Monate",berechnung:`${F(p.ladung,0)} kWh`,ergebnis:`= ${F(p.ladung/1e3,2)} MWh`}),e.jsx(fe,{title:"Entladung gesamt",value:(p.entladung/1e3).toFixed(2),unit:"MWh",icon:ze,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung aller Monate",berechnung:`${F(p.entladung,0)} kWh`,ergebnis:`= ${F(p.entladung/1e3,2)} MWh`}),e.jsx(fe,{title:"Ø Effizienz",value:((j=p.effizienz)==null?void 0:j.toFixed(1))||"---",unit:"%",icon:ze,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${F(p.entladung,0)} kWh ÷ ${F(p.ladung,0)} kWh × 100`,ergebnis:p.effizienz?`= ${F(p.effizienz,1)}%`:"---"}),a.hat_arbitrage&&p.arbitrage>0?e.jsx(fe,{title:"Arbitrage",value:p.arbitrage.toFixed(0),unit:"kWh",subtitle:"Netzladung",icon:ze,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ Netzladung für Arbitrage"}):e.jsx(fe,{title:"Verlust",value:(p.ladung-p.entladung).toFixed(0),unit:"kWh",subtitle:p.effizienz?`${(100-p.effizienz).toFixed(1)}%`:void 0,icon:ze,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Speicher pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:d.filter(N=>N.speicher_ladung_kwh>0||N.speicher_entladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{yAxisId:"left",tickFormatter:N=>`${N.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ce,{formatter:(N,f)=>f.includes("Effizienz")?[`${(N==null?void 0:N.toFixed(1))||"---"}%`,f]:[`${N.toFixed(0)} kWh`,f],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),e.jsx(se,{yAxisId:"left",dataKey:"speicher_ladung_kwh",name:"Ladung",fill:lt.speicherLadung}),e.jsx(se,{yAxisId:"left",dataKey:"speicher_entladung_kwh",name:"Entladung",fill:lt.speicherEntladung}),a.hat_arbitrage&&e.jsx(se,{yAxisId:"left",dataKey:"speicher_arbitrage_kwh",name:"Arbitrage (Netz)",fill:"#8b5cf6"}),e.jsx(Be,{yAxisId:"right",type:"monotone",dataKey:"speicher_effizienz_prozent",name:"Effizienz (%)",stroke:lt.speicherEffizienz,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_waermepumpe)&&m.strom>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ke,{className:"h-6 w-6 text-red-500"}),"Wärmepumpe"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Wärme erzeugt",value:(m.waerme/1e3).toFixed(2),unit:"MWh",icon:Ke,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Wärme aller Monate",berechnung:`${F(m.waerme,0)} kWh`,ergebnis:`= ${F(m.waerme/1e3,2)} MWh`}),e.jsx(fe,{title:"Strom verbraucht",value:(m.strom/1e3).toFixed(2),unit:"MWh",icon:Ke,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Strom aller Monate",berechnung:`${F(m.strom,0)} kWh`,ergebnis:`= ${F(m.strom/1e3,2)} MWh`}),e.jsx(fe,{title:"Ø COP",value:((w=m.cop)==null?void 0:w.toFixed(2))||"---",unit:"",subtitle:"Jahresarbeitszahl",icon:Ke,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${F(m.waerme,0)} kWh ÷ ${F(m.strom,0)} kWh`,ergebnis:m.cop?`= ${F(m.cop,2)} COP`:"---"}),e.jsx(fe,{title:"Ersparnis vs. Gas",value:s?(m.waerme*.08-m.strom*s.netzbezug_arbeitspreis_cent_kwh/100).toFixed(0):"---",unit:"€",subtitle:"ca. 8 ct/kWh Gas",icon:Ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]}),(m.heizung>0||m.warmwasser>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Heizung",value:(m.heizung/1e3).toFixed(2),unit:"MWh",subtitle:m.waerme>0?`${(m.heizung/m.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:Ke,color:"text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizenergie aller Monate"}),e.jsx(fe,{title:"Warmwasser",value:(m.warmwasser/1e3).toFixed(2),unit:"MWh",subtitle:m.waerme>0?`${(m.warmwasser/m.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:Ke,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Warmwasser-Energie aller Monate"})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Wärmepumpe pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:d.filter(N=>N.wp_waerme_kwh>0||N.wp_strom_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{yAxisId:"left",tickFormatter:N=>`${N.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{yAxisId:"right",orientation:"right",domain:[0,"auto"],tick:{fontSize:11}}),e.jsx(ce,{formatter:(N,f)=>f==="COP"?[`${(N==null?void 0:N.toFixed(2))||"---"}`,f]:[`${N.toFixed(0)} kWh`,f],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),m.heizung>0||m.warmwasser>0?e.jsxs(e.Fragment,{children:[e.jsx(se,{yAxisId:"left",dataKey:"wp_heizung_kwh",name:"Heizung",stackId:"waerme",fill:"#f87171"}),e.jsx(se,{yAxisId:"left",dataKey:"wp_warmwasser_kwh",name:"Warmwasser",stackId:"waerme",fill:"#60a5fa"})]}):e.jsx(se,{yAxisId:"left",dataKey:"wp_waerme_kwh",name:"Wärme",fill:lt.wpWaerme}),e.jsx(se,{yAxisId:"left",dataKey:"wp_strom_kwh",name:"Strom",fill:lt.wpStrom}),e.jsx(Be,{yAxisId:"right",type:"monotone",dataKey:"wp_cop",name:"COP",stroke:lt.wpCop,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_emobilitaet)&&o.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ae,{className:"h-6 w-6 text-purple-500"}),"E-Mobilität",a.hat_v2h&&e.jsx("span",{className:"text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 px-2 py-0.5 rounded",children:"V2H"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Gefahrene km",value:(o.km/1e3).toFixed(1),unit:"Tkm",icon:Ae,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene km aller Monate",berechnung:`${F(o.km,0)} km`,ergebnis:`= ${F(o.km/1e3,1)} Tausend km`}),e.jsx(fe,{title:"Ladung gesamt",value:(o.ladung/1e3).toFixed(2),unit:"MWh",icon:Ae,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ E-Auto-Ladung aller Monate",berechnung:`${F(o.ladung,0)} kWh`,ergebnis:`= ${F(o.ladung/1e3,2)} MWh`}),e.jsx(fe,{title:"Ø PV-Anteil",value:((v=o.pvAnteil)==null?void 0:v.toFixed(0))||"---",unit:"%",icon:Ae,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Ladung ÷ Gesamtladung × 100",berechnung:`${F(o.pvLadung,0)} kWh ÷ ${F(o.ladung,0)} kWh × 100`,ergebnis:o.pvAnteil?`= ${F(o.pvAnteil,0)}%`:"---"}),e.jsx(fe,{title:"Verbrauch",value:o.km>0?(o.ladung/o.km*100).toFixed(1):"---",unit:"kWh/100km",icon:Ae,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Ladung ÷ km × 100",berechnung:`${F(o.ladung,0)} kWh ÷ ${F(o.km,0)} km × 100`,ergebnis:o.km>0?`= ${F(o.ladung/o.km*100,1)} kWh/100km`:"---"})]}),(o.pvLadung>0||o.netzLadung>0||o.externLadung>0||o.v2h>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"PV-Ladung",value:o.pvLadung.toFixed(0),unit:"kWh",subtitle:o.ladung>0?`${(o.pvLadung/o.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:ae,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ Ladung aus eigener PV"}),e.jsx(fe,{title:"Netz-Ladung",value:o.netzLadung.toFixed(0),unit:"kWh",subtitle:o.ladung>0?`${(o.netzLadung/o.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:ye,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Ladung aus Netzstrom"}),o.externLadung>0&&e.jsx(fe,{title:"Extern geladen",value:o.externLadung.toFixed(0),unit:"kWh",subtitle:o.externEuro>0?`${F(o.externEuro,2)} €`:void 0,icon:Ae,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Σ Ladung an öffentlichen Säulen"}),a.hat_v2h&&o.v2h>0&&e.jsx(fe,{title:"V2H Entladung",value:o.v2h.toFixed(0),unit:"kWh",subtitle:s?`≈ ${F(o.v2h*s.netzbezug_arbeitspreis_cent_kwh/100,0)} € Ersparnis`:void 0,icon:ze,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Σ Rückspeisung ins Haus (Vehicle-to-Home)"})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"E-Mobilität pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:d.filter(N=>N.emob_km>0||N.emob_ladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{yAxisId:"left",tick:{fontSize:11}}),e.jsx(ge,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ce,{formatter:(N,f)=>f.includes("PV-Anteil")?[`${(N==null?void 0:N.toFixed(0))||"---"}%`,f]:f.includes("km")?[`${N.toFixed(0)} km`,f]:f.includes("€")?[`${N.toFixed(2)} €`,f]:[`${N.toFixed(0)} kWh`,f],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),e.jsx(se,{yAxisId:"left",dataKey:"emob_ladung_pv_kwh",name:"PV-Ladung",stackId:"ladung",fill:"#f59e0b"}),e.jsx(se,{yAxisId:"left",dataKey:"emob_ladung_netz_kwh",name:"Netz-Ladung",stackId:"ladung",fill:"#ef4444"}),o.externLadung>0&&e.jsx(se,{yAxisId:"left",dataKey:"emob_ladung_extern_kwh",name:"Extern",stackId:"ladung",fill:"#f97316"}),a.hat_v2h&&e.jsx(se,{yAxisId:"left",dataKey:"emob_v2h_kwh",name:"V2H",fill:"#06b6d4"}),e.jsx(Be,{yAxisId:"right",type:"monotone",dataKey:"emob_pv_anteil_prozent",name:"PV-Anteil (%)",stroke:lt.emobPvAnteil,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_balkonkraftwerk)&&b.erzeugung>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{className:"h-6 w-6 text-yellow-500"}),"Balkonkraftwerk",b.speicherLadung>0&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded",children:"mit Speicher"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Die BKW-Erzeugung ist in der PV-Gesamterzeugung enthalten, wird hier aber separat ausgewiesen."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Erzeugung gesamt",value:b.erzeugung.toFixed(0),unit:"kWh",icon:ae,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ BKW-Erzeugung aller Monate",berechnung:`${F(b.erzeugung,0)} kWh`,ergebnis:`= ${F(b.erzeugung,0)} kWh`}),e.jsx(fe,{title:"Eigenverbrauch",value:b.eigenverbrauch.toFixed(0),unit:"kWh",icon:ae,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Eigenverbrauch aller Monate",berechnung:`${F(b.eigenverbrauch,0)} kWh`,ergebnis:`= ${F(b.eigenverbrauch,0)} kWh`}),e.jsx(fe,{title:"EV-Quote",value:b.erzeugung>0?(b.eigenverbrauch/b.erzeugung*100).toFixed(0):"---",unit:"%",icon:ae,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${F(b.eigenverbrauch,0)} kWh ÷ ${F(b.erzeugung,0)} kWh × 100`,ergebnis:b.erzeugung>0?`= ${F(b.eigenverbrauch/b.erzeugung*100,0)}%`:"---"}),e.jsx(fe,{title:"Einspeisung",value:(b.erzeugung-b.eigenverbrauch).toFixed(0),unit:"kWh",subtitle:"geschätzt",icon:ae,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"})]}),b.speicherLadung>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Speicher Ladung",value:b.speicherLadung.toFixed(0),unit:"kWh",icon:ze,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Speicher Ladung"}),e.jsx(fe,{title:"Speicher Entladung",value:b.speicherEntladung.toFixed(0),unit:"kWh",icon:ze,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ BKW-Speicher Entladung"}),e.jsx(fe,{title:"Speicher Effizienz",value:b.speicherLadung>0?(b.speicherEntladung/b.speicherLadung*100).toFixed(0):"---",unit:"%",icon:ze,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100"})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Balkonkraftwerk pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:d.filter(N=>N.bkw_erzeugung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ce,{formatter:(N,f)=>[`${N.toFixed(0)} kWh`,f],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"bkw_erzeugung_kwh",name:"Erzeugung",fill:"#f59e0b"}),e.jsx(se,{dataKey:"bkw_eigenverbrauch_kwh",name:"Eigenverbrauch",fill:"#10b981"}),b.speicherLadung>0&&e.jsxs(e.Fragment,{children:[e.jsx(se,{dataKey:"bkw_speicher_ladung_kwh",name:"Speicher Ladung",fill:"#22c55e"}),e.jsx(se,{dataKey:"bkw_speicher_entladung_kwh",name:"Speicher Entladung",fill:"#3b82f6"})]})]})})})]})]}),(a==null?void 0:a.hat_sonstiges)&&(h.erzeugung>0||h.verbrauch>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ye,{className:"h-6 w-6 text-gray-500"}),"Sonstige Komponenten"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:'Aggregiert alle Investitionen vom Typ "Sonstiges" (z.B. Mini-BHKW, Pool-Pumpe).'})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[h.erzeugung>0&&e.jsx(fe,{title:"Erzeugung gesamt",value:h.erzeugung.toFixed(0),unit:"kWh",icon:ye,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"}),h.verbrauch>0&&e.jsx(fe,{title:"Verbrauch gesamt",value:h.verbrauch.toFixed(0),unit:"kWh",icon:ye,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20"}),h.erzeugung>0&&h.verbrauch>0&&e.jsx(fe,{title:"Netto",value:(h.erzeugung-h.verbrauch).toFixed(0),unit:"kWh",icon:ye,color:h.erzeugung-h.verbrauch>=0?"text-green-500":"text-red-500",bgColor:h.erzeugung-h.verbrauch>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Sonstige Komponenten pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:d.filter(N=>N.sonstiges_erzeugung_kwh>0||N.sonstiges_verbrauch_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ce,{formatter:(N,f)=>[`${N.toFixed(0)} kWh`,f],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),h.erzeugung>0&&e.jsx(se,{dataKey:"sonstiges_erzeugung_kwh",name:"Erzeugung",fill:"#10b981"}),h.verbrauch>0&&e.jsx(se,{dataKey:"sonstiges_verbrauch_kwh",name:"Verbrauch",fill:"#ef4444"})]})})})]})]}),a&&(a.hat_waermepumpe&&m.strom===0||a.hat_emobilitaet&&o.ladung===0||a.hat_balkonkraftwerk&&b.erzeugung===0||a.hat_sonstiges&&h.erzeugung===0&&h.verbrauch===0)&&e.jsx(E,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Komponenten ohne Monatsdaten"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Einige Investitionen sind angelegt, haben aber noch keine Monatsdaten. Erfasse monatliche Verbrauchsdaten unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"}),"."]})]})]})})]}):e.jsxs(E,{className:"text-center py-12",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Komponentendaten vorhanden"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:["Erfasse Daten für Speicher, Wärmepumpe, E-Auto, Balkonkraftwerk oder Sonstiges unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," und füge Monatsdaten hinzu."]})]})}function Wi({data:r,stats:s,strompreis:t,anlageId:n,zeitraumLabel:a}){const[i,x]=l.useState(null);if(l.useEffect(()=>{n&&er.getKomponentenZeitreihe(n).then(x).catch(console.error)},[n]),!t)return e.jsxs(E,{className:"text-center py-8",children:[e.jsx(St,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const c=l.useMemo(()=>Ws(r,void 0,t),[r,t]),g=l.useMemo(()=>{var o;const m=new Map;return(o=i==null?void 0:i.monatswerte)==null||o.forEach(b=>{const h=`${b.jahr}-${b.monat}`;m.set(h,b.sonderkosten_euro||0)}),m},[i]),u=l.useMemo(()=>{let m=0;return c.map(o=>{const b=g.get(`${o.jahr}-${o.monat}`)||0,h=o.netto_ertrag-b;return m+=h,{...o,sonderkosten:b,netto_nach_sonderkosten:h,kumuliert_ertrag:m}})},[c,g]),d=l.useMemo(()=>{const m=s.gesamtEinspeisung*t.einspeiseverguetung_cent_kwh/100,o=s.gesamtNetzbezug*t.netzbezug_arbeitspreis_cent_kwh/100,b=s.gesamtEigenverbrauch*t.netzbezug_arbeitspreis_cent_kwh/100,h=u.reduce((j,w)=>j+(w.sonderkosten||0),0),y=m+b,k=y-h;return{einspeiseErloes:m,netzbezugKosten:o,eigenverbrauchErsparnis:b,nettoErtrag:y,sonderkosten:h,nettoNachSonderkosten:k}},[s,t,u]),p=()=>{const m=["Monat","Einspeiseerlös (€)","EV-Ersparnis (€)","Netzbezug-Kosten (€)","Netto-Ertrag (€)","Sonderkosten (€)","Netto nach Sonderkosten (€)","Kumulierter Ertrag (€)"],o=u.map(b=>[b.name,b.einspeise_erloes,b.ev_ersparnis,b.netzbezug_kosten,b.netto_ertrag,b.sonderkosten,b.netto_nach_sonderkosten,b.kumuliert_ertrag]);Sr(m,o,"finanzen_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","•"," ",s.anzahlMonate," Monate"]}),e.jsxs(le,{variant:"secondary",size:"sm",onClick:p,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Einspeiseerlös",value:d.einspeiseErloes.toFixed(0),unit:"€",subtitle:`${t.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:_e,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Einspeisevergütung",berechnung:`${F(s.gesamtEinspeisung,0)} kWh × ${F(t.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${F(d.einspeiseErloes,2)} €`}),e.jsx(fe,{title:"EV-Ersparnis",value:d.eigenverbrauchErsparnis.toFixed(0),unit:"€",subtitle:"vermiedener Netzbezug",icon:St,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Netzbezugspreis",berechnung:`${F(s.gesamtEigenverbrauch,0)} kWh × ${F(t.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${F(d.eigenverbrauchErsparnis,2)} €`}),e.jsx(fe,{title:"Netzbezug-Kosten",value:d.netzbezugKosten.toFixed(0),unit:"€",subtitle:`${t.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:St,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug × Netzbezugspreis",berechnung:`${F(s.gesamtNetzbezug,0)} kWh × ${F(t.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${F(d.netzbezugKosten,2)} €`}),e.jsx(fe,{title:"Netto-Ertrag",value:d.nettoNachSonderkosten.toFixed(0),unit:"€",subtitle:d.sonderkosten>0?`nach ${d.sonderkosten.toFixed(0)} € Sonderkosten`:"Gesamt",icon:St,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:d.sonderkosten>0?"Einspeiseerlös + EV-Ersparnis − Sonderkosten":"Einspeiseerlös + EV-Ersparnis",berechnung:d.sonderkosten>0?`${F(d.einspeiseErloes,2)} € + ${F(d.eigenverbrauchErsparnis,2)} € − ${F(d.sonderkosten,2)} €`:`${F(d.einspeiseErloes,2)} € + ${F(d.eigenverbrauchErsparnis,2)} €`,ergebnis:`= ${F(d.nettoNachSonderkosten,2)} €`})]}),d.sonderkosten>0&&e.jsx(E,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Zr,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:["Sonderkosten im Zeitraum: ",d.sonderkosten.toFixed(2)," €"]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Reparaturen, Wartung und sonstige Kosten werden vom Netto-Ertrag abgezogen."})]})]})}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(St,{className:"h-5 w-5 text-green-500"}),"Finanzielle Bilanz pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:u,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" €",tick:{fontSize:11}}),e.jsx(ce,{formatter:(m,o)=>[`${m.toFixed(2)} €`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"einspeise_erloes",name:"Einspeiseerlös",fill:wt.feedin,stackId:"pos"}),e.jsx(se,{dataKey:"ev_ersparnis",name:"EV-Ersparnis",fill:wt.consumption,stackId:"pos"}),e.jsx(se,{dataKey:"netzbezug_kosten",name:"Netzbezug (negativ)",fill:wt.grid}),d.sonderkosten>0&&e.jsx(se,{dataKey:"sonderkosten",name:"Sonderkosten",fill:"#f59e0b"})]})})})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-blue-500"}),"Kumulierter Netto-Ertrag"]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:u,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" €",tick:{fontSize:11}}),e.jsx(ce,{formatter:m=>[`${m.toFixed(0)} €`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(ct,{type:"monotone",dataKey:"kumuliert_ertrag",name:"Kumulierter Ertrag",stroke:wt.feedin,fill:wt.feedin,fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",s.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[d.nettoNachSonderkosten.toFixed(0)," €"]}),d.sonderkosten>0&&e.jsxs("span",{className:"text-gray-400 text-xs",children:["(nach ",d.sonderkosten.toFixed(0)," € Sonderkosten)"]})]})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Netto-Ertrag pro Monat ",d.sonderkosten>0&&"(nach Sonderkosten)"]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:u,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" €",tick:{fontSize:11}}),e.jsx(ce,{formatter:(m,o)=>[`${m.toFixed(2)} €`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(se,{dataKey:"netto_nach_sonderkosten",name:"Netto-Ertrag",fill:wt.feedin,opacity:.7}),e.jsx(Be,{type:"monotone",dataKey:"netto_nach_sonderkosten",name:"Trend",stroke:wt.solar,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Durchschnittswerte"}),e.jsxs("div",{className:`grid grid-cols-2 gap-4 text-sm ${d.sonderkosten>0?"md:grid-cols-5":"md:grid-cols-4"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Einspeiseerlös/Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(d.einspeiseErloes/s.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø EV-Ersparnis/Monat"}),e.jsxs("p",{className:"font-medium text-purple-600",children:[(d.eigenverbrauchErsparnis/s.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netzbezug-Kosten/Monat"}),e.jsxs("p",{className:"font-medium text-red-600",children:[(d.netzbezugKosten/s.anzahlMonate).toFixed(0)," €"]})]}),d.sonderkosten>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Sonderkosten/Monat"}),e.jsxs("p",{className:"font-medium text-amber-600",children:[(d.sonderkosten/s.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netto-Ertrag/Monat"}),e.jsxs("p",{className:"font-medium text-blue-600",children:[(d.nettoNachSonderkosten/s.anzahlMonate).toFixed(0)," €"]})]})]})]})]})}const Cr=.38;function Mi({data:r,stats:s,zeitraumLabel:t}){const n=l.useMemo(()=>Ws(r),[r]),a=l.useMemo(()=>{let d=0;return n.map(p=>(d+=p.co2_einsparung,{...p,kumuliert_co2:d}))},[n]),i=s.gesamtErzeugung*Cr,x=i/12.5,c=i/.12,g=i/230,u=()=>{const d=["Monat","CO2-Einsparung (kg)","Kumuliert (kg)","Kumuliert (t)"],p=a.map(m=>[m.name,m.co2_einsparung,m.kumuliert_co2,m.kumuliert_co2/1e3]);Sr(d,p,"co2_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:t})," ","•"," ",s.anzahlMonate," Monate"]}),e.jsxs(le,{variant:"secondary",size:"sm",onClick:u,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"CO2 eingespart",value:(i/1e3).toFixed(2),unit:"t",subtitle:`${s.anzahlMonate} Monate`,icon:et,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung × CO2-Faktor",berechnung:`${F(s.gesamtErzeugung,0)} kWh × ${Cr*1e3} g/kWh`,ergebnis:`= ${F(i,0)} kg = ${F(i/1e3,2)} t`}),e.jsx(fe,{title:"Bäume äquivalent",value:x.toFixed(0),unit:"Bäume/Jahr",subtitle:"Bindungsleistung",icon:et,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung ÷ 12,5 kg/Baum/Jahr",berechnung:`${F(i,0)} kg ÷ 12,5 kg/Baum`,ergebnis:`= ${F(x,0)} Bäume`}),e.jsx(fe,{title:"Auto-km vermieden",value:(c/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:et,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung ÷ 120 g/km",berechnung:`${F(i*1e3,0)} g ÷ 120 g/km`,ergebnis:`= ${F(c,0)} km`}),e.jsx(fe,{title:"Kurzstreckenflüge",value:g.toFixed(1),unit:"Flüge",subtitle:"à 1000 km",icon:et,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"CO2-Einsparung ÷ 230 kg/Flug",berechnung:`${F(i,0)} kg ÷ 230 kg/Flug`,ergebnis:`= ${F(g,1)} Flüge vermieden`})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5 text-green-500"}),"CO2-Einsparung pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{unit:" kg",tick:{fontSize:11}}),e.jsx(ce,{formatter:d=>[`${d.toFixed(0)} kg CO2`,"Einsparung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(se,{dataKey:"co2_einsparung",name:"CO2 eingespart",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kumulierte CO2-Einsparung"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:a,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ge,{tickFormatter:d=>`${(d/1e3).toFixed(1)}`,unit:" t",tick:{fontSize:11}}),e.jsx(ce,{formatter:d=>[`${(d/1e3).toFixed(2)} t CO2`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(ct,{type:"monotone",dataKey:"kumuliert_co2",name:"Kumulierte Einsparung",stroke:"#10b981",fill:"#10b981",fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",s.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[(i/1e3).toFixed(2)," t CO2"]})]})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",e.jsxs("strong",{children:[Cr*1e3," g CO2/kWh"]})," berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/s.anzahlMonate).toFixed(0)," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro kWh"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(Cr*1e3).toFixed(0)," g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Jahr"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/s.anzahlMonate*12/1e3).toFixed(2)," t"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Hochgerechnet 20 Jahre"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/s.anzahlMonate*12*20/1e3).toFixed(1)," t"]})]})]})]})]})}function Fi({anlageId:r,strompreis:s,selectedYear:t="all"}){var y,k,j;const{investitionen:n,loading:a}=zr(r),[i,x]=l.useState(null),[c,g]=l.useState(!0),[u,d]=l.useState(new Set);l.useEffect(()=>{(async()=>{try{g(!0);const v=await Te.getROIDashboard(r,s==null?void 0:s.netzbezug_arbeitspreis_cent_kwh,s==null?void 0:s.einspeiseverguetung_cent_kwh,void 0,t);x(v)}catch(v){console.error("ROI-Dashboard Fehler:",v)}finally{g(!1)}})()},[r,s,t]);const p=l.useMemo(()=>{const w={};return n.forEach(v=>{w[v.typ]||(w[v.typ]=[]),w[v.typ].push(v)}),w},[n]),m=l.useMemo(()=>Object.entries(p).map(([w,v])=>({typ:w,label:br[w]||w,kosten:v.reduce((N,f)=>N+(f.anschaffungskosten_gesamt||0),0),color:Jt[w]||"#6b7280"})).filter(w=>w.kosten>0).sort((w,v)=>v.kosten-w.kosten),[p]),o=l.useMemo(()=>{if(!i||!i.gesamt_jahres_einsparung)return[];const w=i.gesamt_relevante_kosten,v=i.gesamt_jahres_einsparung,N=[];for(let f=0;f<=25;f++){const _=f*v;N.push({jahr:f,investition:w,ersparnis:_,bilanz:_-w})}return N},[i]);if(a||c)return e.jsx(ve,{text:"Lade Investitionsdaten..."});if(n.length===0)return e.jsxs(E,{className:"text-center py-8",children:[e.jsx(Qt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const b=(y=i==null?void 0:i.berechnungen.find(w=>w.investition_typ==="pv-module"))==null?void 0:y.detail_berechnung,h=b==null?void 0:b.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Gesamtinvestition",value:((i==null?void 0:i.gesamt_relevante_kosten)||0).toFixed(0),unit:"€",subtitle:`${n.length} Komponenten`,icon:Cn,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten − Alternativkosten",berechnung:i?`${F(i.gesamt_investition,0)} € − ${F(i.gesamt_investition-i.gesamt_relevante_kosten,0)} € Alternativ`:void 0,ergebnis:i?`= ${F(i.gesamt_relevante_kosten,0)} € relevante Kosten`:void 0}),e.jsx(fe,{title:"Jahresersparnis",value:((i==null?void 0:i.gesamt_jahres_einsparung)||0).toFixed(0),unit:"€/Jahr",icon:_e,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + Eigenverbrauch-Ersparnis",berechnung:b?`${F(b.einspeise_erloes_euro,2)} € + ${F(b.ev_ersparnis_euro,2)} €`:"Σ aller Investitions-Einsparungen",ergebnis:h||(i?`= ${F(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0)}),e.jsx(fe,{title:"ROI",value:((k=i==null?void 0:i.gesamt_roi_prozent)==null?void 0:k.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:_e,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis ÷ Relevante Kosten × 100",berechnung:i&&i.gesamt_relevante_kosten>0?`${F(i.gesamt_jahres_einsparung,0)} € ÷ ${F(i.gesamt_relevante_kosten,0)} € × 100`:void 0,ergebnis:i!=null&&i.gesamt_roi_prozent?`= ${i.gesamt_roi_prozent.toFixed(1)}% ROI p.a.`:void 0}),e.jsx(fe,{title:"Amortisation",value:((j=i==null?void 0:i.gesamt_amortisation_jahre)==null?void 0:j.toFixed(1))||"---",unit:"Jahre",icon:it,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten ÷ Jahresersparnis",berechnung:i&&i.gesamt_jahres_einsparung>0?`${F(i.gesamt_relevante_kosten,0)} € ÷ ${F(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:i!=null&&i.gesamt_amortisation_jahre?`= ${i.gesamt_amortisation_jahre.toFixed(1)} Jahre bis zur Kostendeckung`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:m,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:w,percent:v})=>`${w}: ${(v*100).toFixed(0)}%`,labelLine:!1,children:m.map((w,v)=>e.jsx(Ie,{fill:w.color},`cell-${v}`))}),e.jsx(ce,{formatter:w=>[`${w.toFixed(0)} €`,""]})]})})})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:m,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{type:"number",unit:" €",tick:{fontSize:11}}),e.jsx(ge,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(ce,{formatter:w=>[`${w.toFixed(0)} €`,""]}),e.jsx(se,{dataKey:"kosten",name:"Kosten",children:m.map((w,v)=>e.jsx(Ie,{fill:w.color},`cell-${v}`))})]})})})]})]}),o.length>0&&e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:o,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(ge,{unit:" €",tick:{fontSize:11}}),e.jsx(ce,{formatter:w=>[`${w.toFixed(0)} €`,""]}),e.jsx(Ee,{}),e.jsx(ct,{type:"monotone",dataKey:"investition",name:"Investition",stroke:wt.grid,fill:wt.grid,fillOpacity:.3}),e.jsx(ct,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:wt.feedin,fill:wt.feedin,fillOpacity:.3})]})})}),(i==null?void 0:i.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",i.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(i==null?void 0:i.berechnungen)&&i.berechnungen.length>0&&(()=>{const w=i.berechnungen.filter(f=>{var _;return f.investition_typ==="pv-module"&&typeof((_=f.detail_berechnung)==null?void 0:_.hinweis)=="string"&&f.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),v=i.berechnungen.filter(f=>{var _;return f.investition_typ==="wechselrichter"&&typeof((_=f.detail_berechnung)==null?void 0:_.hinweis)=="string"&&f.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),N=w.length>0||v.length>0;return e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),N&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollständig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[w.length>0&&e.jsxs("li",{children:[w.length," PV-Modul",w.length>1?"e":""," ohne Wechselrichter-Zuordnung → Bitte unter Einstellungen → Investitionen zuordnen"]}),v.length>0&&e.jsxs("li",{children:[v.length," Wechselrichter ohne PV-Module → Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.berechnungen.map(f=>{var M,H;const _=f.anschaffungskosten_alternativ>0,I=_?"Anschaffung − Alternativkosten":"Anschaffungskosten (keine Alternative)",C=_?`${F(f.anschaffungskosten,0)} € − ${F(f.anschaffungskosten_alternativ,0)} €`:`${F(f.anschaffungskosten,0)} €`,P=`= ${F(f.relevante_kosten,0)} € Mehrkosten`,z=(f.detail_berechnung||{}).hinweis,S=f.investition_typ==="pv-system"&&f.komponenten&&f.komponenten.length>0,W=u.has(f.investition_id),V=f.investition_typ==="pv-module"&&typeof z=="string"&&z.includes("ohne Wechselrichter"),oe=f.investition_typ==="wechselrichter"&&typeof z=="string"&&z.includes("ohne zugeordnete PV-Module"),R=()=>{d(re=>{const me=new Set(re);return me.has(f.investition_id)?me.delete(f.investition_id):me.add(f.investition_id),me})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${S?"cursor-pointer":""}`,onClick:S?R:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[S&&(W?e.jsx($t,{className:"h-4 w-4 text-gray-400"}):e.jsx(vt,{className:"h-4 w-4 text-gray-400"})),(V||oe)&&e.jsx("span",{title:V?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(rt,{className:"h-4 w-4 text-amber-500"})}),f.investition_bezeichnung,S&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",f.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Jt[f.investition_typ]||"#6b7280"}20`,color:Jt[f.investition_typ]||"#6b7280"},children:br[f.investition_typ]||f.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(It,{formel:I,berechnung:C,ergebnis:P,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[f.relevante_kosten.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(It,{formel:`Jahresersparnis ${br[f.investition_typ]||f.investition_typ}`,berechnung:z||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${F(f.jahres_einsparung,0)} €/Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[f.jahres_einsparung.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(It,{formel:"Ersparnis ÷ Mehrkosten × 100",berechnung:`${F(f.jahres_einsparung,0)} € ÷ ${F(f.relevante_kosten,0)} € × 100`,ergebnis:f.roi_prozent?`= ${f.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((M=f.roi_prozent)==null?void 0:M.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(It,{formel:"Mehrkosten ÷ Ersparnis",berechnung:`${F(f.relevante_kosten,0)} € ÷ ${F(f.jahres_einsparung,0)} €/Jahr`,ergebnis:f.amortisation_jahre?`= ${f.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((H=f.amortisation_jahre)==null?void 0:H.toFixed(1))||"---"," J."]})})})]},f.investition_id),S&&W&&f.komponenten.map(re=>{var me,q;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:Jt[re.typ]||"#6b7280"}}),re.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Jt[re.typ]||"#6b7280"}15`,color:Jt[re.typ]||"#6b7280"},children:br[re.typ]||re.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[re.relevante_kosten.toFixed(0)," €"]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:re.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[re.einsparung.toFixed(0)," €"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((me=re.detail)==null?void 0:me.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[re.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((q=re.detail)==null?void 0:q.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:re.detail.hinweis})]})]},`komp-${re.investition_id}`)})]})})})]})})]})})(),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(p).map(([w,v])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Jt[w]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:br[w]||w}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:v.map(N=>{var f;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:N.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((f=N.anschaffungskosten_gesamt)==null?void 0:f.toFixed(0))||"0"," €"]})]},N.id)})})]},w))})]})]})}const tr=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function Ai({anlageId:r,selectedYear:s,verfuegbareJahre:t,zeitraumLabel:n}){var h,y;const[a,i]=l.useState(null),[x,c]=l.useState(!0),[g,u]=l.useState(null),[d,p]=l.useState(new Map);l.useEffect(()=>{(async()=>{var j,w;c(!0),u(null);try{if(s==="all"){const v=new Map;for(const N of t)try{const f=await er.getPVStrings(r,N);v.set(N,f)}catch(f){console.error(`Fehler beim Laden Jahr ${N}:`,f)}if(p(v),v.size>0){const N=v.get(t[0]);if(N){const f=N.strings.map(A=>{let z=0,S=0;v.forEach(oe=>{const R=oe.strings.find(M=>M.investition_id===A.investition_id);R&&(z+=R.prognose_jahr_kwh,S+=R.ist_jahr_kwh)});const W=z>0?(S-z)/z*100:null,V=z>0?S/z:null;return{...A,prognose_jahr_kwh:z,ist_jahr_kwh:S,abweichung_jahr_prozent:W,abweichung_jahr_kwh:S-z,performance_ratio_jahr:V,spezifischer_ertrag_kwh_kwp:A.leistung_kwp>0?S/A.leistung_kwp:null,monatswerte:A.monatswerte.map((oe,R)=>{let M=0,H=0;return v.forEach(re=>{const me=re.strings.find(q=>q.investition_id===A.investition_id);me&&me.monatswerte[R]&&(M+=me.monatswerte[R].prognose_kwh,H+=me.monatswerte[R].ist_kwh)}),{...oe,prognose_kwh:M,ist_kwh:H}})}}),_=f.reduce((A,z)=>A+z.prognose_jahr_kwh,0),I=f.reduce((A,z)=>A+z.ist_jahr_kwh,0),C=[...f].filter(A=>A.performance_ratio_jahr!==null).sort((A,z)=>(z.performance_ratio_jahr||0)-(A.performance_ratio_jahr||0)),P={...N,strings:f,prognose_gesamt_kwh:_,ist_gesamt_kwh:I,abweichung_gesamt_kwh:I-_,abweichung_gesamt_prozent:_>0?(I-_)/_*100:null,bester_string:((j=C[0])==null?void 0:j.bezeichnung)||null,schlechtester_string:((w=C[C.length-1])==null?void 0:w.bezeichnung)||null};i(P)}}}else{const v=await er.getPVStrings(r,s);i(v)}}catch(v){u("Fehler beim Laden der String-Daten"),console.error(v)}finally{c(!1)}})()},[r,s,t]);const m=l.useMemo(()=>s!=="all"||d.size===0?[]:t.map(k=>{const j=d.get(k);if(!j)return null;const w={name:k.toString(),jahr:k};return j.strings.forEach(v=>{w[v.bezeichnung]=v.performance_ratio_jahr?Math.round(v.performance_ratio_jahr*100):0}),w.Gesamt=j.abweichung_gesamt_prozent?100+j.abweichung_gesamt_prozent:100,w}).filter(Boolean).reverse(),[s,d,t]),o=()=>{if(!a)return;const k=["String","kWp","Ausrichtung","SOLL (kWh)","IST (kWh)","Abweichung (%)","Performance Ratio","kWh/kWp"],j=a.strings.map(v=>[v.bezeichnung,v.leistung_kwp,v.ausrichtung||"-",v.prognose_jahr_kwh,v.ist_jahr_kwh,v.abweichung_jahr_prozent??"-",v.performance_ratio_jahr?(v.performance_ratio_jahr*100).toFixed(1)+"%":"-",v.spezifischer_ertrag_kwh_kwp??"-"]),w=s==="all"?"alle_jahre":s.toString();Sr(k,j,`pv_strings_${w}.csv`)};if(x)return e.jsx(ve,{text:"Lade PV-String Daten..."});if(g)return e.jsx(Q,{type:"error",children:g});if(!a||a.strings.length===0)return e.jsxs(E,{className:"text-center py-8",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen → Investitionen anlegen."})]});if(!a.hat_prognose)return e.jsx(Q,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen → PVGIS eine Prognose abrufen, um den SOLL-IST Vergleich zu nutzen."})]})});const b=[...a.strings].sort((k,j)=>(j.performance_ratio_jahr||0)-(k.performance_ratio_jahr||0));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","•"," ",a.strings.length," Strings • ",a.anlagen_leistung_kwp.toFixed(1)," kWp"]}),e.jsxs(le,{variant:"secondary",size:"sm",onClick:o,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"SOLL (Prognose)",value:(a.prognose_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:"PVGIS Jahresprognose",icon:ae,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ PVGIS-Prognose aller Strings",berechnung:a.strings.map(k=>`${k.bezeichnung}: ${k.prognose_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${F(a.prognose_gesamt_kwh,0)} kWh`}),e.jsx(fe,{title:"IST (Erzeugt)",value:(a.ist_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:n,icon:_e,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Σ Erzeugung aller Strings",berechnung:a.strings.map(k=>`${k.bezeichnung}: ${k.ist_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${F(a.ist_gesamt_kwh,0)} kWh`}),e.jsx(fe,{title:"Abweichung",value:`${(a.abweichung_gesamt_prozent||0)>=0?"+":""}${(a.abweichung_gesamt_prozent||0).toFixed(1)}`,unit:"%",subtitle:`${a.abweichung_gesamt_kwh>=0?"+":""}${a.abweichung_gesamt_kwh.toFixed(0)} kWh`,icon:(a.abweichung_gesamt_prozent||0)>=0?_e:jt,color:(a.abweichung_gesamt_prozent||0)>=0?"text-green-500":"text-red-500",bgColor:(a.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20",formel:"(IST - SOLL) ÷ SOLL × 100",berechnung:`(${F(a.ist_gesamt_kwh,0)} - ${F(a.prognose_gesamt_kwh,0)}) ÷ ${F(a.prognose_gesamt_kwh,0)} × 100`,ergebnis:`= ${F(a.abweichung_gesamt_prozent||0,1)} %`}),e.jsx(fe,{title:"Spez. Ertrag Ø",value:(a.ist_gesamt_kwh/a.anlagen_leistung_kwp).toFixed(0),unit:"kWh/kWp",subtitle:n,icon:Is,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"IST-Erzeugung ÷ Anlagenleistung",berechnung:`${F(a.ist_gesamt_kwh,0)} kWh ÷ ${F(a.anlagen_leistung_kwp,1)} kWp`,ergebnis:`= ${F(a.ist_gesamt_kwh/a.anlagen_leistung_kwp,0)} kWh/kWp`})]}),a.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[a.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-lg",children:[e.jsx(_e,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Beste Performance"}),e.jsx("p",{className:"font-medium text-green-700 dark:text-green-300",children:a.bester_string})]})]}),a.schlechtester_string&&a.schlechtester_string!==a.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(jt,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Schwächste Performance"}),e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300",children:a.schlechtester_string})]})]})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Is,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro String"]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:a.strings.map((k,j)=>({name:k.bezeichnung.length>12?k.bezeichnung.slice(0,12)+"...":k.bezeichnung,SOLL:k.prognose_jahr_kwh,IST:k.ist_jahr_kwh,color:tr[j%tr.length]})),layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{type:"number",unit:" kWh"}),e.jsx(ge,{type:"category",dataKey:"name",width:100,tick:{fontSize:11}}),e.jsx(ce,{formatter:k=>[`${k.toFixed(0)} kWh`,""]}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(se,{dataKey:"IST",fill:"#f59e0b",name:"IST (Erzeugt)"})]})})})]}),e.jsxs(E,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Monatsverlauf SOLL vs IST ",s==="all"?"(Summe aller Jahre)":""]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:((h=a.strings[0])==null?void 0:h.monatswerte.map((k,j)=>{const w={name:k.monat_name,SOLL:a.strings.reduce((v,N)=>{var f;return v+(((f=N.monatswerte[j])==null?void 0:f.prognose_kwh)||0)},0),IST:a.strings.reduce((v,N)=>{var f;return v+(((f=N.monatswerte[j])==null?void 0:f.ist_kwh)||0)},0)};return w.Abweichung=w.IST-w.SOLL,w}))||[],children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:10}}),e.jsx(ge,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ce,{formatter:k=>[`${k.toFixed(0)} kWh`,""]}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(se,{dataKey:"IST",fill:"#f59e0b",name:"IST"}),e.jsx(Be,{type:"monotone",dataKey:"Abweichung",stroke:"#10b981",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]}),s==="all"&&m.length>1&&e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Entwicklung über Jahre"}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:m,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name"}),e.jsx(ge,{unit:"%",domain:[80,120],ticks:[80,90,100,110,120]}),e.jsx(ce,{formatter:k=>[`${k}%`,""]}),e.jsx(Ee,{}),a.strings.map((k,j)=>e.jsx(Be,{type:"monotone",dataKey:k.bezeichnung,stroke:tr[j%tr.length],strokeWidth:2,dot:{r:4}},k.investition_id)),e.jsx(Be,{type:"monotone",dataKey:"Gesamt",stroke:"#6b7280",strokeWidth:3,strokeDasharray:"5 5",dot:{r:4}})]})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"100% = Prognose erreicht • Werte über 100% = Überperformance"})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abweichung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:b.map(k=>{var j,w;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:tr[a.strings.findIndex(v=>v.investition_id===k.investition_id)%tr.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:k.bezeichnung})]}),k.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:["→ ",k.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right",children:k.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3",children:[k.ausrichtung||"-",k.neigung_grad&&` / ${k.neigung_grad}°`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600",children:[k.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right text-amber-600 font-medium",children:[k.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right font-medium ${(k.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(k.abweichung_jahr_prozent||0)>=0?"+":"",((j=k.abweichung_jahr_prozent)==null?void 0:j.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right text-purple-600",children:((w=k.spezifischer_ertrag_kwh_kwp)==null?void 0:w.toFixed(0))||"-"})]},k.investition_id)})}),e.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:"Gesamt"}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.anlagen_leistung_kwp.toFixed(1)}),e.jsx("td",{className:"px-3 py-2",children:"-"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-600",children:[a.prognose_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-2 text-right text-amber-600",children:[a.ist_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-2 text-right ${(a.abweichung_gesamt_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(a.abweichung_gesamt_prozent||0)>=0?"+":"",((y=a.abweichung_gesamt_prozent)==null?void 0:y.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-2 text-right text-purple-600",children:(a.ist_gesamt_kwh/a.anlagen_leistung_kwp).toFixed(0)})]})})]})})]})]})}function Ci(r,s){if(r==="all"){if(s.length===0)return"Alle Jahre";if(s.length===1)return`${s[0]}`;const t=Math.min(...s),n=Math.max(...s);return`${t}–${n}`}return`${r}`}function Hs(){var v;const r=Ft(),[s,t]=l.useState("energie"),[n,a]=l.useState("all"),{anlagen:i,loading:x}=Je(),[c,g]=l.useState(null),u=c??((v=i[0])==null?void 0:v.id),d=i.find(N=>N.id===u),{daten:p,loading:m}=Qn(u),{strompreis:o}=$a(u??null),b=l.useMemo(()=>[...new Set(p.map(f=>f.jahr))].sort((f,_)=>_-f),[p]),h=l.useMemo(()=>n==="all"?p:p.filter(N=>N.jahr===n),[p,n]),y=Xn(h);if(x||m)return e.jsx(ve,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(p.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(E,{className:"text-center py-12",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(le,{onClick:()=>r("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(Ye,{className:"h-4 w-4 ml-2"})]})]})]});const j=[{key:"energie",label:"Energie"},{key:"pv",label:"PV-Anlage"},{key:"komponenten",label:"Komponenten"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"},{key:"investitionen",label:"Investitionen"}],w=Ci(n,b);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:n,onChange:N=>a(N.target.value==="all"?"all":Number(N.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),b.map(N=>e.jsx("option",{value:N,children:N},N))]})]}),i.length>1&&e.jsx("select",{value:u??"",onChange:N=>g(Number(N.target.value)),className:"input w-auto",children:i.map(N=>e.jsx("option",{value:N.id,children:N.anlagenname},N.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:j.map(N=>e.jsx("button",{onClick:()=>t(N.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${s===N.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:N.label},N.key))})})]}),e.jsxs("div",{children:[s==="energie"&&e.jsx(Si,{data:h,stats:y,anlage:d,strompreis:o,zeitraumLabel:w}),s==="pv"&&u&&e.jsx(Ai,{anlageId:u,selectedYear:n,verfuegbareJahre:b,zeitraumLabel:w}),s==="komponenten"&&e.jsx(Ei,{anlage:d,strompreis:o,selectedYear:n,zeitraumLabel:w}),s==="finanzen"&&e.jsx(Wi,{data:h,stats:y,strompreis:o,anlageId:u,zeitraumLabel:w}),s==="co2"&&e.jsx(Mi,{data:h,stats:y,zeitraumLabel:w}),s==="investitionen"&&u&&e.jsx(Fi,{anlageId:u,strompreis:o,selectedYear:n,zeitraumLabel:w})]})]})}const $i={"e-auto":Ae,waermepumpe:Ke,speicher:ze,wallbox:pt,wechselrichter:Tt,"pv-module":ae,balkonkraftwerk:wa,sonstiges:Tt},ns={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},Gs={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function Di(){var N;const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(null),[a,i]=l.useState(null),[x,c]=l.useState(!1),[g,u]=l.useState(null),[d,p]=l.useState(30),[m,o]=l.useState(8.2),[b,h]=l.useState(1.85),y=t??((N=r[0])==null?void 0:N.id),{strompreis:k}=$a(y??null);l.useEffect(()=>{k&&(p(k.netzbezug_arbeitspreis_cent_kwh),o(k.einspeiseverguetung_cent_kwh))},[k]),l.useEffect(()=>{if(!y)return;(async()=>{try{c(!0),u(null);const _=await Te.getROIDashboard(y,d,m,b);i(_)}catch(_){u(_ instanceof Error?_.message:"Fehler beim Laden der ROI-Daten")}finally{c(!1)}})()},[y,d,m,b]);const j=l.useMemo(()=>{if(!a||a.gesamt_relevante_kosten<=0)return[];const f=[];let _=0;const I=Math.min(Math.ceil((a.gesamt_amortisation_jahre??20)*1.5),30);for(let C=0;C<=I;C++)f.push({jahr:C,kumulierte_einsparung:Math.round(_),investition:a.gesamt_relevante_kosten}),_+=a.gesamt_jahres_einsparung;return f},[a]),w=l.useMemo(()=>{if(!a)return[];const f={};return a.berechnungen.forEach(_=>{const I=_.investition_typ;f[I]=(f[I]||0)+_.jahres_einsparung}),Object.entries(f).map(([_,I])=>({name:Gs[_]||_,value:Math.round(I),color:ns[_]||"#6b7280"})).filter(_=>_.value>0)},[a]),v=l.useMemo(()=>a?a.berechnungen.map(f=>({name:f.investition_bezeichnung.length>15?f.investition_bezeichnung.substring(0,15)+"...":f.investition_bezeichnung,fullName:f.investition_bezeichnung,kosten:f.relevante_kosten,einsparung:f.jahres_einsparung,amortisation:f.amortisation_jahre??0,typ:f.investition_typ,color:ns[f.investition_typ]||"#6b7280"})):[],[a]);return s?e.jsx(ve,{text:"Lade Daten..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:r.length>1&&e.jsx("select",{value:y??"",onChange:f=>n(Number(f.target.value)),className:"input w-auto",children:r.map(f=>e.jsx("option",{value:f.id,children:f.anlagenname},f.id))})})]}),g&&e.jsx(Q,{type:"error",onClose:()=>u(null),children:g}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Tt,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:d,onChange:f=>p(Number(f.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergütung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:m,onChange:f=>o(Number(f.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:b,onChange:f=>h(Number(f.target.value)),className:"input"})]})]})]}),x&&e.jsx(ve,{text:"Berechne ROI..."}),!x&&a&&a.berechnungen.length===0&&e.jsx(xr,{icon:Qt,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!x&&a&&a.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx($r,{icon:Qt,title:"Gesamtinvestition",value:`${a.gesamt_investition.toLocaleString("de-DE")} €`,subtitle:`Relevant: ${a.gesamt_relevante_kosten.toLocaleString("de-DE")} €`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt − Alternativkosten",ergebnis:`= ${F(a.gesamt_relevante_kosten,0)} €`}),e.jsx($r,{icon:_e,title:"Jährliche Einsparung",value:`${a.gesamt_jahres_einsparung.toLocaleString("de-DE")} €`,subtitle:a.gesamt_roi_prozent?`ROI: ${a.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einsparungen aller Investitionen",berechnung:a.gesamt_relevante_kosten>0?"ROI = Einsparung ÷ Kosten × 100":void 0,ergebnis:a.gesamt_roi_prozent?`= ${a.gesamt_roi_prozent}% ROI`:void 0}),e.jsx($r,{icon:fa,title:"Amortisation",value:a.gesamt_amortisation_jahre?`${a.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten ÷ Jährliche Einsparung",berechnung:a.gesamt_jahres_einsparung>0?`${F(a.gesamt_relevante_kosten,0)} € ÷ ${F(a.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:a.gesamt_amortisation_jahre?`= ${a.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx($r,{icon:et,title:"CO2-Einsparung",value:`${a.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${F(a.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:j,children:[e.jsx(be,{strokeDasharray:"3 3",opacity:.3}),e.jsx(je,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(ge,{tickFormatter:f=>`${(f/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(ce,{formatter:(f,_)=>[`${f.toLocaleString("de-DE")} €`,_==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:f=>`Jahr ${f}`}),e.jsx(Ee,{formatter:f=>f==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(Be,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(Be,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),a.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",a.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:w,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:f,percent:_})=>`${f}: ${(_*100).toFixed(0)}%`,labelLine:!0,children:w.map((f,_)=>e.jsx(Ie,{fill:f.color},`cell-${_}`))}),e.jsx(ce,{formatter:f=>[`${f.toLocaleString("de-DE")} €/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:v,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",opacity:.3}),e.jsx(je,{type:"number",tickFormatter:f=>`${f.toLocaleString("de-DE")}`}),e.jsx(ge,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(ce,{formatter:(f,_)=>[_==="kosten"?`${f.toLocaleString("de-DE")} €`:`${f.toLocaleString("de-DE")} €/Jahr`,_==="kosten"?"Relevante Kosten":"Jährliche Einsparung"]}),e.jsx(Ee,{formatter:f=>f==="kosten"?"Relevante Kosten (€)":"Jährliche Einsparung (€)"}),e.jsx(se,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(se,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.berechnungen.map(f=>{const _=$i[f.investition_typ]||Tt;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4",style:{color:ns[f.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:f.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Gs[f.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[f.relevante_kosten.toLocaleString("de-DE")," €"]}),f.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",f.anschaffungskosten.toLocaleString("de-DE")," € gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[f.jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:f.roi_prozent?e.jsxs("span",{className:f.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[f.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:f.amortisation_jahre?e.jsxs("span",{className:f.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[f.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:f.co2_einsparung_kg?`${f.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},f.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[a.gesamt_relevante_kosten.toLocaleString("de-DE")," €"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[a.gesamt_jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:a.gesamt_roi_prozent?`${a.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:a.gesamt_amortisation_jahre?`${a.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[a.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(Q,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatsächlichen Einsparungen können je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function $r({icon:r,title:s,value:t,subtitle:n,color:a,bgColor:i,formel:x,berechnung:c,ergebnis:g}){const u=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t});return e.jsx(E,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(r,{className:`h-6 w-6 ${a}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s}),x?e.jsx(It,{formel:x,berechnung:c,ergebnis:g,children:u}):u,n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n})]})]})})}const Li=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Pi(){var A;const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState(new Date().getFullYear()),[x,c]=l.useState(null),[g,u]=l.useState([]),[d,p]=l.useState(!1),[m,o]=l.useState(!1),[b,h]=l.useState(null);l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{t&&y()},[t,a]);const y=async()=>{if(t){p(!0),h(null);try{const z=await Vt.listAggregiert(t);u(z);const S=await ft.getAktivePrognose(t);if(S)c({jahresertrag_kwh:S.jahresertrag_kwh,monatswerte:S.monatswerte,isLive:!1});else try{const W=await ft.getPrognose(t);c({jahresertrag_kwh:W.jahresertrag_kwh,monatswerte:W.monatsdaten.map(V=>({monat:V.monat,e_m:V.e_m})),isLive:!0,module:W.module})}catch(W){c(null),W instanceof Error&&W.message.includes("PV-Module")&&h("Keine PV-Module für diese Anlage definiert. Bitte unter Einstellungen → Investitionen anlegen.")}}catch(z){h(z instanceof Error?z.message:"Fehler beim Laden")}finally{p(!1)}}},k=async()=>{if(t){o(!0);try{await ft.speicherePrognose(t);const z=x==null?void 0:x.module;await y(),z&&z.length>0&&c(S=>S?{...S,module:z}:null)}catch(z){h(z instanceof Error?z.message:"Fehler beim Speichern")}finally{o(!1)}}},j=[...new Set(g.map(z=>z.jahr))].sort((z,S)=>S-z);l.useEffect(()=>{j.length>0&&!j.includes(a)&&i(j[0])},[j,a]);const w=[];if(x!=null&&x.monatswerte)for(let z=1;z<=12;z++){const S=((A=x.monatswerte.find(R=>R.monat===z))==null?void 0:A.e_m)||0,W=g.filter(R=>R.jahr===a&&R.monat===z).reduce((R,M)=>R+(M.pv_erzeugung_kwh||0),0),V=W-S,oe=S>0?V/S*100:0;w.push({monat:z,monatName:Li[z],prognose:S,ist:W,abweichung:V,abweichungProzent:oe})}const v=w.reduce((z,S)=>z+S.prognose,0),N=w.reduce((z,S)=>z+S.ist,0),f=N-v,_=v>0?f/v*100:0,C=12-w.filter(z=>z.ist===0).length,P=C>0?N/C*12:0;return s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bs,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:z=>n(parseInt(z.target.value)),options:r.map(z=>({value:z.id.toString(),label:z.anlagenname}))}),j.length>0&&e.jsx(bt,{value:a.toString(),onChange:z=>i(parseInt(z.target.value)),options:j.map(z=>({value:z.toString(),label:z.toString()}))}),e.jsx("button",{onClick:y,disabled:d,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Wt,{className:`h-5 w-5 ${d?"animate-spin":""}`})})]})]}),b&&e.jsx(Q,{type:"error",children:b}),d?e.jsx(ve,{text:"Lade Vergleichsdaten..."}):x?g.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ge,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten für diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen → Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[x.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(le,{size:"sm",onClick:k,disabled:m,children:[e.jsx(ot,{className:"h-4 w-4 mr-1"}),m?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[v.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",a]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[N.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[C," von 12 Monaten"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[f>=0?e.jsx(_e,{className:"h-6 w-6 text-green-500"}):e.jsx(jt,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${f>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[f>=0?"+":"",f.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${f>=0?"text-green-500":"text-red-500"}`,children:[f>=0?"+":"",_.toFixed(1),"%"]})]}),C<12&&C>0&&e.jsxs(E,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[P.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((P/v-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",a]}),e.jsx("div",{className:"h-80",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:w,children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"monatName"}),e.jsx(ge,{yAxisId:"left",tickFormatter:z=>`${z} kWh`}),e.jsx(ge,{yAxisId:"right",orientation:"right",tickFormatter:z=>`${z}%`}),e.jsx(ce,{formatter:(z,S)=>S==="Abweichung %"?`${z.toFixed(1)}%`:`${z.toFixed(0)} kWh`}),e.jsx(Ee,{}),e.jsx(qa,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(se,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(se,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(Be,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:w.map(z=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:z.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[z.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:z.ist>0?e.jsxs("span",{className:"text-green-600",children:[z.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${z.abweichung>=0?"text-green-600":"text-red-600"}`,children:z.ist>0?`${z.abweichung>=0?"+":""}${z.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${z.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:z.ist>0?`${z.abweichungProzent>=0?"+":""}${z.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:z.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):z.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(_e,{className:"h-4 w-4"}),"Übertroffen"]}):z.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):z.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(jt,{className:"h-4 w-4"}),"Unter Plan"]})})]},z.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[v.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[N.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${f>=0?"text-green-600":"text-red-600"}`,children:[f>=0?"+":"",f.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${_>=0?"text-green-600":"text-red-600"}`,children:[_>=0?"+":"",_.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Übertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prüfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjährigen Mittelwerten. Einzelne Monate können stark abweichen."})]})]}):e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfügbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen → Investitionen".'})]})})]})}const Xr={async getKurzfristPrognose(r,s=14){return B.get(`/aussichten/kurzfristig/${r}?tage=${s}`)},async getLangfristPrognose(r,s=12){return B.get(`/aussichten/langfristig/${r}?monate=${s}`)},async getTrendAnalyse(r,s=3){return B.get(`/aussichten/trend/${r}?jahre=${s}`)},async getWetterVorhersage(r,s=7){return B.get(`/aussichten/wetter/${r}?tage=${s}`)},async getFinanzPrognose(r,s=12){return B.get(`/aussichten/finanzen/${r}?monate=${s}`)}};function rr({symbol:r,className:s="h-6 w-6"}){switch(r){case"sunny":return e.jsx(ae,{className:`${s} text-yellow-500`});case"partly_cloudy":return e.jsx(Ot,{className:`${s} text-gray-400`});case"cloudy":return e.jsx(Ot,{className:`${s} text-gray-500`});case"rainy":case"drizzle":case"showers":return e.jsx(mn,{className:`${s} text-blue-500`});case"snowy":case"snow_showers":return e.jsx(un,{className:`${s} text-blue-300`});case"thunderstorm":return e.jsx(xn,{className:`${s} text-purple-500`});case"foggy":return e.jsx(Ot,{className:`${s} text-gray-300`});default:return e.jsx(ae,{className:`${s} text-yellow-400`})}}function sr(r){return new Date(r).toLocaleDateString("de-DE",{weekday:"short",day:"2-digit",month:"2-digit"})}function Js(r){return new Date(r).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})}function Dr(r){return r==null||r<20?"sunny":r<50?"partly_cloudy":(r<80,"cloudy")}function Ii({anlageId:r}){var _,I,C,P;const[s,t]=l.useState(null),[n,a]=l.useState(null),[i,x]=l.useState(!0),[c,g]=l.useState(null),[u,d]=l.useState(14),[p,m]=l.useState("standard"),[o,b]=l.useState(!1);l.useEffect(()=>{h()},[r,u,p]);async function h(){x(!0),g(null);try{if(p==="solar-gti"){const A=await Qr.getSolarPrognose(r,u,!1);a(A),t(null)}else{const A=await Xr.getKurzfristPrognose(r,u);t(A),a(null)}}catch(A){g(A.message||"Fehler beim Laden der Prognose")}finally{x(!1)}}if(i)return e.jsx(ve,{text:"Lade Kurzfrist-Prognose..."});if(c)return e.jsx(Q,{type:"error",children:c});if(!s&&!n)return e.jsx(Q,{type:"warning",children:"Keine Prognose verfügbar"});const y=p==="solar-gti"&&n?n.tage.map(A=>({datum:Js(A.datum),datumFull:sr(A.datum),pv_kwh:A.pv_ertrag_kwh,sonnenstunden:null,temperatur:A.temperatur_max_c,gti:A.gti_kwh_m2})):(s==null?void 0:s.tageswerte.map(A=>({datum:Js(A.datum),datumFull:sr(A.datum),pv_kwh:A.pv_prognose_kwh,sonnenstunden:A.sonnenstunden,temperatur:A.temperatur_max_c,gti:null})))||[],k=p==="solar-gti"&&n?{...n.tage[0],pv_prognose_kwh:(_=n.tage[0])==null?void 0:_.pv_ertrag_kwh,wetter_symbol:Dr((I=n.tage[0])==null?void 0:I.bewoelkung_prozent)}:s==null?void 0:s.tageswerte[0],j=p==="solar-gti"&&n?{...n.tage[1],pv_prognose_kwh:(C=n.tage[1])==null?void 0:C.pv_ertrag_kwh,wetter_symbol:Dr((P=n.tage[1])==null?void 0:P.bewoelkung_prozent)}:s==null?void 0:s.tageswerte[1],w=p==="solar-gti"&&n?n.tage.reduce((A,z)=>A+(z.pv_ertrag_kwh||0),0):(s==null?void 0:s.summe_kwh)||0,v=y.length>0?w/y.length:0,N=p==="solar-gti"&&n?n.anlage.leistung_kwp:(s==null?void 0:s.anlagenleistung_kwp)||0,f=p==="solar-gti"&&n?"Open-Meteo Solar (GTI)":(s==null?void 0:s.datenquelle)||"";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Tt,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Prognose-Modus:"}),e.jsxs("select",{value:p,onChange:A=>m(A.target.value),className:"input w-auto text-sm",children:[e.jsx("option",{value:"standard",children:"Standard (GHI-basiert)"}),e.jsx("option",{value:"solar-gti",children:"Solar GTI (Modulneigung)"})]}),e.jsx("button",{onClick:()=>b(!o),className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Info zum Prognose-Modus",children:e.jsx(qe,{className:"h-4 w-4"})})]})}),o&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Prognose-Modi:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Standard:"})," Basiert auf horizontaler Globalstrahlung (GHI). Guter Überblick."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solar GTI:"})," Berücksichtigt Modulneigung und -ausrichtung für genauere Prognose. Nutzt Open-Meteo Solar API."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Summe ",y.length," Tage"]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[w.toFixed(0)," kWh"]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ae,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Durchschnitt/Tag"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[v.toFixed(1)," kWh"]})]})]})}),k&&e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rr,{symbol:k.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Heute"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(k.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})}),j&&e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rr,{symbol:j.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Morgen"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(j.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})})]}),e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:p==="solar-gti"?"Solar-Prognose (GTI)":"Wettervorhersage"}),e.jsxs("select",{value:u,onChange:A=>d(Number(A.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:7,children:"7 Tage"}),e.jsx("option",{value:14,children:"14 Tage"}),e.jsx("option",{value:16,children:"16 Tage"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 min-w-max pb-2",children:p==="solar-gti"&&n?n.tage.map((A,z)=>{var S;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${z===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:sr(A.datum)}),e.jsx(rr,{symbol:Dr(A.bewoelkung_prozent),className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[A.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Rt,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((S=A.temperatur_max_c)==null?void 0:S.toFixed(0))??"-","°C"]})]}),A.gti_kwh_m2!==null&&A.gti_kwh_m2>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ae,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[A.gti_kwh_m2.toFixed(1)," GTI"]})]})]},A.datum)}):s?s.tageswerte.map((A,z)=>{var S;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${z===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:sr(A.datum)}),e.jsx(rr,{symbol:A.wetter_symbol,className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[A.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Rt,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((S=A.temperatur_max_c)==null?void 0:S.toFixed(0))??"-","°C"]})]}),A.sonnenstunden!==null&&A.sonnenstunden>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ae,{className:"h-3 w-3 text-yellow-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[A.sonnenstunden.toFixed(0),"h"]})]})]},A.datum)}):null})})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Prognose"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:y,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"datum",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(ge,{yAxisId:"left",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ge,{yAxisId:"right",orientation:"right",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"°C",angle:90,position:"insideRight"}}),e.jsx(ce,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(A,z)=>z==="pv_kwh"?[`${A.toFixed(1)} kWh`,"PV-Prognose"]:z==="sonnenstunden"?[`${A.toFixed(1)} h`,"Sonnenstunden"]:z==="temperatur"?[`${A.toFixed(0)} °C`,"Temperatur"]:[A,z]}),e.jsx(Ee,{}),e.jsx(se,{yAxisId:"left",dataKey:"pv_kwh",name:"PV-Prognose",fill:"#eab308",radius:[4,4,0,0]}),e.jsx(Be,{yAxisId:"right",type:"monotone",dataKey:"temperatur",name:"Temperatur",stroke:"#ef4444",strokeWidth:2,dot:{r:3}})]})})})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Datum"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Wetter"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Prognose"}),e.jsx("th",{className:"text-right py-2 px-3",children:p==="solar-gti"?"GTI":"Strahlung"}),e.jsx("th",{className:"text-right py-2 px-3",children:p==="solar-gti"?"Bewölkung":"Sonnenstunden"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Temperatur"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Niederschlag"})]})}),e.jsx("tbody",{children:p==="solar-gti"&&n?n.tage.map((A,z)=>{var S,W,V;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${z===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:sr(A.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(rr,{symbol:Dr(A.bewoelkung_prozent),className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[A.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((S=A.gti_kwh_m2)==null?void 0:S.toFixed(2))??"-"," kWh/m²"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((W=A.bewoelkung_prozent)==null?void 0:W.toFixed(0))??"-"," %"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((V=A.temperatur_max_c)==null?void 0:V.toFixed(0))??"-","°C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:A.niederschlag_mm!==null&&A.niederschlag_mm!==void 0&&A.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[A.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},A.datum)}):s?s.tageswerte.map((A,z)=>{var S,W,V;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${z===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:sr(A.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(rr,{symbol:A.wetter_symbol,className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[A.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((S=A.globalstrahlung_kwh_m2)==null?void 0:S.toFixed(1))??"-"," kWh/m²"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((W=A.sonnenstunden)==null?void 0:W.toFixed(1))??"-"," h"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((V=A.temperatur_max_c)==null?void 0:V.toFixed(0))??"-","°C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:A.niederschlag_mm!==null&&A.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[A.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},A.datum)}):null})]})})]}),e.jsx(E,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",N.toFixed(1)," kWp"]}),p==="solar-gti"&&n&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Neigung: ",n.anlage.neigung,"°"]}),e.jsxs("span",{children:["Ausrichtung: ",n.anlage.azimut,"°"]})]}),p!=="solar-gti"&&s&&e.jsxs("span",{children:["Systemverluste: ",s.system_losses_prozent.toFixed(0),"%"]}),e.jsxs("span",{children:["Datenquelle: ",f]}),e.jsxs("span",{children:["Abgerufen: ",new Date(p==="solar-gti"&&n?n.abgerufen_am:(s==null?void 0:s.abgerufen_am)||new Date().toISOString()).toLocaleString("de-DE")]})]})})]})}function Zs({richtung:r}){switch(r){case"positiv":return e.jsx(_e,{className:"h-5 w-5 text-green-500"});case"negativ":return e.jsx(jt,{className:"h-5 w-5 text-red-500"});default:return e.jsx(Gr,{className:"h-5 w-5 text-gray-400"})}}function Vi({anlageId:r}){const[s,t]=l.useState(null),[n,a]=l.useState(!0),[i,x]=l.useState(null),[c,g]=l.useState(12),[u,d]=l.useState(!0);l.useEffect(()=>{p()},[r,c]);async function p(){a(!0),x(null);try{const h=await Xr.getLangfristPrognose(r,c);t(h)}catch(h){x(h.message||"Fehler beim Laden der Prognose")}finally{a(!1)}}if(n)return e.jsx(ve,{text:"Lade Langfrist-Prognose..."});if(i)return e.jsx(Q,{type:"error",children:i});if(!s)return e.jsx(Q,{type:"warning",children:"Keine Prognose verfügbar"});const m=s.monatswerte.map(h=>({name:`${h.monat_name.substring(0,3)} ${h.jahr}`,monat_name:h.monat_name,jahr:h.jahr,pvgis:h.pvgis_prognose_kwh,trend:h.trend_korrigiert_kwh,min:h.konfidenz_min_kwh,max:h.konfidenz_max_kwh,konfidenz:[h.konfidenz_min_kwh,h.konfidenz_max_kwh],pr:h.historische_performance_ratio})),o=s.trend_analyse,b=(o.durchschnittliche_performance_ratio*100).toFixed(0)+"%";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahresprognose"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(it,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[c," Monate"]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Zs,{richtung:o.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:b})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(qe,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenbasis"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[o.datenbasis_monate," Monate"]})]})]})})]}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatsprognose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:h=>d(h.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Konfidenzband"})]}),e.jsxs("select",{value:c,onChange:h=>g(Number(h.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsx("div",{className:"h-[350px]",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:m,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60,className:"text-gray-600 dark:text-gray-400"}),e.jsx(ge,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ce,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(h,y)=>y==="trend"?[`${h.toFixed(0)} kWh`,"Trend-korrigiert"]:y==="pvgis"?[`${h.toFixed(0)} kWh`,"PVGIS-Prognose"]:y==="konfidenz"&&Array.isArray(h)?[`${h[0].toFixed(0)} - ${h[1].toFixed(0)} kWh`,"Konfidenzband"]:[h,y]}),e.jsx(Ee,{}),u&&e.jsx(ct,{type:"monotone",dataKey:"konfidenz",name:"Konfidenzband",fill:"#3b82f6",fillOpacity:.1,stroke:"none"}),e.jsx(se,{dataKey:"pvgis",name:"PVGIS-Prognose",fill:"#9ca3af",fillOpacity:.5,radius:[4,4,0,0]}),e.jsx(se,{dataKey:"trend",name:"Trend-korrigiert",fill:"#eab308",radius:[4,4,0,0]})]})})})}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Trend-Analyse"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(Zs,{richtung:o.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trend"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white capitalize",children:o.trend_richtung})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[b,e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(IST / SOLL)"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenquellen"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.datenquellen.join(", ")})]})]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PVGIS"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Trend-korrigiert"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Min"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Max"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Hist. PR"})]})}),e.jsx("tbody",{children:s.monatswerte.map(h=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[h.monat_name," ",h.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[h.pvgis_prognose_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[h.trend_korrigiert_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[h.konfidenz_min_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[h.konfidenz_max_kwh.toFixed(0)," kWh"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:h.historische_performance_ratio!==null?e.jsxs("span",{className:h.historische_performance_ratio>1?"text-green-600":h.historische_performance_ratio<.9?"text-red-600":"text-gray-600",children:[(h.historische_performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},`${h.jahr}-${h.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[s.monatswerte.reduce((h,y)=>h+y.pvgis_prognose_kwh,0).toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[s.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{colSpan:3})]})})]})})]}),e.jsx(E,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",s.anlagenleistung_kwp.toFixed(1)," kWp"]}),e.jsxs("span",{children:["Spez. Ertrag: ",(s.jahresprognose_kwh/s.anlagenleistung_kwp).toFixed(0)," kWh/kWp"]}),e.jsxs("span",{children:["Zeitraum: ",s.prognose_zeitraum.von," bis ",s.prognose_zeitraum.bis]})]})})]})}function Bi({anlageId:r}){const[s,t]=l.useState(null),[n,a]=l.useState(!0),[i,x]=l.useState(null),[c,g]=l.useState(3);l.useEffect(()=>{u()},[r,c]);async function u(){a(!0),x(null);try{const h=await Xr.getTrendAnalyse(r,c);t(h)}catch(h){x(h.message||"Fehler beim Laden der Trend-Analyse")}finally{a(!1)}}if(n)return e.jsx(ve,{text:"Lade Trend-Analyse..."});if(i)return e.jsx(Q,{type:"error",children:i});if(!s)return e.jsx(Q,{type:"warning",children:"Keine Trend-Daten verfügbar"});if(!s.jahres_vergleich.some(h=>h.gesamt_kwh>0))return e.jsx("div",{className:"space-y-6",children:e.jsxs(E,{className:"p-8 text-center",children:[e.jsx(rt,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine historischen Daten"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Für eine Trend-Analyse werden mindestens Daten aus einem Jahr benötigt.",e.jsx("br",{}),"Erfasse Monatsdaten, um Trends zu analysieren."]})]})});const p=s.jahres_vergleich.map(h=>({jahr:h.jahr.toString(),kwh:h.gesamt_kwh,spez_ertrag:h.spezifischer_ertrag_kwh_kwp,pr:h.performance_ratio?h.performance_ratio*100:null})),m=s.jahres_vergleich.filter(h=>h.gesamt_kwh>0),o=m.length>0?m.reduce((h,y)=>y.gesamt_kwh>h.gesamt_kwh?y:h,m[0]):null,b=s.degradation.geschaetzt_prozent_jahr;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o&&e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(or,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bestes Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:o.jahr}),e.jsxs("p",{className:"text-sm text-green-600",children:[o.gesamt_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(it,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Analysezeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s.analyse_zeitraum.von," - ",s.analyse_zeitraum.bis]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[b!==null?b>0?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(_e,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):b<-1?e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(jt,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Gr,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Gr,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Degradation/Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:b!==null?e.jsxs("span",{className:b>0?"text-green-600":b<-1?"text-red-600":"",children:[b>0?"+":"",b.toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(ye,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]})})]}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"}),e.jsxs("select",{value:c,onChange:h=>g(Number(h.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:2,children:"2 Jahre"}),e.jsx("option",{value:3,children:"3 Jahre"}),e.jsx("option",{value:5,children:"5 Jahre"}),e.jsx("option",{value:10,children:"10 Jahre"})]})]})}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahreserträge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:p,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(ge,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ce,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:h=>[`${h.toLocaleString("de-DE")} kWh`,"Ertrag"]}),e.jsx(Ee,{}),e.jsx(se,{dataKey:"kwh",name:"Jahresertrag",radius:[4,4,0,0],children:p.map((h,y)=>e.jsx(Ie,{fill:h.kwh===(o==null?void 0:o.gesamt_kwh)?"#10b981":"#eab308"},`cell-${y}`))})]})})})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:p,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(ge,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",domain:["auto","auto"]}),e.jsx(ce,{formatter:h=>[`${h.toFixed(0)} kWh/kWp`,"Spez. Ertrag"]}),e.jsx(Ee,{}),e.jsx(Be,{type:"monotone",dataKey:"spez_ertrag",name:"Spez. Ertrag",stroke:"#3b82f6",strokeWidth:2,dot:{r:5}})]})})})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Saisonale Muster"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Beste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.saisonale_muster.beste_monate.map((h,y)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${y===0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-500"}`,children:h},h))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Schwächste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.saisonale_muster.schlechteste_monate.map((h,y)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${y===0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-orange-50 text-orange-700 dark:bg-orange-900/20 dark:text-orange-500"}`,children:h},h))})]})]})]}),e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Degradation"}),s.degradation.methode&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${s.degradation.methode==="vollstaendig"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:s.degradation.methode==="vollstaendig"?"Vollständige Jahre":"TMY-ergänzt"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:b!==null?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:b>0?e.jsxs("span",{className:"text-green-600",children:["+",b.toFixed(2),"% pro Jahr"]}):b<-1?e.jsxs("span",{className:"text-red-600",children:[b.toFixed(2),"% pro Jahr"]}):e.jsxs("span",{className:"text-gray-600",children:[b.toFixed(2),"% pro Jahr"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.degradation.hinweis}),s.degradation.methode==="tmy_ergaenzt"&&e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:"Unvollständige Jahre wurden mit PVGIS TMY-Prognosewerten ergänzt."}),b<-1&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-2",children:"Eine Degradation von mehr als 1% pro Jahr kann auf Probleme hinweisen. Typische Modul-Degradation liegt bei 0.3-0.5% pro Jahr."})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:s.degradation.hinweis})})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Jahr"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Monate"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Performance-Ratio"})]})}),e.jsx("tbody",{children:s.jahres_vergleich.map(h=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${h.gesamt_kwh===(o==null?void 0:o.gesamt_kwh)&&h.ist_vollstaendig?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[h.jahr,!h.ist_vollstaendig&&h.anzahl_monate>0&&e.jsx("span",{className:"ml-1 text-xs text-orange-500",title:"Unvollständiges Jahr",children:"*"})]}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:h.ist_vollstaendig?"text-green-600":"text-orange-500",children:[h.anzahl_monate,"/12"]})}),e.jsx("td",{className:"py-2 px-3 text-right",children:h.gesamt_kwh>0?e.jsxs("span",{className:"font-semibold text-yellow-600",children:[h.gesamt_kwh.toLocaleString("de-DE")," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:h.spezifischer_ertrag_kwh_kwp>0?`${h.spezifischer_ertrag_kwh_kwp.toFixed(0)} kWh/kWp`:e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:h.performance_ratio!==null?e.jsxs("span",{className:h.performance_ratio>1?"text-green-600":h.performance_ratio<.9?"text-red-600":"text-gray-600",children:[(h.performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},h.jahr))})]})})]}),e.jsx(E,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",s.datenquellen.join(", ")]}),e.jsxs("span",{children:["Anlagenleistung: ",s.anlagenleistung_kwp.toFixed(1)," kWp"]})]})})]})}const Oi=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ec4899"],Ki={speicher:ze,"e-auto-v2h":Ae,"e-auto-ladung":Ae,waermepumpe:Ke};function Ti({anlageId:r}){const[s,t]=l.useState(null),[n,a]=l.useState(!0),[i,x]=l.useState(null),[c,g]=l.useState(12);l.useEffect(()=>{u()},[r,c]);async function u(){a(!0),x(null);try{const o=await Xr.getFinanzPrognose(r,c);t(o)}catch(o){x(o.message||"Fehler beim Laden der Finanzprognose")}finally{a(!1)}}if(n)return e.jsx(ve,{text:"Lade Finanzprognose..."});if(i)return e.jsx(Q,{type:"error",children:i});if(!s)return e.jsx(Q,{type:"warning",children:"Keine Prognose verfügbar"});const d=s.monatswerte.map(o=>({name:`${o.monat_name.substring(0,3)} ${o.jahr}`,einspeise_erloes:o.einspeise_erloes_euro,ev_ersparnis:o.ev_ersparnis_euro,netto_ertrag:o.netto_ertrag_euro})),p=[{name:"EV-Ersparnis",value:s.jahres_ev_ersparnis_euro},{name:"Einspeise-Erlös",value:s.jahres_einspeise_erloes_euro}],m=Math.min(s.amortisations_fortschritt_prozent,100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(St,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahres-Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:[s.jahres_netto_ertrag_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," €"]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(_e,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s.amortisations_fortschritt_prozent.toFixed(1),"%"]})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.amortisation_erreicht?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(tt,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(fa,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s.amortisation_erreicht?e.jsx("span",{className:"text-green-600",children:"Erreicht"}):s.amortisation_prognose_jahr?e.jsx("span",{children:s.amortisation_prognose_jahr}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(Qt,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bisherige Erträge"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s.bisherige_ertraege_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," €"]})]})]})})]}),e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Amortisations-Fortschritt"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.bisherige_ertraege_euro.toLocaleString("de-DE")," € von ",s.investition_gesamt_euro.toLocaleString("de-DE")," €"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all ${s.amortisation_erreicht?"bg-green-500":m>75?"bg-blue-500":m>50?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${m}%`}})}),!s.amortisation_erreicht&&s.restlaufzeit_bis_amortisation_monate&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Noch ca. ",s.restlaufzeit_bis_amortisation_monate," Monate bis zur Amortisation (voraussichtlich ",s.amortisation_prognose_jahr,")"]})]}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatliche Ertrags-Prognose"}),e.jsxs("select",{value:c,onChange:o=>g(Number(o.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(E,{className:"p-4 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatliche Erträge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:d,children:[e.jsx(be,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(je,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60}),e.jsx(ge,{tick:{fontSize:12},label:{value:"€",angle:-90,position:"insideLeft"}}),e.jsx(ce,{formatter:(o,b)=>{const h={einspeise_erloes:"Einspeise-Erlös",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"};return[`${o.toFixed(2)} €`,h[b]||b]}}),e.jsx(Ee,{formatter:o=>({einspeise_erloes:"Einspeise-Erlös",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"})[o]||o}),e.jsx(se,{dataKey:"einspeise_erloes",stackId:"a",fill:"#3b82f6",name:"einspeise_erloes"}),e.jsx(se,{dataKey:"ev_ersparnis",stackId:"a",fill:"#10b981",name:"ev_ersparnis"}),e.jsx(Be,{type:"monotone",dataKey:"netto_ertrag",stroke:"#f59e0b",strokeWidth:2,dot:{r:3},name:"netto_ertrag"})]})})})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Ertrags-Zusammensetzung"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:p,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({percent:o})=>`${(o*100).toFixed(0)}%`,children:p.map((o,b)=>e.jsx(Ie,{fill:Oi[b]},`cell-${b}`))}),e.jsx(ce,{formatter:o=>`${o.toFixed(2)} €`}),e.jsx(Ee,{})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"EV-Quote:"}),e.jsxs("span",{className:"font-medium",children:[s.eigenverbrauchsquote_prozent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[s.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[s.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]})]})]})]})]}),s.komponenten_beitraege&&s.komponenten_beitraege.length>0&&e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Komponenten-Beiträge zur Finanzierung"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.komponenten_beitraege.map((o,b)=>{const h=Ki[o.typ]||ze;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(h,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500",children:o.beschreibung})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[o.beitrag_kwh_jahr.toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",o.beitrag_euro_jahr.toFixed(0)," €/Jahr"]})]})]},b)})}),(s.speicher_ev_erhoehung_kwh>0||s.v2h_rueckspeisung_kwh>0||s.wp_pv_anteil_kwh>0)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[s.speicher_ev_erhoehung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Speicher EV+"}),e.jsxs("p",{className:"font-semibold",children:[s.speicher_ev_erhoehung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",s.speicher_ev_erhoehung_euro.toFixed(0)," €"]})]}),s.v2h_rueckspeisung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"V2H-Rückspeisung"}),e.jsxs("p",{className:"font-semibold",children:[s.v2h_rueckspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",s.v2h_ersparnis_euro.toFixed(0)," €"]})]}),s.eauto_ladung_pv_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"E-Auto PV-Ladung"}),e.jsxs("p",{className:"font-semibold",children:[s.eauto_ladung_pv_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",s.eauto_ersparnis_euro.toFixed(0)," €"]})]}),s.wp_pv_anteil_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"WP PV-Direkt"}),e.jsxs("p",{className:"font-semibold",children:[s.wp_pv_anteil_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",s.wp_pv_ersparnis_euro.toFixed(0)," €"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Strompreise"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Einspeisevergütung"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[s.einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Netzbezugspreis"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:[s.netzbezug_preis_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ersparnis durch EV"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[(s.netzbezug_preis_cent_kwh-s.einspeiseverguetung_cent_kwh).toFixed(2)," ct/kWh"]})]})]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Investition & ROI"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Investition gesamt"}),e.jsxs("span",{className:"font-semibold",children:[s.investition_gesamt_euro.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Bisherige Erträge"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[s.bisherige_ertraege_euro.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Prognose Jahres-Ertrag"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[s.jahres_netto_ertrag_euro.toLocaleString("de-DE")," €/Jahr"]})]})]})]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeisung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeise-Erlös"}),e.jsx("th",{className:"text-right py-2 px-3",children:"EV-Ersparnis"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold",children:"Netto-Ertrag"})]})}),e.jsx("tbody",{children:s.monatswerte.map(o=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[o.monat_name," ",o.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[o.pv_erzeugung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[o.eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[o.einspeisung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[o.einspeise_erloes_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[o.ev_ersparnis_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[o.netto_ertrag_euro.toFixed(2)," €"]})]},`${o.jahr}-${o.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[s.jahres_erzeugung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[s.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[s.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[s.jahres_einspeise_erloes_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[s.jahres_ev_ersparnis_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[s.jahres_netto_ertrag_euro.toFixed(2)," €"]})]})})]})})]}),e.jsx(E,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",s.datenquellen.join(", ")]}),e.jsxs("span",{children:["Zeitraum: ",s.prognose_zeitraum.von," bis ",s.prognose_zeitraum.bis]})]})})]})}function Ri(){var p;const r=Ft(),[s,t]=l.useState("kurzfristig"),{anlagen:n,loading:a}=Je(),[i,x]=l.useState(null),c=i??((p=n[0])==null?void 0:p.id);if(a)return e.jsx(ve,{text:"Lade Aussichten..."});if(n.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});const g=n.find(m=>m.id===c);if(!((g==null?void 0:g.latitude)&&(g==null?void 0:g.longitude)))return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsxs(E,{className:"text-center py-12",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Standort nicht konfiguriert"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["Für Prognosen werden die Koordinaten der Anlage benötigt.",e.jsx("br",{}),"Bitte konfiguriere den Standort in den Anlagen-Einstellungen."]}),e.jsxs(le,{onClick:()=>r("/einstellungen/anlage"),children:["Anlage konfigurieren",e.jsx(Ye,{className:"h-4 w-4 ml-2"})]})]})]});const d=[{key:"kurzfristig",label:"Kurzfristig",icon:ae,tooltip:"7-14 Tage Wetterprognose mit PV-Ertragsprognose"},{key:"langfristig",label:"Langfristig",icon:it,tooltip:"12-Monats-Prognose basierend auf PVGIS-Daten"},{key:"trend",label:"Trend",icon:_e,tooltip:"Historische Trends und Degradationsanalyse"},{key:"finanzen",label:"Finanzen",icon:St,tooltip:"Finanzielle Prognosen und Amortisation"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx("div",{className:"flex items-center gap-3",children:n.length>1&&e.jsx("select",{value:c??"",onChange:m=>x(Number(m.target.value)),className:"input w-auto",children:n.map(m=>e.jsx("option",{value:m.id,children:m.anlagenname},m.id))})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:d.map(m=>{const o=m.icon;return e.jsx(Yr,{text:m.tooltip,children:e.jsxs("button",{onClick:()=>t(m.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 ${s===m.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(o,{className:"h-4 w-4"}),m.label]})},m.key)})})})]}),c&&e.jsxs(e.Fragment,{children:[s==="kurzfristig"&&e.jsx(Ii,{anlageId:c}),s==="langfristig"&&e.jsx(Vi,{anlageId:c}),s==="trend"&&e.jsx(Bi,{anlageId:c}),s==="finanzen"&&e.jsx(Ti,{anlageId:c})]})]})}const Hi=[{key:"strom",label:"Strom",icon:"⚡"},{key:"gas",label:"Gas",icon:"🔥"},{key:"wasser",label:"Wasser",icon:"💧"}],jr=()=>({name:"",kundennummer:"",portal_url:"",notizen:"",zaehler:[]}),Gi=()=>({bezeichnung:"",nummer:"",notizen:""});function Ji({value:r,onChange:s}){const[t,n]=l.useState({}),a=m=>{n(o=>({...o,[m]:!o[m]}))},i=(m,o)=>{const b={...r};o?b[m]=o:delete b[m],s(b)},x=m=>{i(m,jr()),n(o=>({...o,[m]:!0}))},c=m=>{i(m,void 0)},g=(m,o,b)=>{const h=r[m]||jr();i(m,{...h,[o]:b})},u=m=>{const o=r[m]||jr();i(m,{...o,zaehler:[...o.zaehler,Gi()]})},d=(m,o,b)=>{const h=r[m]||jr(),y=[...h.zaehler];y[o]=b,i(m,{...h,zaehler:y})},p=(m,o)=>{const b=r[m]||jr(),h=b.zaehler.filter((y,k)=>k!==o);i(m,{...b,zaehler:h})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Versorger & Zähler"}),e.jsx("div",{className:"space-y-3",children:Hi.map(({key:m,label:o,icon:b})=>{const h=r[m],y=t[m];return h?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer",onClick:()=>a(m),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsx($t,{className:"w-4 h-4 text-gray-500"}):e.jsx(vt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-lg",children:b}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:h.name||o}),h.zaehler.length>0&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",h.zaehler.length," Zähler)"]})]}),e.jsx("button",{type:"button",onClick:k=>{k.stopPropagation(),c(m)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Versorger entfernen",children:e.jsx(ht,{className:"w-4 h-4"})})]}),y&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Versorger-Name",value:h.name,onChange:k=>g(m,"name",k.target.value),placeholder:`z.B. Stadtwerke ${o}`}),e.jsx(O,{label:"Kundennummer",value:h.kundennummer,onChange:k=>g(m,"kundennummer",k.target.value),placeholder:"z.B. 12345678"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(O,{label:"Kundenportal-URL",value:h.portal_url||"",onChange:k=>g(m,"portal_url",k.target.value),placeholder:"https://kundenportal.beispiel.de"}),h.portal_url&&e.jsxs("a",{href:h.portal_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Kt,{className:"w-3 h-3"}),"Portal öffnen"]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(O,{label:"Notizen",value:h.notizen||"",onChange:k=>g(m,"notizen",k.target.value),placeholder:"Optionale Anmerkungen..."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Zähler"}),e.jsxs(le,{type:"button",variant:"ghost",size:"sm",onClick:()=>u(m),children:[e.jsx(Dt,{className:"w-4 h-4 mr-1"}),"Zähler"]})]}),h.zaehler.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Noch keine Zähler erfasst"}):e.jsx("div",{className:"space-y-2",children:h.zaehler.map((k,j)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(O,{label:"Bezeichnung",value:k.bezeichnung,onChange:w=>d(m,j,{...k,bezeichnung:w.target.value}),placeholder:m==="strom"?"z.B. Einspeisung":"z.B. Hauptzähler"}),e.jsx(O,{label:"Zählernummer",value:k.nummer,onChange:w=>d(m,j,{...k,nummer:w.target.value}),placeholder:"z.B. 1EMH0012345678"}),e.jsx(O,{label:"Notizen",value:k.notizen||"",onChange:w=>d(m,j,{...k,notizen:w.target.value}),placeholder:"Optional..."})]}),e.jsx("button",{type:"button",onClick:()=>p(m,j),className:"p-2 text-gray-400 hover:text-red-500 transition-colors mt-6",title:"Zähler entfernen",children:e.jsx(ht,{className:"w-4 h-4"})})]},j))})]})]})]},m):e.jsxs("button",{type:"button",onClick:()=>x(m),className:"w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-400 hover:text-blue-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"}),e.jsxs("span",{children:[b," ",o,"-Versorger hinzufügen"]})]},m)})})]})}function qs({anlage:r,onSubmit:s,onCancel:t}){var k,j,w;const[n,a]=l.useState(!1),[i,x]=l.useState(null),[c,g]=l.useState({anlagenname:(r==null?void 0:r.anlagenname)||"",leistung_kwp:((k=r==null?void 0:r.leistung_kwp)==null?void 0:k.toString())||"",installationsdatum:(r==null?void 0:r.installationsdatum)||"",standort_plz:(r==null?void 0:r.standort_plz)||"",standort_ort:(r==null?void 0:r.standort_ort)||"",standort_strasse:(r==null?void 0:r.standort_strasse)||"",latitude:((j=r==null?void 0:r.latitude)==null?void 0:j.toString())||"",longitude:((w=r==null?void 0:r.longitude)==null?void 0:w.toString())||"",mastr_id:(r==null?void 0:r.mastr_id)||"",wetter_provider:(r==null?void 0:r.wetter_provider)||"auto"}),[u,d]=l.useState((r==null?void 0:r.versorger_daten)||{}),[p,m]=l.useState([]),[o,b]=l.useState(!1);l.useEffect(()=>{r!=null&&r.id&&r.latitude&&r.longitude&&(b(!0),Qr.getProvider(r.id).then(v=>m(v.provider)).catch(v=>console.warn("Wetter-Provider laden fehlgeschlagen:",v)).finally(()=>b(!1)))},[r==null?void 0:r.id,r==null?void 0:r.latitude,r==null?void 0:r.longitude]);const h=v=>{const{name:N,value:f}=v.target;g(_=>({..._,[N]:f}))},y=async v=>{if(v.preventDefault(),x(null),!c.anlagenname.trim()){x("Bitte einen Namen eingeben");return}if(!c.leistung_kwp||parseFloat(c.leistung_kwp)<=0){x("Bitte eine gültige Leistung eingeben");return}try{a(!0),await s({anlagenname:c.anlagenname.trim(),leistung_kwp:parseFloat(c.leistung_kwp),installationsdatum:c.installationsdatum||void 0,standort_plz:c.standort_plz||void 0,standort_ort:c.standort_ort||void 0,standort_strasse:c.standort_strasse||void 0,latitude:c.latitude?parseFloat(c.latitude):void 0,longitude:c.longitude?parseFloat(c.longitude):void 0,mastr_id:c.mastr_id||void 0,versorger_daten:Object.keys(u).length>0?u:void 0,wetter_provider:c.wetter_provider})}catch(N){x(N instanceof Error?N.message:"Fehler beim Speichern")}finally{a(!1)}};return e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[i&&e.jsx(Q,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Anlagenname",name:"anlagenname",value:c.anlagenname,onChange:h,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(O,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:c.leistung_kwp,onChange:h,placeholder:"z.B. 10.5",required:!0}),e.jsx(O,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:c.installationsdatum,onChange:h})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," gepflegt. So können auch Anlagen mit mehreren Dachflächen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(O,{label:"PLZ",name:"standort_plz",value:c.standort_plz,onChange:h,placeholder:"z.B. 12345"}),e.jsx(O,{label:"Ort",name:"standort_ort",value:c.standort_ort,onChange:h,placeholder:"z.B. Berlin"}),e.jsx(O,{label:"Straße",name:"standort_strasse",value:c.standort_strasse,onChange:h,placeholder:"z.B. Musterstraße 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(für PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:c.latitude,onChange:h,placeholder:"z.B. 52.520008",hint:"Nördliche Breite (positiv)"}),e.jsx(O,{label:"Längengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:c.longitude,onChange:h,placeholder:"z.B. 13.404954",hint:"Östliche Länge (positiv)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Erweiterte Stammdaten"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(O,{label:"MaStR-ID",name:"mastr_id",value:c.mastr_id,onChange:h,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID der Anlage"}),c.mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${c.mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Kt,{className:"w-3 h-3"}),"Im MaStR öffnen"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten-Quelle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"wetter_provider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bevorzugter Provider"}),e.jsx("select",{id:"wetter_provider",name:"wetter_provider",value:c.wetter_provider,onChange:h,disabled:o,className:"w-full px-3 py-2 rounded-lg border bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed border-gray-300 dark:border-gray-600",children:p.length>0?p.map(v=>e.jsxs("option",{value:v.id,disabled:!v.verfuegbar,children:[v.name,v.empfohlen?" (empfohlen)":"",v.verfuegbar?"":" (nicht verfügbar)"]},v.id)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"auto",children:"Automatisch (empfohlen)"}),e.jsx("option",{value:"open-meteo",children:"Open-Meteo"}),e.jsx("option",{value:"brightsky",children:"Bright Sky (DWD)"}),e.jsx("option",{value:"open-meteo-solar",children:"Open-Meteo Solar"})]})})]}),e.jsx("div",{className:"flex items-end pb-1",children:e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[c.wetter_provider==="auto"&&e.jsx("span",{children:"Automatische Auswahl: Bright Sky für DE, Open-Meteo sonst"}),c.wetter_provider==="brightsky"&&e.jsx("span",{children:"DWD-Daten über Bright Sky API (nur Deutschland)"}),c.wetter_provider==="open-meteo"&&e.jsx("span",{children:"Open-Meteo Archive API (weltweit verfügbar)"}),c.wetter_provider==="open-meteo-solar"&&e.jsx("span",{children:"GTI-Berechnung für geneigte PV-Module"})]})})]}),!(r!=null&&r.latitude)&&!(r!=null&&r.longitude)&&e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg flex gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Bitte zuerst Geokoordinaten eintragen, um die verfügbaren Provider zu sehen."})]})]}),e.jsx(Ji,{value:u,onChange:d}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(le,{type:"button",variant:"secondary",onClick:t,children:"Abbrechen"}),e.jsx(le,{type:"submit",loading:n,children:r?"Speichern":"Anlage erstellen"})]})]})}function Zi(){const{anlagen:r,loading:s,error:t,createAnlage:n,updateAnlage:a,deleteAnlage:i}=Je(),[x,c]=l.useState(!1),[g,u]=l.useState(null),[d,p]=l.useState(null),m=async h=>{await n(h),c(!1)},o=async h=>{g&&(await a(g.id,h),u(null))},b=async()=>{d&&(await i(d.id),p(null))};return s?e.jsx(ve,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(le,{onClick:()=>c(!0),children:[e.jsx(Dt,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),t&&e.jsx(Q,{type:"error",children:t}),r.length===0?e.jsx(E,{children:e.jsx(xr,{icon:ae,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(le,{onClick:()=>c(!0),children:"Erste Anlage anlegen"})})}):e.jsx(E,{padding:"none",children:e.jsxs(vs,{children:[e.jsx(_s,{children:e.jsxs(hr,{children:[e.jsx(st,{children:"Name"}),e.jsx(st,{children:"Leistung"}),e.jsx(st,{children:"Standort"}),e.jsx(st,{children:"Ausrichtung"}),e.jsx(st,{children:"Installation"}),e.jsx(st,{className:"text-right",children:"Aktionen"})]})}),e.jsx(zs,{children:r.map(h=>e.jsxs(hr,{children:[e.jsx(at,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:h.anlagenname})]})}),e.jsxs(at,{children:[e.jsx("span",{className:"font-mono",children:h.leistung_kwp})," kWp"]}),e.jsx(at,{children:h.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(gt,{className:"h-4 w-4"}),h.standort_plz," ",h.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(at,{children:[h.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),h.neigung_grad&&` / ${h.neigung_grad}°`]}),e.jsx(at,{children:h.installationsdatum?new Date(h.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(at,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=zt.getPdfExportUrl(h.id)},title:"PDF-Dokumentation (Gesamtzeitraum)",children:e.jsx(Ur,{className:"h-4 w-4 text-orange-500"})}),e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=zt.getFullExportUrl(h.id)},title:"Export (JSON)",children:e.jsx(ot,{className:"h-4 w-4 text-blue-500"})}),e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>u(h),children:e.jsx(Ns,{className:"h-4 w-4"})}),e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>p(h),children:e.jsx(ht,{className:"h-4 w-4 text-red-500"})})]})})]},h.id))})]})}),e.jsx(mt,{isOpen:x,onClose:()=>c(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(qs,{onSubmit:m,onCancel:()=>c(!1)})}),e.jsx(mt,{isOpen:!!g,onClose:()=>u(null),title:"Anlage bearbeiten",size:"lg",children:g&&e.jsx(qs,{anlage:g,onSubmit:o,onCancel:()=>u(null)})}),e.jsx(mt,{isOpen:!!d,onClose:()=>p(null),title:"Anlage löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Anlage ",e.jsxs("strong",{children:['"',d==null?void 0:d.anlagenname,'"']})," wirklich löschen?"]}),e.jsx(Q,{type:"warning",children:"Alle zugehörigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelöscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(le,{variant:"secondary",onClick:()=>p(null),children:"Abbrechen"}),e.jsx(le,{variant:"danger",onClick:b,children:"Löschen"})]})]})})]})}function qi(){var I;const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(null),a=t??((I=r[0])==null?void 0:I.id),{strompreise:i,loading:x,error:c,createStrompreis:g,updateStrompreis:u,deleteStrompreis:d}=ti(a),[p,m]=l.useState(!1),[o,b]=l.useState(null),[h,y]=l.useState(null),[k,j]=l.useState(null),w=async C=>{try{j(null),await g(C),m(!1)}catch(P){j(P instanceof Error?P.message:"Fehler beim Erstellen")}},v=async C=>{if(o)try{j(null),await u(o.id,C),b(null)}catch(P){j(P instanceof Error?P.message:"Fehler beim Aktualisieren")}},N=async()=>{if(h)try{await d(h.id),y(null)}catch(C){j(C instanceof Error?C.message:"Fehler beim Löschen")}},f=C=>{const P=new Date().toISOString().split("T")[0],A=C.gueltig_ab<=P,z=!C.gueltig_bis||C.gueltig_bis>=P;return A&&z};if(s||x)return e.jsx(ve,{text:"Lade Strompreise..."});if(r.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const _=[...i].sort((C,P)=>{const A=f(C),z=f(P);return A!==z?A?-1:1:P.gueltig_ab.localeCompare(C.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[r.length>1&&e.jsx("select",{value:a??"",onChange:C=>n(Number(C.target.value)),className:"input w-auto",children:r.map(C=>e.jsx("option",{value:C.id,children:C.anlagenname},C.id))}),e.jsxs(le,{onClick:()=>m(!0),children:[e.jsx(Dt,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),c&&e.jsx(Q,{type:"error",children:c}),_.length>0&&f(_[0])&&e.jsx(E,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(Et,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",_[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[_[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," · ","Einspeisung: ",e.jsxs("strong",{children:[_[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),_[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" · Grundpreis: ",e.jsxs("strong",{children:[_[0].grundpreis_euro_monat.toFixed(2)," €/Monat"]})]})]})]})]})}),i.length===0?e.jsx(E,{children:e.jsx(xr,{icon:ye,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(le,{onClick:()=>m(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(E,{padding:"none",children:e.jsxs(vs,{children:[e.jsx(_s,{children:e.jsxs(hr,{children:[e.jsx(st,{children:"Tarif"}),e.jsx(st,{children:"Netzbezug"}),e.jsx(st,{children:"Einspeisung"}),e.jsx(st,{children:"Grundpreis"}),e.jsx(st,{children:"Gültigkeit"}),e.jsx(st,{className:"text-right",children:"Aktionen"})]})}),e.jsx(zs,{children:_.map(C=>{const P=f(C);return e.jsxs(hr,{className:P?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(at,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:`h-5 w-5 ${P?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:C.tarifname||"Standard"}),P&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),C.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:C.anbieter})]})]})}),e.jsxs(at,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:C.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(at,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:C.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(at,{children:C.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:C.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" €/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(at,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(it,{className:"h-4 w-4"}),new Date(C.gueltig_ab).toLocaleDateString("de-DE"),C.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(C.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(at,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>b(C),children:e.jsx(Ns,{className:"h-4 w-4"})}),e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>y(C),children:e.jsx(ht,{className:"h-4 w-4 text-red-500"})})]})})]},C.id)})})]})}),e.jsxs(E,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gültige Tarif wird automatisch für Berechnungen verwendet"}),e.jsx("li",{children:"Für historische Auswertungen werden die zum jeweiligen Zeitpunkt gültigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gültigkeitszeitraum korrekt setzen"})]})]}),e.jsx(mt,{isOpen:p,onClose:()=>{m(!1),j(null)},title:"Neuen Tarif anlegen",size:"lg",children:a&&e.jsx(Us,{anlageId:a,onCreate:w,onCancel:()=>{m(!1),j(null)},error:k})}),e.jsx(mt,{isOpen:!!o,onClose:()=>{b(null),j(null)},title:"Tarif bearbeiten",size:"lg",children:o&&e.jsx(Us,{strompreis:o,anlageId:o.anlage_id,onUpdate:v,onCancel:()=>{b(null),j(null)},error:k})}),e.jsx(mt,{isOpen:!!h,onClose:()=>y(null),title:"Tarif löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du den Tarif ",e.jsxs("strong",{children:['"',(h==null?void 0:h.tarifname)||"Standard",'"']})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(le,{variant:"secondary",onClick:()=>y(null),children:"Abbrechen"}),e.jsx(le,{variant:"danger",onClick:N,children:"Löschen"})]})]})})]})}function Us({strompreis:r,anlageId:s,onCreate:t,onUpdate:n,onCancel:a,error:i}){var m,o,b;const[x,c]=l.useState(!1),[g,u]=l.useState({tarifname:(r==null?void 0:r.tarifname)||"",anbieter:(r==null?void 0:r.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((m=r==null?void 0:r.netzbezug_arbeitspreis_cent_kwh)==null?void 0:m.toString())||"30",einspeiseverguetung_cent_kwh:((o=r==null?void 0:r.einspeiseverguetung_cent_kwh)==null?void 0:o.toString())||"8.2",grundpreis_euro_monat:((b=r==null?void 0:r.grundpreis_euro_monat)==null?void 0:b.toString())||"",gueltig_ab:(r==null?void 0:r.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(r==null?void 0:r.gueltig_bis)||"",vertragsart:(r==null?void 0:r.vertragsart)||""}),d=h=>{const{name:y,value:k}=h.target;u(j=>({...j,[y]:k}))},p=async h=>{h.preventDefault(),c(!0);try{const y={netzbezug_arbeitspreis_cent_kwh:parseFloat(g.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(g.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:g.grundpreis_euro_monat?parseFloat(g.grundpreis_euro_monat):void 0,gueltig_ab:g.gueltig_ab,gueltig_bis:g.gueltig_bis||void 0,tarifname:g.tarifname||void 0,anbieter:g.anbieter||void 0,vertragsart:g.vertragsart||void 0};r&&n?await n(y):t&&await t({...y,anlage_id:s})}finally{c(!1)}};return e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[i&&e.jsx(Q,{type:"error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Tarifname",name:"tarifname",value:g.tarifname,onChange:d,placeholder:"z.B. Grundversorgung, Öko-Strom"}),e.jsx(O,{label:"Anbieter",name:"anbieter",value:g.anbieter,onChange:d,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(O,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:g.netzbezug_arbeitspreis_cent_kwh,onChange:d,required:!0,hint:"Arbeitspreis für Strombezug"}),e.jsx(O,{label:"Einspeisevergütung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:g.einspeiseverguetung_cent_kwh,onChange:d,required:!0,hint:"EEG-Vergütung oder PPA-Preis"}),e.jsx(O,{label:"Grundpreis (€/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:g.grundpreis_euro_monat,onChange:d,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gültigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Gültig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:g.gueltig_ab,onChange:d,required:!0}),e.jsx(O,{label:"Gültig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:g.gueltig_bis,onChange:d,hint:"Leer lassen für unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:g.vertragsart,onChange:d,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte wählen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"Ökostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(le,{type:"button",variant:"secondary",onClick:a,children:"Abbrechen"}),e.jsx(le,{type:"submit",loading:x,children:r?"Speichern":"Anlegen"})]})]})}function Ui({typ:r,paramData:s,onChange:t,anlage:n,hasParent:a}){const[i,x]=l.useState(!1),[c,g]=l.useState(!1),u=a,d="Wechselrichter";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gerätedaten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Hersteller",name:"param_stamm_hersteller",value:s.stamm_hersteller||"",onChange:t,placeholder:"z.B. Fronius, BYD, Longi"}),e.jsx(O,{label:"Modell",name:"param_stamm_modell",value:s.stamm_modell||"",onChange:t,placeholder:"z.B. Symo GEN24 10.0"}),e.jsx(O,{label:"Seriennummer",name:"param_stamm_seriennummer",value:s.stamm_seriennummer||"",onChange:t,placeholder:r==="pv-module"?"z.B. SN001-SN020":"z.B. ABC123456"}),e.jsx(O,{label:"Garantie bis",name:"param_stamm_garantie_bis",type:"date",value:s.stamm_garantie_bis||"",onChange:t}),r==="wechselrichter"&&e.jsxs("div",{children:[e.jsx(O,{label:"MaStR-ID",name:"param_stamm_mastr_id",value:s.stamm_mastr_id||"",onChange:t,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID des Wechselrichters"}),s.stamm_mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${s.stamm_mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Kt,{className:"w-3 h-3"}),"Im MaStR öffnen"]})]}),r==="speicher"&&e.jsx(O,{label:"Garantie-Zyklen",name:"param_stamm_garantie_zyklen",type:"number",value:s.stamm_garantie_zyklen||"",onChange:t,placeholder:"z.B. 6000",hint:"Garantierte Ladezyklen"}),r==="pv-module"&&e.jsx(O,{label:"Leistungsgarantie (%)",name:"param_stamm_garantie_leistung_prozent",type:"number",min:"0",max:"100",value:s.stamm_garantie_leistung_prozent||"",onChange:t,placeholder:"z.B. 80",hint:"Garantierte Mindestleistung nach 25 Jahren"}),r==="e-auto"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:"Kennzeichen",name:"param_stamm_kennzeichen",value:s.stamm_kennzeichen||"",onChange:t,placeholder:"z.B. M-EE 1234"}),e.jsx(O,{label:"Fahrgestellnummer (VIN)",name:"param_stamm_fahrgestellnummer",value:s.stamm_fahrgestellnummer||"",onChange:t,placeholder:"z.B. WVWZZZ..."}),e.jsx(O,{label:"Erstzulassung",name:"param_stamm_erstzulassung",type:"date",value:s.stamm_erstzulassung||"",onChange:t}),e.jsx(O,{label:"Garantie Batterie (km)",name:"param_stamm_garantie_batterie_km",type:"number",value:s.stamm_garantie_batterie_km||"",onChange:t,placeholder:"z.B. 160000"})]}),(r==="waermepumpe"||r==="e-auto")&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:"Förderung Aktenzeichen",name:"param_stamm_foerderung_aktenzeichen",value:s.stamm_foerderung_aktenzeichen||"",onChange:t,placeholder:"z.B. BAFA-2024-12345"}),e.jsx(O,{label:"Förderbetrag (€)",name:"param_stamm_foerderung_betrag_euro",type:"number",value:s.stamm_foerderung_betrag_euro||"",onChange:t,placeholder:"z.B. 5000"})]}),r==="balkonkraftwerk"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:"Anmeldung Netzbetreiber",name:"param_stamm_anmeldung_netzbetreiber",type:"date",value:s.stamm_anmeldung_netzbetreiber||"",onChange:t}),e.jsx(O,{label:"Anmeldung MaStR",name:"param_stamm_anmeldung_marktstammdaten",type:"date",value:s.stamm_anmeldung_marktstammdaten||"",onChange:t})]})]}),e.jsx("div",{children:e.jsx(O,{label:"Notizen",name:"param_stamm_notizen",value:s.stamm_notizen||"",onChange:t,placeholder:"Optionale Anmerkungen zu diesem Gerät..."})})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>x(!i),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx($t,{className:"w-4 h-4 text-gray-500"}):e.jsx(vt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ansprechpartner"}),u&&!Yi(s)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",d,")"]})]})}),i&&e.jsxs("div",{className:"p-4 space-y-4",children:[u&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder übernehmen automatisch die Werte von ",d,". Nur bei Abweichung ausfüllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Firma",name:"param_ansprechpartner_firma",value:s.ansprechpartner_firma||"",onChange:t,placeholder:n?`(${d})`:"z.B. Solar Mustermann GmbH"}),e.jsx(O,{label:"Name",name:"param_ansprechpartner_name",value:s.ansprechpartner_name||"",onChange:t,placeholder:"Kontaktperson"}),e.jsx(O,{label:"Telefon",name:"param_ansprechpartner_telefon",value:s.ansprechpartner_telefon||"",onChange:t,placeholder:"+49 123 456789"}),e.jsx(O,{label:"E-Mail",name:"param_ansprechpartner_email",type:"email",value:s.ansprechpartner_email||"",onChange:t,placeholder:"service@beispiel.de"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(O,{label:"Ticketsystem / Support-Portal",name:"param_ansprechpartner_ticketsystem",value:s.ansprechpartner_ticketsystem||"",onChange:t,placeholder:"https://support.beispiel.de"}),s.ansprechpartner_ticketsystem&&e.jsxs("a",{href:s.ansprechpartner_ticketsystem,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Kt,{className:"w-3 h-3"}),"Portal öffnen"]})]}),e.jsx(O,{label:"Kundennummer",name:"param_ansprechpartner_kundennummer",value:s.ansprechpartner_kundennummer||"",onChange:t,placeholder:"z.B. K-12345"}),e.jsx(O,{label:"Vertragsnummer",name:"param_ansprechpartner_vertragsnummer",value:s.ansprechpartner_vertragsnummer||"",onChange:t,placeholder:"z.B. V-2024-001"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(O,{label:"Notizen",name:"param_ansprechpartner_notizen",value:s.ansprechpartner_notizen||"",onChange:t,placeholder:"Optionale Anmerkungen..."})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>g(!c),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx($t,{className:"w-4 h-4 text-gray-500"}):e.jsx(vt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wartungsvertrag"}),u&&!Qi(s)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",d,")"]})]})}),c&&e.jsxs("div",{className:"p-4 space-y-4",children:[u&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder übernehmen automatisch die Werte von ",d,". Nur bei Abweichung ausfüllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Vertragsnummer",name:"param_wartung_vertragsnummer",value:s.wartung_vertragsnummer||"",onChange:t,placeholder:"z.B. WV-2024-001"}),e.jsx(O,{label:"Anbieter",name:"param_wartung_anbieter",value:s.wartung_anbieter||"",onChange:t,placeholder:"z.B. Solar Mustermann GmbH"}),e.jsx(O,{label:"Gültig bis",name:"param_wartung_gueltig_bis",type:"date",value:s.wartung_gueltig_bis||"",onChange:t}),e.jsx(O,{label:"Kündigungsfrist",name:"param_wartung_kuendigungsfrist",value:s.wartung_kuendigungsfrist||"",onChange:t,placeholder:"z.B. 3 Monate zum Jahresende"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(O,{label:"Leistungsumfang",name:"param_wartung_leistungsumfang",value:s.wartung_leistungsumfang||"",onChange:t,placeholder:"z.B. Jährliche Inspektion, Reinigung, Fernüberwachung"})})]})]})]})]})}function Yi(r){return["ansprechpartner_firma","ansprechpartner_name","ansprechpartner_telefon","ansprechpartner_email","ansprechpartner_ticketsystem","ansprechpartner_kundennummer","ansprechpartner_vertragsnummer","ansprechpartner_notizen"].some(t=>r[t]&&String(r[t]).trim()!=="")}function Qi(r){return["wartung_vertragsnummer","wartung_anbieter","wartung_gueltig_bis","wartung_kuendigungsfrist","wartung_leistungsumfang"].some(t=>r[t]&&String(r[t]).trim()!=="")}const Xi={"pv-module":"wechselrichter",speicher:"wechselrichter"},el=["pv-module"],Lr={wechselrichter:"Wechselrichter"},is={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},tl={"e-auto":"Kosten eines vergleichbaren Verbrenners (für ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/Ölheizung (für ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function rl({investition:r,anlageId:s,typ:t,anlage:n,onSubmit:a,onCancel:i}){var C,P,A,z,S,W;const[x,c]=l.useState(!1),[g,u]=l.useState(null),[d,p]=l.useState([]),[m,o]=l.useState(!1),[b,h]=l.useState({bezeichnung:(r==null?void 0:r.bezeichnung)||`Mein ${is[t]}`,anschaffungsdatum:(r==null?void 0:r.anschaffungsdatum)||"",anschaffungskosten_gesamt:((C=r==null?void 0:r.anschaffungskosten_gesamt)==null?void 0:C.toString())||"",anschaffungskosten_alternativ:((P=r==null?void 0:r.anschaffungskosten_alternativ)==null?void 0:P.toString())||"",betriebskosten_jahr:((A=r==null?void 0:r.betriebskosten_jahr)==null?void 0:A.toString())||"",aktiv:(r==null?void 0:r.aktiv)??!0,parent_investition_id:((z=r==null?void 0:r.parent_investition_id)==null?void 0:z.toString())||"",leistung_kwp:((S=r==null?void 0:r.leistung_kwp)==null?void 0:S.toString())||"",ausrichtung:(r==null?void 0:r.ausrichtung)||"Süd",neigung_grad:((W=r==null?void 0:r.neigung_grad)==null?void 0:W.toString())||"30",ha_entity_id:(r==null?void 0:r.ha_entity_id)||""}),y=Xi[t],k=el.includes(t);l.useEffect(()=>{y&&(o(!0),Te.list(s,y,!0).then(V=>p(V.filter(oe=>oe.id!==(r==null?void 0:r.id)))).catch(()=>p([])).finally(()=>o(!1)))},[y,s,r==null?void 0:r.id]);const j=(r==null?void 0:r.parameter)||{},w=()=>{var V,oe,R,M,H,re,me,q,$,Z,G,U,ne,xe,Ne,ee,ue,Le,te,X,D,J,ie,we,Y,K,pe,We,Se;return{stamm_hersteller:((V=j.stamm_hersteller)==null?void 0:V.toString())||"",stamm_modell:((oe=j.stamm_modell)==null?void 0:oe.toString())||"",stamm_seriennummer:((R=j.stamm_seriennummer)==null?void 0:R.toString())||"",stamm_garantie_bis:((M=j.stamm_garantie_bis)==null?void 0:M.toString())||"",stamm_notizen:((H=j.stamm_notizen)==null?void 0:H.toString())||"",stamm_mastr_id:((re=j.stamm_mastr_id)==null?void 0:re.toString())||"",stamm_garantie_zyklen:((me=j.stamm_garantie_zyklen)==null?void 0:me.toString())||"",stamm_garantie_leistung_prozent:((q=j.stamm_garantie_leistung_prozent)==null?void 0:q.toString())||"",stamm_kennzeichen:(($=j.stamm_kennzeichen)==null?void 0:$.toString())||"",stamm_fahrgestellnummer:((Z=j.stamm_fahrgestellnummer)==null?void 0:Z.toString())||"",stamm_erstzulassung:((G=j.stamm_erstzulassung)==null?void 0:G.toString())||"",stamm_garantie_batterie_km:((U=j.stamm_garantie_batterie_km)==null?void 0:U.toString())||"",stamm_foerderung_aktenzeichen:((ne=j.stamm_foerderung_aktenzeichen)==null?void 0:ne.toString())||"",stamm_foerderung_betrag_euro:((xe=j.stamm_foerderung_betrag_euro)==null?void 0:xe.toString())||"",stamm_anmeldung_netzbetreiber:((Ne=j.stamm_anmeldung_netzbetreiber)==null?void 0:Ne.toString())||"",stamm_anmeldung_marktstammdaten:((ee=j.stamm_anmeldung_marktstammdaten)==null?void 0:ee.toString())||"",ansprechpartner_firma:((ue=j.ansprechpartner_firma)==null?void 0:ue.toString())||"",ansprechpartner_name:((Le=j.ansprechpartner_name)==null?void 0:Le.toString())||"",ansprechpartner_telefon:((te=j.ansprechpartner_telefon)==null?void 0:te.toString())||"",ansprechpartner_email:((X=j.ansprechpartner_email)==null?void 0:X.toString())||"",ansprechpartner_ticketsystem:((D=j.ansprechpartner_ticketsystem)==null?void 0:D.toString())||"",ansprechpartner_kundennummer:((J=j.ansprechpartner_kundennummer)==null?void 0:J.toString())||"",ansprechpartner_vertragsnummer:((ie=j.ansprechpartner_vertragsnummer)==null?void 0:ie.toString())||"",ansprechpartner_notizen:((we=j.ansprechpartner_notizen)==null?void 0:we.toString())||"",wartung_vertragsnummer:((Y=j.wartung_vertragsnummer)==null?void 0:Y.toString())||"",wartung_anbieter:((K=j.wartung_anbieter)==null?void 0:K.toString())||"",wartung_gueltig_bis:((pe=j.wartung_gueltig_bis)==null?void 0:pe.toString())||"",wartung_kuendigungsfrist:((We=j.wartung_kuendigungsfrist)==null?void 0:We.toString())||"",wartung_leistungsumfang:((Se=j.wartung_leistungsumfang)==null?void 0:Se.toString())||""}},v=()=>{var oe,R,M,H,re,me,q,$,Z,G,U,ne,xe,Ne,ee,ue,Le,te,X,D,J,ie,we,Y,K,pe,We,Se,xt,L,he,Ce,Pe,Fe,Ue,mr,Fr,Fs;const V=w();switch(t){case"e-auto":return{...V,batteriekapazitaet_kwh:((oe=j.batteriekapazitaet_kwh)==null?void 0:oe.toString())||"",verbrauch_kwh_100km:((R=j.verbrauch_kwh_100km)==null?void 0:R.toString())||"18",jahresfahrleistung_km:((M=j.jahresfahrleistung_km)==null?void 0:M.toString())||"15000",pv_ladeanteil_prozent:((H=j.pv_ladeanteil_prozent)==null?void 0:H.toString())||"60",vergleich_verbrauch_l_100km:((re=j.vergleich_verbrauch_l_100km)==null?void 0:re.toString())||"7.5",benzinpreis_euro:((me=j.benzinpreis_euro)==null?void 0:me.toString())||"1.65",v2h_faehig:j.v2h_faehig??!1,v2h_entladeleistung_kw:((q=j.v2h_entladeleistung_kw)==null?void 0:q.toString())||""};case"speicher":return{...V,kapazitaet_kwh:(($=j.kapazitaet_kwh)==null?void 0:$.toString())||"",nutzbare_kapazitaet_kwh:((Z=j.nutzbare_kapazitaet_kwh)==null?void 0:Z.toString())||"",max_ladeleistung_kw:((G=j.max_ladeleistung_kw)==null?void 0:G.toString())||"",max_entladeleistung_kw:((U=j.max_entladeleistung_kw)==null?void 0:U.toString())||"",wirkungsgrad_prozent:((ne=j.wirkungsgrad_prozent)==null?void 0:ne.toString())||"95",arbitrage_faehig:j.arbitrage_faehig??!1};case"waermepumpe":return{...V,leistung_kw:((xe=j.leistung_kw)==null?void 0:xe.toString())||"",effizienz_modus:((Ne=j.effizienz_modus)==null?void 0:Ne.toString())||"gesamt_jaz",jaz:((ee=j.jaz)==null?void 0:ee.toString())||"3.5",scop_heizung:((ue=j.scop_heizung)==null?void 0:ue.toString())||"4.5",scop_warmwasser:((Le=j.scop_warmwasser)==null?void 0:Le.toString())||"3.2",vorlauftemperatur:((te=j.vorlauftemperatur)==null?void 0:te.toString())||"35",cop_heizung:((X=j.cop_heizung)==null?void 0:X.toString())||"3.9",cop_warmwasser:((D=j.cop_warmwasser)==null?void 0:D.toString())||"3.0",heizwaermebedarf_kwh:((J=j.heizwaermebedarf_kwh)==null?void 0:J.toString())||"12000",warmwasserbedarf_kwh:((ie=j.warmwasserbedarf_kwh)==null?void 0:ie.toString())||"3000",pv_anteil_prozent:((we=j.pv_anteil_prozent)==null?void 0:we.toString())||"30",alter_energietraeger:((Y=j.alter_energietraeger)==null?void 0:Y.toString())||"gas",alter_preis_cent_kwh:((K=j.alter_preis_cent_kwh)==null?void 0:K.toString())||"12",sg_ready:j.sg_ready??!1};case"wallbox":return{...V,max_ladeleistung_kw:((pe=j.max_ladeleistung_kw)==null?void 0:pe.toString())||"11",bidirektional:j.bidirektional??!1,pv_optimiert:j.pv_optimiert??!0};case"wechselrichter":return{...V,max_leistung_kw:((We=j.max_leistung_kw)==null?void 0:We.toString())||"",wirkungsgrad_prozent:((Se=j.wirkungsgrad_prozent)==null?void 0:Se.toString())||"97",hybrid:j.hybrid??!1};case"pv-module":return{...V,anzahl_module:((xt=j.anzahl_module)==null?void 0:xt.toString())||"",modul_leistung_wp:((L=j.modul_leistung_wp)==null?void 0:L.toString())||"",modul_typ:((he=j.modul_typ)==null?void 0:he.toString())||""};case"balkonkraftwerk":return{...V,leistung_wp:((Ce=j.leistung_wp)==null?void 0:Ce.toString())||"",anzahl:((Pe=j.anzahl)==null?void 0:Pe.toString())||"2",ausrichtung:((Fe=j.ausrichtung)==null?void 0:Fe.toString())||"Süd",neigung_grad:((Ue=j.neigung_grad)==null?void 0:Ue.toString())||"30",hat_speicher:j.hat_speicher??!1,speicher_kapazitaet_wh:((mr=j.speicher_kapazitaet_wh)==null?void 0:mr.toString())||""};case"sonstiges":return{...V,kategorie:((Fr=j.kategorie)==null?void 0:Fr.toString())||"erzeuger",beschreibung:((Fs=j.beschreibung)==null?void 0:Fs.toString())||""};default:return V}},[N,f]=l.useState(v),_=V=>{const{name:oe,value:R,type:M,checked:H}=V.target;if(oe.startsWith("param_")){const re=oe.replace("param_","");f(me=>({...me,[re]:M==="checkbox"?H:R}))}else h(re=>({...re,[oe]:M==="checkbox"?H:R}))},I=async V=>{if(V.preventDefault(),u(null),!b.bezeichnung.trim()){u("Bitte eine Bezeichnung eingeben");return}try{c(!0);const oe=["stamm_garantie_bis","stamm_erstzulassung","wartung_gueltig_bis","stamm_anmeldung_netzbetreiber","stamm_anmeldung_marktstammdaten"],R={};if(Object.entries(N).forEach(([q,$])=>{if(typeof $=="boolean")R[q]=$;else if($!=="")if(oe.includes(q))R[q]=$;else{const Z=parseFloat($);R[q]=isNaN(Z)?$:Z}}),k&&d.length>0&&!b.parent_investition_id){u(`${is[t]} müssen einem ${Lr[y]||y} zugeordnet werden`);return}let M,H,re;if(t==="balkonkraftwerk"){const q=parseInt(N.anzahl)||0,$=parseInt(N.leistung_wp)||0;q>0&&$>0&&(M=q*$/1e3),H=N.ausrichtung||void 0,re=N.neigung_grad?parseFloat(N.neigung_grad):void 0}const me={...r?{}:{anlage_id:s,typ:t},bezeichnung:b.bezeichnung.trim(),anschaffungsdatum:b.anschaffungsdatum||void 0,anschaffungskosten_gesamt:b.anschaffungskosten_gesamt?parseFloat(b.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:b.anschaffungskosten_alternativ?parseFloat(b.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:b.betriebskosten_jahr?parseFloat(b.betriebskosten_jahr):void 0,aktiv:b.aktiv,parameter:Object.keys(R).length>0?R:void 0,parent_investition_id:b.parent_investition_id?parseInt(b.parent_investition_id):void 0,...t==="pv-module"&&{leistung_kwp:b.leistung_kwp?parseFloat(b.leistung_kwp):void 0,ausrichtung:b.ausrichtung||void 0,neigung_grad:b.neigung_grad?parseFloat(b.neigung_grad):void 0,ha_entity_id:b.ha_entity_id||void 0},...t==="balkonkraftwerk"&&{leistung_kwp:M,ausrichtung:H,neigung_grad:re}};await a(me)}catch(oe){u(oe instanceof Error?oe.message:"Fehler beim Speichern")}finally{c(!1)}};return e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[g&&e.jsx(Q,{type:"error",children:g}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Bezeichnung",name:"bezeichnung",value:b.bezeichnung,onChange:_,required:!0}),e.jsx(O,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:b.anschaffungsdatum,onChange:_}),e.jsx(O,{label:"Anschaffungskosten (€)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:b.anschaffungskosten_gesamt,onChange:_,hint:"Gesamtkosten inkl. Installation"}),e.jsx(O,{label:"Alternative Kosten (€)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:b.anschaffungskosten_alternativ,onChange:_,hint:tl[t]}),e.jsx(O,{label:"Betriebskosten/Jahr (€)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:b.betriebskosten_jahr,onChange:_,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:b.aktiv,onChange:_,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen berücksichtigen)"})]})]}),y&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",Lr[y]||y,")",k?" *":" (optional)",m&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:b.parent_investition_id,onChange:V=>h(oe=>({...oe,parent_investition_id:V.target.value})),className:`input w-full ${k&&!b.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:k,children:[e.jsx("option",{value:"",children:k?"-- Bitte wählen --":"-- Keine Zuordnung --"}),d.map(V=>e.jsx("option",{value:V.id,children:V.bezeichnung},V.id))]}),k&&!b.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),t==="pv-module"?"PV-Module müssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):m?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 flex-shrink-0"}),k?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:Lr[y]||y})," an, bevor Sie ",is[t]," erstellen können."]}):e.jsxs("span",{children:["Kein ",Lr[y]||y," vorhanden. Zuordnung ist optional."]})]})})]})]}),t==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:b.leistung_kwp,onChange:_,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:b.ausrichtung,onChange:V=>h(oe=>({...oe,ausrichtung:V.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(O,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:b.neigung_grad,onChange:_,hint:"0° = flach, 90° = senkrecht"})]})]}),e.jsx(sl,{typ:t,paramData:N,onChange:_}),e.jsx(Ui,{typ:t,paramData:N,onChange:_,anlage:n,hasParent:!!b.parent_investition_id}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(le,{type:"button",variant:"secondary",onClick:i,children:"Abbrechen"}),e.jsx(le,{type:"submit",loading:x,children:r?"Speichern":"Erstellen"})]})]})}function sl({typ:r,paramData:s,onChange:t}){switch(r){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Batteriekapazität (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:s.batteriekapazitaet_kwh,onChange:t}),e.jsx(O,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:s.verbrauch_kwh_100km,onChange:t}),e.jsx(O,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:s.jahresfahrleistung_km,onChange:t}),e.jsx(O,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:s.pv_ladeanteil_prozent,onChange:t,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:s.vergleich_verbrauch_l_100km,onChange:t,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(O,{label:"Benzinpreis (€/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:s.benzinpreis_euro,onChange:t,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:s.v2h_faehig,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fähig (Vehicle-to-Home)"})]}),s.v2h_faehig&&e.jsx(O,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:s.v2h_entladeleistung_kw,onChange:t})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Kapazität (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:s.kapazitaet_kwh,onChange:t}),e.jsx(O,{label:"Nutzbare Kapazität (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:s.nutzbare_kapazitaet_kwh,onChange:t,hint:"Typisch 90-95% der Gesamtkapazität"}),e.jsx(O,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:s.max_ladeleistung_kw,onChange:t}),e.jsx(O,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:s.max_entladeleistung_kw,onChange:t}),e.jsx(O,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:s.wirkungsgrad_prozent,onChange:t})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:s.arbitrage_faehig,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fähig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":{const a=s.effizienz_modus;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wärmepumpe Parameter"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Berechnungsmodus für Effizienz"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"gesamt_jaz",checked:a==="gesamt_jaz",onChange:t,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Jahresarbeitszahl (JAZ) - Gemessen vor Ort"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"scop",checked:a==="scop",onChange:t,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"SCOP (EU-Energielabel) - Aus Datenblatt"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"getrennte_cops",checked:a==="getrennte_cops",onChange:t,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Getrennte COPs (Heizung/Warmwasser)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a==="getrennte_cops"?"Separate COPs für Heizung (~3,9) und Warmwasser (~3,0) - präziser bei unterschiedlichen Betriebspunkten":a==="scop"?"EU-genormter SCOP vom Energielabel - realistischer als Hersteller-COP, aber standortunabhängig":"Gemessene Jahresarbeitszahl am eigenen Standort - der genaueste Wert, wenn verfügbar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:s.leistung_kw,onChange:t,hint:"Thermische Leistung"}),a==="gesamt_jaz"&&e.jsx(O,{label:"Jahresarbeitszahl (JAZ)",name:"param_jaz",type:"number",step:"0.1",min:"1",max:"10",value:s.jaz,onChange:t,hint:"Typisch 3-4 für Luft-WP, 4-5 für Sole-WP",required:!0}),a==="scop"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:"SCOP Heizung",name:"param_scop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:s.scop_heizung,onChange:t,hint:"Vom EU-Energielabel (z.B. 4,5)",required:!0}),e.jsx(O,{label:"SCOP Warmwasser",name:"param_scop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:s.scop_warmwasser,onChange:t,hint:"Typisch 2,8-3,5",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vorlauftemperatur (EU-Label)"}),e.jsxs("select",{name:"param_vorlauftemperatur",value:s.vorlauftemperatur,onChange:i=>t({target:{name:"param_vorlauftemperatur",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"35",children:"35°C (Fußbodenheizung)"}),e.jsx("option",{value:"55",children:"55°C (Heizkörper)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SCOP-Wert muss zur Vorlauftemperatur passen"})]})]}),a==="getrennte_cops"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{label:"COP Heizung",name:"param_cop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:s.cop_heizung,onChange:t,hint:"Typisch 3,5-4,5 (Vorlauf 35°C)",required:!0}),e.jsx(O,{label:"COP Warmwasser",name:"param_cop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:s.cop_warmwasser,onChange:t,hint:"Typisch 2,5-3,5 (Vorlauf 55°C)",required:!0})]}),e.jsx(O,{label:"Heizwärmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:s.heizwaermebedarf_kwh,onChange:t,hint:"Aus Energieausweis oder Schätzung"}),e.jsx(O,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:s.warmwasserbedarf_kwh,onChange:t,hint:"~500 kWh/Person/Jahr typisch"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Vergleich mit alter Heizung (für ROI-Berechnung)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Alter Energieträger"}),e.jsxs("select",{name:"param_alter_energietraeger",value:s.alter_energietraeger,onChange:i=>t({target:{name:"param_alter_energietraeger",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"gas",children:"Erdgas"}),e.jsx("option",{value:"oel",children:"Heizöl"}),e.jsx("option",{value:"strom",children:"Strom (Direktheizung)"})]})]}),e.jsx(O,{label:"Alter Preis (ct/kWh)",name:"param_alter_preis_cent_kwh",type:"number",step:"0.1",min:"0",value:s.alter_preis_cent_kwh,onChange:t,hint:"Gas ~12 ct, Öl ~10 ct"}),e.jsx(O,{label:"PV-Anteil (%)",name:"param_pv_anteil_prozent",type:"number",step:"1",min:"0",max:"100",value:s.pv_anteil_prozent,onChange:t,hint:"Anteil des WP-Stroms aus PV"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:s.sg_ready,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fähig)"})]})]})}case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(O,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:s.max_ladeleistung_kw,onChange:t,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:s.bidirektional,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:s.pv_optimiert,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-Überschussladen möglich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:s.max_leistung_kw,onChange:t}),e.jsx(O,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:s.wirkungsgrad_prozent,onChange:t})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:s.hybrid,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:s.anzahl_module,onChange:t,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(O,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:s.modul_leistung_wp,onChange:t,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(O,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:s.modul_typ,onChange:t,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),s.anzahl_module&&s.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(s.anzahl_module)||0)*(parseInt(s.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const n=(parseInt(s.anzahl)||0)*(parseInt(s.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:s.anzahl,onChange:t}),e.jsx(O,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:s.leistung_wp,onChange:t,hint:n>0?`= ${n.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:s.ausrichtung,onChange:a=>t({target:{name:"param_ausrichtung",value:a.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(O,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:s.neigung_grad,onChange:t,hint:"0° = flach, 90° = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:s.hat_speicher,onChange:t,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),s.hat_speicher&&e.jsx(O,{label:"Speicher-Kapazität (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:s.speicher_kapazitaet_wh,onChange:t,hint:"z.B. 1600 Wh für Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:s.kategorie,onChange:a=>t({target:{name:"param_kategorie",value:a.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(O,{label:"Beschreibung",name:"param_beschreibung",value:s.beschreibung,onChange:t,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const ls=[{typ:"e-auto",label:"E-Auto",icon:Ae,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wärmepumpe",icon:Ke,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:ze,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:pt,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:Tt,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:ae,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:wa,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:Tt,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function al(){var A;const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(null),[a,i]=l.useState(!1),[x,c]=l.useState(null),[g,u]=l.useState(null),[d,p]=l.useState(null),[m,o]=l.useState(null),b=t??((A=r[0])==null?void 0:A.id),h=r.find(z=>z.id===b)??null,{investitionen:y,loading:k,createInvestition:j,updateInvestition:w,deleteInvestition:v}=zr(b),N=ei(y),f=l.useMemo(()=>{const z={};return ls.forEach(S=>{var W;z[S.typ]=((W=N[S.typ])==null?void 0:W.length)||0}),z},[N]),_=z=>{u(z),c(null),i(!0)},I=z=>{c(z),u(z.typ),i(!0)},C=async z=>{try{x?await w(x.id,z):await j(z),i(!1),c(null),u(null)}catch(S){o(S instanceof Error?S.message:"Fehler beim Speichern")}},P=async()=>{if(d)try{await v(d.id),p(null)}catch(z){o(z instanceof Error?z.message:"Fehler beim Löschen")}};return s||k?e.jsx(ve,{text:"Lade Investitionen..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:r.length>1&&e.jsx("select",{value:b??"",onChange:z=>n(Number(z.target.value)),className:"input w-auto",children:r.map(z=>e.jsx("option",{value:z.id,children:z.anlagenname},z.id))})})]}),m&&e.jsx(Q,{type:"error",onClose:()=>o(null),children:m}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:ls.map(z=>e.jsxs("button",{onClick:()=>_(z.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${z.bgColor}`,children:[e.jsx(z.icon,{className:`h-8 w-8 mx-auto ${z.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:z.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[f[z.typ]," vorhanden"]})]},z.typ))}),y.length===0?e.jsx(xr,{icon:Qt,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wärmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(le,{onClick:()=>_("speicher"),children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:ls.map(z=>{const S=N[z.typ];return!S||S.length===0?null:e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${z.bgColor}`,children:e.jsx(z.icon,{className:`h-5 w-5 ${z.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:z.label})]}),e.jsx(le,{variant:"secondary",size:"sm",onClick:()=>_(z.typ),children:e.jsx(Dt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:S.map(W=>e.jsx(nl,{investition:W,onEdit:()=>I(W),onDelete:()=>p(W)},W.id))})]},z.typ)})}),e.jsx(mt,{isOpen:a,onClose:()=>{i(!1),c(null),u(null)},title:x?"Investition bearbeiten":"Neue Investition",size:"lg",children:g&&b&&e.jsx(rl,{investition:x,anlageId:b,typ:g,anlage:h,onSubmit:C,onCancel:()=>{i(!1),c(null),u(null)}})}),e.jsxs(mt,{isOpen:!!d,onClose:()=>p(null),title:"Investition löschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Möchtest du die Investition "',d==null?void 0:d.bezeichnung,'" wirklich löschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(le,{variant:"secondary",onClick:()=>p(null),children:"Abbrechen"}),e.jsx(le,{variant:"danger",onClick:P,children:"Löschen"})]})]})]})}function nl({investition:r,onEdit:s,onDelete:t}){const n=r.parameter||{},i=(()=>{const c=[];switch(r.typ){case"e-auto":n.batteriekapazitaet_kwh&&c.push(`${n.batteriekapazitaet_kwh} kWh Batterie`),n.verbrauch_kwh_100km&&c.push(`${n.verbrauch_kwh_100km} kWh/100km`),n.v2h_faehig&&c.push("V2H fähig");break;case"speicher":n.kapazitaet_kwh&&c.push(`${n.kapazitaet_kwh} kWh`),n.nutzbare_kapazitaet_kwh&&c.push(`${n.nutzbare_kapazitaet_kwh} kWh nutzbar`),n.arbitrage_faehig&&c.push("Arbitrage");break;case"waermepumpe":n.leistung_kw&&c.push(`${n.leistung_kw} kW`),n.cop&&c.push(`COP ${n.cop}`);break;case"wallbox":n.max_ladeleistung_kw&&c.push(`${n.max_ladeleistung_kw} kW`),n.bidirektional&&c.push("Bidirektional");break;case"wechselrichter":n.max_leistung_kw&&c.push(`${n.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":n.leistung_wp&&c.push(`${n.leistung_wp} Wp`),n.anzahl&&c.push(`${n.anzahl} Module`);break}return c})(),x=r.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${r.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:r.bezeichnung}),!r.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join(" • ")}),x&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[x.toLocaleString("de-DE")," €"]}),r.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(r.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(vn,{className:"h-4 w-4"})}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Löschen",children:e.jsx(ht,{className:"h-4 w-4"})})]})]})}const il=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"März"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function Ys({monatsdaten:r,anlageId:s,onSubmit:t,onCancel:n,haVorausfuellung:a}){var q,$,Z,G,U,ne,xe,Ne,ee,ue,Le;const i=new Date().getFullYear(),x=new Date().getMonth()+1,[c,g]=l.useState(!1),[u,d]=l.useState(null),{investitionen:p,loading:m}=zr(s),o=l.useMemo(()=>p.filter(te=>te.aktiv),[p]),b=o.some(te=>te.typ==="speicher"),h=o.some(te=>te.typ==="e-auto"),y=o.some(te=>te.typ==="wallbox"),k=o.some(te=>te.typ==="waermepumpe"),j=o.some(te=>te.typ==="wechselrichter"),w=o.some(te=>te.typ==="pv-module"),v=o.some(te=>te.typ==="balkonkraftwerk"),N=o.some(te=>te.typ==="sonstiges"),f=te=>{if(!a)return"";const X=a.basis.find(D=>D.feld===te);return(X==null?void 0:X.wert)!==null&&(X==null?void 0:X.wert)!==void 0?X.wert.toString():""},[_,I]=l.useState({jahr:((q=a==null?void 0:a.jahr)==null?void 0:q.toString())||(($=r==null?void 0:r.jahr)==null?void 0:$.toString())||i.toString(),monat:((Z=a==null?void 0:a.monat)==null?void 0:Z.toString())||((G=r==null?void 0:r.monat)==null?void 0:G.toString())||x.toString(),einspeisung_kwh:f("einspeisung")||((U=r==null?void 0:r.einspeisung_kwh)==null?void 0:U.toString())||"",netzbezug_kwh:f("netzbezug")||((ne=r==null?void 0:r.netzbezug_kwh)==null?void 0:ne.toString())||"",pv_erzeugung_kwh:((xe=r==null?void 0:r.pv_erzeugung_kwh)==null?void 0:xe.toString())||"",batterie_ladung_kwh:((Ne=r==null?void 0:r.batterie_ladung_kwh)==null?void 0:Ne.toString())||"",batterie_entladung_kwh:((ee=r==null?void 0:r.batterie_entladung_kwh)==null?void 0:ee.toString())||"",globalstrahlung_kwh_m2:((ue=r==null?void 0:r.globalstrahlung_kwh_m2)==null?void 0:ue.toString())||"",sonnenstunden:((Le=r==null?void 0:r.sonnenstunden)==null?void 0:Le.toString())||"",notizen:(r==null?void 0:r.notizen)||""}),[C,P]=l.useState(!1),[A,z]=l.useState(null),[S,W]=l.useState({}),[V,oe]=l.useState(!1);l.useEffect(()=>{if(o.length===0)return;(async()=>{const X={};if(o.forEach(D=>{var J,ie;if(D.typ==="e-auto")X[D.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(D.typ==="speicher")X[D.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(D.typ==="wallbox")X[D.id]={ladung_kwh:"",ladevorgaenge:""};else if(D.typ==="waermepumpe")X[D.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(D.typ==="wechselrichter")X[D.id]={pv_erzeugung_kwh:""};else if(D.typ==="pv-module")X[D.id]={pv_erzeugung_kwh:""};else if(D.typ==="balkonkraftwerk"){const we=(J=D.parameter)==null?void 0:J.hat_speicher,Y={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};we?X[D.id]={...Y,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:X[D.id]=Y}else if(D.typ==="sonstiges"){const we=((ie=D.parameter)==null?void 0:ie.kategorie)||"erzeuger";we==="erzeuger"?X[D.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:we==="verbraucher"?X[D.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:we==="speicher"&&(X[D.id]={ladung_kwh:"",entladung_kwh:""})}X[D.id]&&(X[D.id].sonderkosten_euro="",X[D.id].sonderkosten_notiz="")}),r!=null&&r.jahr&&(r!=null&&r.monat)){oe(!0);try{const D=await Te.getMonatsdatenByMonth(s,r.jahr,r.monat);D.forEach(K=>{const pe=String(K.investition_id);X[pe]&&K.verbrauch_daten&&Object.entries(K.verbrauch_daten).forEach(([We,Se])=>{X[pe][We]!==void 0&&(X[pe][We]=(Se==null?void 0:Se.toString())||""),We==="v2h_entladung_kwh"&&X[pe].entladung_v2h_kwh!==void 0&&(X[pe].entladung_v2h_kwh=(Se==null?void 0:Se.toString())||""),We==="erzeugung_kwh"&&X[pe].pv_erzeugung_kwh!==void 0&&(X[pe].pv_erzeugung_kwh=(Se==null?void 0:Se.toString())||""),We==="verbrauch_kwh"&&X[pe].verbrauch_sonstig_kwh!==void 0&&(X[pe].verbrauch_sonstig_kwh=(Se==null?void 0:Se.toString())||"")})});const J=o.filter(K=>K.typ==="speicher"),ie=new Set(D.filter(K=>J.some(pe=>pe.id===K.investition_id)).map(K=>K.investition_id)),we=(r==null?void 0:r.batterie_ladung_kwh)||0,Y=(r==null?void 0:r.batterie_entladung_kwh)||0;if(J.length>0&&(we>0||Y>0)){const K=J.filter(pe=>!ie.has(pe.id));if(K.length>0){const pe=1/K.length;K.forEach(We=>{const Se=String(We.id);X[Se]&&(X[Se].ladung_kwh=(we*pe).toFixed(1),X[Se].entladung_kwh=(Y*pe).toFixed(1))}),console.info(`Migration: Legacy-Speicherdaten (${we}/${Y} kWh) auf ${K.length} Speicher übertragen`)}}}catch(D){console.error("Fehler beim Laden der InvestitionMonatsdaten:",D)}finally{oe(!1)}}a!=null&&a.investitionen&&(a.investitionen.forEach(D=>{const J=String(D.investition_id);X[J]&&D.felder.forEach(({feld:ie,wert:we})=>{we!=null&&(X[J][ie]!==void 0&&(X[J][ie]=we.toString()),ie==="pv_erzeugung_kwh"&&X[J].pv_erzeugung_kwh!==void 0&&(X[J].pv_erzeugung_kwh=we.toString()),ie==="ladung_kwh"&&X[J].ladung_kwh!==void 0&&(X[J].ladung_kwh=we.toString()),ie==="entladung_kwh"&&X[J].entladung_kwh!==void 0&&(X[J].entladung_kwh=we.toString()),ie==="ladung_pv_kwh"&&X[J].ladung_pv_kwh!==void 0&&(X[J].ladung_pv_kwh=we.toString()),ie==="ladung_netz_kwh"&&X[J].ladung_netz_kwh!==void 0&&(X[J].ladung_netz_kwh=we.toString()),ie==="km_gefahren"&&X[J].km_gefahren!==void 0&&(X[J].km_gefahren=we.toString()))})}),console.info("HA-Vorausfüllung: Investitionswerte aus HA-Statistik eingefügt")),W(X)})()},[o,r==null?void 0:r.jahr,r==null?void 0:r.monat,s,a]);const R=te=>{const{name:X,value:D}=te.target;I(J=>({...J,[X]:D}))},M=(te,X,D)=>{W(J=>({...J,[te]:{...J[te],[X]:D}}))},H=l.useMemo(()=>{let te=0,X=0,D=0;return o.forEach(J=>{var we,Y;const ie=S[J.id];ie&&(J.typ==="speicher"?(te+=parseFloat(ie.ladung_kwh)||0,X+=parseFloat(ie.entladung_kwh)||0):J.typ==="pv-module"||J.typ==="wechselrichter"||J.typ==="balkonkraftwerk"?(D+=parseFloat(ie.pv_erzeugung_kwh)||0,J.typ==="balkonkraftwerk"&&((we=J.parameter)!=null&&we.hat_speicher)&&(te+=parseFloat(ie.speicher_ladung_kwh)||0,X+=parseFloat(ie.speicher_entladung_kwh)||0)):J.typ==="sonstiges"&&((Y=J.parameter)==null?void 0:Y.kategorie)==="erzeuger"&&(D+=parseFloat(ie.erzeugung_kwh)||0))}),{batterieLadung:te,batterieEntladung:X,pvErzeugung:D}},[o,S]),re=async()=>{if(!_.jahr||!_.monat){d("Bitte zuerst Jahr und Monat auswählen");return}P(!0),z(null),d(null);try{const te=await Qr.getMonatsdaten(s,parseInt(_.jahr),parseInt(_.monat));I(D=>({...D,globalstrahlung_kwh_m2:te.globalstrahlung_kwh_m2.toString(),sonnenstunden:te.sonnenstunden.toString()}));const X=te.datenquelle==="open-meteo"?`Historische Daten von Open-Meteo${te.abdeckung_prozent?` (${te.abdeckung_prozent}% Abdeckung)`:""}`:te.datenquelle==="pvgis-tmy"?"Durchschnittswerte von PVGIS (TMY)":"Geschätzte Durchschnittswerte";z(X)}catch(te){d(te instanceof Error?te.message:"Wetterdaten konnten nicht abgerufen werden")}finally{P(!1)}},me=async te=>{if(te.preventDefault(),d(null),!_.einspeisung_kwh||!_.netzbezug_kwh){d("Bitte Einspeisung und Netzbezug eingeben");return}try{g(!0);const X={};o.forEach(we=>{const Y=S[we.id];if(!Y)return;const K={};we.typ==="e-auto"?(Y.km_gefahren&&(K.km_gefahren=parseFloat(Y.km_gefahren)),Y.verbrauch_kwh&&(K.verbrauch_kwh=parseFloat(Y.verbrauch_kwh)),Y.ladung_pv_kwh&&(K.ladung_pv_kwh=parseFloat(Y.ladung_pv_kwh)),Y.ladung_netz_kwh&&(K.ladung_netz_kwh=parseFloat(Y.ladung_netz_kwh)),Y.ladung_extern_kwh&&(K.ladung_extern_kwh=parseFloat(Y.ladung_extern_kwh)),Y.ladung_extern_euro&&(K.ladung_extern_euro=parseFloat(Y.ladung_extern_euro)),Y.entladung_v2h_kwh&&(K.v2h_entladung_kwh=parseFloat(Y.entladung_v2h_kwh))):we.typ==="speicher"?(Y.ladung_kwh&&(K.ladung_kwh=parseFloat(Y.ladung_kwh)),Y.entladung_kwh&&(K.entladung_kwh=parseFloat(Y.entladung_kwh)),Y.speicher_ladung_netz_kwh&&(K.speicher_ladung_netz_kwh=parseFloat(Y.speicher_ladung_netz_kwh)),Y.speicher_ladepreis_cent&&(K.speicher_ladepreis_cent=parseFloat(Y.speicher_ladepreis_cent))):we.typ==="wallbox"?(Y.ladung_kwh&&(K.ladung_kwh=parseFloat(Y.ladung_kwh)),Y.ladevorgaenge&&(K.ladevorgaenge=parseInt(Y.ladevorgaenge))):we.typ==="waermepumpe"?(Y.stromverbrauch_kwh&&(K.stromverbrauch_kwh=parseFloat(Y.stromverbrauch_kwh)),Y.heizenergie_kwh&&(K.heizenergie_kwh=parseFloat(Y.heizenergie_kwh)),Y.warmwasser_kwh&&(K.warmwasser_kwh=parseFloat(Y.warmwasser_kwh))):we.typ==="wechselrichter"||we.typ==="pv-module"?Y.pv_erzeugung_kwh&&(K.pv_erzeugung_kwh=parseFloat(Y.pv_erzeugung_kwh)):we.typ==="balkonkraftwerk"?(Y.pv_erzeugung_kwh&&(K.erzeugung_kwh=parseFloat(Y.pv_erzeugung_kwh)),Y.eigenverbrauch_kwh&&(K.eigenverbrauch_kwh=parseFloat(Y.eigenverbrauch_kwh)),Y.einspeisung_kwh&&(K.einspeisung_kwh=parseFloat(Y.einspeisung_kwh)),Y.speicher_ladung_kwh&&(K.speicher_ladung_kwh=parseFloat(Y.speicher_ladung_kwh)),Y.speicher_entladung_kwh&&(K.speicher_entladung_kwh=parseFloat(Y.speicher_entladung_kwh))):we.typ==="sonstiges"&&(Y.erzeugung_kwh&&(K.erzeugung_kwh=parseFloat(Y.erzeugung_kwh)),Y.eigenverbrauch_kwh&&(K.eigenverbrauch_kwh=parseFloat(Y.eigenverbrauch_kwh)),Y.einspeisung_kwh&&(K.einspeisung_kwh=parseFloat(Y.einspeisung_kwh)),Y.verbrauch_sonstig_kwh&&(K.verbrauch_kwh=parseFloat(Y.verbrauch_sonstig_kwh)),Y.bezug_pv_kwh&&(K.bezug_pv_kwh=parseFloat(Y.bezug_pv_kwh)),Y.bezug_netz_kwh&&(K.bezug_netz_kwh=parseFloat(Y.bezug_netz_kwh)),Y.ladung_kwh&&(K.ladung_kwh=parseFloat(Y.ladung_kwh)),Y.entladung_kwh&&(K.entladung_kwh=parseFloat(Y.entladung_kwh))),Y.sonderkosten_euro&&(K.sonderkosten_euro=parseFloat(Y.sonderkosten_euro)),Y.sonderkosten_notiz&&(K.sonderkosten_notiz=Y.sonderkosten_notiz),Object.keys(K).length>0&&(X[we.id]=K)});const D=_.batterie_ladung_kwh?parseFloat(_.batterie_ladung_kwh):H.batterieLadung||void 0,J=_.batterie_entladung_kwh?parseFloat(_.batterie_entladung_kwh):H.batterieEntladung||void 0,ie=_.pv_erzeugung_kwh?parseFloat(_.pv_erzeugung_kwh):H.pvErzeugung||void 0;await t({anlage_id:s,jahr:parseInt(_.jahr),monat:parseInt(_.monat),einspeisung_kwh:parseFloat(_.einspeisung_kwh),netzbezug_kwh:parseFloat(_.netzbezug_kwh),pv_erzeugung_kwh:ie,batterie_ladung_kwh:D,batterie_entladung_kwh:J,globalstrahlung_kwh_m2:_.globalstrahlung_kwh_m2?parseFloat(_.globalstrahlung_kwh_m2):void 0,sonnenstunden:_.sonnenstunden?parseFloat(_.sonnenstunden):void 0,notizen:_.notizen||void 0,investitionen_daten:Object.keys(X).length>0?X:void 0})}catch(X){d(X instanceof Error?X.message:"Fehler beim Speichern")}finally{g(!1)}};return m||V?e.jsx("div",{className:"text-center py-4 text-gray-500",children:V?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:me,className:"space-y-6",children:[u&&e.jsx(Q,{type:"error",children:u}),a&&e.jsx(Q,{type:"info",children:"Die Werte wurden aus der Home Assistant Langzeitstatistik geladen. Bitte prüfen Sie die Daten und ergänzen Sie fehlende Werte vor dem Speichern."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:_.jahr,onChange:R,required:!0,disabled:!!r||!!a}),e.jsx(bt,{label:"Monat",name:"monat",value:_.monat,onChange:R,options:il,required:!0,disabled:!!r||!!a})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:_.einspeisung_kwh,onChange:R,placeholder:"z.B. 450",required:!0}),e.jsx(O,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:_.netzbezug_kwh,onChange:R,placeholder:"z.B. 120",required:!0}),(w||j)&&H.pvErzeugung>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PV-Erzeugung (berechnet)"}),e.jsx("input",{type:"text",value:`${H.pvErzeugung.toFixed(1)} kWh`,readOnly:!0,disabled:!0,className:"input bg-gray-100 dark:bg-gray-800 cursor-not-allowed"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Aus ",w?"PV-Modulen":"Wechselrichtern",": ",H.pvErzeugung.toFixed(1)," kWh"]})]}):e.jsx(O,{label:w||j?"PV-Erzeugung (aus Modulen unten)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:_.pv_erzeugung_kwh,onChange:R,placeholder:"z.B. 800",hint:w||j?"Wird aus PV-Modulen berechnet":"Manuell eingeben wenn keine PV-Module definiert"})]})]}),w&&e.jsx(Pr,{title:"PV-Module",icon:ae,iconColor:"text-yellow-500",investitionen:o.filter(te=>te.typ==="pv-module"),investitionsDaten:S,onInvChange:M,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),j&&!w&&e.jsx(Pr,{title:"Wechselrichter",icon:ae,iconColor:"text-yellow-500",investitionen:o.filter(te=>te.typ==="wechselrichter"),investitionsDaten:S,onInvChange:M,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),b&&e.jsxs(e.Fragment,{children:[e.jsx(ll,{investitionen:o.filter(te=>te.typ==="speicher"),investitionsDaten:S,onInvChange:M}),(H.batterieLadung>0||H.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",H.batterieLadung.toFixed(1)," kWh | Entladung ",H.batterieEntladung.toFixed(1)," kWh"]})]}),h&&e.jsx(dl,{investitionen:o.filter(te=>te.typ==="e-auto"),investitionsDaten:S,onInvChange:M}),y&&e.jsx(Pr,{title:"Wallbox",icon:pt,iconColor:"text-purple-500",investitionen:o.filter(te=>te.typ==="wallbox"),investitionsDaten:S,onInvChange:M,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgänge",unit:"",placeholder:"z.B. 12"}]}),k&&e.jsx(Pr,{title:"Wärmepumpe",icon:Ke,iconColor:"text-orange-500",investitionen:o.filter(te=>te.typ==="waermepumpe"),investitionsDaten:S,onInvChange:M,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),v&&e.jsx(cl,{investitionen:o.filter(te=>te.typ==="balkonkraftwerk"),investitionsDaten:S,onInvChange:M}),N&&e.jsx(ol,{investitionen:o.filter(te=>te.typ==="sonstiges"),investitionsDaten:S,onInvChange:M}),!b&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(O,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:_.batterie_ladung_kwh,onChange:R,placeholder:"z.B. 150"}),e.jsx(O,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:_.batterie_entladung_kwh,onChange:R,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Wetterdaten (optional)"]}),e.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:re,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 animate-spin mr-1"})," Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ot,{className:"w-4 h-4 mr-1"})," Auto-Fill"]})})]}),A&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-3 py-2 rounded",children:A}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Globalstrahlung",name:"globalstrahlung_kwh_m2",type:"number",step:"0.1",min:"0",value:_.globalstrahlung_kwh_m2,onChange:R,placeholder:"z.B. 152",hint:"kWh/m²"}),e.jsx(O,{label:"Sonnenstunden",name:"sonnenstunden",type:"number",step:"0.1",min:"0",value:_.sonnenstunden,onChange:R,placeholder:"z.B. 245",hint:"Stunden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:_.notizen,onChange:R,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(le,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(le,{type:"submit",loading:c,children:r?"Speichern":"Monat erfassen"})]})]})}function ll({investitionen:r,investitionsDaten:s,onInvChange:t}){if(r.length===0)return null;const n=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],a=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:"Ø Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),r.map(i=>{var g;const c=((g=i.parameter)==null?void 0:g.arbitrage_faehig)?[...n,...a]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:c.map(u=>{var d;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[u.label," ",u.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",u.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=s[i.id])==null?void 0:d[u.key])||"",onChange:p=>t(i.id,u.key,p.target.value),placeholder:u.placeholder,className:"input text-sm py-1.5",title:u.hint}),u.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:u.hint,children:u.hint})]},u.key)})}),e.jsx(Er,{invId:i.id,investitionsDaten:s,onInvChange:t})]},i.id)})]})}function dl({investitionen:r,investitionsDaten:s,onInvChange:t}){if(r.length===0)return null;const n=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"€",placeholder:"z.B. 18.00"}],a={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),r.map(i=>{var g,u;const c=((g=i.parameter)==null?void 0:g.v2h_faehig)||((u=i.parameter)==null?void 0:u.nutzt_v2h)?[...n,a]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:c.map(d=>{var p;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[d.label," ",d.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",d.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=s[i.id])==null?void 0:p[d.key])||"",onChange:m=>t(i.id,d.key,m.target.value),placeholder:d.placeholder,className:"input text-sm py-1.5",title:d.hint}),d.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:d.hint,children:d.hint})]},d.key)})}),e.jsx(Er,{invId:i.id,investitionsDaten:s,onInvChange:t})]},i.id)})]})}function Pr({title:r,icon:s,iconColor:t,investitionen:n,investitionsDaten:a,onInvChange:i,felder:x}){return n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:`h-5 w-5 ${t}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r})]}),n.map(c=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:c.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:x.map(g=>{var u;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[g.label," ",g.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",g.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=a[c.id])==null?void 0:u[g.key])||"",onChange:d=>i(c.id,g.key,d.target.value),placeholder:g.placeholder,className:"input text-sm py-1.5",title:g.hint}),g.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:g.hint,children:g.hint})]},g.key)})}),e.jsx(Er,{invId:c.id,investitionsDaten:a,onInvChange:i})]},c.id))]})}function cl({investitionen:r,investitionsDaten:s,onInvChange:t}){return r.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),r.map(n=>{var i,x,c,g,u;const a=!!((i=n.parameter)!=null&&i.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n.bezeichnung,n.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",n.leistung_kwp," kWp)"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:a?"Mit Speicher: Bei Nulleinspeisung entspricht Eigenverbrauch meist der Erzeugung.":"Ohne Speicher: Eigenverbrauch ist der direkt genutzte Anteil (typisch 30-40% der Erzeugung)."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=s[n.id])==null?void 0:x.pv_erzeugung_kwh)||"",onChange:d=>t(n.id,"pv_erzeugung_kwh",d.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((c=s[n.id])==null?void 0:c.eigenverbrauch_kwh)||"",onChange:d=>t(n.id,"eigenverbrauch_kwh",d.target.value),placeholder:a?"z.B. 43 (≈Erzeugung)":"z.B. 15 (30-40%)",className:"input text-sm py-1.5"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=s[n.id])==null?void 0:g.speicher_ladung_kwh)||"",onChange:d=>t(n.id,"speicher_ladung_kwh",d.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=s[n.id])==null?void 0:u.speicher_entladung_kwh)||"",onChange:d=>t(n.id,"speicher_entladung_kwh",d.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(Er,{invId:n.id,investitionsDaten:s,onInvChange:t})]},n.id)})]})}function ol({investitionen:r,investitionsDaten:s,onInvChange:t}){if(r.length===0)return null;const n={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wn,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),r.map(a=>{var x,c,g,u,d,p,m,o,b,h;const i=((x=a.parameter)==null?void 0:x.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[n[i]||i,(c=a.parameter)!=null&&c.beschreibung?` - ${String(a.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[i==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=s[a.id])==null?void 0:g.erzeugung_kwh)||"",onChange:y=>t(a.id,"erzeugung_kwh",y.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=s[a.id])==null?void 0:u.eigenverbrauch_kwh)||"",onChange:y=>t(a.id,"eigenverbrauch_kwh",y.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=s[a.id])==null?void 0:d.einspeisung_kwh)||"",onChange:y=>t(a.id,"einspeisung_kwh",y.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),i==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=s[a.id])==null?void 0:p.verbrauch_sonstig_kwh)||"",onChange:y=>t(a.id,"verbrauch_sonstig_kwh",y.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((m=s[a.id])==null?void 0:m.bezug_pv_kwh)||"",onChange:y=>t(a.id,"bezug_pv_kwh",y.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=s[a.id])==null?void 0:o.bezug_netz_kwh)||"",onChange:y=>t(a.id,"bezug_netz_kwh",y.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),i==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((b=s[a.id])==null?void 0:b.ladung_kwh)||"",onChange:y=>t(a.id,"ladung_kwh",y.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=s[a.id])==null?void 0:h.entladung_kwh)||"",onChange:y=>t(a.id,"entladung_kwh",y.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(Er,{invId:a.id,investitionsDaten:s,onInvChange:t})]},a.id)})]})}function Er({invId:r,investitionsDaten:s,onInvChange:t}){var x,c,g,u;const n=((x=s[r])==null?void 0:x.sonderkosten_euro)||((c=s[r])==null?void 0:c.sonderkosten_notiz),[a,i]=l.useState(!!n);return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:a?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Sonderkosten ",e.jsx("span",{className:"text-gray-400",children:"(€)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=s[r])==null?void 0:g.sonderkosten_euro)||"",onChange:d=>t(r,"sonderkosten_euro",d.target.value),placeholder:"z.B. 150",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Beschreibung"}),e.jsx("input",{type:"text",value:((u=s[r])==null?void 0:u.sonderkosten_notiz)||"",onChange:d=>t(r,"sonderkosten_notiz",d.target.value),placeholder:"z.B. Wechselrichter-Reparatur",className:"input text-sm py-1.5"})]})]}):e.jsx("button",{type:"button",onClick:()=>i(!0),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonderkosten erfassen (Reparatur, Wartung, etc.)"})})}const Qs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Xs={zaehler:{label:"Zählerwerte",color:"bg-blue-500"},komponenten:{label:"Komponenten",color:"bg-amber-500"},berechnet:{label:"Berechnungen",color:"bg-green-500"}},yr=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",group:"zaehler",getValue:r=>r.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",group:"zaehler",getValue:r=>r.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",group:"komponenten",getValue:r=>r.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"speicher_ladung",label:"Speicher Ladung",shortLabel:"Sp.Lad",group:"komponenten",getValue:r=>r.speicher_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"speicher_entladung",label:"Speicher Entladung",shortLabel:"Sp.Entl",group:"komponenten",getValue:r=>r.speicher_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_strom",label:"WP Strom",shortLabel:"WP",group:"komponenten",getValue:r=>r.wp_strom_kwh,format:"kwh",defaultVisible:!1},{key:"wp_heizung",label:"WP Heizung",shortLabel:"WP Hz",group:"komponenten",getValue:r=>r.wp_heizung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_warmwasser",label:"WP Warmwasser",shortLabel:"WP WW",group:"komponenten",getValue:r=>r.wp_warmwasser_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_ladung",label:"E-Auto Ladung",shortLabel:"E-Auto",group:"komponenten",getValue:r=>r.eauto_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_km",label:"E-Auto km",shortLabel:"km",group:"komponenten",getValue:r=>r.eauto_km,defaultVisible:!1},{key:"wallbox_ladung",label:"Wallbox Ladung",shortLabel:"WB",group:"komponenten",getValue:r=>r.wallbox_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",group:"berechnet",getValue:r=>r.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",group:"berechnet",getValue:r=>r.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",group:"berechnet",getValue:r=>r.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",group:"berechnet",getValue:r=>r.autarkie_prozent,format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",group:"berechnet",getValue:r=>r.eigenverbrauchsquote_prozent,format:"percent",defaultVisible:!1}],ea="eedc-monatsdaten-columns-v3";function gl(){var Se,xt;const r=Ft(),{anlagen:s,loading:t}=Je(),[n,a]=l.useState(void 0),{monatsdaten:i,loading:x,error:c,createMonatsdaten:g,updateMonatsdaten:u,deleteMonatsdaten:d}=Yn(n);zr(n);const[p,m]=l.useState([]),[o,b]=l.useState(!1),[h,y]=l.useState(!1),[k,j]=l.useState(null),[w,v]=l.useState(null),[N,f]=l.useState(!1),[_,I]=l.useState(!1),[C,P]=l.useState(null),[A,z]=l.useState(!1),[S,W]=l.useState([]),[V,oe]=l.useState(!1),[R,M]=l.useState(null),[H,re]=l.useState(new Date().getFullYear()),[me,q]=l.useState(new Date().getMonth()),[$,Z]=l.useState(null),[G,U]=l.useState(!1),[ne,xe]=l.useState(null),[Ne,ee]=l.useState(()=>{try{const L=localStorage.getItem(ea);if(L)return new Set(JSON.parse(L))}catch{}return new Set(yr.filter(L=>L.defaultVisible).map(L=>L.key))});l.useEffect(()=>{localStorage.setItem(ea,JSON.stringify([...Ne]))},[Ne]),l.useEffect(()=>{if(!n)return;(async()=>{b(!0);try{const he=await Vt.listAggregiert(n);m(he)}catch(he){console.error("Fehler beim Laden der aggregierten Daten:",he)}finally{b(!1)}})()},[n,i]),l.useEffect(()=>{if(A)return;(async()=>{try{const he=await Mt.getStatus();P(he.verfuegbar)}catch{P(!1)}finally{z(!0)}})()},[A]),l.useEffect(()=>{if(!_||!n)return;(async()=>{oe(!0),M(null);try{const he=await Mt.getVerfuegbareMonate(n);W(he)}catch(he){M("Fehler beim Laden der verfügbaren Monate"),console.error(he)}finally{oe(!1)}})()},[_,n]);const ue=async()=>{if(!(!n||!H||!me)){oe(!0),M(null);try{const L=await Mt.getMonatswerte(n,H,me),he=i.find(Ce=>Ce.jahr===H&&Ce.monat===me);if(he){const Ce=await Te.getMonatsdatenByMonth(n,H,me);xe({haWerte:L,vorhandeneDaten:he,vorhandeneInvestitionsDaten:Ce}),I(!1),U(!0)}else Z(L),I(!1),y(!0)}catch(L){M("Fehler beim Laden der Monatswerte aus HA-Statistik"),console.error(L)}finally{oe(!1)}}},Le=()=>{ne&&(Z(ne.haWerte),j(ne.vorhandeneDaten),U(!1),xe(null))},te=()=>{U(!1),xe(null)},X=L=>{ee(he=>{const Ce=new Set(he);return Ce.has(L)?Ce.delete(L):Ce.add(L),Ce})},D=L=>{const he=yr.filter(Pe=>Pe.group===L),Ce=he.every(Pe=>Ne.has(Pe.key));ee(Pe=>{const Fe=new Set(Pe);return he.forEach(Ue=>{Ce?Fe.delete(Ue.key):Fe.add(Ue.key)}),Fe})},J=yr.filter(L=>Ne.has(L.key));!n&&s.length>0&&!t&&a(s[0].id);const ie=l.useMemo(()=>p.filter(L=>L.hat_legacy_daten).length,[p]),we=async L=>{await g(L),y(!1)},Y=async L=>{k&&(await u(k.id,L),j(null))},K=async()=>{w&&(await d(w.id),v(null))},pe=L=>i.find(he=>he.id===L.id),We=(L,he)=>{if(L==null||isNaN(L))return"-";switch(he){case"kwh":return L.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${L.toFixed(1)}%`;default:return L.toLocaleString("de-DE",{maximumFractionDigits:1})}};return t||x?e.jsx(ve,{text:"Lade Daten..."}):s.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(E,{children:e.jsx(xr,{icon:Ge,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(le,{onClick:()=>r("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(bt,{value:(n==null?void 0:n.toString())||"",onChange:L=>a(parseInt(L.target.value)),options:s.map(L=>({value:L.id.toString(),label:L.anlagenname}))}),C&&e.jsxs(le,{variant:"secondary",onClick:()=>I(!0),children:[e.jsx(Ut,{className:"h-5 w-5 mr-2"}),"Aus HA laden"]}),e.jsxs(le,{onClick:()=>{Z(null),y(!0)},children:[e.jsx(Dt,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),c&&e.jsx(Q,{type:"error",children:c}),ie>0&&e.jsxs(Q,{type:"warning",className:"flex items-start gap-3",children:[e.jsx(rt,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Legacy-Daten gefunden"}),e.jsxs("p",{className:"text-sm mt-1",children:[ie," Monat",ie>1?"e":""," enthält",ie>1?"en":""," Daten im alten Format (PV-Erzeugung/Speicher in Monatsdaten statt InvestitionMonatsdaten). Bitte jeden betroffenen Monat einmal öffnen und speichern."]})]})]}),o?e.jsx(ve,{text:"Lade aggregierte Daten..."}):p.length===0?e.jsx(E,{children:e.jsx(xr,{icon:it,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(le,{onClick:()=>y(!0),children:"Manuell erfassen"}),e.jsx(le,{variant:"secondary",onClick:()=>r("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(le,{variant:"secondary",size:"sm",onClick:()=>f(!N),children:[e.jsx(pn,{className:"h-4 w-4 mr-2"}),"Spalten (",J.length,"/",yr.length,")"]})}),N&&e.jsxs(E,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"space-y-4",children:Object.keys(Xs).map(L=>{const he=Xs[L],Ce=yr.filter(Fe=>Fe.group===L),Pe=Ce.filter(Fe=>Ne.has(Fe.key)).length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${he.color}`}),e.jsxs("button",{onClick:()=>D(L),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600",children:[he.label," (",Pe,"/",Ce.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-5",children:Ce.map(Fe=>e.jsx("button",{onClick:()=>X(Fe.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${Ne.has(Fe.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:Fe.label},Fe.key))})]},L)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"Klicke auf Gruppen-Namen um alle Spalten ein-/auszublenden, oder auf einzelne Spalten."})]}),e.jsx(E,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(vs,{children:[e.jsx(_s,{children:e.jsxs(hr,{children:[e.jsx(st,{children:"Monat"}),J.map(L=>e.jsxs(st,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:L.label}),e.jsx("span",{className:"sm:hidden",children:L.shortLabel||L.label})]},L.key)),e.jsx(st,{className:"text-right",children:"Aktionen"})]})}),e.jsx(zs,{children:p.map(L=>e.jsxs(hr,{className:L.hat_legacy_daten?"bg-amber-50 dark:bg-amber-900/10":"",children:[e.jsxs(at,{children:[e.jsxs("span",{className:"font-medium",children:[Qs[L.monat]," ",L.jahr]}),L.hat_legacy_daten&&e.jsx("span",{title:"Legacy-Daten",children:e.jsx(rt,{className:"h-3 w-3 text-amber-500 inline ml-1"})})]}),J.map(he=>{const Ce=he.getValue(L);return e.jsx(at,{className:`text-right font-mono ${he.className||""}`,children:We(Ce,he.format)},he.key)}),e.jsx(at,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>{const he=pe(L);he&&j(he)},children:e.jsx(Ns,{className:"h-4 w-4"})}),e.jsx(le,{variant:"ghost",size:"sm",onClick:()=>{const he=pe(L);he&&v(he)},children:e.jsx(ht,{className:"h-4 w-4 text-red-500"})})]})})]},L.id))})]})})})]}),e.jsx(mt,{isOpen:_,onClose:()=>I(!1),title:"Monatsdaten aus HA-Statistik laden",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[R&&e.jsx(Q,{type:"error",children:R}),V&&!S.length?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx($e,{className:"h-8 w-8 animate-spin text-primary-500"})}):S.length===0?e.jsx(Q,{type:"warning",children:"Keine Daten in HA-Statistik gefunden. Stellen Sie sicher, dass das Sensor-Mapping konfiguriert ist und die Sensoren Langzeit-Statistiken haben."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Wählen Sie einen Monat aus, dessen Daten aus der Home Assistant Langzeitstatistik geladen werden sollen. Die Werte werden im Formular vorausgefüllt und können vor dem Speichern angepasst werden."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Jahr"}),e.jsx("select",{value:H,onChange:L=>re(parseInt(L.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[...new Set(S.map(L=>L.jahr))].sort((L,he)=>he-L).map(L=>e.jsx("option",{value:L,children:L},L))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Monat"}),e.jsx("select",{value:me,onChange:L=>q(parseInt(L.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:S.filter(L=>L.jahr===H).sort((L,he)=>he.monat-L.monat).map(L=>e.jsxs("option",{value:L.monat,children:[L.monat_name," ",L.hat_daten?"":"(keine Daten)"]},L.monat))})]})]}),i.some(L=>L.jahr===H&&L.monat===me)&&e.jsx(Q,{type:"info",children:"Für diesen Monat existieren bereits Daten. Nach dem Laden wird ein Vergleich angezeigt, damit Sie die Unterschiede prüfen können."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(le,{variant:"secondary",onClick:()=>I(!1),children:"Abbrechen"}),e.jsx(le,{onClick:ue,disabled:V,children:V?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 mr-2 animate-spin"}),"Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Werte laden"]})})]})]})]})}),e.jsx(mt,{isOpen:G,onClose:te,title:`Vergleich: ${ne==null?void 0:ne.haWerte.monat_name} ${ne==null?void 0:ne.haWerte.jahr}`,size:"lg",children:ne&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{type:"warning",children:"Für diesen Monat existieren bereits Daten. Bitte prüfen Sie die Unterschiede und entscheiden Sie, ob die HA-Werte übernommen werden sollen."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Werte (kWh)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsxs("tbody",{children:[e.jsx(Ir,{label:"Einspeisung",vorhanden:ne.vorhandeneDaten.einspeisung_kwh,haWert:(Se=ne.haWerte.basis.find(L=>L.feld==="einspeisung"))==null?void 0:Se.wert}),e.jsx(Ir,{label:"Netzbezug",vorhanden:ne.vorhandeneDaten.netzbezug_kwh,haWert:(xt=ne.haWerte.basis.find(L=>L.feld==="netzbezug"))==null?void 0:xt.wert})]})]})})]}),(ne.haWerte.investitionen.length>0||ne.vorhandeneInvestitionsDaten.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Komponenten-Werte (kWh)"}),ne.haWerte.investitionen.map(L=>{const he=ne.vorhandeneInvestitionsDaten.find(Fe=>Fe.investition_id===L.investition_id),Ce=(he==null?void 0:he.verbrauch_daten)||{},Pe=new Set;return L.felder.forEach(Fe=>Pe.add(Fe.feld)),Object.keys(Ce).forEach(Fe=>Pe.add(Fe)),e.jsxs("div",{className:"border rounded-lg overflow-hidden dark:border-gray-700",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[L.bezeichnung," (",L.typ,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsx("tbody",{children:[...Pe].map(Fe=>{const Ue=L.felder.find(Fr=>Fr.feld===Fe),mr=Ce[Fe];return(Ue==null?void 0:Ue.wert)===null&&mr===void 0?null:e.jsx(Ir,{label:(Ue==null?void 0:Ue.label)||Fe.replace(/_/g," "),vorhanden:mr,haWert:Ue==null?void 0:Ue.wert},Fe)})})]})})]},L.investition_id)}),ne.vorhandeneInvestitionsDaten.filter(L=>!ne.haWerte.investitionen.some(he=>he.investition_id===L.investition_id)).filter(L=>Object.keys(L.verbrauch_daten).length>0).map(L=>e.jsxs("div",{className:"border rounded-lg overflow-hidden dark:border-gray-700 opacity-75",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:["Investition #",L.investition_id," (nur Bestandsdaten, kein HA-Mapping)"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsx("tbody",{children:Object.entries(L.verbrauch_daten).map(([he,Ce])=>e.jsx(Ir,{label:he.replace(/_/g," "),vorhanden:Ce,haWert:null},he))})]})})]},L.investition_id))]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(le,{variant:"secondary",onClick:te,children:"Abbrechen"}),e.jsxs(le,{onClick:Le,children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Mit HA-Werten fortfahren"]})]})]})}),e.jsx(mt,{isOpen:h,onClose:()=>{y(!1),Z(null)},title:$?`Monatsdaten aus HA laden - ${$.monat_name} ${$.jahr}`:"Monatsdaten erfassen",size:"lg",children:n&&e.jsx(Ys,{anlageId:n,onSubmit:we,onCancel:()=>{y(!1),Z(null)},haVorausfuellung:$})}),e.jsx(mt,{isOpen:!!k,onClose:()=>{j(null),Z(null)},title:$?`HA-Werte übernehmen - ${$.monat_name} ${$.jahr}`:"Monatsdaten bearbeiten",size:"lg",children:k&&n&&e.jsx(Ys,{monatsdaten:k,anlageId:n,onSubmit:Y,onCancel:()=>{j(null),Z(null)},haVorausfuellung:$})}),e.jsx(mt,{isOpen:!!w,onClose:()=>v(null),title:"Monatsdaten löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Daten für ",e.jsxs("strong",{children:[Qs[(w==null?void 0:w.monat)||0]," ",w==null?void 0:w.jahr]})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(le,{variant:"secondary",onClick:()=>v(null),children:"Abbrechen"}),e.jsx(le,{variant:"danger",onClick:K,children:"Löschen"})]})]})})]})}function Ir({label:r,vorhanden:s,haWert:t}){const n=s??null,a=t??null;let i=null,x="";n!==null&&a!==null&&(i=a-n,Math.abs(i)<.1?x="text-gray-500":i>0?x="text-green-600 dark:text-green-400":x="text-red-600 dark:text-red-400");const c=u=>u!==null?u.toLocaleString("de-DE",{maximumFractionDigits:1}):"–",g=n!==null&&a!==null&&Math.abs(a-n)>.1;return e.jsxs("tr",{className:`border-b dark:border-gray-700 ${g?"bg-amber-50 dark:bg-amber-900/10":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:r}),e.jsx("td",{className:"py-2 px-3 text-right text-blue-600 dark:text-blue-400",children:c(n)}),e.jsx("td",{className:"py-2 px-3 text-right text-green-600 dark:text-green-400 font-medium",children:c(a)}),e.jsx("td",{className:`py-2 px-3 text-right font-medium ${x}`,children:i!==null?(i>=0?"+":"")+i.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"})]})}function ta(){var Ne;const{anlagen:r,loading:s,refresh:t}=Je(),[n,a]=l.useState(null),[i,x]=l.useState(!1),[c,g]=l.useState(!1),[u,d]=l.useState(null),[p,m]=l.useState(null),[o,b]=l.useState(!1),[h,y]=l.useState(!1),[k,j]=l.useState(null),w=l.useRef(null),[v,N]=l.useState(!1),[f,_]=l.useState(!1),[I,C]=l.useState(null),[P,A]=l.useState(!1),z=l.useRef(null),S=r.some(ee=>ee.anlagenname==="Demo-Anlage"),W=n??((Ne=r[0])==null?void 0:Ne.id),V=ee=>{ee.preventDefault(),x(!0)},oe=ee=>{ee.preventDefault(),x(!1)},R=async ee=>{ee.preventDefault(),x(!1);const ue=ee.dataTransfer.files;ue.length>0&&await H(ue[0])},M=async ee=>{const ue=ee.target.files;ue&&ue.length>0&&await H(ue[0]),w.current&&(w.current.value="")},H=async ee=>{if(!W){m("Bitte zuerst eine Anlage auswählen");return}if(!ee.name.endsWith(".csv")){m("Bitte eine CSV-Datei auswählen");return}m(null),d(null),g(!0);try{const ue=await zt.importCSV(W,ee,o);d(ue)}catch(ue){m(ue instanceof Error?ue.message:"Import fehlgeschlagen")}finally{g(!1)}},re=()=>{if(!W){m("Bitte zuerst eine Anlage auswählen");return}window.location.href=zt.getTemplateDownloadUrl(W)},me=()=>{if(!W){m("Bitte zuerst eine Anlage auswählen");return}window.location.href=zt.getExportUrl(W)},q=async()=>{m(null),j(null),y(!0);try{const ee=await zt.createDemoData();j(ee),t()}catch(ee){m(ee instanceof Error?ee.message:"Fehler beim Erstellen der Demo-Daten")}finally{y(!1)}},$=async()=>{m(null),j(null),y(!0);try{await zt.deleteDemoData(),t()}catch(ee){m(ee instanceof Error?ee.message:"Fehler beim Löschen der Demo-Daten")}finally{y(!1)}},Z=ee=>{ee.preventDefault(),N(!0)},G=ee=>{ee.preventDefault(),N(!1)},U=async ee=>{ee.preventDefault(),N(!1);const ue=ee.dataTransfer.files;ue.length>0&&await xe(ue[0])},ne=async ee=>{const ue=ee.target.files;ue&&ue.length>0&&await xe(ue[0]),z.current&&(z.current.value="")},xe=async ee=>{if(!ee.name.endsWith(".json")){m("Bitte eine JSON-Datei auswählen");return}m(null),C(null),_(!0);try{const ue=await zt.importJSON(ee,P);C(ue),ue.erfolg&&t()}catch(ue){m(ue instanceof Error?ue.message:"JSON-Import fehlgeschlagen")}finally{_(!1)}};return s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(lr,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wärmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(le,{onClick:q,loading:h,className:"w-full",children:[e.jsx(lr,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),k&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(Et,{className:"inline h-4 w-4 mr-1"}),k.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),r.length>1&&e.jsx("select",{value:W??"",onChange:ee=>a(Number(ee.target.value)),className:"input w-auto",children:r.map(ee=>e.jsx("option",{value:ee.id,children:ee.anlagenname},ee.id))})]}),p&&e.jsx(Q,{type:"error",onClose:()=>m(null),children:p}),u&&e.jsx(xl,{result:u,onClose:()=>d(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(Yt,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthält alle verfügbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(le,{variant:"secondary",className:"w-full",onClick:re,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:V,onDragLeave:oe,onDrop:R,onClick:()=>{var ee;return(ee=w.current)==null?void 0:ee.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${c?"opacity-50 pointer-events-none":""}
              `,children:c?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ve,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(gr,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:w,type:"file",accept:".csv",onChange:M,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:ee=>b(ee.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten überschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(le,{variant:"secondary",size:"sm",onClick:me,children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(lr,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:S?"Demo-Anlage ist bereits vorhanden. Du kannst sie löschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),S?e.jsxs(le,{variant:"danger",onClick:$,loading:h,className:"w-full",children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"Demo-Anlage löschen"]}):e.jsxs(le,{onClick:q,loading:h,className:"w-full",children:[e.jsx(lr,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),k&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(Et,{className:"inline h-4 w-4 mr-1"}),k.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthält:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, Wärmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:e.jsx(Ps,{className:"h-6 w-6 text-purple-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"JSON Import (Anlage wiederherstellen)"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere eine komplette Anlage aus einer JSON-Export-Datei. Alle Investitionen, Monatsdaten, Strompreise und PVGIS-Prognosen werden importiert."}),I&&e.jsx(hl,{result:I,onClose:()=>C(null)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:Z,onDragLeave:G,onDrop:U,onClick:()=>{var ee;return(ee=z.current)==null?void 0:ee.click()},className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
              ${v?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600 hover:border-purple-500"}
              ${f?"opacity-50 pointer-events-none":""}
            `,children:f?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ve,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"JSON-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:z,type:"file",accept:".json",onChange:ne,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:ee=>A(ee.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),"Existierende Anlage mit gleichem Namen überschreiben"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"}),' JSON-Dateien können über den "Export (JSON)"-Button in der Anlagen-Übersicht erstellt werden. Bei Namenskonflikt wird automatisch ein Suffix hinzugefügt, es sei denn "Überschreiben" ist aktiviert.']})]}),e.jsxs(E,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"💡 Tipp: Template herunterladen"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["Das Template enthält automatisch alle Spalten passend zu deinen angelegten Investitionen (z.B. ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"Sueddach_kWh"}),","," ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"BYD_HVS_Ladung_kWh"}),")."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Pflichtspalten:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Investitions-Spalten (automatisch im Template):"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:["PV-Module: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_kWh"})]}),e.jsxs("li",{children:["Speicher: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Ladung_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Entladung_kWh"})]}),e.jsxs("li",{children:["E-Auto: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_km"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Verbrauch_kWh"}),", etc."]}),e.jsxs("li",{children:["Wärmepumpe: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Strom_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Heizung_kWh"})]})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg mt-2",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200 mb-1",children:"⚠️ Hinweis zu Legacy-Spalten"}),e.jsxs("p",{className:"text-amber-700 dark:text-amber-300 text-xs",children:["Die Spalten ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," und"," ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"Batterie_*_kWh"})," werden nicht mehr unterstützt, wenn PV-Module/Speicher als Investitionen angelegt sind. Verwende stattdessen die individuellen Investitions-Spalten."]})]})]})]})]})}function hl({result:r,onClose:s}){const t=r.fehler.length>0,n=r.warnungen.length>0,a=()=>t?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":n?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>t?"text-red-800 dark:text-red-200":n?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",x=()=>t?"text-red-700 dark:text-red-300":n?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300",c=Object.values(r.importiert).reduce((u,d)=>u+d,0),g={strompreise:"Strompreise",investitionen:"Investitionen",investition_monatsdaten:"Investition-Monatsdaten",monatsdaten:"Monatsdaten",pvgis_prognosen:"PVGIS-Prognosen",pvgis_monatsprognosen:"PVGIS-Monatsprognosen"};return e.jsxs("div",{className:`relative p-4 rounded-lg border mb-4 ${a()}`,children:[e.jsx("button",{onClick:s,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Xt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[t?e.jsx(Xt,{className:"h-5 w-5 text-red-500 mt-0.5"}):n?e.jsx(rt,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(Et,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:t?"Import fehlgeschlagen":n?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[r.erfolg&&r.anlage_name&&e.jsxs("p",{className:x(),children:[e.jsx("strong",{children:"Anlage:"})," ",r.anlage_name]}),c>0&&e.jsxs("div",{className:x(),children:[e.jsx("p",{className:"font-medium",children:"Importierte Datensätze:"}),e.jsx("ul",{className:"list-disc list-inside ml-2",children:Object.entries(r.importiert).filter(([,u])=>u>0).map(([u,d])=>e.jsxs("li",{children:[g[u]||u,": ",d]},u))})]}),t&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[r.fehler.slice(0,5).map((u,d)=>e.jsx("li",{children:u},d)),r.fehler.length>5&&e.jsxs("li",{children:["... und ",r.fehler.length-5," weitere Fehler"]})]})]}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[r.warnungen.slice(0,5).map((u,d)=>e.jsx("li",{children:u},d)),r.warnungen.length>5&&e.jsxs("li",{children:["... und ",r.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function xl({result:r,onClose:s}){const t=r.fehler.length>0,n=r.warnungen&&r.warnungen.length>0,a=()=>t?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":n?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>t?"text-red-800 dark:text-red-200":n?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",x=()=>t?"text-red-700 dark:text-red-300":n?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300";return e.jsxs("div",{className:`relative p-4 rounded-lg border ${a()}`,children:[e.jsx("button",{onClick:s,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Xt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[t?e.jsx(Xt,{className:"h-5 w-5 text-red-500 mt-0.5"}):n?e.jsx(rt,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(Et,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:t?"Import mit Fehlern":n?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[e.jsxs("p",{className:x(),children:[r.importiert," Datensätze importiert",r.uebersprungen>0&&`, ${r.uebersprungen} übersprungen`]}),t&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[r.fehler.slice(0,5).map((c,g)=>e.jsx("li",{children:c},g)),r.fehler.length>5&&e.jsxs("li",{children:["... und ",r.fehler.length-5," weitere Fehler"]})]})]}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[r.warnungen.slice(0,5).map((c,g)=>e.jsx("li",{children:c},g)),r.warnungen.length>5&&e.jsxs("li",{children:["... und ",r.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function ml(){const{theme:r,setTheme:s}=Aa(),[t,n]=l.useState(null),[a,i]=l.useState(null),[x,c]=l.useState([]),[g,u]=l.useState(!0),[d,p]=l.useState(null),m=async()=>{try{u(!0),p(null);const[o,b]=await Promise.all([Os.getStats(),Os.getSettings()]);if(n(o),i(b),b.ha_integration_enabled)try{const h=await Pt.getSensors();c(h)}catch{}}catch(o){p(o instanceof Error?o.message:"Fehler beim Laden der Einstellungen")}finally{u(!1)}};return l.useEffect(()=>{m()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:m,disabled:g,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Wt,{className:`h-5 w-5 ${g?"animate-spin":""}`})})]}),d&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:d})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:ae},{value:"dark",label:"Dunkel",icon:_a},{value:"system",label:"System",icon:va}].map(o=>e.jsxs("button",{onClick:()=>s(o.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${r===o.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(o.icon,{className:"h-5 w-5"}),o.label]},o.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ze,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:a!=null&&a.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),x.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",x.length," Energy-Sensoren verfügbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(_r,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt über ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen → Import/Export"})," um deine Daten zu importieren."]})]})]}),x.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfügbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:x.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:o.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:o.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:o.unit_of_measurement||"-"})]},o.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ut,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),g?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx($e,{className:"h-6 w-6 animate-spin text-gray-400"})}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),t.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(t.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",t.daten_zeitraum&&e.jsxs("span",{children:[" (",t.daten_zeitraum.von," - ",t.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",t.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(a==null?void 0:a.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfügbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"./api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]})]})}const ra=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function ul(){const{anlagen:r,loading:s}=Je(),[t,n]=l.useState(),[a,i]=l.useState(null),[x,c]=l.useState([]),[g,u]=l.useState(null),[d,p]=l.useState(null),[m,o]=l.useState(null),[b,h]=l.useState(!1),[y,k]=l.useState(!1),[j,w]=l.useState(!1),[v,N]=l.useState(null),[f,_]=l.useState(null),[I,C]=l.useState(14);l.useEffect(()=>{r.length>0&&!t&&n(r[0].id)},[r,t]),l.useEffect(()=>{t&&P()},[t]);const P=async()=>{if(t){h(!0),N(null),_(null);try{const[M,H,re]=await Promise.all([ft.getAktivePrognose(t),ft.listeGespeichertePrognosen(t),Qr.getProvider(t).catch(()=>null)]);i(M),c(H),o(re)}catch(M){N(M instanceof Error?M.message:"Fehler beim Laden")}finally{h(!1)}}},A=async()=>{if(t){k(!0),N(null);try{const M=await ft.getPrognose(t,{system_losses:I});u(M)}catch(M){N(M instanceof Error?M.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{k(!1)}}},z=async()=>{if(t){w(!0),N(null);try{const M=await ft.getOptimum(t);p(M)}catch(M){N(M instanceof Error?M.message:"Fehler beim Ermitteln des Optimums")}finally{w(!1)}}},S=async()=>{if(t){h(!0),N(null);try{await ft.speicherePrognose(t,{system_losses:I}),_("Prognose erfolgreich gespeichert"),u(null),await P()}catch(M){N(M instanceof Error?M.message:"Fehler beim Speichern")}finally{h(!1)}}},W=async M=>{try{await ft.aktivierePrognose(M),_("Prognose aktiviert"),await P()}catch(H){N(H instanceof Error?H.message:"Fehler beim Aktivieren")}},V=async M=>{if(confirm("Prognose wirklich löschen?"))try{await ft.loeschePrognose(M),_("Prognose gelöscht"),await P()}catch(H){N(H instanceof Error?H.message:"Fehler beim Löschen")}},oe=r.find(M=>M.id===t),R=(oe==null?void 0:oe.latitude)&&(oe==null?void 0:oe.longitude);return s?e.jsx(ve,{text:"Lade..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"}),e.jsx(Q,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[r.length>1&&e.jsx(bt,{value:(t==null?void 0:t.toString())||"",onChange:M=>n(parseInt(M.target.value)),options:r.map(M=>({value:M.id.toString(),label:M.anlagenname}))}),e.jsx("button",{onClick:P,disabled:b,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Wt,{className:`h-5 w-5 ${b?"animate-spin":""}`})})]})]}),v&&e.jsx(Q,{type:"error",children:v}),f&&e.jsx(Q,{type:"success",children:f}),!R&&e.jsx(Q,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(gt,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergänze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu können."})]})]})}),R&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),b?e.jsx(ve,{}):a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[a.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[a.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[a.neigung_grad,"°"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:a.ausrichtung_richtung})]})]}),a.monatswerte&&a.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:a.monatswerte.map(M=>({name:ra[M.monat],prognose:M.e_m})),children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name"}),e.jsx(ge,{tickFormatter:M=>`${M} kWh`}),e.jsx(ce,{formatter:M=>`${M.toFixed(0)} kWh`}),e.jsx(se,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(a.abgerufen_am).toLocaleDateString("de-DE")," • ","Koordinaten: ",a.latitude.toFixed(4),"°N, ",a.longitude.toFixed(4),"°E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:I,onChange:M=>C(parseFloat(M.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(le,{onClick:A,disabled:y,className:"w-full",children:[y?e.jsx(Wt,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),g&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(le,{onClick:S,disabled:b,children:[e.jsx(Et,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[g.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[g.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[g.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:g.module.length})]})]}),g.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:g.module.map(M=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:M.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[M.leistung_kwp," kWp • ",M.ausrichtung," • ",M.neigung_grad,"° • ",M.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},M.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:g.monatsdaten.map(M=>({name:ra[M.monat],ertrag:M.e_m})),children:[e.jsx(be,{strokeDasharray:"3 3"}),e.jsx(je,{dataKey:"name",fontSize:10}),e.jsx(ge,{tickFormatter:M=>`${M}`}),e.jsx(ce,{formatter:M=>`${M.toFixed(0)} kWh`}),e.jsx(se,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(bn,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(le,{onClick:z,disabled:j,variant:"secondary",children:[j?e.jsx(Wt,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter für Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[d.optimal.neigung_grad,"°"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:d.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[d.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),d.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung für deinen Standort zu ermitteln.'})]}),x.length>0&&e.jsxs(E,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:x.map(M=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(M.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[M.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:M.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[M.neigung_grad,"°"]}),e.jsx("td",{className:"text-center py-2 px-2",children:M.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(Et,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!M.ist_aktiv&&e.jsx("button",{onClick:()=>W(M.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(Et,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>V(M.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Löschen",children:e.jsx(ht,{className:"h-4 w-4"})})]})})]},M.id))})]})})]}),m&&e.jsxs(E,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5"}),"Wetterdaten-Provider"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Der Wetter-Provider bestimmt die Quelle für Globalstrahlungsdaten bei der Ist-Erfassung und der Kurzfrist-Prognose. Die Einstellung kann in den Anlagen-Stammdaten geändert werden."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Aktueller Provider"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:m.aktueller_provider==="auto"?"Automatisch":m.aktueller_provider==="brightsky"?"Bright Sky (DWD)":m.aktueller_provider==="open-meteo"?"Open-Meteo":m.aktueller_provider==="open-meteo-solar"?"Open-Meteo Solar (GTI)":m.aktueller_provider})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Standort"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[m.standort.land||"Unbekannt",m.standort.in_deutschland&&" (DWD verfügbar)"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Verfügbare Provider"}),e.jsx("div",{className:"grid gap-2",children:m.provider.map(M=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${M.verfuegbar?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 opacity-60"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${M.verfuegbar?"text-green-700 dark:text-green-300":"text-gray-500 dark:text-gray-400"}`,children:M.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:M.beschreibung})]}),e.jsx("div",{className:"text-sm",children:M.verfuegbar?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"✓ Verfügbar"}):e.jsx("span",{className:"text-gray-400",children:"Nicht verfügbar"})})]},M.id))})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Über Solarprognose"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"PVGIS"})," (Langfrist): EU-Tool für Ertragsprognosen basierend auf Satellitendaten und Klimamodellen. Nutzt historische TMY-Daten (Typical Meteorological Year)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Wetter-Provider"})," (Kurzfrist): Aktuelle und historische Wetterdaten für SOLL-IST-Vergleiche. Bright Sky liefert DWD-Daten (Deutschland), Open-Meteo weltweit."]}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"PVGIS-Dokumentation →"})]})]})})]})]})}const sa=`# Utility Meter für monatliche Aggregation
# Füge dies in deine configuration.yaml ein

utility_meter:
  # PV-Erzeugung (von deinem Wechselrichter)
  pv_erzeugung_monatlich:
    source: sensor.DEIN_WR_total_yield  # <- Anpassen!
    cycle: monthly

  # Einspeisung ins Netz
  einspeisung_monatlich:
    source: sensor.DEIN_ZAEHLER_export  # <- Anpassen!
    cycle: monthly

  # Netzbezug
  netzbezug_monatlich:
    source: sensor.DEIN_ZAEHLER_import  # <- Anpassen!
    cycle: monthly

  # Speicher Ladung (optional)
  speicher_ladung_monatlich:
    source: sensor.DEIN_SPEICHER_charge_total  # <- Anpassen!
    cycle: monthly

  # Speicher Entladung (optional)
  speicher_entladung_monatlich:
    source: sensor.DEIN_SPEICHER_discharge_total  # <- Anpassen!
    cycle: monthly

  # E-Auto Ladung (optional, z.B. von evcc)
  eauto_ladung_monatlich:
    source: sensor.evcc_loadpoint_charge_total_import  # <- Anpassen!
    cycle: monthly`,aa=`# Automation: Monatliche CSV-Export Datei erstellen
# Voraussetzung: File Integration muss eingerichtet sein

automation:
  - alias: "EEDC Monatsdaten Export"
    trigger:
      - platform: time
        at: "00:05:00"  # Am 1. des Monats um 00:05
    condition:
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: notify.file_export  # <- Anpassen an deinen File Notifier
        data:
          message: >
            {{ (now() - timedelta(days=1)).year }},{{ (now() - timedelta(days=1)).month }},{{ states('sensor.einspeisung_monatlich') }},{{ states('sensor.netzbezug_monatlich') }},{{ states('sensor.pv_erzeugung_monatlich') }}

# Hinweis: Die CSV muss dann manuell in EEDC importiert werden
# oder du erweiterst die Automation um einen REST-Call zu EEDC`;function pl(){const[r,s]=l.useState(!1),[t,n]=l.useState(null),a=(i,x)=>{navigator.clipboard.writeText(i),n(x),setTimeout(()=>n(null),2e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Yt,{className:"w-6 h-6"}),"Datenerfassung"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"So erfassen Sie Ihre monatlichen Energiedaten in EEDC"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(Jr,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Manuelles Formular"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-2 py-0.5 rounded",children:"Empfohlen für Einsteiger"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Geben Sie Ihre Monatsdaten direkt im Formular ein. Ideal für gelegentliche Erfassung oder wenn Sie nur wenige Werte haben."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-blue-500"}),"Einstellungen → Monatsdaten → Neu"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten können automatisch geladen werden"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-blue-500"}),"Investitions-Daten pro Komponente erfassen"]})]}),e.jsxs("a",{href:"#/einstellungen/monatsdaten",className:"btn btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(Jr,{className:"w-4 h-4"}),"Zur Monatsdaten-Erfassung"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(gr,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV-Import"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 px-2 py-0.5 rounded",children:"Empfohlen für regelmäßige Erfassung"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Laden Sie Monatsdaten per CSV-Datei hoch. Perfekt für größere Datenmengen oder historische Daten."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-green-500"}),"Einstellungen → Import/Export"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-green-500"}),"Vorlage herunterladen (passt zu Ihren Investitionen)"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-green-500"}),"Wetterdaten werden automatisch ergänzt"]})]}),e.jsxs("a",{href:"#/einstellungen/import",className:"btn btn-primary w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(gr,{className:"w-4 h-4"}),"Zum CSV-Import"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(qe,{className:"w-6 h-6 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Hinweis für Home Assistant Benutzer"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"EEDC ist als Standalone-Anwendung konzipiert und benötigt keine Home Assistant Integration für die Datenerfassung. Sie können Ihre Daten aus HA manuell in eine CSV-Datei exportieren und in EEDC importieren."}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:[e.jsx("strong",{children:"Optional:"})," Unter Einstellungen → HA-Export können Sie berechnete KPIs (Autarkie, Eigenverbrauch, etc.) per MQTT zurück an Home Assistant senden."]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:e.jsxs("a",{href:"#/einstellungen/ha-export",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1",children:[e.jsx(Kt,{className:"w-3 h-3"}),"HA-Export Einstellungen"]})})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>s(!r),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(Yt,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Anleitung: CSV aus Home Assistant erstellen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"So richten Sie Utility Meter ein, um monatliche Werte für EEDC zu exportieren"})]})]}),r?e.jsx(hn,{className:"w-5 h-5 text-gray-400"}):e.jsx($t,{className:"w-5 h-5 text-gray-400"})]}),r&&e.jsxs("div",{className:"px-4 pb-4 space-y-6 border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"1"}),"Utility Meter einrichten"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:["Utility Meter aggregieren Ihre Sensordaten monatlich. Fügen Sie folgendes in Ihre"," ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"configuration.yaml"})," ein und passen Sie die Sensor-IDs an:"]}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-64",children:sa}),e.jsx("button",{onClick:()=>a(sa,"utility"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:t==="utility"?e.jsx(Et,{className:"w-4 h-4 text-green-400"}):e.jsx(ps,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"2"}),"Ihre Sensoren finden"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"So finden Sie die richtigen Sensor-IDs in Home Assistant:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-4",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Entwicklerwerkzeuge → Zustände"})," in HA öffnen"]}),e.jsx("li",{children:'• Nach "total" oder "energy" filtern'}),e.jsxs("li",{children:["• Sensoren mit ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"state_class: total_increasing"})," sind ideal"]}),e.jsxs("li",{children:["• Typische Namen: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_total_yield"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_energy"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_import"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_export"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"3"}),"CSV-Datei erstellen"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Am Monatsende die Utility Meter Werte ablesen und in eine CSV eintragen:"}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs font-mono overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"// Pflicht-Spalten:"}),e.jsx("div",{children:"Jahr,Monat,Einspeisung_kWh,Netzbezug_kWh"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"// Beispiel:"}),e.jsx("div",{children:"2025,12,125.9,405.5"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[e.jsx("strong",{children:"Tipp:"})," Laden Sie unter Import/Export eine Vorlage herunter - sie enthält alle Spalten passend zu Ihren angelegten Investitionen!"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-gray-400 text-white text-sm flex items-center justify-center",children:"4"}),e.jsx("span",{className:"text-gray-500",children:"(Optional)"})," Automatischer Export"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Für Fortgeschrittene: Mit der File-Integration und einer Automation können Sie die CSV automatisch erstellen lassen:"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-48",children:aa}),e.jsx("button",{onClick:()=>a(aa,"file"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:t==="file"?e.jsx(Et,{className:"w-4 h-4 text-green-400"}):e.jsx(ps,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Wichtig:"}),' Utility Meter werden bei HA-Neustart zurückgesetzt, es sei denn, Sie haben den Recorder korrekt konfiguriert. Alternativ können Sie auch die "Statistik"-Werte aus dem HA Energy Dashboard verwenden.']})})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"💡 Tipps für die Datenerfassung"}),e.jsxs("ul",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"📅"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Regelmäßigkeit:"})," Erfassen Sie Ihre Daten am besten immer am gleichen Tag im Monat (z.B. am 1. oder letzten Tag)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"📊"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Zählerstände:"})," Notieren Sie die Zählerstände Ihrer Wechselrichter, Speicher und Wallbox. EEDC erwartet Monatswerte (Differenz zum Vormonat)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"☀️"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wetterdaten:"})," Globalstrahlung und Sonnenstunden werden automatisch aus Open-Meteo geladen, wenn Ihre Anlage Koordinaten hat."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚗"}),e.jsxs("span",{children:[e.jsx("strong",{children:"E-Auto:"})," Bei externem Laden (öffentliche Säulen) können Sie Ladung und Kosten separat erfassen."]})]})]})]})]})}function bl(){const[r,s]=l.useState([]),[t,n]=l.useState(null),[a,i]=l.useState(null),[x,c]=l.useState(null),[g,u]=l.useState(null),[d,p]=l.useState(!0),[m,o]=l.useState(null),[b,h]=l.useState(null),[y,k]=l.useState("core-mosquitto"),[j,w]=l.useState(1883),[v,N]=l.useState(""),[f,_]=l.useState(""),[I,C]=l.useState(null),[P,A]=l.useState(null),[z,S]=l.useState(!1),[W,V]=l.useState(!1),[oe,R]=l.useState(!1),[M,H]=l.useState("mqtt"),[re,me]=l.useState(new Set(["energie","finanzen"])),[q,$]=l.useState(!1),Z=async()=>{try{p(!0),o(null);const[D,J,ie]=await Promise.all([dt.list(),Pt.getExportSensors(),Pt.getMqttConfig().catch(()=>null)]);s(D),i(J),ie&&(h(ie),k(ie.host),w(ie.port),N(ie.username)),D.length>0&&!t&&n(D[0].id)}catch(D){o(D instanceof Error?D.message:"Fehler beim Laden")}finally{p(!1)}},G=async D=>{try{const[J,ie]=await Promise.all([Pt.getAnlageSensors(D),Pt.getYamlSnippet(D)]);c(J),u(ie)}catch(J){console.error("Fehler beim Laden der Anlage-Daten:",J)}};l.useEffect(()=>{Z()},[]),l.useEffect(()=>{t&&G(t)},[t]);const U=async()=>{S(!0),C(null);try{const D=await Pt.testMqtt({host:y,port:j,username:v||void 0,password:f||void 0});C(D)}catch(D){C({connected:!1,error:D instanceof Error?D.message:"Verbindungsfehler"})}finally{S(!1)}},ne=async()=>{if(t){V(!0),A(null);try{const D=await Pt.publishMqtt(t,{host:y,port:j,username:v||void 0,password:f||void 0});A(D)}catch(D){A({message:D instanceof Error?D.message:"Fehler beim Publizieren",anlage_id:t,total:0,success:0,failed:0})}finally{V(!1)}}},xe=async()=>{if(t&&confirm("Alle EEDC-Sensoren für diese Anlage aus Home Assistant entfernen?")){R(!0);try{await Pt.removeMqtt(t,{host:y,port:j,username:v||void 0,password:f||void 0}),A(null)}catch(D){o(D instanceof Error?D.message:"Fehler beim Entfernen")}finally{R(!1)}}},Ne=async()=>{if(g)try{await navigator.clipboard.writeText(g.yaml),$(!0),setTimeout(()=>$(!1),2e3)}catch{const D=document.createElement("textarea");D.value=g.yaml,document.body.appendChild(D),D.select(),document.execCommand("copy"),document.body.removeChild(D),$(!0),setTimeout(()=>$(!1),2e3)}},ee=()=>{if(!g||!x)return;const D=new Blob([g.yaml],{type:"text/yaml"}),J=URL.createObjectURL(D),ie=document.createElement("a");ie.href=J,ie.download=`eedc_sensors_${x.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),URL.revokeObjectURL(J)},ue=D=>{me(J=>{const ie=new Set(J);return ie.has(D)?ie.delete(D):ie.add(D),ie})},Le=D=>{const J={};return D.forEach(ie=>{const we=ie.category||"sonstige";J[we]||(J[we]=[]),J[we].push(ie)}),J},te={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},X={energie:"⚡",finanzen:"💰",autarkie:"🏠",umwelt:"🌱",performance:"📊",sonstige:"📌"};return d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($e,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:Z,disabled:d,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Wt,{className:`h-5 w-5 ${d?"animate-spin":""}`})})]}),m&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:m})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO₂, ROI) als Sensoren an Home Assistant zurückgeben. Wähle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entitäten)."})]})]}),r.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswählen"}),e.jsx("select",{value:t||"",onChange:D=>n(Number(D.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:r.map(D=>e.jsx("option",{value:D.id,children:D.anlagenname},D.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>H("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${M==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>H("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${M==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),M==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),b&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:y,onChange:D=>k(D.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:j,onChange:D=>w(Number(D.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:v,onChange:D=>N(D.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:f,onChange:D=>_(D.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),I&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${I.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:I.connected?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",I.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(_r,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:I.error})]})}),I.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:I.hint})]}),P&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${P.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[P.success," von ",P.total," Sensoren publiziert"]})]}),P.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[P.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:U,disabled:z,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[z?e.jsx($e,{className:"w-4 h-4 animate-spin"}):e.jsx(Wt,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:ne,disabled:W||!t,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[W?e.jsx($e,{className:"w-4 h-4 animate-spin"}):e.jsx(Ea,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:xe,disabled:oe||!t,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[oe?e.jsx($e,{className:"w-4 h-4 animate-spin"}):e.jsx(ht,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${b!=null&&b.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[b!=null&&b.auto_publish?e.jsx(tt,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(rt,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${b!=null&&b.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen → Geräte & Dienste → MQTT"}),".",b!=null&&b.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",b.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelmäßig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen für automatische Updates."]})]})]})]})]}),M==="rest"&&g&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML für configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Ne,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:q?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:ee,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(ot,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:g.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:g.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["Füge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",g.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach Änderungen muss Home Assistant neu gestartet werden."]})]})]})]}),x&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verfügbare Sensoren (",x.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(Le(x.sensors)).map(([D,J])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>ue(D),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:X[D]||"📌"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:te[D]||D}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",J.length,")"]})]}),re.has(D)?e.jsx($t,{className:"w-5 h-5 text-gray-400"}):e.jsx(vt,{className:"w-5 h-5 text-gray-400"})]}),re.has(D)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:J.map(ie=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:ie.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ie.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:ie.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:ie.value!==null?typeof ie.value=="number"?ie.value.toLocaleString("de-DE",{maximumFractionDigits:2}):ie.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:ie.unit})]})]}),ie.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",ie.formel,ie.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",ie.berechnung]})]})]},ie.key))})]},D))})]}),a&&a.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:a.investitionen.map(D=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:D.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",D.typ," - ",D.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:D.sensors.map(J=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:J.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:J.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:J.value!==null?typeof J.value=="number"?J.value.toLocaleString("de-DE",{maximumFractionDigits:2}):J.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:J.unit})]})]},J.key))})]},D.investition_id))})]})]})}function jl({value:r,onChange:s,sensors:t,placeholder:n}){const[a,i]=l.useState(""),[x,c]=l.useState(!1),g=t.filter(o=>{var b;return o.entity_id.toLowerCase().includes(a.toLowerCase())||((b=o.friendly_name)==null?void 0:b.toLowerCase().includes(a.toLowerCase()))}),u=t.find(o=>o.entity_id===r),d=l.useCallback(o=>{s(o),i(""),c(!1)},[s]),p=l.useCallback(()=>{s(null),i("")},[s]),m=r&&r.length>0;return e.jsxs("div",{className:"relative",children:[m?e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${u?"bg-gray-100 dark:bg-gray-700":"bg-amber-50 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700"}`,children:[e.jsxs("span",{className:"flex-1 text-sm truncate",children:[(u==null?void 0:u.friendly_name)||r,!u&&e.jsx("span",{className:"ml-2 text-xs text-amber-600 dark:text-amber-400",children:"(nicht verfügbar)"})]}),e.jsx("button",{onClick:p,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Xt,{className:"w-4 h-4 text-gray-500"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(Sa,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:a,onChange:o=>{i(o.target.value),c(!0)},onFocus:()=>c(!0),placeholder:n||"Sensor suchen...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),x&&!r&&e.jsx("div",{className:"absolute z-10 w-full mt-1 max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:g.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:a?"Keine Sensoren gefunden":"Sensor eingeben..."}):g.slice(0,50).map(o=>e.jsxs("button",{onClick:()=>d(o.entity_id),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:o.friendly_name||o.entity_id}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[o.entity_id,o.unit&&` (${o.unit})`,o.state&&` - ${o.state}`]})]},o.entity_id))})]})}function Oe({label:r,einheit:s,value:t,onChange:n,availableSensors:a,strategieOptionen:i,defaultStrategie:x="sensor",kwpAnteil:c,copDefault:g}){const u=(t==null?void 0:t.strategie)||x,d=o=>{o==="keine"?n({strategie:"keine"}):o==="manuell"?n({strategie:"manuell"}):o==="sensor"?n({strategie:"sensor",sensor_id:(t==null?void 0:t.sensor_id)||null}):o==="kwp_verteilung"?n({strategie:"kwp_verteilung",parameter:{anteil:c||0,basis_sensor:"pv_gesamt"}}):o==="cop_berechnung"?n({strategie:"cop_berechnung",parameter:{cop:g||3.5,basis_feld:"stromverbrauch_kwh"}}):o==="ev_quote"&&n({strategie:"ev_quote",parameter:{}})},p=o=>{n({strategie:"sensor",sensor_id:o})},m=o=>{n({strategie:"cop_berechnung",parameter:{...t==null?void 0:t.parameter,cop:o}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:r}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",s,")"]})]})}),e.jsx("div",{className:"space-y-3",children:i.map(o=>{var b;return e.jsxs("label",{className:`
              flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-colors
              ${u===o.value?"bg-amber-50 dark:bg-amber-900/20 ring-1 ring-amber-500":"hover:bg-gray-50 dark:hover:bg-gray-700/50"}
            `,children:[e.jsx("input",{type:"radio",name:`strategie-${r}`,checked:u===o.value,onChange:()=>d(o.value),className:"mt-1 w-4 h-4 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:o.label}),o.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:o.description}),u==="sensor"&&o.value==="sensor"&&e.jsx("div",{className:"mt-3",children:e.jsx(jl,{value:t==null?void 0:t.sensor_id,onChange:p,sensors:a})}),u==="kwp_verteilung"&&o.value==="kwp_verteilung"&&c!==void 0&&e.jsxs("div",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400",children:[(c*100).toFixed(1),"% von PV Gesamt"]}),u==="cop_berechnung"&&o.value==="cop_berechnung"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"COP:"}),e.jsx("input",{type:"number",step:"0.1",min:"1",max:"10",value:((b=t==null?void 0:t.parameter)==null?void 0:b.cop)||g||3.5,onChange:h=>m(parseFloat(h.target.value)||3.5),className:"w-20 px-2 py-1 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-amber-500"})]})]})]},o.value)})})]})}function yl({value:r,onChange:s,availableSensors:t}){const n=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant Sensor lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard manuell erfassen"}],a=[{value:"sensor",label:"HA-Sensor",description:"PV-Gesamterzeugung aus Wechselrichter-Sensor"},{value:"keine",label:"Nicht verwenden",description:"Jeder PV-String hat einen eigenen Sensor"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{type:"info",title:"Basis-Sensoren",children:"Diese sind die Grundlage für alle Energie-Berechnungen. Die Werte werden typischerweise vom Stromzähler oder Wechselrichter erfasst."}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(gr,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Oe,{label:"Einspeisung",einheit:"kWh",value:r.einspeisung,onChange:i=>s("einspeisung",i),availableSensors:t,strategieOptionen:n})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ot,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Oe,{label:"Netzbezug",einheit:"kWh",value:r.netzbezug,onChange:i=>s("netzbezug",i),availableSensors:t,strategieOptionen:n})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Oe,{label:"PV Erzeugung Gesamt",einheit:"kWh",value:r.pv_gesamt,onChange:i=>s("pv_gesamt",i),availableSensors:t,strategieOptionen:a,defaultStrategie:"keine"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Optional: Wenn du mehrere PV-Strings hast, aber nur einen Gesamtsensor, kann die Erzeugung anteilig nach kWp auf die Strings verteilt werden."})]})]})]})}function kl({investitionen:r,mappings:s,onChange:t,availableSensors:n,gesamtKwp:a,basisPvGesamt:i}){const x=(i==null?void 0:i.strategie)==="sensor"&&(i==null?void 0:i.sensor_id);return e.jsxs("div",{className:"space-y-6",children:[r.length>1&&e.jsx(Q,{type:"info",title:x?"kWp-Verteilung verfügbar":"Tipp",children:x?e.jsx(e.Fragment,{children:"Du hast einen PV-Gesamt-Sensor konfiguriert. Die Erzeugung kann anteilig auf die einzelnen Strings verteilt werden."}):e.jsx(e.Fragment,{children:'Wenn du keinen separaten Sensor pro String hast, konfiguriere zuerst unter "Basis-Sensoren" einen PV-Gesamt-Sensor.'})}),r.map(c=>{var d,p;const g=a>0&&c.kwp?c.kwp/a:0,u=[{value:"sensor",label:"Eigener Sensor",description:"Separater Sensor für diesen PV-String"}];return x&&g>0&&u.push({value:"kwp_verteilung",label:`kWp-Verteilung (${(g*100).toFixed(1)}%)`,description:`${(d=c.kwp)==null?void 0:d.toFixed(1)} kWp von ${a.toFixed(1)} kWp gesamt`}),u.push({value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung}),c.kwp&&e.jsxs("div",{className:"text-xs text-gray-500",children:[c.kwp.toFixed(1)," kWp",g>0&&` (${(g*100).toFixed(1)}%)`]})]})]}),e.jsx("div",{className:"p-4",children:e.jsx(Oe,{label:"PV-Erzeugung",einheit:"kWh",value:((p=s[c.id.toString()])==null?void 0:p.pv_erzeugung_kwh)||null,onChange:m=>t(c.id,"pv_erzeugung_kwh",m),availableSensors:n,strategieOptionen:u,kwpAnteil:g,defaultStrategie:x&&g>0?"kwp_verteilung":"sensor"})})]},c.id)})]})}function fl({investitionen:r,mappings:s,onChange:t,availableSensors:n}){const a=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor für Netzladung"},{value:"keine",label:"Nicht erfassen",description:"Speicher wird nicht aus dem Netz geladen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}];return e.jsx("div",{className:"space-y-6",children:r.map(x=>{var c,g,u;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ze,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:x.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Oe,{label:"Ladung",einheit:"kWh",value:((c=s[x.id.toString()])==null?void 0:c.ladung_kwh)||null,onChange:d=>t(x.id,"ladung_kwh",d),availableSensors:n,strategieOptionen:a}),e.jsx(Oe,{label:"Entladung",einheit:"kWh",value:((g=s[x.id.toString()])==null?void 0:g.entladung_kwh)||null,onChange:d=>t(x.id,"entladung_kwh",d),availableSensors:n,strategieOptionen:a}),e.jsx(Oe,{label:"Netzladung",einheit:"kWh",value:((u=s[x.id.toString()])==null?void 0:u.ladung_netz_kwh)||null,onChange:d=>t(x.id,"ladung_netz_kwh",d),availableSensors:n,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2 ml-1",children:"Netzladung wird für Arbitrage-Auswertung (Speicher aus Netz laden) benötigt."})]})]},x.id)})})}function wl({investitionen:r,mappings:s,onChange:t,availableSensors:n}){const a=[{value:"sensor",label:"HA-Sensor",description:"Stromverbrauch aus Energiemessung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"Wärmemengenzähler",description:"Direkte Messung der Heizenergie"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Stromverbrauch × COP (JAZ)"}],x=[{value:"sensor",label:"Wärmemengenzähler",description:"Separater Sensor für Warmwasser"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Anteil Strom × COP"},{value:"keine",label:"Nicht separat erfassen",description:"Warmwasser ist in Heizenergie enthalten"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{type:"info",title:"COP-Berechnung",children:"Wenn kein Wärmemengenzähler vorhanden ist, kann die Heizenergie über den COP (Coefficient of Performance) berechnet werden. Der COP sollte aus den Investitions-Parametern übernommen werden."}),r.map(c=>{var g,u,d;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Rt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung}),c.cop&&e.jsxs("div",{className:"text-xs text-gray-500",children:["JAZ/COP: ",c.cop.toFixed(1)]})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-amber-100 dark:bg-amber-900/30 rounded flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(ye,{className:"w-3 h-3 text-amber-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Oe,{label:"Stromverbrauch",einheit:"kWh",value:((g=s[c.id.toString()])==null?void 0:g.stromverbrauch_kwh)||null,onChange:p=>t(c.id,"stromverbrauch_kwh",p),availableSensors:n,strategieOptionen:a})})]}),e.jsx(Oe,{label:"Heizenergie",einheit:"kWh",value:((u=s[c.id.toString()])==null?void 0:u.heizenergie_kwh)||null,onChange:p=>t(c.id,"heizenergie_kwh",p),availableSensors:n,strategieOptionen:i,copDefault:c.cop||3.5}),e.jsx(Oe,{label:"Warmwasser",einheit:"kWh",value:((d=s[c.id.toString()])==null?void 0:d.warmwasser_kwh)||null,onChange:p=>t(c.id,"warmwasser_kwh",p),availableSensors:n,strategieOptionen:x,copDefault:c.cop?c.cop-.5:3,defaultStrategie:"keine"})]})]},c.id)})]})}function Nl({investitionen:r,mappings:s,onChange:t,availableSensors:n}){const a=r.filter(o=>o.typ==="e-auto"),i=r.filter(o=>o.typ==="wallbox"),x=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],c=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor für Netzladung"},{value:"ev_quote",label:"EV-Quote berechnen",description:"Basierend auf Anlagen-Eigenverbrauchsquote"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],g=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Kilometerstand monatlich erfassen"}],u=[{value:"sensor",label:"HA-Sensor",description:"V2H/V2G Entladung"},{value:"keine",label:"Nicht vorhanden",description:"Kein Vehicle-to-Home"}],d=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Keine externe Ladung"}],p=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Wird aus Ladung berechnet"}],m=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Wallbox-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Optional"}];return e.jsxs("div",{className:"space-y-6",children:[a.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"E-Autos"]}),a.map(o=>{var b,h,y,k,j,w;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Ae,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Oe,{label:"Ladung PV",einheit:"kWh",value:((b=s[o.id.toString()])==null?void 0:b.ladung_pv_kwh)||null,onChange:v=>t(o.id,"ladung_pv_kwh",v),availableSensors:n,strategieOptionen:x}),e.jsx(Oe,{label:"Ladung Netz",einheit:"kWh",value:((h=s[o.id.toString()])==null?void 0:h.ladung_netz_kwh)||null,onChange:v=>t(o.id,"ladung_netz_kwh",v),availableSensors:n,strategieOptionen:c}),e.jsx(Oe,{label:"Gefahrene Kilometer",einheit:"km",value:((y=s[o.id.toString()])==null?void 0:y.km_gefahren)||null,onChange:v=>t(o.id,"km_gefahren",v),availableSensors:n,strategieOptionen:g,defaultStrategie:"manuell"}),e.jsx(Oe,{label:"V2H Entladung",einheit:"kWh",value:((k=s[o.id.toString()])==null?void 0:k.v2h_entladung_kwh)||null,onChange:v=>t(o.id,"v2h_entladung_kwh",v),availableSensors:n,strategieOptionen:u,defaultStrategie:"keine"}),e.jsx(Oe,{label:"Verbrauch gesamt",einheit:"kWh",value:((j=s[o.id.toString()])==null?void 0:j.verbrauch_kwh)||null,onChange:v=>t(o.id,"verbrauch_kwh",v),availableSensors:n,strategieOptionen:p,defaultStrategie:"keine"}),e.jsx(Oe,{label:"Ladung Extern",einheit:"kWh",value:((w=s[o.id.toString()])==null?void 0:w.ladung_extern_kwh)||null,onChange:v=>t(o.id,"ladung_extern_kwh",v),availableSensors:n,strategieOptionen:d,defaultStrategie:"keine"})]})]},o.id)})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2 mt-8",children:[e.jsx(Vs,{className:"w-5 h-5"}),"Wallboxen"]}),e.jsx(Q,{type:"info",children:"Wallbox-Ladung wird für die Gesamtübersicht verwendet. Die Zuordnung PV/Netz erfolgt über die E-Auto-Konfiguration."}),i.map(o=>{var b,h;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Vs,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:o.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Oe,{label:"Ladung Gesamt",einheit:"kWh",value:((b=s[o.id.toString()])==null?void 0:b.ladung_kwh)||null,onChange:y=>t(o.id,"ladung_kwh",y),availableSensors:n,strategieOptionen:x}),e.jsx(Oe,{label:"Ladevorgänge",einheit:"Anzahl",value:((h=s[o.id.toString()])==null?void 0:h.ladevorgaenge)||null,onChange:y=>t(o.id,"ladevorgaenge",y),availableSensors:n,strategieOptionen:m,defaultStrategie:"keine"})]})]},o.id)})]})]})}function vl({investitionen:r,mappings:s,onChange:t,availableSensors:n}){const a=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung vom Wechselrichter"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Falls separater Sensor vorhanden"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Wird aus Erzeugung - Einspeisung berechnet"}],x=[{value:"sensor",label:"HA-Sensor",description:"Z.B. von Speicher-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Kein Speicher",description:"BKW ohne Speicher"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{type:"info",children:"Balkonkraftwerke können optional einen integrierten Speicher haben. Konfiguriere die Speicher-Felder nur, wenn dein BKW einen Speicher hat."}),r.map(c=>{var g,u,d,p;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Oe,{label:"PV-Erzeugung",einheit:"kWh",value:((g=s[c.id.toString()])==null?void 0:g.pv_erzeugung_kwh)||null,onChange:m=>t(c.id,"pv_erzeugung_kwh",m),availableSensors:n,strategieOptionen:a}),e.jsx(Oe,{label:"Eigenverbrauch",einheit:"kWh",value:((u=s[c.id.toString()])==null?void 0:u.eigenverbrauch_kwh)||null,onChange:m=>t(c.id,"eigenverbrauch_kwh",m),availableSensors:n,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx(Oe,{label:"Speicher Ladung",einheit:"kWh",value:((d=s[c.id.toString()])==null?void 0:d.speicher_ladung_kwh)||null,onChange:m=>t(c.id,"speicher_ladung_kwh",m),availableSensors:n,strategieOptionen:x,defaultStrategie:"keine"}),e.jsx(Oe,{label:"Speicher Entladung",einheit:"kWh",value:((p=s[c.id.toString()])==null?void 0:p.speicher_entladung_kwh)||null,onChange:m=>t(c.id,"speicher_entladung_kwh",m),availableSensors:n,strategieOptionen:x,defaultStrategie:"keine"})]})]},c.id)})]})}const _l={sensor:e.jsx(Ma,{className:"w-4 h-4 text-green-500"}),kwp_verteilung:e.jsx(vr,{className:"w-4 h-4 text-blue-500"}),cop_berechnung:e.jsx(ya,{className:"w-4 h-4 text-purple-500"}),ev_quote:e.jsx(vr,{className:"w-4 h-4 text-amber-500"}),manuell:e.jsx(Jr,{className:"w-4 h-4 text-gray-500"}),keine:e.jsx(Na,{className:"w-4 h-4 text-gray-400"})},zl={sensor:"HA-Sensor",kwp_verteilung:"kWp-Verteilung",cop_berechnung:"COP-Berechnung",ev_quote:"EV-Quote",manuell:"Manuell",keine:"Nicht erfassen"},Sl={"pv-module":e.jsx(ae,{className:"w-4 h-4"}),speicher:e.jsx(ze,{className:"w-4 h-4"}),waermepumpe:e.jsx(Rt,{className:"w-4 h-4"}),"e-auto":e.jsx(Ae,{className:"w-4 h-4"}),wallbox:e.jsx(ye,{className:"w-4 h-4"})};function Vr({label:r,mapping:s}){var t,n;return s?e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:r}),e.jsxs("div",{className:"flex items-center gap-2",children:[_l[s.strategie],e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:zl[s.strategie]}),s.strategie==="sensor"&&s.sensor_id&&e.jsxs("span",{className:"text-xs text-gray-500 max-w-[200px] truncate",children:["(",s.sensor_id,")"]}),s.strategie==="cop_berechnung"&&((t=s.parameter)==null?void 0:t.cop)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(COP: ",s.parameter.cop,")"]}),s.strategie==="kwp_verteilung"&&((n=s.parameter)==null?void 0:n.anteil)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(s.parameter.anteil*100).toFixed(1),"%)"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:r}),e.jsx("span",{className:"text-sm text-gray-400 italic",children:"Nicht konfiguriert"})]})}function El({state:r,investitionen:s}){const t={sensor:0,kwp_verteilung:0,cop_berechnung:0,ev_quote:0,manuell:0,keine:0},n=i=>{i!=null&&i.strategie&&t[i.strategie]++};n(r.basis.einspeisung),n(r.basis.netzbezug),n(r.basis.pv_gesamt),Object.values(r.investitionen).forEach(i=>{Object.values(i).forEach(x=>{n(x)})});const a=t.sensor+t.kwp_verteilung+t.cop_berechnung+t.ev_quote+t.manuell;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(ar,{icon:e.jsx(Ma,{className:"w-5 h-5 text-green-500"}),label:"HA-Sensor",count:t.sensor}),e.jsx(ar,{icon:e.jsx(vr,{className:"w-5 h-5 text-blue-500"}),label:"kWp-Verteilung",count:t.kwp_verteilung}),e.jsx(ar,{icon:e.jsx(ya,{className:"w-5 h-5 text-purple-500"}),label:"COP-Berechnung",count:t.cop_berechnung}),e.jsx(ar,{icon:e.jsx(vr,{className:"w-5 h-5 text-amber-500"}),label:"EV-Quote",count:t.ev_quote}),e.jsx(ar,{icon:e.jsx(Jr,{className:"w-5 h-5 text-gray-500"}),label:"Manuell",count:t.manuell}),e.jsx(ar,{icon:e.jsx(Na,{className:"w-5 h-5 text-gray-400"}),label:"Keine",count:t.keine})]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[a," Felder konfiguriert"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Basis-Sensoren"})]}),e.jsxs("div",{className:"px-4 py-2",children:[e.jsx(Vr,{label:"Einspeisung",mapping:r.basis.einspeisung}),e.jsx(Vr,{label:"Netzbezug",mapping:r.basis.netzbezug}),e.jsx(Vr,{label:"PV Gesamt",mapping:r.basis.pv_gesamt})]})]}),s.map(i=>{const x=r.investitionen[i.id.toString()]||{};return Object.keys(x).length===0?null:e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:Sl[i.typ]||e.jsx(ye,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:i.bezeichnung}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.typ,")"]})]}),e.jsx("div",{className:"px-4 py-2",children:Object.entries(x).map(([c,g])=>e.jsx(Vr,{label:c.replace(/_/g," ").replace("kwh","(kWh)"),mapping:g},c))})]},i.id)})]})}function ar({icon:r,label:s,count:t}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"flex justify-center mb-1",children:r}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t}),e.jsx("div",{className:"text-xs text-gray-500",children:s})]})}const na={basis:{einspeisung:null,netzbezug:null,pv_gesamt:null},investitionen:{}};function Wl(){var ie,we,Y;const r=Ft(),[s]=Ta(),t=s.get("anlage"),n=t?parseInt(t,10):null,[a,i]=l.useState(0),[x,c]=l.useState(na),[g,u]=l.useState(null),[d,p]=l.useState(!1),[m,o]=l.useState(!1),[b,h]=l.useState(!1),[y,k]=l.useState(null),[j,w]=l.useState(null),[v,N]=l.useState(!1),[f,_]=l.useState(!1),[I,C]=l.useState(!1),[P,A]=l.useState(!1),[z,S]=l.useState(null),[W,V]=l.useState(null),[oe,R]=l.useState([]),[M,H]=l.useState(!0),[re,me]=l.useState(null),q=n||((ie=z==null?void 0:z[0])==null?void 0:ie.id);l.useEffect(()=>{async function K(){var pe,We,Se,xt;H(!0),me(null);try{if(!n){const Pe=await dt.list();if(S(Pe),!Pe.length){H(!1);return}}const L=n||((pe=z==null?void 0:z[0])==null?void 0:pe.id);if(!L)return;const[he,Ce]=await Promise.all([ur.getMapping(L),ur.getAvailableSensors(L).catch(()=>[])]);if(V(he),R(Ce),he!=null&&he.mapping){const Pe=he.mapping;c({basis:{einspeisung:((We=Pe.basis)==null?void 0:We.einspeisung)||null,netzbezug:((Se=Pe.basis)==null?void 0:Se.netzbezug)||null,pv_gesamt:((xt=Pe.basis)==null?void 0:xt.pv_gesamt)||null},investitionen:Object.fromEntries(Object.entries(Pe.investitionen||{}).map(([Fe,Ue])=>[Fe,Ue.felder||{}]))})}}catch(L){me(L.message||"Fehler beim Laden")}finally{H(!1)}}K()},[n,(we=z==null?void 0:z[0])==null?void 0:we.id]);const $=l.useMemo(()=>{var We,Se,xt,L,he,Ce;if(!W)return[];const K=[{id:"basis",title:"Basis-Sensoren",icon:e.jsx(ye,{className:"w-5 h-5"})}],pe=W.investitionen.reduce((Pe,Fe)=>(Pe[Fe.typ]||(Pe[Fe.typ]=[]),Pe[Fe.typ].push(Fe),Pe),{});return(We=pe["pv-module"])!=null&&We.length&&K.push({id:"pv",title:"PV-Module",icon:e.jsx(ae,{className:"w-5 h-5"}),investitionen:pe["pv-module"]}),(Se=pe.speicher)!=null&&Se.length&&K.push({id:"speicher",title:"Speicher",icon:e.jsx(ze,{className:"w-5 h-5"}),investitionen:pe.speicher}),(xt=pe.waermepumpe)!=null&&xt.length&&K.push({id:"wp",title:"Wärmepumpe",icon:e.jsx(Rt,{className:"w-5 h-5"}),investitionen:pe.waermepumpe}),((L=pe["e-auto"])!=null&&L.length||(he=pe.wallbox)!=null&&he.length)&&K.push({id:"eauto",title:"E-Auto & Wallbox",icon:e.jsx(Ae,{className:"w-5 h-5"}),investitionen:[...pe["e-auto"]||[],...pe.wallbox||[]]}),(Ce=pe.balkonkraftwerk)!=null&&Ce.length&&K.push({id:"bkw",title:"Balkonkraftwerk",icon:e.jsx(ae,{className:"w-5 h-5"}),investitionen:pe.balkonkraftwerk}),K.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(At,{className:"w-5 h-5"})}),K},[W]),Z=l.useCallback((K,pe)=>{c(We=>({...We,basis:{...We.basis,[K]:pe}}))},[]),G=l.useCallback((K,pe,We)=>{We&&c(Se=>({...Se,investitionen:{...Se.investitionen,[K.toString()]:{...Se.investitionen[K.toString()],[pe]:We}}}))},[]),U=l.useCallback(async()=>{if(q){p(!0),u(null);try{const K={basis:{einspeisung:x.basis.einspeisung,netzbezug:x.basis.netzbezug,pv_gesamt:x.basis.pv_gesamt},investitionen:Object.fromEntries(Object.entries(x.investitionen).map(([pe,We])=>[pe,{felder:We}]))};await ur.saveMapping(q,K),o(!0)}catch(K){u(K.message||"Fehler beim Speichern")}finally{p(!1)}}},[x,q]),ne=l.useCallback(async()=>{if(q){h(!0);try{const K=await ur.initStartValues(q);k(K)}catch(K){k({success:!1,message:K.message||"Fehler beim Initialisieren",updated_fields:0})}finally{h(!1)}}},[q]);l.useEffect(()=>{m&&j===null&&(N(!0),Mt.getStatus().then(K=>w(K.verfuegbar)).catch(()=>w(!1)).finally(()=>N(!1)))},[m,j]);const xe=l.useCallback(async()=>{if(q){_(!0);try{const K=new Date,pe=K.getFullYear(),We=K.getMonth()+1,xt=(await Mt.getMonatsanfangWerte(q,pe,We)).startwerte||{},L=Object.keys(xt).length;L>0?k({success:!0,message:`Startwerte für ${We}/${pe} aus HA-Statistik geladen`,updated_fields:L}):k({success:!1,message:"Keine Daten in HA-Statistik für diesen Monat gefunden. Möglicherweise sind noch keine Langzeit-Statistiken für die konfigurierten Sensoren vorhanden.",updated_fields:0})}catch(K){k({success:!1,message:K.message||"Fehler beim Laden aus HA-Statistik",updated_fields:0})}finally{_(!1)}}},[q]),Ne=l.useCallback(()=>{r("/einstellungen/ha-export?saved=true")},[r]),ee=l.useCallback(async()=>{if(q){C(!0);try{await ur.deleteMapping(q),c(na),V(K=>K?{...K,mapping:null,mqtt_setup_complete:!1}:null),A(!1),window.location.reload()}catch(K){u(K.message||"Fehler beim Löschen")}finally{C(!1)}}},[q]),ue=a<$.length-1,Le=a>0,te=a===$.length-1,X=()=>{ue&&i(K=>K+1)},D=()=>{Le&&i(K=>K-1)};if(!q&&!M)return e.jsx("div",{className:"p-6",children:e.jsx(Q,{type:"warning",children:"Keine Anlage vorhanden. Bitte zuerst eine Anlage erstellen."})});if(M)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx($e,{className:"w-8 h-8 animate-spin text-amber-500"})});if(re)return e.jsx("div",{className:"p-6",children:e.jsxs(Q,{type:"error",children:["Fehler beim Laden: ",re]})});if(m)return e.jsx("div",{className:"max-w-2xl mx-auto p-6 space-y-6",children:e.jsxs(E,{children:[e.jsx(Bs,{title:"Sensor-Zuordnung gespeichert",subtitle:"MQTT-Sensoren wurden erfolgreich erstellt"}),e.jsx("div",{className:"mt-6 space-y-4",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Q,{type:y.success?"success":"error",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:y.message}),y.updated_fields>0&&e.jsxs("p",{className:"text-sm opacity-80",children:[y.updated_fields," Startwert(e) wurden in Home Assistant gesetzt."]})]})}),e.jsxs(le,{onClick:Ne,children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),"Fertig"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{type:"info",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Möchten Sie die Monatsstart-Werte jetzt initialisieren?"}),e.jsx("p",{className:"text-sm opacity-80",children:"Die Startwerte werden als Basis für die monatliche Berechnung benötigt. Der berechnete Monatswert startet dann bei 0 und steigt mit der Zeit."})]})}),e.jsxs("div",{className:"space-y-3",children:[v?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx($e,{className:"w-4 h-4 animate-spin"}),"Prüfe HA-Statistik-Verfügbarkeit..."]}):j&&e.jsxs("div",{className:"p-4 border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200 mb-2",children:[e.jsx("strong",{children:"Empfohlen:"})," Startwerte aus HA-Langzeitstatistik laden"]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mb-3",children:"Verwendet die gespeicherten Zählerstände vom Monatsanfang aus der HA-Datenbank."}),e.jsx(le,{onClick:xe,disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 mr-2 animate-spin"}),"Lade aus HA-DB..."]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),"Aus HA-Statistik laden (empfohlen)"]})})]}),e.jsxs("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Aktuelle Sensor-Werte als Startwerte setzen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Verwendet die aktuellen Zählerstände. Der Monatswert startet dann bei 0."}),e.jsx(le,{variant:"secondary",onClick:ne,disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 mr-2 animate-spin"}),"Initialisiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Aktuelle Werte verwenden"]})})]}),e.jsx(le,{variant:"secondary",onClick:Ne,className:"mt-2",children:"Überspringen"})]})]})})]})});if($.length===0)return e.jsx("div",{className:"p-6",children:e.jsx(Q,{type:"info",children:"Keine Konfiguration erforderlich. Bitte zuerst Investitionen (PV-Module, Speicher, etc.) anlegen."})});const J=$[a];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sensor-Zuordnung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[W==null?void 0:W.anlage_name," - Home Assistant Sensoren konfigurieren"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(W==null?void 0:W.mapping)&&Object.keys(W.mapping).length>0&&e.jsxs(le,{variant:"secondary",onClick:()=>A(!0),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",children:[e.jsx(ht,{className:"w-4 h-4 mr-2"}),"Mapping löschen"]}),e.jsx(le,{variant:"secondary",onClick:()=>r(-1),children:"Abbrechen"})]})]}),P&&e.jsx(Q,{type:"warning",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Sensor-Mapping wirklich löschen?"}),e.jsx("p",{className:"text-sm mt-1",children:"Alle Sensor-Zuordnungen und MQTT-Entities werden entfernt. Die Monatsdaten bleiben erhalten."})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(le,{variant:"secondary",size:"sm",onClick:()=>A(!1),disabled:I,children:"Abbrechen"}),e.jsx(le,{size:"sm",onClick:ee,disabled:I,className:"bg-red-600 hover:bg-red-700",children:I?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 mr-2 animate-spin"}),"Lösche..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-4 h-4 mr-2"}),"Löschen"]})})]})]})}),e.jsx(E,{padding:"sm",children:e.jsx("div",{className:"flex items-center overflow-x-auto py-2",children:$.map((K,pe)=>{const We=pe<a,Se=pe===a;return e.jsxs("div",{className:"flex items-center flex-shrink-0",children:[e.jsxs("button",{onClick:()=>i(pe),className:`
                    flex items-center gap-2 px-3 py-2 rounded-lg transition-all
                    ${Se?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":We?"text-green-600 dark:text-green-400 hover:bg-gray-100 dark:hover:bg-gray-700":"text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("div",{className:`
                      w-7 h-7 rounded-full flex items-center justify-center text-sm
                      ${We?"bg-green-500 text-white":Se?"bg-amber-500 text-white":"bg-gray-200 dark:bg-gray-700"}
                    `,children:We?e.jsx(At,{className:"w-4 h-4"}):pe+1}),e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:K.title})]}),pe<$.length-1&&e.jsx(vt,{className:"w-5 h-5 text-gray-300 dark:text-gray-600 mx-1"})]},K.id)})})}),e.jsxs(E,{children:[e.jsx(Bs,{title:J.title,subtitle:J.id==="basis"?"Ordne die grundlegenden Energie-Sensoren zu":J.id==="summary"?"Überprüfe deine Einstellungen":`Konfiguriere die Sensoren für ${((Y=J.investitionen)==null?void 0:Y.length)||0} Komponente(n)`,action:e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[J.icon,e.jsxs("span",{className:"text-sm",children:[a+1," / ",$.length]})]})}),e.jsxs("div",{className:"mt-6",children:[J.id==="basis"&&e.jsx(yl,{value:x.basis,onChange:Z,availableSensors:oe}),J.id==="pv"&&e.jsx(kl,{investitionen:J.investitionen||[],mappings:x.investitionen,onChange:G,availableSensors:oe,gesamtKwp:(W==null?void 0:W.gesamt_kwp)||0,basisPvGesamt:x.basis.pv_gesamt}),J.id==="speicher"&&e.jsx(fl,{investitionen:J.investitionen||[],mappings:x.investitionen,onChange:G,availableSensors:oe}),J.id==="wp"&&e.jsx(wl,{investitionen:J.investitionen||[],mappings:x.investitionen,onChange:G,availableSensors:oe}),J.id==="eauto"&&e.jsx(Nl,{investitionen:J.investitionen||[],mappings:x.investitionen,onChange:G,availableSensors:oe}),J.id==="bkw"&&e.jsx(vl,{investitionen:J.investitionen||[],mappings:x.investitionen,onChange:G,availableSensors:oe}),J.id==="summary"&&e.jsx(El,{state:x,investitionen:(W==null?void 0:W.investitionen)||[]})]}),g&&e.jsxs(Q,{type:"error",className:"mt-6",children:[e.jsx(Ge,{className:"w-4 h-4 inline mr-2"}),g]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(le,{variant:"secondary",onClick:D,disabled:!Le,children:[e.jsx(ka,{className:"w-4 h-4 mr-2"}),"Zurück"]}),te?e.jsx(le,{onClick:U,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Speichern & Abschließen"]})}):e.jsxs(le,{onClick:X,children:["Weiter",e.jsx(vt,{className:"w-4 h-4 ml-2"})]})]})]})]})}const Ml=["","Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],Ms={"pv-module":e.jsx(ae,{className:"w-5 h-5"}),speicher:e.jsx(ze,{className:"w-5 h-5"}),waermepumpe:e.jsx(Rt,{className:"w-5 h-5"}),"e-auto":e.jsx(Ae,{className:"w-5 h-5"}),wallbox:e.jsx(ye,{className:"w-5 h-5"})};function ds(){const{anlageId:r,jahr:s,monat:t}=Ra(),n=Ft(),[a,i]=l.useState(!0),[x,c]=l.useState(!1),[g,u]=l.useState(!1),[d,p]=l.useState(null),[m,o]=l.useState(null),[b,h]=l.useState(null),[y,k]=l.useState(""),[j,w]=l.useState(null),[v,N]=l.useState(0),[f,_]=l.useState({basis:{},optionale:{},investitionen:{}}),[I,C]=l.useState(s?parseInt(s):new Date().getFullYear()),[P,A]=l.useState(t?parseInt(t):new Date().getMonth()+1);l.useEffect(()=>{(async()=>{if(!r){try{const M=await dt.list();M.length>0?n(`/monatsabschluss/${M[0].id}`):p("Keine Anlage gefunden")}catch{p("Fehler beim Laden der Anlagen")}i(!1);return}i(!0),p(null);try{let M=I,H=P;if(!s||!t){const Z=await ts.getNaechsterMonat(parseInt(r));Z&&(M=Z.jahr,H=Z.monat,C(M),A(H))}const re=await ts.getStatus(parseInt(r),M,H);w(re),k(re.anlage_name);const me={};for(const Z of re.basis_felder)me[Z.feld]=Z.aktueller_wert;const q={};for(const Z of re.optionale_felder||[])Z.typ==="text"?q[Z.feld]=Z.aktueller_text:q[Z.feld]=Z.aktueller_wert;const $={};for(const Z of re.investitionen){$[Z.id]={};for(const G of Z.felder)$[Z.id][G.feld]=G.aktueller_wert}_({basis:me,optionale:q,investitionen:$})}catch(M){p("Fehler beim Laden der Monatsdaten"),console.error(M)}finally{i(!1)}})()},[r,s,t,I,P,n]);const z=l.useMemo(()=>{if(!j)return[];const R=[{id:"basis",title:"Zählerdaten",icon:e.jsx(ye,{className:"w-4 h-4"})}],M={};for(const H of j.investitionen)M[H.typ]||(M[H.typ]=[]),M[H.typ].push(H);for(const H of Object.keys(M))R.push({id:H,title:Ia(H),icon:Ms[H]||e.jsx(ye,{className:"w-4 h-4"})});return j.optionale_felder&&j.optionale_felder.length>0&&R.push({id:"optionale",title:"Sonstiges",icon:e.jsx(Ur,{className:"w-4 h-4"})}),R.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(tt,{className:"w-4 h-4"})}),R},[j]),S=(R,M,H)=>{_(H?re=>({...re,investitionen:{...re.investitionen,[H]:{...re.investitionen[H],[R]:M}}}):re=>({...re,basis:{...re.basis,[R]:M}}))},W=(R,M)=>{_(H=>({...H,optionale:{...H.optionale,[R]:M}}))},V=async()=>{if(r){u(!0),p(null),h(null);try{if(!(await Mt.getStatus()).verfuegbar){p("Home Assistant Datenbank nicht verfügbar");return}const M=await Mt.getMonatswerte(parseInt(r),I,P);let H=0;const re={...f.basis};for(const q of M.basis)q.wert!==null&&q.wert!==void 0&&(re[q.feld]=q.wert,H++);const me={...f.investitionen};for(const q of M.investitionen){me[q.investition_id]||(me[q.investition_id]={});for(const $ of q.felder)$.wert!==null&&$.wert!==void 0&&(me[q.investition_id][$.feld]=$.wert,H++)}_(q=>({...q,basis:re,investitionen:me})),h(`${H} Werte aus HA-Statistik geladen`)}catch(R){console.error(R),p("Fehler beim Laden der HA-Werte. Ist das Sensor-Mapping konfiguriert?")}finally{u(!1)}}},oe=async()=>{if(!(!j||!r)){c(!0),p(null),o(null);try{const R={einspeisung_kwh:f.basis.einspeisung_kwh,netzbezug_kwh:f.basis.netzbezug_kwh,globalstrahlung_kwh_m2:f.basis.globalstrahlung_kwh_m2,sonnenstunden:f.basis.sonnenstunden,durchschnittstemperatur:f.basis.durchschnittstemperatur,sonderkosten_euro:typeof f.optionale.sonderkosten_euro=="number"?f.optionale.sonderkosten_euro:null,sonderkosten_beschreibung:typeof f.optionale.sonderkosten_beschreibung=="string"?f.optionale.sonderkosten_beschreibung:null,notizen:typeof f.optionale.notizen=="string"?f.optionale.notizen:null,investitionen:[]};for(const H of j.investitionen){const re=[],me=f.investitionen[H.id]||{};for(const[q,$]of Object.entries(me))$!=null&&re.push({feld:q,wert:$});re.length>0&&R.investitionen.push({investition_id:H.id,felder:re})}const M=await ts.save(parseInt(r),I,P,R);M.success?(o(M.message),setTimeout(()=>{n("/einstellungen/monatsdaten")},2e3)):p("Speichern fehlgeschlagen")}catch(R){p("Fehler beim Speichern"),console.error(R)}finally{c(!1)}}};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($e,{className:"w-8 h-8 animate-spin text-primary-500"})}):d&&!j?e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(Q,{type:"error",children:d})}):j?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx(it,{className:"w-4 h-4"}),e.jsx("span",{children:y})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Monatsabschluss ",Ml[P]," ",I]}),j.ha_mapping_konfiguriert?e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsx("button",{onClick:V,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:g?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 animate-spin"}),"Lade HA-Werte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"w-4 h-4"}),"Werte aus HA-Statistik laden"]})}),b&&e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:b})]}):e.jsx(Q,{type:"info",className:"mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Home Assistant Sensor-Zuordnung nicht konfiguriert. Werte müssen manuell eingegeben werden."}),e.jsxs(Ha,{to:`/einstellungen/sensor-mapping?anlageId=${r}`,className:"flex items-center gap-1 text-primary-600 hover:underline",children:[e.jsx(ws,{className:"w-4 h-4"}),"Konfigurieren"]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:z.map((R,M)=>e.jsxs("button",{onClick:()=>N(M),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${v===M?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:[R.icon,e.jsx("span",{className:"hidden sm:inline",children:R.title})]},R.id))})}),d&&e.jsx(Q,{type:"error",className:"mb-6",children:d}),m&&e.jsx(Q,{type:"success",className:"mb-6",children:m}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-8",children:[v===0&&e.jsx(Fl,{felder:j.basis_felder,values:f.basis,onChange:(R,M)=>S(R,M)}),v>0&&v<z.length-1&&z[v].id!=="optionale"&&e.jsx(Cl,{typ:z[v].id,investitionen:j.investitionen.filter(R=>R.typ===z[v].id),values:f.investitionen,onChange:(R,M,H)=>S(M,H,R)}),z[v].id==="optionale"&&e.jsx(Al,{felder:j.optionale_felder||[],values:f.optionale,onChange:W}),v===z.length-1&&e.jsx($l,{data:j,values:f})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>N(R=>Math.max(0,R-1)),disabled:v===0,className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ka,{className:"w-4 h-4"}),"Zurück"]}),v<z.length-1?e.jsxs("button",{onClick:()=>N(R=>Math.min(z.length-1,R+1)),className:"flex items-center gap-2 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:["Weiter",e.jsx(vt,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:oe,disabled:x,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:x?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(En,{className:"w-4 h-4"}),"Speichern"]})})]})]}):e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(Q,{type:"info",children:"Keine Daten verfügbar"})})}function Fl({felder:r,values:s,onChange:t}){const n=["einspeisung_kwh","netzbezug_kwh"],a=["globalstrahlung_kwh_m2","sonnenstunden","durchschnittstemperatur"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-amber-500"}),"Zählerdaten"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.filter(i=>n.includes(i.feld)).map(i=>e.jsx(js,{feld:i,value:s[i.feld],onChange:x=>t(i.feld,x)},i.feld))}),e.jsxs("details",{className:"mt-6",children:[e.jsx("summary",{className:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Wetterdaten (optional)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:r.filter(i=>a.includes(i.feld)).map(i=>e.jsx(js,{feld:i,value:s[i.feld],onChange:x=>t(i.feld,x),compact:!0},i.feld))})]})]})}function Al({felder:r,values:s,onChange:t}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ur,{className:"w-5 h-5 text-gray-500"}),"Sonstiges"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Optionale Eingaben für diesen Monat - können auch leer bleiben."}),e.jsx("div",{className:"space-y-4",children:r.map(n=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[n.label,n.einheit&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",n.einheit,")"]})]}),n.typ==="text"?e.jsx("textarea",{value:s[n.feld]||"",onChange:a=>t(n.feld,a.target.value||null),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:n.label}):e.jsx("input",{type:"number",step:"0.01",value:s[n.feld]??"",onChange:a=>t(n.feld,a.target.value?parseFloat(a.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:n.label})]},n.feld))})]})}function Cl({typ:r,investitionen:s,values:t,onChange:n}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[Ms[r],Ia(r)]}),s.map(a=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:a.bezeichnung})}),e.jsx("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:a.felder.map(i=>{var x;return e.jsx(js,{feld:i,value:(x=t[a.id])==null?void 0:x[i.feld],onChange:c=>n(a.id,i.feld,c)},i.feld)})})]},a.id))]})}function $l({data:r,values:s}){var a,i;let t=0,n=0;for(const x of r.basis_felder)["einspeisung_kwh","netzbezug_kwh"].includes(x.feld)&&(n++,s.basis[x.feld]!==null&&s.basis[x.feld]!==void 0&&t++);for(const x of r.investitionen)for(const c of x.felder)n++,((a=s.investitionen[x.id])==null?void 0:a[c.feld])!==null&&((i=s.investitionen[x.id])==null?void 0:i[c.feld])!==void 0&&t++;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-green-500"}),"Zusammenfassung"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[t," von ",n," Feldern ausgefüllt"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Zählerdaten"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r.basis_felder.filter(x=>["einspeisung_kwh","netzbezug_kwh"].includes(x.feld)).map(x=>e.jsx(cs,{label:x.label,wert:s.basis[x.feld],einheit:x.einheit},x.feld))})]}),r.investitionen.map(x=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[Ms[x.typ],e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:x.bezeichnung})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:x.felder.map(c=>{var g;return e.jsx(cs,{label:c.label,wert:(g=s.investitionen[x.id])==null?void 0:g[c.feld],einheit:c.einheit},c.feld)})})]},x.id)),r.optionale_felder&&r.optionale_felder.length>0&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(Ur,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r.optionale_felder.map(x=>e.jsx(cs,{label:x.label,wert:(x.typ==="text",s.optionale[x.feld]),einheit:x.einheit,isText:x.typ==="text"},x.feld))})]})]})}function js({feld:r,value:s,onChange:t,compact:n=!1}){const a=r.warnungen.length>0,i=r.vorschlaege.length>0;return e.jsxs("div",{className:n?"":"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.label,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",r.einheit,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:s??"",onChange:x=>t(x.target.value?parseFloat(x.target.value):null),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${a?"border-amber-300 focus:border-amber-500":"border-gray-300"}`,placeholder:i?`Vorschlag: ${r.vorschlaege[0].wert}`:""}),i&&s===null&&e.jsx("button",{type:"button",onClick:()=>t(r.vorschlaege[0].wert),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400",children:"Übernehmen"})]}),i&&!n&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:r.vorschlaege.slice(0,3).map((x,c)=>e.jsxs("button",{type:"button",onClick:()=>t(x.wert),className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300",title:x.beschreibung,children:[x.wert," ",r.einheit,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",x.quelle,")"]})]},c))}),a&&e.jsx("div",{className:"mt-1",children:r.warnungen.map((x,c)=>e.jsxs("div",{className:`flex items-center gap-1 text-xs ${x.schwere==="error"?"text-red-600 dark:text-red-400":x.schwere==="warning"?"text-amber-600 dark:text-amber-400":"text-blue-600 dark:text-blue-400"}`,children:[x.schwere==="error"?e.jsx(rt,{className:"w-3 h-3"}):x.schwere==="warning"?e.jsx(rt,{className:"w-3 h-3"}):e.jsx(qe,{className:"w-3 h-3"}),x.meldung]},c))})]})}function cs({label:r,wert:s,einheit:t,isText:n=!1}){const a=s!=null&&s!=="";return e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:r}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a?n?e.jsx("span",{className:"max-w-xs truncate",children:s}):e.jsxs(e.Fragment,{children:[typeof s=="number"?s.toLocaleString("de-DE",{maximumFractionDigits:1}):s," ",t]}):e.jsx("span",{className:"text-gray-400 italic",children:"nicht ausgefüllt"})})]})}function Ia(r){return{"pv-module":"PV-Module",speicher:"Speicher",waermepumpe:"Wärmepumpe","e-auto":"E-Auto",wallbox:"Wallbox",balkonkraftwerk:"Balkonkraftwerk"}[r]||r}function Dl(){const r=Ft(),[s,t]=l.useState([]),[n,a]=l.useState(null),[i,x]=l.useState(!0),[c,g]=l.useState(!1),[u,d]=l.useState(!1),[p,m]=l.useState(!1),[o,b]=l.useState(null),[h,y]=l.useState(null),[k,j]=l.useState(null),[w,v]=l.useState(null),[N,f]=l.useState(null),[_,I]=l.useState(new Set),[C,P]=l.useState(new Map),[A,z]=l.useState("alle"),[S,W]=l.useState(new Map);l.useEffect(()=>{(async()=>{try{const U=await dt.list();t(U.map(ne=>({id:ne.id,anlagenname:ne.anlagenname}))),U.length>0&&a(U[0].id)}catch(U){v("Fehler beim Laden der Anlagen"),console.error(U)}finally{x(!1)}})()},[]),l.useEffect(()=>{(async()=>{g(!0);try{const U=await Mt.getStatus();b(U.verfuegbar),y(U.fehler||null)}catch(U){b(!1),y("Fehler bei der Statusprüfung"),console.error(U)}finally{g(!1)}})()},[]);const V=async()=>{if(n){d(!0),v(null),j(null),P(new Map),W(new Map);try{const G=await Mt.getImportVorschau(n);j(G);const U=new Map,ne=new Map;G.monate.forEach(xe=>{const Ne=`${xe.jahr}-${xe.monat}`;U.set(Ne,xe.aktion==="importieren"||xe.aktion==="konflikt");const ee=new Set(Object.keys(xe.ha_werte)),ue=new Map;xe.investitionen&&xe.investitionen.forEach(Le=>{ue.set(Le.investition_id,new Set(Object.keys(Le.ha_werte)))}),ne.set(Ne,{basis:ee,investitionen:ue})}),P(U),W(ne)}catch(G){v("Fehler beim Laden der Vorschau"),console.error(G)}finally{d(!1)}}},oe=(G,U)=>{const ne=`${G}-${U}`,xe=new Map(C);xe.set(ne,!xe.get(ne)),P(xe)},R=(G,U,ne)=>{const xe=`${G}-${U}`,Ne=new Map(S),ee=Ne.get(xe)||{basis:new Set,investitionen:new Map},ue=new Set(ee.basis);ue.has(ne)?ue.delete(ne):ue.add(ne),Ne.set(xe,{...ee,basis:ue}),W(Ne),z("manuell")},M=(G,U,ne,xe)=>{const Ne=`${G}-${U}`,ee=new Map(S),ue=ee.get(Ne)||{basis:new Set,investitionen:new Map},Le=new Map(ue.investitionen),te=new Set(Le.get(ne)||[]);te.has(xe)?te.delete(xe):te.add(xe),Le.set(ne,te),ee.set(Ne,{...ue,investitionen:Le}),W(ee),z("manuell")},H=G=>{if(z(G),!k)return;const U=new Map;k.monate.forEach(ne=>{var ue,Le;const xe=`${ne.jahr}-${ne.monat}`;let Ne=new Set;const ee=new Map;switch(G){case"alle":Ne=new Set(Object.keys(ne.ha_werte)),(ue=ne.investitionen)==null||ue.forEach(X=>{ee.set(X.investition_id,new Set(Object.keys(X.ha_werte)))});break;case"nur_basis":Ne=new Set(Object.keys(ne.ha_werte));break;case"nur_komponenten":(Le=ne.investitionen)==null||Le.forEach(X=>{ee.set(X.investition_id,new Set(Object.keys(X.ha_werte)))});break;case"manuell":const te=S.get(xe);if(te){U.set(xe,te);return}break}U.set(xe,{basis:Ne,investitionen:ee})}),W(U)},re=(k==null?void 0:k.monate.filter(G=>{const U=`${G.jahr}-${G.monat}`;return C.get(U)&&G.aktion!=="ueberspringen"}).length)||0,me=async()=>{if(!n||!k)return;const G=k.monate.filter(U=>{const ne=`${U.jahr}-${U.monat}`;return C.get(ne)&&U.aktion!=="ueberspringen"}).map(U=>{const ne=`${U.jahr}-${U.monat}`,xe=S.get(ne),Ne=xe!=null&&xe.basis.size?Array.from(xe.basis):[],ee={};return xe==null||xe.investitionen.forEach((ue,Le)=>{ue.size>0&&(ee[String(Le)]=Array.from(ue))}),{jahr:U.jahr,monat:U.monat,basis_felder:Ne.length>0?Ne:[],investition_felder:Object.keys(ee).length>0?ee:{}}}).filter(U=>U.basis_felder&&U.basis_felder.length>0||U.investition_felder&&Object.keys(U.investition_felder).length>0);if(G.length===0){v("Keine Felder zum Import ausgewählt");return}m(!0),v(null),f(null);try{const U=await Mt.importieren(n,{monate:G,ueberschreiben:!0});U.erfolg?(f(`Import erfolgreich: ${U.importiert} Monate importiert`+(U.uebersprungen>0?`, ${U.uebersprungen} übersprungen`:"")+(U.ueberschrieben>0?`, ${U.ueberschrieben} überschrieben`:"")+(U.fehler.length>0?`, ${U.fehler.length} Fehler`:"")),await V()):v(U.fehler.join(", ")||"Import fehlgeschlagen")}catch(U){v("Fehler beim Import"),console.error(U)}finally{m(!1)}},q=G=>{const U=new Set(_);U.has(G)?U.delete(G):U.add(G),I(U)},$=G=>{switch(G){case"importieren":return e.jsx(tt,{className:"w-4 h-4 text-green-500"});case"ueberspringen":return e.jsx(Ye,{className:"w-4 h-4 text-gray-400"});case"konflikt":return e.jsx(rt,{className:"w-4 h-4 text-amber-500"});case"ueberschreiben":return e.jsx(rt,{className:"w-4 h-4 text-red-500"});default:return e.jsx(qe,{className:"w-4 h-4 text-blue-500"})}},Z=G=>{const U={importieren:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",ueberspringen:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400",konflikt:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300",ueberschreiben:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},ne={importieren:"Importieren",ueberspringen:"Übersprungen",konflikt:"Konflikt",ueberschreiben:"Überschreiben"};return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${U[G]||""}`,children:ne[G]||G})};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($e,{className:"w-8 h-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(Ut,{className:"w-7 h-7 text-primary-500"}),"HA-Statistik Import"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Importiere historische Monatsdaten aus der Home Assistant Langzeitstatistik-Datenbank."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Datenbank-Status"}),c?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx($e,{className:"w-5 h-5 animate-spin"}),"Prüfe Verbindung..."]}):o?e.jsx(Q,{type:"success",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"}),"Home Assistant Datenbank ist verfügbar"]})}):e.jsx(Q,{type:"error",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_r,{className:"w-5 h-5"}),"Home Assistant Datenbank nicht verfügbar"]}),h&&e.jsx("p",{className:"text-sm",children:h}),e.jsxs("p",{className:"text-sm",children:["Stellen Sie sicher, dass das Add-on mit ",e.jsx("code",{children:"config:ro"})," Volume-Mapping installiert ist. Siehe CHANGELOG v2.0.0 für Upgrade-Anleitung."]})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Anlage auswählen"}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage"}),e.jsx("select",{value:n||"",onChange:G=>{a(Number(G.target.value)),j(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:s.map(G=>e.jsx("option",{value:G.id,children:G.anlagenname},G.id))})]}),e.jsx("button",{onClick:V,disabled:!n||u,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 animate-spin"}),"Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-4 h-4"}),"Vorschau laden"]})})]}),!k&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:"Wichtig: Stellen Sie sicher, dass das Sensor-Mapping für diese Anlage konfiguriert ist, damit die HA-Sensoren den EEDC-Feldern zugeordnet werden können."})]}),w&&e.jsx(Q,{type:"error",className:"mb-6",children:w}),N&&e.jsx(Q,{type:"success",className:"mb-6",children:N}),k&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Import-Vorschau"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Br,{label:"Verfügbare Monate",value:k.anzahl_monate,color:"blue"}),e.jsx(Br,{label:"Zum Import",value:k.anzahl_importieren,color:"green"}),e.jsx(Br,{label:"Konflikte",value:k.anzahl_konflikte,color:"amber"}),e.jsx(Br,{label:"Übersprungen",value:k.anzahl_ueberspringen,color:"gray"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Import-Modus"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>H("alle"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${A==="alle"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Alles importieren"}),e.jsx("button",{onClick:()=>H("nur_basis"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${A==="nur_basis"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Nur Basis (Einspeisung/Netzbezug)"}),e.jsx("button",{onClick:()=>H("nur_komponenten"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${A==="nur_komponenten"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Nur Komponenten"}),A==="manuell"&&e.jsx("span",{className:"px-3 py-1.5 text-sm rounded-lg bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 border border-amber-300 dark:border-amber-700",children:"Manuell (individuelle Auswahl)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Klicken Sie auf einzelne Felder in der Vorschau, um die Auswahl anzupassen."})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Hinweis:"})," Wählen Sie die Monate und Felder aus, die importiert werden sollen. Bei Konflikten (gelb markiert) werden nur die ausgewählten Felder überschrieben."]})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden mb-6",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:k.monate.map(G=>{const U=`${G.jahr}-${G.monat}`;return e.jsx(Ll,{monat:G,expanded:_.has(U),onToggle:()=>q(U),getAktionIcon:$,getAktionBadge:Z,selected:C.get(U)||!1,onSelectionChange:()=>oe(G.jahr,G.monat),feldAuswahl:S.get(U),onToggleBasisFeld:ne=>R(G.jahr,G.monat,ne),onToggleInvFeld:(ne,xe)=>M(G.jahr,G.monat,ne,xe)},U)})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:me,disabled:p||re===0,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2 font-medium",children:p?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-5 h-5 animate-spin"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-5 h-5"}),re," Monate importieren"]})})})]})]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx("button",{onClick:()=>r("/einstellungen/sensor-mapping"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"← Zurück zu Sensor-Zuordnung"}),e.jsx("button",{onClick:()=>r("/einstellungen/monatsdaten"),className:"text-primary-600 hover:text-primary-700",children:"Zu Monatsdaten →"})]})]})}function Br({label:r,value:s,color:t}){const n={blue:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400",green:"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400",amber:"bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400",gray:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400"};return e.jsxs("div",{className:`p-4 rounded-lg ${n[t]}`,children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),e.jsx("div",{className:"text-sm",children:r})]})}function Ll({monat:r,expanded:s,onToggle:t,getAktionIcon:n,getAktionBadge:a,selected:i,onSelectionChange:x,feldAuswahl:c,onToggleBasisFeld:g,onToggleInvFeld:u}){const d=r.aktion!=="ueberspringen",p=Object.keys(r.ha_werte).length>0||r.vorhandene_werte&&Object.keys(r.vorhandene_werte).length>0||r.investitionen&&r.investitionen.length>0;return e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"px-3 py-3",children:d?e.jsx("input",{type:"checkbox",checked:i,onChange:m=>{m.stopPropagation(),x()},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("button",{onClick:t,className:"flex-1 px-2 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p?s?e.jsx($t,{className:"w-4 h-4 text-gray-400"}):e.jsx(vt,{className:"w-4 h-4 text-gray-400"}):e.jsx("div",{className:"w-4"}),e.jsx(it,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[r.monat_name," ",r.jahr]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n(r.aktion),a(r.aktion)]})]})]}),s&&p&&e.jsxs("div",{className:"px-4 pb-4 pt-2 bg-gray-50 dark:bg-gray-700/30",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:r.grund}),(Object.keys(r.ha_werte).length>0||r.vorhandene_werte&&Object.keys(r.vorhandene_werte).length>0)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Basis-Werte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"w-8 py-1"}),e.jsx("th",{className:"text-left py-1 pr-4 font-medium text-gray-600 dark:text-gray-300",children:"Feld"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-gray-600 dark:text-gray-300",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-blue-600 dark:text-blue-400",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-1 pl-2 font-medium text-gray-600 dark:text-gray-300",children:"Diff"})]})}),e.jsx("tbody",{children:Object.keys(r.ha_werte).map(m=>{var j;const o=r.ha_werte[m],b=((j=r.vorhandene_werte)==null?void 0:j[m])??null,h=o!==null&&b!==null?o-b:null,y=h!==null&&Math.abs(h)>=1,k=(c==null?void 0:c.basis.has(m))??!0;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 ${y?"bg-amber-50/50 dark:bg-amber-900/10":""} ${k?"":"opacity-50"}`,onClick:()=>g(m),children:[e.jsx("td",{className:"py-1 pl-2",children:e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"py-1 pr-4 text-gray-700 dark:text-gray-300",children:m}),e.jsx("td",{className:"py-1 px-2 text-right text-gray-600 dark:text-gray-400",children:b!=null?b.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:"py-1 px-2 text-right font-medium text-blue-700 dark:text-blue-300",children:o!==null?o.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:`py-1 pl-2 text-right ${y?"font-medium text-amber-600 dark:text-amber-400":"text-gray-500"}`,children:h!==null?(h>=0?"+":"")+h.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"})]},m)})})]})})]}),r.investitionen&&r.investitionen.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Komponenten"}),r.investitionen.map(m=>{const o=c==null?void 0:c.investitionen.get(m.investition_id);return e.jsxs("div",{className:`rounded-lg border p-3 ${m.hat_abweichung?"border-amber-300 dark:border-amber-700 bg-amber-50/50 dark:bg-amber-900/10":"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:m.bezeichnung}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:m.typ}),m.hat_abweichung&&e.jsx(rt,{className:"w-4 h-4 text-amber-500"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"w-8 py-1"}),e.jsx("th",{className:"text-left py-1 pr-4 font-medium text-gray-600 dark:text-gray-300",children:"Feld"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-gray-600 dark:text-gray-300",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-blue-600 dark:text-blue-400",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-1 pl-2 font-medium text-gray-600 dark:text-gray-300",children:"Diff"})]})}),e.jsx("tbody",{children:Object.keys(m.ha_werte).map(b=>{const h=m.ha_werte[b],y=m.vorhandene_werte[b],k=h!==null&&y!==null?h-y:null,j=k!==null&&Math.abs(k)>=1,w=(o==null?void 0:o.has(b))??!0;return e.jsxs("tr",{className:`cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 ${j?"bg-amber-50/30 dark:bg-amber-900/5":""} ${w?"":"opacity-50"}`,onClick:()=>u(m.investition_id,b),children:[e.jsx("td",{className:"py-1 pl-2",children:e.jsx("input",{type:"checkbox",checked:w,onChange:()=>{},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"py-1 pr-4 text-gray-700 dark:text-gray-300",children:b}),e.jsx("td",{className:"py-1 px-2 text-right text-gray-600 dark:text-gray-400",children:y!=null?y.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:"py-1 px-2 text-right font-medium text-blue-700 dark:text-blue-300",children:h!==null?h.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"}),e.jsx("td",{className:`py-1 pl-2 text-right ${j?"font-medium text-amber-600 dark:text-amber-400":"text-gray-500"}`,children:k!==null?(k>=0?"+":"")+k.toLocaleString("de-DE",{maximumFractionDigits:1}):"–"})]},b)})})]})})]},m.investition_id)})]})]})]})}const Pl={BW:"Baden-Württemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thüringen",AT:"Österreich",CH:"Schweiz",XX:"Unbekannt"};function Il(){const r=Ft(),[s,t]=l.useState([]),[n,a]=l.useState(null),[i,x]=l.useState(null),[c,g]=l.useState(null),[u,d]=l.useState(null),[p,m]=l.useState(!0),[o,b]=l.useState(!1),[h,y]=l.useState(!1),[k,j]=l.useState(!1),[w,v]=l.useState(null),[N,f]=l.useState(!1),[_,I]=l.useState(!1),[C,P]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const W=await dt.list();t(W),W.length===1&&a(W[0].id)}catch(W){const V=W instanceof Error?W.message:"Fehler beim Laden";v(V)}finally{m(!1)}})()},[]),l.useEffect(()=>{(async()=>{try{const W=await Re.getStatus();x(W)}catch{x({online:!1,url:"https://energy.raunet.eu",error:"Nicht erreichbar"})}})()},[]),l.useEffect(()=>{if(!n){g(null);return}(async()=>{b(!0),v(null);try{const W=await Re.getPreview(n);g(W)}catch(W){const V=W instanceof Error?W.message:"Fehler beim Laden der Vorschau";v(V)}finally{b(!1)}})()},[n]);const A=async()=>{if(n){y(!0),v(null);try{const S=await Re.share(n);d(S)}catch(S){const W=S instanceof Error?S.message:"Fehler beim Teilen";v(W)}finally{y(!1)}}},z=async()=>{if(n){j(!0),v(null);try{const S=await Re.delete(n);if(S.success){const W=await Re.getPreview(n);g(W),I(!1),v(null),alert(`Gelöscht! ${S.anzahl_geloeschte_monate} Monatswerte wurden entfernt.`)}}catch(S){const W=S instanceof Error?S.message:"Fehler beim Löschen";v(W)}finally{j(!1)}}};if(p)return e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx($e,{className:"h-8 w-8 animate-spin text-blue-500"})});if(s.length===0)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-yellow-800",children:"Keine Anlagen vorhanden. Bitte zuerst eine Anlage anlegen."})})});if(u!=null&&u.success){const S=u.benchmark,W=S?(S.spez_ertrag_anlage-S.spez_ertrag_durchschnitt)/S.spez_ertrag_durchschnitt*100:0;return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx(tt,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"Vielen Dank für deinen Beitrag!"}),e.jsxs("p",{className:"text-green-700",children:[u.anzahl_monate," Monatswerte wurden mit der Community geteilt."]})]}),S&&e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-orange-50 px-4 py-3 border-b",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5 text-orange-500"}),"Dein Anlagenvergleich"]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Dein spezifischer Ertrag"}),e.jsxs("p",{className:"text-4xl font-bold text-orange-500",children:[S.spez_ertrag_anlage.toFixed(0),e.jsx("span",{className:"text-lg font-normal text-gray-500 ml-1",children:"kWh/kWp"})]}),e.jsxs("p",{className:`text-sm mt-1 ${W>=0?"text-green-600":"text-red-600"}`,children:[W>=0?"+":"",W.toFixed(1),"% vs. Durchschnitt"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Durchschnitt"}),e.jsxs("p",{className:"text-lg font-semibold",children:[S.spez_ertrag_durchschnitt.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Region"}),e.jsxs("p",{className:"text-lg font-semibold",children:[S.spez_ertrag_region.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(cr,{className:"h-4 w-4 text-yellow-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Rang gesamt"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["#",S.rang_gesamt," ",e.jsxs("span",{className:"text-sm text-gray-400",children:["/ ",S.anzahl_anlagen_gesamt]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(gt,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Rang Region"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["#",S.rang_region," ",e.jsxs("span",{className:"text-sm text-gray-400",children:["/ ",S.anzahl_anlagen_region]})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[e.jsxs("a",{href:u!=null&&u.anlage_hash?`${(c==null?void 0:c.community_url)||"https://energy.raunet.eu"}?anlage=${u.anlage_hash}`:(c==null?void 0:c.community_url)||"https://energy.raunet.eu",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-5 py-2.5 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium",children:[e.jsx(Kt,{className:"h-4 w-4"}),"Dein persönliches Benchmark öffnen"]}),e.jsxs("button",{onClick:()=>{d(null),g(null),n&&Re.getPreview(n).then(g)},className:"inline-flex items-center gap-2 px-5 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:[e.jsx(Wt,{className:"h-4 w-4"}),"Erneut teilen"]}),e.jsx("button",{onClick:()=>r("/"),className:"px-5 py-2.5 text-gray-500 hover:text-gray-700",children:"Zum Dashboard"})]})]})}return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Wn,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Mit Community teilen"}),e.jsx("p",{className:"text-gray-500",children:"Teile deine anonymisierten Anlagendaten mit der PV-Community"})]})]}),s.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anlage auswählen"}),e.jsxs("select",{value:n||"",onChange:S=>a(Number(S.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"-- Anlage wählen --"}),s.map(S=>e.jsx("option",{value:S.id,children:S.anlagenname},S.id))]})]}),e.jsx("div",{className:`p-4 rounded-lg border ${i!=null&&i.online?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[i!=null&&i.online?e.jsx(tt,{className:"h-5 w-5 text-green-500"}):e.jsx(Ge,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:i!=null&&i.online?"text-green-800":"text-red-800",children:["Community-Server: ",i!=null&&i.online?"Online":"Offline"]}),(i==null?void 0:i.version)&&e.jsxs("p",{className:"text-sm text-green-600",children:["Version ",i.version]}),(i==null?void 0:i.error)&&e.jsx("p",{className:"text-sm text-red-600",children:i.error})]})]})}),w&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:w})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Wa,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Datenschutz"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Keine persönlichen Daten (Name, Adresse) werden übertragen"}),e.jsx("li",{children:"• PLZ wird auf Bundesland reduziert"}),e.jsx("li",{children:"• Nur aggregierte Monatswerte"}),e.jsx("li",{children:"• Daten sind anonym und können nicht zu dir zurückverfolgt werden"})]})]})]})}),!(c!=null&&c.bereits_geteilt)&&(c==null?void 0:c.anzahl_monate)&&c.anzahl_monate>0&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:S=>P(S.target.checked),className:"mt-1 h-4 w-4 text-orange-500 border-gray-300 rounded focus:ring-orange-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Ich stimme der anonymen Übertragung meiner PV-Anlagendaten an die EEDC Community zu. Die Daten werden gemäß der"," ",e.jsx("a",{href:"https://energy.raunet.eu/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline",children:"Datenschutzerklärung"})," ","verarbeitet. Ich kann meine Daten jederzeit löschen."]})]})}),o&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx($e,{className:"h-6 w-6 animate-spin text-orange-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Lade Vorschau..."})]}),c&&!o&&e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>f(!N),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yn,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Datenvorschau"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:N?"Ausblenden":"Anzeigen"})]}),N&&e.jsxs("div",{className:"border-t p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gt,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Region"}),e.jsx("p",{className:"font-medium",children:Pl[c.vorschau.region]||c.vorschau.region})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Leistung"}),e.jsxs("p",{className:"font-medium",children:[c.vorschau.kwp," kWp"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ausrichtung"}),e.jsx("p",{className:"font-medium capitalize",children:c.vorschau.ausrichtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Neigung"}),e.jsxs("p",{className:"font-medium",children:[c.vorschau.neigung_grad,"°"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.vorschau.speicher_kwh&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded text-sm",children:[e.jsx(ze,{className:"h-4 w-4"}),"Speicher (",c.vorschau.speicher_kwh," kWh)"]}),c.vorschau.hat_waermepumpe&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Wärmepumpe"]}),c.vorschau.hat_eauto&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm",children:[e.jsx(Ae,{className:"h-4 w-4"}),"E-Auto"]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:c.anzahl_monate})," Monatswerte werden geteilt",c.vorschau.monatswerte.length>0&&e.jsxs("span",{className:"text-gray-400",children:[" ","(von ",c.vorschau.monatswerte[0].monat,"/",c.vorschau.monatswerte[0].jahr," ","bis ",c.vorschau.monatswerte[c.vorschau.monatswerte.length-1].monat,"/",c.vorschau.monatswerte[c.vorschau.monatswerte.length-1].jahr,")"]})]})})]})]}),(c==null?void 0:c.bereits_geteilt)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(tt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Bereits mit Community geteilt"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Deine Daten sind bereits im Community-Dashboard sichtbar. Du kannst sie aktualisieren oder löschen."})]})]}),e.jsx("button",{onClick:()=>I(!0),className:"text-red-600 hover:text-red-800 p-1",title:"Daten löschen",children:e.jsx(ht,{className:"h-5 w-5"})})]})}),_&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2",children:"Daten wirklich löschen?"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"Alle deine geteilten Daten werden vom Community-Server entfernt. Dies kann nicht rückgängig gemacht werden."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:z,disabled:k,className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:k?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 animate-spin"}),"Wird gelöscht..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"h-4 w-4"}),"Ja, löschen"]})}),e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Abbrechen"})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:A,disabled:!(i!=null&&i.online)||h||!(c!=null&&c.anzahl_monate)||!n||!(c!=null&&c.bereits_geteilt)&&!C,className:`
            inline-flex items-center gap-2 px-6 py-3 rounded-lg text-lg font-medium
            ${i!=null&&i.online&&(c!=null&&c.anzahl_monate)&&n&&(c!=null&&c.bereits_geteilt||C)?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}
          `,children:h?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-5 w-5 animate-spin"}),"Wird geteilt..."]}):c!=null&&c.bereits_geteilt?e.jsxs(e.Fragment,{children:[e.jsx(Wt,{className:"h-5 w-5"}),"Daten aktualisieren"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ea,{className:"h-5 w-5"}),"Jetzt anonym teilen"]})})}),!(c!=null&&c.anzahl_monate)&&n&&!o&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Keine Monatsdaten vorhanden. Bitte zuerst Daten erfassen."}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("a",{href:(c==null?void 0:c.community_url)||"https://energy.raunet.eu",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(Kt,{className:"h-4 w-4"}),"Community-Dashboard ansehen"]})})]})}const Vl={BW:"Baden-Württemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thüringen",AT:"Österreich",CH:"Schweiz"},Zt={solarprofi:{name:"Solarprofi",beschreibung:"Top 10% beim spezifischen Ertrag",icon:e.jsx(ae,{className:"h-5 w-5"}),farbe:"yellow"},autarkiemeister:{name:"Autarkiemeister",beschreibung:"Autarkiegrad über 80%",icon:e.jsx(Wa,{className:"h-5 w-5"}),farbe:"green"},effizienzwunder:{name:"Effizienzwunder",beschreibung:"Speicher-Wirkungsgrad über 90%",icon:e.jsx(ze,{className:"h-5 w-5"}),farbe:"emerald"},waermekoenig:{name:"Wärmekönig",beschreibung:"Wärmepumpe JAZ über 4.0",icon:e.jsx(Ze,{className:"h-5 w-5"}),farbe:"blue"},gruenerfahrer:{name:"Grüner Fahrer",beschreibung:"E-Auto PV-Ladeanteil über 70%",icon:e.jsx(Ae,{className:"h-5 w-5"}),farbe:"purple"},regionalchampion:{name:"Regionalchampion",beschreibung:"Top 3 in deiner Region",icon:e.jsx(gt,{className:"h-5 w-5"}),farbe:"cyan"},dauerbrenner:{name:"Dauerbrenner",beschreibung:"12 Monate in Folge über Durchschnitt",icon:e.jsx(Ke,{className:"h-5 w-5"}),farbe:"orange"}};function Bl({anlageId:r,zeitraum:s}){const[t,n]=l.useState(null),[a,i]=l.useState(!1),[x,c]=l.useState(null);l.useEffect(()=>{(async()=>{i(!0),c(null);try{const b=await Re.getBenchmark(r,s);n(b)}catch(b){c(b instanceof Error?b.message:"Fehler beim Laden")}finally{i(!1)}})()},[r,s]);const g=l.useMemo(()=>{if(!t)return null;const{rang_gesamt:o,anzahl_anlagen_gesamt:b}=t.benchmark,h=o/b*100;return h<=10?{label:"Top 10%",color:"bg-yellow-500",textColor:"text-yellow-500"}:h<=25?{label:"Top 25%",color:"bg-gray-400",textColor:"text-gray-500"}:h<=50?{label:"Top 50%",color:"bg-amber-700",textColor:"text-amber-700"}:null},[t]),u=l.useMemo(()=>{var M,H,re,me;if(!t)return{erreichte:[],nichtErreichte:[]};const o=[],b=[],{rang_gesamt:h,anzahl_anlagen_gesamt:y,rang_region:k,anzahl_anlagen_region:j}=t.benchmark,w=h/y*100,v=w<=10,N={id:"solarprofi",...Zt.solarprofi,erreicht:v,fortschritt:v?100:Math.max(0,100-w)};v?o.push(N):b.push(N);const f=k<=3,_={id:"regionalchampion",...Zt.regionalchampion,erreicht:f,fortschritt:f?100:Math.max(0,(1-k/Math.min(10,j))*100)};f?o.push(_):b.push(_);const I=(M=t.anlage.monatswerte)==null?void 0:M[t.anlage.monatswerte.length-1];if((I==null?void 0:I.autarkie_prozent)!==void 0&&I.autarkie_prozent!==null){const q=I.autarkie_prozent>=80,$={id:"autarkiemeister",...Zt.autarkiemeister,erreicht:q,fortschritt:q?100:I.autarkie_prozent/80*100};q?o.push($):b.push($)}const C=(H=t.benchmark_erweitert)==null?void 0:H.speicher;if(C!=null&&C.wirkungsgrad){const q=C.wirkungsgrad.wert>=90,$={id:"effizienzwunder",...Zt.effizienzwunder,erreicht:q,fortschritt:q?100:C.wirkungsgrad.wert/90*100};q?o.push($):b.push($)}const P=(re=t.benchmark_erweitert)==null?void 0:re.waermepumpe;if(P!=null&&P.jaz){const q=P.jaz.wert>=4,$={id:"waermekoenig",...Zt.waermekoenig,erreicht:q,fortschritt:q?100:P.jaz.wert/4*100};q?o.push($):b.push($)}const A=(me=t.benchmark_erweitert)==null?void 0:me.eauto;if(A!=null&&A.pv_anteil){const q=A.pv_anteil.wert>=70,$={id:"gruenerfahrer",...Zt.gruenerfahrer,erreicht:q,fortschritt:q?100:A.pv_anteil.wert/70*100};q?o.push($):b.push($)}const S=(t.anlage.monatswerte||[]).slice(-12),W=t.benchmark.spez_ertrag_durchschnitt/12;let V=0;for(const q of S)(q.spez_ertrag_kwh_kwp||0)>W&&V++;const oe=V===12&&S.length===12,R={id:"dauerbrenner",...Zt.dauerbrenner,erreicht:oe,fortschritt:S.length>0?V/Math.max(12,S.length)*100:0};return oe?o.push(R):S.length>=6&&b.push(R),{erreichte:o,nichtErreichte:b}},[t]),{staerken:d,schwaechen:p}=l.useMemo(()=>{var j,w,v,N,f,_,I,C,P,A,z,S;if(!t)return{staerken:[],schwaechen:[]};const o=[],b=(t.benchmark.spez_ertrag_anlage-t.benchmark.spez_ertrag_durchschnitt)/t.benchmark.spez_ertrag_durchschnitt*100;if(o.push({label:"PV-Ertrag",abweichungProzent:b,icon:e.jsx(ae,{className:"h-4 w-4"}),kategorie:"pv"}),(j=t.benchmark_erweitert)!=null&&j.speicher){const W=t.benchmark_erweitert.speicher;if((w=W.wirkungsgrad)!=null&&w.community_avg){const V=(W.wirkungsgrad.wert-W.wirkungsgrad.community_avg)/W.wirkungsgrad.community_avg*100;o.push({label:"Speicher-Effizienz",abweichungProzent:V,icon:e.jsx(ze,{className:"h-4 w-4"}),kategorie:"speicher"})}if((v=W.netz_anteil)!=null&&v.community_avg){const V=(W.netz_anteil.community_avg-W.netz_anteil.wert)/W.netz_anteil.community_avg*100;o.push({label:"PV-Ladeanteil Speicher",abweichungProzent:V,icon:e.jsx(ye,{className:"h-4 w-4"}),kategorie:"speicher"})}}if((_=(f=(N=t.benchmark_erweitert)==null?void 0:N.waermepumpe)==null?void 0:f.jaz)!=null&&_.community_avg){const W=t.benchmark_erweitert.waermepumpe,V=(W.jaz.wert-W.jaz.community_avg)/W.jaz.community_avg*100;o.push({label:"Wärmepumpe JAZ",abweichungProzent:V,icon:e.jsx(Ze,{className:"h-4 w-4"}),kategorie:"waermepumpe"})}if((P=(C=(I=t.benchmark_erweitert)==null?void 0:I.eauto)==null?void 0:C.pv_anteil)!=null&&P.community_avg){const W=t.benchmark_erweitert.eauto,V=(W.pv_anteil.wert-W.pv_anteil.community_avg)/W.pv_anteil.community_avg*100;o.push({label:"E-Auto PV-Anteil",abweichungProzent:V,icon:e.jsx(Ae,{className:"h-4 w-4"}),kategorie:"eauto"})}if((S=(z=(A=t.benchmark_erweitert)==null?void 0:A.wallbox)==null?void 0:z.pv_anteil)!=null&&S.community_avg){const W=t.benchmark_erweitert.wallbox,V=(W.pv_anteil.wert-W.pv_anteil.community_avg)/W.pv_anteil.community_avg*100;o.push({label:"Wallbox PV-Anteil",abweichungProzent:V,icon:e.jsx(pt,{className:"h-4 w-4"}),kategorie:"wallbox"})}const h=[...o].sort((W,V)=>V.abweichungProzent-W.abweichungProzent),y=h.filter(W=>W.abweichungProzent>0).slice(0,3),k=h.filter(W=>W.abweichungProzent<0).slice(-3).reverse();return{staerken:y,schwaechen:k}},[t]),m=l.useMemo(()=>{var y,k,j,w,v,N,f,_,I,C;if(!t)return[];const o=[],b=Math.max(t.benchmark.spez_ertrag_anlage,t.benchmark.spez_ertrag_durchschnitt)*1.2;o.push({kategorie:"PV-Ertrag",du:t.benchmark.spez_ertrag_anlage/b*100,community:t.benchmark.spez_ertrag_durchschnitt/b*100,fullMark:100});const h=(y=t.anlage.monatswerte)==null?void 0:y[t.anlage.monatswerte.length-1];if(h!=null&&h.autarkie_prozent&&o.push({kategorie:"Autarkie",du:h.autarkie_prozent,community:65,fullMark:100}),h!=null&&h.eigenverbrauch_prozent&&o.push({kategorie:"Eigenverbrauch",du:h.eigenverbrauch_prozent,community:45,fullMark:100}),(w=(j=(k=t.benchmark_erweitert)==null?void 0:k.speicher)==null?void 0:j.wirkungsgrad)!=null&&w.community_avg){const P=t.benchmark_erweitert.speicher;o.push({kategorie:"Speicher",du:P.wirkungsgrad.wert,community:P.wirkungsgrad.community_avg,fullMark:100})}if((f=(N=(v=t.benchmark_erweitert)==null?void 0:v.waermepumpe)==null?void 0:N.jaz)!=null&&f.community_avg){const P=t.benchmark_erweitert.waermepumpe,A=Math.max(P.jaz.wert,P.jaz.community_avg)*1.2;o.push({kategorie:"WP-Effizienz",du:P.jaz.wert/A*100,community:P.jaz.community_avg/A*100,fullMark:100})}if((C=(I=(_=t.benchmark_erweitert)==null?void 0:_.eauto)==null?void 0:I.pv_anteil)!=null&&C.community_avg){const P=t.benchmark_erweitert.eauto;o.push({kategorie:"E-Auto PV",du:P.pv_anteil.wert,community:P.pv_anteil.community_avg,fullMark:100})}return o},[t]);return a?e.jsx(ve,{text:"Lade Community-Daten..."}):x?e.jsx(Q,{type:"error",children:x}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(cr,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Dein PV-Ertrag im Vergleich"}),g&&e.jsxs("span",{className:`ml-2 px-3 py-1 rounded-full text-white text-sm font-medium ${g.color}`,children:[e.jsx(or,{className:"h-4 w-4 inline mr-1"}),g.label]}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:t.zeitraum_label})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center md:col-span-1",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Dein spez. Ertrag"}),e.jsx("p",{className:"text-4xl font-bold text-primary-500",children:t.benchmark.spez_ertrag_anlage.toFixed(0)}),e.jsx("p",{className:"text-gray-500",children:"kWh/kWp"}),e.jsx(Ol,{wert:t.benchmark.spez_ertrag_anlage,durchschnitt:t.benchmark.spez_ertrag_durchschnitt})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Or,{label:"Community Durchschnitt",wert:t.benchmark.spez_ertrag_durchschnitt,einheit:"kWh/kWp",icon:e.jsx(ut,{className:"h-5 w-5 text-gray-400"})}),e.jsx(Or,{label:Vl[t.anlage.region]||t.anlage.region,wert:t.benchmark.spez_ertrag_region,einheit:"kWh/kWp",icon:e.jsx(gt,{className:"h-5 w-5 text-blue-400"})}),e.jsx(Or,{label:"Rang gesamt",wert:t.benchmark.rang_gesamt,zusatz:`von ${t.benchmark.anzahl_anlagen_gesamt}`,icon:e.jsx(cr,{className:"h-5 w-5 text-yellow-500"}),isRank:!0}),e.jsx(Or,{label:"Rang Region",wert:t.benchmark.rang_region,zusatz:`von ${t.benchmark.anzahl_anlagen_region}`,icon:e.jsx(cr,{className:"h-5 w-5 text-blue-500"}),isRank:!0})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(d.length>0||p.length>0)&&e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Deine Performance"}),d.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(An,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Stärken"})]}),e.jsx("div",{className:"space-y-2",children:d.map((o,b)=>e.jsxs("div",{className:"flex items-center justify-between bg-green-50 dark:bg-green-900/20 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o.icon,e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:o.label})]}),e.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["+",o.abweichungProzent.toFixed(1),"%"]})]},b))})]}),p.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Fn,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Verbesserungspotenzial"})]}),e.jsx("div",{className:"space-y-2",children:p.map((o,b)=>e.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o.icon,e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:o.label})]}),e.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:[o.abweichungProzent.toFixed(1),"%"]})]},b))})]})]}),m.length>=3&&e.jsxs(E,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Profil"}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ua,{data:m,children:[e.jsx(Ya,{stroke:"#e5e7eb"}),e.jsx(Qa,{dataKey:"kategorie",tick:{fill:"#6b7280",fontSize:11}}),e.jsx(Xa,{angle:90,domain:[0,100],tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(Cs,{name:"Du",dataKey:"du",stroke:"var(--color-primary-500, #3b82f6)",fill:"var(--color-primary-500, #3b82f6)",fillOpacity:.3}),e.jsx(Cs,{name:"Community",dataKey:"community",stroke:"#9ca3af",fill:"#9ca3af",fillOpacity:.1}),e.jsx(Ee,{})]})})})]})]}),(u.erreichte.length>0||u.nichtErreichte.length>0)&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(lr,{className:"h-5 w-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Achievements"}),u.erreichte.length>0&&e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:[u.erreichte.length," von ",u.erreichte.length+u.nichtErreichte.length," erreicht"]})]}),u.erreichte.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Erreicht"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:u.erreichte.map(o=>e.jsx(ia,{achievement:o},o.id))})]}),u.nichtErreichte.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"In Reichweite"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:u.nichtErreichte.slice(0,4).map(o=>e.jsx(ia,{achievement:o},o.id))})]})]}),t.benchmark_erweitert&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.benchmark_erweitert.speicher&&t.anlage.speicher_kwh&&e.jsxs(kr,{title:"Speicher",icon:e.jsx(ze,{className:"h-6 w-6 text-green-500"}),kapazitaet:`${t.anlage.speicher_kwh} kWh`,children:[e.jsx(Xe,{label:"Zyklen/Jahr",kpi:t.benchmark_erweitert.speicher.zyklen_jahr,einheit:""}),e.jsx(Xe,{label:"Wirkungsgrad",kpi:t.benchmark_erweitert.speicher.wirkungsgrad,einheit:"%"}),e.jsx(Xe,{label:"Netzladung",kpi:t.benchmark_erweitert.speicher.netz_anteil,einheit:"%",invertColors:!0})]}),t.benchmark_erweitert.waermepumpe&&t.anlage.hat_waermepumpe&&e.jsxs(kr,{title:"Wärmepumpe",icon:e.jsx(Ze,{className:"h-6 w-6 text-blue-500"}),children:[e.jsx(Xe,{label:"JAZ (Jahresarbeitszahl)",kpi:t.benchmark_erweitert.waermepumpe.jaz,einheit:""}),e.jsx(Xe,{label:"Stromverbrauch",kpi:t.benchmark_erweitert.waermepumpe.stromverbrauch,einheit:"kWh",hideComparison:!0}),e.jsx(Xe,{label:"Wärmeerzeugung",kpi:t.benchmark_erweitert.waermepumpe.waermeerzeugung,einheit:"kWh",hideComparison:!0})]}),t.benchmark_erweitert.eauto&&t.anlage.hat_eauto&&e.jsxs(kr,{title:"E-Auto",icon:e.jsx(Ae,{className:"h-6 w-6 text-purple-500"}),children:[e.jsx(Xe,{label:"PV-Anteil",kpi:t.benchmark_erweitert.eauto.pv_anteil,einheit:"%"}),e.jsx(Xe,{label:"Ladung gesamt",kpi:t.benchmark_erweitert.eauto.ladung_gesamt,einheit:"kWh",hideComparison:!0}),e.jsx(Xe,{label:"Verbrauch",kpi:t.benchmark_erweitert.eauto.verbrauch_100km,einheit:"kWh/100km",invertColors:!0}),t.benchmark_erweitert.eauto.v2h&&e.jsx(Xe,{label:"V2H Entladung",kpi:t.benchmark_erweitert.eauto.v2h,einheit:"kWh",hideComparison:!0})]}),t.benchmark_erweitert.wallbox&&t.anlage.hat_wallbox&&e.jsxs(kr,{title:"Wallbox",icon:e.jsx(pt,{className:"h-6 w-6 text-cyan-500"}),kapazitaet:t.anlage.wallbox_kw?`${t.anlage.wallbox_kw} kW`:void 0,children:[e.jsx(Xe,{label:"PV-Anteil Ladung",kpi:t.benchmark_erweitert.wallbox.pv_anteil,einheit:"%"}),e.jsx(Xe,{label:"Ladung gesamt",kpi:t.benchmark_erweitert.wallbox.ladung,einheit:"kWh",hideComparison:!0}),e.jsx(Xe,{label:"Ladevorgänge",kpi:t.benchmark_erweitert.wallbox.ladevorgaenge,einheit:"",hideComparison:!0})]}),t.benchmark_erweitert.balkonkraftwerk&&t.anlage.hat_balkonkraftwerk&&e.jsxs(kr,{title:"Balkonkraftwerk",icon:e.jsx(ae,{className:"h-6 w-6 text-amber-500"}),kapazitaet:t.anlage.bkw_wp?`${t.anlage.bkw_wp} Wp`:void 0,children:[e.jsx(Xe,{label:"Spez. Ertrag",kpi:t.benchmark_erweitert.balkonkraftwerk.spez_ertrag,einheit:"kWh/kWp"}),e.jsx(Xe,{label:"Erzeugung",kpi:t.benchmark_erweitert.balkonkraftwerk.erzeugung,einheit:"kWh",hideComparison:!0}),e.jsx(Xe,{label:"Eigenverbrauchsquote",kpi:t.benchmark_erweitert.balkonkraftwerk.eigenverbrauch,einheit:"%",hideComparison:!0})]})]})]}):null}function Ol({wert:r,durchschnitt:s}){const t=(r-s)/s*100,n=t>=0;return e.jsxs("span",{className:`inline-flex items-center gap-1 mt-2 px-2 py-1 rounded text-sm font-medium ${n?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[n?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(jt,{className:"h-4 w-4"}),n?"+":"",t.toFixed(1),"% vs. Durchschnitt"]})}const Kl={"Rang gesamt":"Deine Position im Vergleich zu allen teilnehmenden Anlagen","Rang Region":"Deine Position im Vergleich zu Anlagen in deiner Region","Spez. Ertrag":"Dein normierter Ertrag (kWh/kWp) im Vergleichszeitraum"};function Or({label:r,wert:s,einheit:t,zusatz:n,icon:a,isRank:i,tooltip:x}){const c=x||Kl[r];return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a,e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[r,c&&e.jsx(Yr,{text:c,children:e.jsx(ks,{className:"h-3 w-3 text-gray-400 opacity-60"})})]})]}),e.jsxs("p",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[i?"#":"",s.toFixed(0),t&&e.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:t}),n&&e.jsx("span",{className:"text-sm font-normal text-gray-400 ml-2",children:n})]})]})}function kr({title:r,icon:s,kapazitaet:t,children:n}){return e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s,e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r})]}),t&&e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]}),e.jsx("div",{className:"space-y-3",children:n})]})}const Tl={"Spez. Ertrag":"Ertrag normiert auf installierte Leistung (kWh pro kWp)",Autarkie:"Anteil des Eigenverbrauchs am Gesamtverbrauch",Eigenverbrauch:"Anteil der selbst genutzten PV-Erzeugung",Eigenverbrauchsquote:"Anteil der selbst genutzten PV-Erzeugung","Zyklen/Jahr":"Vollständige Lade-/Entladezyklen pro Jahr",Wirkungsgrad:"Verhältnis von Entladung zu Ladung (Effizienz)","Netzlade-Anteil":"Anteil der Speicherladung aus dem Netz statt PV",JAZ:"Jahresarbeitszahl: Wärmeenergie geteilt durch Stromverbrauch",Stromverbrauch:"Gesamter Stromverbrauch der Wärmepumpe",Wärmeerzeugung:"Erzeugte Wärme für Heizung und Warmwasser","PV-Anteil":"Anteil der Ladung aus PV-Überschuss",Ladung:"Gesamte Lademenge im Zeitraum",Verbrauch:"Durchschnittlicher Energieverbrauch",Erzeugung:"Gesamte PV-Erzeugung im Zeitraum"};function Xe({label:r,kpi:s,einheit:t,hideComparison:n,invertColors:a,tooltip:i}){if(!s)return null;const x=!n&&s.community_avg!==void 0&&s.community_avg!==null,c=x?(s.wert-s.community_avg)/s.community_avg*100:null,g=c!==null?a?c<0:c>0:null,u=i||Tl[r];return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[r,u&&e.jsx(Yr,{text:u,children:e.jsx(ks,{className:"h-3.5 w-3.5 text-gray-400 opacity-60"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[s.wert.toFixed(t==="%"||t===""?1:0)," ",t]}),x&&c!==null&&e.jsxs("span",{className:`text-sm ${g?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:["(",c>=0?"+":"",c.toFixed(1),"%)"]})]})]})}function ia({achievement:r}){const s={yellow:{bg:r.erreicht?"bg-yellow-100 dark:bg-yellow-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-yellow-300 dark:border-yellow-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-yellow-500":"text-gray-400",text:r.erreicht?"text-yellow-700 dark:text-yellow-300":"text-gray-500"},green:{bg:r.erreicht?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-green-300 dark:border-green-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-green-500":"text-gray-400",text:r.erreicht?"text-green-700 dark:text-green-300":"text-gray-500"},emerald:{bg:r.erreicht?"bg-emerald-100 dark:bg-emerald-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-emerald-300 dark:border-emerald-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-emerald-500":"text-gray-400",text:r.erreicht?"text-emerald-700 dark:text-emerald-300":"text-gray-500"},blue:{bg:r.erreicht?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-blue-300 dark:border-blue-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-blue-500":"text-gray-400",text:r.erreicht?"text-blue-700 dark:text-blue-300":"text-gray-500"},purple:{bg:r.erreicht?"bg-purple-100 dark:bg-purple-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-purple-300 dark:border-purple-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-purple-500":"text-gray-400",text:r.erreicht?"text-purple-700 dark:text-purple-300":"text-gray-500"},cyan:{bg:r.erreicht?"bg-cyan-100 dark:bg-cyan-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-cyan-300 dark:border-cyan-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-cyan-500":"text-gray-400",text:r.erreicht?"text-cyan-700 dark:text-cyan-300":"text-gray-500"},orange:{bg:r.erreicht?"bg-orange-100 dark:bg-orange-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-orange-300 dark:border-orange-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-orange-500":"text-gray-400",text:r.erreicht?"text-orange-700 dark:text-orange-300":"text-gray-500"},indigo:{bg:r.erreicht?"bg-indigo-100 dark:bg-indigo-900/30":"bg-gray-100 dark:bg-gray-800",border:r.erreicht?"border-indigo-300 dark:border-indigo-700":"border-gray-200 dark:border-gray-700",icon:r.erreicht?"text-indigo-500":"text-gray-400",text:r.erreicht?"text-indigo-700 dark:text-indigo-300":"text-gray-500"}},t=s[r.farbe]||s.yellow;return e.jsxs("div",{className:`relative rounded-xl p-3 border ${t.bg} ${t.border} ${r.erreicht?"":"opacity-70"}`,title:r.beschreibung,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:t.icon,children:r.icon}),e.jsx("span",{className:`text-sm font-medium ${t.text}`,children:r.name})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:r.beschreibung}),!r.erreicht&&r.fortschritt!==void 0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full ${r.farbe==="yellow"?"bg-yellow-400":r.farbe==="green"?"bg-green-400":r.farbe==="blue"?"bg-blue-400":r.farbe==="purple"?"bg-purple-400":r.farbe==="cyan"?"bg-cyan-400":r.farbe==="orange"?"bg-orange-400":"bg-gray-400"}`,style:{width:`${Math.min(100,Math.max(0,r.fortschritt))}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[r.fortschritt.toFixed(0),"%"]})]}),r.erreicht&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(fn,{className:`h-4 w-4 ${t.icon}`})})]})}function Rl({anlageId:r,zeitraum:s}){const[t,n]=l.useState(null),[a,i]=l.useState(null),[x,c]=l.useState(null),[g,u]=l.useState(!1),[d,p]=l.useState(null);l.useEffect(()=>{(async()=>{u(!0),p(null);try{const[k,j,w]=await Promise.all([Re.getBenchmark(r,s),Re.getDistribution("spez_ertrag",15).catch(()=>null),Re.getMonthlyAverages(24).catch(()=>null)]);n(k),i(j),c(w)}catch(k){p(k instanceof Error?k.message:"Fehler beim Laden")}finally{u(!1)}})()},[r,s]);const m=l.useMemo(()=>{if(!(t!=null&&t.anlage.monatswerte))return[];const y=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],k=new Map;return x!=null&&x.monate&&x.monate.forEach(w=>{k.set(`${w.jahr}-${w.monat}`,w.spez_ertrag_avg)}),[...t.anlage.monatswerte].sort((w,v)=>w.jahr-v.jahr||w.monat-v.monat).slice(-12).map(w=>{const v=w.spez_ertrag_kwh_kwp||0;let N=k.get(`${w.jahr}-${w.monat}`);N===void 0&&(N=k.get(`${w.jahr-1}-${w.monat}`)),N===void 0&&(N=t.benchmark.spez_ertrag_durchschnitt/12);const f=N>0?(v-N)/N*100:0;return{name:`${y[w.monat-1]} ${w.jahr%100}`,monat:w.monat,jahr:w.jahr,ertrag:v,durchschnitt:N,abweichung:f,isPositive:f>=0}})},[t,x]),o=l.useMemo(()=>{if(!(t!=null&&t.anlage.monatswerte))return null;const y=t.anlage.monatswerte;return[...new Set(y.map(j=>j.jahr))].sort().map(j=>{const w=y.filter(f=>f.jahr===j),v=w.reduce((f,_)=>f+(_.spez_ertrag_kwh_kwp||0),0),N=w.length;return{jahr:j,spezErtrag:v,anzahlMonate:N,vollstaendig:N===12}})},[t]),b=l.useMemo(()=>{if(!t)return null;const{rang_gesamt:y,anzahl_anlagen_gesamt:k}=t.benchmark;return Math.round((1-y/k)*100)},[t]),h=l.useMemo(()=>{if(!t)return null;const{spez_ertrag_anlage:y,spez_ertrag_durchschnitt:k,spez_ertrag_region:j}=t.benchmark;return{abweichungGesamt:(y-k)/k*100,abweichungRegion:(y-j)/j*100,differenzAbsolut:y-k}},[t]);return g?e.jsx(ve,{text:"Lade PV-Ertragsdaten..."}):d?e.jsx(Q,{type:"error",children:d}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary-100 dark:bg-primary-900/30",children:e.jsx(or,{className:"h-5 w-5 text-primary-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Deine Position"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["Top ",100-(b||0),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Besser als ",b,"% der Community"]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${((h==null?void 0:h.abweichungGesamt)||0)>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:((h==null?void 0:h.abweichungGesamt)||0)>=0?e.jsx(_e,{className:"h-5 w-5 text-green-500"}):e.jsx(jt,{className:"h-5 w-5 text-red-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Community"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${((h==null?void 0:h.abweichungGesamt)||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[((h==null?void 0:h.abweichungGesamt)||0)>=0?"+":"",h==null?void 0:h.abweichungGesamt.toFixed(1),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[h==null?void 0:h.differenzAbsolut.toFixed(0)," kWh/kWp Differenz"]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${((h==null?void 0:h.abweichungRegion)||0)>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:e.jsx(bs,{className:"h-5 w-5 text-blue-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Region"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${((h==null?void 0:h.abweichungRegion)||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[((h==null?void 0:h.abweichungRegion)||0)>=0?"+":"",h==null?void 0:h.abweichungRegion.toFixed(1),"%"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Vergleich mit deinem Bundesland"})]})]}),m.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatlicher Ertrag vs. Community"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:t.zeitraum_label})]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:m,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(ge,{tick:{fill:"#6b7280",fontSize:12},label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(ce,{formatter:(y,k)=>k==="ertrag"?[`${y.toFixed(1)} kWh/kWp`,"Dein Ertrag"]:k==="durchschnitt"?[`${y.toFixed(1)} kWh/kWp`,"Ø Community"]:[y,k],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Be,{type:"monotone",dataKey:"durchschnitt",stroke:"#9ca3af",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"durchschnitt"}),e.jsx(se,{dataKey:"ertrag",radius:[4,4,0,0],name:"ertrag",children:m.map((y,k)=>e.jsx(Ie,{fill:y.isPositive?"#22c55e":"#ef4444",fillOpacity:.8},`cell-${k}`))})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Über Monats-Ø"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-red-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unter Monats-Ø"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-0 border-t-2 border-dashed border-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Community Monats-Ø"})]})]})]}),o&&o.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(it,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Jahresübersicht"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Jahr"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"vs. Community"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Monate"})]})}),e.jsx("tbody",{children:o.map(y=>{const k=(y.spezErtrag-t.benchmark.spez_ertrag_durchschnitt)/t.benchmark.spez_ertrag_durchschnitt*100,j=k>=0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:y.jahr}),!y.vollstaendig&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(unvollständig)"})]}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[y.spezErtrag.toFixed(0)," kWh/kWp"]})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:`font-medium ${j?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[j?"+":"",k.toFixed(1),"%"]})}),e.jsxs("td",{className:"text-right py-3 px-4 text-gray-500 dark:text-gray-400",children:[y.anzahlMonate,"/12"]})]},y.jahr)})})]})})]}),a&&a.bins.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(bs,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Verteilung in der Community"})]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(nt,{data:a.bins.map(y=>({range:`${y.von.toFixed(0)}-${y.bis.toFixed(0)}`,anzahl:y.anzahl,isOwn:t.benchmark.spez_ertrag_anlage>=y.von&&t.benchmark.spez_ertrag_anlage<y.bis})),children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"range",tick:{fill:"#6b7280",fontSize:10},angle:-45,textAnchor:"end",height:60}),e.jsx(ge,{tick:{fill:"#6b7280",fontSize:12}}),e.jsx(ce,{formatter:y=>[`${y} Anlagen`,"Anzahl"],labelFormatter:y=>`${y} kWh/kWp`,contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(se,{dataKey:"anzahl",radius:[4,4,0,0],children:a.bins.map((y,k)=>{const j=t.benchmark.spez_ertrag_anlage>=y.von&&t.benchmark.spez_ertrag_anlage<y.bis;return e.jsx(Ie,{fill:j?"#8b5cf6":"#d1d5db",fillOpacity:j?1:.7},`cell-${k}`)})})]})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Minimum"}),e.jsxs("p",{className:"font-semibold",children:[a.statistik.min.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Durchschnitt"}),e.jsxs("p",{className:"font-semibold",children:[a.statistik.durchschnitt.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Median"}),e.jsxs("p",{className:"font-semibold",children:[a.statistik.median.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Maximum"}),e.jsxs("p",{className:"font-semibold",children:[a.statistik.max.toFixed(0)," kWh/kWp"]})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-purple-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Deine Position"})]})})]}),e.jsx(E,{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"h-5 w-5 text-primary-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Über den Vergleich"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Der Community-Durchschnitt basiert auf ",t.benchmark.anzahl_anlagen_gesamt," Anlagen. Dein spezifischer Ertrag von ",e.jsxs("strong",{children:[t.benchmark.spez_ertrag_anlage.toFixed(0)," kWh/kWp"]})," liegt"," ",((h==null?void 0:h.abweichungGesamt)||0)>=0?"über":"unter"," dem Durchschnitt von"," ",e.jsxs("strong",{children:[t.benchmark.spez_ertrag_durchschnitt.toFixed(0)," kWh/kWp"]}),". Faktoren wie Ausrichtung (",t.anlage.ausrichtung,"), Neigung (",t.anlage.neigung_grad,"°) und regionale Sonneneinstrahlung beeinflussen die Ergebnisse."]})]})]})})]}):null}function Hl({anlageId:r,zeitraum:s}){const[t,n]=l.useState(null),[a,i]=l.useState(!1),[x,c]=l.useState(null),[g,u]=l.useState(null),[d,p]=l.useState(null),[m,o]=l.useState(null);l.useEffect(()=>{(async()=>{i(!0),c(null);try{const y=await Re.getBenchmark(r,s);n(y)}catch(y){c(y instanceof Error?y.message:"Fehler beim Laden")}finally{i(!1)}})()},[r,s]),l.useEffect(()=>{(async()=>{try{const[y,k,j]=await Promise.all([Re.getSpeicherByClass().catch(()=>null),Re.getWaermepumpeByRegion().catch(()=>null),Re.getEAutoByUsage().catch(()=>null)]);u(y),p(k),o(j)}catch{}})()},[]);const b=l.useMemo(()=>{var y,k,j,w,v;if(!t)return[];const h=[];return t.anlage.speicher_kwh&&((y=t.benchmark_erweitert)!=null&&y.speicher)&&h.push("speicher"),t.anlage.hat_waermepumpe&&((k=t.benchmark_erweitert)!=null&&k.waermepumpe)&&h.push("waermepumpe"),t.anlage.hat_eauto&&((j=t.benchmark_erweitert)!=null&&j.eauto)&&h.push("eauto"),t.anlage.hat_wallbox&&((w=t.benchmark_erweitert)!=null&&w.wallbox)&&h.push("wallbox"),t.anlage.hat_balkonkraftwerk&&((v=t.benchmark_erweitert)!=null&&v.balkonkraftwerk)&&h.push("bkw"),h},[t]);return a?e.jsx(ve,{text:"Lade Komponenten-Daten..."}):x?s==="letzter_monat"?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ze,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Daten für letzten Monat"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Für den letzten Monat liegen noch keine Komponenten-Daten vor. Wähle einen längeren Zeitraum für den Vergleich."})]})}):e.jsx(Q,{type:"error",children:x}):t?b.length===0?e.jsx(E,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 mb-4",children:e.jsx(ze,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Keine Komponenten-Daten"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:"Für Komponenten-Vergleiche benötigst du mindestens eine Zusatzkomponente (Speicher, Wärmepumpe, E-Auto, Wallbox oder Balkonkraftwerk) mit erfassten Monatsdaten."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Betrachtungszeitraum: ",t.zeitraum_label]})}),b.includes("speicher")&&e.jsx(Gl,{benchmark:t,communityStats:g}),b.includes("waermepumpe")&&e.jsx(Jl,{benchmark:t,communityStats:d}),b.includes("eauto")&&e.jsx(Zl,{benchmark:t,communityStats:m}),b.includes("wallbox")&&e.jsx(ql,{benchmark:t}),b.includes("bkw")&&e.jsx(Ul,{benchmark:t})]}):null}const la=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];function Gl({benchmark:r,communityStats:s}){var u,d;const t=(u=r.benchmark_erweitert)==null?void 0:u.speicher;if(!t)return null;const n=r.anlage.speicher_kwh||0,a=l.useMemo(()=>n<=5?"≤5 kWh":n<=10?"5-10 kWh":n<=15?"10-15 kWh":n<=20?"15-20 kWh":">20 kWh",[n]),i=l.useMemo(()=>{var m,o;const p=[];return(m=t.wirkungsgrad)!=null&&m.community_avg&&p.push({name:"Wirkungsgrad",du:t.wirkungsgrad.wert,community:t.wirkungsgrad.community_avg}),(o=t.netz_anteil)!=null&&o.community_avg&&p.push({name:"Netz-Anteil",du:t.netz_anteil.wert,community:t.netz_anteil.community_avg}),p},[t]),x=l.useMemo(()=>s!=null&&s.klassen?s.klassen.filter(p=>p.anzahl>0).map((p,m)=>({name:p.bis_kwh?`${p.von_kwh}-${p.bis_kwh} kWh`:`>${p.von_kwh} kWh`,anzahl:p.anzahl,fill:la[m%la.length],avg_zyklen:p.durchschnitt_zyklen??0,avg_wirkungsgrad:p.durchschnitt_wirkungsgrad??0})):[],[s]),c=l.useMemo(()=>s!=null&&s.klassen?s.klassen.reduce((p,m)=>p+m.anzahl,0):0,[s]),g=l.useMemo(()=>{const p=[];return t.netz_anteil&&t.netz_anteil.wert>20&&p.push("Hoher Netzlade-Anteil: Prüfe, ob die PV-Überschussladung optimal konfiguriert ist."),t.wirkungsgrad&&t.wirkungsgrad.wert<85&&p.push("Der Wirkungsgrad liegt unter 85%. Bei älteren Speichern kann die Kapazität nachlassen."),t.zyklen_jahr&&t.zyklen_jahr.wert<200&&p.push("Wenige Zyklen: Der Speicher wird nicht voll genutzt. Überlege, mehr Eigenverbrauch zu priorisieren."),p.length===0&&p.push("Dein Speicher arbeitet im normalen Bereich."),p},[t]);return e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(ze,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Speicher"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n," kWh Kapazität"]})]})]}),((d=t.zyklen_jahr)==null?void 0:d.rang)&&t.zyklen_jahr.von&&e.jsx(Wr,{rang:t.zyklen_jahr.rang,von:t.zyklen_jahr.von})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qe,{label:"Zyklen/Jahr",icon:e.jsx(ja,{className:"h-5 w-5 text-green-500"}),kpi:t.zyklen_jahr,einheit:"",beschreibung:"Vollständige Lade-/Entladezyklen"}),e.jsx(Qe,{label:"Wirkungsgrad",icon:e.jsx(ir,{className:"h-5 w-5 text-blue-500"}),kpi:t.wirkungsgrad,einheit:"%",beschreibung:"Entladen / Geladen"}),e.jsx(Qe,{label:"Netzlade-Anteil",icon:e.jsx(ye,{className:"h-5 w-5 text-yellow-500"}),kpi:t.netz_anteil,einheit:"%",beschreibung:"Anteil Ladung aus Netz statt PV",invertColors:!0})]}),i.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Vergleich mit Community"}),e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:i,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(je,{type:"number",domain:[0,100],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(ge,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:90}),e.jsx(ce,{formatter:p=>[`${p.toFixed(1)}%`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(se,{dataKey:"du",name:"Du",fill:"#22c55e",radius:[0,4,4,0]}),e.jsx(se,{dataKey:"community",name:"Community",fill:"#9ca3af",radius:[0,4,4,0]})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Du"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Community Ø"})]})]})]})]}),x.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: Speicher nach Kapazitätsklasse"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",c," Anlagen)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:x,dataKey:"anzahl",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:p,percent:m})=>`${p} (${(m*100).toFixed(0)}%)`,labelLine:!1,children:x.map((p,m)=>e.jsx(Ie,{fill:p.fill,stroke:p.name===a?"#000":"none",strokeWidth:p.name===a?2:0},`cell-${m}`))}),e.jsx(ce,{formatter:(p,m)=>[`${p} Anlagen`,m]})]})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"text-left pb-2",children:"Klasse"}),e.jsx("th",{className:"text-right pb-2",children:"Ø Zyklen/Jahr"}),e.jsx("th",{className:"text-right pb-2",children:"Ø Wirkungsgrad"})]})}),e.jsx("tbody",{children:x.map(p=>e.jsxs("tr",{className:p.name===a?"bg-primary-50 dark:bg-primary-900/20 font-medium":"",children:[e.jsxs("td",{className:"py-1 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:p.fill}}),p.name,p.name===a&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]}),e.jsx("td",{className:"text-right py-1",children:p.avg_zyklen.toFixed(0)}),e.jsxs("td",{className:"text-right py-1",children:[p.avg_wirkungsgrad.toFixed(1),"%"]})]},p.name))})]})})]})]}),e.jsx(Mr,{tipps:g})]})}function Jl({benchmark:r,communityStats:s}){var c,g;const t=(c=r.benchmark_erweitert)==null?void 0:c.waermepumpe;if(!t)return null;const n=r.anlage.region,a=l.useMemo(()=>s!=null&&s.regionen?s.regionen.filter(u=>u.anzahl>0&&u.durchschnitt_jaz!=null).sort((u,d)=>(d.durchschnitt_jaz??0)-(u.durchschnitt_jaz??0)).slice(0,10).map(u=>({name:u.region.replace("_"," "),region:u.region,jaz:u.durchschnitt_jaz??0,anzahl:u.anzahl})):[],[s]),i=l.useMemo(()=>s!=null&&s.regionen?s.regionen.reduce((u,d)=>u+d.anzahl,0):0,[s]),x=l.useMemo(()=>{const u=[];return t.jaz&&t.jaz.wert<3&&u.push("JAZ unter 3.0: Prüfe Vorlauftemperaturen und Wärmedämmung. Höhere Temperaturen senken die Effizienz."),i>=3&&t.jaz&&t.jaz.community_avg&&t.jaz.wert<t.jaz.community_avg*.9&&u.push("Deine JAZ liegt deutlich unter dem Community-Durchschnitt. Eine Optimierung der Heizkurve könnte helfen."),u.length===0&&t.jaz&&t.jaz.wert>=3.5?u.push("Gute Effizienz! Eine JAZ von 3.5+ ist ein solider Wert für Wärmepumpen."):u.length===0&&u.push("Deine Wärmepumpe arbeitet im normalen Effizienzbereich."),u},[t,i]);return e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(Ze,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Wärmepumpe"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Effizienz-Analyse"})]})]}),((g=t.jaz)==null?void 0:g.rang)&&t.jaz.von&&e.jsx(Wr,{rang:t.jaz.rang,von:t.jaz.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Qe,{label:"Jahresarbeitszahl (JAZ)",icon:e.jsx(Rt,{className:"h-5 w-5 text-blue-500"}),kpi:t.jaz,einheit:"",beschreibung:"Wärmeenergie / Stromverbrauch",large:!0}),e.jsx(Qe,{label:"Stromverbrauch",icon:e.jsx(ye,{className:"h-5 w-5 text-yellow-500"}),kpi:t.stromverbrauch,einheit:"kWh",beschreibung:"Gesamt im Zeitraum"}),e.jsx(Qe,{label:"Wärmeerzeugung",icon:e.jsx(Ze,{className:"h-5 w-5 text-red-500"}),kpi:t.waermeerzeugung,einheit:"kWh",beschreibung:"Heizung + Warmwasser"})]}),a.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(gt,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: JAZ nach Region"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i," ",i===1?"Anlage":"Anlagen",")"]})]}),i<3?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Noch nicht genug Vergleichsdaten."})," Für einen aussagekräftigen regionalen Vergleich werden mindestens 3 Anlagen mit Wärmepumpe benötigt."]}),a.length===1&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Aktuell: ",a[0].name," mit JAZ ",a[0].jaz.toFixed(2)," (",a[0].anzahl," Anlage)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:a,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(je,{type:"number",domain:[0,5],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(ge,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:11},width:120}),e.jsx(ce,{formatter:u=>[`JAZ: ${u.toFixed(2)}`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsxs(se,{dataKey:"jaz",radius:[0,4,4,0],children:[a.map((u,d)=>e.jsx(Ie,{fill:u.region===n?"#3b82f6":"#9ca3af"},`cell-${d}`)),e.jsx(en,{dataKey:"jaz",position:"right",formatter:u=>u.toFixed(2),style:{fill:"#374151",fontSize:11}})]})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Deine Region"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Andere Regionen"})]})]})]})]}),e.jsx(Mr,{tipps:x})]})}const da=["#22c55e","#3b82f6","#f59e0b","#ef4444"];function Zl({benchmark:r,communityStats:s}){var g,u;const t=(g=r.benchmark_erweitert)==null?void 0:g.eauto;if(!t)return null;const n=l.useMemo(()=>{var p;if(!((p=t.km)!=null&&p.wert))return null;const d=t.km.wert/12;return d<=500?"Wenig":d<=1e3?"Normal":d<=2e3?"Viel":"Intensiv"},[t.km]),a=l.useMemo(()=>s!=null&&s.klassen?s.klassen.filter(d=>d.anzahl>0).map((d,p)=>({name:d.klasse.charAt(0).toUpperCase()+d.klasse.slice(1),beschreibung:d.beschreibung,anzahl:d.anzahl,fill:da[p%da.length],avg_pv_anteil:d.durchschnitt_pv_anteil??0,avg_verbrauch:d.durchschnitt_verbrauch_100km??0})):[],[s]),i=l.useMemo(()=>s!=null&&s.klassen?s.klassen.reduce((d,p)=>d+p.anzahl,0):0,[s]),x=l.useMemo(()=>{if(!t.pv_anteil)return[];const d=t.pv_anteil.wert;return[{name:"PV",wert:d,fill:"#22c55e"},{name:"Netz/Extern",wert:100-d,fill:"#ef4444"}]},[t]),c=l.useMemo(()=>{const d=[];return t.pv_anteil&&t.pv_anteil.wert<50&&d.push("Unter 50% PV-Anteil: Versuche, das Laden tagsüber bei PV-Überschuss zu priorisieren."),t.verbrauch_100km&&t.verbrauch_100km.wert>20&&d.push("Hoher Verbrauch: Prüfe Reifendruck, Fahrweise und Klimaanlagen-Nutzung."),t.v2h&&t.v2h.wert>0&&d.push("V2H aktiv: Du nutzt dein Auto als zusätzlichen Speicher - sehr gut!"),d.length===0&&d.push("Dein E-Auto ist gut in das Energiesystem integriert."),d},[t]);return e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx(Ae,{className:"h-6 w-6 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"E-Auto"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Lade- und Verbrauchsanalyse"})]})]}),((u=t.pv_anteil)==null?void 0:u.rang)&&t.pv_anteil.von&&e.jsx(Wr,{rang:t.pv_anteil.rang,von:t.pv_anteil.von})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qe,{label:"PV-Ladeanteil",icon:e.jsx(ae,{className:"h-5 w-5 text-yellow-500"}),kpi:t.pv_anteil,einheit:"%",beschreibung:"Anteil PV an Gesamtladung"}),e.jsx(Qe,{label:"Ladung gesamt",icon:e.jsx(ja,{className:"h-5 w-5 text-purple-500"}),kpi:t.ladung_gesamt,einheit:"kWh",beschreibung:"Gesamte Lademenge"}),e.jsx(Qe,{label:"Verbrauch",icon:e.jsx(ir,{className:"h-5 w-5 text-blue-500"}),kpi:t.verbrauch_100km,einheit:"kWh/100km",beschreibung:"Durchschnittsverbrauch",invertColors:!0}),t.km&&e.jsx(Qe,{label:"Gefahrene km",icon:e.jsx(Sn,{className:"h-5 w-5 text-gray-500"}),kpi:t.km,einheit:"km",beschreibung:"Im Zeitraum"}),t.v2h&&t.v2h.wert>0&&e.jsx(Qe,{label:"V2H Entladung",icon:e.jsx(ye,{className:"h-5 w-5 text-green-500"}),kpi:t.v2h,einheit:"kWh",beschreibung:"Rückspeisung ins Haus"})]}),x.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ladequellen-Verteilung"}),e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:x,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(je,{type:"number",domain:[0,100],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(ge,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:80}),e.jsx(ce,{formatter:d=>[`${d.toFixed(1)}%`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(se,{dataKey:"wert",radius:[0,4,4,0],children:x.map((d,p)=>e.jsx(Ie,{fill:d.fill},`cell-${p}`))})]})})})]})]}),a.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: E-Autos nach Nutzungsintensität"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i," E-Autos)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-48",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(yt,{children:[e.jsx(kt,{data:a,dataKey:"anzahl",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:d,percent:p})=>`${d} (${(p*100).toFixed(0)}%)`,labelLine:!1,children:a.map((d,p)=>e.jsx(Ie,{fill:d.fill,stroke:d.name.toLowerCase()===(n==null?void 0:n.toLowerCase())?"#000":"none",strokeWidth:d.name.toLowerCase()===(n==null?void 0:n.toLowerCase())?2:0},`cell-${p}`))}),e.jsx(ce,{formatter:(d,p)=>[`${d} E-Autos`,p]})]})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"text-left pb-2",children:"Nutzung"}),e.jsx("th",{className:"text-right pb-2",children:"Ø Verbrauch"}),e.jsx("th",{className:"text-right pb-2",children:"Ø PV-Anteil"})]})}),e.jsx("tbody",{children:a.map(d=>e.jsxs("tr",{className:d.name.toLowerCase()===(n==null?void 0:n.toLowerCase())?"bg-primary-50 dark:bg-primary-900/20 font-medium":"",children:[e.jsxs("td",{className:"py-1 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:d.fill}}),e.jsx("span",{title:d.beschreibung,children:d.name}),d.name.toLowerCase()===(n==null?void 0:n.toLowerCase())&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]}),e.jsxs("td",{className:"text-right py-1",children:[d.avg_verbrauch.toFixed(1)," kWh/100km"]}),e.jsxs("td",{className:"text-right py-1",children:[d.avg_pv_anteil.toFixed(0),"%"]})]},d.name))})]})})]})]}),e.jsx(Mr,{tipps:c})]})}function ql({benchmark:r}){var a,i;const s=(a=r.benchmark_erweitert)==null?void 0:a.wallbox;if(!s)return null;const t=r.anlage.wallbox_kw,n=l.useMemo(()=>{const x=[];return s.pv_anteil&&s.pv_anteil.wert<60&&x.push("Der PV-Anteil könnte höher sein. Nutze PV-geführtes Laden für mehr Eigenverbrauch."),s.pv_anteil&&s.pv_anteil.wert>=80&&x.push("Exzellenter PV-Anteil! Deine Wallbox ist optimal ins PV-System integriert."),x.length===0&&x.push("Deine Wallbox arbeitet im normalen Bereich."),x},[s]);return e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-100 dark:bg-cyan-900/30",children:e.jsx(pt,{className:"h-6 w-6 text-cyan-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Wallbox"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t?`${t} kW Ladeleistung`:"Ladeverhalten"})]})]}),((i=s.pv_anteil)==null?void 0:i.rang)&&s.pv_anteil.von&&e.jsx(Wr,{rang:s.pv_anteil.rang,von:s.pv_anteil.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Qe,{label:"PV-Ladeanteil",icon:e.jsx(ae,{className:"h-5 w-5 text-yellow-500"}),kpi:s.pv_anteil,einheit:"%",beschreibung:"Anteil PV an Gesamtladung",large:!0}),e.jsx(Qe,{label:"Ladung gesamt",icon:e.jsx(ye,{className:"h-5 w-5 text-cyan-500"}),kpi:s.ladung,einheit:"kWh",beschreibung:"Im Zeitraum"}),e.jsx(Qe,{label:"Ladevorgänge",icon:e.jsx(ut,{className:"h-5 w-5 text-gray-500"}),kpi:s.ladevorgaenge,einheit:"",beschreibung:"Anzahl"})]}),e.jsx(Mr,{tipps:n})]})}function Ul({benchmark:r}){var a,i;const s=(a=r.benchmark_erweitert)==null?void 0:a.balkonkraftwerk;if(!s)return null;const t=r.anlage.bkw_wp,n=l.useMemo(()=>{const x=[];return s.spez_ertrag&&s.spez_ertrag.community_avg&&(s.spez_ertrag.wert-s.spez_ertrag.community_avg)/s.spez_ertrag.community_avg*100<-15&&x.push("Dein spezifischer Ertrag liegt deutlich unter dem Durchschnitt. Prüfe Verschattung und Ausrichtung."),s.eigenverbrauch&&s.eigenverbrauch.wert<70&&x.push("Der Eigenverbrauchsanteil könnte höher sein. Versuche, Verbraucher tagsüber zu nutzen."),x.length===0&&x.push("Dein Balkonkraftwerk arbeitet gut!"),x},[s]);return e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(ae,{className:"h-6 w-6 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Balkonkraftwerk"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t?`${t} Wp`:"Mini-PV"})]})]}),((i=s.spez_ertrag)==null?void 0:i.rang)&&s.spez_ertrag.von&&e.jsx(Wr,{rang:s.spez_ertrag.rang,von:s.spez_ertrag.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Qe,{label:"Spezifischer Ertrag",icon:e.jsx(_e,{className:"h-5 w-5 text-amber-500"}),kpi:s.spez_ertrag,einheit:"kWh/kWp",beschreibung:"Normierter Ertrag",large:!0}),e.jsx(Qe,{label:"Erzeugung",icon:e.jsx(ye,{className:"h-5 w-5 text-yellow-500"}),kpi:s.erzeugung,einheit:"kWh",beschreibung:"Im Zeitraum"}),e.jsx(Qe,{label:"Eigenverbrauch",icon:e.jsx(Ze,{className:"h-5 w-5 text-green-500"}),kpi:s.eigenverbrauch,einheit:"%",beschreibung:"Direkt genutzt"})]}),e.jsx(Mr,{tipps:n})]})}function Wr({rang:r,von:s}){const t=r/s*100;let n="bg-gray-100 dark:bg-gray-800",a="text-gray-600 dark:text-gray-400";return t<=10?(n="bg-yellow-100 dark:bg-yellow-900/30",a="text-yellow-600 dark:text-yellow-400"):t<=25?(n="bg-blue-100 dark:bg-blue-900/30",a="text-blue-600 dark:text-blue-400"):t<=50&&(n="bg-green-100 dark:bg-green-900/30",a="text-green-600 dark:text-green-400"),e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full ${n}`,children:[e.jsx(or,{className:`h-4 w-4 ${a}`}),e.jsxs("span",{className:`text-sm font-medium ${a}`,children:["#",r," von ",s]})]})}function Qe({label:r,icon:s,kpi:t,einheit:n,beschreibung:a,invertColors:i,large:x}){if(!t)return null;const c=t.community_avg!==void 0&&t.community_avg!==null,g=c?(t.wert-t.community_avg)/t.community_avg*100:null,u=g!==null?i?g<0:g>0:null;return e.jsxs("div",{className:`bg-gray-50 dark:bg-gray-800 rounded-lg p-4 ${x?"md:col-span-1":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s,e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`font-bold text-gray-900 dark:text-white ${x?"text-3xl":"text-xl"}`,children:t.wert.toFixed(n==="%"||n===""?1:0)}),n&&e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:n})]}),c&&g!==null&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-sm ${u?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[u?e.jsx(_e,{className:"h-3 w-3"}):e.jsx(jt,{className:"h-3 w-3"}),e.jsxs("span",{children:[g>=0?"+":"",g.toFixed(1),"% vs. Ø"]})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:a})]})}function Mr({tipps:r}){return e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(kn,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Tipps"})]}),e.jsx("ul",{className:"space-y-2",children:r.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-primary-500 mt-0.5",children:"•"}),e.jsx("span",{children:s})]},t))})]})}const os={BW:{name:"Baden-Württemberg",kurzname:"BaWü"},BY:{name:"Bayern",kurzname:"Bayern"},BE:{name:"Berlin",kurzname:"Berlin"},BB:{name:"Brandenburg",kurzname:"Brandenb."},HB:{name:"Bremen",kurzname:"Bremen"},HH:{name:"Hamburg",kurzname:"Hamburg"},HE:{name:"Hessen",kurzname:"Hessen"},MV:{name:"Mecklenburg-Vorpommern",kurzname:"MeckPom"},NI:{name:"Niedersachsen",kurzname:"Nieders."},NW:{name:"Nordrhein-Westfalen",kurzname:"NRW"},RP:{name:"Rheinland-Pfalz",kurzname:"RhPf"},SL:{name:"Saarland",kurzname:"Saarland"},SN:{name:"Sachsen",kurzname:"Sachsen"},ST:{name:"Sachsen-Anhalt",kurzname:"SaAnh"},SH:{name:"Schleswig-Holstein",kurzname:"SchlHol"},TH:{name:"Thüringen",kurzname:"Thüring."},AT:{name:"Österreich",kurzname:"Österr."},CH:{name:"Schweiz",kurzname:"Schweiz"}};function Yl({anlageId:r,zeitraum:s}){var m;const[t,n]=l.useState(null),[a,i]=l.useState([]),[x,c]=l.useState(!1),[g,u]=l.useState(null);l.useEffect(()=>{(async()=>{c(!0),u(null);try{const[b,h]=await Promise.all([Re.getBenchmark(r,s),Re.getRegionalStatistics().catch(()=>[])]);n(b),i(h)}catch(b){u(b instanceof Error?b.message:"Fehler beim Laden")}finally{c(!1)}})()},[r,s]);const d=l.useMemo(()=>{var w;if(!t)return null;const{spez_ertrag_anlage:o,spez_ertrag_region:b,spez_ertrag_durchschnitt:h,rang_region:y,anzahl_anlagen_region:k}=t.benchmark,j=t.anlage.region;return{region:j,regionName:((w=os[j])==null?void 0:w.name)||j,spezErtrag:o,regionDurchschnitt:b,communityDurchschnitt:h,rang:y,anzahlAnlagen:k,abweichungRegion:(o-b)/b*100,abweichungCommunity:(b-h)/h*100,perzentilRegion:Math.round((1-y/k)*100)}},[t]),p=l.useMemo(()=>d?[{name:"Du",wert:d.spezErtrag,fill:"var(--color-primary-500, #3b82f6)"},{name:d.regionName,wert:d.regionDurchschnitt,fill:"#60a5fa"},{name:"Community",wert:d.communityDurchschnitt,fill:"#9ca3af"}]:[],[d]);return x?e.jsx(ve,{text:"Lade regionale Daten..."}):g?e.jsx(Q,{type:"error",children:g}):!t||!d?null:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Betrachtungszeitraum: ",t.zeitraum_label]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(gt,{className:"h-5 w-5 text-blue-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Dein Standort"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.regionName})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[d.anzahlAnlagen," Anlagen in der Region"]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900/30",children:e.jsx(cr,{className:"h-5 w-5 text-yellow-500"})}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rang in ",((m=os[d.region])==null?void 0:m.kurzname)||d.region]})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["#",d.rang]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["von ",d.anzahlAnlagen]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Besser als ",d.perzentilRegion,"% in deiner Region"]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${d.abweichungRegion>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:d.abweichungRegion>=0?e.jsx(_e,{className:"h-5 w-5 text-green-500"}):e.jsx(jt,{className:"h-5 w-5 text-red-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Region"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${d.abweichungRegion>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[d.abweichungRegion>=0?"+":"",d.abweichungRegion.toFixed(1),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Ø Region: ",d.regionDurchschnitt.toFixed(0)," kWh/kWp"]})]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ae,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Spezifischer Ertrag im Vergleich"})]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:p,layout:"vertical",children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!0,vertical:!1}),e.jsx(je,{type:"number",tick:{fill:"#6b7280",fontSize:12},domain:[0,"auto"],label:{value:"kWh/kWp",position:"bottom",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(ge,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:100}),e.jsx(ce,{formatter:o=>[`${o.toFixed(0)} kWh/kWp`,"Spez. Ertrag"],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(se,{dataKey:"wert",radius:[0,4,4,0],children:p.map((o,b)=>e.jsx(Ie,{fill:o.fill},`cell-${b}`))})]})})})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Regionale Einordnung"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:[d.regionName," vs. Community"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`text-lg font-semibold ${d.abweichungCommunity>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[d.abweichungCommunity>=0?"+":"",d.abweichungCommunity.toFixed(1),"%"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[d.abweichungCommunity>=0?"über":"unter"," dem Durchschnitt"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Deine Region liegt ",d.abweichungCommunity>=0?"über":"unter"," dem bundesweiten Community-Durchschnitt von ",d.communityDurchschnitt.toFixed(0)," kWh/kWp."]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Deine Anlage"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Ausrichtung:"}),e.jsx("span",{className:"text-gray-900 dark:text-white capitalize",children:t.anlage.ausrichtung})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Neigung:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[t.anlage.neigung_grad,"°"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Leistung:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[t.anlage.kwp," kWp"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Installation:"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:t.anlage.installation_jahr})]})]})]})]})]}),a.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(gt,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Alle Regionen im Vergleich"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Region"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Anlagen"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Ø kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Ø kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Speicher"})]})}),e.jsx("tbody",{children:a.sort((o,b)=>b.durchschnitt_spez_ertrag-o.durchschnitt_spez_ertrag).map((o,b)=>{var y,k,j;const h=o.region===(t==null?void 0:t.anlage.region);return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${h?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-medium w-5 text-center ${b<3?"text-yellow-600":"text-gray-400"}`,children:b+1}),e.jsx("span",{className:`font-medium ${h?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white"}`,children:((y=os[o.region])==null?void 0:y.name)||o.region}),h&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]})}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:o.anzahl_anlagen}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:o.durchschnitt_kwp.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900 dark:text-white",children:o.durchschnitt_spez_ertrag.toFixed(0)}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:[((j=(k=o.ausstattung)==null?void 0:k.speicher)==null?void 0:j.toFixed(0))||"-","%"]})]},o.region)})})]})})]})]})}const gs=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Ql=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],ca={fruehling:{name:"Frühling",monate:[3,4,5],icon:et,color:"green"},sommer:{name:"Sommer",monate:[6,7,8],icon:ae,color:"yellow"},herbst:{name:"Herbst",monate:[9,10,11],icon:Ot,color:"orange"},winter:{name:"Winter",monate:[12,1,2],icon:Mn,color:"blue"}};function Xl({anlageId:r,zeitraum:s}){const[t,n]=l.useState(null),[a,i]=l.useState(null),[x,c]=l.useState(null),[g,u]=l.useState(!1),[d,p]=l.useState(null);l.useEffect(()=>{(async()=>{u(!0),p(null);try{const[k,j,w]=await Promise.all([Re.getBenchmark(r,s),Re.getTrends("12_monate").catch(()=>null),Re.getDegradation().catch(()=>null)]);n(k),i(j),c(w)}catch(k){p(k instanceof Error?k.message:"Fehler beim Laden")}finally{u(!1)}})()},[r,s]);const m=l.useMemo(()=>t!=null&&t.anlage.monatswerte?[...t.anlage.monatswerte].sort((k,j)=>k.jahr-j.jahr||k.monat-j.monat).map(k=>({name:`${gs[k.monat-1]} ${k.jahr%100}`,monat:k.monat,jahr:k.jahr,ertrag:k.spez_ertrag_kwh_kwp||0,autarkie:k.autarkie_prozent||null,eigenverbrauch:k.eigenverbrauch_prozent||null})):[],[t]),o=l.useMemo(()=>{if(!(t!=null&&t.anlage.monatswerte))return null;const y=t.anlage.monatswerte,k=[...new Set(y.map(P=>P.jahr))].sort();if(k.length<2)return null;const j={};y.forEach(P=>{j[P.jahr]||(j[P.jahr]={summe:0,anzahl:0}),j[P.jahr].summe+=P.spez_ertrag_kwh_kwp||0,j[P.jahr].anzahl+=1});const w=k.filter(P=>j[P].anzahl===12);if(w.length<2)return null;const v=w[w.length-1],N=w[w.length-2],f=j[v].summe,_=j[N].summe,I=f-_,C=I/_*100;return{letztesJahr:v,vorletztesJahr:N,ertragLetzt:f,ertragVorletzt:_,differenz:I,differenzProzent:C}},[t]),b=l.useMemo(()=>{if(!(t!=null&&t.anlage.monatswerte))return null;const y=t.anlage.monatswerte,k={};return Object.entries(ca).forEach(([j,w])=>{k[j]={summe:0,anzahl:0},y.forEach(v=>{w.monate.includes(v.monat)&&(k[j].summe+=v.spez_ertrag_kwh_kwp||0,k[j].anzahl+=1)})}),Object.entries(ca).map(([j,w])=>{const v=k[j],N=v.anzahl>0?v.summe/v.anzahl:0;return{key:j,name:w.name,icon:w.icon,color:w.color,durchschnittMonat:N,anzahlMonate:v.anzahl}})},[t]),h=l.useMemo(()=>{if(!(t!=null&&t.anlage.monatswerte))return[];const y=t.anlage.monatswerte,k={};for(let j=1;j<=12;j++)k[j]={summe:0,anzahl:0};return y.forEach(j=>{k[j.monat].summe+=j.spez_ertrag_kwh_kwp||0,k[j.monat].anzahl+=1}),Object.entries(k).map(([j,w])=>({monat:parseInt(j),name:gs[parseInt(j)-1],durchschnitt:w.anzahl>0?w.summe/w.anzahl:0,anzahl:w.anzahl}))},[t]);return g?e.jsx(ve,{text:"Lade Trend-Daten..."}):d?e.jsx(Q,{type:"error",children:d}):t?e.jsxs("div",{className:"space-y-6",children:[m.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ertragsverlauf"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:t.zeitraum_label})]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:m,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorErtrag",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-primary-500, #3b82f6)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-primary-500, #3b82f6)",stopOpacity:0})]})}),e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11},interval:Math.floor(m.length/12)}),e.jsx(ge,{tick:{fill:"#6b7280",fontSize:12},label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(ce,{formatter:y=>[`${y.toFixed(1)} kWh/kWp`,"Spez. Ertrag"],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(ct,{type:"monotone",dataKey:"ertrag",stroke:"var(--color-primary-500, #3b82f6)",strokeWidth:2,fill:"url(#colorErtrag)"})]})})})]}),b&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(it,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Saisonale Performance"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:b.map(y=>{const k=y.icon,w={green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",icon:"text-green-500"},yellow:{bg:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-700 dark:text-yellow-300",icon:"text-yellow-500"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-700 dark:text-orange-300",icon:"text-orange-500"},blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-300",icon:"text-blue-500"}}[y.color];return e.jsxs("div",{className:`rounded-xl p-4 ${w.bg}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(k,{className:`h-5 w-5 ${w.icon}`}),e.jsx("span",{className:`font-medium ${w.text}`,children:y.name})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y.durchschnittMonat.toFixed(0)}),e.jsx("span",{className:"text-sm text-gray-500",children:"kWh/kWp"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Ø pro Monat (",y.anzahlMonate," Monate)"]})]},y.key)})})]}),o&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ut,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:o.vorletztesJahr}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.ertragVorletzt.toFixed(0)}),e.jsx("span",{className:"text-sm text-gray-500",children:"kWh/kWp"})]})]}),e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-primary-600 dark:text-primary-400 mb-1",children:o.letztesJahr}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",children:o.ertragLetzt.toFixed(0)}),e.jsx("span",{className:"text-sm text-primary-500",children:"kWh/kWp"})]})]}),e.jsxs("div",{className:`rounded-xl p-4 ${o.differenzProzent>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Veränderung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.differenzProzent>=0?e.jsx(gn,{className:"h-6 w-6 text-green-500"}):o.differenzProzent<=-.5?e.jsx(on,{className:"h-6 w-6 text-red-500"}):e.jsx(Gr,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("span",{className:`text-2xl font-bold ${o.differenzProzent>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[o.differenzProzent>=0?"+":"",o.differenzProzent.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o.differenz>=0?"+":"",o.differenz.toFixed(0)," kWh/kWp"]})]})]})]})]})]}),h.some(y=>y.anzahl>1)&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ae,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Typischer Monatsverlauf"})]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:h,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11}}),e.jsx(ge,{tick:{fill:"#6b7280",fontSize:12},domain:[0,"auto"]}),e.jsx(ce,{formatter:(y,k)=>k==="durchschnitt"?[`${y.toFixed(1)} kWh/kWp`,"Ø Ertrag"]:[y,k],labelFormatter:y=>Ql[gs.indexOf(y)],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ee,{formatter:()=>"Durchschnittlicher Ertrag"}),e.jsx(Be,{type:"monotone",dataKey:"durchschnitt",stroke:"var(--color-primary-500, #3b82f6)",strokeWidth:3,dot:{fill:"var(--color-primary-500, #3b82f6)",strokeWidth:2},activeDot:{r:6}})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 text-center mt-2",children:["Basierend auf ",m.length," Monaten Daten"]})]}),a&&a.trends.speicher_quote.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_e,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Community-Entwicklung"})]}),e.jsx("div",{className:"h-72",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:a.trends.speicher_quote.map((y,k)=>{var j,w;return{monat:y.monat,speicher:y.wert,waermepumpe:((j=a.trends.waermepumpe_quote[k])==null?void 0:j.wert)||0,eauto:((w=a.trends.eauto_quote[k])==null?void 0:w.wert)||0}}),children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"monat",tick:{fill:"#6b7280",fontSize:10},interval:1}),e.jsx(ge,{tick:{fill:"#6b7280",fontSize:12},domain:[0,100],unit:"%"}),e.jsx(ce,{formatter:(y,k)=>{const j={speicher:"Speicher",waermepumpe:"Wärmepumpe",eauto:"E-Auto"};return[`${y.toFixed(1)}%`,j[k]||k]},contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ee,{formatter:y=>({speicher:"Speicher-Quote",waermepumpe:"Wärmepumpen-Quote",eauto:"E-Auto-Quote"})[y]||y}),e.jsx(Be,{type:"monotone",dataKey:"speicher",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(Be,{type:"monotone",dataKey:"waermepumpe",stroke:"#3b82f6",strokeWidth:2,dot:!1}),e.jsx(Be,{type:"monotone",dataKey:"eauto",stroke:"#a855f7",strokeWidth:2,dot:!1})]})})}),e.jsx("p",{className:"text-sm text-gray-500 text-center mt-2",children:"Anteil der Community-Anlagen mit jeweiliger Ausstattung"})]}),x&&x.nach_alter.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ut,{className:"h-5 w-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Degradation nach Anlagenalter"})]}),e.jsx("div",{className:"h-64",children:e.jsx(de,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:x.nach_alter,children:[e.jsx(be,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(je,{dataKey:"alter_jahre",tick:{fill:"#6b7280",fontSize:12},label:{value:"Anlagenalter (Jahre)",position:"bottom",offset:-5,fill:"#6b7280"}}),e.jsx(ge,{tick:{fill:"#6b7280",fontSize:12},domain:["dataMin - 50","dataMax + 50"],label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280"}}}),e.jsx(ce,{formatter:(y,k)=>k==="durchschnitt_spez_ertrag"?[`${y.toFixed(0)} kWh/kWp`,"Ø Ertrag"]:k==="anzahl"?[y,"Anlagen"]:[y,k],labelFormatter:y=>`${y} Jahre alt`,contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Ee,{formatter:()=>"Durchschnittlicher spez. Ertrag"}),e.jsx(Be,{type:"monotone",dataKey:"durchschnitt_spez_ertrag",stroke:"#f97316",strokeWidth:3,dot:{fill:"#f97316",strokeWidth:2},activeDot:{r:6}})]})})}),e.jsxs("div",{className:"mt-4 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-medium text-orange-900 dark:text-orange-100",children:["Durchschnittliche Degradation: ",x.durchschnittliche_degradation_prozent_jahr.toFixed(2),"% / Jahr"]})]}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 mt-1",children:["Basierend auf ",x.nach_alter.reduce((y,k)=>y+k.anzahl,0)," Anlagen unterschiedlichen Alters"]})]})]})]}):null}const oa={BW:"Baden-Württemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thüringen",AT:"Österreich",CH:"Schweiz"};function ed({anlageId:r,zeitraum:s}){var h;const[t,n]=l.useState(null),[a,i]=l.useState(null),[x,c]=l.useState(null),[g,u]=l.useState(!1),[d,p]=l.useState(null);l.useEffect(()=>{(async()=>{u(!0),p(null);try{const[k,j,w]=await Promise.all([Re.getBenchmark(r,s),Re.getGlobalStatistics().catch(()=>null),Re.getRanking("spez_ertrag",10).catch(()=>null)]);n(k),i(j),c(w)}catch(k){p(k instanceof Error?k.message:"Fehler beim Laden")}finally{u(!1)}})()},[r,s]);const m=l.useMemo(()=>t?{anzahlAnlagen:t.benchmark.anzahl_anlagen_gesamt,anzahlRegion:t.benchmark.anzahl_anlagen_region,durchschnittErtrag:t.benchmark.spez_ertrag_durchschnitt,regionErtrag:t.benchmark.spez_ertrag_region,region:t.anlage.region,regionName:oa[t.anlage.region]||t.anlage.region}:null,[t]),o=l.useMemo(()=>t?[{name:"Speicher",icon:e.jsx(ze,{className:"h-5 w-5"}),vorhanden:!!t.anlage.speicher_kwh,details:t.anlage.speicher_kwh?`${t.anlage.speicher_kwh} kWh`:null,color:"green"},{name:"Wärmepumpe",icon:e.jsx(Ze,{className:"h-5 w-5"}),vorhanden:t.anlage.hat_waermepumpe,details:null,color:"blue"},{name:"E-Auto",icon:e.jsx(Ae,{className:"h-5 w-5"}),vorhanden:t.anlage.hat_eauto,details:null,color:"purple"},{name:"Wallbox",icon:e.jsx(pt,{className:"h-5 w-5"}),vorhanden:t.anlage.hat_wallbox,details:t.anlage.wallbox_kw?`${t.anlage.wallbox_kw} kW`:null,color:"cyan"},{name:"Balkonkraftwerk",icon:e.jsx(ae,{className:"h-5 w-5"}),vorhanden:t.anlage.hat_balkonkraftwerk,details:t.anlage.bkw_wp?`${t.anlage.bkw_wp} Wp`:null,color:"amber"}]:[],[t]),b=l.useMemo(()=>{if(!t)return null;const{rang_gesamt:y,anzahl_anlagen_gesamt:k,rang_region:j,anzahl_anlagen_region:w}=t.benchmark,v=Math.round((1-y/k)*100),N=Math.round((1-j/w)*100);return{rangGesamt:y,vonGesamt:k,perzentilGesamt:v,rangRegion:j,vonRegion:w,perzentilRegion:N}},[t]);return g?e.jsx(ve,{text:"Lade Community-Statistiken..."}):d?e.jsx(Q,{type:"error",children:d}):!t||!m?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ct,{className:"h-6 w-6 text-primary-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Community-Übersicht"}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:t.zeitraum_label})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Kr,{label:"Anlagen gesamt",value:m.anzahlAnlagen,icon:e.jsx(Ct,{className:"h-5 w-5 text-primary-500"})}),e.jsx(Kr,{label:"Ø Spez. Ertrag",value:m.durchschnittErtrag,suffix:"kWh/kWp",icon:e.jsx(ae,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(Kr,{label:`In ${m.regionName}`,value:m.anzahlRegion,suffix:"Anlagen",icon:e.jsx(gt,{className:"h-5 w-5 text-blue-500"})}),e.jsx(Kr,{label:"Ø Region",value:m.regionErtrag,suffix:"kWh/kWp",icon:e.jsx(ut,{className:"h-5 w-5 text-green-500"})})]})]}),b&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(or,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Deine Position in der Community"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100 dark:from-primary-900/20 dark:to-primary-800/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ct,{className:"h-5 w-5 text-primary-500"}),e.jsx("span",{className:"text-primary-700 dark:text-primary-300 font-medium",children:"Community-weit"})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-4xl font-bold text-primary-600 dark:text-primary-400",children:["#",b.rangGesamt]}),e.jsxs("span",{className:"text-primary-500 dark:text-primary-400",children:["von ",b.vonGesamt]})]}),e.jsx(ga,{value:b.perzentilGesamt,color:"primary"}),e.jsxs("p",{className:"text-sm text-primary-600 dark:text-primary-400 mt-2",children:["Besser als ",b.perzentilGesamt,"% der Community"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(gt,{className:"h-5 w-5 text-blue-500"}),e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:["In ",m.regionName]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-4xl font-bold text-blue-600 dark:text-blue-400",children:["#",b.rangRegion]}),e.jsxs("span",{className:"text-blue-500 dark:text-blue-400",children:["von ",b.vonRegion]})]}),e.jsx(ga,{value:b.perzentilRegion,color:"blue"}),e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Besser als ",b.perzentilRegion,"% in deiner Region"]})]})]})]}),e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ye,{className:"h-6 w-6 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Deine Anlage"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Tr,{label:"Leistung",value:`${t.anlage.kwp} kWp`,icon:e.jsx(ae,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(Tr,{label:"Ausrichtung",value:t.anlage.ausrichtung,icon:e.jsx(_e,{className:"h-5 w-5 text-blue-500"}),capitalize:!0}),e.jsx(Tr,{label:"Neigung",value:`${t.anlage.neigung_grad}°`,icon:e.jsx(ut,{className:"h-5 w-5 text-green-500"})}),e.jsx(Tr,{label:"Installation",value:String(t.anlage.installation_jahr),icon:e.jsx(it,{className:"h-5 w-5 text-gray-500"})})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ausstattung"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:o.map(y=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${y.vorhanden?`bg-${y.color}-50 dark:bg-${y.color}-900/20 border border-${y.color}-200 dark:border-${y.color}-800`:"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:y.vorhanden?`text-${y.color}-500`:"text-gray-400",children:y.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${y.vorhanden?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-500"}`,children:y.name}),y.details&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:y.details})]}),y.vorhanden?e.jsx(At,{className:`h-4 w-4 text-${y.color}-500`}):e.jsx(_r,{className:"h-4 w-4 text-gray-300 dark:text-gray-600"})]},y.name))})]}),a&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ut,{className:"h-6 w-6 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ausstattungsquoten der Community"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(fr,{label:"Speicher",value:a.ausstattungsquoten.speicher,color:"green"}),e.jsx(fr,{label:"Wärmepumpe",value:a.ausstattungsquoten.waermepumpe,color:"blue"}),e.jsx(fr,{label:"E-Auto",value:a.ausstattungsquoten.eauto,color:"purple"}),e.jsx(fr,{label:"Wallbox",value:a.ausstattungsquoten.wallbox,color:"cyan"}),e.jsx(fr,{label:"Balkonkraftwerk",value:a.ausstattungsquoten.balkonkraftwerk,color:"amber"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Die typische Community-Anlage"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Leistung:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[a.typische_anlage.kwp," kWp"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ausrichtung:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:a.typische_anlage.ausrichtung})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Neigung:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[a.typische_anlage.neigung_grad,"°"]})]}),a.typische_anlage.speicher_kwh&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Speicher:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[a.typische_anlage.speicher_kwh," kWh"]})]})]})]})]}),x&&x.ranking.length>0&&e.jsxs(E,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(or,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Top 10 - Spezifischer Ertrag"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Rang"}),e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Region"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"kWh/kWp"})]})}),e.jsx("tbody",{children:x.ranking.map(y=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${y.rang===1?"bg-yellow-100 text-yellow-700":y.rang===2?"bg-gray-200 text-gray-700":y.rang===3?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600"}`,children:y.rang})}),e.jsx("td",{className:"py-2 px-3 text-gray-900 dark:text-white",children:oa[y.region]||y.region}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:y.kwp.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900 dark:text-white",children:y.wert.toFixed(0)})]},y.rang))})]})}),x.eigener_rang&&e.jsx("div",{className:"mt-4 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-center",children:e.jsxs("span",{className:"text-primary-700 dark:text-primary-300",children:["Dein Rang: ",e.jsxs("strong",{children:["#",x.eigener_rang]})," mit ",e.jsxs("strong",{children:[(h=x.eigener_wert)==null?void 0:h.toFixed(0)," kWh/kWp"]})]})})]})]})}function fr({label:r,value:s,color:t}){return e.jsxs("div",{className:`p-4 rounded-lg bg-${t}-50 dark:bg-${t}-900/20`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:r}),e.jsxs("p",{className:`text-2xl font-bold text-${t}-600 dark:text-${t}-400`,children:[s.toFixed(1),"%"]})]})}function Kr({label:r,value:s,suffix:t,icon:n}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n,e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:typeof s=="number"&&s>=1e3?s.toLocaleString("de-DE"):s.toFixed(s<10?1:0)}),t&&e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]})]})}function Tr({label:r,value:s,icon:t,capitalize:n}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t,e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:r})]}),e.jsx("span",{className:`text-lg font-semibold text-gray-900 dark:text-white ${n?"capitalize":""}`,children:s})]})}function ga({value:r,color:s}){const t={primary:"bg-primary-500",blue:"bg-blue-500"};return e.jsx("div",{className:"w-full bg-white/50 dark:bg-gray-700/50 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${t[s]} transition-all duration-500`,style:{width:`${Math.min(100,Math.max(0,r))}%`}})})}const ha=[{value:"letzter_monat",label:"Letzter Monat",tooltip:"Daten des letzten vollständigen Monats"},{value:"letzte_12_monate",label:"Letzte 12 Monate",tooltip:"Rollierender 12-Monats-Zeitraum bis heute"},{value:"letztes_vollstaendiges_jahr",label:"Letztes Jahr",tooltip:"Das letzte vollständige Kalenderjahr"},{value:"seit_installation",label:"Seit Installation",tooltip:"Alle Daten seit Inbetriebnahme der Anlage"}];function td(){var y,k,j;const r=Ft(),[s,t]=l.useState("uebersicht"),[n,a]=l.useState("letzte_12_monate"),{anlagen:i,loading:x}=Je(),[c,g]=l.useState(null),[u,d]=l.useState(null),[p,m]=l.useState(!0),o=c??((y=i[0])==null?void 0:y.id);if(l.useEffect(()=>{if(!o){m(!1);return}(async()=>{m(!0);try{const v=await dt.get(o);d(v.community_hash||null)}catch{d(null)}finally{m(!1)}})()},[o]),x||p)return e.jsx(ve,{text:"Lade Community..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"}),e.jsx(Q,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(!u)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ct,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"})]}),e.jsx(E,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ge,{className:"h-16 w-16 text-primary-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Teile erst deine Daten"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Um den Community-Vergleich nutzen zu können, musst du zuerst deine anonymisierten Anlagendaten mit der Community teilen. So können wir dir zeigen, wie deine Anlage im Vergleich zu anderen abschneidet."}),e.jsxs("button",{onClick:()=>r("/einstellungen/community"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 font-medium",children:[e.jsx(Kt,{className:"h-5 w-5"}),"Jetzt teilen"]})]})})]});const b=[{key:"uebersicht",label:"Übersicht",icon:cr,hatZeitraum:!0},{key:"pv-ertrag",label:"PV-Ertrag",icon:ae,hatZeitraum:!0},{key:"komponenten",label:"Komponenten",icon:ze,hatZeitraum:!0},{key:"regional",label:"Regional",icon:gt,hatZeitraum:!0},{key:"trends",label:"Trends",icon:_e,hatZeitraum:!1},{key:"statistiken",label:"Statistiken",icon:ut,hatZeitraum:!1}],h=((k=b.find(w=>w.key===s))==null?void 0:k.hatZeitraum)??!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ct,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i.length>1&&e.jsx("select",{value:o??"",onChange:w=>g(Number(w.target.value)),className:"input w-auto",children:i.map(w=>e.jsx("option",{value:w.id,children:w.anlagenname},w.id))}),h&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:n,onChange:w=>a(w.target.value),className:"input w-auto",children:ha.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))}),e.jsx(Yr,{text:((j=ha.find(w=>w.value===n))==null?void 0:j.tooltip)||"Betrachtungszeitraum wählen",children:e.jsx(ks,{className:"h-4 w-4 text-gray-400 cursor-help"})})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4 overflow-x-auto",children:b.map(w=>{const v=w.icon;return e.jsxs("button",{onClick:()=>t(w.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap ${s===w.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(v,{className:"h-4 w-4"}),w.label]},w.key)})})})]}),o&&e.jsxs(e.Fragment,{children:[s==="uebersicht"&&e.jsx(Bl,{anlageId:o,zeitraum:n}),s==="pv-ertrag"&&e.jsx(Rl,{anlageId:o,zeitraum:n}),s==="komponenten"&&e.jsx(Hl,{anlageId:o,zeitraum:n}),s==="regional"&&e.jsx(Yl,{anlageId:o,zeitraum:n}),s==="trends"&&e.jsx(Xl,{anlageId:o,zeitraum:n}),s==="statistiken"&&e.jsx(ed,{anlageId:o,zeitraum:n})]})]})}function rd(){return e.jsx(Ga,{children:e.jsx(Ja,{children:e.jsxs(ke,{path:"/",element:e.jsx(Gn,{}),children:[e.jsx(ke,{index:!0,element:e.jsx(He,{to:"/cockpit",replace:!0})}),e.jsx(ke,{path:"cockpit",element:e.jsx(ni,{})}),e.jsx(ke,{path:"cockpit/pv-anlage",element:e.jsx(di,{})}),e.jsx(ke,{path:"cockpit/e-auto",element:e.jsx(ci,{})}),e.jsx(ke,{path:"cockpit/waermepumpe",element:e.jsx(gi,{})}),e.jsx(ke,{path:"cockpit/speicher",element:e.jsx(mi,{})}),e.jsx(ke,{path:"cockpit/wallbox",element:e.jsx(pi,{})}),e.jsx(ke,{path:"cockpit/balkonkraftwerk",element:e.jsx(yi,{})}),e.jsx(ke,{path:"cockpit/sonstiges",element:e.jsx(fi,{})}),e.jsx(ke,{path:"auswertungen",element:e.jsx(Hs,{})}),e.jsx(ke,{path:"auswertungen/roi",element:e.jsx(Di,{})}),e.jsx(ke,{path:"auswertungen/prognose",element:e.jsx(Pi,{})}),e.jsx(ke,{path:"auswertungen/export",element:e.jsx(Hs,{})})," ",e.jsx(ke,{path:"aussichten",element:e.jsx(Ri,{})}),e.jsx(ke,{path:"community",element:e.jsx(td,{})}),e.jsx(ke,{path:"einstellungen/anlage",element:e.jsx(Zi,{})}),e.jsx(ke,{path:"einstellungen/strompreise",element:e.jsx(qi,{})}),e.jsx(ke,{path:"einstellungen/investitionen",element:e.jsx(al,{})}),e.jsx(ke,{path:"einstellungen/monatsdaten",element:e.jsx(gl,{})}),e.jsx(ke,{path:"einstellungen/monatsabschluss",element:e.jsx(ds,{})}),e.jsx(ke,{path:"monatsabschluss/:anlageId",element:e.jsx(ds,{})}),e.jsx(ke,{path:"monatsabschluss/:anlageId/:jahr/:monat",element:e.jsx(ds,{})}),e.jsx(ke,{path:"einstellungen/import",element:e.jsx(ta,{})}),e.jsx(ke,{path:"einstellungen/demo",element:e.jsx(ta,{})})," ",e.jsx(ke,{path:"einstellungen/solarprognose",element:e.jsx(ul,{})}),e.jsx(ke,{path:"einstellungen/pvgis",element:e.jsx(He,{to:"/einstellungen/solarprognose",replace:!0})}),e.jsx(ke,{path:"einstellungen/datenerfassung",element:e.jsx(pl,{})}),e.jsx(ke,{path:"einstellungen/ha-import",element:e.jsx(He,{to:"/einstellungen/datenerfassung",replace:!0})}),e.jsx(ke,{path:"einstellungen/ha-export",element:e.jsx(bl,{})}),e.jsx(ke,{path:"einstellungen/sensor-mapping",element:e.jsx(Wl,{})}),e.jsx(ke,{path:"einstellungen/ha-statistik-import",element:e.jsx(Dl,{})}),e.jsx(ke,{path:"einstellungen/allgemein",element:e.jsx(ml,{})}),e.jsx(ke,{path:"einstellungen/community",element:e.jsx(Il,{})}),e.jsx(ke,{path:"auswertungen/community",element:e.jsx(He,{to:"/community",replace:!0})}),e.jsx(ke,{path:"dashboard",element:e.jsx(He,{to:"/cockpit",replace:!0})}),e.jsx(ke,{path:"anlagen",element:e.jsx(He,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(ke,{path:"monatsdaten",element:e.jsx(He,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(ke,{path:"strompreise",element:e.jsx(He,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(ke,{path:"investitionen",element:e.jsx(He,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(ke,{path:"auswertung",element:e.jsx(He,{to:"/auswertungen",replace:!0})}),e.jsx(ke,{path:"roi",element:e.jsx(He,{to:"/auswertungen/roi",replace:!0})}),e.jsx(ke,{path:"e-auto",element:e.jsx(He,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(ke,{path:"waermepumpe",element:e.jsx(He,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(ke,{path:"speicher",element:e.jsx(He,{to:"/cockpit/speicher",replace:!0})}),e.jsx(ke,{path:"wallbox",element:e.jsx(He,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(ke,{path:"balkonkraftwerk",element:e.jsx(He,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(ke,{path:"sonstiges",element:e.jsx(He,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(ke,{path:"import",element:e.jsx(He,{to:"/einstellungen/import",replace:!0})}),e.jsx(ke,{path:"settings",element:e.jsx(He,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function sd({onNext:r,onLoadDemo:s,onImportComplete:t}){const[n,a]=l.useState(!1),[i,x]=l.useState(null),[c,g]=l.useState(!1),[u,d]=l.useState(null),[p,m]=l.useState(null),o=l.useRef(null),b=async()=>{if(s){a(!0),x(null);try{await s()}catch(k){x(k instanceof Error?k.message:"Fehler beim Laden der Demo-Daten"),a(!1)}}},h=async k=>{var w;const j=(w=k.target.files)==null?void 0:w[0];if(j){g(!0),d(null),m(null);try{const v=await zt.importJSON(j,!1);m(`Anlage "${v.anlage_name}" erfolgreich importiert!`),setTimeout(()=>{t==null||t()},1500)}catch(v){d(v instanceof Error?v.message:"Fehler beim Importieren")}finally{g(!1),o.current&&(o.current.value="")}}},y=()=>{var k;(k=o.current)==null||k.click()};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(ae,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persönliches Energie Effizienz Data Center für die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(hs,{icon:e.jsx(ut,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(hs,{icon:e.jsx(Qt,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen für alle Ihre Energie-Investitionen"}),e.jsx(hs,{icon:e.jsx(_e,{className:"w-6 h-6"}),title:"Prognosen",description:"Wetterbasierte Vorhersagen und PVGIS-Vergleiche"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(Rr,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(Rr,{number:2,text:"Stromtarif konfigurieren (mit Vorschlägen)"}),e.jsx(Rr,{number:3,text:"Wechselrichter und PV-Module erfassen"}),e.jsx(Rr,{number:4,text:"Optional: Speicher, Wärmepumpe, E-Auto hinzufügen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(Ye,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Haben Sie eine JSON-Sicherung? Stellen Sie Ihre Daten wieder her:"}),e.jsx("input",{ref:o,type:"file",accept:".json",onChange:h,className:"hidden"}),e.jsx("button",{onClick:y,disabled:c,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium rounded-xl hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all disabled:opacity-50",children:c?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-5 h-5 animate-spin"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gr,{className:"w-5 h-5"}),"JSON-Backup importieren"]})}),u&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:u}),p&&e.jsx("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:p}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Importiert Anlage, Strompreise, Investitionen, Monatsdaten und Sensor-Mapping"})]}),s&&e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:b,disabled:n,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:n?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_n,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),i&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:i}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enthält 24 Monate Beispieldaten, Wechselrichter, PV-Module, Speicher, Wärmepumpe u.v.m."})]})]})]})}function hs({icon:r,title:s,description:t}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:r}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:s}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]})}function Rr({number:r,text:s}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:r}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:s})]})}function ad({isLoading:r,error:s,onSubmit:t,onGeocode:n,onBack:a}){const[i,x]=l.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:""}),[c,g]=l.useState(null),[u,d]=l.useState(!1),[p,m]=l.useState(!1),o=k=>{const{name:j,value:w}=k.target;x(v=>({...v,[j]:w})),g(null),(j==="standort_plz"||j==="standort_ort")&&m(!1)},b=async()=>{if(!i.standort_plz){g("Bitte geben Sie eine PLZ ein");return}d(!0),g(null),m(!1);try{const k=await n(i.standort_plz,i.standort_ort||void 0);k?(x(j=>({...j,latitude:k.latitude.toFixed(6),longitude:k.longitude.toFixed(6)})),m(!0)):g("Koordinaten konnten nicht ermittelt werden. Bitte prüfen Sie PLZ/Ort.")}catch{g("Fehler beim Ermitteln der Koordinaten")}finally{d(!1)}},h=async k=>{if(k.preventDefault(),g(null),!i.anlagenname.trim()){g("Bitte geben Sie einen Namen für Ihre Anlage ein");return}if(!i.leistung_kwp||parseFloat(i.leistung_kwp)<=0){g("Bitte geben Sie die Anlagenleistung in kWp ein");return}await t({anlagenname:i.anlagenname.trim(),leistung_kwp:parseFloat(i.leistung_kwp),installationsdatum:i.installationsdatum||void 0,standort_plz:i.standort_plz||void 0,standort_ort:i.standort_ort||void 0,latitude:i.latitude?parseFloat(i.latitude):void 0,longitude:i.longitude?parseFloat(i.longitude):void 0})},y=c||s;return e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),y&&e.jsx(Q,{type:"error",className:"mb-6",children:y}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:i.anlagenname,onChange:o,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:i.leistung_kwp,onChange:o,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(it,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:i.installationsdatum,onChange:o,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für korrekten Start der Stromtarif-Gültigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(gt,{className:"w-4 h-4 text-gray-500"}),"Standort (für PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:i.standort_plz,onChange:o,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:i.standort_ort,onChange:o,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:b,disabled:u||!i.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):p?e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(Sa,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:i.latitude,onChange:o,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Längengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:i.longitude,onChange:o,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(qe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden für die PVGIS-Ertragsprognose benötigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:a,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Ye,{className:"w-4 h-4"})]})})]})]})}function nd({anlage:r,isLoading:s,error:t,onSubmit:n,onUseDefaults:a,onBack:i}){const x=r?Da(r.leistung_kwp):qt.einspeiseverguetung_cent_kwh,[c,g]=l.useState({netzbezug_arbeitspreis_cent_kwh:qt.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:x.toString(),grundpreis_euro_monat:qt.grundpreis_euro_monat.toString(),gueltig_ab:(r==null?void 0:r.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[u,d]=l.useState(null),p=b=>{const{name:h,value:y}=b.target;g(k=>({...k,[h]:y})),d(null)},m=async b=>{if(b.preventDefault(),d(null),!c.netzbezug_arbeitspreis_cent_kwh||parseFloat(c.netzbezug_arbeitspreis_cent_kwh)<0){d("Bitte geben Sie einen gültigen Netzbezugspreis ein");return}if(!c.gueltig_ab){d("Bitte geben Sie ein Gültigkeitsdatum ein");return}await n({netzbezug_arbeitspreis_cent_kwh:parseFloat(c.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(c.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:c.grundpreis_euro_monat?parseFloat(c.grundpreis_euro_monat):void 0,gueltig_ab:c.gueltig_ab,tarifname:c.tarifname||void 0,anbieter:c.anbieter||void 0})},o=u||t;return e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Für korrekte Wirtschaftlichkeitsberechnungen"})]})]}),o&&e.jsx(Q,{type:"error",className:"mb-6",children:o}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:a,disabled:s,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(lr,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[qt.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",x," ct Einspeisung |"," ",qt.grundpreis_euro_monat," € Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:c.netzbezug_arbeitspreis_cent_kwh,onChange:p,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergütung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:c.einspeiseverguetung_cent_kwh,onChange:p,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r&&r.leistung_kwp<=10?"≤10 kWp: 8,2 ct":r&&r.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (€/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:c.grundpreis_euro_monat,onChange:p,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gültig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:c.gueltig_ab,onChange:p,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:c.tarifname,onChange:p,placeholder:"z.B. Ökostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:c.anbieter,onChange:p,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(qe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können später weitere Stromtarife mit unterschiedlichen Gültigkeitszeiträumen hinzufügen, z.B. bei Tarifwechsel oder Preisänderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:s,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:s?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Ye,{className:"w-4 h-4"})]})})]})]})}function wr(r){switch(r){case"e-auto":return e.jsx(Ae,{className:"w-5 h-5"});case"speicher":return e.jsx(ze,{className:"w-5 h-5"});case"wallbox":return e.jsx(pt,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(ys,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(Ke,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(ae,{className:"w-5 h-5"});default:return e.jsx(za,{className:"w-5 h-5"})}}function id({investition:r,allInvestitionen:s,anlage:t,onUpdate:n,onDelete:a,isNew:i=!1}){const[x,c]=l.useState(!0);l.useEffect(()=>{i&&c(!0)},[i]);const[g,u]=l.useState(!1),d=ri[r.typ],p=d?s.filter(h=>h.typ===d&&h.id!==r.id):[],m=h=>{var y;return(y=r.parameter)==null?void 0:y[h]},o=h=>{var y;return((y=r.parameter)==null?void 0:y[h])===!0},b=(h,y)=>{n({parameter:{...r.parameter,[h]:y}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>c(!x),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:wr(r.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:r.bezeichnung||Nt[r.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Nt[r.typ],r.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:["• ",r.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]})]}),x?e.jsx($t,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(vt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),x&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:r.bezeichnung,onChange:h=>n({bezeichnung:h.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:r.anschaffungsdatum||"",onChange:h=>n({anschaffungsdatum:h.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (€) *"}),e.jsx("input",{type:"number",value:r.anschaffungskosten_gesamt??"",onChange:h=>n({anschaffungskosten_gesamt:parseFloat(h.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),d&&e.jsx("div",{children:(()=>{const h=si.includes(r.typ),y=p.length>0,k=h&&!r.parent_investition_id&&y;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",Nt[d],")",h?" *":" (optional)"]}),y?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:r.parent_investition_id||"",onChange:j=>n({parent_investition_id:j.target.value?parseInt(j.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${k?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:h?"-- Bitte wählen --":"-- Keine Zuordnung --"}),p.map(j=>e.jsx("option",{value:j.id,children:j.bezeichnung},j.id))]}),k&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),"PV-Module müssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 flex-shrink-0"}),h?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen können."]}):e.jsxs("span",{children:["Kein ",Nt[d]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),r.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW) *"}),e.jsx("input",{type:"number",value:m("leistung_kw")??"",onChange:h=>b("leistung_kw",parseFloat(h.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),r.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:r.leistung_kwp??"",onChange:h=>n({leistung_kwp:parseFloat(h.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:r.ausrichtung||(t==null?void 0:t.ausrichtung)||"",onChange:h=>n({ausrichtung:h.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:r.neigung_grad??(t==null?void 0:t.neigung_grad)??"",onChange:h=>n({neigung_grad:parseFloat(h.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),r.typ==="speicher"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazität (kWh) *"}),e.jsx("input",{type:"number",value:m("kapazitaet_kwh")??"",onChange:h=>b("kapazitaet_kwh",parseFloat(h.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o("arbitrage"),onChange:h=>b("arbitrage",h.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Arbitrage"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Netzstrom günstig laden, teuer einspeisen"})]})]})})]}),r.typ==="wallbox"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW) *"}),e.jsx("input",{type:"number",value:m("leistung_kw")??"",onChange:h=>b("leistung_kw",parseFloat(h.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o("v2h"),onChange:h=>b("v2h",h.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-fähig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Bidirektionales Laden (Vehicle-to-Home)"})]})]})})]}),r.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazität (kWh) *"}),e.jsx("input",{type:"number",value:m("batterie_kwh")??"",onChange:h=>b("batterie_kwh",parseFloat(h.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km) *"}),e.jsx("input",{type:"number",value:m("verbrauch_kwh_100km")??"",onChange:h=>b("verbrauch_kwh_100km",parseFloat(h.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"md:col-span-2 flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o("v2h"),onChange:h=>b("v2h",h.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-fähig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Fahrzeug kann Strom ans Haus abgeben (Vehicle-to-Home)"})]})]})})]}),r.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW) *"}),e.jsx("input",{type:"number",value:m("leistung_kw")??"",onChange:h=>b("leistung_kw",parseFloat(h.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl) *"}),e.jsx("input",{type:"number",value:m("cop")??"3.5",onChange:h=>b("cop",parseFloat(h.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),r.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung pro Modul (Wp) *"}),e.jsx("input",{type:"number",value:m("leistung_wp")??"",onChange:h=>b("leistung_wp",parseFloat(h.target.value)||void 0),placeholder:"z.B. 400",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module *"}),e.jsx("input",{type:"number",value:m("anzahl")??"",onChange:h=>b("anzahl",parseInt(h.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:m("ausrichtung")||"",onChange:h=>b("ausrichtung",h.target.value||void 0),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:m("neigung_grad")??"",onChange:h=>b("neigung_grad",parseFloat(h.target.value)||void 0),placeholder:"z.B. 30",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"0° = flach, 90° = senkrecht (Balkon)"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o("hat_speicher"),onChange:h=>b("hat_speicher",h.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mit Speicher"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"z.B. Anker SOLIX, Zendure, EcoFlow"})]})]}),o("hat_speicher")&&e.jsxs("div",{className:"mt-3 ml-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Speicher-Kapazität (Wh) *"}),e.jsx("input",{type:"number",value:m("speicher_kapazitaet_wh")??"",onChange:h=>b("speicher_kapazitaet_wh",parseFloat(h.target.value)||void 0),placeholder:"z.B. 1600",min:"0",step:"100",className:"w-full max-w-xs px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"z.B. 1600 Wh für Anker SOLIX"})]})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:g?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich löschen?"}),e.jsx("button",{type:"button",onClick:()=>{a(),u(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, löschen"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(ht,{className:"w-4 h-4"}),"Investition löschen"]})})]})]})}function xa({onAdd:r}){const[s,t]=l.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>t(!s),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Dt,{className:"w-5 h-5"}),"Investition hinzufügen"]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>t(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:La.map(n=>e.jsxs("button",{type:"button",onClick:()=>{r(n),t(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:wr(n)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:Nt[n]})]},n))})]})]})}function ld({investitionen:r,anlage:s,isLoading:t,error:n,onUpdateInvestition:a,onDeleteInvestition:i,onAddInvestition:x,onCreateDefaultPVSystem:c,onNext:g,onBack:u}){const[d,p]=l.useState(null),[m,o]=l.useState(null),b=l.useRef(null);l.useEffect(()=>{if(m&&b.current){b.current.scrollIntoView({behavior:"smooth",block:"center"});const k=setTimeout(()=>o(null),2e3);return()=>clearTimeout(k)}},[m]);const h=La.reduce((k,j)=>{const w=r.filter(v=>v.typ===j);return w.length>0&&k.push({typ:j,items:w}),k},[]),y=async k=>{p(k);try{const j=await x(k);j!=null&&j.id&&o(j.id)}finally{p(null)}};return r.length===0&&!t?e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"PV-System einrichten"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:"Erfassen Sie Ihre PV-Komponenten für die Ertragsanalyse und ROI-Berechnung."})]}),c&&e.jsx("div",{className:"mb-8",children:e.jsx("button",{type:"button",onClick:c,disabled:t,className:"w-full p-6 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-amber-200 dark:border-amber-800 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-all group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-amber-500 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform",children:e.jsx(ae,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg",children:"PV-System anlegen (empfohlen)"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Erstellt automatisch Wechselrichter + PV-Module mit ",(s==null?void 0:s.leistung_kwp)||0," kWp"]})]}),e.jsx(Ye,{className:"w-5 h-5 text-amber-500 group-hover:translate-x-1 transition-transform"})]})})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder einzeln hinzufügen"})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-6",children:["balkonkraftwerk","speicher","wallbox","waermepumpe","e-auto"].map(k=>e.jsxs("button",{type:"button",onClick:()=>y(k),disabled:d!==null,className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10 transition-all text-center",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-600 dark:text-gray-400",children:wr(k)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:Nt[k]})]},k))}),e.jsx("div",{className:"text-center",children:e.jsx(xa,{onAdd:y})}),d&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400 text-center",children:["Füge ",Nt[d]," hinzu..."]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-6 py-2.5 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:["Überspringen",e.jsx(Ye,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollständigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergänzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden für die ROI-Berechnung benötigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.length," Investition",r.length!==1?"en":""]})]}),n&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:n})]}),t&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!t&&e.jsxs("div",{className:"space-y-6",children:[h.map(({typ:k,items:j})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:wr(k)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[Nt[k]," (",j.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:j.map(w=>e.jsx("div",{ref:w.id===m?b:void 0,className:`transition-all duration-500 ${w.id===m?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(id,{investition:w,allInvestitionen:r,anlage:s,onUpdate:v=>a(w.id,v),onDelete:()=>i(w.id),isNew:w.id===m})},w.id))})]},k)),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4 text-amber-500"}),"Weitere Komponenten hinzufügen"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:["speicher","wallbox","waermepumpe","e-auto","balkonkraftwerk"].map(k=>{const j=r.some(w=>w.typ===k);return e.jsxs("button",{type:"button",onClick:()=>y(k),disabled:d!==null,className:`p-3 border rounded-xl transition-all text-center ${j?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10"}`,children:[e.jsx("div",{className:`w-8 h-8 mx-auto mb-1 rounded-lg flex items-center justify-center ${j?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:wr(k)}),e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[Nt[k],j&&" ✓"]})]},k)})}),e.jsx(xa,{onAdd:y}),d&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",Nt[d]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(qe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig für die Amortisationsberechnung. Sie können alle Angaben später jederzeit unter Einstellungen → Investitionen ändern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:g,disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(Ye,{className:"w-4 h-4"})]})]})]})}function dd(r){switch(r){case"e-auto":return e.jsx(Ae,{className:"w-4 h-4"});case"speicher":return e.jsx(ze,{className:"w-4 h-4"});case"wallbox":return e.jsx(pt,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(ys,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(Ke,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(ae,{className:"w-4 h-4"});default:return e.jsx(za,{className:"w-4 h-4"})}}function cd({anlage:r,strompreis:s,investitionen:t,pvgisPrognose:n,pvgisError:a,canFetchPvgis:i,isLoading:x,onFetchPvgis:c,onComplete:g,onBack:u}){const[d,p]=l.useState(!1),m=!!r,o=!!s,b=t.length>0,h=!!n,y=t.reduce((j,w)=>j+(w.anschaffungskosten_gesamt||0),0),k=async()=>{p(!0);try{await c()}finally{p(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(At,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschließen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Überprüfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Hr,{icon:e.jsx(ae,{className:"w-5 h-5"}),title:"PV-Anlage",status:m?"success":"warning",children:m?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.leistung_kwp," kWp",r.standort_ort&&` • ${r.standort_ort}`,r.latitude&&r.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(Hr,{icon:e.jsx(ye,{className:"w-5 h-5"}),title:"Stromtarif",status:o?"success":"warning",children:o?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:s.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:s.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),s.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.tarifname,s.anbieter&&` (${s.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollständig"})}),e.jsx(Hr,{icon:e.jsx(ys,{className:"w-5 h-5"}),title:"Investitionen",status:b?"success":"neutral",children:b?e.jsxs("div",{className:"space-y-2",children:[t.slice(0,5).map(j=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:dd(j.typ)}),e.jsx("span",{className:"truncate",children:j.bezeichnung}),j.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[j.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]},j.id)),t.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",t.length-5," weitere"]}),y>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",y.toLocaleString("de-DE")," €"]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - können später hinzugefügt werden"})}),e.jsx(Hr,{icon:e.jsx(Ls,{className:"w-5 h-5"}),title:"PVGIS Ertragsprognose",status:h?"success":i?"neutral":"warning",children:h?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(n.jahresertrag_kwh).toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp",e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(PVGIS-Daten gespeichert)"})]})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ertragsprognose von PVGIS abrufen für SOLL-IST Vergleiche"}),a&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm",children:a}),e.jsx("button",{type:"button",onClick:k,disabled:d||x,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50",children:d?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 animate-spin"}),"Rufe PVGIS ab..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ls,{className:"w-4 h-4"}),"PVGIS-Prognose abrufen"]})})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400 text-sm",children:!(r!=null&&r.latitude)||!(r!=null&&r.longitude)?"Koordinaten fehlen - bitte Standort mit PLZ ermitteln":"PV-Module fehlen - bitte unter Komponenten anlegen"})})]}),e.jsx(od,{hasPvgis:h,investitionen:t})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:u,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(Nr,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Weiter zur Datenerfassung"]})]})]})}function Hr({icon:r,title:s,status:t,children:n}){const a={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${a[t]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[t]}`,children:r}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:s}),t==="success"&&e.jsx(At,{className:"w-4 h-4 text-green-500"}),t==="warning"&&e.jsx(Ge,{className:"w-4 h-4 text-amber-500"})]}),n]})]})})}function od({hasPvgis:r,investitionen:s}){const t=s.some(a=>a.typ==="wechselrichter"),n=s.some(a=>a.typ==="pv-module");return e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-blue-500"}),"Wie geht es weiter?"]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Yt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Zählerstände (Einspeisung, Netzbezug) und Verbrauchsdaten der Komponenten. Sie können die Daten manuell eingeben oder eine CSV-Datei importieren."})]})]})}),(!n||!t)&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," ",!n&&!t?"Wechselrichter und PV-Module fehlen noch.":n?"Wechselrichter fehlt noch.":"PV-Module fehlen noch."," Diese können Sie jederzeit unter Einstellungen → Investitionen ergänzen."]})}),!r&&n&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Tipp:"})," Rufen Sie oben die PVGIS-Prognose ab, um später SOLL-IST Vergleiche Ihrer PV-Erträge zu sehen."]})})]})}function gd({anlage:r,onGoToDashboard:s}){const t=()=>{s(),setTimeout(()=>{window.location.href="/einstellungen/monatsdaten"},100)};return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(ae,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(Nn,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:r?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',r.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6 mb-8 max-w-md mx-auto text-left border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Yt,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"Nächster Schritt: Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Zählerstände (Einspeisung, Netzbezug) und Verbrauchsdaten. Die Daten können manuell eingegeben oder per CSV importiert werden."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Monatsdaten erfassen"]}),e.jsxs("button",{onClick:s,className:"inline-flex items-center justify-center gap-3 px-6 py-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(fs,{className:"w-5 h-5"}),"Zum Cockpit"]})]})]})}const nr=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"investitionen",label:"Komponenten",shortLabel:"Komp."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function hd({onComplete:r}){var x;const s=ai(),t=async()=>{await zt.createDemoData(),r()},n=()=>{r()};l.useEffect(()=>{if(s.step==="complete"){const c=setTimeout(r,100);return()=>clearTimeout(c)}},[s.step,r]);const a=nr.findIndex(c=>c.key===s.step),i=s.step!=="welcome"&&s.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:Ca,alt:"eedc",className:"w-10 h-10"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),i&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",a+1," von ",nr.length]})]})})}),i&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:nr.map((c,g)=>{const u=g<a,d=g===a;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${u?"bg-green-500 text-white":d?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:u?e.jsx(At,{className:"w-5 h-5"}):g+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${d?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:c.label})]}),g<nr.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${u?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},c.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(x=nr[a])==null?void 0:x.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a+1,"/",nr.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${s.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[s.step==="welcome"&&e.jsx(sd,{onNext:s.nextStep,onLoadDemo:t,onImportComplete:n}),s.step==="anlage"&&e.jsx(ad,{isLoading:s.isLoading,error:s.error,onSubmit:s.createAnlage,onGeocode:s.geocodeAddress,onBack:s.prevStep}),s.step==="strompreise"&&e.jsx(nd,{anlage:s.anlage,isLoading:s.isLoading,error:s.error,onSubmit:s.createStrompreis,onUseDefaults:s.useDefaultStrompreise,onBack:s.prevStep}),s.step==="investitionen"&&e.jsx(ld,{investitionen:s.investitionen,anlage:s.anlage,isLoading:s.isLoading,error:s.error,onUpdateInvestition:s.updateInvestition,onDeleteInvestition:s.deleteInvestition,onAddInvestition:s.addInvestition,onCreateDefaultPVSystem:s.createDefaultPVSystem,onNext:s.nextStep,onBack:s.prevStep}),s.step==="summary"&&e.jsx(cd,{anlage:s.anlage,strompreis:s.strompreis,investitionen:s.investitionen,pvgisPrognose:s.pvgisPrognose,pvgisError:s.pvgisError,canFetchPvgis:s.canFetchPvgis,isLoading:s.isLoading,onFetchPvgis:s.fetchPvgisPrognose,onComplete:s.completeWizard,onBack:s.prevStep}),s.step==="complete"&&e.jsx(gd,{anlage:s.anlage,onGoToDashboard:r})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc – Energie Effizienz Data Center"})]})}const xs="eedc_setup_wizard_completed";function xd({children:r}){const[s,t]=l.useState(!0),[n,a]=l.useState(!1);l.useEffect(()=>{i()},[]);const i=async()=>{try{(await dt.list()).length===0?(localStorage.removeItem(xs),localStorage.removeItem("eedc_setup_wizard_state"),a(!0)):(localStorage.setItem(xs,"true"),a(!1))}catch(c){console.error("Fehler beim Prüfen des Setup-Status:",c),a(!1)}finally{t(!1)}},x=()=>{localStorage.setItem(xs,"true"),a(!1)};return s?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):n?e.jsx(hd,{onComplete:x}):e.jsx(e.Fragment,{children:r})}us.createRoot(document.getElementById("root")).render(e.jsx(Za.StrictMode,{children:e.jsx($n,{children:e.jsx(xd,{children:e.jsx(rd,{})})})}));
