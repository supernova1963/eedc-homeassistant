var Pa=Object.defineProperty;var $a=(t,a,r)=>a in t?Pa(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;var ta=(t,a,r)=>$a(t,typeof a!="symbol"?a+"":a,r);import{r as c,a as La,u as ja,N as Vt,O as Va,b as Nt,H as Ba,d as Oa,e as U,f as pe,R as Ka}from"./vendor-DpDmk0XN.js";import{R as X,B as xe,C as ne,X as le,Y as ae,T as Q,L as Ee,a as Y,P as xt,b as ht,c as Ae,A as ka,d as Bt,e as Ht,f as dt,g as Ta,h as Ha}from"./charts-YF2YIZHt.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();var fa={exports:{}},_t={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ga=c,Ra=Symbol.for("react.element"),Ja=Symbol.for("react.fragment"),qa=Object.prototype.hasOwnProperty,Za=Ga.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ua={key:!0,ref:!0,__self:!0,__source:!0};function va(t,a,r){var n,s={},i=null,o=null;r!==void 0&&(i=""+r),a.key!==void 0&&(i=""+a.key),a.ref!==void 0&&(o=a.ref);for(n in a)qa.call(a,n)&&!Ua.hasOwnProperty(n)&&(s[n]=a[n]);if(t&&t.defaultProps)for(n in a=t.defaultProps,a)s[n]===void 0&&(s[n]=a[n]);return{$$typeof:Ra,type:t,key:i,ref:o,props:s,_owner:Za.current}}_t.Fragment=Ja;_t.jsx=va;_t.jsxs=va;fa.exports=_t;var e=fa.exports,Ot={},aa=La;Ot.createRoot=aa.createRoot,Ot.hydrateRoot=aa.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ya={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),D=(t,a)=>{const r=c.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:d="",children:l,...x},g)=>c.createElement("svg",{ref:g,...Ya,width:s,height:s,stroke:n,strokeWidth:o?Number(i)*24/Number(s):i,className:["lucide",`lucide-${Xa(t)}`,d].join(" "),...x},[...a.map(([m,h])=>c.createElement(m,h)),...Array.isArray(l)?l:[l]]));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=D("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=D("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=D("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=D("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=D("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=D("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=D("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=D("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=D("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=D("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=D("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=D("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=D("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=D("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=D("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=D("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=D("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=D("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=D("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=D("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=D("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=D("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=D("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=D("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=D("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=D("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=D("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=D("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=D("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=D("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=D("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=D("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=D("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=D("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=D("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=D("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=D("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=D("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=D("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=D("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=D("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=D("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=D("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=D("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=D("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=D("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=D("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=D("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=D("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=D("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=D("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=D("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=D("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=D("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=D("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=D("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=D("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=D("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=D("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=D("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=D("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ea=c.createContext(void 0);function br({children:t}){const[a,r]=c.useState(()=>localStorage.getItem("eedc-theme")||"system"),[n,s]=c.useState(!1);return c.useEffect(()=>{localStorage.setItem("eedc-theme",a);const i=window.document.documentElement;if(a==="system"){const o=window.matchMedia("(prefers-color-scheme: dark)").matches;s(o),i.classList.toggle("dark",o)}else s(a==="dark"),i.classList.toggle("dark",a==="dark")},[a]),c.useEffect(()=>{if(a!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),o=d=>{s(d.matches),document.documentElement.classList.toggle("dark",d.matches)};return i.addEventListener("change",o),()=>i.removeEventListener("change",o)},[a]),e.jsx(Ea.Provider,{value:{theme:a,setTheme:r,isDark:n},children:t})}function Ca(){const t=c.useContext(Ea);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const yr=[{name:"Cockpit",basePath:"/cockpit"},{name:"Auswertungen",basePath:"/auswertungen"}],jr=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Import",href:"/einstellungen/import"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"PVGIS",href:"/einstellungen/pvgis"},{name:"HA Integration",href:"/einstellungen/ha-integration"},{name:"Allgemein",href:"/einstellungen/allgemein"}]}];function kr(){const{theme:t,setTheme:a}=Ca(),r=ja(),[n,s]=c.useState(!1),i=c.useRef(null),d=r.pathname.startsWith("/cockpit")?"Cockpit":r.pathname.startsWith("/auswertungen")?"Auswertungen":r.pathname.startsWith("/einstellungen")?null:"Cockpit";c.useEffect(()=>{const g=m=>{i.current&&!i.current.contains(m.target)&&s(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const l=()=>{a(t==="light"?"dark":t==="dark"?"system":"light")},x=g=>r.pathname===g;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"h-8 w-8 text-yellow-500",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"EEDC"})]}),e.jsx("nav",{className:"ml-10 flex space-x-1",children:yr.map(g=>e.jsx(Vt,{to:g.basePath,className:()=>`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${d===g.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:g.name},g.name))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(ie,{className:"h-5 w-5"}),t==="dark"&&e.jsx(Sa,{className:"h-5 w-5"}),t==="system"&&e.jsx(_a,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>s(!n),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${r.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(hr,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(ar,{className:`h-4 w-4 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:jr.map((g,m)=>e.jsxs("div",{children:[m>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:g.category})}),g.items.map(h=>e.jsx(Vt,{to:h.href,onClick:()=>s(!1),className:`block px-4 py-2 text-sm transition-colors ${x(h.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:h.name},h.href))]},g.category))})]})]})]})})})}const fr=[{name:"Übersicht",href:"/cockpit",icon:cr,exact:!0},{name:"E-Auto",href:"/cockpit/e-auto",icon:fe},{name:"Wärmepumpe",href:"/cockpit/waermepumpe",icon:Pe},{name:"Speicher",href:"/cockpit/speicher",icon:me},{name:"Wallbox",href:"/cockpit/wallbox",icon:De}],vr=[{name:"Jahresvergleich",href:"/auswertungen",icon:wa,exact:!0},{name:"ROI-Analyse",href:"/auswertungen/roi",icon:Ne},{name:"Prognose vs. IST",href:"/auswertungen/prognose",icon:Ne},{name:"PDF-Export",href:"/auswertungen/export",icon:ir}];function wr(){const t=ja(),r=t.pathname.startsWith("/cockpit")?fr:t.pathname.startsWith("/auswertungen")?vr:null;return r?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:r.map(n=>e.jsxs(Vt,{to:n.href,end:n.exact,className:({isActive:s})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${s?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(n.icon,{className:"h-4 w-4"}),n.name]},n.href))})})}):null}function Nr(){return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[e.jsx(kr,{}),e.jsx(wr,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(Va,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"EEDC v0.1.0 – Energie Effizienz Data Center"})})]})}const $=c.forwardRef(({className:t="",variant:a="primary",size:r="md",loading:n,disabled:s,children:i,...o},d)=>{const l="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",x={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},g={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:d,className:`${l} ${x[a]} ${g[r]} ${t}`,disabled:s||n,...o,children:[n&&e.jsx(Rt,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});$.displayName="Button";const P=c.forwardRef(({className:t="",label:a,error:r,hint:n,id:s,...i},o)=>{const d=s||i.name;return e.jsxs("div",{className:"w-full",children:[a&&e.jsxs("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:o,id:d,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${r?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...i}),n&&!r&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n}),r&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r})]})});P.displayName="Input";const _e=c.forwardRef(({className:t="",label:a,error:r,options:n,placeholder:s,id:i,...o},d)=>{const l=i||o.name;return e.jsxs("div",{className:"w-full",children:[a&&e.jsxs("label",{htmlFor:l,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a,o.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:d,id:l,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${r?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...o,children:[s&&e.jsx("option",{value:"",children:s}),n.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]}),r&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r})]})});_e.displayName="Select";function ke({isOpen:t,onClose:a,title:r,children:n,size:s="md"}){if(c.useEffect(()=>{const o=d=>{d.key==="Escape"&&a()};return t&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}},[t,a]),!t)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:a}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[s]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r}),e.jsx("button",{onClick:a,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Zt,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:n})]})})]})}function I({children:t,className:a="",padding:r="md"}){const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${n[r]}
        ${a}
      `,children:t})}function J({type:t,title:a,children:r,onClose:n,className:s=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:Fe},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:Me},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:Ke},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:gt}},{bg:o,border:d,text:l,icon:x}=i[t];return e.jsx("div",{className:`${o} ${d} border rounded-lg p-4 relative ${s}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(x,{className:`w-5 h-5 ${l} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[a&&e.jsx("h4",{className:`text-sm font-medium ${l}`,children:a}),e.jsx("div",{className:`text-sm ${l} ${a?"mt-1":""}`,children:r})]}),n&&e.jsx("button",{onClick:n,className:`ml-3 ${l} hover:opacity-70 transition-opacity`,children:e.jsx(Zt,{className:"w-4 h-4"})})]})})}function Ut({children:t,className:a=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${a}`,children:t})})}function Yt({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function Xt({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function et({children:t,onClick:a,className:r=""}){return e.jsx("tr",{className:`${a?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${r}`,onClick:a,children:t})}function ce({children:t,className:a=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${a}`,children:t})}function oe({children:t,className:a=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${a}`,children:t})}function tt({icon:t,title:a,description:r,action:n}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:a}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:r}),n&&e.jsx("div",{children:n})]})}function re({size:t="md",text:a}){const r={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Rt,{className:`${r[t]} text-primary-600 animate-spin`}),a&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:a})]})}function Ct({children:t,formel:a,berechnung:r,ergebnis:n,className:s="",showIcon:i=!0}){const[o,d]=c.useState(!1),[l,x]=c.useState("top"),g=c.useRef(null);return c.useEffect(()=>{if(o&&g.current){const m=g.current.getBoundingClientRect();x(m.top<120?"bottom":"top")}},[o]),e.jsxs("span",{ref:g,className:`relative inline-block cursor-help ${s}`,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[t,i&&e.jsx(Fe,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),o&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${l==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${l==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:a}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:r})]}),n&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:n})]})]})]})}function T(t,a=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:a,maximumFractionDigits:a})}const _r={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function ge({title:t,value:a,unit:r,subtitle:n,icon:s,color:i="blue",trend:o,formel:d,berechnung:l,ergebnis:x}){const g=_r[i],m=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof a=="number"?a.toLocaleString("de-DE"):a,r&&e.jsx("span",{className:"text-sm font-normal ml-1",children:r}),o==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"↑"}),o==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"↓"})]});return e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:d?e.jsx(Ct,{formel:d,berechnung:l,ergebnis:x,children:m}):m}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${g.bg} ml-3 flex-shrink-0`,children:e.jsx(s,{className:`h-6 w-6 ${g.icon}`})})]})})}const Sr="./api";class zr{constructor(a=Sr){ta(this,"baseUrl");this.baseUrl=a}async request(a,r={}){const n=`${this.baseUrl}${a}`,s={headers:{"Content-Type":"application/json",...r.headers},...r},i=await fetch(n,s);if(!i.ok){const o={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const d=await i.json();o.detail=d.detail||o.detail}catch{}throw o}if(i.status!==204)return i.json()}async get(a){return this.request(a,{method:"GET"})}async post(a,r){return this.request(a,{method:"POST",body:r?JSON.stringify(r):void 0})}async put(a,r){return this.request(a,{method:"PUT",body:JSON.stringify(r)})}async delete(a){return this.request(a,{method:"DELETE"})}async upload(a,r,n="file"){const s=new FormData;return s.append(n,r),this.request(a,{method:"POST",headers:{},body:s})}}const B=new zr,Ie={async list(){return B.get("/anlagen/")},async get(t){return B.get(`/anlagen/${t}`)},async create(t){return B.post("/anlagen/",t)},async update(t,a){return B.put(`/anlagen/${t}`,a)},async delete(t){return B.delete(`/anlagen/${t}`)}},it={async list(t,a){const r=new URLSearchParams;t&&r.append("anlage_id",t.toString()),a&&r.append("jahr",a.toString());const n=r.toString();return B.get(`/monatsdaten/${n?"?"+n:""}`)},async get(t){return B.get(`/monatsdaten/${t}`)},async create(t){return B.post("/monatsdaten/",t)},async update(t,a){return B.put(`/monatsdaten/${t}`,a)},async delete(t){return B.delete(`/monatsdaten/${t}`)}},ve={async getTypen(){return B.get("/investitionen/typen")},async list(t,a,r){const n=new URLSearchParams;t&&n.append("anlage_id",t.toString()),a&&n.append("typ",a),r!==void 0&&n.append("aktiv",r.toString());const s=n.toString();return B.get(`/investitionen/${s?"?"+s:""}`)},async get(t){return B.get(`/investitionen/${t}`)},async create(t){return B.post("/investitionen/",t)},async update(t,a){return B.put(`/investitionen/${t}`,a)},async delete(t){return B.delete(`/investitionen/${t}`)},async getROIDashboard(t,a,r,n){const s=new URLSearchParams;a&&s.append("strompreis_cent",a.toString()),r&&s.append("einspeiseverguetung_cent",r.toString()),n&&s.append("benzinpreis_euro",n.toString());const i=s.toString();return B.get(`/investitionen/roi/${t}${i?"?"+i:""}`)},async getEAutoDashboard(t,a,r){const n=new URLSearchParams;a&&n.append("strompreis_cent",a.toString()),r&&n.append("benzinpreis_euro",r.toString());const s=n.toString();return B.get(`/investitionen/dashboard/e-auto/${t}${s?"?"+s:""}`)},async getWaermepumpeDashboard(t,a){const r=new URLSearchParams;a&&r.append("strompreis_cent",a.toString());const n=r.toString();return B.get(`/investitionen/dashboard/waermepumpe/${t}${n?"?"+n:""}`)},async getSpeicherDashboard(t,a,r){const n=new URLSearchParams;a&&n.append("strompreis_cent",a.toString()),r&&n.append("einspeiseverguetung_cent",r.toString());const s=n.toString();return B.get(`/investitionen/dashboard/speicher/${t}${s?"?"+s:""}`)},async getWallboxDashboard(t){return B.get(`/investitionen/dashboard/wallbox/${t}`)}},Ze={async list(t,a){const r=new URLSearchParams;t&&r.append("anlage_id",t.toString()),a&&r.append("aktuell","true");const n=r.toString();return B.get(`/strompreise/${n?"?"+n:""}`)},async getAktuell(t){return B.get(`/strompreise/aktuell/${t}`)},async get(t){return B.get(`/strompreise/${t}`)},async create(t){return B.post("/strompreise/",t)},async update(t,a){return B.put(`/strompreise/${t}`,a)},async delete(t){return B.delete(`/strompreise/${t}`)}},Je="./api",at={async getTemplateInfo(t){const a=await fetch(`${Je}/import/template/${t}`);if(!a.ok)throw new Error("Fehler beim Laden des Templates");return a.json()},getTemplateDownloadUrl(t){return`${Je}/import/template/${t}/download`},async importCSV(t,a,r=!1){const n=new FormData;n.append("file",a);const s=new URLSearchParams;r&&s.append("ueberschreiben","true");const i=await fetch(`${Je}/import/csv/${t}?${s.toString()}`,{method:"POST",body:n});if(!i.ok){const o=await i.json();throw new Error(o.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(t,a){const r=new URLSearchParams;a&&r.append("jahr",a.toString());const n=r.toString();return`${Je}/import/export/${t}${n?"?"+n:""}`},async createDemoData(){const t=await fetch(`${Je}/import/demo`,{method:"POST"});if(!t.ok){const a=await t.json();throw new Error(a.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${Je}/import/demo`,{method:"DELETE"});if(!t.ok){const a=await t.json();throw new Error(a.detail||"Demo-Daten konnten nicht gelöscht werden")}return t.json()}},sa={async health(){return B.get("/health")},async getSettings(){return B.get("/settings")},async getStats(){return B.get("/stats")}},Ce={async getPrognose(t,a={}){const r=new URLSearchParams;a.system_losses!==void 0&&r.set("system_losses",a.system_losses.toString());const n=r.toString();return B.get(`/pvgis/prognose/${t}${n?`?${n}`:""}`)},async getModulPrognose(t,a={}){const r=new URLSearchParams;a.system_losses!==void 0&&r.set("system_losses",a.system_losses.toString());const n=r.toString();return B.get(`/pvgis/modul/${t}${n?`?${n}`:""}`)},async speicherePrognose(t,a={}){const r=new URLSearchParams;a.system_losses!==void 0&&r.set("system_losses",a.system_losses.toString());const n=r.toString();return B.post(`/pvgis/prognose/${t}/speichern${n?`?${n}`:""}`)},async listeGespeichertePrognosen(t){return B.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return B.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return B.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return B.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return B.get(`/pvgis/optimum/${t}`)}},$e={async getStatus(){return B.get("/ha/status")},async getSensors(){return B.get("/ha/sensors")},async getStringSensors(){return B.get("/ha/string-sensors")},async getStringMonatsdaten(t,a){const r=a?`?jahr=${a}`:"";return B.get(`/ha/string-monatsdaten/${t}${r}`)},async createStringMonatsdaten(t){return B.post("/ha/string-monatsdaten",t)},async deleteStringMonatsdaten(t){return B.delete(`/ha/string-monatsdaten/${t}`)},async getImportPreview(t,a){return B.get(`/ha/import/preview/${t}?jahr=${a}`)},async importMonatsdaten(t,a,r,n=!1){return B.post("/ha/import/monatsdaten",{anlage_id:t,jahr:a,monat:r||null,ueberschreiben:n})},async getMonthlyStatistics(t,a,r=1,n,s){return B.post("/ha/statistics/monthly",{statistic_id:t,start_jahr:a,start_monat:r,end_jahr:n,end_monat:s})},async discover(t,a){const r=new URLSearchParams;t&&r.append("anlage_id",t.toString()),a&&r.append("manufacturer",a);const n=r.toString();return B.get(`/ha/discover${n?"?"+n:""}`)}};function je(){const[t,a]=c.useState([]),[r,n]=c.useState(!0),[s,i]=c.useState(null),o=c.useCallback(async()=>{try{n(!0),i(null);const g=await Ie.list();a(g)}catch(g){i(g instanceof Error?g.message:"Fehler beim Laden der Anlagen")}finally{n(!1)}},[]);c.useEffect(()=>{o()},[o]);const d=c.useCallback(async g=>{const m=await Ie.create(g);return a(h=>[...h,m]),m},[]),l=c.useCallback(async(g,m)=>{const h=await Ie.update(g,m);return a(p=>p.map(f=>f.id===g?h:f)),h},[]),x=c.useCallback(async g=>{await Ie.delete(g),a(m=>m.filter(h=>h.id!==g))},[]);return{anlagen:t,loading:r,error:s,refresh:o,createAnlage:d,updateAnlage:l,deleteAnlage:x}}function Qt(t,a){const[r,n]=c.useState([]),[s,i]=c.useState(!0),[o,d]=c.useState(null),l=c.useCallback(async()=>{try{i(!0),d(null);const h=await it.list(t,a);n(h)}catch(h){d(h instanceof Error?h.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[t,a]);c.useEffect(()=>{l()},[l]);const x=c.useCallback(async h=>{const p=await it.create(h);return n(f=>[p,...f]),p},[]),g=c.useCallback(async(h,p)=>{const f=await it.update(h,p);return n(j=>j.map(_=>_.id===h?f:_)),f},[]),m=c.useCallback(async h=>{await it.delete(h),n(p=>p.filter(f=>f.id!==h))},[]);return{monatsdaten:r,loading:s,error:o,refresh:l,createMonatsdaten:x,updateMonatsdaten:g,deleteMonatsdaten:m}}function Tt(t){return{gesamtErzeugung:t.reduce((a,r)=>a+(r.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((a,r)=>a+r.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((a,r)=>a+r.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((a,r)=>a+(r.eigenverbrauch_kwh||0),0),durchschnittAutarkie:t.length>0?t.reduce((a,r)=>{const n=r.eigenverbrauch_kwh||0,s=(r.eigenverbrauch_kwh||0)+r.netzbezug_kwh;return a+(s>0?n/s*100:0)},0)/t.length:0,anzahlMonate:t.length}}function Aa(t,a){const[r,n]=c.useState([]),[s,i]=c.useState(!0),[o,d]=c.useState(null),l=c.useCallback(async()=>{try{i(!0),d(null);const h=await ve.list(t,a);n(h)}catch(h){d(h instanceof Error?h.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[t,a]);c.useEffect(()=>{l()},[l]);const x=c.useCallback(async h=>{const p=await ve.create(h);return n(f=>[...f,p]),p},[]),g=c.useCallback(async(h,p)=>{const f=await ve.update(h,p);return n(j=>j.map(_=>_.id===h?f:_)),f},[]),m=c.useCallback(async h=>{await ve.delete(h),n(p=>p.filter(f=>f.id!==h))},[]);return{investitionen:r,loading:s,error:o,refresh:l,createInvestition:x,updateInvestition:g,deleteInvestition:m}}function Er(t){return t.reduce((r,n)=>(r[n.typ]||(r[n.typ]=[]),r[n.typ].push(n),r),{})}function Cr(t){const[a,r]=c.useState([]),[n,s]=c.useState(!0),[i,o]=c.useState(null),d=c.useCallback(async()=>{try{s(!0),o(null);const m=await Ze.list(t);r(m)}catch(m){o(m instanceof Error?m.message:"Fehler beim Laden der Strompreise")}finally{s(!1)}},[t]);c.useEffect(()=>{d()},[d]);const l=c.useCallback(async m=>{const h=await Ze.create(m);return r(p=>[h,...p]),h},[]),x=c.useCallback(async(m,h)=>{const p=await Ze.update(m,h);return r(f=>f.map(j=>j.id===m?p:j)),p},[]),g=c.useCallback(async m=>{await Ze.delete(m),r(h=>h.filter(p=>p.id!==m))},[]);return{strompreise:a,loading:n,error:i,refresh:d,createStrompreis:l,updateStrompreis:x,deleteStrompreis:g}}function Da(t){const[a,r]=c.useState(null),[n,s]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{if(t===null){r(null);return}(async()=>{try{s(!0),o(null);const l=await Ze.getAktuell(t);r(l)}catch{r(null)}finally{s(!1)}})()},[t]),{strompreis:a,loading:n,error:i}}const Dt={pv_erzeugung:null,einspeisung:null,netzbezug:null,batterie_ladung:null,batterie_entladung:null};function Ar(){const[t,a]=c.useState("idle"),[r,n]=c.useState(null),[s,i]=c.useState(new Set),[o,d]=c.useState(Dt),[l,x]=c.useState(null),g=c.useCallback(async N=>{a("scanning"),x(null);try{const v=await $e.discover(N);if(n(v),!v.ha_connected){x("Keine Verbindung zu Home Assistant"),a("error");return}const u=new Set;for(const A of v.devices)!A.already_configured&&A.suggested_investition_typ&&u.add(A.id);i(u),d({pv_erzeugung:v.current_mappings.pv_erzeugung,einspeisung:v.current_mappings.einspeisung,netzbezug:v.current_mappings.netzbezug,batterie_ladung:v.current_mappings.batterie_ladung,batterie_entladung:v.current_mappings.batterie_entladung}),a("results")}catch(v){x(v instanceof Error?v.message:"Discovery fehlgeschlagen"),a("error")}},[]),m=c.useCallback(N=>{i(v=>{const u=new Set(v);return u.has(N)?u.delete(N):u.add(N),u})},[]),h=c.useCallback(()=>{if(!r)return;const N=new Set(r.devices.filter(v=>!v.already_configured&&v.suggested_investition_typ).map(v=>v.id));i(N)},[r]),p=c.useCallback(()=>{i(new Set)},[]),f=c.useCallback((N,v)=>{d(u=>({...u,[N]:v}))},[]),j=c.useCallback(()=>{if(!r)return;const N={...Dt},{sensor_mappings:v}=r;v.pv_erzeugung.length>0&&(N.pv_erzeugung=v.pv_erzeugung[0].entity_id),v.einspeisung.length>0&&(N.einspeisung=v.einspeisung[0].entity_id),v.netzbezug.length>0&&(N.netzbezug=v.netzbezug[0].entity_id),v.batterie_ladung.length>0&&(N.batterie_ladung=v.batterie_ladung[0].entity_id),v.batterie_entladung.length>0&&(N.batterie_entladung=v.batterie_entladung[0].entity_id),d(N)},[r]),_=c.useCallback(N=>{a(N)},[]),E=c.useCallback(()=>{a("idle"),n(null),i(new Set),d(Dt),x(null)},[]),k=(r==null?void 0:r.devices.filter(N=>s.has(N.id)&&!N.already_configured&&N.suggested_investition_typ))??[],w=s.size>0||Object.values(o).some((N,v)=>{const u=r!=null&&r.current_mappings?[r.current_mappings.pv_erzeugung,r.current_mappings.einspeisung,r.current_mappings.netzbezug,r.current_mappings.batterie_ladung,r.current_mappings.batterie_entladung]:[null,null,null,null,null];return N!==u[v]});return{step:t,discoveryResult:r,selectedDevices:s,selectedMappings:o,error:l,startDiscovery:g,toggleDevice:m,selectAllDevices:h,deselectAllDevices:p,setMapping:f,applyBestMappings:j,goToStep:_,reset:E,devicesToCreate:k,hasChanges:w}}const Be={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function Ma(t){return t<=10?8.2:t<=40?7.1:5.8}const Mt="eedc_setup_wizard_state",na={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[],pvModule:[]},Ve=["welcome","anlage","ha-connection","strompreise","pv-module","discovery","investitionen","summary","complete"];function Dr(){const[t,a]=c.useState(()=>{try{const F=localStorage.getItem(Mt);if(F)return JSON.parse(F)}catch{}return na}),[r,n]=c.useState(t.currentStep),[s,i]=c.useState(!1),[o,d]=c.useState(null),[l,x]=c.useState(null),[g,m]=c.useState(null),[h,p]=c.useState(!1),[f,j]=c.useState(null),[_,E]=c.useState(null),[k,w]=c.useState(new Set),[N,v]=c.useState([]),[u,A]=c.useState({});c.useEffect(()=>{localStorage.setItem(Mt,JSON.stringify({...t,currentStep:r}))},[t,r]),c.useEffect(()=>{t.anlageId&&!l&&Ie.get(t.anlageId).then(x).catch(()=>{})},[t.anlageId,l]);const W=c.useCallback(F=>{n(F),d(null)},[]),C=c.useCallback(()=>{const F=Ve.indexOf(r);F<Ve.length-1&&W(Ve[F+1])},[r,W]),L=c.useCallback(()=>{const F=Ve.indexOf(r);F>0&&W(Ve[F-1])},[r,W]),S=c.useCallback(()=>{a(F=>({...F,skippedSteps:[...F.skippedSteps,r]})),C()},[r,C]),G=c.useCallback(async F=>{i(!0),d(null);try{const O=await Ie.create(F);x(O),a(Z=>({...Z,anlageId:O.id})),C()}catch(O){d(O instanceof Error?O.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[C]),q=c.useCallback(async()=>{i(!0),d(null);try{const F=await $e.getStatus();p(F.connected),j(F.ha_version||null),F.connected||d("Keine Verbindung zu Home Assistant. Sie können diesen Schritt überspringen und später konfigurieren.")}catch{p(!1),d("Home Assistant nicht erreichbar. Läuft EEDC als Add-on?")}finally{i(!1)}},[]),y=c.useCallback(async F=>{if(!t.anlageId){d("Keine Anlage vorhanden");return}i(!0),d(null);try{const O=await Ze.create({anlage_id:t.anlageId,...F});m(O),a(Z=>({...Z,strompreisId:O.id})),C()}catch(O){d(O instanceof Error?O.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[t.anlageId,C]),V=c.useCallback(async()=>{if(!t.anlageId||!l){d("Keine Anlage vorhanden");return}const F=Ma(l.leistung_kwp);await y({netzbezug_arbeitspreis_cent_kwh:Be.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:F,grundpreis_euro_monat:Be.grundpreis_euro_monat,gueltig_ab:l.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,l,y]),b=c.useCallback(async()=>{if(!t.anlageId){d("Keine Anlage vorhanden");return}i(!0),d(null);try{const F=(l==null?void 0:l.wechselrichter_hersteller)||void 0,O=await $e.discover(t.anlageId,F);if(E(O),!O.ha_connected){d("Keine Verbindung zu Home Assistant");return}const Z=new Set,he={};for(const de of O.devices)!de.already_configured&&de.suggested_investition_typ&&(Z.add(de.id),he[de.id]={bezeichnung:de.suggested_parameters.bezeichnung||de.name,kaufdatum:new Date().toISOString().split("T")[0],kaufpreis:0,batterie_kwh:de.suggested_parameters.batterie_kwh,leistung_kw:de.suggested_parameters.leistung_kw,kapazitaet_kwh:de.suggested_parameters.kapazitaet_kwh});w(Z),A(he)}catch(F){d(F instanceof Error?F.message:"Discovery fehlgeschlagen")}finally{i(!1)}},[t.anlageId]),z=c.useCallback(F=>{w(O=>{const Z=new Set(O);return Z.has(F)?Z.delete(F):Z.add(F),Z})},[]),H=c.useCallback(()=>{if(!_)return;const F=new Set(_.devices.filter(O=>!O.already_configured&&O.suggested_investition_typ).map(O=>O.id));w(F)},[_]),ee=c.useCallback(()=>{w(new Set)},[]),te=c.useCallback((F,O)=>{A(Z=>({...Z,[F]:{...Z[F],...O}}))},[]),se=c.useCallback(async()=>{if(!t.anlageId||!_){d("Keine Anlage oder Discovery-Daten vorhanden");return}i(!0),d(null);const F=[],O=[];try{for(const Z of k){const he=_.devices.find(Wa=>Wa.id===Z);if(!he||he.already_configured||!he.suggested_investition_typ)continue;const de=u[Z];if(!de)continue;const Re={};de.batterie_kwh&&(Re.batterie_kwh=de.batterie_kwh,he.suggested_investition_typ==="speicher"&&(Re.kapazitaet_kwh=de.batterie_kwh)),de.leistung_kw&&(Re.leistung_kw=de.leistung_kw,he.suggested_investition_typ==="wechselrichter"&&(Re.leistung_ac_kw=de.leistung_kw));const Ia={anlage_id:t.anlageId,typ:he.suggested_investition_typ,bezeichnung:de.bezeichnung,anschaffungsdatum:de.kaufdatum||void 0,anschaffungskosten_gesamt:de.kaufpreis||void 0,parameter:Object.keys(Re).length>0?Re:void 0,aktiv:!0},ea=await ve.create(Ia);F.push(ea),O.push(ea.id)}v(F),a(Z=>({...Z,createdInvestitionen:[...Z.createdInvestitionen,...O]})),C()}catch(Z){d(Z instanceof Error?Z.message:"Fehler beim Erstellen der Investitionen")}finally{i(!1)}},[t.anlageId,_,k,u,C]),M=c.useCallback(F=>{const O={...F,id:`pv-${Date.now()}-${Math.random().toString(36).substring(2,9)}`};a(Z=>({...Z,pvModule:[...Z.pvModule,O]}))},[]),K=c.useCallback((F,O)=>{a(Z=>({...Z,pvModule:Z.pvModule.map(he=>he.id===F?{...he,...O}:he)}))},[]),R=c.useCallback(F=>{a(O=>({...O,pvModule:O.pvModule.filter(Z=>Z.id!==F)}))},[]),Le=c.useCallback(async()=>{if(!t.anlageId){d("Keine Anlage vorhanden");return}if(t.pvModule.length===0){C();return}i(!0),d(null);const F=[];try{for(const O of t.pvModule){const Z={anlage_id:t.anlageId,typ:"pv-module",bezeichnung:O.bezeichnung,ha_entity_id:O.ha_entity_id,parameter:{leistung_kwp:O.leistung_kwp,ausrichtung:O.ausrichtung,neigung_grad:O.neigung_grad},aktiv:!0},he=await ve.create(Z);F.push(he.id)}a(O=>({...O,createdInvestitionen:[...O.createdInvestitionen,...F]})),C()}catch(O){d(O instanceof Error?O.message:"Fehler beim Speichern der PV-Module")}finally{i(!1)}},[t.anlageId,t.pvModule,C]),mt=c.useCallback(()=>{a(F=>({...F,completed:!0,currentStep:"complete"})),n("complete")},[]),ut=c.useCallback(()=>{localStorage.removeItem(Mt),a(na),n("welcome"),x(null),m(null),E(null),w(new Set),v([]),A({}),d(null)},[]),pt=(()=>{switch(r){case"welcome":return!0;case"anlage":return!!t.anlageId;case"ha-connection":return!0;case"strompreise":return!!t.strompreisId;case"pv-module":return!0;case"discovery":return!0;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),bt=Math.round(Ve.indexOf(r)/(Ve.length-1)*100),yt=(_==null?void 0:_.devices.filter(F=>k.has(F.id)&&!F.already_configured&&F.suggested_investition_typ))??[];return{step:r,wizardState:t,isLoading:s,error:o,anlage:l,strompreis:g,haConnected:h,haVersion:f,discoveryResult:_,selectedDevices:k,createdInvestitionen:N,investitionenToEdit:yt,investitionFormData:u,goToStep:W,nextStep:C,prevStep:L,skipStep:S,createAnlage:G,checkHAConnection:q,createStrompreis:y,useDefaultStrompreise:V,runDiscovery:b,toggleDevice:z,selectAllDevices:H,deselectAllDevices:ee,updateInvestitionFormData:te,createInvestitionen:se,pvModule:t.pvModule,addPVModul:M,updatePVModul:K,removePVModul:R,savePVModule:Le,completeWizard:mt,resetWizard:ut,canProceed:pt,progress:bt}}const Mr=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Fr(){var g;const t=Nt(),{anlagen:a,loading:r}=je(),n=(g=a[0])==null?void 0:g.id,{monatsdaten:s,loading:i}=Qt(n),o=Tt(s),d=c.useMemo(()=>[...s].sort((h,p)=>h.jahr!==p.jahr?h.jahr-p.jahr:h.monat-p.monat).slice(-12).map(h=>({name:`${Mr[h.monat]} ${h.jahr.toString().slice(-2)}`,Einspeisung:h.einspeisung_kwh,Eigenverbrauch:h.eigenverbrauch_kwh||0,Netzbezug:h.netzbezug_kwh})),[s]);if(r||i)return e.jsx(re,{text:"Lade Dashboard..."});if(a.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsx(Ir,{})]});const x=a[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Anlage: ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:x.anlagenname})," (",x.leistung_kwp," kWp)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(jt,{title:"PV-Erzeugung",value:o.gesamtErzeugung>0?(o.gesamtErzeugung/1e3).toFixed(1):"---",unit:"MWh",subtitle:o.anzahlMonate>0?`${o.anzahlMonate} Monate`:void 0,icon:ie,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${T(o.gesamtErzeugung,0)} kWh`,ergebnis:`= ${T(o.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(jt,{title:"Eigenverbrauch",value:o.gesamtErzeugung>0?(o.gesamtEigenverbrauch/o.gesamtErzeugung*100).toFixed(1):"---",unit:"%",subtitle:`${(o.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:ue,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${T(o.gesamtEigenverbrauch,0)} kWh ÷ ${T(o.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${T(o.gesamtEigenverbrauch/o.gesamtErzeugung*100,1)} %`}),e.jsx(jt,{title:"Autarkie",value:o.durchschnittAutarkie>0?o.durchschnittAutarkie.toFixed(1):"---",unit:"%",subtitle:"Durchschnitt",icon:me,color:"text-energy-battery",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${T(o.durchschnittAutarkie,1)} %`}),e.jsx(jt,{title:"Netzbezug",value:o.gesamtNetzbezug>0?(o.gesamtNetzbezug/1e3).toFixed(1):"---",unit:"MWh",subtitle:`${o.gesamtEinspeisung.toFixed(0)} kWh eingespeist`,icon:Ne,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Netzbezug aller Monate",berechnung:`${T(o.gesamtNetzbezug,0)} kWh`,ergebnis:`= ${T(o.gesamtNetzbezug/1e3,1)} MWh`})]}),d.length>0?e.jsxs(I,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:d,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"name",className:"text-xs"}),e.jsx(ae,{unit:" kWh",className:"text-xs"}),e.jsx(Q,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:m=>[`${m.toFixed(0)} kWh`,""]}),e.jsx(Ee,{}),e.jsx(Y,{dataKey:"Eigenverbrauch",fill:"#8b5cf6",stackId:"a"}),e.jsx(Y,{dataKey:"Einspeisung",fill:"#10b981",stackId:"a"}),e.jsx(Y,{dataKey:"Netzbezug",fill:"#ef4444"})]})})})]}):e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Noch keine Monatsdaten vorhanden. Erfasse deine ersten Daten!"}),e.jsxs($,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(ye,{className:"h-4 w-4 ml-2"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Ft,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/monatsdaten")}),e.jsx(Ft,{title:"Auswertungen",description:"Detaillierte Analysen und Kennzahlen",onClick:()=>t("/auswertung")}),e.jsx(Ft,{title:"Investitionen",description:"E-Auto, Speicher, Wärmepumpe verwalten",onClick:()=>t("/investitionen")})]})]})}function jt({title:t,value:a,unit:r,subtitle:n,icon:s,color:i,bgColor:o,formel:d,berechnung:l,ergebnis:x}){const g=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a," ",e.jsx("span",{className:"text-sm font-normal",children:r})]});return e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:d?e.jsx(Ct,{formel:d,berechnung:l,ergebnis:x,children:g}):g}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${o}`,children:e.jsx(s,{className:`h-6 w-6 ${i}`})})]})})}function Ft({title:t,description:a,onClick:r}){return e.jsx("button",{onClick:r,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]}),e.jsx(ye,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function Ir(){const t=Nt();return e.jsxs(I,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei EEDC!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs($,{onClick:()=>t("/anlagen"),children:["Jetzt starten",e.jsx(ye,{className:"h-4 w-4 ml-2"})]})]})}const la=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Wr(){const{anlagen:t,loading:a}=je(),[r,n]=c.useState(),[s,i]=c.useState([]),[o,d]=c.useState(!1),[l,x]=c.useState(null);return c.useEffect(()=>{t.length>0&&!r&&n(t[0].id)},[t,r]),c.useEffect(()=>{if(!r)return;(async()=>{d(!0),x(null);try{const m=await ve.getEAutoDashboard(r);i(m)}catch(m){x(m instanceof Error?m.message:"Fehler beim Laden")}finally{d(!1)}})()},[r]),a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(J,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(_e,{value:(r==null?void 0:r.toString())||"",onChange:g=>n(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(J,{type:"error",children:l}),o?e.jsx(re,{text:"Lade E-Auto Daten..."}):s.length===0?e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein E-Auto unter "Investitionen" hinzu.'})]})}):s.map(g=>e.jsx(Pr,{dashboard:g},g.investition.id))]})}function Pr({dashboard:t}){var l;const{investition:a,monatsdaten:r,zusammenfassung:n}=t,s=n,i=r.map(x=>({name:`${la[x.monat]} ${x.jahr.toString().slice(2)}`,km:x.verbrauch_daten.km_gefahren||0,verbrauch:x.verbrauch_daten.verbrauch_kwh||0,pv:x.verbrauch_daten.ladung_pv_kwh||0,netz:x.verbrauch_daten.ladung_netz_kwh||0,extern:x.verbrauch_daten.ladung_extern_kwh||0,v2h:x.verbrauch_daten.v2h_entladung_kwh||0})),o=[{name:"Heim: PV",value:s.ladung_pv_kwh||0},{name:"Heim: Netz",value:s.ladung_netz_kwh||0},{name:"Extern",value:s.ladung_extern_kwh||0}].filter(x=>x.value>0),d=[{name:"E-Auto (Strom)",value:s.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:s.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(fe,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ge,{title:"Gefahren",value:((l=s.gesamt_km)==null?void 0:l.toLocaleString("de-DE"))||"0",unit:"km",icon:fe,color:"blue"}),e.jsx(ge,{title:"Verbrauch",value:(s.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:ue,color:"yellow"}),e.jsx(ge,{title:"PV-Anteil (Heim)",value:(s.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(s.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:Ye,color:"green"}),e.jsx(ge,{title:"Ersparnis vs. Benzin",value:(s.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",subtitle:`+ Wallbox: ${(s.wallbox_ersparnis_euro||0).toFixed(0)} €`,icon:Ne,color:"green",trend:(s.gesamt_ersparnis_euro||0)>0?"up":void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsxs(ht,{data:o,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:x,percent:g})=>`${x}: ${(g*100).toFixed(0)}%`,children:[e.jsx(Ae,{fill:"#22c55e"})," ",e.jsx(Ae,{fill:"#f97316"})," ",e.jsx(Ae,{fill:"#ef4444"})," "]}),e.jsx(Q,{formatter:x=>`${x.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(s.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(s.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(s.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(s.ladung_extern_kwh||0).toFixed(0)," kWh (",(s.ladung_extern_euro||0).toFixed(2)," €)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:d,layout:"vertical",children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{type:"number",tickFormatter:x=>`${x}€`}),e.jsx(ae,{type:"category",dataKey:"name",width:120}),e.jsx(Q,{formatter:x=>`${x.toFixed(2)} €`}),e.jsx(Y,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(s.ersparnis_vs_benzin_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{}),e.jsx(Q,{}),e.jsx(Y,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{}),e.jsx(Q,{}),e.jsx(Ee,{}),e.jsx(Y,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(Y,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(Y,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(s.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(s.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(s.v2h_ersparnis_euro||0).toFixed(2)," €"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(s.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:r.map(x=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[la[x.monat]," ",x.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:x.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(x.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(x.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(x.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(x.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},x.id))})]})})]})]})}const ia=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function $r(){const{anlagen:t,loading:a}=je(),[r,n]=c.useState(),[s,i]=c.useState([]),[o,d]=c.useState(!1),[l,x]=c.useState(null);return c.useEffect(()=>{t.length>0&&!r&&n(t[0].id)},[t,r]),c.useEffect(()=>{if(!r)return;(async()=>{d(!0),x(null);try{const m=await ve.getWaermepumpeDashboard(r);i(m)}catch(m){x(m instanceof Error?m.message:"Fehler beim Laden")}finally{d(!1)}})()},[r]),a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"}),e.jsx(J,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"})]}),t.length>1&&e.jsx(_e,{value:(r==null?void 0:r.toString())||"",onChange:g=>n(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(J,{type:"error",children:l}),o?e.jsx(re,{text:"Lade Wärmepumpe Daten..."}):s.length===0?e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Pe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wärmepumpe für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wärmepumpe unter "Investitionen" hinzu.'})]})}):s.map(g=>e.jsx(Lr,{dashboard:g},g.investition.id))]})}function Lr({dashboard:t}){const{investition:a,monatsdaten:r,zusammenfassung:n}=t,s=n,i=r.map(l=>({name:`${ia[l.monat]} ${l.jahr.toString().slice(2)}`,strom:l.verbrauch_daten.stromverbrauch_kwh||0,heizung:l.verbrauch_daten.heizenergie_kwh||0,warmwasser:l.verbrauch_daten.warmwasser_kwh||0,cop:((l.verbrauch_daten.heizenergie_kwh||0)+(l.verbrauch_daten.warmwasser_kwh||0))/(l.verbrauch_daten.stromverbrauch_kwh||1)})),o=[{name:"Heizung",value:s.gesamt_heizenergie_kwh},{name:"Warmwasser",value:s.gesamt_warmwasser_kwh}],d=[{name:"Wärmepumpe",value:s.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/Öl",value:s.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(Pe,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ge,{title:"Ø COP",value:s.durchschnitt_cop.toFixed(2),icon:ur,color:"orange"}),e.jsx(ge,{title:"Wärme erzeugt",value:(s.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:Pe,color:"red"}),e.jsx(ge,{title:"Strom verbraucht",value:(s.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:ue,color:"yellow"}),e.jsx(ge,{title:"Ersparnis",value:s.ersparnis_euro.toFixed(0),unit:"€",icon:Ne,color:"green",trend:s.ersparnis_euro>0?"up":void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsxs(ht,{data:o,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:x})=>`${l}: ${(x*100).toFixed(0)}%`,children:[e.jsx(Ae,{fill:"#ef4444"}),e.jsx(Ae,{fill:"#3b82f6"})]}),e.jsx(Q,{formatter:l=>`${l.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",s.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",s.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/Öl"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:d,layout:"vertical",children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{type:"number",tickFormatter:l=>`${l}€`}),e.jsx(ae,{type:"category",dataKey:"name",width:100}),e.jsx(Q,{formatter:l=>`${l.toFixed(2)} €`}),e.jsx(Y,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",s.ersparnis_euro.toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(ka,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{}),e.jsx(Q,{}),e.jsx(Ee,{}),e.jsx(Bt,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(Bt,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{domain:[0,6]}),e.jsx(Q,{formatter:l=>l.toFixed(2)}),e.jsx(Y,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ye,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis gegenüber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:r.map(l=>{const x=l.verbrauch_daten.stromverbrauch_kwh||0,g=l.verbrauch_daten.heizenergie_kwh||0,m=l.verbrauch_daten.warmwasser_kwh||0,h=x>0?(g+m)/x:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[ia[l.monat]," ",l.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:x.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:g.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:m.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:h.toFixed(2)})]},l.id)})})]})})]})]})}const Vr=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Br(){const{anlagen:t,loading:a}=je(),[r,n]=c.useState(),[s,i]=c.useState([]),[o,d]=c.useState(!1),[l,x]=c.useState(null);return c.useEffect(()=>{t.length>0&&!r&&n(t[0].id)},[t,r]),c.useEffect(()=>{if(!r)return;(async()=>{d(!0),x(null);try{const m=await ve.getSpeicherDashboard(r);i(m)}catch(m){x(m instanceof Error?m.message:"Fehler beim Laden")}finally{d(!1)}})()},[r]),a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(J,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(_e,{value:(r==null?void 0:r.toString())||"",onChange:g=>n(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(J,{type:"error",children:l}),o?e.jsx(re,{text:"Lade Speicher Daten..."}):s.length===0?e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(me,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge einen Speicher unter "Investitionen" hinzu.'})]})}):s.map(g=>e.jsx(Or,{dashboard:g},g.investition.id))]})}function Or({dashboard:t}){const{investition:a,monatsdaten:r,zusammenfassung:n}=t,s=n,i=r.map(o=>{const d=o.verbrauch_daten.ladung_kwh||0,l=o.verbrauch_daten.entladung_kwh||0;return{name:`${Vr[o.monat]} ${o.jahr.toString().slice(2)}`,ladung:d,entladung:l,zyklen:s.kapazitaet_kwh>0?d/s.kapazitaet_kwh:0,effizienz:d>0?l/d*100:0}});return e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.kapazitaet_kwh," kWh Kapazität • ",s.anzahl_monate," Monate Daten"]})]}),e.jsx(me,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ge,{title:"Vollzyklen",value:s.vollzyklen.toFixed(0),icon:xr,color:"blue"}),e.jsx(ge,{title:"Effizienz",value:s.effizienz_prozent.toFixed(1),unit:"%",icon:Qa,color:"green"}),e.jsx(ge,{title:"Durchsatz",value:(s.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:ue,color:"yellow"}),e.jsx(ge,{title:"Ersparnis",value:s.ersparnis_euro.toFixed(0),unit:"€",icon:Ne,color:"green",trend:s.ersparnis_euro>0?"up":void 0})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[s.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:s.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(s.gesamt_ladung_kwh-s.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{}),e.jsx(Q,{}),e.jsx(Ee,{}),e.jsx(Y,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(Y,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(ka,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{}),e.jsx(Q,{formatter:o=>o.toFixed(1)}),e.jsx(Bt,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:i,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{domain:[80,100]}),e.jsx(Q,{formatter:o=>`${o.toFixed(1)}%`}),e.jsx(dt,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((o,d)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:o.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:o.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:o.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:o.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[o.effizienz.toFixed(1),"%"]})]},d))})]})})]})]})}function Kr(){const{anlagen:t,loading:a}=je(),[r,n]=c.useState(),[s,i]=c.useState([]),[o,d]=c.useState(!1),[l,x]=c.useState(null);return c.useEffect(()=>{t.length>0&&!r&&n(t[0].id)},[t,r]),c.useEffect(()=>{if(!r)return;(async()=>{d(!0),x(null);try{const m=await ve.getWallboxDashboard(r);i(m)}catch(m){x(m instanceof Error?m.message:"Fehler beim Laden")}finally{d(!1)}})()},[r]),a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(J,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(_e,{value:(r==null?void 0:r.toString())||"",onChange:g=>n(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(J,{type:"error",children:l}),o?e.jsx(re,{text:"Lade Wallbox Daten..."}):s.length===0?e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wallbox unter "Einstellungen → Investitionen" hinzu.'})]})}):s.map(g=>e.jsx(Tr,{dashboard:g},g.investition.id))]})}function Tr({dashboard:t}){const{investition:a,zusammenfassung:r}=t,n=r,s=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.extern_ladung_kwh||0}].filter(l=>l.value>0),i=[{name:"Heimladung (tatsächlich)",value:n.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:n.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],o=n.leistung_kw||11,d=(n.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o," kW Ladeleistung • ",n.anzahl_monate||0," Monate Daten"]})]}),e.jsx(De,{className:"h-10 w-10 text-purple-500"})]}),d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ge,{title:"Heimladung",value:((n.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:Ue,color:"purple"}),e.jsx(ge,{title:"PV-Anteil",value:(n.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:Ye,color:"green"}),e.jsx(ge,{title:"Ersparnis vs. Extern",value:(n.ersparnis_vs_extern_euro||0).toFixed(0),unit:"€",subtitle:"Wallbox-ROI",icon:Ne,color:"green",trend:(n.ersparnis_vs_extern_euro||0)>0?"up":void 0}),e.jsx(ge,{title:"Ladevorgänge",value:(n.gesamt_ladevorgaenge||0).toString(),subtitle:`Ø ${(n.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:ue,color:"blue"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsxs(ht,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:x})=>`${l}: ${(x*100).toFixed(0)}%`,children:[e.jsx(Ae,{fill:"#22c55e"})," ",e.jsx(Ae,{fill:"#f97316"})," ",e.jsx(Ae,{fill:"#ef4444"})," "]}),e.jsx(Q,{formatter:l=>`${l.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(n.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(zt,{className:"h-4 w-4 text-red-500"}),"Extern: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:i,layout:"vertical",children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{type:"number",tickFormatter:l=>`${l}€`}),e.jsx(ae,{type:"category",dataKey:"name",width:150}),e.jsx(Q,{formatter:l=>`${l.toFixed(2)} €`}),e.jsx(Ee,{}),e.jsx(Y,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(n.ersparnis_vs_extern_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklärt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(n.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(n.ladung_netz_kwh||0).toFixed(0)," kWh = ",(n.heim_kosten_euro||0).toFixed(2)," €)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(n.extern_preis_kwh_euro||.5).toFixed(2)," €/kWh"]})]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatsächliche externe Ladung: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh für ",(n.extern_kosten_euro||0).toFixed(2)," €"]})]}),a.anschaffungskosten_gesamt&&a.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.anzahl_monate&&n.anzahl_monate>0?((n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12).toFixed(0):0," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const l=n.anzahl_monate&&n.anzahl_monate>0?(n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12:0;return l<=0?"∞":`${(a.anschaffungskosten_gesamt/l).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen → Monatsdaten".'})})]})}const At=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Se={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"};function da(){var w;const t=Nt(),[a,r]=c.useState("uebersicht"),[n,s]=c.useState("all"),{anlagen:i,loading:o}=je(),[d,l]=c.useState(null),x=d??((w=i[0])==null?void 0:w.id),g=i.find(N=>N.id===x),{monatsdaten:m,loading:h}=Qt(x);Tt(m);const{strompreis:p}=Da(x??null),f=c.useMemo(()=>[...new Set(m.map(v=>v.jahr))].sort((v,u)=>u-v),[m]),j=c.useMemo(()=>n==="all"?m:m.filter(N=>N.jahr===n),[m,n]),_=Tt(j);if(o||h)return e.jsx(re,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(J,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(m.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(I,{className:"text-center py-12",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs($,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(ye,{className:"h-4 w-4 ml-2"})]})]})]});const k=[{key:"uebersicht",label:"Übersicht"},{key:"pv",label:"PV-Anlage"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:n,onChange:N=>s(N.target.value==="all"?"all":Number(N.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),f.map(N=>e.jsx("option",{value:N,children:N},N))]}),i.length>1&&e.jsx("select",{value:x??"",onChange:N=>l(Number(N.target.value)),className:"input w-auto",children:i.map(N=>e.jsx("option",{value:N.id,children:N.anlagenname},N.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:k.map(N=>e.jsx("button",{onClick:()=>r(N.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${a===N.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:N.label},N.key))})}),a==="uebersicht"&&e.jsx(Hr,{data:j,stats:_,anlage:g,strompreis:p}),a==="pv"&&e.jsx(Gr,{data:j,anlage:g}),a==="finanzen"&&e.jsx(Rr,{data:j,stats:_,strompreis:p}),a==="co2"&&e.jsx(Jr,{data:j,stats:_})]})}function Hr({data:t,stats:a,anlage:r,strompreis:n}){const s=c.useMemo(()=>[...t].sort((l,x)=>l.jahr!==x.jahr?l.jahr-x.jahr:l.monat-x.monat).map(l=>({name:`${At[l.monat]} ${l.jahr.toString().slice(-2)}`,Erzeugung:l.pv_erzeugung_kwh||0,Eigenverbrauch:l.eigenverbrauch_kwh||0,Einspeisung:l.einspeisung_kwh,Netzbezug:l.netzbezug_kwh})),[t]),i=c.useMemo(()=>[{name:"Eigenverbrauch",value:a.gesamtEigenverbrauch,color:Se.consumption},{name:"Einspeisung",value:a.gesamtEinspeisung,color:Se.feedin}],[a]),o=c.useMemo(()=>{if(!n)return null;const d=a.gesamtEinspeisung*n.einspeiseverguetung_cent_kwh/100,l=a.gesamtNetzbezug*n.netzbezug_arbeitspreis_cent_kwh/100,x=a.gesamtEigenverbrauch*n.netzbezug_arbeitspreis_cent_kwh/100,g=d+x;return{einspeiseErloes:d,netzbezugKosten:l,eigenverbrauchErsparnis:x,nettoErtrag:g}},[a,n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"PV-Erzeugung",value:(a.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:ie,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${T(a.gesamtErzeugung,0)} kWh`,ergebnis:`= ${T(a.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(ze,{title:"Eigenverbrauch",value:a.gesamtErzeugung>0?(a.gesamtEigenverbrauch/a.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(a.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:ue,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${T(a.gesamtEigenverbrauch,0)} kWh ÷ ${T(a.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${T(a.gesamtEigenverbrauch/a.gesamtErzeugung*100,1)} %`}),e.jsx(ze,{title:"Autarkie",value:a.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:me,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${T(a.durchschnittAutarkie,1)} %`}),e.jsx(ze,{title:"Netto-Ertrag",value:o?o.nettoErtrag.toFixed(0):"---",unit:"€",subtitle:o?`${a.anzahlMonate} Monate`:"Strompreis fehlt",icon:Kt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + EV-Ersparnis",berechnung:o?`${T(o.einspeiseErloes,2)} € + ${T(o.eigenverbrauchErsparnis,2)} €`:void 0,ergebnis:o?`= ${T(o.nettoErtrag,2)} €`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(I,{className:"md:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:s,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"name",tick:{fontSize:11}}),e.jsx(ae,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Q,{formatter:d=>[`${d.toFixed(0)} kWh`,""]}),e.jsx(Ee,{}),e.jsx(Y,{dataKey:"Eigenverbrauch",fill:Se.consumption,stackId:"a"}),e.jsx(Y,{dataKey:"Einspeisung",fill:Se.feedin,stackId:"a"}),e.jsx(Y,{dataKey:"Netzbezug",fill:Se.grid})]})})})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Verteilung PV-Strom"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsx(ht,{data:i,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,dataKey:"value",label:({name:d,percent:l})=>`${d}: ${(l*100).toFixed(0)}%`,labelLine:!1,children:i.map((d,l)=>e.jsx(Ae,{fill:d.color},`cell-${l}`))}),e.jsx(Q,{formatter:d=>[`${(d/1e3).toFixed(1)} MWh`,""]})]})})})]})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[a.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(r==null?void 0:r.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[r!=null&&r.leistung_kwp?(a.gesamtErzeugung/r.leistung_kwp).toFixed(0):"---"," kWh/kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(a.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function Gr({data:t,anlage:a}){const r=c.useMemo(()=>[...t].sort((i,o)=>i.jahr!==o.jahr?i.jahr-o.jahr:i.monat-o.monat).map(i=>({name:`${At[i.monat]} ${i.jahr.toString().slice(-2)}`,Erzeugung:i.pv_erzeugung_kwh||i.einspeisung_kwh+(i.eigenverbrauch_kwh||0),SpezErtrag:a!=null&&a.leistung_kwp?(i.pv_erzeugung_kwh||i.einspeisung_kwh)/a.leistung_kwp:0})),[t,a]),n=c.useMemo(()=>{const s={};return t.forEach(i=>{const o=i.pv_erzeugung_kwh||i.einspeisung_kwh+(i.eigenverbrauch_kwh||0);s[i.jahr]=(s[i.jahr]||0)+o}),Object.entries(s).map(([i,o])=>({jahr:Number(i),erzeugung:o})).sort((i,o)=>i.jahr-o.jahr)},[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Erzeugung"}),e.jsx("div",{className:"h-72",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:r,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"name",tick:{fontSize:11}}),e.jsx(ae,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Q,{formatter:s=>[`${s.toFixed(0)} kWh`,""]}),e.jsx(Ee,{}),e.jsx(dt,{type:"monotone",dataKey:"Erzeugung",stroke:Se.solar,strokeWidth:2,dot:!1})]})})})]}),n.length>1&&e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresvergleich"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:n,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"jahr"}),e.jsx(ae,{unit:" kWh"}),e.jsx(Q,{formatter:s=>[`${s.toFixed(0)} kWh`,""]}),e.jsx(Y,{dataKey:"erzeugung",name:"Erzeugung",fill:Se.solar})]})})})]}),(a==null?void 0:a.leistung_kwp)&&e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:r,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"name",tick:{fontSize:11}}),e.jsx(ae,{unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(Q,{formatter:s=>[`${s.toFixed(1)} kWh/kWp`,""]}),e.jsx(Y,{dataKey:"SpezErtrag",name:"Spez. Ertrag",fill:Se.solar})]})})})]})]})}function Rr({data:t,stats:a,strompreis:r}){if(!r)return e.jsxs(I,{className:"text-center py-8",children:[e.jsx(Kt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const n=c.useMemo(()=>[...t].sort((o,d)=>o.jahr!==d.jahr?o.jahr-d.jahr:o.monat-d.monat).map(o=>{const d=o.eigenverbrauch_kwh||0,l=o.einspeisung_kwh*r.einspeiseverguetung_cent_kwh/100,x=o.netzbezug_kwh*r.netzbezug_arbeitspreis_cent_kwh/100,g=d*r.netzbezug_arbeitspreis_cent_kwh/100;return{name:`${At[o.monat]} ${o.jahr.toString().slice(-2)}`,Einspeiseerlös:l,Ersparnis:g,Netzbezug:-x}}),[t,r]),s=c.useMemo(()=>{const i=a.gesamtEinspeisung*r.einspeiseverguetung_cent_kwh/100,o=a.gesamtNetzbezug*r.netzbezug_arbeitspreis_cent_kwh/100,d=a.gesamtEigenverbrauch*r.netzbezug_arbeitspreis_cent_kwh/100,l=i+d;return{einspeiseErloes:i,netzbezugKosten:o,eigenverbrauchErsparnis:d,nettoErtrag:l}},[a,r]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Einspeiseerlös",value:s.einspeiseErloes.toFixed(0),unit:"€",subtitle:`${r.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:Ne,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Einspeisevergütung",berechnung:`${T(a.gesamtEinspeisung,0)} kWh × ${T(r.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${T(s.einspeiseErloes,2)} €`}),e.jsx(ze,{title:"EV-Ersparnis",value:s.eigenverbrauchErsparnis.toFixed(0),unit:"€",subtitle:"vermiedener Netzbezug",icon:ue,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Netzbezugspreis",berechnung:`${T(a.gesamtEigenverbrauch,0)} kWh × ${T(r.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${T(s.eigenverbrauchErsparnis,2)} €`}),e.jsx(ze,{title:"Netzbezug",value:s.netzbezugKosten.toFixed(0),unit:"€",subtitle:`${r.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:me,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug × Netzbezugspreis",berechnung:`${T(a.gesamtNetzbezug,0)} kWh × ${T(r.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${T(s.netzbezugKosten,2)} €`}),e.jsx(ze,{title:"Netto-Ertrag",value:s.nettoErtrag.toFixed(0),unit:"€",subtitle:"Gesamt",icon:Kt,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Einspeiseerlös + EV-Ersparnis",berechnung:`${T(s.einspeiseErloes,2)} € + ${T(s.eigenverbrauchErsparnis,2)} €`,ergebnis:`= ${T(s.nettoErtrag,2)} €`})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Finanzielle Bilanz pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:n,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"name",tick:{fontSize:11}}),e.jsx(ae,{unit:" €",tick:{fontSize:11}}),e.jsx(Q,{formatter:i=>[`${i.toFixed(2)} €`,""]}),e.jsx(Ee,{}),e.jsx(Y,{dataKey:"Einspeiseerlös",fill:Se.feedin,stackId:"pos"}),e.jsx(Y,{dataKey:"Ersparnis",fill:Se.consumption,stackId:"pos"}),e.jsx(Y,{dataKey:"Netzbezug",fill:Se.grid})]})})})]})]})}function Jr({data:t,stats:a}){const n=c.useMemo(()=>[...t].sort((l,x)=>l.jahr!==x.jahr?l.jahr-x.jahr:l.monat-x.monat).map(l=>{const x=l.pv_erzeugung_kwh||l.einspeisung_kwh+(l.eigenverbrauch_kwh||0);return{name:`${At[l.monat]} ${l.jahr.toString().slice(-2)}`,CO2:x*.38}}),[t]),s=a.gesamtErzeugung*.38,i=s/12.5,o=s/.12;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(ze,{title:"CO2 eingespart",value:(s/1e3).toFixed(2),unit:"t",subtitle:`${a.anzahlMonate} Monate`,icon:Ye,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung × CO2-Faktor",berechnung:`${T(a.gesamtErzeugung,0)} kWh × ${.38*1e3} g/kWh`,ergebnis:`= ${T(s,0)} kg = ${T(s/1e3,2)} t`}),e.jsx(ze,{title:"Bäume äquivalent",value:i.toFixed(0),unit:"Bäume/Jahr",subtitle:"Bindungsleistung",icon:Ye,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung ÷ 12,5 kg/Baum/Jahr",berechnung:`${T(s,0)} kg ÷ 12,5 kg/Baum`,ergebnis:`= ${T(i,0)} Bäume`}),e.jsx(ze,{title:"Auto-km vermieden",value:(o/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:St,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung ÷ 120 g/km",berechnung:`${T(s*1e3,0)} g ÷ 120 g/km`,ergebnis:`= ${T(o,0)} km`})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"CO2-Einsparung pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:n,children:[e.jsx(ne,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(le,{dataKey:"name",tick:{fontSize:11}}),e.jsx(ae,{unit:" kg",tick:{fontSize:11}}),e.jsx(Q,{formatter:d=>[`${d.toFixed(0)} kg CO2`,""]}),e.jsx(Y,{dataKey:"CO2",name:"CO2 eingespart",fill:"#10b981"})]})})})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",.38*1e3," g CO2/kWh berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]})]})]})}function ze({title:t,value:a,unit:r,subtitle:n,icon:s,color:i,bgColor:o,formel:d,berechnung:l,ergebnis:x}){const g=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a," ",e.jsx("span",{className:"text-sm font-normal",children:r})]});return e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:d?e.jsx(Ct,{formel:d,berechnung:l,ergebnis:x,children:g}):g}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${o}`,children:e.jsx(s,{className:`h-6 w-6 ${i}`})})]})})}const qr={"e-auto":fe,waermepumpe:Pe,speicher:me,wallbox:De,wechselrichter:Qe,"pv-module":ie,balkonkraftwerk:Na,sonstiges:Qe},It={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},ca={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function Zr(){var v;const{anlagen:t,loading:a}=je(),[r,n]=c.useState(null),[s,i]=c.useState(null),[o,d]=c.useState(!1),[l,x]=c.useState(null),[g,m]=c.useState(30),[h,p]=c.useState(8.2),[f,j]=c.useState(1.85),_=r??((v=t[0])==null?void 0:v.id),{strompreis:E}=Da(_??null);c.useEffect(()=>{E&&(m(E.netzbezug_arbeitspreis_cent_kwh),p(E.einspeiseverguetung_cent_kwh))},[E]),c.useEffect(()=>{if(!_)return;(async()=>{try{d(!0),x(null);const A=await ve.getROIDashboard(_,g,h,f);i(A)}catch(A){x(A instanceof Error?A.message:"Fehler beim Laden der ROI-Daten")}finally{d(!1)}})()},[_,g,h,f]);const k=c.useMemo(()=>{if(!s||s.gesamt_relevante_kosten<=0)return[];const u=[];let A=0;const W=Math.min(Math.ceil((s.gesamt_amortisation_jahre??20)*1.5),30);for(let C=0;C<=W;C++)u.push({jahr:C,kumulierte_einsparung:Math.round(A),investition:s.gesamt_relevante_kosten}),A+=s.gesamt_jahres_einsparung;return u},[s]),w=c.useMemo(()=>{if(!s)return[];const u={};return s.berechnungen.forEach(A=>{const W=A.investition_typ;u[W]=(u[W]||0)+A.jahres_einsparung}),Object.entries(u).map(([A,W])=>({name:ca[A]||A,value:Math.round(W),color:It[A]||"#6b7280"})).filter(A=>A.value>0)},[s]),N=c.useMemo(()=>s?s.berechnungen.map(u=>({name:u.investition_bezeichnung.length>15?u.investition_bezeichnung.substring(0,15)+"...":u.investition_bezeichnung,fullName:u.investition_bezeichnung,kosten:u.relevante_kosten,einsparung:u.jahres_einsparung,amortisation:u.amortisation_jahre??0,typ:u.investition_typ,color:It[u.investition_typ]||"#6b7280"})):[],[s]);return a?e.jsx(re,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(J,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:_??"",onChange:u=>n(Number(u.target.value)),className:"input w-auto",children:t.map(u=>e.jsx("option",{value:u.id,children:u.anlagenname},u.id))})})]}),l&&e.jsx(J,{type:"error",onClose:()=>x(null),children:l}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Qe,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:g,onChange:u=>m(Number(u.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergütung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:h,onChange:u=>p(Number(u.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:f,onChange:u=>j(Number(u.target.value)),className:"input"})]})]})]}),o&&e.jsx(re,{text:"Berechne ROI..."}),!o&&s&&s.berechnungen.length===0&&e.jsx(tt,{icon:wt,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!o&&s&&s.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(kt,{icon:wt,title:"Gesamtinvestition",value:`${s.gesamt_investition.toLocaleString("de-DE")} €`,subtitle:`Relevant: ${s.gesamt_relevante_kosten.toLocaleString("de-DE")} €`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt − Alternativkosten",ergebnis:`= ${T(s.gesamt_relevante_kosten,0)} €`}),e.jsx(kt,{icon:Ne,title:"Jährliche Einsparung",value:`${s.gesamt_jahres_einsparung.toLocaleString("de-DE")} €`,subtitle:s.gesamt_roi_prozent?`ROI: ${s.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einsparungen aller Investitionen",berechnung:s.gesamt_relevante_kosten>0?"ROI = Einsparung ÷ Kosten × 100":void 0,ergebnis:s.gesamt_roi_prozent?`= ${s.gesamt_roi_prozent}% ROI`:void 0}),e.jsx(kt,{icon:rr,title:"Amortisation",value:s.gesamt_amortisation_jahre?`${s.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten ÷ Jährliche Einsparung",berechnung:s.gesamt_jahres_einsparung>0?`${T(s.gesamt_relevante_kosten,0)} € ÷ ${T(s.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:s.gesamt_amortisation_jahre?`= ${s.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx(kt,{icon:Ye,title:"CO2-Einsparung",value:`${s.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${T(s.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(Ht,{data:k,children:[e.jsx(ne,{strokeDasharray:"3 3",opacity:.3}),e.jsx(le,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(ae,{tickFormatter:u=>`${(u/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(Q,{formatter:(u,A)=>[`${u.toLocaleString("de-DE")} €`,A==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:u=>`Jahr ${u}`}),e.jsx(Ee,{formatter:u=>u==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(dt,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(dt,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),s.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",s.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xt,{children:[e.jsx(ht,{data:w,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:u,percent:A})=>`${u}: ${(A*100).toFixed(0)}%`,labelLine:!0,children:w.map((u,A)=>e.jsx(Ae,{fill:u.color},`cell-${A}`))}),e.jsx(Q,{formatter:u=>[`${u.toLocaleString("de-DE")} €/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:N,layout:"vertical",children:[e.jsx(ne,{strokeDasharray:"3 3",opacity:.3}),e.jsx(le,{type:"number",tickFormatter:u=>`${u.toLocaleString("de-DE")}`}),e.jsx(ae,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(Q,{formatter:(u,A)=>[A==="kosten"?`${u.toLocaleString("de-DE")} €`:`${u.toLocaleString("de-DE")} €/Jahr`,A==="kosten"?"Relevante Kosten":"Jährliche Einsparung"]}),e.jsx(Ee,{formatter:u=>u==="kosten"?"Relevante Kosten (€)":"Jährliche Einsparung (€)"}),e.jsx(Y,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(Y,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.berechnungen.map(u=>{const A=qr[u.investition_typ]||Qe;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4",style:{color:It[u.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:u.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:ca[u.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[u.relevante_kosten.toLocaleString("de-DE")," €"]}),u.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",u.anschaffungskosten.toLocaleString("de-DE")," € gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[u.jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:u.roi_prozent?e.jsxs("span",{className:u.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[u.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:u.amortisation_jahre?e.jsxs("span",{className:u.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[u.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:u.co2_einsparung_kg?`${u.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},u.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[s.gesamt_relevante_kosten.toLocaleString("de-DE")," €"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[s.gesamt_jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:s.gesamt_roi_prozent?`${s.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:s.gesamt_amortisation_jahre?`${s.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[s.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(J,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatsächlichen Einsparungen können je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function kt({icon:t,title:a,value:r,subtitle:n,color:s,bgColor:i,formel:o,berechnung:d,ergebnis:l}){const x=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r});return e.jsx(I,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:`h-6 w-6 ${s}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a}),o?e.jsx(Ct,{formel:o,berechnung:d,ergebnis:l,children:x}):x,n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n})]})]})})}const Ur=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],oa=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#ef4444","#06b6d4"];function Yr(){var q;const{anlagen:t,loading:a}=je(),[r,n]=c.useState(),[s,i]=c.useState(new Date().getFullYear()),[o,d]=c.useState(null),[l,x]=c.useState([]),[g,m]=c.useState([]),[h,p]=c.useState(!1),[f,j]=c.useState(!1),[_,E]=c.useState(null);c.useEffect(()=>{t.length>0&&!r&&n(t[0].id)},[t,r]),c.useEffect(()=>{r&&k()},[r,s]);const k=async()=>{if(r){p(!0),E(null);try{const y=await it.list(r);x(y);try{const b=await $e.getStringMonatsdaten(r,s);m(b)}catch{m([])}const V=await Ce.getAktivePrognose(r);if(V)d({jahresertrag_kwh:V.jahresertrag_kwh,monatswerte:V.monatswerte,isLive:!1});else try{const b=await Ce.getPrognose(r);d({jahresertrag_kwh:b.jahresertrag_kwh,monatswerte:b.monatsdaten.map(z=>({monat:z.monat,e_m:z.e_m})),isLive:!0,module:b.module})}catch(b){d(null),b instanceof Error&&b.message.includes("PV-Module")&&E("Keine PV-Module für diese Anlage definiert. Bitte unter Einstellungen → Investitionen anlegen.")}}catch(y){E(y instanceof Error?y.message:"Fehler beim Laden")}finally{p(!1)}}},w=async()=>{if(r){j(!0);try{await Ce.speicherePrognose(r);const y=o==null?void 0:o.module;await k(),y&&y.length>0&&d(V=>V?{...V,module:y}:null)}catch(y){E(y instanceof Error?y.message:"Fehler beim Speichern")}finally{j(!1)}}},N=[...new Set(l.map(y=>y.jahr))].sort((y,V)=>V-y);c.useEffect(()=>{N.length>0&&!N.includes(s)&&i(N[0])},[N,s]);const v=[];if(o!=null&&o.monatswerte)for(let y=1;y<=12;y++){const V=((q=o.monatswerte.find(ee=>ee.monat===y))==null?void 0:q.e_m)||0,b=l.filter(ee=>ee.jahr===s&&ee.monat===y).reduce((ee,te)=>ee+(te.pv_erzeugung_kwh||0),0),z=b-V,H=V>0?z/V*100:0;v.push({monat:y,monatName:Ur[y],prognose:V,ist:b,abweichung:z,abweichungProzent:H})}const u=v.reduce((y,V)=>y+V.prognose,0),A=v.reduce((y,V)=>y+V.ist,0),W=A-u,C=u>0?W/u*100:0,S=12-v.filter(y=>y.ist===0).length,G=S>0?A/S*12:0;return a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(J,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mr,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(_e,{value:(r==null?void 0:r.toString())||"",onChange:y=>n(parseInt(y.target.value)),options:t.map(y=>({value:y.id.toString(),label:y.anlagenname}))}),N.length>0&&e.jsx(_e,{value:s.toString(),onChange:y=>i(parseInt(y.target.value)),options:N.map(y=>({value:y.toString(),label:y.toString()}))}),e.jsx("button",{onClick:k,disabled:h,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(we,{className:`h-5 w-5 ${h?"animate-spin":""}`})})]})]}),_&&e.jsx(J,{type:"error",children:_}),h?e.jsx(re,{text:"Lade Vergleichsdaten..."}):o?l.length===0?e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ke,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten für diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen → Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[o.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs($,{size:"sm",onClick:w,disabled:f,children:[e.jsx(He,{className:"h-4 w-4 mr-1"}),f?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(I,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[u.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",s]})]}),e.jsxs(I,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[A.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[S," von 12 Monaten"]})]}),e.jsxs(I,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[W>=0?e.jsx(Ne,{className:"h-6 w-6 text-green-500"}):e.jsx(ra,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${W>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[W>=0?"+":"",W.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${W>=0?"text-green-500":"text-red-500"}`,children:[W>=0?"+":"",C.toFixed(1),"%"]})]}),S<12&&S>0&&e.jsxs(I,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[G.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((G/u-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",s]}),e.jsx("div",{className:"h-80",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(Ta,{data:v,children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"monatName"}),e.jsx(ae,{yAxisId:"left",tickFormatter:y=>`${y} kWh`}),e.jsx(ae,{yAxisId:"right",orientation:"right",tickFormatter:y=>`${y}%`}),e.jsx(Q,{formatter:(y,V)=>V==="Abweichung %"?`${y.toFixed(1)}%`:`${y.toFixed(0)} kWh`}),e.jsx(Ee,{}),e.jsx(Ha,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(Y,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(Y,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(dt,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),o.module&&o.module.length>1&&e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dr,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"SOLL-IST Vergleich nach PV-Modul"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Vergleich der PVGIS-Prognose mit tatsächlichen Erträgen pro PV-Modul.",g.length===0&&e.jsx("span",{className:"text-yellow-600 ml-1",children:"(Keine String-Daten vorhanden - zeige nur Prognose)"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"PV-Modul"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ausrichtung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"SOLL (PVGIS)"}),e.jsxs("th",{className:"text-right py-2 px-2",children:["IST ",s]}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"})]})}),e.jsx("tbody",{children:o.module.map((y,V)=>{const b=g.filter(se=>se.investition_id===y.investition_id).reduce((se,M)=>se+M.pv_erzeugung_kwh,0),z=y.monatsdaten.reduce((se,M)=>se+M.e_m,0),H=b-z,ee=z>0?H/z*100:0,te=b>0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:oa[V%oa.length]}}),e.jsx("span",{className:"font-medium",children:y.bezeichnung})]})}),e.jsx("td",{className:"text-right py-2 px-2",children:y.leistung_kwp.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:y.ausrichtung}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[z.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:te?e.jsxs("span",{className:"text-green-600",children:[b.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${H>=0?"text-green-600":"text-red-600"}`,children:te?`${H>=0?"+":""}${ee.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:te?ee>=-5?e.jsx(Me,{className:"h-5 w-5 text-green-500 mx-auto"}):ee>=-15?e.jsx("span",{className:"text-yellow-500",children:"⚠"}):e.jsx(gt,{className:"h-5 w-5 text-red-500 mx-auto"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Keine Daten"})})]},y.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsx("td",{className:"text-right py-2 px-2",children:o.module.reduce((y,V)=>y+V.leistung_kwp,0).toFixed(1)}),e.jsx("td",{}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[u.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:g.length>0?g.reduce((y,V)=>y+V.pv_erzeugung_kwh,0).toLocaleString("de-DE",{maximumFractionDigits:0})+" kWh":"-"}),e.jsx("td",{colSpan:2})]})})]})}),g.length===0&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Tipp:"}),' Um IST-Daten pro PV-Modul zu sehen, weise jedem PV-Modul unter "Einstellungen → Investitionen" einen Home Assistant String-Sensor zu.']})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"})," Module mit deutlicher Unterperformance (<-15%) sollten auf Verschattung, Verschmutzung oder technische Probleme geprüft werden."]})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:v.map(y=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:y.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[y.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:y.ist>0?e.jsxs("span",{className:"text-green-600",children:[y.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${y.abweichung>=0?"text-green-600":"text-red-600"}`,children:y.ist>0?`${y.abweichung>=0?"+":""}${y.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${y.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:y.ist>0?`${y.abweichungProzent>=0?"+":""}${y.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:y.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):y.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Übertroffen"]}):y.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):y.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(ra,{className:"h-4 w-4"}),"Unter Plan"]})})]},y.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[u.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[A.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${W>=0?"text-green-600":"text-red-600"}`,children:[W>=0?"+":"",W.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${C>=0?"text-green-600":"text-red-600"}`,children:[C>=0?"+":"",C.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Übertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prüfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjährigen Mittelwerten. Einzelne Monate können stark abweichen."})]})]}):e.jsx(I,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfügbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen → Investitionen".'})]})})]})}const Xr=[{value:"Süd",label:"Süd"},{value:"Südost",label:"Südost"},{value:"Südwest",label:"Südwest"},{value:"Ost",label:"Ost"},{value:"West",label:"West"},{value:"Ost-West",label:"Ost-West"}];function ga({anlage:t,onSubmit:a,onCancel:r}){var m,h,p,f;const[n,s]=c.useState(!1),[i,o]=c.useState(null),[d,l]=c.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((m=t==null?void 0:t.leistung_kwp)==null?void 0:m.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((h=t==null?void 0:t.latitude)==null?void 0:h.toString())||"",longitude:((p=t==null?void 0:t.longitude)==null?void 0:p.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"",neigung_grad:((f=t==null?void 0:t.neigung_grad)==null?void 0:f.toString())||""}),x=j=>{const{name:_,value:E}=j.target;l(k=>({...k,[_]:E}))},g=async j=>{if(j.preventDefault(),o(null),!d.anlagenname.trim()){o("Bitte einen Namen eingeben");return}if(!d.leistung_kwp||parseFloat(d.leistung_kwp)<=0){o("Bitte eine gültige Leistung eingeben");return}try{s(!0),await a({anlagenname:d.anlagenname.trim(),leistung_kwp:parseFloat(d.leistung_kwp),installationsdatum:d.installationsdatum||void 0,standort_plz:d.standort_plz||void 0,standort_ort:d.standort_ort||void 0,standort_strasse:d.standort_strasse||void 0,latitude:d.latitude?parseFloat(d.latitude):void 0,longitude:d.longitude?parseFloat(d.longitude):void 0,ausrichtung:d.ausrichtung||void 0,neigung_grad:d.neigung_grad?parseFloat(d.neigung_grad):void 0})}catch(_){o(_ instanceof Error?_.message:"Fehler beim Speichern")}finally{s(!1)}};return e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[i&&e.jsx(J,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Anlagenname",name:"anlagenname",value:d.anlagenname,onChange:x,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(P,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:d.leistung_kwp,onChange:x,placeholder:"z.B. 10.5",required:!0}),e.jsx(P,{label:"Installationsdatum",name:"installationsdatum",type:"date",value:d.installationsdatum,onChange:x})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Technische Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_e,{label:"Ausrichtung",name:"ausrichtung",value:d.ausrichtung,onChange:x,options:Xr,placeholder:"-- Auswählen --"}),e.jsx(P,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:d.neigung_grad,onChange:x,placeholder:"z.B. 30"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(P,{label:"PLZ",name:"standort_plz",value:d.standort_plz,onChange:x,placeholder:"z.B. 12345"}),e.jsx(P,{label:"Ort",name:"standort_ort",value:d.standort_ort,onChange:x,placeholder:"z.B. Berlin"}),e.jsx(P,{label:"Straße",name:"standort_strasse",value:d.standort_strasse,onChange:x,placeholder:"z.B. Musterstraße 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(für PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:d.latitude,onChange:x,placeholder:"z.B. 52.520008",hint:"Nördliche Breite (positiv)"}),e.jsx(P,{label:"Längengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:d.longitude,onChange:x,placeholder:"z.B. 13.404954",hint:"Östliche Länge (positiv)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx($,{type:"button",variant:"secondary",onClick:r,children:"Abbrechen"}),e.jsx($,{type:"submit",loading:n,children:t?"Speichern":"Anlage erstellen"})]})]})}const Qr={ev:fe,wallbox:Gt,battery:ue,inverter:ie},es={evcc:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",sma:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",smart:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",wallbox:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"};function ts({device:t,selected:a,onToggle:r}){const n=Qr[t.device_type]||za,s=es[t.integration]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",i=!t.already_configured&&t.suggested_investition_typ;return e.jsxs("div",{className:`
        relative p-4 rounded-lg border-2 transition-all cursor-pointer
        ${a?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}
        ${t.already_configured?"opacity-60":""}
        ${i?"":"cursor-not-allowed"}
      `,onClick:()=>i&&r(),children:[i&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`
              w-5 h-5 rounded border-2 flex items-center justify-center
              ${a?"bg-amber-500 border-amber-500":"border-gray-300 dark:border-gray-600"}
            `,children:a&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),t.already_configured&&e.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Konfiguriert"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
          p-2 rounded-lg
          ${a?"bg-amber-100 dark:bg-amber-800/30":"bg-gray-100 dark:bg-gray-700"}
        `,children:e.jsx(n,{className:`w-6 h-6 ${a?"text-amber-600":"text-gray-600 dark:text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${s}`,children:t.integration.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.device_type==="ev"?"E-Auto":t.device_type==="wallbox"?"Wallbox":t.device_type==="battery"?"Speicher":t.device_type==="inverter"?"Wechselrichter":t.device_type}),t.confidence>=80&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[t.confidence,"% Konfidenz"]})]}),(t.manufacturer||t.model)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.manufacturer,t.model].filter(Boolean).join(" ")}),t.sensors.length>0&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:[t.sensors.length," Sensor",t.sensors.length!==1?"en":""," gefunden"]})]})]}),i&&Object.keys(t.suggested_parameters).length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Wird erstellt als:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.suggested_parameters.bezeichnung||t.name})]})]})}function rt({label:t,icon:a,suggestions:r,allSensors:n,showAll:s,value:i,onChange:o}){const d=s?n:r,l=d.length>0,x=r.length>0&&r[0].confidence>=70;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"p-2 rounded-lg bg-white dark:bg-gray-700 shadow-sm",children:e.jsx(a,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),e.jsxs("select",{value:i||"",onChange:g=>o(g.target.value||null),className:`
            w-full px-3 py-2 text-sm rounded-lg border
            bg-white dark:bg-gray-800
            border-gray-300 dark:border-gray-600
            text-gray-900 dark:text-white
            focus:ring-2 focus:ring-amber-500 focus:border-amber-500
            ${l?"":"opacity-50"}
          `,disabled:!l,children:[e.jsx("option",{value:"",children:l?"-- Nicht zugeordnet --":"-- Kein Sensor gefunden --"}),d.map(g=>e.jsxs("option",{value:g.entity_id,children:[g.friendly_name||g.entity_id,g.confidence>=80&&" ★"]},g.entity_id))]}),!s&&x&&!i&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["Empfehlung: ",r[0].friendly_name||r[0].entity_id]}),i&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:i})]})]})}function as({suggestions:t,allEnergySensors:a,selectedMappings:r,onMappingChange:n,onApplyBest:s}){const[i,o]=c.useState(!1),d=t.pv_erzeugung.length+t.einspeisung.length+t.netzbezug.length+t.batterie_ladung.length+t.batterie_entladung.length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Sensor-Zuordnungen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Für Monatsdaten-Import aus Home Assistant"})]}),e.jsx("div",{className:"flex items-center gap-2",children:d>0&&!i&&e.jsx("button",{onClick:s,className:"text-xs px-3 py-1.5 rounded-lg bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:hover:bg-amber-900/50 transition-colors",children:"Beste übernehmen"})})]}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsxs("button",{onClick:()=>o(!1),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${i?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm"}`,children:["Empfohlen (",d,")"]}),e.jsxs("button",{onClick:()=>o(!0),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${i?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Alle (",a.length,")"]})]}),i&&e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg",children:"Zeigt alle Energy-Sensoren (kWh, total_increasing) für manuelle Zuordnung."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(rt,{label:"PV-Erzeugung",icon:ie,field:"pv_erzeugung",suggestions:t.pv_erzeugung,allSensors:a,showAll:i,value:r.pv_erzeugung,onChange:l=>n("pv_erzeugung",l)}),e.jsx(rt,{label:"Einspeisung",icon:tr,field:"einspeisung",suggestions:t.einspeisung,allSensors:a,showAll:i,value:r.einspeisung,onChange:l=>n("einspeisung",l)}),e.jsx(rt,{label:"Netzbezug",icon:er,field:"netzbezug",suggestions:t.netzbezug,allSensors:a,showAll:i,value:r.netzbezug,onChange:l=>n("netzbezug",l)}),e.jsx(rt,{label:"Batterie Ladung",icon:Gt,field:"batterie_ladung",suggestions:t.batterie_ladung,allSensors:a,showAll:i,value:r.batterie_ladung,onChange:l=>n("batterie_ladung",l)}),e.jsx(rt,{label:"Batterie Entladung",icon:me,field:"batterie_entladung",suggestions:t.batterie_entladung,allSensors:a,showAll:i,value:r.batterie_entladung,onChange:l=>n("batterie_entladung",l)})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic",children:"Hinweis: Sensor-Zuordnungen werden in der Add-on-Konfiguration gespeichert. Änderungen hier dienen nur zur Vorschau."})]})}const rs={ev:fe,wallbox:Gt,battery:ue,inverter:ie},ss={"e-auto":"E-Auto",wallbox:"Wallbox",speicher:"Speicher",wechselrichter:"Wechselrichter"};function ns({devicesToCreate:t,onConfirm:a,onBack:r,loading:n=!1}){return t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ke,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Geräte ausgewählt"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Bitte wähle mindestens ein Gerät aus, das als Investition angelegt werden soll."}),e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Zurück zur Auswahl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Me,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Zusammenfassung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Folgende ",t.length," Investition",t.length!==1?"en":""," werden erstellt:"]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:t.map(s=>{const i=rs[s.device_type]||za,o=s.suggested_investition_typ?ss[s.suggested_investition_typ]||s.suggested_investition_typ:"Unbekannt";return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(i,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.suggested_parameters.bezeichnung||s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:o}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700",children:s.integration.toUpperCase()})]})]})]},s.id)})}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{children:"Die Investitionen werden mit Standardwerten erstellt."}),e.jsx("p",{className:"mt-1",children:'Du kannst die Details später unter "Investitionen" anpassen.'})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:r,disabled:n,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Zurück"}),e.jsx("button",{onClick:a,disabled:n,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Erstelle..."})]}):e.jsx("span",{children:"Investitionen erstellen"})})]})]})}function Fa({isOpen:t,onClose:a,anlageId:r,onInvestitionenCreated:n}){const{step:s,discoveryResult:i,selectedDevices:o,selectedMappings:d,error:l,startDiscovery:x,toggleDevice:g,selectAllDevices:m,deselectAllDevices:h,setMapping:p,applyBestMappings:f,goToStep:j,reset:_,devicesToCreate:E}=Ar();c.useEffect(()=>{t&&s==="idle"&&x(r)},[t,s,r,x]);const k=()=>{_(),a()},w=async()=>{j("creating");try{for(const v of E){const u={anlage_id:r,typ:v.suggested_investition_typ,bezeichnung:v.suggested_parameters.bezeichnung||v.name,hersteller:v.suggested_parameters.hersteller||v.manufacturer||void 0,kaufdatum:new Date().toISOString().split("T")[0],kaufpreis:0,aktiv:!0};v.suggested_investition_typ==="e-auto"&&(u.batterie_kwh=v.suggested_parameters.batterie_kwh||void 0),await ve.create(u)}j("done"),n==null||n()}catch{j("error")}},N=()=>{switch(s){case"scanning":return"Home Assistant durchsuchen...";case"results":return"Gefundene Geräte";case"confirmation":return"Bestätigung";case"creating":return"Erstelle Investitionen...";case"done":return"Fertig!";case"error":return"Fehler";default:return"Auto-Discovery"}};return e.jsxs(ke,{isOpen:t,onClose:k,title:N(),size:"lg",children:[s==="scanning"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(ct,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten..."})]}),s==="error"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ot,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Verbindung fehlgeschlagen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:l||"Keine Verbindung zu Home Assistant möglich."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Schließen"}),e.jsx("button",{onClick:()=>x(r),className:"px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Erneut versuchen"})]})]}),s==="results"&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:i.ha_connected?e.jsxs(e.Fragment,{children:[e.jsx(qt,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Nicht verbunden"})]})}),i.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:i.warnings.map((v,u)=>e.jsx("p",{children:v},u))})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["Gefundene Geräte (",i.devices.length,")"]}),i.devices.filter(v=>!v.already_configured&&v.suggested_investition_typ).length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Keine"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:m,className:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"Alle"})]})]}),i.devices.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Unterstützt: SMA, evcc, Smart, Wallbox"})]}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:i.devices.map(v=>e.jsx(ts,{device:v,selected:o.has(v.id),onToggle:()=>g(v.id)},v.id))})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsx(as,{suggestions:i.sensor_mappings,allEnergySensors:i.all_energy_sensors,selectedMappings:d,onMappingChange:p,onApplyBest:f})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:k,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Abbrechen"}),e.jsxs("button",{onClick:()=>j("confirmation"),disabled:o.size===0,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter (",o.size," ausgewählt)"]})]})]}),s==="confirmation"&&e.jsx(ns,{devicesToCreate:E,onConfirm:w,onBack:()=>j("results")}),s==="creating"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 mb-6",children:e.jsxs("svg",{className:"animate-spin w-16 h-16 text-amber-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Erstelle ",E.length," Investition",E.length!==1?"en":"","..."]})]}),s==="done"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(be,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Erfolgreich erstellt!"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:[E.length," Investition",E.length!==1?"en wurden":" wurde"," angelegt."]}),e.jsx("button",{onClick:k,className:"px-6 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Fertig"})]})]})}function ls(){const{anlagen:t,loading:a,error:r,createAnlage:n,updateAnlage:s,deleteAnlage:i}=je(),[o,d]=c.useState(!1),[l,x]=c.useState(null),[g,m]=c.useState(null),[h,p]=c.useState(null),f=async E=>{const k=await n(E);d(!1),p(k.id)},j=async E=>{l&&(await s(l.id,E),x(null))},_=async()=>{g&&(await i(g.id),m(null))};return a?e.jsx(re,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs($,{onClick:()=>d(!0),children:[e.jsx(Xe,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),r&&e.jsx(J,{type:"error",children:r}),t.length===0?e.jsx(I,{children:e.jsx(tt,{icon:ie,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx($,{onClick:()=>d(!0),children:"Erste Anlage anlegen"})})}):e.jsx(I,{padding:"none",children:e.jsxs(Ut,{children:[e.jsx(Yt,{children:e.jsxs(et,{children:[e.jsx(ce,{children:"Name"}),e.jsx(ce,{children:"Leistung"}),e.jsx(ce,{children:"Standort"}),e.jsx(ce,{children:"Ausrichtung"}),e.jsx(ce,{children:"Installation"}),e.jsx(ce,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Xt,{children:t.map(E=>e.jsxs(et,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:E.anlagenname})]})}),e.jsxs(oe,{children:[e.jsx("span",{className:"font-mono",children:E.leistung_kwp})," kWp"]}),e.jsx(oe,{children:E.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(zt,{className:"h-4 w-4"}),E.standort_plz," ",E.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(oe,{children:[E.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),E.neigung_grad&&` / ${E.neigung_grad}°`]}),e.jsx(oe,{children:E.installationsdatum?new Date(E.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(oe,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>p(E.id),title:"HA-Geräte erkennen",children:e.jsx(ct,{className:"h-4 w-4 text-amber-500"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>x(E),children:e.jsx(Jt,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>m(E),children:e.jsx(Ge,{className:"h-4 w-4 text-red-500"})})]})})]},E.id))})]})}),e.jsx(ke,{isOpen:o,onClose:()=>d(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(ga,{onSubmit:f,onCancel:()=>d(!1)})}),e.jsx(ke,{isOpen:!!l,onClose:()=>x(null),title:"Anlage bearbeiten",size:"lg",children:l&&e.jsx(ga,{anlage:l,onSubmit:j,onCancel:()=>x(null)})}),e.jsx(ke,{isOpen:!!g,onClose:()=>m(null),title:"Anlage löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Anlage ",e.jsxs("strong",{children:['"',g==null?void 0:g.anlagenname,'"']})," wirklich löschen?"]}),e.jsx(J,{type:"warning",children:"Alle zugehörigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelöscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx($,{variant:"secondary",onClick:()=>m(null),children:"Abbrechen"}),e.jsx($,{variant:"danger",onClick:_,children:"Löschen"})]})]})}),h&&e.jsx(Fa,{isOpen:!0,onClose:()=>p(null),anlageId:h})]})}function is(){var W;const{anlagen:t,loading:a}=je(),[r,n]=c.useState(null),s=r??((W=t[0])==null?void 0:W.id),{strompreise:i,loading:o,error:d,createStrompreis:l,updateStrompreis:x,deleteStrompreis:g}=Cr(s),[m,h]=c.useState(!1),[p,f]=c.useState(null),[j,_]=c.useState(null),[E,k]=c.useState(null),w=async C=>{try{k(null),await l(C),h(!1)}catch(L){k(L instanceof Error?L.message:"Fehler beim Erstellen")}},N=async C=>{if(p)try{k(null),await x(p.id,C),f(null)}catch(L){k(L instanceof Error?L.message:"Fehler beim Aktualisieren")}},v=async()=>{if(j)try{await g(j.id),_(null)}catch(C){k(C instanceof Error?C.message:"Fehler beim Löschen")}},u=C=>{const L=new Date().toISOString().split("T")[0],S=C.gueltig_ab<=L,G=!C.gueltig_bis||C.gueltig_bis>=L;return S&&G};if(a||o)return e.jsx(re,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(J,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const A=[...i].sort((C,L)=>{const S=u(C),G=u(L);return S!==G?S?-1:1:L.gueltig_ab.localeCompare(C.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:s??"",onChange:C=>n(Number(C.target.value)),className:"input w-auto",children:t.map(C=>e.jsx("option",{value:C.id,children:C.anlagenname},C.id))}),e.jsxs($,{onClick:()=>h(!0),children:[e.jsx(Xe,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),d&&e.jsx(J,{type:"error",children:d}),A.length>0&&u(A[0])&&e.jsx(I,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(Oe,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",A[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[A[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," · ","Einspeisung: ",e.jsxs("strong",{children:[A[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),A[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" · Grundpreis: ",e.jsxs("strong",{children:[A[0].grundpreis_euro_monat.toFixed(2)," €/Monat"]})]})]})]})]})}),i.length===0?e.jsx(I,{children:e.jsx(tt,{icon:ue,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx($,{onClick:()=>h(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(I,{padding:"none",children:e.jsxs(Ut,{children:[e.jsx(Yt,{children:e.jsxs(et,{children:[e.jsx(ce,{children:"Tarif"}),e.jsx(ce,{children:"Netzbezug"}),e.jsx(ce,{children:"Einspeisung"}),e.jsx(ce,{children:"Grundpreis"}),e.jsx(ce,{children:"Gültigkeit"}),e.jsx(ce,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Xt,{children:A.map(C=>{const L=u(C);return e.jsxs(et,{className:L?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:`h-5 w-5 ${L?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:C.tarifname||"Standard"}),L&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),C.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:C.anbieter})]})]})}),e.jsxs(oe,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:C.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(oe,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:C.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(oe,{children:C.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:C.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" €/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(St,{className:"h-4 w-4"}),new Date(C.gueltig_ab).toLocaleDateString("de-DE"),C.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(C.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(oe,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>f(C),children:e.jsx(Jt,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>_(C),children:e.jsx(Ge,{className:"h-4 w-4 text-red-500"})})]})})]},C.id)})})]})}),e.jsxs(I,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gültige Tarif wird automatisch für Berechnungen verwendet"}),e.jsx("li",{children:"Für historische Auswertungen werden die zum jeweiligen Zeitpunkt gültigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gültigkeitszeitraum korrekt setzen"})]})]}),e.jsx(ke,{isOpen:m,onClose:()=>{h(!1),k(null)},title:"Neuen Tarif anlegen",size:"lg",children:s&&e.jsx(xa,{anlageId:s,onCreate:w,onCancel:()=>{h(!1),k(null)},error:E})}),e.jsx(ke,{isOpen:!!p,onClose:()=>{f(null),k(null)},title:"Tarif bearbeiten",size:"lg",children:p&&e.jsx(xa,{strompreis:p,anlageId:p.anlage_id,onUpdate:N,onCancel:()=>{f(null),k(null)},error:E})}),e.jsx(ke,{isOpen:!!j,onClose:()=>_(null),title:"Tarif löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du den Tarif ",e.jsxs("strong",{children:['"',(j==null?void 0:j.tarifname)||"Standard",'"']})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx($,{variant:"secondary",onClick:()=>_(null),children:"Abbrechen"}),e.jsx($,{variant:"danger",onClick:v,children:"Löschen"})]})]})})]})}function xa({strompreis:t,anlageId:a,onCreate:r,onUpdate:n,onCancel:s,error:i}){var h,p,f;const[o,d]=c.useState(!1),[l,x]=c.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((h=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:h.toString())||"30",einspeiseverguetung_cent_kwh:((p=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:p.toString())||"8.2",grundpreis_euro_monat:((f=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:f.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||""}),g=j=>{const{name:_,value:E}=j.target;x(k=>({...k,[_]:E}))},m=async j=>{j.preventDefault(),d(!0);try{const _={netzbezug_arbeitspreis_cent_kwh:parseFloat(l.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(l.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:l.grundpreis_euro_monat?parseFloat(l.grundpreis_euro_monat):void 0,gueltig_ab:l.gueltig_ab,gueltig_bis:l.gueltig_bis||void 0,tarifname:l.tarifname||void 0,anbieter:l.anbieter||void 0,vertragsart:l.vertragsart||void 0};t&&n?await n(_):r&&await r({..._,anlage_id:a})}finally{d(!1)}};return e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[i&&e.jsx(J,{type:"error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Tarifname",name:"tarifname",value:l.tarifname,onChange:g,placeholder:"z.B. Grundversorgung, Öko-Strom"}),e.jsx(P,{label:"Anbieter",name:"anbieter",value:l.anbieter,onChange:g,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(P,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:l.netzbezug_arbeitspreis_cent_kwh,onChange:g,required:!0,hint:"Arbeitspreis für Strombezug"}),e.jsx(P,{label:"Einspeisevergütung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:l.einspeiseverguetung_cent_kwh,onChange:g,required:!0,hint:"EEG-Vergütung oder PPA-Preis"}),e.jsx(P,{label:"Grundpreis (€/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:l.grundpreis_euro_monat,onChange:g,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gültigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Gültig ab",name:"gueltig_ab",type:"date",value:l.gueltig_ab,onChange:g,required:!0}),e.jsx(P,{label:"Gültig bis",name:"gueltig_bis",type:"date",value:l.gueltig_bis,onChange:g,hint:"Leer lassen für unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:l.vertragsart,onChange:g,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte wählen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"Ökostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx($,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx($,{type:"submit",loading:o,children:t?"Speichern":"Anlegen"})]})]})}const ds={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function cs({investition:t,anlageId:a,typ:r,onSubmit:n,onCancel:s}){var v,u,A,W,C;const[i,o]=c.useState(!1),[d,l]=c.useState(null),[x,g]=c.useState([]),[m,h]=c.useState(!1),[p,f]=c.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${ds[r]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((v=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:v.toString())||"",anschaffungskosten_alternativ:((u=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:u.toString())||"",betriebskosten_jahr:((A=t==null?void 0:t.betriebskosten_jahr)==null?void 0:A.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,leistung_kwp:((W=t==null?void 0:t.leistung_kwp)==null?void 0:W.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"Süd",neigung_grad:((C=t==null?void 0:t.neigung_grad)==null?void 0:C.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""});c.useEffect(()=>{r==="pv-module"&&(h(!0),$e.getStringSensors().then(g).catch(()=>g([])).finally(()=>h(!1)))},[r]);const j=(t==null?void 0:t.parameter)||{},_=()=>{var L,S,G,q,y,V,b,z,H,ee,te,se,M,K,R,Le,mt,ut,pt,bt,yt,F;switch(r){case"e-auto":return{batteriekapazitaet_kwh:((L=j.batteriekapazitaet_kwh)==null?void 0:L.toString())||"",verbrauch_kwh_100km:((S=j.verbrauch_kwh_100km)==null?void 0:S.toString())||"18",jahresfahrleistung_km:((G=j.jahresfahrleistung_km)==null?void 0:G.toString())||"15000",pv_ladeanteil_prozent:((q=j.pv_ladeanteil_prozent)==null?void 0:q.toString())||"60",v2h_faehig:j.v2h_faehig??!1,v2h_entladeleistung_kw:((y=j.v2h_entladeleistung_kw)==null?void 0:y.toString())||""};case"speicher":return{kapazitaet_kwh:((V=j.kapazitaet_kwh)==null?void 0:V.toString())||"",nutzbare_kapazitaet_kwh:((b=j.nutzbare_kapazitaet_kwh)==null?void 0:b.toString())||"",max_ladeleistung_kw:((z=j.max_ladeleistung_kw)==null?void 0:z.toString())||"",max_entladeleistung_kw:((H=j.max_entladeleistung_kw)==null?void 0:H.toString())||"",wirkungsgrad_prozent:((ee=j.wirkungsgrad_prozent)==null?void 0:ee.toString())||"95",arbitrage_faehig:j.arbitrage_faehig??!1};case"waermepumpe":return{leistung_kw:((te=j.leistung_kw)==null?void 0:te.toString())||"",cop:((se=j.cop)==null?void 0:se.toString())||"3.5",jahresarbeitszahl:((M=j.jahresarbeitszahl)==null?void 0:M.toString())||"3.0",heizwaermebedarf_kwh:((K=j.heizwaermebedarf_kwh)==null?void 0:K.toString())||"",warmwasserbedarf_kwh:((R=j.warmwasserbedarf_kwh)==null?void 0:R.toString())||"",sg_ready:j.sg_ready??!1};case"wallbox":return{max_ladeleistung_kw:((Le=j.max_ladeleistung_kw)==null?void 0:Le.toString())||"11",bidirektional:j.bidirektional??!1,pv_optimiert:j.pv_optimiert??!0};case"wechselrichter":return{max_leistung_kw:((mt=j.max_leistung_kw)==null?void 0:mt.toString())||"",wirkungsgrad_prozent:((ut=j.wirkungsgrad_prozent)==null?void 0:ut.toString())||"97",hybrid:j.hybrid??!1};case"pv-module":case"balkonkraftwerk":return{leistung_wp:((pt=j.leistung_wp)==null?void 0:pt.toString())||"",anzahl:((bt=j.anzahl)==null?void 0:bt.toString())||"",ausrichtung:((yt=j.ausrichtung)==null?void 0:yt.toString())||"Süd",neigung_grad:((F=j.neigung_grad)==null?void 0:F.toString())||"30"};default:return{}}},[E,k]=c.useState(_),w=L=>{const{name:S,value:G,type:q,checked:y}=L.target;if(S.startsWith("param_")){const V=S.replace("param_","");k(b=>({...b,[V]:q==="checkbox"?y:G}))}else f(V=>({...V,[S]:q==="checkbox"?y:G}))},N=async L=>{if(L.preventDefault(),l(null),!p.bezeichnung.trim()){l("Bitte eine Bezeichnung eingeben");return}try{o(!0);const S={};Object.entries(E).forEach(([q,y])=>{if(typeof y=="boolean")S[q]=y;else if(y!==""){const V=parseFloat(y);S[q]=isNaN(V)?y:V}});const G={...t?{}:{anlage_id:a,typ:r},bezeichnung:p.bezeichnung.trim(),anschaffungsdatum:p.anschaffungsdatum||void 0,anschaffungskosten_gesamt:p.anschaffungskosten_gesamt?parseFloat(p.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:p.anschaffungskosten_alternativ?parseFloat(p.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:p.betriebskosten_jahr?parseFloat(p.betriebskosten_jahr):void 0,aktiv:p.aktiv,parameter:Object.keys(S).length>0?S:void 0,...r==="pv-module"&&{leistung_kwp:p.leistung_kwp?parseFloat(p.leistung_kwp):void 0,ausrichtung:p.ausrichtung||void 0,neigung_grad:p.neigung_grad?parseFloat(p.neigung_grad):void 0,ha_entity_id:p.ha_entity_id||void 0}};await n(G)}catch(S){l(S instanceof Error?S.message:"Fehler beim Speichern")}finally{o(!1)}};return e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[d&&e.jsx(J,{type:"error",children:d}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Bezeichnung",name:"bezeichnung",value:p.bezeichnung,onChange:w,required:!0}),e.jsx(P,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",value:p.anschaffungsdatum,onChange:w}),e.jsx(P,{label:"Anschaffungskosten (€)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:p.anschaffungskosten_gesamt,onChange:w,hint:"Gesamtkosten inkl. Installation"}),e.jsx(P,{label:"Alternative Kosten (€)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:p.anschaffungskosten_alternativ,onChange:w,hint:"z.B. Verbrenner-Kosten bei E-Auto"}),e.jsx(P,{label:"Betriebskosten/Jahr (€)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:p.betriebskosten_jahr,onChange:w,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:p.aktiv,onChange:w,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen berücksichtigen)"})]})]}),r==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:p.leistung_kwp,onChange:w,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:p.ausrichtung,onChange:L=>f(S=>({...S,ausrichtung:L.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd"}),e.jsx("option",{value:"Südost",children:"Südost"}),e.jsx("option",{value:"Südwest",children:"Südwest"}),e.jsx("option",{value:"Ost",children:"Ost"}),e.jsx("option",{value:"West",children:"West"}),e.jsx("option",{value:"Ost-West",children:"Ost-West"}),e.jsx("option",{value:"Nord",children:"Nord"})]})]}),e.jsx(P,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:p.neigung_grad,onChange:w,hint:"0° = flach, 90° = senkrecht"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Home Assistant Sensor",m&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),e.jsxs("select",{name:"ha_entity_id",value:p.ha_entity_id,onChange:L=>f(S=>({...S,ha_entity_id:L.target.value})),className:"input w-full",children:[e.jsx("option",{value:"",children:"Kein Sensor (manuell)"}),x.map(L=>e.jsxs("option",{value:L.entity_id,children:[L.friendly_name||L.entity_id,L.state&&` (${L.state} ${L.unit_of_measurement||""})`]},L.entity_id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Verknüpfe dieses PV-Modul mit einem String-Sensor für automatische IST-Daten"})]})]})]}),e.jsx(os,{typ:r,paramData:E,onChange:w}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx($,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx($,{type:"submit",loading:i,children:t?"Speichern":"Erstellen"})]})]})}function os({typ:t,paramData:a,onChange:r}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Batteriekapazität (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:a.batteriekapazitaet_kwh,onChange:r}),e.jsx(P,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:a.verbrauch_kwh_100km,onChange:r}),e.jsx(P,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:a.jahresfahrleistung_km,onChange:r}),e.jsx(P,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:a.pv_ladeanteil_prozent,onChange:r,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:a.v2h_faehig,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fähig (Vehicle-to-Home)"})]}),a.v2h_faehig&&e.jsx(P,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.v2h_entladeleistung_kw,onChange:r})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Kapazität (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:a.kapazitaet_kwh,onChange:r}),e.jsx(P,{label:"Nutzbare Kapazität (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:a.nutzbare_kapazitaet_kwh,onChange:r,hint:"Typisch 90-95% der Gesamtkapazität"}),e.jsx(P,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.max_ladeleistung_kw,onChange:r}),e.jsx(P,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.max_entladeleistung_kw,onChange:r}),e.jsx(P,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:a.wirkungsgrad_prozent,onChange:r})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:a.arbitrage_faehig,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fähig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wärmepumpe Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:a.leistung_kw,onChange:r}),e.jsx(P,{label:"COP (Leistungszahl)",name:"param_cop",type:"number",step:"0.1",min:"1",max:"10",value:a.cop,onChange:r,hint:"Typisch 3-5 bei Luft-WP"}),e.jsx(P,{label:"Jahresarbeitszahl",name:"param_jahresarbeitszahl",type:"number",step:"0.1",min:"1",max:"10",value:a.jahresarbeitszahl,onChange:r}),e.jsx(P,{label:"Heizwärmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:a.heizwaermebedarf_kwh,onChange:r}),e.jsx(P,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:a.warmwasserbedarf_kwh,onChange:r})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:a.sg_ready,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fähig)"})]})]});case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(P,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.max_ladeleistung_kw,onChange:r,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:a.bidirektional,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:a.pv_optimiert,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-Überschussladen möglich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:a.max_leistung_kw,onChange:r}),e.jsx(P,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:a.wirkungsgrad_prozent,onChange:r})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:a.hybrid,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return null;case"balkonkraftwerk":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:a.leistung_wp,onChange:r}),e.jsx(P,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:a.anzahl,onChange:r}),e.jsx(P,{label:"Ausrichtung",name:"param_ausrichtung",value:a.ausrichtung,onChange:r,hint:"z.B. Süd, Ost-West"}),e.jsx(P,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:a.neigung_grad,onChange:r})]})]});default:return null}}const Wt=[{typ:"e-auto",label:"E-Auto",icon:fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wärmepumpe",icon:Pe,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:me,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:De,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:Qe,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:ie,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:Na,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:Qe,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function gs(){var L;const{anlagen:t,loading:a}=je(),[r,n]=c.useState(null),[s,i]=c.useState(!1),[o,d]=c.useState(null),[l,x]=c.useState(null),[g,m]=c.useState(null),[h,p]=c.useState(null),f=r??((L=t[0])==null?void 0:L.id),{investitionen:j,loading:_,createInvestition:E,updateInvestition:k,deleteInvestition:w}=Aa(f),N=Er(j),v=c.useMemo(()=>{const S={};return Wt.forEach(G=>{var q;S[G.typ]=((q=N[G.typ])==null?void 0:q.length)||0}),S},[N]),u=S=>{x(S),d(null),i(!0)},A=S=>{d(S),x(S.typ),i(!0)},W=async S=>{try{o?await k(o.id,S):await E(S),i(!1),d(null),x(null)}catch(G){p(G instanceof Error?G.message:"Fehler beim Speichern")}},C=async()=>{if(g)try{await w(g.id),m(null)}catch(S){p(S instanceof Error?S.message:"Fehler beim Löschen")}};return a||_?e.jsx(re,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(J,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:f??"",onChange:S=>n(Number(S.target.value)),className:"input w-auto",children:t.map(S=>e.jsx("option",{value:S.id,children:S.anlagenname},S.id))})})]}),h&&e.jsx(J,{type:"error",onClose:()=>p(null),children:h}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Wt.map(S=>e.jsxs("button",{onClick:()=>u(S.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${S.bgColor}`,children:[e.jsx(S.icon,{className:`h-8 w-8 mx-auto ${S.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:S.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[v[S.typ]," vorhanden"]})]},S.typ))}),j.length===0?e.jsx(tt,{icon:wt,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wärmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs($,{onClick:()=>u("speicher"),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:Wt.map(S=>{const G=N[S.typ];return!G||G.length===0?null:e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${S.bgColor}`,children:e.jsx(S.icon,{className:`h-5 w-5 ${S.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:S.label})]}),e.jsx($,{variant:"secondary",size:"sm",onClick:()=>u(S.typ),children:e.jsx(Xe,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:G.map(q=>e.jsx(xs,{investition:q,onEdit:()=>A(q),onDelete:()=>m(q)},q.id))})]},S.typ)})}),e.jsx(ke,{isOpen:s,onClose:()=>{i(!1),d(null),x(null)},title:o?"Investition bearbeiten":"Neue Investition",size:"lg",children:l&&f&&e.jsx(cs,{investition:o,anlageId:f,typ:l,onSubmit:W,onCancel:()=>{i(!1),d(null),x(null)}})}),e.jsxs(ke,{isOpen:!!g,onClose:()=>m(null),title:"Investition löschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Möchtest du die Investition "',g==null?void 0:g.bezeichnung,'" wirklich löschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx($,{variant:"secondary",onClick:()=>m(null),children:"Abbrechen"}),e.jsx($,{variant:"danger",onClick:C,children:"Löschen"})]})]})]})}function xs({investition:t,onEdit:a,onDelete:r}){const n=t.parameter||{},i=(()=>{const d=[];switch(t.typ){case"e-auto":n.batteriekapazitaet_kwh&&d.push(`${n.batteriekapazitaet_kwh} kWh Batterie`),n.verbrauch_kwh_100km&&d.push(`${n.verbrauch_kwh_100km} kWh/100km`),n.v2h_faehig&&d.push("V2H fähig");break;case"speicher":n.kapazitaet_kwh&&d.push(`${n.kapazitaet_kwh} kWh`),n.nutzbare_kapazitaet_kwh&&d.push(`${n.nutzbare_kapazitaet_kwh} kWh nutzbar`),n.arbitrage_faehig&&d.push("Arbitrage");break;case"waermepumpe":n.leistung_kw&&d.push(`${n.leistung_kw} kW`),n.cop&&d.push(`COP ${n.cop}`);break;case"wallbox":n.max_ladeleistung_kw&&d.push(`${n.max_ladeleistung_kw} kW`),n.bidirektional&&d.push("Bidirektional");break;case"wechselrichter":n.max_leistung_kw&&d.push(`${n.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":n.leistung_wp&&d.push(`${n.leistung_wp} Wp`),n.anzahl&&d.push(`${n.anzahl} Module`);break}return d})(),o=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join(" • ")}),o&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[o.toLocaleString("de-DE")," €"]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(gr,{className:"h-4 w-4"})}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Löschen",children:e.jsx(Ge,{className:"h-4 w-4"})})]})]})}const hs=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"März"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function ha({monatsdaten:t,anlageId:a,onSubmit:r,onCancel:n}){var L,S,G,q,y,V,b;const s=new Date().getFullYear(),i=new Date().getMonth()+1,[o,d]=c.useState(!1),[l,x]=c.useState(null),{investitionen:g,loading:m}=Aa(a),h=c.useMemo(()=>g.filter(z=>z.aktiv),[g]),p=h.some(z=>z.typ==="speicher"),f=h.some(z=>z.typ==="e-auto"),j=h.some(z=>z.typ==="wallbox"),_=h.some(z=>z.typ==="waermepumpe"),E=h.some(z=>z.typ==="wechselrichter"),[k,w]=c.useState({jahr:((L=t==null?void 0:t.jahr)==null?void 0:L.toString())||s.toString(),monat:((S=t==null?void 0:t.monat)==null?void 0:S.toString())||i.toString(),einspeisung_kwh:((G=t==null?void 0:t.einspeisung_kwh)==null?void 0:G.toString())||"",netzbezug_kwh:((q=t==null?void 0:t.netzbezug_kwh)==null?void 0:q.toString())||"",pv_erzeugung_kwh:((y=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:y.toString())||"",batterie_ladung_kwh:((V=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:V.toString())||"",batterie_entladung_kwh:((b=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:b.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[N,v]=c.useState({});c.useEffect(()=>{if(h.length===0)return;const z={};h.forEach(H=>{H.typ==="e-auto"?z[H.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""}:H.typ==="speicher"?z[H.id]={ladung_kwh:"",entladung_kwh:""}:H.typ==="wallbox"?z[H.id]={ladung_kwh:"",ladevorgaenge:""}:H.typ==="waermepumpe"?z[H.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""}:H.typ==="wechselrichter"&&(z[H.id]={pv_erzeugung_kwh:""})}),v(z)},[h]);const u=z=>{const{name:H,value:ee}=z.target;w(te=>({...te,[H]:ee}))},A=(z,H,ee)=>{v(te=>({...te,[z]:{...te[z],[H]:ee}}))},W=c.useMemo(()=>{let z=0,H=0,ee=0;return h.forEach(te=>{const se=N[te.id];se&&(te.typ==="speicher"?(z+=parseFloat(se.ladung_kwh)||0,H+=parseFloat(se.entladung_kwh)||0):te.typ==="wechselrichter"&&(ee+=parseFloat(se.pv_erzeugung_kwh)||0))}),{batterieLadung:z,batterieEntladung:H,pvErzeugung:ee}},[h,N]),C=async z=>{if(z.preventDefault(),x(null),!k.einspeisung_kwh||!k.netzbezug_kwh){x("Bitte Einspeisung und Netzbezug eingeben");return}try{d(!0);const H={};h.forEach(M=>{const K=N[M.id];if(!K)return;const R={};M.typ==="e-auto"?(K.km_gefahren&&(R.km_gefahren=parseFloat(K.km_gefahren)),K.verbrauch_kwh&&(R.verbrauch_kwh=parseFloat(K.verbrauch_kwh)),K.ladung_pv_kwh&&(R.ladung_pv_kwh=parseFloat(K.ladung_pv_kwh)),K.ladung_netz_kwh&&(R.ladung_netz_kwh=parseFloat(K.ladung_netz_kwh)),K.ladung_extern_kwh&&(R.ladung_extern_kwh=parseFloat(K.ladung_extern_kwh)),K.ladung_extern_euro&&(R.ladung_extern_euro=parseFloat(K.ladung_extern_euro)),K.entladung_v2h_kwh&&(R.entladung_v2h_kwh=parseFloat(K.entladung_v2h_kwh))):M.typ==="speicher"?(K.ladung_kwh&&(R.ladung_kwh=parseFloat(K.ladung_kwh)),K.entladung_kwh&&(R.entladung_kwh=parseFloat(K.entladung_kwh))):M.typ==="wallbox"?(K.ladung_kwh&&(R.ladung_kwh=parseFloat(K.ladung_kwh)),K.ladevorgaenge&&(R.ladevorgaenge=parseInt(K.ladevorgaenge))):M.typ==="waermepumpe"?(K.stromverbrauch_kwh&&(R.stromverbrauch_kwh=parseFloat(K.stromverbrauch_kwh)),K.heizenergie_kwh&&(R.heizenergie_kwh=parseFloat(K.heizenergie_kwh)),K.warmwasser_kwh&&(R.warmwasser_kwh=parseFloat(K.warmwasser_kwh))):M.typ==="wechselrichter"&&K.pv_erzeugung_kwh&&(R.pv_erzeugung_kwh=parseFloat(K.pv_erzeugung_kwh)),Object.keys(R).length>0&&(H[M.id]=R)});const ee=k.batterie_ladung_kwh?parseFloat(k.batterie_ladung_kwh):W.batterieLadung||void 0,te=k.batterie_entladung_kwh?parseFloat(k.batterie_entladung_kwh):W.batterieEntladung||void 0,se=k.pv_erzeugung_kwh?parseFloat(k.pv_erzeugung_kwh):W.pvErzeugung||void 0;await r({anlage_id:a,jahr:parseInt(k.jahr),monat:parseInt(k.monat),einspeisung_kwh:parseFloat(k.einspeisung_kwh),netzbezug_kwh:parseFloat(k.netzbezug_kwh),pv_erzeugung_kwh:se,batterie_ladung_kwh:ee,batterie_entladung_kwh:te,notizen:k.notizen||void 0,investitionen_daten:Object.keys(H).length>0?H:void 0})}catch(H){x(H instanceof Error?H.message:"Fehler beim Speichern")}finally{d(!1)}};return m?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"Lade Investitionen..."}):e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[l&&e.jsx(J,{type:"error",children:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(P,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:k.jahr,onChange:u,required:!0,disabled:!!t}),e.jsx(_e,{label:"Monat",name:"monat",value:k.monat,onChange:u,options:hs,required:!0,disabled:!!t})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:k.einspeisung_kwh,onChange:u,placeholder:"z.B. 450",required:!0}),e.jsx(P,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:k.netzbezug_kwh,onChange:u,placeholder:"z.B. 120",required:!0}),e.jsx(P,{label:E?"PV-Erzeugung (Summe oder manuell)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:k.pv_erzeugung_kwh,onChange:u,placeholder:W.pvErzeugung>0?`Summe: ${W.pvErzeugung.toFixed(1)}`:"z.B. 800",hint:W.pvErzeugung>0?`Aus Wechselrichtern: ${W.pvErzeugung.toFixed(1)} kWh`:"Wird berechnet wenn leer"})]})]}),E&&e.jsx(st,{title:"Wechselrichter",icon:ie,iconColor:"text-yellow-500",investitionen:h.filter(z=>z.typ==="wechselrichter"),investitionsDaten:N,onInvChange:A,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),p&&e.jsx(st,{title:"Speicher",icon:me,iconColor:"text-green-500",investitionen:h.filter(z=>z.typ==="speicher"),investitionsDaten:N,onInvChange:A,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}]}),f&&e.jsx(st,{title:"E-Auto",icon:fe,iconColor:"text-blue-500",investitionen:h.filter(z=>z.typ==="e-auto"),investitionsDaten:N,onInvChange:A,felder:[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"€",placeholder:"z.B. 18.00"},{key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"}]}),j&&e.jsx(st,{title:"Wallbox",icon:De,iconColor:"text-purple-500",investitionen:h.filter(z=>z.typ==="wallbox"),investitionsDaten:N,onInvChange:A,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgänge",unit:"",placeholder:"z.B. 12"}]}),_&&e.jsx(st,{title:"Wärmepumpe",icon:Pe,iconColor:"text-orange-500",investitionen:h.filter(z=>z.typ==="waermepumpe"),investitionsDaten:N,onInvChange:A,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),!p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:k.batterie_ladung_kwh,onChange:u,placeholder:"z.B. 150"}),e.jsx(P,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:k.batterie_entladung_kwh,onChange:u,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:k.notizen,onChange:u,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx($,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx($,{type:"submit",loading:o,children:t?"Speichern":"Monat erfassen"})]})]})}function st({title:t,icon:a,iconColor:r,investitionen:n,investitionsDaten:s,onInvChange:i,felder:o}){return n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:`h-5 w-5 ${r}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),n.map(d=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:d.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:o.map(l=>{var x;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[l.label," ",l.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",l.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=s[d.id])==null?void 0:x[l.key])||"",onChange:g=>i(d.id,l.key,g.target.value),placeholder:l.placeholder,className:"input text-sm py-1.5",title:l.hint}),l.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:l.hint,children:l.hint})]},l.key)})})]},d.id))]})}const ma=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],ms=["","Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];function us(){const t=Nt(),{anlagen:a,loading:r}=je(),[n,s]=c.useState(void 0),{monatsdaten:i,loading:o,error:d,createMonatsdaten:l,updateMonatsdaten:x,deleteMonatsdaten:g,refresh:m}=Qt(n),[h,p]=c.useState(!1),[f,j]=c.useState(null),[_,E]=c.useState(null),[k,w]=c.useState(!1),[N,v]=c.useState(null),[u,A]=c.useState(!1),[W,C]=c.useState(null),[L,S]=c.useState(!1),[G,q]=c.useState(null),[y,V]=c.useState(new Date().getFullYear());!n&&a.length>0&&!r&&s(a[0].id);const b=async()=>{if(n)try{A(!0),C(null),q(null);const M=await $e.getImportPreview(n,y);v(M)}catch(M){C(M instanceof Error?M.message:"Fehler beim Laden der HA-Vorschau"),v(null)}finally{A(!1)}},z=async(M,K=!1)=>{if(n)try{S(!0),C(null);const R=await $e.importMonatsdaten(n,y,M,K);R.erfolg?(q(`${R.monate_importiert} Monat${R.monate_importiert!==1?"e":""} importiert`),await b(),await m()):C(R.fehler||"Import fehlgeschlagen")}catch(R){C(R instanceof Error?R.message:"Fehler beim Import")}finally{S(!1)}};c.useEffect(()=>{k&&n&&b()},[k,n,y]);const H=async M=>{await l(M),p(!1)},ee=async M=>{f&&(await x(f.id,M),j(null))},te=async()=>{_&&(await g(_.id),E(null))},se=M=>M!=null&&typeof M=="number"?M.toLocaleString("de-DE",{maximumFractionDigits:1}):"-";return r||o?e.jsx(re,{text:"Lade Daten..."}):a.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(I,{children:e.jsx(tt,{icon:Ke,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx($,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_e,{value:(n==null?void 0:n.toString())||"",onChange:M=>s(parseInt(M.target.value)),options:a.map(M=>({value:M.id.toString(),label:M.anlagenname}))}),e.jsxs($,{variant:"secondary",onClick:()=>w(!0),children:[e.jsx(Ue,{className:"h-5 w-5 mr-2"}),"Aus HA importieren"]}),e.jsxs($,{onClick:()=>p(!0),children:[e.jsx(Xe,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),d&&e.jsx(J,{type:"error",children:d}),i.length===0?e.jsx(I,{children:e.jsx(tt,{icon:St,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx($,{onClick:()=>p(!0),children:"Manuell erfassen"}),e.jsx($,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsx(I,{padding:"none",children:e.jsxs(Ut,{children:[e.jsx(Yt,{children:e.jsxs(et,{children:[e.jsx(ce,{children:"Monat"}),e.jsx(ce,{className:"text-right",children:"Einspeisung"}),e.jsx(ce,{className:"text-right",children:"Netzbezug"}),e.jsx(ce,{className:"text-right",children:"PV-Erzeugung"}),e.jsx(ce,{className:"text-right",children:"Eigenverbrauch"}),e.jsx(ce,{className:"text-right",children:"Autarkie"}),e.jsx(ce,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Xt,{children:i.map(M=>{const K=M.eigenverbrauch_kwh||0,R=K+M.netzbezug_kwh,Le=R>0?K/R*100:0;return e.jsxs(et,{children:[e.jsx(oe,{children:e.jsxs("span",{className:"font-medium",children:[ma[M.monat]," ",M.jahr]})}),e.jsx(oe,{className:"text-right font-mono",children:se(M.einspeisung_kwh)}),e.jsx(oe,{className:"text-right font-mono",children:se(M.netzbezug_kwh)}),e.jsx(oe,{className:"text-right font-mono",children:se(M.pv_erzeugung_kwh)}),e.jsx(oe,{className:"text-right font-mono",children:se(M.eigenverbrauch_kwh)}),e.jsx(oe,{className:"text-right",children:e.jsxs("span",{className:Le>=50?"text-green-600":"text-gray-600",children:[Le.toFixed(1),"%"]})}),e.jsx(oe,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>j(M),children:e.jsx(Jt,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>E(M),children:e.jsx(Ge,{className:"h-4 w-4 text-red-500"})})]})})]},M.id)})})]})}),e.jsx(ke,{isOpen:h,onClose:()=>p(!1),title:"Monatsdaten erfassen",size:"lg",children:n&&e.jsx(ha,{anlageId:n,onSubmit:H,onCancel:()=>p(!1)})}),e.jsx(ke,{isOpen:!!f,onClose:()=>j(null),title:"Monatsdaten bearbeiten",size:"lg",children:f&&n&&e.jsx(ha,{monatsdaten:f,anlageId:n,onSubmit:ee,onCancel:()=>j(null)})}),e.jsx(ke,{isOpen:!!_,onClose:()=>E(null),title:"Monatsdaten löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Daten für ",e.jsxs("strong",{children:[ma[(_==null?void 0:_.monat)||0]," ",_==null?void 0:_.jahr]})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx($,{variant:"secondary",onClick:()=>E(null),children:"Abbrechen"}),e.jsx($,{variant:"danger",onClick:te,children:"Löschen"})]})]})}),e.jsx(ke,{isOpen:k,onClose:()=>{w(!1),v(null),C(null),q(null)},title:"Monatsdaten aus Home Assistant importieren",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Jahr:"}),e.jsx(_e,{value:y.toString(),onChange:M=>V(parseInt(M.target.value)),options:Array.from({length:10},(M,K)=>{const R=new Date().getFullYear()-K;return{value:R.toString(),label:R.toString()}})}),e.jsx($,{variant:"ghost",size:"sm",onClick:b,disabled:u,children:e.jsx(we,{className:`h-4 w-4 ${u?"animate-spin":""}`})})]}),W&&e.jsx(J,{type:"error",children:W}),G&&e.jsx(J,{type:"success",children:G}),u&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(re,{text:"Lade HA-Daten..."})}),N&&!u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-2",children:N.ha_verbunden?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:"HA verbunden"})]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"HA nicht verbunden"})]})}),e.jsx("div",{className:"flex items-center gap-2",children:N.sensor_konfiguriert?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:"PV-Sensor konfiguriert"})]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Kein PV-Sensor konfiguriert"})]})})]}),N.ha_verbunden&&N.sensor_konfiguriert&&!N.monate.some(M=>M.pv_erzeugung_ha!==null)&&e.jsxs(J,{type:"warning",children:["Keine Statistiken in Home Assistant für ",y,' gefunden. Stelle sicher, dass der Sensor "Long-Term Statistics" aktiviert hat (state_class: total_increasing) und für den gewählten Zeitraum Daten vorhanden sind.']}),N.monate.length>0?e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Monat"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"In DB"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"In HA"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-right p-3 font-medium",children:"Aktion"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:N.monate.map(M=>e.jsx(ps,{monat:M,jahr:y,onImport:K=>z(M.monat,K),importing:L},M.monat))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["Keine Daten für ",y," verfügbar"]}),N.monate.some(M=>M.kann_importieren)&&e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs($,{onClick:()=>z(void 0,!1),disabled:L,children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Alle fehlenden importieren"]})})]}),!N&&!u&&!W&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ue,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Home Assistant Integration nicht verfügbar."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Bitte konfiguriere die HA-Sensoren in den Add-on-Einstellungen."})]})]})})]})}function ps({monat:t,jahr:a,onImport:r,importing:n}){const s=i=>i!=null&&typeof i=="number"?i.toLocaleString("de-DE",{maximumFractionDigits:1})+" kWh":"-";return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsxs("td",{className:"p-3 font-medium",children:[ms[t.monat]," ",a]}),e.jsxs("td",{className:"p-3 text-right font-mono text-gray-600 dark:text-gray-400",children:[s(t.pv_erzeugung_db),t.datenquelle&&e.jsxs("span",{className:"ml-1 text-xs text-gray-400",children:["(",t.datenquelle,")"]})]}),e.jsx("td",{className:"p-3 text-right font-mono text-cyan-600 dark:text-cyan-400",children:s(t.pv_erzeugung_ha)}),e.jsx("td",{className:"p-3 text-center",children:t.existiert_in_db?t.kann_aktualisieren?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-yellow-600 dark:text-yellow-400",children:[e.jsx(we,{className:"w-3 h-3"}),"Aktualisierbar"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(Me,{className:"w-3 h-3"}),"Vorhanden"]}):t.pv_erzeugung_ha!==null?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-blue-600 dark:text-blue-400",children:[e.jsx(He,{className:"w-3 h-3"}),"Importierbar"]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Keine Daten"})}),e.jsxs("td",{className:"p-3 text-right",children:[t.kann_importieren&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(!1),disabled:n,children:e.jsx(He,{className:"h-4 w-4"})}),t.kann_aktualisieren&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(!0),disabled:n,title:"Mit HA-Daten überschreiben",children:e.jsx(we,{className:"h-4 w-4 text-yellow-500"})})]})]})}function ua(){var V;const{anlagen:t,loading:a,refresh:r}=je(),[n,s]=c.useState(null),[i,o]=c.useState(!1),[d,l]=c.useState(!1),[x,g]=c.useState(null),[m,h]=c.useState(null),[p,f]=c.useState(!1),[j,_]=c.useState(!1),[E,k]=c.useState(null),w=c.useRef(null),N=t.some(b=>b.anlagenname==="Demo-Anlage"),v=n??((V=t[0])==null?void 0:V.id),u=b=>{b.preventDefault(),o(!0)},A=b=>{b.preventDefault(),o(!1)},W=async b=>{b.preventDefault(),o(!1);const z=b.dataTransfer.files;z.length>0&&await L(z[0])},C=async b=>{const z=b.target.files;z&&z.length>0&&await L(z[0]),w.current&&(w.current.value="")},L=async b=>{if(!v){h("Bitte zuerst eine Anlage auswählen");return}if(!b.name.endsWith(".csv")){h("Bitte eine CSV-Datei auswählen");return}h(null),g(null),l(!0);try{const z=await at.importCSV(v,b,p);g(z)}catch(z){h(z instanceof Error?z.message:"Import fehlgeschlagen")}finally{l(!1)}},S=()=>{if(!v){h("Bitte zuerst eine Anlage auswählen");return}window.location.href=at.getTemplateDownloadUrl(v)},G=()=>{if(!v){h("Bitte zuerst eine Anlage auswählen");return}window.location.href=at.getExportUrl(v)},q=async()=>{h(null),k(null),_(!0);try{const b=await at.createDemoData();k(b),r()}catch(b){h(b instanceof Error?b.message:"Fehler beim Erstellen der Demo-Daten")}finally{_(!1)}},y=async()=>{h(null),k(null),_(!0);try{await at.deleteDemoData(),r()}catch(b){h(b instanceof Error?b.message:"Fehler beim Löschen der Demo-Daten")}finally{_(!1)}};return a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(J,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(lt,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wärmepumpe und 31 Monaten Testdaten."}),e.jsxs($,{onClick:q,loading:j,className:"w-full",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),E&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(Oe,{className:"inline h-4 w-4 mr-1"}),E.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),t.length>1&&e.jsx("select",{value:v??"",onChange:b=>s(Number(b.target.value)),className:"input w-auto",children:t.map(b=>e.jsx("option",{value:b.id,children:b.anlagenname},b.id))})]}),m&&e.jsx(J,{type:"error",onClose:()=>h(null),children:m}),x&&e.jsx(bs,{result:x,onClose:()=>g(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(lr,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthält alle verfügbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs($,{variant:"secondary",className:"w-full",onClick:S,children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:u,onDragLeave:A,onDrop:W,onClick:()=>{var b;return(b=w.current)==null?void 0:b.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${d?"opacity-50 pointer-events-none":""}
              `,children:d?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(re,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pr,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:w,type:"file",accept:".csv",onChange:C,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:b=>f(b.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten überschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs($,{variant:"secondary",size:"sm",onClick:G,children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-50 dark:bg-cyan-900/20",children:e.jsx(Ue,{className:"h-6 w-6 text-cyan-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Daten direkt aus deinem Home Assistant Energy Dashboard."}),e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:[e.jsx("strong",{children:"Phase 2:"})," Diese Funktion wird in einer zukünftigen Version verfügbar sein. Konfiguriere zuerst die Sensor-Zuordnung in den Einstellungen."]}),e.jsx($,{variant:"secondary",className:"w-full",disabled:!0,children:"Aus Home Assistant importieren"})]}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(lt,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:N?"Demo-Anlage ist bereits vorhanden. Du kannst sie löschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit PV-System, Speicher, E-Auto, Wärmepumpe und 31 Monaten Testdaten."}),N?e.jsxs($,{variant:"danger",onClick:y,loading:j,className:"w-full",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Demo-Anlage löschen"]}):e.jsxs($,{onClick:q,loading:j,className:"w-full",children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),E&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(Oe,{className:"inline h-4 w-4 mr-1"}),E.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthält:"})," 20 kWp PV-Anlage, 15 kWh Speicher, Tesla Model 3 mit V2H, Wärmepumpe, Wallbox, Strompreise 2023-2025"]})]})]}),e.jsxs(I,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[e.jsx("p",{children:"Das CSV muss folgende Pflichtspalten enthalten:"}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{className:"mt-2",children:"Optionale Spalten für erweiterte Auswertungen:"}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," - Gesamte PV-Erzeugung"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Direktverbrauch_kWh"})," - Direkter Eigenverbrauch"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Batterie_Ladung_kWh"})," - Batterieladung"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Batterie_Entladung_kWh"})," - Batterieentladung"]})]})]})]})]})}function bs({result:t,onClose:a}){const r=t.erfolg&&t.fehler.length===0;return e.jsxs("div",{className:`
      relative p-4 rounded-lg border
      ${r?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}
    `,children:[e.jsx("button",{onClick:a,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Zt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[r?e.jsx(Oe,{className:"h-5 w-5 text-green-500 mt-0.5"}):e.jsx(vt,{className:"h-5 w-5 text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${r?"text-green-800 dark:text-green-200":"text-yellow-800 dark:text-yellow-200"}`,children:r?"Import erfolgreich":"Import mit Warnungen"}),e.jsxs("div",{className:"text-sm mt-1 space-y-1",children:[e.jsxs("p",{className:r?"text-green-700 dark:text-green-300":"text-yellow-700 dark:text-yellow-300",children:[t.importiert," Datensätze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} übersprungen`]}),t.fehler.length>0&&e.jsxs("ul",{className:"list-disc list-inside text-yellow-700 dark:text-yellow-300",children:[t.fehler.slice(0,5).map((n,s)=>e.jsx("li",{children:n},s)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]})]})]})]})}function pa(){const{theme:t,setTheme:a}=Ca(),[r,n]=c.useState(null),[s,i]=c.useState(null),[o,d]=c.useState([]),[l,x]=c.useState([]),[g,m]=c.useState(!0),[h,p]=c.useState(null),[f,j]=c.useState(!1),[_,E]=c.useState(null),k=async()=>{try{m(!0),p(null);const[w,N,v]=await Promise.all([sa.getStats(),sa.getSettings(),Ie.list()]);if(n(w),i(N),x(v),v.length>0&&!_&&E(v[0].id),N.ha_integration_enabled)try{const u=await $e.getSensors();d(u)}catch{}}catch(w){p(w instanceof Error?w.message:"Fehler beim Laden der Einstellungen")}finally{m(!1)}};return c.useEffect(()=>{k()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:k,disabled:g,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(we,{className:`h-5 w-5 ${g?"animate-spin":""}`})})]}),h&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:h})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:ie},{value:"dark",label:"Dunkel",icon:Sa},{value:"system",label:"System",icon:_a}].map(w=>e.jsxs("button",{onClick:()=>a(w.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===w.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(w.icon,{className:"h-5 w-5"}),w.label]},w.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ue,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:s!=null&&s.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),o.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",o.length," Energy-Sensoren verfügbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(gt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Sensor-Zuordnung (Monatsdaten-Import)"}),e.jsx("div",{className:"space-y-3",children:[{key:"pv_erzeugung",label:"PV-Erzeugung",description:"Gesamt PV-Ertrag"},{key:"einspeisung",label:"Einspeisung",description:"Ins Netz eingespeist"},{key:"netzbezug",label:"Netzbezug",description:"Aus Netz bezogen"},{key:"batterie_ladung",label:"Batterie Ladung",description:"In Batterie geladen"},{key:"batterie_entladung",label:"Batterie Entladung",description:"Aus Batterie entnommen"}].map(({key:w,label:N,description:v})=>{var W;const u=s==null?void 0:s.ha_sensors_configured[w],A=(W=s==null?void 0:s.ha_sensors)==null?void 0:W[w];return e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:N}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:v})]}),u?e.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600 dark:text-green-400",children:[e.jsx(Me,{className:"w-4 h-4"}),"Konfiguriert"]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Nicht konfiguriert"})]}),A&&e.jsx("code",{className:"mt-2 block text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded font-mono",children:A})]},w)})}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Konfiguration über Add-on-Einstellungen"}),e.jsxs("p",{children:["Die Sensor-Zuordnung erfolgt in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen → Add-ons → EEDC → Konfiguration"}),". Dort können die Entity-IDs der Energy-Sensoren (state_class: total_increasing) eingetragen werden."]})]})]}),(s==null?void 0:s.ha_integration_enabled)&&l.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Auto-Discovery"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten (SMA, evcc, Smart, Wallbox) und erstelle Investitionen."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>1&&e.jsx("select",{value:_||"",onChange:w=>E(Number(w.target.value)),className:"text-sm px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:l.map(w=>e.jsx("option",{value:w.id,children:w.anlagenname},w.id))}),e.jsxs("button",{onClick:()=>j(!0),disabled:!_,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ct,{className:"w-4 h-4"}),"Geräte erkennen"]})]})]})}),o.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfügbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map(w=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:w.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:w.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:w.unit_of_measurement||"-"})]},w.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(nr,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),g?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Rt,{className:"h-6 w-6 animate-spin text-gray-400"})}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),r.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(r.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",r.daten_zeitraum&&e.jsxs("span",{children:[" (",r.daten_zeitraum.von," - ",r.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",r.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(s==null?void 0:s.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfügbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"/api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]}),f&&_&&e.jsx(Fa,{isOpen:!0,onClose:()=>j(!1),anlageId:_,onInvestitionenCreated:k})]})}const ba=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function ys(){const{anlagen:t,loading:a}=je(),[r,n]=c.useState(),[s,i]=c.useState(null),[o,d]=c.useState([]),[l,x]=c.useState(null),[g,m]=c.useState(null),[h,p]=c.useState(!1),[f,j]=c.useState(!1),[_,E]=c.useState(!1),[k,w]=c.useState(null),[N,v]=c.useState(null),[u,A]=c.useState(14);c.useEffect(()=>{t.length>0&&!r&&n(t[0].id)},[t,r]),c.useEffect(()=>{r&&W()},[r]);const W=async()=>{if(r){p(!0),w(null),v(null);try{const[b,z]=await Promise.all([Ce.getAktivePrognose(r),Ce.listeGespeichertePrognosen(r)]);i(b),d(z)}catch(b){w(b instanceof Error?b.message:"Fehler beim Laden")}finally{p(!1)}}},C=async()=>{if(r){j(!0),w(null);try{const b=await Ce.getPrognose(r,{system_losses:u});x(b)}catch(b){w(b instanceof Error?b.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{j(!1)}}},L=async()=>{if(r){E(!0),w(null);try{const b=await Ce.getOptimum(r);m(b)}catch(b){w(b instanceof Error?b.message:"Fehler beim Ermitteln des Optimums")}finally{E(!1)}}},S=async()=>{if(r){p(!0),w(null);try{await Ce.speicherePrognose(r,{system_losses:u}),v("Prognose erfolgreich gespeichert"),x(null),await W()}catch(b){w(b instanceof Error?b.message:"Fehler beim Speichern")}finally{p(!1)}}},G=async b=>{try{await Ce.aktivierePrognose(b),v("Prognose aktiviert"),await W()}catch(z){w(z instanceof Error?z.message:"Fehler beim Aktivieren")}},q=async b=>{if(confirm("Prognose wirklich löschen?"))try{await Ce.loeschePrognose(b),v("Prognose gelöscht"),await W()}catch(z){w(z instanceof Error?z.message:"Fehler beim Löschen")}},y=t.find(b=>b.id===r),V=(y==null?void 0:y.latitude)&&(y==null?void 0:y.longitude);return a?e.jsx(re,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"}),e.jsx(J,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(_e,{value:(r==null?void 0:r.toString())||"",onChange:b=>n(parseInt(b.target.value)),options:t.map(b=>({value:b.id.toString(),label:b.anlagenname}))}),e.jsx("button",{onClick:W,disabled:h,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(we,{className:`h-5 w-5 ${h?"animate-spin":""}`})})]})]}),k&&e.jsx(J,{type:"error",children:k}),N&&e.jsx(J,{type:"success",children:N}),!V&&e.jsx(J,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(zt,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergänze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu können."})]})]})}),V&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),h?e.jsx(re,{}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[s.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[s.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[s.neigung_grad,"°"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:s.ausrichtung_richtung})]})]}),s.monatswerte&&s.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:s.monatswerte.map(b=>({name:ba[b.monat],prognose:b.e_m})),children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name"}),e.jsx(ae,{tickFormatter:b=>`${b} kWh`}),e.jsx(Q,{formatter:b=>`${b.toFixed(0)} kWh`}),e.jsx(Y,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(s.abgerufen_am).toLocaleDateString("de-DE")," • ","Koordinaten: ",s.latitude.toFixed(4),"°N, ",s.longitude.toFixed(4),"°E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ie,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:u,onChange:b=>A(parseFloat(b.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs($,{onClick:C,disabled:f,className:"w-full",children:[f?e.jsx(we,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(He,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),l&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs($,{onClick:S,disabled:h,children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:l.module.length})]})]}),l.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:l.module.map(b=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:b.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[b.leistung_kwp," kWp • ",b.ausrichtung," • ",b.neigung_grad,"° • ",b.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},b.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(xe,{data:l.monatsdaten.map(b=>({name:ba[b.monat],ertrag:b.e_m})),children:[e.jsx(ne,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"name",fontSize:10}),e.jsx(ae,{tickFormatter:b=>`${b}`}),e.jsx(Q,{formatter:b=>`${b.toFixed(0)} kWh`}),e.jsx(Y,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(sr,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs($,{onClick:L,disabled:_,variant:"secondary",children:[_?e.jsx(we,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter für Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[g.optimal.neigung_grad,"°"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:g.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[g.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),g.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:g.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung für deinen Standort zu ermitteln.'})]}),o.length>0&&e.jsxs(I,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:o.map(b=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(b.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[b.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:b.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[b.neigung_grad,"°"]}),e.jsx("td",{className:"text-center py-2 px-2",children:b.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!b.ist_aktiv&&e.jsx("button",{onClick:()=>G(b.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>q(b.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Löschen",children:e.jsx(Ge,{className:"h-4 w-4"})})]})})]},b.id))})]})})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Über PVGIS"}),e.jsx("p",{children:"PVGIS (Photovoltaic Geographical Information System) ist ein Tool der EU-Kommission, das PV-Ertragsprognosen basierend auf Satellitendaten und Klimamodellen berechnet. Die Prognosen berücksichtigen Standort, Modulneigung, Ausrichtung und Systemverluste."}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"Mehr erfahren →"})]})]})})]})]})}function js(){return e.jsx(Ba,{children:e.jsx(Oa,{children:e.jsxs(U,{path:"/",element:e.jsx(Nr,{}),children:[e.jsx(U,{index:!0,element:e.jsx(pe,{to:"/cockpit",replace:!0})}),e.jsx(U,{path:"cockpit",element:e.jsx(Fr,{})}),e.jsx(U,{path:"cockpit/e-auto",element:e.jsx(Wr,{})}),e.jsx(U,{path:"cockpit/waermepumpe",element:e.jsx($r,{})}),e.jsx(U,{path:"cockpit/speicher",element:e.jsx(Br,{})}),e.jsx(U,{path:"cockpit/wallbox",element:e.jsx(Kr,{})}),e.jsx(U,{path:"auswertungen",element:e.jsx(da,{})}),e.jsx(U,{path:"auswertungen/roi",element:e.jsx(Zr,{})}),e.jsx(U,{path:"auswertungen/prognose",element:e.jsx(Yr,{})}),e.jsx(U,{path:"auswertungen/export",element:e.jsx(da,{})})," ",e.jsx(U,{path:"einstellungen/anlage",element:e.jsx(ls,{})}),e.jsx(U,{path:"einstellungen/strompreise",element:e.jsx(is,{})}),e.jsx(U,{path:"einstellungen/investitionen",element:e.jsx(gs,{})}),e.jsx(U,{path:"einstellungen/monatsdaten",element:e.jsx(us,{})}),e.jsx(U,{path:"einstellungen/import",element:e.jsx(ua,{})}),e.jsx(U,{path:"einstellungen/demo",element:e.jsx(ua,{})})," ",e.jsx(U,{path:"einstellungen/pvgis",element:e.jsx(ys,{})}),e.jsx(U,{path:"einstellungen/ha-integration",element:e.jsx(pa,{})})," ",e.jsx(U,{path:"einstellungen/allgemein",element:e.jsx(pa,{})}),e.jsx(U,{path:"dashboard",element:e.jsx(pe,{to:"/cockpit",replace:!0})}),e.jsx(U,{path:"anlagen",element:e.jsx(pe,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(U,{path:"monatsdaten",element:e.jsx(pe,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(U,{path:"strompreise",element:e.jsx(pe,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(U,{path:"investitionen",element:e.jsx(pe,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(U,{path:"auswertung",element:e.jsx(pe,{to:"/auswertungen",replace:!0})}),e.jsx(U,{path:"roi",element:e.jsx(pe,{to:"/auswertungen/roi",replace:!0})}),e.jsx(U,{path:"e-auto",element:e.jsx(pe,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(U,{path:"waermepumpe",element:e.jsx(pe,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(U,{path:"speicher",element:e.jsx(pe,{to:"/cockpit/speicher",replace:!0})}),e.jsx(U,{path:"wallbox",element:e.jsx(pe,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(U,{path:"import",element:e.jsx(pe,{to:"/einstellungen/import",replace:!0})}),e.jsx(U,{path:"settings",element:e.jsx(pe,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function ks({onNext:t}){return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(ie,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei EEDC"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persönliches Energie Effizienz Data Center für die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(Pt,{icon:e.jsx(wa,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(Pt,{icon:e.jsx(wt,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen für alle Ihre Energie-Investitionen"}),e.jsx(Pt,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"Home Assistant",description:"Automatischer Datenimport direkt aus Ihrem Smart Home"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(nt,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(nt,{number:2,text:"Home Assistant Verbindung prüfen"}),e.jsx(nt,{number:3,text:"Stromtarif konfigurieren (mit Vorschlägen)"}),e.jsx(nt,{number:4,text:"Geräte automatisch aus HA erkennen"}),e.jsx(nt,{number:5,text:"Investitionen vervollständigen"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(ye,{className:"w-5 h-5"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"})]})]})}function Pt({icon:t,title:a,description:r}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:a}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r})]})}function nt({number:t,text:a}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a})]})}const fs=[{value:"",label:"-- Auswählen --"},{value:"Süd",label:"Süd (optimal)"},{value:"Südost",label:"Südost"},{value:"Südwest",label:"Südwest"},{value:"Ost",label:"Ost"},{value:"West",label:"West"},{value:"Ost-West",label:"Ost-West"}],vs=[{value:"",label:"-- Unbekannt / Andere --"},{value:"sma",label:"SMA"},{value:"fronius",label:"Fronius"},{value:"kostal",label:"Kostal"},{value:"huawei",label:"Huawei / FusionSolar"},{value:"growatt",label:"Growatt"},{value:"solax",label:"SolaX"},{value:"sungrow",label:"Sungrow"},{value:"goodwe",label:"GoodWe"},{value:"enphase",label:"Enphase"}];function ws({isLoading:t,error:a,onSubmit:r,onBack:n}){const[s,i]=c.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:"",ausrichtung:"",neigung_grad:"",wechselrichter_hersteller:""}),[o,d]=c.useState(null),l=m=>{const{name:h,value:p}=m.target;i(f=>({...f,[h]:p})),d(null)},x=async m=>{if(m.preventDefault(),d(null),!s.anlagenname.trim()){d("Bitte geben Sie einen Namen für Ihre Anlage ein");return}if(!s.leistung_kwp||parseFloat(s.leistung_kwp)<=0){d("Bitte geben Sie die Anlagenleistung in kWp ein");return}await r({anlagenname:s.anlagenname.trim(),leistung_kwp:parseFloat(s.leistung_kwp),installationsdatum:s.installationsdatum||void 0,standort_plz:s.standort_plz||void 0,standort_ort:s.standort_ort||void 0,latitude:s.latitude?parseFloat(s.latitude):void 0,longitude:s.longitude?parseFloat(s.longitude):void 0,ausrichtung:s.ausrichtung||void 0,neigung_grad:s.neigung_grad?parseFloat(s.neigung_grad):void 0,wechselrichter_hersteller:s.wechselrichter_hersteller||void 0})},g=o||a;return e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),g&&e.jsx(J,{type:"error",className:"mb-6",children:g}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:s.anlagenname,onChange:l,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:s.leistung_kwp,onChange:l,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(St,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",value:s.installationsdatum,onChange:l,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für korrekten Start der Stromtarif-Gültigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(zt,{className:"w-4 h-4 text-gray-500"}),"Standort (optional, für PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:s.standort_plz,onChange:l,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:s.standort_ort,onChange:l,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:s.latitude,onChange:l,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Längengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:s.longitude,onChange:l,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Die Koordinaten werden für die PVGIS-Ertragsprognose benötigt. Sie können diese später unter Einstellungen → PVGIS ergänzen."})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Technische Daten (optional)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsx("select",{name:"ausrichtung",value:s.ausrichtung,onChange:l,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:fs.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",name:"neigung_grad",value:s.neigung_grad,onChange:l,placeholder:"z.B. 30",min:"0",max:"90",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Typisch: 30-35° (Süd), 10-15° (Ost-West)"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Wechselrichter-Hersteller (optional)"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hersteller"}),e.jsx("select",{name:"wechselrichter_hersteller",value:s.wechselrichter_hersteller,onChange:l,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:vs.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Hilft bei der automatischen Erkennung von Home Assistant Sensoren"})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(ye,{className:"w-4 h-4"})]})})]})]})}function Ns({isLoading:t,error:a,haConnected:r,haVersion:n,onRetry:s,onNext:i,onSkip:o,onBack:d}){return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${r?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:r?e.jsx(qt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(ot,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Home Assistant Verbindung"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatischer Datenimport aus Ihrem Smart Home"})]})]}),e.jsxs("div",{className:"space-y-6",children:[t?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx(we,{className:"w-8 h-8 text-amber-500 animate-spin"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Verbindung wird geprüft..."})]}):r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(be,{className:"w-10 h-10 text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Verbindung erfolgreich!"}),n&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Home Assistant Version: ",n]}),e.jsxs("div",{className:"max-w-md mx-auto bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-medium text-green-800 dark:text-green-300 mb-2",children:"Folgende Funktionen sind verfügbar:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-green-700 dark:text-green-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Automatische Geräte-Erkennung"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Sensor-Zuordnung für Energy-Daten"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Monatsdaten-Import aus HA History"]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(ot,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Keine Verbindung zu Home Assistant"}),a&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:a}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 text-left mb-6",children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-300 mb-2 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Mögliche Ursachen:"]}),e.jsxs("ul",{className:"space-y-1 text-sm text-amber-700 dark:text-amber-400",children:[e.jsx("li",{children:"• EEDC läuft nicht als Home Assistant Add-on"}),e.jsx("li",{children:"• Home Assistant API nicht erreichbar"}),e.jsx("li",{children:"• Supervisor Token fehlt"})]})]}),e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(we,{className:"w-4 h-4"}),"Erneut prüfen"]})]})]}),!t&&!r&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Sie können EEDC auch ohne Home Assistant nutzen. Monatsdaten können manuell oder per CSV-Import erfasst werden. Die HA-Integration kann jederzeit später aktiviert werden."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!r&&e.jsxs("button",{type:"button",onClick:o,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(Et,{className:"w-4 h-4"}),"Überspringen"]}),e.jsxs("button",{type:"button",onClick:i,disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(ye,{className:"w-4 h-4"})]})]})]})]})}function _s({anlage:t,isLoading:a,error:r,onSubmit:n,onUseDefaults:s,onBack:i}){const o=t?Ma(t.leistung_kwp):Be.einspeiseverguetung_cent_kwh,[d,l]=c.useState({netzbezug_arbeitspreis_cent_kwh:Be.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:o.toString(),grundpreis_euro_monat:Be.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[x,g]=c.useState(null),m=f=>{const{name:j,value:_}=f.target;l(E=>({...E,[j]:_})),g(null)},h=async f=>{if(f.preventDefault(),g(null),!d.netzbezug_arbeitspreis_cent_kwh||parseFloat(d.netzbezug_arbeitspreis_cent_kwh)<0){g("Bitte geben Sie einen gültigen Netzbezugspreis ein");return}if(!d.gueltig_ab){g("Bitte geben Sie ein Gültigkeitsdatum ein");return}await n({netzbezug_arbeitspreis_cent_kwh:parseFloat(d.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(d.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:d.grundpreis_euro_monat?parseFloat(d.grundpreis_euro_monat):void 0,gueltig_ab:d.gueltig_ab,tarifname:d.tarifname||void 0,anbieter:d.anbieter||void 0})},p=x||r;return e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Für korrekte Wirtschaftlichkeitsberechnungen"})]})]}),p&&e.jsx(J,{type:"error",className:"mb-6",children:p}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:s,disabled:a,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(lt,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[Be.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",o," ct Einspeisung |"," ",Be.grundpreis_euro_monat," € Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:d.netzbezug_arbeitspreis_cent_kwh,onChange:m,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergütung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:d.einspeiseverguetung_cent_kwh,onChange:m,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"≤10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (€/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:d.grundpreis_euro_monat,onChange:m,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gültig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",value:d.gueltig_ab,onChange:m,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:d.tarifname,onChange:m,placeholder:"z.B. Ökostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:d.anbieter,onChange:m,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können später weitere Stromtarife mit unterschiedlichen Gültigkeitszeiträumen hinzufügen, z.B. bei Tarifwechsel oder Preisänderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:a,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(ye,{className:"w-4 h-4"})]})})]})]})}const ya=[{value:"Süd",label:"Süd (optimal)"},{value:"Südost",label:"Südost"},{value:"Südwest",label:"Südwest"},{value:"Ost",label:"Ost"},{value:"West",label:"West"},{value:"Nord",label:"Nord"}];function Ss({anlagenLeistungKwp:t,pvModule:a,isLoading:r,error:n,onAddModule:s,onUpdateModule:i,onRemoveModule:o,onNext:d,onSkip:l,onBack:x}){const[g,m]=c.useState(a.length===0),[h,p]=c.useState({bezeichnung:"",leistung_kwp:"",ausrichtung:"Süd",neigung_grad:"30"}),f=a.reduce((k,w)=>k+w.leistung_kwp,0),j=t-f,_=()=>{!h.bezeichnung.trim()||!h.leistung_kwp||(s({bezeichnung:h.bezeichnung.trim(),leistung_kwp:parseFloat(h.leistung_kwp),ausrichtung:h.ausrichtung,neigung_grad:parseFloat(h.neigung_grad)}),p({bezeichnung:"",leistung_kwp:j>0?Math.min(j,parseFloat(h.leistung_kwp)).toString():"",ausrichtung:"Süd",neigung_grad:"30"}),m(!1))},E=()=>{const k=a.length+1;return`PV ${{Süd:"Süd",Südost:"SO",Südwest:"SW",Ost:"Ost",West:"West",Nord:"Nord"}[h.ausrichtung]||h.ausrichtung} ${k}`};return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Module / Strings"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Modulgruppen nach Ausrichtung für PVGIS-Prognose"})]})]}),n&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300",children:n}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagenleistung:"}),e.jsxs("span",{className:"ml-2 font-semibold text-gray-900 dark:text-white",children:[t," kWp"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Module zugewiesen:"}),e.jsxs("span",{className:`ml-2 font-semibold ${f===t?"text-green-600 dark:text-green-400":f>t?"text-red-600 dark:text-red-400":"text-amber-600 dark:text-amber-400"}`,children:[f.toFixed(2)," kWp"]})]})]}),j>0&&e.jsxs("p",{className:"mt-2 text-sm text-amber-600 dark:text-amber-400",children:["Noch ",j.toFixed(2)," kWp nicht zugewiesen"]})]}),a.length>0&&e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["Angelegte Module (",a.length,")"]}),a.map(k=>e.jsx("div",{className:"p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Bezeichnung"}),e.jsx("input",{type:"text",value:k.bezeichnung,onChange:w=>i(k.id,{bezeichnung:w.target.value}),className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Leistung (kWp)"}),e.jsx("input",{type:"number",value:k.leistung_kwp,onChange:w=>i(k.id,{leistung_kwp:parseFloat(w.target.value)||0}),step:"0.01",min:"0.1",className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Ausrichtung"}),e.jsx("select",{value:k.ausrichtung,onChange:w=>i(k.id,{ausrichtung:w.target.value}),className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:ya.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Neigung (°)"}),e.jsx("input",{type:"number",value:k.neigung_grad,onChange:w=>i(k.id,{neigung_grad:parseFloat(w.target.value)||0}),min:"0",max:"90",className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),e.jsx("button",{type:"button",onClick:()=>o(k.id),className:"ml-4 p-2 text-gray-400 hover:text-red-500 transition-colors",title:"Modul entfernen",children:e.jsx(Ge,{className:"w-4 h-4"})})]})},k.id))]}),g?e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Neues PV-Modul anlegen"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Bezeichnung"}),e.jsx("input",{type:"text",value:h.bezeichnung,onChange:k=>p(w=>({...w,bezeichnung:k.target.value})),onFocus:()=>{h.bezeichnung||p(k=>({...k,bezeichnung:E()}))},placeholder:"z.B. PV Süd 1",className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Leistung (kWp)"}),e.jsx("input",{type:"number",value:h.leistung_kwp,onChange:k=>p(w=>({...w,leistung_kwp:k.target.value})),placeholder:j>0?j.toFixed(2):"5.0",step:"0.01",min:"0.1",className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Ausrichtung"}),e.jsx("select",{value:h.ausrichtung,onChange:k=>p(w=>({...w,ausrichtung:k.target.value})),className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:ya.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Neigung (°)"}),e.jsx("input",{type:"number",value:h.neigung_grad,onChange:k=>p(w=>({...w,neigung_grad:k.target.value})),placeholder:"30",min:"0",max:"90",className:"w-full px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:_,disabled:!h.bezeichnung.trim()||!h.leistung_kwp,className:"px-4 py-2 bg-amber-500 text-white text-sm font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Modul hinzufügen"}),a.length>0&&e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-gray-600 dark:text-gray-400 text-sm hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]})]}):e.jsxs("button",{type:"button",onClick:()=>m(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 dark:text-gray-400 hover:border-amber-400 hover:text-amber-600 dark:hover:border-amber-500 dark:hover:text-amber-400 transition-colors",children:[e.jsx(Xe,{className:"w-5 h-5 inline mr-2"}),"Weiteres PV-Modul hinzufügen"]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Warum Module anlegen?"})," Für die PVGIS-Ertragsprognose benötigen wir die Ausrichtung und Neigung jeder Modulgruppe. Bei Ost-West-Anlagen legen Sie zwei Module mit unterschiedlicher Ausrichtung an."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[a.length===0&&e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(Et,{className:"w-4 h-4"}),"Später anlegen"]}),e.jsx("button",{type:"button",onClick:d,disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(ye,{className:"w-4 h-4"})]})})]})]})]})}function zs(t){switch(t.suggested_investition_typ){case"e-auto":return e.jsx(fe,{className:"w-5 h-5"});case"speicher":return e.jsx(me,{className:"w-5 h-5"});case"wallbox":return e.jsx(De,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(Te,{className:"w-5 h-5"});default:return e.jsx(Te,{className:"w-5 h-5"})}}function Es(t){switch(t){case"e-auto":return"E-Auto";case"speicher":return"Speicher";case"wallbox":return"Wallbox";case"wechselrichter":return"Wechselrichter";case"pv-module":return"PV-Module";default:return"Unbekannt"}}function Cs({isLoading:t,error:a,haConnected:r,discoveryResult:n,selectedDevices:s,onToggleDevice:i,onSelectAll:o,onDeselectAll:d,onRetry:l,onNext:x,onSkip:g,onBack:m}){const h=(n==null?void 0:n.devices.filter(f=>!f.already_configured&&f.suggested_investition_typ))??[],p=s.size;return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Geräte erkennen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatische Erkennung aus Home Assistant"})]})]}),t&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(ct,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten..."})]}),!t&&!r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(ot,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Home Assistant Verbindung"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Die automatische Geräteerkennung ist ohne HA-Verbindung nicht möglich."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Sie können Investitionen später manuell anlegen."})]}),!t&&r&&a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:e.jsx(vt,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler bei der Erkennung"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-6",children:a}),e.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(we,{className:"w-4 h-4"}),"Erneut versuchen"]})]}),!t&&r&&n&&!a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(qt,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"}),n.devices.length>0&&e.jsxs("span",{className:"text-gray-400 dark:text-gray-500",children:["• ",n.devices.length," Gerät(e) gefunden"]})]}),n.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:n.warnings.map((f,j)=>e.jsx("p",{children:f},j))})]})}),n.devices.length===0&&e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-xl",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Keine unterstützten Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Unterstützt: SMA, evcc, Smart, Wallbox Integrationen"}),e.jsxs("button",{onClick:l,className:"mt-4 inline-flex items-center gap-2 px-3 py-1.5 text-sm text-amber-600 dark:text-amber-400 hover:text-amber-700 dark:hover:text-amber-300",children:[e.jsx(we,{className:"w-4 h-4"}),"Erneut suchen"]})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["Verfügbare Geräte (",h.length,")"]}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Keine"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:o,className:"text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"Alle"})]})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:n.devices.map(f=>{const j=!f.already_configured&&f.suggested_investition_typ,_=s.has(f.id);return e.jsxs("button",{type:"button",onClick:()=>j&&i(f.id),disabled:!j,className:`
                          relative p-4 rounded-xl border-2 text-left transition-all
                          ${f.already_configured?"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 opacity-60 cursor-not-allowed":_?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-gray-200 dark:border-gray-700 hover:border-amber-300 dark:hover:border-amber-700"}
                        `,children:[j&&e.jsx("div",{className:`
                            absolute top-3 right-3 w-5 h-5 rounded-full border-2 flex items-center justify-center
                            ${_?"border-amber-500 bg-amber-500":"border-gray-300 dark:border-gray-600"}
                          `,children:_&&e.jsx(be,{className:"w-4 h-4 text-white"})}),f.already_configured&&e.jsx("div",{className:"absolute top-3 right-3 px-2 py-0.5 bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-xs rounded-full",children:"Bereits vorhanden"}),e.jsxs("div",{className:"flex items-start gap-3 pr-8",children:[e.jsx("div",{className:`
                            w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0
                            ${_?"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400":"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                          `,children:zs(f)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:f.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[f.manufacturer&&`${f.manufacturer} • `,Es(f.suggested_investition_typ)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:f.integration})]})]})]},f.id)})})]}),n.devices.some(f=>f.already_configured)&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(be,{className:"w-4 h-4 inline mr-1 text-green-500"}),n.devices.filter(f=>f.already_configured).length," Gerät(e) bereits konfiguriert"]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:m,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[p===0&&e.jsxs("button",{type:"button",onClick:g,disabled:t,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(Et,{className:"w-4 h-4"}),"Überspringen"]}),e.jsx("button",{type:"button",onClick:x,disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p>0?e.jsxs(e.Fragment,{children:["Weiter (",p," ausgewählt)",e.jsx(ye,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(ye,{className:"w-4 h-4"})]})})]})]})]})}function As(t){switch(t){case"e-auto":return e.jsx(fe,{className:"w-5 h-5"});case"speicher":return e.jsx(me,{className:"w-5 h-5"});case"wallbox":return e.jsx(De,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(Te,{className:"w-5 h-5"});default:return e.jsx(Te,{className:"w-5 h-5"})}}function Ds(t){switch(t){case"e-auto":return"E-Auto";case"speicher":return"Speicher";case"wallbox":return"Wallbox";case"wechselrichter":return"Wechselrichter";default:return"Investition"}}function Ms({devices:t,formData:a,isLoading:r,error:n,onUpdateFormData:s,onSubmit:i,onSkip:o,onBack:d}){return t.length===0?e.jsxs("div",{children:[e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(Fe,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Keine Geräte ausgewählt"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:"Sie haben keine Geräte zur Erstellung ausgewählt. Investitionen können jederzeit später unter Einstellungen → Investitionen angelegt werden."})]})}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:o,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter",e.jsx(ye,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Investitionen vervollständigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergänzen Sie die Details für die erkannten Geräte. Diese Informationen werden für die ROI-Berechnung benötigt."})]}),n&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300",children:n}),e.jsx("div",{className:"space-y-6",children:t.map(l=>{const x=a[l.id]||{bezeichnung:l.name,kaufdatum:new Date().toISOString().split("T")[0],kaufpreis:0};return e.jsxs("div",{className:"p-5 bg-gray-50 dark:bg-gray-700/50 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-4 border-b border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400",children:As(l.suggested_investition_typ)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:Ds(l.suggested_investition_typ)}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[l.manufacturer&&`${l.manufacturer} • `,l.integration]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung"}),e.jsx("input",{type:"text",value:x.bezeichnung,onChange:g=>s(l.id,{bezeichnung:g.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufdatum"}),e.jsx("input",{type:"date",value:x.kaufdatum,onChange:g=>s(l.id,{kaufdatum:g.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (€)"}),e.jsx("input",{type:"number",value:x.kaufpreis||"",onChange:g=>s(l.id,{kaufpreis:parseFloat(g.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für ROI-Berechnung"})]}),(l.suggested_investition_typ==="e-auto"||l.suggested_investition_typ==="speicher")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazität (kWh)"}),e.jsx("input",{type:"number",value:x.batterie_kwh??l.suggested_parameters.batterie_kwh??"",onChange:g=>s(l.id,{batterie_kwh:parseFloat(g.target.value)||void 0}),placeholder:l.suggested_investition_typ==="e-auto"?"z.B. 66":"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),(l.suggested_investition_typ==="wallbox"||l.suggested_investition_typ==="wechselrichter")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kW)"}),e.jsx("input",{type:"number",value:x.leistung_kw??l.suggested_parameters.leistung_kw??"",onChange:g=>s(l.id,{leistung_kw:parseFloat(g.target.value)||void 0}),placeholder:l.suggested_investition_typ==="wallbox"?"z.B. 11":"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]})]},l.id)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können diese Angaben später jederzeit unter Einstellungen → Investitionen ergänzen oder ändern. Der Kaufpreis ist besonders wichtig für die Amortisationsberechnung."})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:o,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(Et,{className:"w-4 h-4"}),"Später ergänzen"]}),e.jsx("button",{type:"button",onClick:i,disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Erstellen..."]}):e.jsxs(e.Fragment,{children:[t.length," Investition",t.length!==1?"en":""," erstellen",e.jsx(ye,{className:"w-4 h-4"})]})})]})]})]})}function Fs(t){switch(t){case"e-auto":return e.jsx(fe,{className:"w-4 h-4"});case"speicher":return e.jsx(me,{className:"w-4 h-4"});case"wallbox":return e.jsx(De,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(Te,{className:"w-4 h-4"});default:return e.jsx(Te,{className:"w-4 h-4"})}}function Is({anlage:t,strompreis:a,createdInvestitionen:r,discoveryResult:n,onComplete:s,onBack:i}){const o=!!t,d=!!a,l=r.length>0,x=(n==null?void 0:n.current_mappings)&&(n.current_mappings.pv_erzeugung||n.current_mappings.einspeisung||n.current_mappings.netzbezug);return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(be,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschließen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Überprüfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ft,{icon:e.jsx(ie,{className:"w-5 h-5"}),title:"PV-Anlage",status:o?"success":"warning",children:o?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&` • ${t.standort_ort}`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(ft,{icon:e.jsx(ue,{className:"w-5 h-5"}),title:"Stromtarif",status:d?"success":"warning",children:d?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:a.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:a.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),a.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.tarifname,a.anbieter&&` (${a.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollständig"})}),e.jsx(ft,{icon:e.jsx(Te,{className:"w-5 h-5"}),title:"Investitionen",status:l?"success":"neutral",children:l?e.jsx("div",{className:"space-y-2",children:r.map(g=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:Fs(g.typ)}),e.jsx("span",{children:g.bezeichnung}),g.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(",g.anschaffungskosten_gesamt.toLocaleString("de-DE")," €)"]}):null]},g.id))}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - können später hinzugefügt werden"})}),x&&e.jsx(ft,{icon:e.jsx(ue,{className:"w-5 h-5"}),title:"HA Sensor-Zuordnung",status:"success",children:e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Sensoren wurden zugeordnet - Monatsdaten können aus HA importiert werden"})})]}),e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Nächste Schritte nach der Einrichtung:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Monatsdaten aus Home Assistant importieren oder manuell erfassen"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"PVGIS-Prognose für Ihre Module abrufen (unter Auswertungen → Prognose)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-green-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Dashboard und Auswertungen erkunden"})]})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:["Einrichtung abschließen",e.jsx(be,{className:"w-5 h-5"})]})]})]})}function ft({icon:t,title:a,status:r,children:n}){const s={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${s[r]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[r]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:a}),r==="success"&&e.jsx(be,{className:"w-4 h-4 text-green-500"}),r==="warning"&&e.jsx(Ke,{className:"w-4 h-4 text-amber-500"})]}),n]})]})})}function Ws({anlage:t,onGoToDashboard:a}){return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(ie,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(or,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8 max-w-md mx-auto text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Erste Schritte:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx($t,{number:1,text:"Monatsdaten erfassen oder aus HA importieren"}),e.jsx($t,{number:2,text:"Dashboard und Kennzahlen erkunden"}),e.jsx($t,{number:3,text:"ROI-Berechnungen für Investitionen prüfen"})]})]}),e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Zum Dashboard",e.jsx(ye,{className:"w-5 h-5"})]})]})}function $t({number:t,text:a}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a})]})}const qe=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"ha-connection",label:"Home Assistant",shortLabel:"HA"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"pv-module",label:"PV-Module",shortLabel:"Module"},{key:"discovery",label:"Geräte erkennen",shortLabel:"Geräte"},{key:"investitionen",label:"Investitionen",shortLabel:"Invest."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function Ps({onComplete:t}){var s;const a=Dr();c.useEffect(()=>{a.step==="ha-connection"&&!a.haConnected&&a.checkHAConnection()},[a.step]),c.useEffect(()=>{a.step==="discovery"&&!a.discoveryResult&&a.haConnected&&a.runDiscovery()},[a.step,a.haConnected]),c.useEffect(()=>{if(a.step==="complete"){const i=setTimeout(t,100);return()=>clearTimeout(i)}},[a.step,t]);const r=qe.findIndex(i=>i.key===a.step),n=a.step!=="welcome"&&a.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(ie,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"EEDC Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),n&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",r+1," von ",qe.length]})]})})}),n&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:qe.map((i,o)=>{const d=o<r,l=o===r;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${d?"bg-green-500 text-white":l?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:d?e.jsx(be,{className:"w-5 h-5"}):o+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${l?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:i.label})]}),o<qe.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${d?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},i.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(s=qe[r])==null?void 0:s.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r+1,"/",qe.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${a.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[a.step==="welcome"&&e.jsx(ks,{onNext:a.nextStep}),a.step==="anlage"&&e.jsx(ws,{isLoading:a.isLoading,error:a.error,onSubmit:a.createAnlage,onBack:a.prevStep}),a.step==="ha-connection"&&e.jsx(Ns,{isLoading:a.isLoading,error:a.error,haConnected:a.haConnected,haVersion:a.haVersion,onRetry:a.checkHAConnection,onNext:a.nextStep,onSkip:a.skipStep,onBack:a.prevStep}),a.step==="strompreise"&&e.jsx(_s,{anlage:a.anlage,isLoading:a.isLoading,error:a.error,onSubmit:a.createStrompreis,onUseDefaults:a.useDefaultStrompreise,onBack:a.prevStep}),a.step==="pv-module"&&a.anlage&&e.jsx(Ss,{anlagenLeistungKwp:a.anlage.leistung_kwp,pvModule:a.pvModule,isLoading:a.isLoading,error:a.error,onAddModule:a.addPVModul,onUpdateModule:a.updatePVModul,onRemoveModule:a.removePVModul,onNext:a.savePVModule,onSkip:a.skipStep,onBack:a.prevStep}),a.step==="discovery"&&e.jsx(Cs,{isLoading:a.isLoading,error:a.error,haConnected:a.haConnected,discoveryResult:a.discoveryResult,selectedDevices:a.selectedDevices,onToggleDevice:a.toggleDevice,onSelectAll:a.selectAllDevices,onDeselectAll:a.deselectAllDevices,onRetry:a.runDiscovery,onNext:a.nextStep,onSkip:a.skipStep,onBack:a.prevStep}),a.step==="investitionen"&&e.jsx(Ms,{devices:a.investitionenToEdit,formData:a.investitionFormData,isLoading:a.isLoading,error:a.error,onUpdateFormData:a.updateInvestitionFormData,onSubmit:a.createInvestitionen,onSkip:a.nextStep,onBack:a.prevStep}),a.step==="summary"&&e.jsx(Is,{anlage:a.anlage,strompreis:a.strompreis,createdInvestitionen:a.createdInvestitionen,discoveryResult:a.discoveryResult,onComplete:a.completeWizard,onBack:a.prevStep}),a.step==="complete"&&e.jsx(Ws,{anlage:a.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"EEDC - Energie Effizienz Data Center"})]})}const Lt="eedc_setup_wizard_completed";function $s({children:t}){const[a,r]=c.useState(!0),[n,s]=c.useState(!1);c.useEffect(()=>{i()},[]);const i=async()=>{try{if(localStorage.getItem(Lt)==="true"){s(!1),r(!1);return}(await Ie.list()).length===0?s(!0):(localStorage.setItem(Lt,"true"),s(!1))}catch(d){console.error("Fehler beim Prüfen des Setup-Status:",d),s(!1)}finally{r(!1)}},o=()=>{localStorage.setItem(Lt,"true"),s(!1)};return a?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade EEDC..."})]})}):n?e.jsx(Ps,{onComplete:o}):e.jsx(e.Fragment,{children:t})}Ot.createRoot(document.getElementById("root")).render(e.jsx(Ka.StrictMode,{children:e.jsx(br,{children:e.jsx($s,{children:e.jsx(js,{})})})}));
