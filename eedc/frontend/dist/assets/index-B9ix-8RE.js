var vd=Object.defineProperty;var wd=(t,r,a)=>r in t?vd(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var Zl=(t,r,a)=>wd(t,typeof r!="symbol"?r+"":r,a);import{r as m,a as Nd,u as Qi,N as gi,O as _d,b as lr,L as ha,d as zd,e as Sd,R as st,H as Ed,f as Md,h as _e,i as lt}from"./vendor--Y_1AvlA.js";import{R as he,B as Je,T as ge,a as oe,C as Ze,b as je,X as ke,Y as be,L as De,c as Et,A as It,d as qe,P as Xt,e as Qt,f as Tr,g as Lr,h as Wd,i as Fd,j as Ad,k as $d,l as Cd,m as Jl,n as Pd,o as ae}from"./charts-CZTDBJxS.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var Fo={exports:{}},Fn={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dd=m,Ld=Symbol.for("react.element"),Id=Symbol.for("react.fragment"),Vd=Object.prototype.hasOwnProperty,Bd=Dd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Od={key:!0,ref:!0,__self:!0,__source:!0};function Ao(t,r,a){var s,n={},i=null,l=null;a!==void 0&&(i=""+a),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(l=r.ref);for(s in r)Vd.call(r,s)&&!Od.hasOwnProperty(s)&&(n[s]=r[s]);if(t&&t.defaultProps)for(s in r=t.defaultProps,r)n[s]===void 0&&(n[s]=r[s]);return{$$typeof:Ld,type:t,key:i,ref:l,props:n,_owner:Bd.current}}Fn.Fragment=Id;Fn.jsx=Ao;Fn.jsxs=Ao;Fo.exports=Fn;var e=Fo.exports,xi={},ql=Nd;xi.createRoot=ql.createRoot,xi.hydrateRoot=ql.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Rd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Td=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),X=(t,r)=>{const a=m.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:c="",children:h,...g},o)=>m.createElement("svg",{ref:o,...Rd,width:n,height:n,stroke:s,strokeWidth:l?Number(i)*24/Number(n):i,className:["lucide",`lucide-${Td(t)}`,c].join(" "),...g},[...r.map(([x,u])=>m.createElement(x,u)),...Array.isArray(h)?h:[h]]));return a.displayName=`${t}`,a};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $o=X("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=X("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=X("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kd=X("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ul=X("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=X("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=X("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hd=X("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=X("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=X("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=X("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=X("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=X("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=X("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=X("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zd=X("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Po=X("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=X("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=X("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=X("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=X("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=X("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=X("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=X("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=X("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=X("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jd=X("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=X("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=X("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=X("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yd=X("CloudSnow",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yl=X("CloudSun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=X("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xd=X("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qd=X("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const el=X("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=X("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=X("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=X("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=X("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=X("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=X("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=X("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=X("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=X("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=X("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=X("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=X("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=X("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=X("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Io=X("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=X("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=X("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=X("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=X("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vo=X("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=X("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=X("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=X("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=X("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=X("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bo=X("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=X("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oo=X("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=X("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=X("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=X("Mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=X("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=X("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const al=X("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=X("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=X("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=X("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=X("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e0=X("PlugZap",[["path",{d:"M6.3 20.3a2.4 2.4 0 0 0 3.4 0L12 18l-6-6-2.3 2.3a2.4 2.4 0 0 0 0 3.4Z",key:"goz73y"}],["path",{d:"m2 22 3-3",key:"19mgm9"}],["path",{d:"M7.5 13.5 10 11",key:"7xgeeb"}],["path",{d:"M10.5 16.5 13 14",key:"10btkg"}],["path",{d:"m18 3-4 4h6l-4 4",key:"16psg9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=X("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=X("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=X("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=X("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=X("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=X("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hh=X("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=X("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=X("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Go=X("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=X("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=X("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nl=X("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=X("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xh=X("Snowflake",[["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"m20 16-4-4 4-4",key:"rquw4f"}],["path",{d:"m4 8 4 4-4 4",key:"12s3z9"}],["path",{d:"m16 4-4 4-4-4",key:"1tumq1"}],["path",{d:"m8 20 4-4 4 4",key:"9p200w"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=X("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=X("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=X("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=X("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bi=X("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=X("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=X("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=X("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=X("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=X("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=X("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=X("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=X("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=X("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=X("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=X("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=X("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=X("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=X("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=X("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),qo=m.createContext(void 0);function fh({children:t}){const[r,a]=m.useState(()=>localStorage.getItem("eedc-theme")||"system"),[s,n]=m.useState(!1);return m.useEffect(()=>{localStorage.setItem("eedc-theme",r);const i=window.document.documentElement;if(r==="system"){const l=window.matchMedia("(prefers-color-scheme: dark)").matches;n(l),i.classList.toggle("dark",l)}else n(r==="dark"),i.classList.toggle("dark",r==="dark")},[r]),m.useEffect(()=>{if(r!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),l=c=>{n(c.matches),document.documentElement.classList.toggle("dark",c.matches)};return i.addEventListener("change",l),()=>i.removeEventListener("change",l)},[r]),e.jsx(qo.Provider,{value:{theme:r,setTheme:a,isDark:s},children:t})}function Uo(){const t=m.useContext(qo);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const yh="./api";class jh{constructor(r=yh){Zl(this,"baseUrl");this.baseUrl=r}async request(r,a={}){const s=`${this.baseUrl}${r}`,n={headers:{"Content-Type":"application/json",...a.headers},...a},i=await fetch(s,n);if(!i.ok){const l={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const c=await i.json();l.detail=c.detail||l.detail}catch{}throw l}if(i.status!==204)return i.json()}async get(r){return this.request(r,{method:"GET"})}async post(r,a){return this.request(r,{method:"POST",body:a?JSON.stringify(a):void 0})}async put(r,a){return this.request(r,{method:"PUT",body:JSON.stringify(a)})}async delete(r){return this.request(r,{method:"DELETE"})}async patch(r,a){return this.request(r,{method:"PATCH",body:JSON.stringify(a)})}async upload(r,a,s="file"){const n=new FormData;return n.append(s,a),this.request(r,{method:"POST",headers:{},body:n})}}const Y=new jh;let Ma=null;function ll(){const[t,r]=m.useState(Ma??!1);return m.useEffect(()=>{Ma===null&&Y.get("/settings").then(a=>{Ma=a.ha_integration_available??!1,r(Ma)}).catch(()=>{Ma=!1,r(!1)})},[]),t}const Yo="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgODAgODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImczIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzA2YjZkNCIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMzNGQzOTkiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8c3R5bGU+CiAgICAgIEBpbXBvcnQgdXJsKCdodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PU91dGZpdDp3Z2h0QDMwMDs3MDAmYW1wO2Rpc3BsYXk9c3dhcCcpOwogICAgPC9zdHlsZT4KICA8L2RlZnM+CgogIDxyZWN0IHg9IjIiIHk9IjIiIHdpZHRoPSI3NiIgaGVpZ2h0PSI3NiIgcng9IjE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuOCIvPgogIDx0ZXh0IHg9IjEyIiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjcwMCIgZm9udC1zaXplPSIzNiIgZmlsbD0idXJsKCNnMykiPmVlPC90ZXh0PgogIDx0ZXh0IHg9IjQ1IiB5PSI1NiIgZm9udC1mYW1pbHk9Ik91dGZpdCwgc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9IjMwMCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzY0NzQ4YiI+ZGM8L3RleHQ+CiAgPHBhdGggZD0iTTE2IDE2IFE0MCAzIDYyIDE2IiBmaWxsPSJub25lIiBzdHJva2U9InVybCgjZzMpIiBzdHJva2Utd2lkdGg9IjIuMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgPGNpcmNsZSBjeD0iNjIiIGN5PSIxNiIgcj0iMi44IiBmaWxsPSIjMzRkMzk5Ii8+Cjwvc3ZnPgo=",kh=[{name:"Cockpit",basePath:"/cockpit",icon:rl},{name:"Auswertungen",basePath:"/auswertungen",icon:Kt},{name:"Aussichten",basePath:"/aussichten",icon:Fe},{name:"Community",basePath:"/community",icon:Er}],t0=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Monatsabschluss",href:"/einstellungen/monatsabschluss"},{name:"Import",href:"/einstellungen/import"},{name:"Datenerfassung",href:"/einstellungen/datenerfassung"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"Solarprognose",href:"/einstellungen/solarprognose"},{name:"Allgemein",href:"/einstellungen/allgemein"}]},{category:"Home Assistant",items:[{name:"Sensor-Zuordnung",href:"/einstellungen/sensor-mapping"},{name:"Statistik-Import",href:"/einstellungen/ha-statistik-import"},{name:"MQTT-Export",href:"/einstellungen/ha-export"}]},{category:"Community",items:[{name:"Daten teilen",href:"/einstellungen/community"}]}];function vh(){const{theme:t,setTheme:r}=Uo(),a=Qi(),[s,n]=m.useState(!1),i=m.useRef(null),l=ll(),c=m.useMemo(()=>l?t0:t0.filter(u=>u.category!=="Home Assistant"),[l]),g=a.pathname.startsWith("/cockpit")?"Cockpit":a.pathname.startsWith("/auswertungen")?"Auswertungen":a.pathname.startsWith("/aussichten")?"Aussichten":a.pathname.startsWith("/community")?"Community":a.pathname.startsWith("/einstellungen")?null:"Cockpit";m.useEffect(()=>{const u=d=>{i.current&&!i.current.contains(d.target)&&n(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const o=()=>{r(t==="light"?"dark":t==="dark"?"system":"light")},x=u=>a.pathname===u;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-14",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:Yo,alt:"eedc",className:"h-10 w-10"}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"}),e.jsx("nav",{className:"ml-8 flex space-x-1",children:kh.map(u=>{const d=u.icon;return e.jsxs(gi,{to:u.basePath,className:()=>`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${g===u.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(d,{className:"h-4 w-4"}),u.name]},u.name)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:o,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(ce,{className:"h-5 w-5"}),t==="dark"&&e.jsx(Ro,{className:"h-5 w-5"}),t==="system"&&e.jsx(Oo,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>n(!s),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${a.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(sl,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(Mr,{className:`h-4 w-4 transition-transform ${s?"rotate-180":""}`})]}),s&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:c.map((u,d)=>e.jsxs("div",{children:[d>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:u.category})}),u.items.map(p=>e.jsx(gi,{to:p.href,onClick:()=>n(!1),className:`block px-4 py-2 text-sm transition-colors ${x(p.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:p.name},p.href))]},u.category))})]})]})]})})})}const wh=[{name:"bersicht",href:"/cockpit",icon:rl,exact:!0},{name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:ce},{name:"E-Auto",href:"/cockpit/e-auto",icon:Te},{name:"Wrmepumpe",href:"/cockpit/waermepumpe",icon:et},{name:"Speicher",href:"/cockpit/speicher",icon:Ce},{name:"Wallbox",href:"/cockpit/wallbox",icon:Ht},{name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:ce},{name:"Sonstiges",href:"/cockpit/sonstiges",icon:as}],r0=[{label:"Stammdaten",prefixes:["/einstellungen/anlage","/einstellungen/strompreise","/einstellungen/investitionen"],tabs:[{name:"Anlage",href:"/einstellungen/anlage",icon:dt},{name:"Strompreise",href:"/einstellungen/strompreise",icon:Ne},{name:"Investitionen",href:"/einstellungen/investitionen",icon:ta}]},{label:"Daten",prefixes:["/einstellungen/monatsdaten","/einstellungen/monatsabschluss","/einstellungen/import","/einstellungen/demo","/einstellungen/datenerfassung"],tabs:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:Yr},{name:"Monatsabschluss",href:"/einstellungen/monatsabschluss",icon:mi},{name:"Import/Export",href:"/einstellungen/import",icon:Or},{name:"Demo-Daten",href:"/einstellungen/demo",icon:rh},{name:"Datenerfassung",href:"/einstellungen/datenerfassung",icon:Zd}]},{label:"System",prefixes:["/einstellungen/solarprognose","/einstellungen/allgemein","/einstellungen/backup"],tabs:[{name:"Solarprognose",href:"/einstellungen/solarprognose",icon:An},{name:"Allgemein",href:"/einstellungen/allgemein",icon:sl},{name:"Backup",href:"/einstellungen/backup",icon:Io}]},{label:"Home Assistant",prefixes:["/einstellungen/sensor-mapping","/einstellungen/ha-statistik-import","/einstellungen/ha-export"],tabs:[{name:"Sensor-Zuordnung",href:"/einstellungen/sensor-mapping",icon:ht},{name:"Statistik-Import",href:"/einstellungen/ha-statistik-import",icon:ui},{name:"MQTT-Export",href:"/einstellungen/ha-export",icon:ch}]},{label:"Community",prefixes:["/einstellungen/community"],tabs:[{name:"Daten teilen",href:"/einstellungen/community",icon:nl}]}];function Nh(){const r=Qi().pathname,a=ll();if(r.startsWith("/cockpit"))return e.jsx(a0,{tabs:wh});if(r.startsWith("/einstellungen")){const n=(a?r0:r0.filter(i=>i.label!=="Home Assistant")).find(i=>i.prefixes.some(l=>r.startsWith(l)))??null;return n?e.jsx(a0,{tabs:n.tabs,groupLabel:n.label}):null}return null}function a0({tabs:t,groupLabel:r}){return t.length===0?null:e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("nav",{className:"flex items-center gap-1 py-2 overflow-x-auto",children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wide whitespace-nowrap pr-2",children:r}),e.jsx("span",{className:"h-4 w-px bg-gray-300 dark:bg-gray-600 mr-2 shrink-0"})]}),t.map(a=>e.jsxs(gi,{to:a.href,end:a.exact,className:({isActive:s})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${s?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(a.icon,{className:"h-4 w-4"}),a.name]},a.href))]})})})}const _h="2.5.1",zh="eedc",Sh="Energie Effizienz Data Center",Eh=`${zh} v${_h}  ${Sh}`,Lt={async list(){return Y.get("/anlagen/")},async get(t){return Y.get(`/anlagen/${t}`)},async create(t){return Y.post("/anlagen/",t)},async update(t,r){return Y.put(`/anlagen/${t}`,r)},async delete(t){return Y.delete(`/anlagen/${t}`)},async getSensorConfig(t){return Y.get(`/anlagen/${t}/sensors`)},async updateSensorConfig(t,r){return Y.patch(`/anlagen/${t}/sensors`,r)},async geocode(t,r){const a=new URLSearchParams({plz:t});return r&&a.append("ort",r),Y.get(`/anlagen/geocode/lookup?${a}`)}},_r={async list(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("jahr",r.toString());const s=a.toString();return Y.get(`/monatsdaten/${s?"?"+s:""}`)},async get(t){return Y.get(`/monatsdaten/${t}`)},async create(t){return Y.post("/monatsdaten/",t)},async update(t,r){return Y.put(`/monatsdaten/${t}`,r)},async delete(t){return Y.delete(`/monatsdaten/${t}`)},async listAggregiert(t,r){const a=r?`?jahr=${r}`:"";return Y.get(`/monatsdaten/aggregiert/${t}${a}`)}},tt={async getTypen(){return Y.get("/investitionen/typen")},async list(t,r,a){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("typ",r),a!==void 0&&s.append("aktiv",a.toString());const n=s.toString();return Y.get(`/investitionen/${n?"?"+n:""}`)},async get(t){return Y.get(`/investitionen/${t}`)},async create(t){return Y.post("/investitionen/",t)},async update(t,r){return Y.put(`/investitionen/${t}`,r)},async delete(t){return Y.delete(`/investitionen/${t}`)},async getROIDashboard(t,r,a,s,n){const i=new URLSearchParams;r&&i.append("strompreis_cent",r.toString()),a&&i.append("einspeiseverguetung_cent",a.toString()),s&&i.append("benzinpreis_euro",s.toString()),n&&n!=="all"&&i.append("jahr",n.toString());const l=i.toString();return Y.get(`/investitionen/roi/${t}${l?"?"+l:""}`)},async getEAutoDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("benzinpreis_euro",a.toString());const n=s.toString();return Y.get(`/investitionen/dashboard/e-auto/${t}${n?"?"+n:""}`)},async getWaermepumpeDashboard(t,r){const a=new URLSearchParams;r&&a.append("strompreis_cent",r.toString());const s=a.toString();return Y.get(`/investitionen/dashboard/waermepumpe/${t}${s?"?"+s:""}`)},async getSpeicherDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("einspeiseverguetung_cent",a.toString());const n=s.toString();return Y.get(`/investitionen/dashboard/speicher/${t}${n?"?"+n:""}`)},async getWallboxDashboard(t){return Y.get(`/investitionen/dashboard/wallbox/${t}`)},async getBalkonkraftwerkDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("einspeiseverguetung_cent",a.toString());const n=s.toString();return Y.get(`/investitionen/dashboard/balkonkraftwerk/${t}${n?"?"+n:""}`)},async getSonstigesDashboard(t,r,a){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString()),a&&s.append("einspeiseverguetung_cent",a.toString());const n=s.toString();return Y.get(`/investitionen/dashboard/sonstiges/${t}${n?"?"+n:""}`)},async getMonatsdatenByMonth(t,r,a){return Y.get(`/investitionen/monatsdaten/${t}/${r}/${a}`)}},xa={async list(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("aktuell","true");const s=a.toString();return Y.get(`/strompreise/${s?"?"+s:""}`)},async getAktuell(t){return Y.get(`/strompreise/aktuell/${t}`)},async getAktuellFuer(t,r){return Y.get(`/strompreise/aktuell/${t}/${r}`)},async get(t){return Y.get(`/strompreise/${t}`)},async create(t){return Y.post("/strompreise/",t)},async update(t,r){return Y.put(`/strompreise/${t}`,r)},async delete(t){return Y.delete(`/strompreise/${t}`)}},cr="./api",Jt={async getTemplateInfo(t){const r=await fetch(`${cr}/import/template/${t}`);if(!r.ok)throw new Error("Fehler beim Laden des Templates");return r.json()},getTemplateDownloadUrl(t){return`${cr}/import/template/${t}/download`},async importCSV(t,r,a=!1){const s=new FormData;s.append("file",r);const n=new URLSearchParams;a&&n.append("ueberschreiben","true");const i=await fetch(`${cr}/import/csv/${t}?${n.toString()}`,{method:"POST",body:s});if(!i.ok){const l=await i.json();throw new Error(l.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(t,r){const a=new URLSearchParams;r&&a.append("jahr",r.toString());const s=a.toString();return`${cr}/import/export/${t}${s?"?"+s:""}`},async createDemoData(){const t=await fetch(`${cr}/import/demo`,{method:"POST"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${cr}/import/demo`,{method:"DELETE"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht gelscht werden")}return t.json()},getFullExportUrl(t){return`${cr}/import/export/${t}/full`},async importJSON(t,r=!1){const a=new FormData;a.append("file",t);const s=new URLSearchParams;r&&s.append("ueberschreiben","true");const n=await fetch(`${cr}/import/json?${s.toString()}`,{method:"POST",body:a});if(!n.ok){const i=await n.json();throw new Error(i.detail||"JSON-Import fehlgeschlagen")}return n.json()},getPdfExportUrl(t,r){return r?`${cr}/import/pdf/${t}?jahr=${r}`:`${cr}/import/pdf/${t}`}},fi={async health(){return Y.get("/health")},async getSettings(){return Y.get("/settings")},async getStats(){return Y.get("/stats")},async checkUpdate(){return Y.get("/updates/check")}},Nt={async getPrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const s=a.toString();return Y.get(`/pvgis/prognose/${t}${s?`?${s}`:""}`)},async getModulPrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const s=a.toString();return Y.get(`/pvgis/modul/${t}${s?`?${s}`:""}`)},async speicherePrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const s=a.toString();return Y.post(`/pvgis/prognose/${t}/speichern${s?`?${s}`:""}`)},async listeGespeichertePrognosen(t){return Y.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return Y.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return Y.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return Y.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return Y.get(`/pvgis/optimum/${t}`)},async getHorizont(t){return Y.get(`/pvgis/horizont/${t}`)},async uploadHorizont(t,r){return Y.upload(`/pvgis/horizont/${t}/upload`,r)},async abrufeHorizont(t){return Y.post(`/pvgis/horizont/${t}/abrufen`)},async deleteHorizont(t){return Y.delete(`/pvgis/horizont/${t}`)}},Cr={async getStatus(){return Y.get("/ha/status")},async getSensors(){return Y.get("/ha/sensors")},async getMapping(){return Y.get("/ha/mapping")},async getMqttConfig(){return Y.get("/ha/export/mqtt/config")},async getExportSensors(){return Y.get("/ha/export/sensors")},async getAnlageSensors(t){return Y.get(`/ha/export/sensors/${t}`)},async getYamlSnippet(t){return Y.get(`/ha/export/yaml/${t}`)},async getSensorDefinitions(){return Y.get("/ha/export/definitions")},async testMqtt(t){return Y.post("/ha/export/mqtt/test",t||{})},async publishMqtt(t,r){return Y.post(`/ha/export/mqtt/publish/${t}`,r||{})},async removeMqtt(t,r){return Y.delete(`/ha/export/mqtt/remove/${t}`)}},pr={async getUebersicht(t,r){const a=r?`?jahr=${r}`:"";return Y.get(`/cockpit/uebersicht/${t}${a}`)},async getPrognoseVsIst(t,r){return Y.get(`/cockpit/prognose-vs-ist/${t}?jahr=${r}`)},async getNachhaltigkeit(t){return Y.get(`/cockpit/nachhaltigkeit/${t}`)},async getKomponentenZeitreihe(t,r){const a=r?`?jahr=${r}`:"";return Y.get(`/cockpit/komponenten-zeitreihe/${t}${a}`)},async getPVStrings(t,r){const a=r?`?jahr=${r}`:"";return Y.get(`/cockpit/pv-strings/${t}${a}`)},async getPVStringsGesamtlaufzeit(t){return Y.get(`/cockpit/pv-strings-gesamtlaufzeit/${t}`)},async getShareText(t,r,a,s){return Y.get(`/cockpit/share-text/${t}?monat=${r}&jahr=${a}&variante=${s}`)}},Cn={async getMonatsdaten(t,r,a,s="auto"){return Y.get(`/wetter/monat/${t}/${r}/${a}?provider=${s}`)},async getMonatsdatenByCoords(t,r,a,s,n="auto"){return Y.get(`/wetter/monat/koordinaten/${t}/${r}/${a}/${s}?provider=${n}`)},async getProvider(t){return Y.get(`/wetter/provider/${t}`)},async getVergleich(t,r,a){return Y.get(`/wetter/vergleich/${t}/${r}/${a}`)},async getSolarPrognose(t,r=7,a=!1){const s=await Y.get(`/solar-prognose/${t}?tage=${r}&pro_string=${a}`);return{...s,tage:s.tageswerte,anlage:{id:s.anlage_id,name:s.anlagenname,leistung_kwp:s.kwp_gesamt,neigung:s.neigung,azimut:s.ausrichtung}}}},Wa={async getMapping(t){return Y.get(`/sensor-mapping/${t}`)},async getAvailableSensors(t,r=!0){const a=new URLSearchParams;r||a.set("filter_energy","false");const s=a.toString()?`?${a.toString()}`:"";return Y.get(`/sensor-mapping/${t}/available-sensors${s}`)},async saveMapping(t,r){return Y.post(`/sensor-mapping/${t}`,r)},async deleteMapping(t){await Y.delete(`/sensor-mapping/${t}`)},async getStatus(t){return Y.get(`/sensor-mapping/${t}/status`)},async initStartValues(t){return Y.post(`/sensor-mapping/${t}/init-start-values`,{})}},Tn={async getStatus(t,r,a){return Y.get(`/monatsabschluss/${t}/${r}/${a}`)},async save(t,r,a,s){return Y.post(`/monatsabschluss/${t}/${r}/${a}`,s)},async getNaechsterMonat(t){try{return await Y.get(`/monatsabschluss/naechster/${t}`)}catch{return null}},async getHistorie(t,r=12){return Y.get(`/monatsabschluss/historie/${t}?limit=${r}`)}};function Mh(t){return{jahr:t.jahr,monat:t.monat,monat_name:t.monat_name,basis:t.basis.map(r=>({feld:r.feld,label:r.feld_label,wert:r.differenz,einheit:r.einheit,sensor_id:r.sensor_id})),investitionen:t.investitionen.map(r=>({investition_id:r.investition_id,bezeichnung:r.bezeichnung,typ:r.typ,felder:r.felder.map(a=>({feld:a.feld,label:a.feld_label,wert:a.differenz,einheit:a.einheit,sensor_id:a.sensor_id}))}))}}const ur={async getStatus(){return Y.get("/ha-statistics/status")},async getMonatswerte(t,r,a){const s=await Y.get(`/ha-statistics/monatswerte/${t}/${r}/${a}`);return Mh(s)},async getVerfuegbareMonate(t){return(await Y.get(`/ha-statistics/verfuegbare-monate/${t}`)).monate.map(a=>({...a,hat_daten:!0}))},async getAlleMonatswerte(t){return Y.get(`/ha-statistics/alle-monatswerte/${t}`)},async getMonatsanfangWerte(t,r,a){return Y.get(`/ha-statistics/monatsanfang/${t}/${r}/${a}`)},async getImportVorschau(t){return Y.get(`/ha-statistics/import-vorschau/${t}`)},async importieren(t,r){return Y.post(`/ha-statistics/import/${t}`,r)}},rt={async getStatus(){return Y.get("/community/status")},async getPreview(t){return Y.get(`/community/preview/${t}`)},async share(t){return Y.post(`/community/share/${t}`)},async delete(t){return Y.delete(`/community/delete/${t}`)},async getBenchmark(t,r="letzte_12_monate",a){const s=new URLSearchParams({zeitraum:r});return a&&s.append("jahr",a.toString()),Y.get(`/community/benchmark/${t}?${s.toString()}`)},async getGlobalStatistics(){return Y.get("/community/statistics/global")},async getMonthlyAverages(t=12){return Y.get(`/community/statistics/monthly-averages?monate=${t}`)},async getRegionalStatistics(){return Y.get("/community/statistics/regional")},async getRegionalDetails(t){return Y.get(`/community/statistics/regional/${t}`)},async getDistribution(t,r=10){return Y.get(`/community/statistics/distributions/${t}?bins=${r}`)},async getRanking(t,r=10){return Y.get(`/community/statistics/rankings/${t}?limit=${r}`)},async getSpeicherByClass(){return Y.get("/community/components/speicher/by-class")},async getWaermepumpeByRegion(){return Y.get("/community/components/waermepumpe/by-region")},async getEAutoByUsage(){return Y.get("/community/components/eauto/by-usage")},async getTrends(t){return Y.get(`/community/trends/${t}`)},async getDegradation(){return Y.get("/community/trends/degradation")}},s0="eedc_update_dismissed_version";function Wh(){const[t,r]=m.useState(null),[a,s]=m.useState(!1);m.useEffect(()=>{fi.checkUpdate().then(l=>{l.update_verfuegbar&&l.neueste_version&&(localStorage.getItem(s0)===l.neueste_version&&s(!0),r(l))}).catch(()=>{})},[]);const n=()=>{t!=null&&t.neueste_version&&localStorage.setItem(s0,t.neueste_version),s(!0)},i=(t==null?void 0:t.update_verfuegbar)&&!a;return e.jsxs("div",{className:"h-screen bg-gray-50 dark:bg-gray-900 flex flex-col overflow-hidden",children:[e.jsx(vh,{}),i&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/30 border-b border-blue-200 dark:border-blue-800 px-4 py-3",children:e.jsxs("div",{className:"flex items-start gap-3 max-w-5xl mx-auto",children:[e.jsx(Hd,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 text-sm text-blue-700 dark:text-blue-300",children:[e.jsxs("p",{className:"font-medium",children:["eedc v",t.neueste_version," ist verfgbar",e.jsxs("span",{className:"font-normal text-blue-600 dark:text-blue-400",children:[" (aktuell: v",t.aktuelle_version,")"]})]}),e.jsxs("div",{className:"mt-1.5 text-xs text-blue-600 dark:text-blue-400 space-y-0.5",children:[e.jsx("p",{children:"Je nach Installation:"}),e.jsx("p",{className:"font-mono",children:" Docker: docker-compose pull && docker-compose up -d"}),e.jsx("p",{className:"font-mono",children:" Home Assistant Add-on: Update ber Einstellungen  Add-ons"}),e.jsx("p",{className:"font-mono",children:" Manuell (Git): git pull && cd frontend && npm run build"})]}),t.release_url&&e.jsx("a",{href:t.release_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-1.5 text-xs font-medium text-blue-700 dark:text-blue-200 underline hover:no-underline",children:"Release Notes auf GitHub "})]}),e.jsx("button",{onClick:n,className:"text-blue-400 hover:text-blue-600 dark:hover:text-blue-200 transition-colors",title:"Schlieen",children:e.jsx(Rr,{className:"w-4 h-4"})})]})}),e.jsx(Nh,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(_d,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:Eh})})]})}const se=m.forwardRef(({className:t="",variant:r="primary",size:a="md",loading:s,disabled:n,children:i,...l},c)=>{const h="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",g={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},o={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:c,className:`${h} ${g[r]} ${o[a]} ${t}`,disabled:n||s,...l,children:[s&&e.jsx(Ke,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});se.displayName="Button";const Q=m.forwardRef(({className:t="",label:r,error:a,hint:s,id:n,...i},l)=>{const c=n||i.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:l,id:c,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${a?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...i}),s&&!a&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:s}),a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a})]})});Q.displayName="Input";const Zt=m.forwardRef(({className:t="",label:r,error:a,options:s,placeholder:n,id:i,...l},c)=>{const h=i||l.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:h,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,l.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:c,id:h,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${a?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...l,children:[n&&e.jsx("option",{value:"",children:n}),s.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]}),a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a})]})});Zt.displayName="Select";function Dt({isOpen:t,onClose:r,title:a,children:s,size:n="md"}){if(m.useEffect(()=>{const l=c=>{c.key==="Escape"&&r()};return t&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow=""}},[t,r]),!t)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:r}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[n]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),e.jsx("button",{onClick:r,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(Rr,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:s})]})})]})}function P({children:t,className:r="",padding:a="md"}){const s={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${s[a]}
        ${r}
      `,children:t})}function n0({title:t,subtitle:r,action:a}){return e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),r&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r})]}),a&&e.jsx("div",{children:a})]})}function te({type:t,title:r,children:a,onClose:s,className:n=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:nt},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:vt},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:ct},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:xs}},{bg:l,border:c,text:h,icon:g}=i[t];return e.jsx("div",{className:`${l} ${c} border rounded-lg p-4 relative ${n}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{className:`w-5 h-5 ${h} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[r&&e.jsx("h4",{className:`text-sm font-medium ${h}`,children:r}),e.jsx("div",{className:`text-sm ${h} ${r?"mt-1":""}`,children:a})]}),s&&e.jsx("button",{onClick:s,className:`ml-3 ${h} hover:opacity-70 transition-opacity`,children:e.jsx(Rr,{className:"w-4 h-4"})})]})})}function ol({children:t,className:r=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${r}`,children:t})})}function cl({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function dl({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function ja({children:t,onClick:r,className:a=""}){return e.jsx("tr",{className:`${r?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${a}`,onClick:r,children:t})}function yt({children:t,className:r=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${r}`,children:t})}function jt({children:t,className:r=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${r}`,children:t})}function ka({icon:t,title:r,description:a,action:s}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:a}),s&&e.jsx("div",{children:s})]})}function Se({size:t="md",text:r}){const a={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Ke,{className:`${a[t]} text-primary-600 animate-spin`}),r&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:r})]})}function zr({children:t,formel:r,berechnung:a,ergebnis:s,className:n="",showIcon:i=!0}){const[l,c]=m.useState(!1),[h,g]=m.useState("top"),o=m.useRef(null);return m.useEffect(()=>{if(l&&o.current){const x=o.current.getBoundingClientRect();g(x.top<120?"bottom":"top")}},[l]),e.jsxs("span",{ref:o,className:`relative inline-block cursor-help ${n}`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[t,i&&e.jsx(nt,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),l&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${h==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${h==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:r}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:a})]}),s&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:s})]})]})]})}function L(t,r=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r})}function Pn({children:t,text:r,className:a="",position:s="auto"}){const[n,i]=m.useState(!1),[l,c]=m.useState("bottom"),[h,g]=m.useState({top:0,left:0}),o=m.useRef(null);return m.useEffect(()=>{if(n&&o.current){const x=o.current.getBoundingClientRect();c(s==="auto"?x.top<60?"bottom":"top":s),g({top:l==="bottom"?x.bottom+6:x.top-6,left:x.left+x.width/2})}},[n,s,l]),e.jsxs("span",{ref:o,className:`relative inline-block cursor-help ${a}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[t,n&&e.jsxs("div",{className:"fixed z-[9999] px-2 py-1 text-xs bg-gray-800 text-white rounded shadow-lg whitespace-nowrap",style:{top:l==="bottom"?h.top:"auto",bottom:l==="top"?`calc(100vh - ${h.top}px)`:"auto",left:h.left,transform:"translateX(-50%)"},children:[r,e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[4px] border-l-transparent
              border-r-[4px] border-r-transparent
              ${l==="top"?"top-full border-t-[4px] border-t-gray-800":"bottom-full border-b-[4px] border-b-gray-800"}`})]})]})}const Fh={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function Le({title:t,value:r,unit:a,subtitle:s,icon:n,color:i="blue",trend:l,formel:c,berechnung:h,ergebnis:g}){const o=Fh[i],x=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof r=="number"?r.toLocaleString("de-DE"):r,a&&e.jsx("span",{className:"text-sm font-normal ml-1",children:a}),l==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:""}),l==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:""})]});return e.jsx(P,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:c?e.jsx(zr,{formel:c,berechnung:h,ergebnis:g,children:x}):x}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl ${o.bg} ml-3 flex-shrink-0`,children:e.jsx(n,{className:`h-6 w-6 ${o.icon}`})})]})})}function it(){const[t,r]=m.useState([]),[a,s]=m.useState(!0),[n,i]=m.useState(null),l=m.useCallback(async()=>{try{s(!0),i(null);const o=await Lt.list();r(o)}catch(o){i(o instanceof Error?o.message:"Fehler beim Laden der Anlagen")}finally{s(!1)}},[]);m.useEffect(()=>{l()},[l]);const c=m.useCallback(async o=>{const x=await Lt.create(o);return r(u=>[...u,x]),x},[]),h=m.useCallback(async(o,x)=>{const u=await Lt.update(o,x);return r(d=>d.map(p=>p.id===o?u:p)),u},[]),g=m.useCallback(async o=>{await Lt.delete(o),r(x=>x.filter(u=>u.id!==o))},[]);return{anlagen:t,loading:a,error:n,refresh:l,createAnlage:c,updateAnlage:h,deleteAnlage:g}}function Ah(t,r){const[a,s]=m.useState([]),[n,i]=m.useState(!0),[l,c]=m.useState(null),h=m.useCallback(async()=>{try{i(!0),c(null);const u=await _r.list(t,r);s(u)}catch(u){c(u instanceof Error?u.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[t,r]);m.useEffect(()=>{h()},[h]);const g=m.useCallback(async u=>{const d=await _r.create(u);return s(p=>[d,...p]),d},[]),o=m.useCallback(async(u,d)=>{const p=await _r.update(u,d);return s(b=>b.map(j=>j.id===u?p:j)),p},[]),x=m.useCallback(async u=>{await _r.delete(u),s(d=>d.filter(p=>p.id!==u))},[]);return{monatsdaten:a,loading:n,error:l,refresh:h,createMonatsdaten:g,updateMonatsdaten:o,deleteMonatsdaten:x}}function $h(t,r){const[a,s]=m.useState([]),[n,i]=m.useState(!0),[l,c]=m.useState(null),h=m.useCallback(async()=>{if(!t){s([]),i(!1);return}try{i(!0),c(null);const g=await _r.listAggregiert(t,r);s(g)}catch(g){c(g instanceof Error?g.message:"Fehler beim Laden der aggregierten Daten")}finally{i(!1)}},[t,r]);return m.useEffect(()=>{h()},[h]),{daten:a,loading:n,error:l,refresh:h}}function Ch(t){return{gesamtErzeugung:t.reduce((r,a)=>r+(a.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((r,a)=>r+a.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((r,a)=>r+a.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((r,a)=>r+(a.eigenverbrauch_kwh||0),0),gesamtDirektverbrauch:t.reduce((r,a)=>r+(a.direktverbrauch_kwh||0),0),gesamtSpeicherLadung:t.reduce((r,a)=>r+(a.speicher_ladung_kwh||0),0),gesamtSpeicherEntladung:t.reduce((r,a)=>r+(a.speicher_entladung_kwh||0),0),gesamtWpStrom:t.reduce((r,a)=>r+(a.wp_strom_kwh||0),0),gesamtWpHeizung:t.reduce((r,a)=>r+(a.wp_heizung_kwh||0),0),gesamtEautoLadung:t.reduce((r,a)=>r+(a.eauto_ladung_kwh||0),0),gesamtEautoKm:t.reduce((r,a)=>r+(a.eauto_km||0),0),durchschnittAutarkie:t.length>0?t.reduce((r,a)=>r+(a.autarkie_prozent||0),0)/t.length:0,anzahlMonate:t.length}}function us(t,r){const[a,s]=m.useState([]),[n,i]=m.useState(!0),[l,c]=m.useState(null),h=m.useCallback(async()=>{try{i(!0),c(null);const u=await tt.list(t,r);s(u)}catch(u){c(u instanceof Error?u.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[t,r]);m.useEffect(()=>{h()},[h]);const g=m.useCallback(async u=>{const d=await tt.create(u);return s(p=>[...p,d]),d},[]),o=m.useCallback(async(u,d)=>{const p=await tt.update(u,d);return s(b=>b.map(j=>j.id===u?p:j)),p},[]),x=m.useCallback(async u=>{await tt.delete(u),s(d=>d.filter(p=>p.id!==u))},[]);return{investitionen:a,loading:n,error:l,refresh:h,createInvestition:g,updateInvestition:o,deleteInvestition:x}}function Ph(t){return t.reduce((a,s)=>(a[s.typ]||(a[s.typ]=[]),a[s.typ].push(s),a),{})}function Dh(t){const[r,a]=m.useState([]),[s,n]=m.useState(!0),[i,l]=m.useState(null),c=m.useCallback(async()=>{try{n(!0),l(null);const x=await xa.list(t);a(x)}catch(x){l(x instanceof Error?x.message:"Fehler beim Laden der Strompreise")}finally{n(!1)}},[t]);m.useEffect(()=>{c()},[c]);const h=m.useCallback(async x=>{const u=await xa.create(x);return a(d=>[u,...d]),u},[]),g=m.useCallback(async(x,u)=>{const d=await xa.update(x,u);return a(p=>p.map(b=>b.id===x?d:b)),d},[]),o=m.useCallback(async x=>{await xa.delete(x),a(u=>u.filter(d=>d.id!==x))},[]);return{strompreise:r,loading:s,error:i,refresh:c,createStrompreis:h,updateStrompreis:g,deleteStrompreis:o}}function Xo(t){const[r,a]=m.useState(null),[s,n]=m.useState(!1),[i,l]=m.useState(null);return m.useEffect(()=>{if(t===null){a(null);return}(async()=>{try{n(!0),l(null);const h=await xa.getAktuell(t);a(h)}catch{a(null)}finally{n(!1)}})()},[t]),{strompreis:r,loading:s,error:i}}const Ur={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function Qo(t){return t<=10?8.2:t<=40?7.1:5.8}const Kn="eedc_setup_wizard_state",i0={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},Kr=["welcome","anlage","strompreise","investitionen","summary","complete"],ec=["wechselrichter","pv-module","speicher","balkonkraftwerk","waermepumpe","e-auto","wallbox","sonstiges"],rr={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"Wrmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},Lh={"pv-module":"wechselrichter",speicher:"wechselrichter"},Ih=["pv-module"];function Vh(){const[t,r]=m.useState(()=>{try{const M=localStorage.getItem(Kn);if(M)return JSON.parse(M)}catch{}return i0}),[a,s]=m.useState(t.currentStep),[n,i]=m.useState(!1),[l,c]=m.useState(null),[h,g]=m.useState(null),[o,x]=m.useState(null),[u,d]=m.useState([]),[p,b]=m.useState(null),[j,f]=m.useState(null),y=m.useRef(new Map);m.useEffect(()=>{localStorage.setItem(Kn,JSON.stringify({...t,currentStep:a}))},[t,a]),m.useEffect(()=>{t.anlageId&&!h&&Lt.get(t.anlageId).then(g).catch(()=>{})},[t.anlageId,h]);const k=m.useCallback(async()=>{if(t.anlageId)try{const M=await tt.list(t.anlageId);d(M)}catch{}},[t.anlageId]);m.useEffect(()=>{k()},[k]);const _=m.useCallback(M=>{s(M),c(null)},[]),w=m.useCallback(async()=>{const M=y.current;if(M.size===0)return;const H=[];M.forEach(({data:K,timer:O},ee)=>{clearTimeout(O),H.push(tt.update(ee,K).catch(de=>{console.error(`Fehler beim Update von Investition ${ee}:`,de)}))}),M.clear(),await Promise.all(H),await k()},[k]),v=m.useCallback(async()=>{await w();const M=Kr.indexOf(a);M<Kr.length-1&&_(Kr[M+1])},[a,_,w]),E=m.useCallback(()=>{const M=Kr.indexOf(a);M>0&&_(Kr[M-1])},[a,_]),F=m.useCallback(()=>{r(M=>({...M,skippedSteps:[...M.skippedSteps,a]})),v()},[a,v]),C=m.useCallback(async(M,H)=>{try{const K=await Lt.geocode(M,H);return{latitude:K.latitude,longitude:K.longitude}}catch{return null}},[]),D=m.useCallback(async M=>{i(!0),c(null);try{const H=await Lt.create(M);g(H),r(K=>({...K,anlageId:H.id})),v()}catch(H){c(H instanceof Error?H.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[v]),A=m.useCallback(async M=>{if(!t.anlageId){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const H=await xa.create({anlage_id:t.anlageId,...M});x(H),r(K=>({...K,strompreisId:H.id})),v()}catch(H){c(H instanceof Error?H.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[t.anlageId,v]),S=m.useCallback(async()=>{if(!t.anlageId||!h){c("Keine Anlage vorhanden");return}const M=Qo(h.leistung_kwp);await A({netzbezug_arbeitspreis_cent_kwh:Ur.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:M,grundpreis_euro_monat:Ur.grundpreis_euro_monat,gueltig_ab:h.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,h,A]),W=m.useCallback(async(M,H)=>{d(de=>de.map(ue=>ue.id!==M?ue:{...ue,...H,parameter:H.parameter?{...ue.parameter||{},...H.parameter}:ue.parameter}));const K=y.current.get(M);K!=null&&K.timer&&clearTimeout(K.timer);const O=K!=null&&K.data?{...K.data,...H,parameter:H.parameter?{...K.data.parameter||{},...H.parameter}:K.data.parameter}:H,ee=setTimeout(async()=>{y.current.delete(M);try{await tt.update(M,O)}catch(de){c(de instanceof Error?de.message:"Fehler beim Aktualisieren"),await k()}},500);y.current.set(M,{data:O,timer:ee})},[k]),N=m.useCallback(async M=>{try{await tt.delete(M),await k()}catch(H){c(H instanceof Error?H.message:"Fehler beim Lschen")}},[k]),z=m.useCallback(async M=>{if(!t.anlageId)throw new Error("Keine Anlage vorhanden");c(null);try{let H;if(M==="pv-module"||M==="speicher"){const O=u.find(ee=>ee.typ==="wechselrichter");O&&(H=O.id)}const K=await tt.create({anlage_id:t.anlageId,typ:M,bezeichnung:`Neue ${rr[M]}`,aktiv:!0,...H?{parent_investition_id:H}:{}});return await k(),K}catch(H){const K=H instanceof Error?H.message:"Fehler beim Hinzufgen";throw c(K),H}},[t.anlageId,u,k]),$=m.useCallback(async()=>{if(!t.anlageId||!h){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const M=await tt.create({anlage_id:t.anlageId,typ:"wechselrichter",bezeichnung:"Wechselrichter",aktiv:!0,anschaffungsdatum:h.installationsdatum});await tt.create({anlage_id:t.anlageId,typ:"pv-module",bezeichnung:"PV-Module",leistung_kwp:h.leistung_kwp,ausrichtung:h.ausrichtung,neigung_grad:h.neigung_grad,parent_investition_id:M.id,aktiv:!0,anschaffungsdatum:h.installationsdatum}),r(H=>({...H,createdInvestitionen:[...H.createdInvestitionen,M.id]})),await k()}catch(M){c(M instanceof Error?M.message:"Fehler beim Erstellen des PV-Systems")}finally{i(!1)}},[t.anlageId,h,k]),T=m.useCallback(async()=>{if(!t.anlageId||!h)return;if(!h.latitude||!h.longitude){f("Keine Koordinaten vorhanden");return}if(!u.some(H=>H.typ==="pv-module")){f("Keine PV-Module vorhanden");return}i(!0),f(null);try{const H=await Nt.speicherePrognose(t.anlageId);b(H)}catch(H){const K=H instanceof Error?H.message:"Fehler beim Abrufen der PVGIS-Prognose";f(K)}finally{i(!1)}},[t.anlageId,h,u]),I=m.useCallback(()=>{r(M=>({...M,completed:!0,currentStep:"complete"})),s("complete")},[]),V=m.useCallback(()=>{localStorage.removeItem(Kn),r(i0),s("welcome"),g(null),x(null),d([]),c(null)},[]),G=(()=>{switch(a){case"welcome":return!0;case"anlage":return!!t.anlageId;case"strompreise":return!!t.strompreisId;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),Z=Math.round(Kr.indexOf(a)/(Kr.length-1)*100),R=!!(h!=null&&h.latitude&&(h!=null&&h.longitude)&&u.some(M=>M.typ==="pv-module"));return{step:a,wizardState:t,isLoading:n,error:l,anlage:h,strompreis:o,pvgisPrognose:p,pvgisError:j,investitionen:u,refreshInvestitionen:k,goToStep:_,nextStep:v,prevStep:E,skipStep:F,createAnlage:D,geocodeAddress:C,createStrompreis:A,useDefaultStrompreise:S,updateInvestition:W,deleteInvestition:N,addInvestition:z,createDefaultPVSystem:$,fetchPvgisPrognose:T,completeWizard:I,resetWizard:V,canProceed:G,progress:Z,canFetchPvgis:R}}const l0=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Bh(){var w,v,E,F,C,D,A;const t=lr(),{anlagen:r,loading:a}=it(),[s,n]=m.useState(null),[i,l]=m.useState(null),[c,h]=m.useState([]),[g,o]=m.useState(!0),[x,u]=m.useState(null),[d,p]=m.useState(void 0),[b,j]=m.useState([]),[f,y]=m.useState(!1),k=(w=r[0])==null?void 0:w.id;if(m.useEffect(()=>{if(!k)return;(async()=>{o(!0),u(null);try{const[W,N]=await Promise.all([pr.getUebersicht(k,d),_r.listAggregiert(k)]);if(n(W),h(N),W.zeitraum_von&&W.zeitraum_bis){const z=parseInt(W.zeitraum_von.split("-")[0]),$=parseInt(W.zeitraum_bis.split("-")[0]),T=[];for(let I=z;I<=$;I++)T.push(I);j(T)}if(d)try{const z=await pr.getUebersicht(k,d-1);l(z.anzahl_monate>0?z:null)}catch{l(null)}else l(null)}catch(W){u("Fehler beim Laden der Daten"),console.error(W)}finally{o(!1)}})()},[k,d]),a||g)return e.jsx(Se,{text:"Lade Dashboard..."});if(r.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"bersicht"}),e.jsx(Jh,{})]});if(x||!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"bersicht"}),e.jsxs(P,{children:[e.jsx("p",{className:"text-red-500",children:x||"Keine Daten verfgbar"}),e.jsx(se,{onClick:()=>t("/einstellungen/monatsdaten"),className:"mt-4",children:"Monatsdaten erfassen"})]})]});const _=r[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(dt,{className:"h-8 w-8 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"bersicht"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[_.anlagenname,"  ",s.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(!0),className:"p-2 rounded-lg text-gray-400 hover:text-primary-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Monatstext fr Social Media",children:e.jsx(nl,{className:"h-4 w-4"})}),e.jsx($t,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:d||"",onChange:S=>p(S.target.value?parseInt(S.target.value):void 0),className:"input py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Alle Jahre"}),b.map(S=>e.jsx("option",{value:S,children:S},S))]})]})]}),s.zeitraum_von&&s.zeitraum_bis&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Zeitraum: ",s.zeitraum_von," bis ",s.zeitraum_bis," (",s.anzahl_monate," Monate)"]}),e.jsx(Oh,{data:s,prevData:i,year:d}),e.jsx(Rh,{data:s}),e.jsxs(zs,{title:"Energie-Bilanz",icon:Ne,children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(He,{title:"PV-Erzeugung",value:(s.pv_erzeugung_kwh/1e3).toFixed(1),unit:"MWh",icon:ce,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>t("/cockpit/pv-anlage"),formel:" PV-Erzeugung aller Monate",berechnung:`${L(s.pv_erzeugung_kwh,0)} kWh`,ergebnis:`= ${L(s.pv_erzeugung_kwh/1e3,1)} MWh`}),e.jsx(He,{title:"Gesamtverbrauch",value:(s.gesamtverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:dt,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch + Netzbezug",berechnung:`${L(s.eigenverbrauch_kwh,0)} + ${L(s.netzbezug_kwh,0)} kWh`,ergebnis:`= ${L(s.gesamtverbrauch_kwh/1e3,1)} MWh`}),e.jsx(He,{title:"Netzbezug",value:(s.netzbezug_kwh/1e3).toFixed(1),unit:"MWh",icon:Ul,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:" Netzbezug aller Monate",berechnung:`${L(s.netzbezug_kwh,0)} kWh`,ergebnis:`= ${L(s.netzbezug_kwh/1e3,1)} MWh`}),e.jsx(He,{title:"Einspeisung",value:(s.einspeisung_kwh/1e3).toFixed(1),unit:"MWh",icon:Rn,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:" Einspeisung aller Monate",berechnung:`${L(s.einspeisung_kwh,0)} kWh`,ergebnis:`= ${L(s.einspeisung_kwh/1e3,1)} MWh`})]}),e.jsx(Th,{monatsdaten:c,selectedYear:d})]}),e.jsx(zs,{title:"Effizienz-Quoten",icon:rs,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(o0,{title:"Autarkie",value:s.autarkie_prozent,subtitle:"Unabhngigkeit",color:"#3b82f6",formel:"Eigenverbrauch  Gesamtverbrauch  100",berechnung:`${L(s.eigenverbrauch_kwh,0)}  ${L(s.gesamtverbrauch_kwh,0)}  100`,ergebnis:`= ${L(s.autarkie_prozent,1)} %`}),e.jsx(o0,{title:"Eigenverbrauch",value:s.eigenverbrauch_quote_prozent,subtitle:"Selbst genutzte PV",color:"#a855f7",formel:"Eigenverbrauch  Erzeugung  100",berechnung:`${L(s.eigenverbrauch_kwh,0)}  ${L(s.pv_erzeugung_kwh,0)}  100`,ergebnis:`= ${L(s.eigenverbrauch_quote_prozent,1)} %`}),e.jsx(He,{title:"Direktverbrauchsquote",value:s.direktverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Ohne Speicher-Umweg",icon:Fe,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Direktverbrauch  Erzeugung  100",berechnung:`${L(s.direktverbrauch_kwh,0)}  ${L(s.pv_erzeugung_kwh,0)}  100`,ergebnis:`= ${L(s.direktverbrauch_quote_prozent,1)} %`}),e.jsx(He,{title:"Spez. Ertrag",value:((v=s.spezifischer_ertrag_kwh_kwp)==null?void 0:v.toFixed(0))||"---",unit:"kWh/kWp",subtitle:"Anlageneffizienz",icon:ce,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Erzeugung  Anlagenleistung",berechnung:`${L(s.pv_erzeugung_kwh,0)} kWh  ${L(s.anlagenleistung_kwp,2)} kWp`,ergebnis:`= ${L(s.spezifischer_ertrag_kwh_kwp||0,0)} kWh/kWp`})]})}),s.hat_speicher&&e.jsx(Hn,{title:"Speicher",icon:Ce,onClick:()=>t("/cockpit/speicher"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(He,{title:"Ladung gesamt",value:(s.speicher_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Ul,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:" Speicher-Ladung",berechnung:`${L(s.speicher_ladung_kwh,0)} kWh`,ergebnis:`= ${L(s.speicher_ladung_kwh/1e3,2)} MWh`}),e.jsx(He,{title:"Entladung gesamt",value:(s.speicher_entladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Rn,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" Speicher-Entladung",berechnung:`${L(s.speicher_entladung_kwh,0)} kWh`,ergebnis:`= ${L(s.speicher_entladung_kwh/1e3,2)} MWh`}),e.jsx(He,{title:" Effizienz",value:((E=s.speicher_effizienz_prozent)==null?void 0:E.toFixed(1))||"---",unit:"%",icon:Za,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"Entladung  Ladung  100",berechnung:`${L(s.speicher_entladung_kwh,0)}  ${L(s.speicher_ladung_kwh,0)}  100`,ergebnis:`= ${L(s.speicher_effizienz_prozent||0,1)} %`}),e.jsx(He,{title:"Vollzyklen",value:((F=s.speicher_vollzyklen)==null?void 0:F.toFixed(0))||"---",unit:"",subtitle:`${s.speicher_kapazitaet_kwh.toFixed(1)} kWh Kapazitt`,icon:Ce,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Ladung  Kapazitt",berechnung:`${L(s.speicher_ladung_kwh,0)} kWh  ${L(s.speicher_kapazitaet_kwh,1)} kWh`,ergebnis:`= ${L(s.speicher_vollzyklen||0,0)} Zyklen`})]})}),s.hat_waermepumpe&&e.jsx(Hn,{title:"Wrmepumpe",icon:et,onClick:()=>t("/cockpit/waermepumpe"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(He,{title:"Wrme erzeugt",value:(s.wp_waerme_kwh/1e3).toFixed(2),unit:"MWh",icon:et,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:" Heizung + Warmwasser",berechnung:`${L(s.wp_waerme_kwh,0)} kWh`,ergebnis:`= ${L(s.wp_waerme_kwh/1e3,2)} MWh`}),e.jsx(He,{title:"Strom verbraucht",value:(s.wp_strom_kwh/1e3).toFixed(2),unit:"MWh",icon:Ne,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:" WP-Stromverbrauch",berechnung:`${L(s.wp_strom_kwh,0)} kWh`,ergebnis:`= ${L(s.wp_strom_kwh/1e3,2)} MWh`}),e.jsx(He,{title:" COP",value:((C=s.wp_cop)==null?void 0:C.toFixed(1))||"---",unit:"",icon:Za,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wrme  Strom",berechnung:`${L(s.wp_waerme_kwh,0)}  ${L(s.wp_strom_kwh,0)}`,ergebnis:`= ${L(s.wp_cop||0,1)}`}),e.jsx(He,{title:"Ersparnis vs. Gas",value:s.wp_ersparnis_euro.toFixed(0),unit:"",icon:dr,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Gaskosten - Stromkosten",berechnung:`(${L(s.wp_waerme_kwh,0)} kWh  0.9  10ct) - (${L(s.wp_strom_kwh,0)} kWh  Strompreis)`,ergebnis:`= ${L(s.wp_ersparnis_euro,0)} `})]})}),s.hat_emobilitaet&&e.jsx(Hn,{title:"E-Mobilitt",icon:Te,onClick:()=>t("/cockpit/e-auto"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(He,{title:"Gefahrene km",value:(s.emob_km/1e3).toFixed(1),unit:"Tkm",icon:Te,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:" gefahrene Kilometer",berechnung:`${L(s.emob_km,0)} km`,ergebnis:`= ${L(s.emob_km/1e3,1)} Tkm`}),e.jsx(He,{title:"Ladung gesamt",value:(s.emob_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Ne,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" Heim + Extern Ladung",berechnung:`${L(s.emob_ladung_kwh,0)} kWh`,ergebnis:`= ${L(s.emob_ladung_kwh/1e3,2)} MWh`}),e.jsx(He,{title:"PV-Anteil",value:((D=s.emob_pv_anteil_prozent)==null?void 0:D.toFixed(0))||"---",unit:"%",icon:ce,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"PV-Ladung  Heimladung  100",berechnung:"PV-geladene kWh  Gesamt-Ladung",ergebnis:`= ${L(s.emob_pv_anteil_prozent||0,0)} %`}),e.jsx(He,{title:"Ersparnis vs. Benzin",value:s.emob_ersparnis_euro.toFixed(0),unit:"",icon:dr,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Benzinkosten - Stromkosten",berechnung:"Benzin (7L/100km  1.80) - Strom",ergebnis:`= ${L(s.emob_ersparnis_euro,0)} `})]})}),e.jsxs(zs,{title:"Finanzen",icon:dr,children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(He,{title:"Einspeiseerls",value:s.einspeise_erloes_euro.toFixed(0),unit:"",icon:Rn,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung  Vergtung",berechnung:`${L(s.einspeisung_kwh,0)} kWh  8.2 ct/kWh`,ergebnis:`= ${L(s.einspeise_erloes_euro,0)} `}),e.jsx(He,{title:"EV-Ersparnis",value:s.ev_ersparnis_euro.toFixed(0),unit:"",icon:Ne,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch  Strompreis",berechnung:`${L(s.eigenverbrauch_kwh,0)} kWh  Strompreis`,ergebnis:`= ${L(s.ev_ersparnis_euro,0)} `}),s.ust_eigenverbrauch_euro!=null&&s.ust_eigenverbrauch_euro>0&&e.jsx(He,{title:"USt Eigenverbrauch",value:`-${s.ust_eigenverbrauch_euro.toFixed(0)}`,unit:"",icon:Ko,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"EV  Selbstkosten  USt-Satz",berechnung:"Regelbesteuerung: USt auf unentgeltliche Wertabgabe",ergebnis:`= -${L(s.ust_eigenverbrauch_euro,0)} `}),e.jsx(He,{title:"Netto-Ertrag",value:s.netto_ertrag_euro.toFixed(0),unit:"",icon:Fe,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:s.ust_eigenverbrauch_euro?"Erls + Ersparnis  USt":"Erls + Ersparnis",berechnung:s.ust_eigenverbrauch_euro?`${L(s.einspeise_erloes_euro,0)} + ${L(s.ev_ersparnis_euro,0)}  ${L(s.ust_eigenverbrauch_euro,0)} `:`${L(s.einspeise_erloes_euro,0)} + ${L(s.ev_ersparnis_euro,0)} `,ergebnis:`= ${L(s.netto_ertrag_euro,0)} `}),e.jsx(He,{title:"Jahres-Rendite",value:((A=s.jahres_rendite_prozent)==null?void 0:A.toFixed(1))||"---",unit:"%",subtitle:`von ${s.investition_gesamt_euro.toFixed(0)}  Invest`,icon:Za,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",onClick:()=>t("/auswertungen/roi"),formel:"Jahres-Ertrag  Investition  100",berechnung:`${L(s.netto_ertrag_euro,0)}   ${L(s.investition_gesamt_euro,0)} `,ergebnis:`= ${L(s.jahres_rendite_prozent||0,1)} % p.a.`})]}),!d&&s.investition_gesamt_euro>0&&e.jsx(Kh,{data:s})]}),e.jsx(zs,{title:"CO-Bilanz",icon:kt,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(He,{title:"CO PV",value:(s.co2_pv_kg/1e3).toFixed(1),unit:"t",subtitle:"Vermiedene Emissionen",icon:ce,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Eigenverbrauch  CO-Faktor",berechnung:`${L(s.eigenverbrauch_kwh,0)} kWh  0.38 kg/kWh`,ergebnis:`= ${L(s.co2_pv_kg,0)} kg`}),e.jsx(He,{title:"CO Wrmepumpe",value:(s.co2_wp_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Gas-Heizung",icon:et,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO Gas - CO Strom",berechnung:"Gasverbrauch  0.201 - WP-Strom  0.38",ergebnis:`= ${L(s.co2_wp_kg,0)} kg`}),e.jsx(He,{title:"CO E-Mobilitt",value:(s.co2_emob_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Verbrenner",icon:Te,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"CO Benzin - CO Strom",berechnung:"Benzinverbrauch  2.37 - Stromverbrauch  0.38",ergebnis:`= ${L(s.co2_emob_kg,0)} kg`}),e.jsx(He,{title:"CO gesamt",value:(s.co2_gesamt_kg/1e3).toFixed(1),unit:"t",subtitle:"Gesamte Einsparung",icon:kt,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:" aller CO-Einsparungen",berechnung:`${L(s.co2_pv_kg,0)} + ${L(s.co2_wp_kg,0)} + ${L(s.co2_emob_kg,0)} kg`,ergebnis:`= ${L(s.co2_gesamt_kg/1e3,1)} t`})]})}),_.community_hash&&e.jsx(Hh,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Gn,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/einstellungen/monatsdaten")}),e.jsx(Gn,{title:"Auswertungen",description:"Detaillierte Analysen und Zeitverlufe",onClick:()=>t("/auswertungen")}),e.jsx(Gn,{title:"Investitionen",description:"Komponenten verwalten",onClick:()=>t("/einstellungen/investitionen")})]}),f&&k&&e.jsx(Zh,{anlageId:k,availableYears:b,monatsdaten:c,onClose:()=>y(!1)})]})}function Oh({data:t,prevData:r,year:a}){const s=(i,l)=>!l||l===0?null:(i-l)/l*100,n=[{label:"Autarkie",value:`${t.autarkie_prozent.toFixed(1)} %`,delta:s(t.autarkie_prozent,r==null?void 0:r.autarkie_prozent),color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-50 dark:bg-blue-900/20"},{label:"Spez. Ertrag",value:t.spezifischer_ertrag_kwh_kwp?`${t.spezifischer_ertrag_kwh_kwp.toFixed(0)} kWh/kWp`:"---",delta:s(t.spezifischer_ertrag_kwh_kwp||0,(r==null?void 0:r.spezifischer_ertrag_kwh_kwp)??void 0),color:"text-yellow-600 dark:text-yellow-400",bg:"bg-yellow-50 dark:bg-yellow-900/20"},{label:"Netto-Ertrag",value:`${t.netto_ertrag_euro.toFixed(0)} `,delta:s(t.netto_ertrag_euro,r==null?void 0:r.netto_ertrag_euro),color:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-50 dark:bg-emerald-900/20"}];return e.jsx("div",{className:"grid grid-cols-3 gap-3",children:n.map(i=>e.jsxs("div",{className:`rounded-xl p-4 ${i.bg}`,children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:i.label}),e.jsx("p",{className:`text-2xl font-bold ${i.color}`,children:i.value}),i.delta!==null&&a&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs font-medium ${i.delta>=0?"text-green-600 dark:text-green-400":"text-red-500 dark:text-red-400"}`,children:[i.delta>.5?e.jsx(Fe,{className:"h-3 w-3"}):i.delta<-.5?e.jsx(Gt,{className:"h-3 w-3"}):e.jsx(ts,{className:"h-3 w-3"}),i.delta>0?"+":"",i.delta.toFixed(1)," % vs. ",a-1]})]},i.label))})}function Rh({data:t}){const r=t.pv_erzeugung_kwh;if(r<=0)return null;const a=Math.max(0,t.direktverbrauch_kwh),s=t.hat_speicher?Math.max(0,t.speicher_ladung_kwh):0,n=Math.max(0,t.einspeisung_kwh),i=a+s+n||r,l=t.hat_speicher?Math.max(0,t.speicher_entladung_kwh):0,c=Math.max(0,t.netzbezug_kwh),h=a+l+c||t.gesamtverbrauch_kwh,g=x=>x>=1e3?`${(x/1e3).toFixed(1)} MWh`:`${x.toFixed(0)} kWh`,o=(x,u)=>u>0?Math.round(x/u*100):0;return e.jsxs(P,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-yellow-500"}),"Energie-Fluss"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1.5",children:[e.jsx(ce,{className:"h-3.5 w-3.5 text-yellow-500"}),e.jsxs("span",{children:["PV erzeugt: ",e.jsx("strong",{className:"text-gray-700 dark:text-gray-300",children:g(r)})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"Wohin?"})]}),e.jsxs("div",{className:"flex h-7 rounded-lg overflow-hidden gap-px bg-gray-100 dark:bg-gray-700",children:[a>0&&e.jsx("div",{className:"bg-blue-500 flex items-center justify-center transition-all",style:{width:`${o(a,i)}%`},title:`Direktverbrauch: ${g(a)}`,children:o(a,i)>=12&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[o(a,i),"%"]})}),s>0&&e.jsx("div",{className:"bg-green-500 flex items-center justify-center",style:{width:`${o(s,i)}%`},title:`Speicher: ${g(s)}`,children:o(s,i)>=12&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[o(s,i),"%"]})}),n>0&&e.jsx("div",{className:"bg-orange-400 flex items-center justify-center",style:{width:`${o(n,i)}%`},title:`Einspeisung: ${g(n)}`,children:o(n,i)>=12&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[o(n,i),"%"]})})]}),e.jsxs("div",{className:"flex gap-4 mt-1.5 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-blue-500 inline-block flex-shrink-0"}),"Direkt ",g(a)]}),s>0&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-green-500 inline-block flex-shrink-0"}),"Speicher ",g(s)]}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-orange-400 inline-block flex-shrink-0"}),"Einspeis. ",g(n)]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1.5",children:[e.jsx(dt,{className:"h-3.5 w-3.5 text-purple-500"}),e.jsxs("span",{children:["Haus verbraucht: ",e.jsx("strong",{className:"text-gray-700 dark:text-gray-300",children:g(t.gesamtverbrauch_kwh)})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"Woher?"})]}),e.jsxs("div",{className:"flex h-7 rounded-lg overflow-hidden gap-px bg-gray-100 dark:bg-gray-700",children:[a>0&&e.jsx("div",{className:"bg-blue-500 flex items-center justify-center",style:{width:`${o(a,h)}%`},title:`PV direkt: ${g(a)}`,children:o(a,h)>=12&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[o(a,h),"%"]})}),l>0&&e.jsx("div",{className:"bg-green-500 flex items-center justify-center",style:{width:`${o(l,h)}%`},title:`Speicher: ${g(l)}`,children:o(l,h)>=12&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[o(l,h),"%"]})}),c>0&&e.jsx("div",{className:"bg-red-400 flex items-center justify-center",style:{width:`${o(c,h)}%`},title:`Netzbezug: ${g(c)}`,children:o(c,h)>=12&&e.jsxs("span",{className:"text-xs text-white font-medium",children:[o(c,h),"%"]})})]}),e.jsxs("div",{className:"flex gap-4 mt-1.5 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-blue-500 inline-block flex-shrink-0"}),"PV direkt ",g(a)]}),l>0&&e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-green-500 inline-block flex-shrink-0"}),"Speicher ",g(l)]}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-sm bg-red-400 inline-block flex-shrink-0"}),"Netzbezug ",g(c)]})]})]})]})]})}function o0({title:t,value:r,subtitle:a,color:s,formel:n,berechnung:i,ergebnis:l}){const h=2*Math.PI*32,g=Math.min(100,Math.max(0,r))/100*h,o=e.jsxs("svg",{viewBox:"0 0 80 80",className:"w-16 h-16 flex-shrink-0",children:[e.jsx("circle",{cx:"40",cy:"40",r:32,fill:"none",stroke:"currentColor",strokeWidth:"8",className:"text-gray-200 dark:text-gray-700"}),e.jsx("circle",{cx:"40",cy:"40",r:32,fill:"none",stroke:s,strokeWidth:"8",strokeDasharray:`${g} ${h}`,strokeLinecap:"round",transform:"rotate(-90 40 40)"}),e.jsx("text",{x:"40",y:"45",textAnchor:"middle",fontSize:"15",fontWeight:"bold",fill:s,children:r.toFixed(0)})]});return e.jsx(P,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[n?e.jsx(zr,{formel:n,berechnung:i,ergebnis:l,children:o}):o,e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[r.toFixed(1)," %"]}),a&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 truncate",children:a})]})]})})}function Th({monatsdaten:t,selectedYear:r}){var c,h;if(t.length<2)return null;const a=[...t].sort((g,o)=>g.jahr!==o.jahr?g.jahr-o.jahr:g.monat-o.monat),s=r?a.filter(g=>g.jahr===r):a;if(s.length<2)return null;const n=s[0].jahr,i=s.map(g=>({name:g.jahr!==n?`${l0[g.monat]} ${g.jahr}`:l0[g.monat],kwh:Math.round(g.pv_erzeugung_kwh)})),l=Math.max(...i.map(g=>g.kwh));return e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mb-2",children:["PV-Monatsertrge  ",r??`${s[0].jahr}${s[s.length-1].jahr}`]}),e.jsx("div",{className:"h-20",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,margin:{top:0,right:0,bottom:0,left:0},children:[e.jsx(ge,{formatter:g=>[`${g} kWh`,"PV-Ertrag"],contentStyle:{fontSize:11}}),e.jsx(oe,{dataKey:"kwh",radius:[2,2,0,0],children:i.map((g,o)=>e.jsx(Ze,{fill:g.kwh>=l*.8?"#f59e0b":g.kwh>=l*.5?"#fbbf24":"#fde68a"},o))})]})})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-0.5",children:[e.jsx("span",{children:(c=i[0])==null?void 0:c.name}),e.jsx("span",{children:(h=i[i.length-1])==null?void 0:h.name})]})]})}function Kh({data:t}){const r=t.investition_gesamt_euro,a=(t.netto_ertrag_euro||0)+(t.wp_ersparnis_euro||0)+(t.emob_ersparnis_euro||0)+(t.bkw_ersparnis_euro||0)+(t.sonstige_netto_euro||0),s=Math.min(100,Math.max(0,a/r*100));let n=null;if(t.anzahl_monate>0&&a>0&&s<100){const l=a/(t.anzahl_monate/12);l>0&&(n=new Date().getFullYear()+Math.ceil((r-a)/l))}const i=t.anzahl_monate>0&&a>0?a/(t.anzahl_monate/12):null;return e.jsxs("div",{className:"mt-4 p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs font-medium text-emerald-700 dark:text-emerald-300",children:"Amortisationsfortschritt"}),e.jsxs("span",{className:"text-xs text-emerald-600 dark:text-emerald-400",children:[s.toFixed(1)," % ",Math.round(a).toLocaleString("de"),"  von ",Math.round(r).toLocaleString("de")," "]})]}),e.jsx("div",{className:"h-3 bg-emerald-200 dark:bg-emerald-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full transition-all duration-500",style:{width:`${s}%`}})}),s>=100?e.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 mt-1 font-medium",children:" Investition vollstndig amortisiert!"}):n&&e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 mt-1",children:["Voraussichtliche Amortisation: ca. ",n]}),i&&e.jsxs("p",{className:"text-xs text-emerald-500/70 dark:text-emerald-400/60 mt-1 italic",children:["Basis: tatschlich realisierte Ertrge & Kosten ( ",Math.round(i).toLocaleString("de")," /Jahr ber ",t.anzahl_monate," Monate)"]})]})}function Hh(){const t=lr();return e.jsx("button",{onClick:()=>t("/community"),className:"w-full text-left card p-4 border border-yellow-200 dark:border-yellow-800 bg-yellow-50 dark:bg-yellow-900/20 hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-800/50 rounded-lg",children:e.jsx(Xr,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900 dark:text-yellow-100",children:"Community-Vergleich aktiv"}),e.jsx("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Deine Anlage wird mit anderen verglichen  Benchmark ansehen"})]})]}),e.jsx(Yt,{className:"h-4 w-4 text-yellow-500 group-hover:text-yellow-700 transition-colors flex-shrink-0"})]})})}function zs({title:t,icon:r,children:a}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),a]})}function Hn({title:t,icon:r,onClick:a,children:s}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),e.jsx(Yt,{className:"h-4 w-4 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),s]})}function He({title:t,value:r,unit:a,subtitle:s,icon:n,color:i,bgColor:l,onClick:c,formel:h,berechnung:g,ergebnis:o}){const x=e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:a})]}),u=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-0.5",children:h?e.jsx(zr,{formel:h,berechnung:g,ergebnis:o,children:x}):x}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate",children:s})]}),e.jsx("div",{className:`p-2 rounded-lg ${l} ml-2 flex-shrink-0`,children:e.jsx(n,{className:`h-5 w-5 ${i}`})})]});return c?e.jsx("button",{onClick:c,className:"card p-3 text-left hover:shadow-md transition-shadow w-full",children:u}):e.jsx(P,{className:"p-3",children:u})}function Gn({title:t,description:r,onClick:a}){return e.jsx("button",{onClick:a,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsx(ot,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}const Gh=["","Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];function Zh({anlageId:t,availableYears:r,monatsdaten:a,onClose:s}){const i=[...a].sort((v,E)=>v.jahr!==E.jahr?E.jahr-v.jahr:E.monat-v.monat)[0],[l,c]=m.useState((i==null?void 0:i.monat)||new Date().getMonth()+1),[h,g]=m.useState((i==null?void 0:i.jahr)||new Date().getFullYear()),[o,x]=m.useState("kompakt"),[u,d]=m.useState(null),[p,b]=m.useState(!1),[j,f]=m.useState(null),[y,k]=m.useState(!1),_=a.filter(v=>v.jahr===h).map(v=>v.monat).sort((v,E)=>v-E);m.useEffect(()=>{b(!0),f(null),d(null),pr.getShareText(t,l,h,o).then(v=>d(v.text)).catch(()=>f("Text konnte nicht generiert werden")).finally(()=>b(!1))},[t,l,h,o]),m.useEffect(()=>{const v=a.filter(E=>E.jahr===h).map(E=>E.monat);v.length>0&&!v.includes(l)&&c(Math.max(...v))},[h]);const w=async()=>{if(u){try{await navigator.clipboard.writeText(u)}catch{const v=document.createElement("textarea");v.value=u,v.style.position="fixed",v.style.opacity="0",document.body.appendChild(v),v.select(),document.execCommand("copy"),document.body.removeChild(v)}k(!0),setTimeout(()=>k(!1),2e3)}};return e.jsx(Dt,{isOpen:!0,onClose:s,title:"Social-Media-Text",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monat:"}),e.jsx("select",{value:l,onChange:v=>c(parseInt(v.target.value)),className:"input py-1.5 text-sm",children:_.map(v=>e.jsx("option",{value:v,children:Gh[v]},v))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahr:"}),e.jsx("select",{value:h,onChange:v=>g(parseInt(v.target.value)),className:"input py-1.5 text-sm",children:r.map(v=>e.jsx("option",{value:v,children:v},v))})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("button",{onClick:()=>x("kompakt"),className:`px-3 py-1.5 text-sm rounded-l-lg border transition-colors ${o==="kompakt"?"bg-primary-500 text-white border-primary-500":"bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:"Kompakt"}),e.jsx("button",{onClick:()=>x("ausfuehrlich"),className:`px-3 py-1.5 text-sm rounded-r-lg border-t border-r border-b transition-colors ${o==="ausfuehrlich"?"bg-primary-500 text-white border-primary-500":"bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600"}`,children:"Ausfhrlich"})]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 min-h-[200px]",children:p?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(Se,{text:"Generiere Text..."})}):j?e.jsx("p",{className:"text-sm text-red-500",children:j}):u?e.jsx("pre",{className:"text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap font-sans leading-relaxed",children:u}):null}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:w,disabled:!u||p,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${y?"bg-green-500 text-white":"bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-50 disabled:cursor-not-allowed"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx(ir,{className:"h-4 w-4"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(el,{className:"h-4 w-4"}),"In Zwischenablage kopieren"]})})})]})})}function Jh(){const t=lr();return e.jsxs(P,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(se,{onClick:()=>t("/einstellungen/anlage"),children:["Jetzt starten",e.jsx(ot,{className:"h-4 w-4 ml-2"})]})]})}const $r=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function qh({anlageId:t}){var o;const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,l]=m.useState(null);m.useEffect(()=>{let x=!1;return(async()=>{n(!0),l(null);try{const d=await pr.getPVStringsGesamtlaufzeit(t);x||a(d)}catch(d){if(!x){const p=d&&typeof d=="object"&&"detail"in d?String(d.detail):"Fehler beim Laden der String-Daten";l(p),console.error("PVStringVergleich Fehler:",d)}}finally{x||n(!1)}})(),()=>{x=!0}},[t]);const c=m.useMemo(()=>{if(!(r!=null&&r.strings)||r.strings.length===0)return[];const x={};for(const u of r.strings)for(const d of u.jahreswerte)x[d.jahr]||(x[d.jahr]={}),x[d.jahr][u.bezeichnung]={soll:d.prognose_kwh,ist:d.ist_kwh};return Object.entries(x).sort(([u],[d])=>Number(u)-Number(d)).map(([u,d])=>{const p={name:u};for(const b of r.strings){const j=d[b.bezeichnung];j&&(p[`${b.bezeichnung} SOLL`]=Math.round(j.soll),p[`${b.bezeichnung} IST`]=Math.round(j.ist))}return p})},[r]),h=m.useMemo(()=>r!=null&&r.saisonal_aggregiert?r.saisonal_aggregiert.map(x=>({name:x.monat_name.slice(0,3),SOLL:Math.round(x.prognose_kwh),"IST ":Math.round(x.ist_durchschnitt_kwh),"IST Summe":Math.round(x.ist_summe_kwh)})):[],[r]);if(s)return e.jsx(Se,{text:"Lade String-Vergleich..."});if(i)return e.jsx(te,{type:"error",children:i});if(!r||!r.strings||r.strings.length===0)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen  Investitionen anlegen."})]});if(!r.hat_prognose)return e.jsx(te,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen  PVGIS eine Prognose abrufen."})]})});const g=({ratio:x})=>{if(x==null)return e.jsx("span",{className:"text-gray-400",children:"-"});const u=x*100,d=u>=95?"text-green-600":u<85?"text-red-600":"text-amber-600",p=u>=95?Fe:u<85?Gt:null;return e.jsxs("span",{className:`flex items-center gap-1 ${d}`,children:[p&&e.jsx(p,{className:"h-3 w-3"}),u.toFixed(0),"%"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"SOLL (Prognose)"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:[(r.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("p",{className:"text-xs text-blue-500",children:[r.anzahl_jahre," Jahre  PVGIS"]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"IST (Erzeugt)"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(r.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("p",{className:"text-xs text-amber-500",children:[r.anzahl_monate," Monate erfasst"]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${(r.abweichung_gesamt_prozent??0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Abweichung"}),e.jsxs("p",{className:`text-xl font-bold ${(r.abweichung_gesamt_prozent??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(r.abweichung_gesamt_prozent??0)>=0?"+":"",((o=r.abweichung_gesamt_prozent)==null?void 0:o.toFixed(1))??"0","%"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-700 dark:text-gray-300",children:[r.erstes_jahr," - ",r.letztes_jahr]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.anlagen_leistung_kwp.toFixed(1)," kWp"]})]})]}),r.strings.length>1&&(r.bester_string||r.schlechtester_string)&&e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[r.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full",children:[e.jsx(Fe,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300",children:["Beste Performance: ",e.jsx("strong",{children:r.bester_string})]})]}),r.schlechtester_string&&r.schlechtester_string!==r.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-full",children:[e.jsx(Gt,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-red-700 dark:text-red-300",children:["Schwchster: ",e.jsx("strong",{children:r.schlechtester_string})]})]})]}),c.length>0&&e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx($t,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro Jahr"]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:c,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name"}),e.jsx(be,{unit:" kWh"}),e.jsx(ge,{formatter:x=>[`${x.toLocaleString()} kWh`]}),e.jsx(De,{}),r.strings.map((x,u)=>e.jsx(oe,{dataKey:`${x.bezeichnung} SOLL`,fill:$r[u%$r.length],opacity:.4,name:`${x.bezeichnung} SOLL`},`${x.investition_id}-soll`)),r.strings.map((x,u)=>e.jsx(oe,{dataKey:`${x.bezeichnung} IST`,fill:$r[u%$r.length],name:`${x.bezeichnung} IST`},`${x.investition_id}-ist`))]})})})]}),h.length>0&&e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Kt,{className:"h-5 w-5 text-green-500"}),"Saisonaler Vergleich (Jan - Dez)"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Vergleicht die monatliche PVGIS-Prognose mit dem Durchschnitt der tatschlichen Erzeugung ber alle Jahre."}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:h,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name"}),e.jsx(be,{unit:" kWh"}),e.jsx(ge,{formatter:x=>[`${x.toLocaleString()} kWh`]}),e.jsx(De,{}),e.jsx(It,{type:"monotone",dataKey:"SOLL",fill:"#3b82f6",stroke:"#3b82f6",fillOpacity:.2,name:"PVGIS Prognose"}),e.jsx(qe,{type:"monotone",dataKey:"IST ",stroke:"#f59e0b",strokeWidth:3,dot:{r:4},name:"IST Durchschnitt"})]})})})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einzelne Strings / Module (Gesamtlaufzeit)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String / Modul"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abw."}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Performance"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.strings.map((x,u)=>{var d,p;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:$r[u%$r.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:x.bezeichnung})]}),x.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:[" ",x.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:x.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3 text-gray-600 dark:text-gray-400",children:[x.ausrichtung||"-",x.neigung_grad!=null&&` / ${x.neigung_grad}`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600 dark:text-blue-400",children:[(x.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right font-medium",style:{color:$r[u%$r.length]},children:[(x.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right ${(x.abweichung_gesamt_prozent??0)>=0?"text-green-600":"text-red-600"}`,children:[(x.abweichung_gesamt_prozent??0)>=0?"+":"",((d=x.abweichung_gesamt_prozent)==null?void 0:d.toFixed(1))??"0","%"]}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(g,{ratio:x.performance_ratio_gesamt})}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:((p=x.spezifischer_ertrag_kwh_kwp)==null?void 0:p.toFixed(0))??"-"})]},x.investition_id)})})]})})]})]})}const Fa={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"};function Uh(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState(null),[l,c]=m.useState([]),[h,g]=m.useState(!0);m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]);const{investitionen:o,loading:x}=us(a);m.useEffect(()=>{if(!a)return;(async()=>{g(!0);try{const[N,z]=await Promise.all([pr.getUebersicht(a),_r.listAggregiert(a)]);i(N),c(z)}catch(N){console.error("Fehler beim Laden der Daten:",N)}finally{g(!1)}})()},[a]);const{pvSysteme:u,orphanModule:d}=m.useMemo(()=>{const W=[],N=[],z=o.filter(I=>I.typ==="wechselrichter"),$=o.filter(I=>I.typ==="pv-module"),T=o.filter(I=>I.typ==="speicher");for(const I of z){const V=$.filter(R=>R.parent_investition_id===I.id),G=T.filter(R=>R.parent_investition_id===I.id),Z=V.reduce((R,M)=>R+(M.leistung_kwp||0),0);W.push({wechselrichter:I,pvModule:V,speicher:G,gesamtKwp:Z})}for(const I of $)(!I.parent_investition_id||!z.find(V=>V.id===I.parent_investition_id))&&N.push(I);return{pvSysteme:W,orphanModule:N}},[o]),p=(n==null?void 0:n.anlagenleistung_kwp)||0,b=(n==null?void 0:n.pv_erzeugung_kwh)||0,j=(n==null?void 0:n.eigenverbrauch_kwh)||0,f=(n==null?void 0:n.einspeisung_kwh)||0,y=(n==null?void 0:n.spezifischer_ertrag_kwh_kwp)||0,k=(n==null?void 0:n.eigenverbrauch_quote_prozent)||0,_=(n==null?void 0:n.anzahl_monate)||0,w=n==null?void 0:n.zeitraum_von,v=n==null?void 0:n.zeitraum_bis,E=m.useMemo(()=>{if(l.length===0)return[];const W=new Map;for(const N of l){W.has(N.jahr)||W.set(N.jahr,{erzeugung:0,eigenverbrauch:0,einspeisung:0});const z=W.get(N.jahr);z.erzeugung+=N.pv_erzeugung_kwh||0,z.eigenverbrauch+=N.eigenverbrauch_kwh||0,z.einspeisung+=N.einspeisung_kwh||0}return[...W.entries()].sort((N,z)=>N[0]-z[0]).map(([N,z])=>({name:N.toString(),Erzeugung:Math.round(z.erzeugung),Eigenverbrauch:Math.round(z.eigenverbrauch),Einspeisung:Math.round(z.einspeisung)}))},[l]),F=m.useMemo(()=>b===0?[]:[{name:"Eigenverbrauch",value:j,color:Fa.consumption},{name:"Einspeisung",value:f,color:Fa.feedin}],[b,j,f]),C=r||x||h,D=b>0,A=u.length>0||d.length>0,S=E.length>1;return C?e.jsx(Se,{text:"Lade PV-Anlage..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),w&&v&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Gesamtlaufzeit: ",w," bis ",v," (",_," Monate)"]})]})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:W=>s(parseInt(W.target.value)),options:t.map(W=>({value:W.id.toString(),label:W.anlagenname}))})]}),d.length>0&&e.jsx(te,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsxs("span",{children:[d.length," PV-Modul(e) ohne Wechselrichter-Zuordnung."]})]})}),!A&&e.jsx(te,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen  Investitionen anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Le,{title:"Anlagenleistung",value:p>0?p.toFixed(1):"---",unit:"kWp",subtitle:`${u.length} WR, ${u.reduce((W,N)=>W+N.pvModule.length,0)+d.length} Module`,icon:ce,color:"yellow"}),e.jsx(Le,{title:"Gesamterzeugung",value:b>0?(b/1e3).toFixed(1):"---",unit:"MWh",subtitle:_>0?`${_} Monate Gesamtlaufzeit`:void 0,icon:Ne,color:"green"}),e.jsx(Le,{title:"Spez. Ertrag",value:y>0?y.toFixed(0):"---",unit:"kWh/kWp",subtitle:"Durchschnitt Gesamtlaufzeit",icon:Fe,color:"blue",formel:"Spez. Ertrag = Erzeugung  Leistung",berechnung:`${L(b,0)} kWh  ${L(p,1)} kWp`,ergebnis:`= ${L(y,0)} kWh/kWp`}),e.jsx(Le,{title:"Eigenverbrauch",value:k>0?k.toFixed(1):"---",unit:"%",subtitle:j>0?`${(j/1e3).toFixed(1)} MWh`:void 0,icon:$o,color:"purple"})]}),A&&e.jsxs(P,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsx("div",{className:"space-y-4",children:u.map(W=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:W.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[W.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[W.pvModule.map(N=>{var z;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(ce,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:N.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(z=N.leistung_kwp)==null?void 0:z.toFixed(1)," kWp",N.ausrichtung&&`  ${N.ausrichtung}`]})]},N.id)}),W.speicher.map(N=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:N.bezeichnung})]},N.id))]})]},W.wechselrichter.id))})]}),D&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(P,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:S?"Jahresbersicht (Gesamtlaufzeit)":"Jahresbersicht"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:E,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name"}),e.jsx(be,{unit:" kWh"}),e.jsx(ge,{formatter:W=>[`${W.toLocaleString()} kWh`]}),e.jsx(De,{}),e.jsx(oe,{dataKey:"Erzeugung",fill:Fa.solar}),e.jsx(oe,{dataKey:"Eigenverbrauch",fill:Fa.consumption}),e.jsx(oe,{dataKey:"Einspeisung",fill:Fa.feedin})]})})})]}),e.jsxs(P,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:F,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:W,percent:N})=>`${W}: ${(N*100).toFixed(0)}%`,labelLine:!1,children:F.map((W,N)=>e.jsx(Ze,{fill:W.color},`cell-${N}`))}),e.jsx(ge,{formatter:W=>[`${W.toLocaleString()} kWh`]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(j/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(f/1e3).toFixed(1)," MWh"]})]})]})]})]}),!D&&A&&e.jsxs(P,{className:"text-center py-12",children:[e.jsx(Kt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]}),A&&D&&a&&e.jsx(qh,{anlageId:a})]})}const c0=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Yh(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const x=await tt.getEAutoDashboard(a);i(x)}catch(x){g(x instanceof Error?x.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:o=>s(parseInt(o.target.value)),options:t.map(o=>({value:o.id.toString(),label:o.anlagenname}))})]}),h&&e.jsx(te,{type:"error",children:h}),l?e.jsx(Se,{text:"Lade E-Auto Daten..."}):n.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto fr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Fge ein E-Auto unter "Investitionen" hinzu.'})]})}):n.map(o=>e.jsx(Xh,{dashboard:o},o.investition.id))]})}function Xh({dashboard:t}){var h;const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(g=>({name:`${c0[g.monat]} ${g.jahr.toString().slice(2)}`,km:g.verbrauch_daten.km_gefahren||0,verbrauch:g.verbrauch_daten.verbrauch_kwh||0,pv:g.verbrauch_daten.ladung_pv_kwh||0,netz:g.verbrauch_daten.ladung_netz_kwh||0,extern:g.verbrauch_daten.ladung_extern_kwh||0,v2h:g.verbrauch_daten.v2h_entladung_kwh||0})),l=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.ladung_extern_kwh||0}].filter(g=>g.value>0),c=[{name:"E-Auto (Strom)",value:n.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:n.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.anzahl_monate," Monate Daten"]})]}),e.jsx(Te,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Gefahren",value:((h=n.gesamt_km)==null?void 0:h.toLocaleString("de-DE"))||"0",unit:"km",icon:Te,color:"blue",formel:" km gefahren",berechnung:`${n.anzahl_monate} Monate`,ergebnis:`= ${(n.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(Le,{title:"Verbrauch",value:(n.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:Ne,color:"yellow",formel:"Verbrauch = kWh  km  100",berechnung:`${(n.gesamt_verbrauch_kwh||0).toFixed(0)} kWh  ${n.gesamt_km||0} km  100`,ergebnis:`= ${(n.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(Le,{title:"PV-Anteil (Heim)",value:(n.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(n.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:kt,color:"green",formel:"PV-Anteil = PV-Ladung  Heimladung  100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh  ${(n.ladung_heim_kwh||0).toFixed(0)} kWh  100`,ergebnis:`= ${(n.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(Le,{title:"Ersparnis vs. Benzin",value:(n.gesamt_ersparnis_euro||0).toFixed(0),unit:"",subtitle:`+ Wallbox: ${(n.wallbox_ersparnis_euro||0).toFixed(0)} `,icon:Fe,color:"green",trend:(n.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten  Stromkosten",berechnung:`${(n.benzin_kosten_alternativ_euro||0).toFixed(0)}   ${(n.strom_kosten_gesamt_euro||0).toFixed(0)} `,ergebnis:`= ${(n.ersparnis_vs_benzin_euro||0).toFixed(2)} `})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic -mt-2",children:"Basis: tatschlich erfasste km & Ladedaten aus Monatsdaten (inkl. Dienst- und Privatfahrten)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsxs(Qt,{data:l,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:g,percent:o})=>`${g}: ${(o*100).toFixed(0)}%`,children:[e.jsx(Ze,{fill:"#22c55e"})," ",e.jsx(Ze,{fill:"#f97316"})," ",e.jsx(Ze,{fill:"#ef4444"})," "]}),e.jsx(ge,{formatter:g=>`${g.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(n.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(n.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(n.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(n.ladung_extern_kwh||0).toFixed(0)," kWh (",(n.ladung_extern_euro||0).toFixed(2)," )"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:c,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{type:"number",tickFormatter:g=>`${g}`}),e.jsx(be,{type:"category",dataKey:"name",width:120}),e.jsx(ge,{formatter:g=>`${g.toFixed(2)} `}),e.jsx(oe,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(n.ersparnis_vs_benzin_euro||0).toFixed(2)," "]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(oe,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(oe,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(oe,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(oe,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(n.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(n.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(n.v2h_ersparnis_euro||0).toFixed(2)," "]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(n.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:a.map(g=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[c0[g.monat]," ",g.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:g.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(g.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(g.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(g.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(g.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},g.id))})]})})]})]})}const d0=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Qh(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const x=await tt.getWaermepumpeDashboard(a);i(x)}catch(x){g(x instanceof Error?x.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wrmepumpe Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(et,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wrmepumpe Dashboard"})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:o=>s(parseInt(o.target.value)),options:t.map(o=>({value:o.id.toString(),label:o.anlagenname}))})]}),h&&e.jsx(te,{type:"error",children:h}),l?e.jsx(Se,{text:"Lade Wrmepumpe Daten..."}):n.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(et,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wrmepumpe fr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Fge eine Wrmepumpe unter "Investitionen" hinzu.'})]})}):n.map(o=>e.jsx(eg,{dashboard:o},o.investition.id))]})}function eg({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(h=>({name:`${d0[h.monat]} ${h.jahr.toString().slice(2)}`,strom:h.verbrauch_daten.stromverbrauch_kwh||0,heizung:h.verbrauch_daten.heizenergie_kwh||0,warmwasser:h.verbrauch_daten.warmwasser_kwh||0,cop:((h.verbrauch_daten.heizenergie_kwh||0)+(h.verbrauch_daten.warmwasser_kwh||0))/(h.verbrauch_daten.stromverbrauch_kwh||1)})),l=[{name:"Heizung",value:n.gesamt_heizenergie_kwh},{name:"Warmwasser",value:n.gesamt_warmwasser_kwh}],c=[{name:"Wrmepumpe",value:n.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/l",value:n.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.anzahl_monate," Monate Daten"]})]}),e.jsx(et,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:" COP",value:n.durchschnitt_cop.toFixed(2),icon:Br,color:"orange",formel:"COP = Wrme  Strom",berechnung:`${n.gesamt_waerme_kwh.toFixed(0)} kWh  ${n.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${n.durchschnitt_cop.toFixed(2)}`}),e.jsx(Le,{title:"Wrme erzeugt",value:(n.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:et,color:"red",formel:"Wrme = Heizung + Warmwasser",berechnung:`${n.gesamt_heizenergie_kwh.toFixed(0)} + ${n.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${n.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(Le,{title:"Strom verbraucht",value:(n.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:Ne,color:"yellow",formel:" Stromverbrauch WP",berechnung:`${n.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(Le,{title:"Ersparnis",value:n.ersparnis_euro.toFixed(0),unit:"",icon:Fe,color:"green",trend:n.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/l-Kosten  WP-Kosten",berechnung:`${n.alte_heizung_kosten_euro.toFixed(0)}   ${n.wp_kosten_euro.toFixed(0)} `,ergebnis:`= ${n.ersparnis_euro.toFixed(2)} `})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic -mt-2",children:"Basis: tatschlich erfasste Wrmemengen (Heizung + Warmwasser) aus Monatsdaten"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wrme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsxs(Qt,{data:l,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:g})=>`${h}: ${(g*100).toFixed(0)}%`,children:[e.jsx(Ze,{fill:"#ef4444"}),e.jsx(Ze,{fill:"#3b82f6"})]}),e.jsx(ge,{formatter:h=>`${h.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",n.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",n.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/l"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:c,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{type:"number",tickFormatter:h=>`${h}`}),e.jsx(be,{type:"category",dataKey:"name",width:100}),e.jsx(ge,{formatter:h=>`${h.toFixed(2)} `}),e.jsx(oe,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",n.ersparnis_euro.toFixed(2)," "]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wrmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(It,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(It,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{domain:[0,6]}),e.jsx(ge,{formatter:h=>h.toFixed(2)}),e.jsx(oe,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(kt,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO Ersparnis gegenber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:a.map(h=>{const g=h.verbrauch_daten.stromverbrauch_kwh||0,o=h.verbrauch_daten.heizenergie_kwh||0,x=h.verbrauch_daten.warmwasser_kwh||0,u=g>0?(o+x)/g:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[d0[h.monat]," ",h.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:g.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:o.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:x.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:u.toFixed(2)})]},h.id)})})]})})]})]})}const tg=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function rg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const x=await tt.getSpeicherDashboard(a);i(x)}catch(x){g(x instanceof Error?x.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:o=>s(parseInt(o.target.value)),options:t.map(o=>({value:o.id.toString(),label:o.anlagenname}))})]}),h&&e.jsx(te,{type:"error",children:h}),l?e.jsx(Se,{text:"Lade Speicher Daten..."}):n.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ce,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher fr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Fge einen Speicher unter "Investitionen" hinzu.'})]})}):n.map(o=>e.jsx(ag,{dashboard:o},o.investition.id))]})}function ag({dashboard:t}){var l;const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(c=>{const h=c.verbrauch_daten.ladung_kwh||0,g=c.verbrauch_daten.entladung_kwh||0,o=c.verbrauch_daten.speicher_ladung_netz_kwh||0;return{name:`${tg[c.monat]} ${c.jahr.toString().slice(2)}`,ladung:h,entladung:g,arbitrage:o,pvLadung:h-o,zyklen:n.kapazitaet_kwh>0?h/n.kapazitaet_kwh:0,effizienz:h>0?g/h*100:0}});return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.kapazitaet_kwh," kWh Kapazitt  ",n.anzahl_monate," Monate Daten"]})]}),e.jsx(Ce,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Vollzyklen",value:n.vollzyklen.toFixed(0),icon:dh,color:"blue",formel:"Vollzyklen = Ladung  Kapazitt",berechnung:`${n.gesamt_ladung_kwh.toFixed(0)} kWh  ${n.kapazitaet_kwh} kWh`,ergebnis:`= ${n.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(Le,{title:"Effizienz",value:n.effizienz_prozent.toFixed(1),unit:"%",icon:$o,color:"green",formel:"Effizienz = Entladung  Ladung  100",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh  ${n.gesamt_ladung_kwh.toFixed(0)} kWh  100`,ergebnis:`= ${n.effizienz_prozent.toFixed(1)} %`}),e.jsx(Le,{title:"Durchsatz",value:(n.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:Ne,color:"yellow",formel:"Durchsatz =  Entladung",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(Le,{title:"Ersparnis",value:n.ersparnis_euro.toFixed(0),unit:"",icon:Fe,color:"green",trend:n.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung  Strompreis",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh  Strompreis`,ergebnis:`= ${n.ersparnis_euro.toFixed(2)} `})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:n.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(n.gesamt_ladung_kwh-n.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),n.arbitrage_faehig&&n.arbitrage_kwh>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(eh,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h3",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Arbitrage (Netzladung)"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Netzladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[n.arbitrage_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:" Ladepreis"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[((l=n.arbitrage_avg_preis_cent)==null?void 0:l.toFixed(1))||"-"," ct/kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Anteil an Ladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(n.arbitrage_kwh/n.gesamt_ladung_kwh*100).toFixed(0)," %"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Arbitrage-Gewinn"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:["+",n.arbitrage_gewinn_euro.toFixed(0)," "]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),n.arbitrage_faehig&&n.arbitrage_kwh>0?e.jsxs(e.Fragment,{children:[e.jsx(oe,{dataKey:"pvLadung",stackId:"ladung",fill:"#3b82f6",name:"PV-Ladung"}),e.jsx(oe,{dataKey:"arbitrage",stackId:"ladung",fill:"#f59e0b",name:"Netz-Ladung"})]}):e.jsx(oe,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(oe,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{formatter:c=>c.toFixed(1)}),e.jsx(It,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{domain:[80,100]}),e.jsx(ge,{formatter:c=>`${c.toFixed(1)}%`}),e.jsx(qe,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((c,h)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:c.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:c.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:c.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:c.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[c.effizienz.toFixed(1),"%"]})]},h))})]})})]})]})}function sg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const x=await tt.getWallboxDashboard(a);i(x)}catch(x){g(x instanceof Error?x.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ht,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:o=>s(parseInt(o.target.value)),options:t.map(o=>({value:o.id.toString(),label:o.anlagenname}))})]}),h&&e.jsx(te,{type:"error",children:h}),l?e.jsx(Se,{text:"Lade Wallbox Daten..."}):n.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ht,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox fr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Fge eine Wallbox unter "Einstellungen  Investitionen" hinzu.'})]})}):n.map(o=>e.jsx(ng,{dashboard:o},o.investition.id))]})}function ng({dashboard:t}){const{investition:r,zusammenfassung:a}=t,s=a,n=[{name:"Heim: PV",value:s.ladung_pv_kwh||0},{name:"Heim: Netz",value:s.ladung_netz_kwh||0},{name:"Extern",value:s.extern_ladung_kwh||0}].filter(h=>h.value>0),i=[{name:"Heimladung (tatschlich)",value:s.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:s.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],l=s.leistung_kw||11,c=(s.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[l," kW Ladeleistung  ",s.anzahl_monate||0," Monate Daten"]})]}),e.jsx(Ht,{className:"h-10 w-10 text-purple-500"})]}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Heimladung",value:((s.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:dt,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} + ${(s.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(s.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(Le,{title:"PV-Anteil",value:(s.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:kt,color:"green",formel:"PV-Anteil = PV  Heimladung  100",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh  ${(s.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh  100`,ergebnis:`= ${(s.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(Le,{title:"Ersparnis vs. Extern",value:(s.ersparnis_vs_extern_euro||0).toFixed(0),unit:"",subtitle:"Wallbox-ROI",icon:Fe,color:"green",trend:(s.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten  Heim-Kosten",berechnung:`${(s.heim_als_extern_kosten_euro||0).toFixed(0)}   ${(s.heim_kosten_euro||0).toFixed(0)} `,ergebnis:`= ${(s.ersparnis_vs_extern_euro||0).toFixed(2)} `}),e.jsx(Le,{title:"Ladevorgnge",value:(s.gesamt_ladevorgaenge||0).toString(),subtitle:` ${(s.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:Ne,color:"blue",formel:" Ladevorgnge",berechnung:`${s.anzahl_monate||0} Monate`,ergebnis:`= ${s.gesamt_ladevorgaenge||0} Vorgnge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsxs(Qt,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:g})=>`${h}: ${(g*100).toFixed(0)}%`,children:[e.jsx(Ze,{fill:"#22c55e"})," ",e.jsx(Ze,{fill:"#f97316"})," ",e.jsx(Ze,{fill:"#ef4444"})," "]}),e.jsx(ge,{formatter:h=>`${h.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(s.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(s.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4 text-red-500"}),"Extern: ",(s.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{type:"number",tickFormatter:h=>`${h}`}),e.jsx(be,{type:"category",dataKey:"name",width:150}),e.jsx(ge,{formatter:h=>`${h.toFixed(2)} `}),e.jsx(De,{}),e.jsx(oe,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(s.ersparnis_vs_extern_euro||0).toFixed(2)," "]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklrt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(s.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(s.ladung_netz_kwh||0).toFixed(0)," kWh = ",(s.heim_kosten_euro||0).toFixed(2)," )"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(s.extern_preis_kwh_euro||.5).toFixed(2)," /kWh"]})]}),(s.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatschliche externe Ladung: ",(s.extern_ladung_kwh||0).toFixed(0)," kWh fr ",(s.extern_kosten_euro||0).toFixed(2)," "]})]}),r.anschaffungskosten_gesamt&&r.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.anschaffungskosten_gesamt.toLocaleString("de-DE")," "]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[s.anzahl_monate&&s.anzahl_monate>0?((s.ersparnis_vs_extern_euro||0)/s.anzahl_monate*12).toFixed(0):0," "]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const h=s.anzahl_monate&&s.anzahl_monate>0?(s.ersparnis_vs_extern_euro||0)/s.anzahl_monate*12:0;return h<=0?"":`${(r.anschaffungskosten_gesamt/h).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen  Monatsdaten".'})})]})}const ig=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function lg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const x=await tt.getBalkonkraftwerkDashboard(a);i(x)}catch(x){g(x instanceof Error?x.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:o=>s(parseInt(o.target.value)),options:t.map(o=>({value:o.id.toString(),label:o.anlagenname}))})]}),h&&e.jsx(te,{type:"error",children:h}),l?e.jsx(Se,{text:"Lade Balkonkraftwerk Daten..."}):n.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk fr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Fge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):n.map(o=>e.jsx(og,{dashboard:o},o.investition.id))]})}function og({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=a.map(h=>({name:`${ig[h.monat]} ${h.jahr.toString().slice(2)}`,erzeugung:h.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:h.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:h.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:h.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:h.verbrauch_daten.speicher_entladung_kwh||0})),l=[{name:"Eigenverbrauch",value:n.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:n.gesamt_einspeisung_kwh}],c=["#22c55e","#f59e0b"];return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.leistung_wp," Wp  ",n.anzahl_module," Module  ",n.anzahl_monate," Monate Daten",n.hat_speicher&&`  ${n.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(ce,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Erzeugung",value:n.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:Ne,color:"yellow",formel:" Erzeugung alle Monate",berechnung:`${n.anzahl_monate} Monate`,ergebnis:`= ${n.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(Le,{title:"Eigenverbrauch",value:n.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:dt,color:"green",formel:"EV-Quote = Eigenverbrauch  Erzeugung  100",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh  ${n.gesamt_erzeugung_kwh.toFixed(0)} kWh  100`,ergebnis:`= ${n.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(Le,{title:"Ersparnis",value:n.gesamt_ersparnis_euro.toFixed(0),unit:"",icon:Fe,color:"green",trend:n.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch  Strompreis",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh  Strompreis`,ergebnis:`= ${n.gesamt_ersparnis_euro.toFixed(2)} `}),e.jsx(Le,{title:"CO gespart",value:n.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:kt,color:"green",formel:"CO = Eigenverbrauch  0.4 kg/kWh",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh  0.4`,ergebnis:`= ${n.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic -mt-2",children:"Basis: tatschlich erfasster Eigenverbrauch aus Monatsdaten"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["Einspeisung",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(unvergtet)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[n.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Entgangener Erls",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(8 ct/kWh)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-500 dark:text-gray-400",children:[(n.gesamt_einspeisung_kwh*.08).toFixed(2)," "]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:l,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:g})=>`${h}: ${(g*100).toFixed(0)}%`,children:l.map((h,g)=>e.jsx(Ze,{fill:c[g%c.length]},`cell-${g}`))}),e.jsx(ge,{formatter:h=>`${h.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",n.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",n.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(It,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(It,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),n.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ce,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",n.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(oe,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(oe,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(kt,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),n.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:i.map((h,g)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:h.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:h.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:h.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:h.einspeisung.toFixed(1)}),n.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:h.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:h.speicher_entladung.toFixed(1)})]})]},g))})]})})]})]})}const hl=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],gl={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function cg(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);return m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{if(!a)return;(async()=>{c(!0),g(null);try{const x=await tt.getSonstigesDashboard(a);i(x)}catch(x){g(x instanceof Error?x.message:"Fehler beim Laden")}finally{c(!1)}})()},[a]),r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(as,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:o=>s(parseInt(o.target.value)),options:t.map(o=>({value:o.id.toString(),label:o.anlagenname}))})]}),h&&e.jsx(te,{type:"error",children:h}),l?e.jsx(Se,{text:"Lade Daten..."}):n.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(as,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen fr diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Fge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):n.map(o=>e.jsx(dg,{dashboard:o},o.investition.id))]})}function dg({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:s}=t,n=s,i=n.kategorie;return i==="erzeuger"?e.jsx(hg,{investition:r,monatsdaten:a,zusammenfassung:n}):i==="verbraucher"?e.jsx(gg,{investition:r,monatsdaten:a,zusammenfassung:n}):e.jsx(xg,{investition:r,monatsdaten:a,zusammenfassung:n})}function hg({investition:t,monatsdaten:r,zusammenfassung:a}){const s=r.map(i=>({name:`${hl[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0})),n=[{name:"Eigenverbrauch",value:a.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:a.gesamt_einspeisung_kwh||0}];return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:gl[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ne,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Erzeugung",value:(a.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:Ne,color:"yellow",formel:" Erzeugung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(Le,{title:"Eigenverbrauch",value:(a.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:dt,color:"green",formel:"EV-Quote = Eigenverbrauch  Erzeugung  100",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)}  ${(a.gesamt_erzeugung_kwh||0).toFixed(0)}  100`,ergebnis:`= ${(a.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(Le,{title:"Ersparnis",value:(a.gesamt_ersparnis_euro||0).toFixed(0),unit:"",icon:Fe,color:"green",trend:(a.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch  Strompreis",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh  Strompreis`,ergebnis:`= ${(a.gesamt_ersparnis_euro||0).toFixed(2)} `}),e.jsx(Le,{title:"CO gespart",value:(a.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:kt,color:"green",formel:"CO = Eigenverbrauch  0.4 kg/kWh",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh  0.4`,ergebnis:`= ${(a.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(ct,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," "]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsxs(Qt,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:l})=>`${i}: ${(l*100).toFixed(0)}%`,children:[e.jsx(Ze,{fill:"#22c55e"}),e.jsx(Ze,{fill:"#f59e0b"})]}),e.jsx(ge,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:s,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(It,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(It,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:s.map((i,l)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)})]},l))})]})})]})]})}function gg({investition:t,monatsdaten:r,zusammenfassung:a}){const s=r.map(i=>({name:`${hl[i.monat]} ${i.jahr.toString().slice(2)}`,verbrauch:i.verbrauch_daten.verbrauch_kwh||0,bezug_pv:i.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:i.verbrauch_daten.bezug_netz_kwh||0})),n=[{name:"PV-Strom",value:a.bezug_pv_kwh||0},{name:"Netzstrom",value:a.bezug_netz_kwh||0}];return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:gl[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ne,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Verbrauch",value:(a.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:Ne,color:"blue",formel:" Verbrauch alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(Le,{title:"PV-Anteil",value:(a.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:dt,color:"green",formel:"PV-Anteil = PV-Bezug  Verbrauch  100",berechnung:`${(a.bezug_pv_kwh||0).toFixed(0)}  ${(a.gesamt_verbrauch_kwh||0).toFixed(0)}  100`,ergebnis:`= ${(a.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(Le,{title:"Netzkosten",value:(a.kosten_netz_euro||0).toFixed(0),unit:"",icon:Fe,color:"red",formel:"Netzkosten = Netzbezug  Strompreis",berechnung:`${(a.bezug_netz_kwh||0).toFixed(0)} kWh  Strompreis`,ergebnis:`= ${(a.kosten_netz_euro||0).toFixed(2)} `}),e.jsx(Le,{title:"PV-Ersparnis",value:(a.ersparnis_pv_euro||0).toFixed(0),unit:"",icon:kt,color:"green",trend:(a.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug  Strompreis",berechnung:`${(a.bezug_pv_kwh||0).toFixed(0)} kWh  Strompreis`,ergebnis:`= ${(a.ersparnis_pv_euro||0).toFixed(2)} `})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(ct,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," "]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsxs(Qt,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:l})=>`${i}: ${(l*100).toFixed(0)}%`,children:[e.jsx(Ze,{fill:"#22c55e"}),e.jsx(Ze,{fill:"#ef4444"})]}),e.jsx(ge,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:s,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(oe,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(oe,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:s.map((i,l)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:i.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:i.bezug_netz.toFixed(1)})]},l))})]})})]})]})}function xg({investition:t,monatsdaten:r,zusammenfassung:a}){const s=r.map(n=>({name:`${hl[n.monat]} ${n.jahr.toString().slice(2)}`,ladung:n.verbrauch_daten.ladung_kwh||0,entladung:n.verbrauch_daten.entladung_kwh||0}));return e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:gl[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ce,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Le,{title:"Ladung",value:(a.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:Ce,color:"purple",formel:" Ladung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(Le,{title:"Entladung",value:(a.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:Ne,color:"green",formel:" Entladung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(Le,{title:"Effizienz",value:(a.effizienz_prozent||0).toFixed(1),unit:"%",icon:Fe,color:"blue",formel:"Effizienz = Entladung  Ladung  100",berechnung:`${(a.gesamt_entladung_kwh||0).toFixed(0)}  ${(a.gesamt_ladung_kwh||0).toFixed(0)}  100`,ergebnis:`= ${(a.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(Le,{title:"Ersparnis",value:(a.ersparnis_euro||0).toFixed(0),unit:"",icon:Fe,color:"green",trend:(a.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung  Strompreis",berechnung:`${(a.gesamt_entladung_kwh||0).toFixed(0)} kWh  Strompreis`,ergebnis:`= ${(a.ersparnis_euro||0).toFixed(2)} `})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(ct,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," "]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:s,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{}),e.jsx(ge,{}),e.jsx(De,{}),e.jsx(oe,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(oe,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:s.map((n,i)=>{const l=n.ladung>0?n.entladung/n.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:n.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:n.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:n.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[l.toFixed(1),"%"]})]},i)})})]})})]})]})}function ug(t,r){const a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function ms(t,r,a){const s=t.join(";"),n=r.map(c=>c.map(h=>h==null||h===""?"":typeof h=="number"?h.toString().replace(".",","):typeof h=="string"&&(h.includes(";")||h.includes('"'))?`"${h.replace(/"/g,'""')}"`:String(h)).join(";")),i=[s,...n].join(`
`),l=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8"});ug(l,a)}function ze({title:t,value:r,unit:a,subtitle:s,icon:n,color:i,bgColor:l,formel:c,berechnung:h,ergebnis:g}){const o=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal",children:a})]});return e.jsx(P,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:c?e.jsx(zr,{formel:c,berechnung:h,ergebnis:g,children:o}):o}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl ${l}`,children:e.jsx(n,{className:`h-6 w-6 ${i}`})})]})})}const tc=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],tr={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},Ct={erzeugung:"#f59e0b",eigenverbrauch:"#8b5cf6",einspeisung:"#10b981",netzbezug:"#ef4444",autarkie:"#3b82f6",evQuote:"#a855f7",spezErtrag:"#eab308",speicherLadung:"#22c55e",speicherEntladung:"#3b82f6",speicherEffizienz:"#06b6d4",wpWaerme:"#ef4444",wpStrom:"#8b5cf6",wpCop:"#f97316",emobPvAnteil:"#10b981"},Hr={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},Aa={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"Wrmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function xl(t,r,a){return[...t].sort((n,i)=>n.jahr!==i.jahr?n.jahr-i.jahr:n.monat-i.monat).map(n=>{const i=n.pv_erzeugung_kwh||0,l=n.eigenverbrauch_kwh||0,c=n.gesamtverbrauch_kwh||l+n.netzbezug_kwh,h=n.direktverbrauch_kwh||0,g=n.autarkie_prozent??(c>0?l/c*100:0),o=n.eigenverbrauchsquote_prozent??(i>0?l/i*100:0),x=r!=null&&r.leistung_kwp?i/r.leistung_kwp:0,u=n.speicher_ladung_kwh||0,d=n.speicher_entladung_kwh||0,p=u>0?d/u*100:null,b=(n.wp_heizung_kwh||0)+(n.wp_warmwasser_kwh||0),j=n.wp_strom_kwh||0,f=j>0?b/j:null,y=n.eauto_km||0,k=n.eauto_ladung_kwh||0,_=null,w=a?n.einspeisung_kwh*a.einspeiseverguetung_cent_kwh/100:0,v=a?l*a.netzbezug_arbeitspreis_cent_kwh/100:0,E=a?n.netzbezug_kwh*a.netzbezug_arbeitspreis_cent_kwh/100+(a.grundpreis_euro_monat||0):0,F=w+v,D=i*.38;return{name:`${tc[n.monat]} ${n.jahr.toString().slice(-2)}`,jahr:n.jahr,monat:n.monat,erzeugung:i,eigenverbrauch:l,einspeisung:n.einspeisung_kwh,netzbezug:n.netzbezug_kwh,gesamtverbrauch:c,direktverbrauch:h,autarkie:g,evQuote:o,spezErtrag:x,speicher_ladung:u,speicher_entladung:d,speicher_effizienz:p,wp_waerme:b,wp_strom:j,wp_cop:f,eauto_km:y,eauto_ladung:k,eauto_pv_anteil:_,einspeise_erloes:w,ev_ersparnis:v,netzbezug_kosten:E,netto_ertrag:F,co2_einsparung:D}})}function mg({data:t,stats:r,anlage:a,strompreis:s,zeitraumLabel:n}){const i=m.useMemo(()=>xl(t,a,s),[t,a,s]),l=()=>{const h=["Monat","Erzeugung (kWh)","Eigenverbrauch (kWh)","Einspeisung (kWh)","Netzbezug (kWh)","Autarkie (%)","EV-Quote (%)","Spez. Ertrag (kWh/kWp)"],g=i.map(o=>[o.name,o.erzeugung,o.eigenverbrauch,o.einspeisung,o.netzbezug,o.autarkie,o.evQuote,o.spezErtrag]);ms(h,g,`energie_${(a==null?void 0:a.anlagenname)||"export"}.csv`)},c=m.useMemo(()=>{if(!s)return null;const h=r.gesamtEinspeisung*s.einspeiseverguetung_cent_kwh/100,g=r.gesamtEigenverbrauch*s.netzbezug_arbeitspreis_cent_kwh/100;return h+g},[r,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ",""," ",r.anzahlMonate," Monate"]}),e.jsxs(se,{variant:"secondary",size:"sm",onClick:l,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"PV-Erzeugung",value:(r.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:ce,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:" PV-Erzeugung aller Monate",berechnung:`${L(r.gesamtErzeugung,0)} kWh`,ergebnis:`= ${L(r.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(ze,{title:"Eigenverbrauch",value:r.gesamtErzeugung>0?(r.gesamtEigenverbrauch/r.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(r.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:Ne,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch  PV-Erzeugung  100",berechnung:`${L(r.gesamtEigenverbrauch,0)} kWh  ${L(r.gesamtErzeugung,0)} kWh  100`,ergebnis:`= ${L(r.gesamtEigenverbrauch/r.gesamtErzeugung*100,1)} %`}),e.jsx(ze,{title:"Autarkie",value:r.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:Fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch  Gesamtverbrauch  100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${L(r.durchschnittAutarkie,1)} %`}),e.jsx(ze,{title:"Spez. Ertrag",value:a!=null&&a.leistung_kwp?(r.gesamtErzeugung/a.leistung_kwp).toFixed(0):"---",unit:"kWh/kWp",subtitle:a!=null&&a.leistung_kwp?`${a.leistung_kwp} kWp`:void 0,icon:ce,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"PV-Erzeugung  Anlagenleistung",berechnung:a!=null&&a.leistung_kwp?`${L(r.gesamtErzeugung,0)} kWh  ${a.leistung_kwp} kWp`:void 0,ergebnis:a!=null&&a.leistung_kwp?`= ${L(r.gesamtErzeugung/a.leistung_kwp,0)} kWh/kWp`:void 0})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-500"}),"Energie-Bilanz pro Monat"]}),e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{tickFormatter:h=>`${h.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{formatter:(h,g)=>[`${h.toFixed(0)} kWh`,g],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),e.jsx(oe,{dataKey:"eigenverbrauch",name:"Eigenverbrauch",fill:Ct.eigenverbrauch,stackId:"pv"}),e.jsx(oe,{dataKey:"einspeisung",name:"Einspeisung",fill:Ct.einspeisung,stackId:"pv"}),e.jsx(oe,{dataKey:"netzbezug",name:"Netzbezug",fill:Ct.netzbezug})]})})})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-green-500"}),"Effizienz-Trends"]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",tickFormatter:h=>`${h.toFixed(0)}`,unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(ge,{formatter:(h,g)=>g.includes("kWh/kWp")?[`${h.toFixed(0)} kWh/kWp`,g]:[`${h.toFixed(1)}%`,g],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),e.jsx(qe,{yAxisId:"left",type:"monotone",dataKey:"autarkie",name:"Autarkie (%)",stroke:Ct.autarkie,strokeWidth:2,dot:!1}),e.jsx(qe,{yAxisId:"left",type:"monotone",dataKey:"evQuote",name:"EV-Quote (%)",stroke:Ct.evQuote,strokeWidth:2,dot:!1}),e.jsx(oe,{yAxisId:"right",dataKey:"spezErtrag",name:"Spez. Ertrag (kWh/kWp)",fill:Ct.spezErtrag,opacity:.7})]})})})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-yellow-500"}),"PV-Erzeugung Verlauf"]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{formatter:h=>[`${h.toFixed(0)} kWh`,"Erzeugung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(qe,{type:"monotone",dataKey:"erzeugung",name:"PV-Erzeugung",stroke:Ct.erzeugung,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[r.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(a==null?void 0:a.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Netto-Ertrag"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:c?`${c.toFixed(0)} `:"---"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(r.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function pg({anlage:t,strompreis:r,selectedYear:a,zeitraumLabel:s}){var y,k,_;const[n,i]=m.useState(null),[l,c]=m.useState(!0),[h,g]=m.useState(null);m.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{c(!0),g(null);try{const v=a&&a!=="all"?a:void 0,E=await pr.getKomponentenZeitreihe(t.id,v);i(E)}catch(v){g("Fehler beim Laden der Komponentendaten"),console.error(v)}finally{c(!1)}})()},[t==null?void 0:t.id,a]);const o=m.useMemo(()=>n!=null&&n.monatswerte?n.monatswerte.map(w=>({...w,name:`${tc[w.monat]} ${w.jahr.toString().slice(-2)}`})):[],[n]),x=m.useMemo(()=>{if(!o.length)return{ladung:0,entladung:0,effizienz:null,arbitrage:0};const w=o.reduce((F,C)=>F+C.speicher_ladung_kwh,0),v=o.reduce((F,C)=>F+C.speicher_entladung_kwh,0),E=o.reduce((F,C)=>F+C.speicher_arbitrage_kwh,0);return{ladung:w,entladung:v,effizienz:w>0?v/w*100:null,arbitrage:E}},[o]),u=m.useMemo(()=>{if(!o.length)return{waerme:0,strom:0,cop:null,heizung:0,warmwasser:0};const w=o.reduce((C,D)=>C+D.wp_waerme_kwh,0),v=o.reduce((C,D)=>C+D.wp_strom_kwh,0),E=o.reduce((C,D)=>C+D.wp_heizung_kwh,0),F=o.reduce((C,D)=>C+D.wp_warmwasser_kwh,0);return{waerme:w,strom:v,cop:v>0?w/v:null,heizung:E,warmwasser:F}},[o]),d=m.useMemo(()=>{if(!o.length)return{km:0,ladung:0,pvAnteil:null,pvLadung:0,netzLadung:0,externLadung:0,externEuro:0,v2h:0};const w=o.reduce((W,N)=>W+N.emob_km,0),v=o.reduce((W,N)=>W+N.emob_ladung_kwh,0),E=o.reduce((W,N)=>W+N.emob_ladung_pv_kwh,0),F=o.reduce((W,N)=>W+N.emob_ladung_netz_kwh,0),C=o.reduce((W,N)=>W+N.emob_ladung_extern_kwh,0),D=o.reduce((W,N)=>W+N.emob_ladung_extern_euro,0),A=o.reduce((W,N)=>W+N.emob_v2h_kwh,0),S=v>0?E/v*100:null;return{km:w,ladung:v,pvAnteil:S,pvLadung:E,netzLadung:F,externLadung:C,externEuro:D,v2h:A}},[o]),p=m.useMemo(()=>o.length?{erzeugung:o.reduce((w,v)=>w+v.bkw_erzeugung_kwh,0),eigenverbrauch:o.reduce((w,v)=>w+v.bkw_eigenverbrauch_kwh,0),speicherLadung:o.reduce((w,v)=>w+v.bkw_speicher_ladung_kwh,0),speicherEntladung:o.reduce((w,v)=>w+v.bkw_speicher_entladung_kwh,0)}:{erzeugung:0,eigenverbrauch:0,speicherLadung:0,speicherEntladung:0},[o]),b=m.useMemo(()=>o.length?{erzeugung:o.reduce((w,v)=>w+v.sonstiges_erzeugung_kwh,0),verbrauch:o.reduce((w,v)=>w+v.sonstiges_verbrauch_kwh,0)}:{erzeugung:0,verbrauch:0},[o]);m.useMemo(()=>o.length?o.reduce((w,v)=>w+v.sonderkosten_euro,0):0,[o]);const j=()=>{if(!o.length)return;const w=["Monat"];n!=null&&n.hat_speicher&&w.push("Speicher Ladung (kWh)","Speicher Entladung (kWh)","Speicher Effizienz (%)"),n!=null&&n.hat_waermepumpe&&w.push("WP Wrme (kWh)","WP Strom (kWh)","WP COP"),n!=null&&n.hat_emobilitaet&&w.push("E-Auto km","E-Auto Ladung (kWh)","E-Auto PV-Anteil (%)"),n!=null&&n.hat_balkonkraftwerk&&w.push("BKW Erzeugung (kWh)","BKW Eigenverbrauch (kWh)"),n!=null&&n.hat_sonstiges&&w.push("Sonstiges Erzeugung (kWh)","Sonstiges Verbrauch (kWh)");const v=o.map(E=>{const F=[E.name];return n!=null&&n.hat_speicher&&F.push(E.speicher_ladung_kwh,E.speicher_entladung_kwh,E.speicher_effizienz_prozent??""),n!=null&&n.hat_waermepumpe&&F.push(E.wp_waerme_kwh,E.wp_strom_kwh,E.wp_cop??""),n!=null&&n.hat_emobilitaet&&F.push(E.emob_km,E.emob_ladung_kwh,E.emob_pv_anteil_prozent??""),n!=null&&n.hat_balkonkraftwerk&&F.push(E.bkw_erzeugung_kwh,E.bkw_eigenverbrauch_kwh),n!=null&&n.hat_sonstiges&&F.push(E.sonstiges_erzeugung_kwh,E.sonstiges_verbrauch_kwh),F});ms(w,v,`komponenten_${(t==null?void 0:t.anlagenname)||"export"}.csv`)};return l?e.jsxs(P,{className:"text-center py-12",children:[e.jsx(sr,{className:"h-12 w-12 mx-auto text-gray-400 mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Komponentendaten..."})]}):h?e.jsxs(P,{className:"text-center py-12",children:[e.jsx(ct,{className:"h-12 w-12 mx-auto text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:h})]}):n&&(n.hat_speicher||n.hat_waermepumpe||n.hat_emobilitaet||n.hat_balkonkraftwerk||n.hat_sonstiges)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s})," ",""," ",(n==null?void 0:n.anzahl_monate)||0," Monate"]}),e.jsxs(se,{variant:"secondary",size:"sm",onClick:j,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),(n==null?void 0:n.hat_speicher)&&x.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ce,{className:"h-6 w-6 text-green-500"}),"Speicher",n.hat_arbitrage&&e.jsx("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded",children:"Arbitrage"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Ladung gesamt",value:(x.ladung/1e3).toFixed(2),unit:"MWh",icon:Ce,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:" Speicher-Ladung aller Monate",berechnung:`${L(x.ladung,0)} kWh`,ergebnis:`= ${L(x.ladung/1e3,2)} MWh`}),e.jsx(ze,{title:"Entladung gesamt",value:(x.entladung/1e3).toFixed(2),unit:"MWh",icon:Ce,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" Speicher-Entladung aller Monate",berechnung:`${L(x.entladung,0)} kWh`,ergebnis:`= ${L(x.entladung/1e3,2)} MWh`}),e.jsx(ze,{title:" Effizienz",value:((y=x.effizienz)==null?void 0:y.toFixed(1))||"---",unit:"%",icon:Ce,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung  Ladung  100",berechnung:`${L(x.entladung,0)} kWh  ${L(x.ladung,0)} kWh  100`,ergebnis:x.effizienz?`= ${L(x.effizienz,1)}%`:"---"}),n.hat_arbitrage&&x.arbitrage>0?e.jsx(ze,{title:"Arbitrage",value:x.arbitrage.toFixed(0),unit:"kWh",subtitle:"Netzladung",icon:Ce,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:" Netzladung fr Arbitrage"}):e.jsx(ze,{title:"Verlust",value:(x.ladung-x.entladung).toFixed(0),unit:"kWh",subtitle:x.effizienz?`${(100-x.effizienz).toFixed(1)}%`:void 0,icon:Ce,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Speicher pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:o.filter(w=>w.speicher_ladung_kwh>0||w.speicher_entladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",tickFormatter:w=>`${w.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ge,{formatter:(w,v)=>v.includes("Effizienz")?[`${(w==null?void 0:w.toFixed(1))||"---"}%`,v]:[`${w.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),e.jsx(oe,{yAxisId:"left",dataKey:"speicher_ladung_kwh",name:"Ladung",fill:Ct.speicherLadung}),e.jsx(oe,{yAxisId:"left",dataKey:"speicher_entladung_kwh",name:"Entladung",fill:Ct.speicherEntladung}),n.hat_arbitrage&&e.jsx(oe,{yAxisId:"left",dataKey:"speicher_arbitrage_kwh",name:"Arbitrage (Netz)",fill:"#8b5cf6"}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"speicher_effizienz_prozent",name:"Effizienz (%)",stroke:Ct.speicherEffizienz,strokeWidth:2,dot:!1})]})})})]})]}),(n==null?void 0:n.hat_waermepumpe)&&u.strom>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(et,{className:"h-6 w-6 text-red-500"}),"Wrmepumpe"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Wrme erzeugt",value:(u.waerme/1e3).toFixed(2),unit:"MWh",icon:et,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:" Wrme aller Monate",berechnung:`${L(u.waerme,0)} kWh`,ergebnis:`= ${L(u.waerme/1e3,2)} MWh`}),e.jsx(ze,{title:"Strom verbraucht",value:(u.strom/1e3).toFixed(2),unit:"MWh",icon:et,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:" WP-Strom aller Monate",berechnung:`${L(u.strom,0)} kWh`,ergebnis:`= ${L(u.strom/1e3,2)} MWh`}),e.jsx(ze,{title:" COP",value:((k=u.cop)==null?void 0:k.toFixed(2))||"---",unit:"",subtitle:"Jahresarbeitszahl",icon:et,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wrme  Strom",berechnung:`${L(u.waerme,0)} kWh  ${L(u.strom,0)} kWh`,ergebnis:u.cop?`= ${L(u.cop,2)} COP`:"---"}),e.jsx(ze,{title:"Ersparnis vs. Gas",value:r?(u.waerme*.08-u.strom*r.netzbezug_arbeitspreis_cent_kwh/100).toFixed(0):"---",unit:"",subtitle:"ca. 8 ct/kWh Gas",icon:et,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]}),(u.heizung>0||u.warmwasser>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Heizung",value:(u.heizung/1e3).toFixed(2),unit:"MWh",subtitle:u.waerme>0?`${(u.heizung/u.waerme*100).toFixed(0)}% der Wrme`:void 0,icon:et,color:"text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",formel:" Heizenergie aller Monate"}),e.jsx(ze,{title:"Warmwasser",value:(u.warmwasser/1e3).toFixed(2),unit:"MWh",subtitle:u.waerme>0?`${(u.warmwasser/u.waerme*100).toFixed(0)}% der Wrme`:void 0,icon:et,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" Warmwasser-Energie aller Monate"})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Wrmepumpe pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:o.filter(w=>w.wp_waerme_kwh>0||w.wp_strom_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",tickFormatter:w=>`${w.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",domain:[0,"auto"],tick:{fontSize:11}}),e.jsx(ge,{formatter:(w,v)=>v==="COP"?[`${(w==null?void 0:w.toFixed(2))||"---"}`,v]:[`${w.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),u.heizung>0||u.warmwasser>0?e.jsxs(e.Fragment,{children:[e.jsx(oe,{yAxisId:"left",dataKey:"wp_heizung_kwh",name:"Heizung",stackId:"waerme",fill:"#f87171"}),e.jsx(oe,{yAxisId:"left",dataKey:"wp_warmwasser_kwh",name:"Warmwasser",stackId:"waerme",fill:"#60a5fa"})]}):e.jsx(oe,{yAxisId:"left",dataKey:"wp_waerme_kwh",name:"Wrme",fill:Ct.wpWaerme}),e.jsx(oe,{yAxisId:"left",dataKey:"wp_strom_kwh",name:"Strom",fill:Ct.wpStrom}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"wp_cop",name:"COP",stroke:Ct.wpCop,strokeWidth:2,dot:!1})]})})})]})]}),(n==null?void 0:n.hat_emobilitaet)&&d.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Te,{className:"h-6 w-6 text-purple-500"}),"E-Mobilitt",n.hat_v2h&&e.jsx("span",{className:"text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 px-2 py-0.5 rounded",children:"V2H"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Gefahrene km",value:(d.km/1e3).toFixed(1),unit:"Tkm",icon:Te,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:" gefahrene km aller Monate",berechnung:`${L(d.km,0)} km`,ergebnis:`= ${L(d.km/1e3,1)} Tausend km`}),e.jsx(ze,{title:"Ladung gesamt",value:(d.ladung/1e3).toFixed(2),unit:"MWh",icon:Te,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" E-Auto-Ladung aller Monate",berechnung:`${L(d.ladung,0)} kWh`,ergebnis:`= ${L(d.ladung/1e3,2)} MWh`}),e.jsx(ze,{title:" PV-Anteil",value:((_=d.pvAnteil)==null?void 0:_.toFixed(0))||"---",unit:"%",icon:Te,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Ladung  Gesamtladung  100",berechnung:`${L(d.pvLadung,0)} kWh  ${L(d.ladung,0)} kWh  100`,ergebnis:d.pvAnteil?`= ${L(d.pvAnteil,0)}%`:"---"}),e.jsx(ze,{title:"Verbrauch",value:d.km>0?(d.ladung/d.km*100).toFixed(1):"---",unit:"kWh/100km",icon:Te,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Ladung  km  100",berechnung:`${L(d.ladung,0)} kWh  ${L(d.km,0)} km  100`,ergebnis:d.km>0?`= ${L(d.ladung/d.km*100,1)} kWh/100km`:"---"})]}),(d.pvLadung>0||d.netzLadung>0||d.externLadung>0||d.v2h>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"PV-Ladung",value:d.pvLadung.toFixed(0),unit:"kWh",subtitle:d.ladung>0?`${(d.pvLadung/d.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:ce,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:" Ladung aus eigener PV"}),e.jsx(ze,{title:"Netz-Ladung",value:d.netzLadung.toFixed(0),unit:"kWh",subtitle:d.ladung>0?`${(d.netzLadung/d.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:Ne,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:" Ladung aus Netzstrom"}),d.externLadung>0&&e.jsx(ze,{title:"Extern geladen",value:d.externLadung.toFixed(0),unit:"kWh",subtitle:d.externEuro>0?`${L(d.externEuro,2)} `:void 0,icon:Te,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:" Ladung an ffentlichen Sulen"}),n.hat_v2h&&d.v2h>0&&e.jsx(ze,{title:"V2H Entladung",value:d.v2h.toFixed(0),unit:"kWh",subtitle:r?` ${L(d.v2h*r.netzbezug_arbeitspreis_cent_kwh/100,0)}  Ersparnis`:void 0,icon:Ce,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:" Rckspeisung ins Haus (Vehicle-to-Home)"})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"E-Mobilitt pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:o.filter(w=>w.emob_km>0||w.emob_ladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{yAxisId:"left",tick:{fontSize:11}}),e.jsx(be,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ge,{formatter:(w,v)=>v.includes("PV-Anteil")?[`${(w==null?void 0:w.toFixed(0))||"---"}%`,v]:v.includes("km")?[`${w.toFixed(0)} km`,v]:v.includes("")?[`${w.toFixed(2)} `,v]:[`${w.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),e.jsx(oe,{yAxisId:"left",dataKey:"emob_ladung_pv_kwh",name:"PV-Ladung",stackId:"ladung",fill:"#f59e0b"}),e.jsx(oe,{yAxisId:"left",dataKey:"emob_ladung_netz_kwh",name:"Netz-Ladung",stackId:"ladung",fill:"#ef4444"}),d.externLadung>0&&e.jsx(oe,{yAxisId:"left",dataKey:"emob_ladung_extern_kwh",name:"Extern",stackId:"ladung",fill:"#f97316"}),n.hat_v2h&&e.jsx(oe,{yAxisId:"left",dataKey:"emob_v2h_kwh",name:"V2H",fill:"#06b6d4"}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"emob_pv_anteil_prozent",name:"PV-Anteil (%)",stroke:Ct.emobPvAnteil,strokeWidth:2,dot:!1})]})})})]})]}),(n==null?void 0:n.hat_balkonkraftwerk)&&p.erzeugung>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ce,{className:"h-6 w-6 text-yellow-500"}),"Balkonkraftwerk",p.speicherLadung>0&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded",children:"mit Speicher"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Die BKW-Erzeugung ist in der PV-Gesamterzeugung enthalten, wird hier aber separat ausgewiesen."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Erzeugung gesamt",value:p.erzeugung.toFixed(0),unit:"kWh",icon:ce,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:" BKW-Erzeugung aller Monate",berechnung:`${L(p.erzeugung,0)} kWh`,ergebnis:`= ${L(p.erzeugung,0)} kWh`}),e.jsx(ze,{title:"Eigenverbrauch",value:p.eigenverbrauch.toFixed(0),unit:"kWh",icon:ce,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:" BKW-Eigenverbrauch aller Monate",berechnung:`${L(p.eigenverbrauch,0)} kWh`,ergebnis:`= ${L(p.eigenverbrauch,0)} kWh`}),e.jsx(ze,{title:"EV-Quote",value:p.erzeugung>0?(p.eigenverbrauch/p.erzeugung*100).toFixed(0):"---",unit:"%",icon:ce,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch  Erzeugung  100",berechnung:`${L(p.eigenverbrauch,0)} kWh  ${L(p.erzeugung,0)} kWh  100`,ergebnis:p.erzeugung>0?`= ${L(p.eigenverbrauch/p.erzeugung*100,0)}%`:"---"}),e.jsx(ze,{title:"Einspeisung",value:(p.erzeugung-p.eigenverbrauch).toFixed(0),unit:"kWh",subtitle:"geschtzt",icon:ce,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"})]}),p.speicherLadung>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Speicher Ladung",value:p.speicherLadung.toFixed(0),unit:"kWh",icon:Ce,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:" BKW-Speicher Ladung"}),e.jsx(ze,{title:"Speicher Entladung",value:p.speicherEntladung.toFixed(0),unit:"kWh",icon:Ce,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" BKW-Speicher Entladung"}),e.jsx(ze,{title:"Speicher Effizienz",value:p.speicherLadung>0?(p.speicherEntladung/p.speicherLadung*100).toFixed(0):"---",unit:"%",icon:Ce,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung  Ladung  100"})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Balkonkraftwerk pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:o.filter(w=>w.bkw_erzeugung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{formatter:(w,v)=>[`${w.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),e.jsx(oe,{dataKey:"bkw_erzeugung_kwh",name:"Erzeugung",fill:"#f59e0b"}),e.jsx(oe,{dataKey:"bkw_eigenverbrauch_kwh",name:"Eigenverbrauch",fill:"#10b981"}),p.speicherLadung>0&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{dataKey:"bkw_speicher_ladung_kwh",name:"Speicher Ladung",fill:"#22c55e"}),e.jsx(oe,{dataKey:"bkw_speicher_entladung_kwh",name:"Speicher Entladung",fill:"#3b82f6"})]})]})})})]})]}),(n==null?void 0:n.hat_sonstiges)&&(b.erzeugung>0||b.verbrauch>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"h-6 w-6 text-gray-500"}),"Sonstige Komponenten"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:'Aggregiert alle Investitionen vom Typ "Sonstiges" (z.B. Mini-BHKW, Pool-Pumpe).'})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[b.erzeugung>0&&e.jsx(ze,{title:"Erzeugung gesamt",value:b.erzeugung.toFixed(0),unit:"kWh",icon:Ne,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"}),b.verbrauch>0&&e.jsx(ze,{title:"Verbrauch gesamt",value:b.verbrauch.toFixed(0),unit:"kWh",icon:Ne,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20"}),b.erzeugung>0&&b.verbrauch>0&&e.jsx(ze,{title:"Netto",value:(b.erzeugung-b.verbrauch).toFixed(0),unit:"kWh",icon:Ne,color:b.erzeugung-b.verbrauch>=0?"text-green-500":"text-red-500",bgColor:b.erzeugung-b.verbrauch>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Sonstige Komponenten pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:o.filter(w=>w.sonstiges_erzeugung_kwh>0||w.sonstiges_verbrauch_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{formatter:(w,v)=>[`${w.toFixed(0)} kWh`,v],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),b.erzeugung>0&&e.jsx(oe,{dataKey:"sonstiges_erzeugung_kwh",name:"Erzeugung",fill:"#10b981"}),b.verbrauch>0&&e.jsx(oe,{dataKey:"sonstiges_verbrauch_kwh",name:"Verbrauch",fill:"#ef4444"})]})})})]})]}),n&&(n.hat_waermepumpe&&u.strom===0||n.hat_emobilitaet&&d.ladung===0||n.hat_balkonkraftwerk&&p.erzeugung===0||n.hat_sonstiges&&b.erzeugung===0&&b.verbrauch===0)&&e.jsx(P,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ct,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Komponenten ohne Monatsdaten"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Einige Investitionen sind angelegt, haben aber noch keine Monatsdaten. Erfasse monatliche Verbrauchsdaten unter ",e.jsx("strong",{children:"Einstellungen  Investitionen"}),"."]})]})]})})]}):e.jsxs(P,{className:"text-center py-12",children:[e.jsx(ct,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Komponentendaten vorhanden"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:["Erfasse Daten fr Speicher, Wrmepumpe, E-Auto, Balkonkraftwerk oder Sonstiges unter ",e.jsx("strong",{children:"Einstellungen  Investitionen"})," und fge Monatsdaten hinzu."]})]})}function bg({data:t,stats:r,strompreis:a,anlageId:s,zeitraumLabel:n}){const[i,l]=m.useState(null);if(m.useEffect(()=>{s&&pr.getKomponentenZeitreihe(s).then(l).catch(console.error)},[s]),!a)return e.jsxs(P,{className:"text-center py-8",children:[e.jsx(dr,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const c=m.useMemo(()=>xl(t,void 0,a),[t,a]),h=m.useMemo(()=>{var d;const u=new Map;return(d=i==null?void 0:i.monatswerte)==null||d.forEach(p=>{const b=`${p.jahr}-${p.monat}`;u.set(b,{ertraege:p.sonstige_ertraege_euro||0,ausgaben:p.sonstige_ausgaben_euro||0,netto:p.sonstige_netto_euro||0})}),u},[i]),g=m.useMemo(()=>{let u=0;return c.map(d=>{const p=h.get(`${d.jahr}-${d.monat}`),b=(p==null?void 0:p.ausgaben)||0,j=d.netto_ertrag+((p==null?void 0:p.netto)||0);return u+=j,{...d,sonderkosten:b,netto_nach_sonderkosten:j,kumuliert_ertrag:u}})},[c,h]),o=m.useMemo(()=>{const u=r.gesamtEinspeisung*a.einspeiseverguetung_cent_kwh/100,d=r.gesamtNetzbezug*a.netzbezug_arbeitspreis_cent_kwh/100,p=r.gesamtEigenverbrauch*a.netzbezug_arbeitspreis_cent_kwh/100,b=g.reduce((y,k)=>y+(k.sonderkosten||0),0),j=u+p,f=j-b;return{einspeiseErloes:u,netzbezugKosten:d,eigenverbrauchErsparnis:p,nettoErtrag:j,sonderkosten:b,nettoNachSonderkosten:f}},[r,a,g]),x=()=>{const u=["Monat","Einspeiseerls ()","EV-Ersparnis ()","Netzbezug-Kosten ()","Netto-Ertrag ()","Sonderkosten ()","Netto nach Sonderkosten ()","Kumulierter Ertrag ()"],d=g.map(p=>[p.name,p.einspeise_erloes,p.ev_ersparnis,p.netzbezug_kosten,p.netto_ertrag,p.sonderkosten,p.netto_nach_sonderkosten,p.kumuliert_ertrag]);ms(u,d,"finanzen_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ",""," ",r.anzahlMonate," Monate"]}),e.jsxs(se,{variant:"secondary",size:"sm",onClick:x,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Einspeiseerls",value:o.einspeiseErloes.toFixed(0),unit:"",subtitle:`${a.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:Fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung  Einspeisevergtung",berechnung:`${L(r.gesamtEinspeisung,0)} kWh  ${L(a.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${L(o.einspeiseErloes,2)} `}),e.jsx(ze,{title:"EV-Ersparnis",value:o.eigenverbrauchErsparnis.toFixed(0),unit:"",subtitle:"vermiedener Netzbezug",icon:dr,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch  Netzbezugspreis",berechnung:`${L(r.gesamtEigenverbrauch,0)} kWh  ${L(a.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${L(o.eigenverbrauchErsparnis,2)} `}),e.jsx(ze,{title:"Netzbezug-Kosten",value:o.netzbezugKosten.toFixed(0),unit:"",subtitle:`${a.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:dr,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug  Netzbezugspreis",berechnung:`${L(r.gesamtNetzbezug,0)} kWh  ${L(a.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${L(o.netzbezugKosten,2)} `}),e.jsx(ze,{title:"Netto-Ertrag",value:o.nettoNachSonderkosten.toFixed(0),unit:"",subtitle:o.sonderkosten>0?`nach ${o.sonderkosten.toFixed(0)}  Sonderkosten`:"Gesamt",icon:dr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:o.sonderkosten>0?"Einspeiseerls + EV-Ersparnis  Sonderkosten":"Einspeiseerls + EV-Ersparnis",berechnung:o.sonderkosten>0?`${L(o.einspeiseErloes,2)}  + ${L(o.eigenverbrauchErsparnis,2)}   ${L(o.sonderkosten,2)} `:`${L(o.einspeiseErloes,2)}  + ${L(o.eigenverbrauchErsparnis,2)} `,ergebnis:`= ${L(o.nettoNachSonderkosten,2)} `})]}),o.sonderkosten>0&&e.jsx(P,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(as,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:["Sonderkosten im Zeitraum: ",o.sonderkosten.toFixed(2)," "]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Reparaturen, Wartung und sonstige Kosten werden vom Netto-Ertrag abgezogen."})]})]})}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(dr,{className:"h-5 w-5 text-green-500"}),"Finanzielle Bilanz pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:g,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" ",tick:{fontSize:11}}),e.jsx(ge,{formatter:(u,d)=>[`${u.toFixed(2)} `,d],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(De,{}),e.jsx(oe,{dataKey:"einspeise_erloes",name:"Einspeiseerls",fill:tr.feedin,stackId:"pos"}),e.jsx(oe,{dataKey:"ev_ersparnis",name:"EV-Ersparnis",fill:tr.consumption,stackId:"pos"}),e.jsx(oe,{dataKey:"netzbezug_kosten",name:"Netzbezug (negativ)",fill:tr.grid}),o.sonderkosten>0&&e.jsx(oe,{dataKey:"sonderkosten",name:"Sonderkosten",fill:"#f59e0b"})]})})})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-blue-500"}),"Kumulierter Netto-Ertrag"]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:g,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" ",tick:{fontSize:11}}),e.jsx(ge,{formatter:u=>[`${u.toFixed(0)} `,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(It,{type:"monotone",dataKey:"kumuliert_ertrag",name:"Kumulierter Ertrag",stroke:tr.feedin,fill:tr.feedin,fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[o.nettoNachSonderkosten.toFixed(0)," "]}),o.sonderkosten>0&&e.jsxs("span",{className:"text-gray-400 text-xs",children:["(nach ",o.sonderkosten.toFixed(0),"  Sonderkosten)"]})]})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Netto-Ertrag pro Monat ",o.sonderkosten>0&&"(nach Sonderkosten)"]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:g,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" ",tick:{fontSize:11}}),e.jsx(ge,{formatter:(u,d)=>[`${u.toFixed(2)} `,d],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(oe,{dataKey:"netto_nach_sonderkosten",name:"Netto-Ertrag",fill:tr.feedin,opacity:.7}),e.jsx(qe,{type:"monotone",dataKey:"netto_nach_sonderkosten",name:"Trend",stroke:tr.solar,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Durchschnittswerte"}),e.jsxs("div",{className:`grid grid-cols-2 gap-4 text-sm ${o.sonderkosten>0?"md:grid-cols-5":"md:grid-cols-4"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:" Einspeiseerls/Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(o.einspeiseErloes/r.anzahlMonate).toFixed(0)," "]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:" EV-Ersparnis/Monat"}),e.jsxs("p",{className:"font-medium text-purple-600",children:[(o.eigenverbrauchErsparnis/r.anzahlMonate).toFixed(0)," "]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:" Netzbezug-Kosten/Monat"}),e.jsxs("p",{className:"font-medium text-red-600",children:[(o.netzbezugKosten/r.anzahlMonate).toFixed(0)," "]})]}),o.sonderkosten>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:" Sonderkosten/Monat"}),e.jsxs("p",{className:"font-medium text-amber-600",children:[(o.sonderkosten/r.anzahlMonate).toFixed(0)," "]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:" Netto-Ertrag/Monat"}),e.jsxs("p",{className:"font-medium text-blue-600",children:[(o.nettoNachSonderkosten/r.anzahlMonate).toFixed(0)," "]})]})]})]})]})}const Ss=.38;function fg({data:t,stats:r,zeitraumLabel:a}){const s=m.useMemo(()=>xl(t),[t]),n=m.useMemo(()=>{let o=0;return s.map(x=>(o+=x.co2_einsparung,{...x,kumuliert_co2:o}))},[s]),i=r.gesamtErzeugung*Ss,l=i/12.5,c=i/.12,h=i/230,g=()=>{const o=["Monat","CO2-Einsparung (kg)","Kumuliert (kg)","Kumuliert (t)"],x=n.map(u=>[u.name,u.co2_einsparung,u.kumuliert_co2,u.kumuliert_co2/1e3]);ms(o,x,"co2_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ",""," ",r.anzahlMonate," Monate"]}),e.jsxs(se,{variant:"secondary",size:"sm",onClick:g,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"CO2 eingespart",value:(i/1e3).toFixed(2),unit:"t",subtitle:`${r.anzahlMonate} Monate`,icon:kt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung  CO2-Faktor",berechnung:`${L(r.gesamtErzeugung,0)} kWh  ${Ss*1e3} g/kWh`,ergebnis:`= ${L(i,0)} kg = ${L(i/1e3,2)} t`}),e.jsx(ze,{title:"Bume quivalent",value:l.toFixed(0),unit:"Bume/Jahr",subtitle:"Bindungsleistung",icon:kt,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung  12,5 kg/Baum/Jahr",berechnung:`${L(i,0)} kg  12,5 kg/Baum`,ergebnis:`= ${L(l,0)} Bume`}),e.jsx(ze,{title:"Auto-km vermieden",value:(c/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:kt,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung  120 g/km",berechnung:`${L(i*1e3,0)} g  120 g/km`,ergebnis:`= ${L(c,0)} km`}),e.jsx(ze,{title:"Kurzstreckenflge",value:h.toFixed(1),unit:"Flge",subtitle:" 1000 km",icon:kt,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"CO2-Einsparung  230 kg/Flug",berechnung:`${L(i,0)} kg  230 kg/Flug`,ergebnis:`= ${L(h,1)} Flge vermieden`})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(kt,{className:"h-5 w-5 text-green-500"}),"CO2-Einsparung pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:s,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{unit:" kg",tick:{fontSize:11}}),e.jsx(ge,{formatter:o=>[`${o.toFixed(0)} kg CO2`,"Einsparung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(oe,{dataKey:"co2_einsparung",name:"CO2 eingespart",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kumulierte CO2-Einsparung"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(be,{tickFormatter:o=>`${(o/1e3).toFixed(1)}`,unit:" t",tick:{fontSize:11}}),e.jsx(ge,{formatter:o=>[`${(o/1e3).toFixed(2)} t CO2`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(It,{type:"monotone",dataKey:"kumuliert_co2",name:"Kumulierte Einsparung",stroke:"#10b981",fill:"#10b981",fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[(i/1e3).toFixed(2)," t CO2"]})]})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",e.jsxs("strong",{children:[Ss*1e3," g CO2/kWh"]})," berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:" pro Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate).toFixed(0)," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:" pro kWh"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(Ss*1e3).toFixed(0)," g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:" pro Jahr"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12/1e3).toFixed(2)," t"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Hochgerechnet 20 Jahre"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12*20/1e3).toFixed(1)," t"]})]})]})]})]})}function yg({anlageId:t,strompreis:r,selectedYear:a="all"}){var y,k,_;const{investitionen:s,loading:n}=us(t),[i,l]=m.useState(null),[c,h]=m.useState(!0),[g,o]=m.useState(null),[x,u]=m.useState(new Set);m.useEffect(()=>{(async()=>{try{h(!0);const[v,E]=await Promise.all([tt.getROIDashboard(t,r==null?void 0:r.netzbezug_arbeitspreis_cent_kwh,r==null?void 0:r.einspeiseverguetung_cent_kwh,void 0,a),pr.getUebersicht(t)]);l(v),o(E)}catch(v){console.error("ROI-Dashboard Fehler:",v)}finally{h(!1)}})()},[t,r,a]);const d=m.useMemo(()=>{const w={};return s.forEach(v=>{w[v.typ]||(w[v.typ]=[]),w[v.typ].push(v)}),w},[s]),p=m.useMemo(()=>Object.entries(d).map(([w,v])=>({typ:w,label:Aa[w]||w,kosten:v.reduce((E,F)=>E+(F.anschaffungskosten_gesamt||0),0),color:Hr[w]||"#6b7280"})).filter(w=>w.kosten>0).sort((w,v)=>v.kosten-w.kosten),[d]),b=m.useMemo(()=>{if(!i||!i.gesamt_jahres_einsparung)return[];const w=i.gesamt_relevante_kosten,v=i.gesamt_jahres_einsparung,E=[];for(let F=0;F<=25;F++){const C=F*v;E.push({jahr:F,investition:w,ersparnis:C,bilanz:C-w})}return E},[i]);if(n||c)return e.jsx(Se,{text:"Lade Investitionsdaten..."});if(s.length===0)return e.jsxs(P,{className:"text-center py-8",children:[e.jsx(ta,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const j=(y=i==null?void 0:i.berechnungen.find(w=>w.investition_typ==="pv-module"))==null?void 0:y.detail_berechnung,f=j==null?void 0:j.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"Gesamtinvestition",value:((i==null?void 0:i.gesamt_relevante_kosten)||0).toFixed(0),unit:"",subtitle:`${s.length} Komponenten`,icon:bh,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" Anschaffungskosten  Alternativkosten",berechnung:i?`${L(i.gesamt_investition,0)}   ${L(i.gesamt_investition-i.gesamt_relevante_kosten,0)}  Alternativ`:void 0,ergebnis:i?`= ${L(i.gesamt_relevante_kosten,0)}  relevante Kosten`:void 0}),e.jsx(ze,{title:"Jahresersparnis",value:((i==null?void 0:i.gesamt_jahres_einsparung)||0).toFixed(0),unit:"/Jahr",icon:Fe,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerls + Eigenverbrauch-Ersparnis",berechnung:j?`${L(j.einspeise_erloes_euro,2)}  + ${L(j.ev_ersparnis_euro,2)} `:" aller Investitions-Einsparungen",ergebnis:f||(i?`= ${L(i.gesamt_jahres_einsparung,0)} /Jahr`:void 0)}),e.jsx(ze,{title:"ROI",value:((k=i==null?void 0:i.gesamt_roi_prozent)==null?void 0:k.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:Fe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis  Relevante Kosten  100",berechnung:i&&i.gesamt_relevante_kosten>0?`${L(i.gesamt_jahres_einsparung,0)}   ${L(i.gesamt_relevante_kosten,0)}   100`:void 0,ergebnis:i!=null&&i.gesamt_roi_prozent?`= ${i.gesamt_roi_prozent.toFixed(1)}% ROI p.a.`:void 0}),e.jsx(ze,{title:"Amortisation",value:((_=i==null?void 0:i.gesamt_amortisation_jahre)==null?void 0:_.toFixed(1))||"---",unit:"Jahre",icon:$t,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten  Jahresersparnis",berechnung:i&&i.gesamt_jahres_einsparung>0?`${L(i.gesamt_relevante_kosten,0)}   ${L(i.gesamt_jahres_einsparung,0)} /Jahr`:void 0,ergebnis:i!=null&&i.gesamt_amortisation_jahre?`= ${i.gesamt_amortisation_jahre.toFixed(1)} Jahre bis zur Kostendeckung`:void 0})]}),g&&g.anzahl_monate>0&&i&&(()=>{const w=i.gesamt_relevante_kosten,E=((g.netto_ertrag_euro||0)+(g.wp_ersparnis_euro||0)+(g.emob_ersparnis_euro||0)+(g.bkw_ersparnis_euro||0)+(g.sonstige_netto_euro||0))/(g.anzahl_monate/12),F=w>0?E/w*100:0,C=E>0?w/E:null,D=i.gesamt_jahres_einsparung>0?E/i.gesamt_jahres_einsparung*100:null;return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 px-4 py-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1",children:"Tatschlich realisiert"}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Basis: ",g.anzahl_monate," Monate Echtdaten",g.zeitraum_von&&g.zeitraum_bis?` (${g.zeitraum_von}  ${g.zeitraum_bis})`:""]})]}),e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-base font-bold text-gray-700 dark:text-gray-200",children:[Math.round(E).toLocaleString("de")," /Jahr"]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:" Jahresersparnis"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-base font-bold text-gray-700 dark:text-gray-200",children:[F.toFixed(1)," %"]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"ROI p.a."})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-base font-bold text-gray-700 dark:text-gray-200",children:[C?C.toFixed(1):"---"," Jahre"]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Amortisation"})]}),D!==null&&e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:`text-base font-bold ${D>=90?"text-green-600 dark:text-green-400":D>=70?"text-amber-600 dark:text-amber-400":"text-red-600 dark:text-red-400"}`,children:[D.toFixed(0)," %"]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Realisierungsquote"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2 italic",children:"Die Kacheln oben zeigen Prognosen auf Basis konfigurierter Parameter und aktueller Strompreise. Die Realisierungsquote zeigt, wie viel des konfigurierten Potenzials tatschlich erreicht wurde."})]})})(),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:p,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:w,percent:v})=>`${w}: ${(v*100).toFixed(0)}%`,labelLine:!1,children:p.map((w,v)=>e.jsx(Ze,{fill:w.color},`cell-${v}`))}),e.jsx(ge,{formatter:w=>[`${w.toFixed(0)} `,""]})]})})})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:p,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{type:"number",unit:" ",tick:{fontSize:11}}),e.jsx(be,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(ge,{formatter:w=>[`${w.toFixed(0)} `,""]}),e.jsx(oe,{dataKey:"kosten",name:"Kosten",children:p.map((w,v)=>e.jsx(Ze,{fill:w.color},`cell-${v}`))})]})})})]})]}),b.length>0&&e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:b,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(be,{unit:" ",tick:{fontSize:11}}),e.jsx(ge,{formatter:w=>[`${w.toFixed(0)} `,""]}),e.jsx(De,{}),e.jsx(It,{type:"monotone",dataKey:"investition",name:"Investition",stroke:tr.grid,fill:tr.grid,fillOpacity:.3}),e.jsx(It,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:tr.feedin,fill:tr.feedin,fillOpacity:.3})]})})}),(i==null?void 0:i.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",i.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(i==null?void 0:i.berechnungen)&&i.berechnungen.length>0&&(()=>{const w=i.berechnungen.filter(F=>{var C;return F.investition_typ==="pv-module"&&typeof((C=F.detail_berechnung)==null?void 0:C.hinweis)=="string"&&F.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),v=i.berechnungen.filter(F=>{var C;return F.investition_typ==="wechselrichter"&&typeof((C=F.detail_berechnung)==null?void 0:C.hinweis)=="string"&&F.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),E=w.length>0||v.length>0;return e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),E&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(pt,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollstndig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[w.length>0&&e.jsxs("li",{children:[w.length," PV-Modul",w.length>1?"e":""," ohne Wechselrichter-Zuordnung  Bitte unter Einstellungen  Investitionen zuordnen"]}),v.length>0&&e.jsxs("li",{children:[v.length," Wechselrichter ohne PV-Module  Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.berechnungen.map(F=>{var G,Z;const C=F.anschaffungskosten_alternativ>0,D=C?"Anschaffung  Alternativkosten":"Anschaffungskosten (keine Alternative)",A=C?`${L(F.anschaffungskosten,0)}   ${L(F.anschaffungskosten_alternativ,0)} `:`${L(F.anschaffungskosten,0)} `,S=`= ${L(F.relevante_kosten,0)}  Mehrkosten`,N=(F.detail_berechnung||{}).hinweis,z=F.investition_typ==="pv-system"&&F.komponenten&&F.komponenten.length>0,$=x.has(F.investition_id),T=F.investition_typ==="pv-module"&&typeof N=="string"&&N.includes("ohne Wechselrichter"),I=F.investition_typ==="wechselrichter"&&typeof N=="string"&&N.includes("ohne zugeordnete PV-Module"),V=()=>{u(R=>{const M=new Set(R);return M.has(F.investition_id)?M.delete(F.investition_id):M.add(F.investition_id),M})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${z?"cursor-pointer":""}`,onClick:z?V:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[z&&($?e.jsx(Mr,{className:"h-4 w-4 text-gray-400"}):e.jsx(Yt,{className:"h-4 w-4 text-gray-400"})),(T||I)&&e.jsx("span",{title:T?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(pt,{className:"h-4 w-4 text-amber-500"})}),F.investition_bezeichnung,z&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",F.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Hr[F.investition_typ]||"#6b7280"}20`,color:Hr[F.investition_typ]||"#6b7280"},children:Aa[F.investition_typ]||F.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(zr,{formel:D,berechnung:A,ergebnis:S,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[F.relevante_kosten.toFixed(0)," "]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(zr,{formel:`Jahresersparnis ${Aa[F.investition_typ]||F.investition_typ}`,berechnung:N||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${L(F.jahres_einsparung,0)} /Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[F.jahres_einsparung.toFixed(0)," "]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(zr,{formel:"Ersparnis  Mehrkosten  100",berechnung:`${L(F.jahres_einsparung,0)}   ${L(F.relevante_kosten,0)}   100`,ergebnis:F.roi_prozent?`= ${F.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((G=F.roi_prozent)==null?void 0:G.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(zr,{formel:"Mehrkosten  Ersparnis",berechnung:`${L(F.relevante_kosten,0)}   ${L(F.jahres_einsparung,0)} /Jahr`,ergebnis:F.amortisation_jahre?`= ${F.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((Z=F.amortisation_jahre)==null?void 0:Z.toFixed(1))||"---"," J."]})})})]},F.investition_id),z&&$&&F.komponenten.map(R=>{var M,H;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:Hr[R.typ]||"#6b7280"}}),R.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Hr[R.typ]||"#6b7280"}15`,color:Hr[R.typ]||"#6b7280"},children:Aa[R.typ]||R.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[R.relevante_kosten.toFixed(0)," "]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:R.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[R.einsparung.toFixed(0)," "]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((M=R.detail)==null?void 0:M.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[R.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((H=R.detail)==null?void 0:H.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:R.detail.hinweis})]})]},`komp-${R.investition_id}`)})]})})})]})})]})})(),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(d).map(([w,v])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Hr[w]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Aa[w]||w}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:v.map(E=>{var F;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:E.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((F=E.anschaffungskosten_gesamt)==null?void 0:F.toFixed(0))||"0"," "]})]},E.id)})})]},w))})]})]})}const na=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function jg({anlageId:t,selectedYear:r,verfuegbareJahre:a,zeitraumLabel:s}){var b,j;const[n,i]=m.useState(null),[l,c]=m.useState(!0),[h,g]=m.useState(null),[o,x]=m.useState(new Map);m.useEffect(()=>{(async()=>{var y,k;c(!0),g(null);try{if(r==="all"){const _=new Map;for(const w of a)try{const v=await pr.getPVStrings(t,w);_.set(w,v)}catch(v){console.error(`Fehler beim Laden Jahr ${w}:`,v)}if(x(_),_.size>0){const w=_.get(a[0]);if(w){const v=w.strings.map(A=>{let S=0,W=0;_.forEach($=>{const T=$.strings.find(I=>I.investition_id===A.investition_id);T&&(S+=T.prognose_jahr_kwh,W+=T.ist_jahr_kwh)});const N=S>0?(W-S)/S*100:null,z=S>0?W/S:null;return{...A,prognose_jahr_kwh:S,ist_jahr_kwh:W,abweichung_jahr_prozent:N,abweichung_jahr_kwh:W-S,performance_ratio_jahr:z,spezifischer_ertrag_kwh_kwp:A.leistung_kwp>0?W/A.leistung_kwp:null,monatswerte:A.monatswerte.map(($,T)=>{let I=0,V=0;return _.forEach(G=>{const Z=G.strings.find(R=>R.investition_id===A.investition_id);Z&&Z.monatswerte[T]&&(I+=Z.monatswerte[T].prognose_kwh,V+=Z.monatswerte[T].ist_kwh)}),{...$,prognose_kwh:I,ist_kwh:V}})}}),E=v.reduce((A,S)=>A+S.prognose_jahr_kwh,0),F=v.reduce((A,S)=>A+S.ist_jahr_kwh,0),C=[...v].filter(A=>A.performance_ratio_jahr!==null).sort((A,S)=>(S.performance_ratio_jahr||0)-(A.performance_ratio_jahr||0)),D={...w,strings:v,prognose_gesamt_kwh:E,ist_gesamt_kwh:F,abweichung_gesamt_kwh:F-E,abweichung_gesamt_prozent:E>0?(F-E)/E*100:null,bester_string:((y=C[0])==null?void 0:y.bezeichnung)||null,schlechtester_string:((k=C[C.length-1])==null?void 0:k.bezeichnung)||null};i(D)}}}else{const _=await pr.getPVStrings(t,r);i(_)}}catch(_){g("Fehler beim Laden der String-Daten"),console.error(_)}finally{c(!1)}})()},[t,r,a]);const u=m.useMemo(()=>r!=="all"||o.size===0?[]:a.map(f=>{const y=o.get(f);if(!y)return null;const k={name:f.toString(),jahr:f};return y.strings.forEach(_=>{k[_.bezeichnung]=_.performance_ratio_jahr?Math.round(_.performance_ratio_jahr*100):0}),k.Gesamt=y.abweichung_gesamt_prozent?100+y.abweichung_gesamt_prozent:100,k}).filter(Boolean).reverse(),[r,o,a]),d=()=>{if(!n)return;const f=["String","kWp","Ausrichtung","SOLL (kWh)","IST (kWh)","Abweichung (%)","Performance Ratio","kWh/kWp"],y=n.strings.map(_=>[_.bezeichnung,_.leistung_kwp,_.ausrichtung||"-",_.prognose_jahr_kwh,_.ist_jahr_kwh,_.abweichung_jahr_prozent??"-",_.performance_ratio_jahr?(_.performance_ratio_jahr*100).toFixed(1)+"%":"-",_.spezifischer_ertrag_kwh_kwp??"-"]),k=r==="all"?"alle_jahre":r.toString();ms(f,y,`pv_strings_${k}.csv`)};if(l)return e.jsx(Se,{text:"Lade PV-String Daten..."});if(h)return e.jsx(te,{type:"error",children:h});if(!n||n.strings.length===0)return e.jsxs(P,{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen  Investitionen anlegen."})]});if(!n.hat_prognose)return e.jsx(te,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen  PVGIS eine Prognose abrufen, um den SOLL-IST Vergleich zu nutzen."})]})});const p=[...n.strings].sort((f,y)=>(y.performance_ratio_jahr||0)-(f.performance_ratio_jahr||0));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s})," ",""," ",n.strings.length," Strings  ",n.anlagen_leistung_kwp.toFixed(1)," kWp"]}),e.jsxs(se,{variant:"secondary",size:"sm",onClick:d,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ze,{title:"SOLL (Prognose)",value:(n.prognose_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:"PVGIS Jahresprognose",icon:ce,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" PVGIS-Prognose aller Strings",berechnung:n.strings.map(f=>`${f.bezeichnung}: ${f.prognose_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${L(n.prognose_gesamt_kwh,0)} kWh`}),e.jsx(ze,{title:"IST (Erzeugt)",value:(n.ist_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:s,icon:Fe,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:" Erzeugung aller Strings",berechnung:n.strings.map(f=>`${f.bezeichnung}: ${f.ist_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${L(n.ist_gesamt_kwh,0)} kWh`}),e.jsx(ze,{title:"Abweichung",value:`${(n.abweichung_gesamt_prozent||0)>=0?"+":""}${(n.abweichung_gesamt_prozent||0).toFixed(1)}`,unit:"%",subtitle:`${n.abweichung_gesamt_kwh>=0?"+":""}${n.abweichung_gesamt_kwh.toFixed(0)} kWh`,icon:(n.abweichung_gesamt_prozent||0)>=0?Fe:Gt,color:(n.abweichung_gesamt_prozent||0)>=0?"text-green-500":"text-red-500",bgColor:(n.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20",formel:"(IST - SOLL)  SOLL  100",berechnung:`(${L(n.ist_gesamt_kwh,0)} - ${L(n.prognose_gesamt_kwh,0)})  ${L(n.prognose_gesamt_kwh,0)}  100`,ergebnis:`= ${L(n.abweichung_gesamt_prozent||0,1)} %`}),e.jsx(ze,{title:"Spez. Ertrag ",value:(n.ist_gesamt_kwh/n.anlagen_leistung_kwp).toFixed(0),unit:"kWh/kWp",subtitle:s,icon:Xl,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"IST-Erzeugung  Anlagenleistung",berechnung:`${L(n.ist_gesamt_kwh,0)} kWh  ${L(n.anlagen_leistung_kwp,1)} kWp`,ergebnis:`= ${L(n.ist_gesamt_kwh/n.anlagen_leistung_kwp,0)} kWh/kWp`})]}),n.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[n.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-lg",children:[e.jsx(Fe,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Beste Performance"}),e.jsx("p",{className:"font-medium text-green-700 dark:text-green-300",children:n.bester_string})]})]}),n.schlechtester_string&&n.schlechtester_string!==n.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(Gt,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Schwchste Performance"}),e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300",children:n.schlechtester_string})]})]})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Xl,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro String"]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:n.strings.map((f,y)=>({name:f.bezeichnung.length>12?f.bezeichnung.slice(0,12)+"...":f.bezeichnung,SOLL:f.prognose_jahr_kwh,IST:f.ist_jahr_kwh,color:na[y%na.length]})),layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{type:"number",unit:" kWh"}),e.jsx(be,{type:"category",dataKey:"name",width:100,tick:{fontSize:11}}),e.jsx(ge,{formatter:f=>[`${f.toFixed(0)} kWh`,""]}),e.jsx(De,{}),e.jsx(oe,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(oe,{dataKey:"IST",fill:"#f59e0b",name:"IST (Erzeugt)"})]})})})]}),e.jsxs(P,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Monatsverlauf SOLL vs IST ",r==="all"?"(Summe aller Jahre)":""]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:((b=n.strings[0])==null?void 0:b.monatswerte.map((f,y)=>{const k={name:f.monat_name,SOLL:n.strings.reduce((_,w)=>{var v;return _+(((v=w.monatswerte[y])==null?void 0:v.prognose_kwh)||0)},0),IST:n.strings.reduce((_,w)=>{var v;return _+(((v=w.monatswerte[y])==null?void 0:v.ist_kwh)||0)},0)};return k.Abweichung=k.IST-k.SOLL,k}))||[],children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:10}}),e.jsx(be,{unit:" kWh",tick:{fontSize:11}}),e.jsx(ge,{formatter:f=>[`${f.toFixed(0)} kWh`,""]}),e.jsx(De,{}),e.jsx(oe,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(oe,{dataKey:"IST",fill:"#f59e0b",name:"IST"}),e.jsx(qe,{type:"monotone",dataKey:"Abweichung",stroke:"#10b981",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]}),r==="all"&&u.length>1&&e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Entwicklung ber Jahre"}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:u,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name"}),e.jsx(be,{unit:"%",domain:[80,120],ticks:[80,90,100,110,120]}),e.jsx(ge,{formatter:f=>[`${f}%`,""]}),e.jsx(De,{}),n.strings.map((f,y)=>e.jsx(qe,{type:"monotone",dataKey:f.bezeichnung,stroke:na[y%na.length],strokeWidth:2,dot:{r:4}},f.investition_id)),e.jsx(qe,{type:"monotone",dataKey:"Gesamt",stroke:"#6b7280",strokeWidth:3,strokeDasharray:"5 5",dot:{r:4}})]})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"100% = Prognose erreicht  Werte ber 100% = berperformance"})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abweichung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:p.map(f=>{var y,k;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:na[n.strings.findIndex(_=>_.investition_id===f.investition_id)%na.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:f.bezeichnung})]}),f.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:[" ",f.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right",children:f.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3",children:[f.ausrichtung||"-",f.neigung_grad&&` / ${f.neigung_grad}`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600",children:[f.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right text-amber-600 font-medium",children:[f.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right font-medium ${(f.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(f.abweichung_jahr_prozent||0)>=0?"+":"",((y=f.abweichung_jahr_prozent)==null?void 0:y.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right text-purple-600",children:((k=f.spezifischer_ertrag_kwh_kwp)==null?void 0:k.toFixed(0))||"-"})]},f.investition_id)})}),e.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:"Gesamt"}),e.jsx("td",{className:"px-3 py-2 text-right",children:n.anlagen_leistung_kwp.toFixed(1)}),e.jsx("td",{className:"px-3 py-2",children:"-"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-600",children:[n.prognose_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-2 text-right text-amber-600",children:[n.ist_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-2 text-right ${(n.abweichung_gesamt_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(n.abweichung_gesamt_prozent||0)>=0?"+":"",((j=n.abweichung_gesamt_prozent)==null?void 0:j.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-2 text-right text-purple-600",children:(n.ist_gesamt_kwh/n.anlagen_leistung_kwp).toFixed(0)})]})})]})})]})]})}function kg(t,r){if(t==="all"){if(r.length===0)return"Alle Jahre";if(r.length===1)return`${r[0]}`;const a=Math.min(...r),s=Math.max(...r);return`${a}${s}`}return`${t}`}function h0(){var _;const t=lr(),[r,a]=m.useState("energie"),[s,n]=m.useState("all"),{anlagen:i,loading:l}=it(),[c,h]=m.useState(null),g=c??((_=i[0])==null?void 0:_.id),o=i.find(w=>w.id===g),{daten:x,loading:u}=$h(g),{strompreis:d}=Xo(g??null),p=m.useMemo(()=>[...new Set(x.map(v=>v.jahr))].sort((v,E)=>E-v),[x]),b=m.useMemo(()=>s==="all"?x:x.filter(w=>w.jahr===s),[x,s]),j=Ch(b);if(l||u)return e.jsx(Se,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(x.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(P,{className:"text-center py-12",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(se,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(ot,{className:"h-4 w-4 ml-2"})]})]})]});const y=[{key:"energie",label:"Energie"},{key:"pv",label:"PV-Anlage"},{key:"komponenten",label:"Komponenten"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"},{key:"investitionen",label:"Investitionen"}],k=kg(s,p);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:s,onChange:w=>n(w.target.value==="all"?"all":Number(w.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),p.map(w=>e.jsx("option",{value:w,children:w},w))]})]}),i.length>1&&e.jsx("select",{value:g??"",onChange:w=>h(Number(w.target.value)),className:"input w-auto",children:i.map(w=>e.jsx("option",{value:w.id,children:w.anlagenname},w.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:y.map(w=>e.jsx("button",{onClick:()=>a(w.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${r===w.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:w.label},w.key))})})]}),e.jsxs("div",{children:[r==="energie"&&e.jsx(mg,{data:b,stats:j,anlage:o,strompreis:d,zeitraumLabel:k}),r==="pv"&&g&&e.jsx(jg,{anlageId:g,selectedYear:s,verfuegbareJahre:p,zeitraumLabel:k}),r==="komponenten"&&e.jsx(pg,{anlage:o,strompreis:d,selectedYear:s,zeitraumLabel:k}),r==="finanzen"&&e.jsx(bg,{data:b,stats:j,strompreis:d,anlageId:g,zeitraumLabel:k}),r==="co2"&&e.jsx(fg,{data:b,stats:j,zeitraumLabel:k}),r==="investitionen"&&g&&e.jsx(yg,{anlageId:g,strompreis:d,selectedYear:s,zeitraumLabel:k})]})]})}const vg={"e-auto":Te,waermepumpe:et,speicher:Ce,wallbox:Ht,wechselrichter:Vr,"pv-module":ce,balkonkraftwerk:Vo,sonstiges:Vr},Zn={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},g0={"e-auto":"E-Auto",waermepumpe:"Wrmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function wg(){var w;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(null),[n,i]=m.useState(null),[l,c]=m.useState(!1),[h,g]=m.useState(null),[o,x]=m.useState(30),[u,d]=m.useState(8.2),[p,b]=m.useState(1.85),j=a??((w=t[0])==null?void 0:w.id),{strompreis:f}=Xo(j??null);m.useEffect(()=>{f&&(x(f.netzbezug_arbeitspreis_cent_kwh),d(f.einspeiseverguetung_cent_kwh))},[f]),m.useEffect(()=>{if(!j)return;(async()=>{try{c(!0),g(null);const E=await tt.getROIDashboard(j,o,u,p);i(E)}catch(E){g(E instanceof Error?E.message:"Fehler beim Laden der ROI-Daten")}finally{c(!1)}})()},[j,o,u,p]);const y=m.useMemo(()=>{if(!n||n.gesamt_relevante_kosten<=0)return[];const v=[];let E=0;const F=Math.min(Math.ceil((n.gesamt_amortisation_jahre??20)*1.5),30);for(let C=0;C<=F;C++)v.push({jahr:C,kumulierte_einsparung:Math.round(E),investition:n.gesamt_relevante_kosten}),E+=n.gesamt_jahres_einsparung;return v},[n]),k=m.useMemo(()=>{if(!n)return[];const v={};return n.berechnungen.forEach(E=>{const F=E.investition_typ;v[F]=(v[F]||0)+E.jahres_einsparung}),Object.entries(v).map(([E,F])=>({name:g0[E]||E,value:Math.round(F),color:Zn[E]||"#6b7280"})).filter(E=>E.value>0)},[n]),_=m.useMemo(()=>n?n.berechnungen.map(v=>({name:v.investition_bezeichnung.length>15?v.investition_bezeichnung.substring(0,15)+"...":v.investition_bezeichnung,fullName:v.investition_bezeichnung,kosten:v.relevante_kosten,einsparung:v.jahres_einsparung,amortisation:v.amortisation_jahre??0,typ:v.investition_typ,color:Zn[v.investition_typ]||"#6b7280"})):[],[n]);return r?e.jsx(Se,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:j??"",onChange:v=>s(Number(v.target.value)),className:"input w-auto",children:t.map(v=>e.jsx("option",{value:v.id,children:v.anlagenname},v.id))})})]}),h&&e.jsx(te,{type:"error",onClose:()=>g(null),children:h}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Vr,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:o,onChange:v=>x(Number(v.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergtung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:u,onChange:v=>d(Number(v.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:p,onChange:v=>b(Number(v.target.value)),className:"input"})]})]})]}),l&&e.jsx(Se,{text:"Berechne ROI..."}),!l&&n&&n.berechnungen.length===0&&e.jsx(ka,{icon:ta,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!l&&n&&n.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Es,{icon:ta,title:"Gesamtinvestition",value:`${n.gesamt_investition.toLocaleString("de-DE")} `,subtitle:`Relevant: ${n.gesamt_relevante_kosten.toLocaleString("de-DE")} `,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:" Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt  Alternativkosten",ergebnis:`= ${L(n.gesamt_relevante_kosten,0)} `}),e.jsx(Es,{icon:Fe,title:"Jhrliche Einsparung",value:`${n.gesamt_jahres_einsparung.toLocaleString("de-DE")} `,subtitle:n.gesamt_roi_prozent?`ROI: ${n.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:" Einsparungen aller Investitionen",berechnung:n.gesamt_relevante_kosten>0?"ROI = Einsparung  Kosten  100":void 0,ergebnis:n.gesamt_roi_prozent?`= ${n.gesamt_roi_prozent}% ROI`:void 0}),e.jsx(Es,{icon:Lo,title:"Amortisation",value:n.gesamt_amortisation_jahre?`${n.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten  Jhrliche Einsparung",berechnung:n.gesamt_jahres_einsparung>0?`${L(n.gesamt_relevante_kosten,0)}   ${L(n.gesamt_jahres_einsparung,0)} /Jahr`:void 0,ergebnis:n.gesamt_amortisation_jahre?`= ${n.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx(Es,{icon:kt,title:"CO2-Einsparung",value:`${n.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:" CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${L(n.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:y,children:[e.jsx(je,{strokeDasharray:"3 3",opacity:.3}),e.jsx(ke,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(be,{tickFormatter:v=>`${(v/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(ge,{formatter:(v,E)=>[`${v.toLocaleString("de-DE")} `,E==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:v=>`Jahr ${v}`}),e.jsx(De,{formatter:v=>v==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(qe,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(qe,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),n.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",n.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:k,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:v,percent:E})=>`${v}: ${(E*100).toFixed(0)}%`,labelLine:!0,children:k.map((v,E)=>e.jsx(Ze,{fill:v.color},`cell-${E}`))}),e.jsx(ge,{formatter:v=>[`${v.toLocaleString("de-DE")} /Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:_,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",opacity:.3}),e.jsx(ke,{type:"number",tickFormatter:v=>`${v.toLocaleString("de-DE")}`}),e.jsx(be,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(ge,{formatter:(v,E)=>[E==="kosten"?`${v.toLocaleString("de-DE")} `:`${v.toLocaleString("de-DE")} /Jahr`,E==="kosten"?"Relevante Kosten":"Jhrliche Einsparung"]}),e.jsx(De,{formatter:v=>v==="kosten"?"Relevante Kosten ()":"Jhrliche Einsparung ()"}),e.jsx(oe,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(oe,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailbersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:n.berechnungen.map(v=>{const E=vg[v.investition_typ]||Vr;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4",style:{color:Zn[v.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:v.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:g0[v.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[v.relevante_kosten.toLocaleString("de-DE")," "]}),v.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",v.anschaffungskosten.toLocaleString("de-DE"),"  gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[v.jahres_einsparung.toLocaleString("de-DE")," "]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:v.roi_prozent?e.jsxs("span",{className:v.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[v.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:v.amortisation_jahre?e.jsxs("span",{className:v.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[v.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:v.co2_einsparung_kg?`${v.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},v.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[n.gesamt_relevante_kosten.toLocaleString("de-DE")," "]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[n.gesamt_jahres_einsparung.toLocaleString("de-DE")," "]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:n.gesamt_roi_prozent?`${n.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:n.gesamt_amortisation_jahre?`${n.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[n.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(te,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatschlichen Einsparungen knnen je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function Es({icon:t,title:r,value:a,subtitle:s,color:n,bgColor:i,formel:l,berechnung:c,ergebnis:h}){const g=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a});return e.jsx(P,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:`h-6 w-6 ${n}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),l?e.jsx(zr,{formel:l,berechnung:c,ergebnis:h,children:g}):g,s&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]})]})})}const Ng=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function _g(){var A;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState(new Date().getFullYear()),[l,c]=m.useState(null),[h,g]=m.useState([]),[o,x]=m.useState(!1),[u,d]=m.useState(!1),[p,b]=m.useState(null);m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{a&&j()},[a,n]);const j=async()=>{if(a){x(!0),b(null);try{const S=await _r.listAggregiert(a);g(S);const W=await Nt.getAktivePrognose(a);if(W)c({jahresertrag_kwh:W.jahresertrag_kwh,monatswerte:W.monatswerte,isLive:!1});else try{const N=await Nt.getPrognose(a);c({jahresertrag_kwh:N.jahresertrag_kwh,monatswerte:N.monatsdaten.map(z=>({monat:z.monat,e_m:z.e_m})),isLive:!0,module:N.module})}catch(N){c(null),N instanceof Error&&N.message.includes("PV-Module")&&b("Keine PV-Module fr diese Anlage definiert. Bitte unter Einstellungen  Investitionen anlegen.")}}catch(S){b(S instanceof Error?S.message:"Fehler beim Laden")}finally{x(!1)}}},f=async()=>{if(a){d(!0);try{await Nt.speicherePrognose(a);const S=l==null?void 0:l.module;await j(),S&&S.length>0&&c(W=>W?{...W,module:S}:null)}catch(S){b(S instanceof Error?S.message:"Fehler beim Speichern")}finally{d(!1)}}},y=[...new Set(h.map(S=>S.jahr))].sort((S,W)=>W-S);m.useEffect(()=>{y.length>0&&!y.includes(n)&&i(y[0])},[y,n]);const k=[];if(l!=null&&l.monatswerte)for(let S=1;S<=12;S++){const W=((A=l.monatswerte.find(T=>T.monat===S))==null?void 0:A.e_m)||0,N=h.filter(T=>T.jahr===n&&T.monat===S).reduce((T,I)=>T+(I.pv_erzeugung_kwh||0),0),z=N-W,$=W>0?z/W*100:0;k.push({monat:S,monatName:Ng[S],prognose:W,ist:N,abweichung:z,abweichungProzent:$})}const _=k.reduce((S,W)=>S+W.prognose,0),w=k.reduce((S,W)=>S+W.ist,0),v=w-_,E=_>0?v/_*100:0,C=12-k.filter(S=>S.ist===0).length,D=C>0?w/C*12:0;return r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bi,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:S=>s(parseInt(S.target.value)),options:t.map(S=>({value:S.id.toString(),label:S.anlagenname}))}),y.length>0&&e.jsx(Zt,{value:n.toString(),onChange:S=>i(parseInt(S.target.value)),options:y.map(S=>({value:S.toString(),label:S.toString()}))}),e.jsx("button",{onClick:j,disabled:o,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(sr,{className:`h-5 w-5 ${o?"animate-spin":""}`})})]})]}),p&&e.jsx(te,{type:"error",children:p}),o?e.jsx(Se,{text:"Lade Vergleichsdaten..."}):l?h.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ct,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten fr diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen  Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[l.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(se,{size:"sm",onClick:f,disabled:u,children:[e.jsx(bt,{className:"h-4 w-4 mr-1"}),u?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(P,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[_.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",n]})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[w.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[C," von 12 Monaten"]})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[v>=0?e.jsx(Fe,{className:"h-6 w-6 text-green-500"}):e.jsx(Gt,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${v>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[v>=0?"+":"",v.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${v>=0?"text-green-500":"text-red-500"}`,children:[v>=0?"+":"",E.toFixed(1),"%"]})]}),C<12&&C>0&&e.jsxs(P,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[D.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((D/_-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",n]}),e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:k,children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"monatName"}),e.jsx(be,{yAxisId:"left",tickFormatter:S=>`${S} kWh`}),e.jsx(be,{yAxisId:"right",orientation:"right",tickFormatter:S=>`${S}%`}),e.jsx(ge,{formatter:(S,W)=>W==="Abweichung %"?`${S.toFixed(1)}%`:`${S.toFixed(0)} kWh`}),e.jsx(De,{}),e.jsx(Wd,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(oe,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(oe,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:k.map(S=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:S.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[S.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:S.ist>0?e.jsxs("span",{className:"text-green-600",children:[S.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${S.abweichung>=0?"text-green-600":"text-red-600"}`,children:S.ist>0?`${S.abweichung>=0?"+":""}${S.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${S.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:S.ist>0?`${S.abweichungProzent>=0?"+":""}${S.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:S.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):S.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(Fe,{className:"h-4 w-4"}),"bertroffen"]}):S.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):S.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(Gt,{className:"h-4 w-4"}),"Unter Plan"]})})]},S.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[_.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[w.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${v>=0?"text-green-600":"text-red-600"}`,children:[v>=0?"+":"",v.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${E>=0?"text-green-600":"text-red-600"}`,children:[E>=0?"+":"",E.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"bertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjhrigen Mittelwerten. Einzelne Monate knnen stark abweichen."})]})]}):e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfgbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen  Investitionen".'})]})})]})}const Dn={async getKurzfristPrognose(t,r=14){return Y.get(`/aussichten/kurzfristig/${t}?tage=${r}`)},async getLangfristPrognose(t,r=12){return Y.get(`/aussichten/langfristig/${t}?monate=${r}`)},async getTrendAnalyse(t,r=3){return Y.get(`/aussichten/trend/${t}?jahre=${r}`)},async getWetterVorhersage(t,r=7){return Y.get(`/aussichten/wetter/${t}?tage=${r}`)},async getFinanzPrognose(t,r=12){return Y.get(`/aussichten/finanzen/${t}?monate=${r}`)}};function ia({symbol:t,className:r="h-6 w-6"}){switch(t){case"sunny":return e.jsx(ce,{className:`${r} text-yellow-500`});case"partly_cloudy":return e.jsx(Ir,{className:`${r} text-gray-400`});case"cloudy":return e.jsx(Ir,{className:`${r} text-gray-500`});case"rainy":case"drizzle":case"showers":return e.jsx(Ud,{className:`${r} text-blue-500`});case"snowy":case"snow_showers":return e.jsx(Yd,{className:`${r} text-blue-300`});case"thunderstorm":return e.jsx(qd,{className:`${r} text-purple-500`});case"foggy":return e.jsx(Ir,{className:`${r} text-gray-300`});default:return e.jsx(ce,{className:`${r} text-yellow-400`})}}function la(t){return new Date(t).toLocaleDateString("de-DE",{weekday:"short",day:"2-digit",month:"2-digit"})}function x0(t){return new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})}function Ms(t){return t==null||t<20?"sunny":t<50?"partly_cloudy":(t<80,"cloudy")}function zg({anlageId:t}){var E,F,C,D;const[r,a]=m.useState(null),[s,n]=m.useState(null),[i,l]=m.useState(!0),[c,h]=m.useState(null),[g,o]=m.useState(14),[x,u]=m.useState("standard"),[d,p]=m.useState(!1);m.useEffect(()=>{b()},[t,g,x]);async function b(){l(!0),h(null);try{if(x==="solar-gti"){const A=await Cn.getSolarPrognose(t,g,!1);n(A),a(null)}else{const A=await Dn.getKurzfristPrognose(t,g);a(A),n(null)}}catch(A){h(A.message||"Fehler beim Laden der Prognose")}finally{l(!1)}}if(i)return e.jsx(Se,{text:"Lade Kurzfrist-Prognose..."});if(c)return e.jsx(te,{type:"error",children:c});if(!r&&!s)return e.jsx(te,{type:"warning",children:"Keine Prognose verfgbar"});const j=x==="solar-gti"&&s?s.tage.map(A=>({datum:x0(A.datum),datumFull:la(A.datum),pv_kwh:A.pv_ertrag_kwh,sonnenstunden:null,temperatur:A.temperatur_max_c,gti:A.gti_kwh_m2})):(r==null?void 0:r.tageswerte.map(A=>({datum:x0(A.datum),datumFull:la(A.datum),pv_kwh:A.pv_prognose_kwh,sonnenstunden:A.sonnenstunden,temperatur:A.temperatur_max_c,gti:null})))||[],f=x==="solar-gti"&&s?{...s.tage[0],pv_prognose_kwh:(E=s.tage[0])==null?void 0:E.pv_ertrag_kwh,wetter_symbol:Ms((F=s.tage[0])==null?void 0:F.bewoelkung_prozent)}:r==null?void 0:r.tageswerte[0],y=x==="solar-gti"&&s?{...s.tage[1],pv_prognose_kwh:(C=s.tage[1])==null?void 0:C.pv_ertrag_kwh,wetter_symbol:Ms((D=s.tage[1])==null?void 0:D.bewoelkung_prozent)}:r==null?void 0:r.tageswerte[1],k=x==="solar-gti"&&s?s.tage.reduce((A,S)=>A+(S.pv_ertrag_kwh||0),0):(r==null?void 0:r.summe_kwh)||0,_=j.length>0?k/j.length:0,w=x==="solar-gti"&&s?s.anlage.leistung_kwp:(r==null?void 0:r.anlagenleistung_kwp)||0,v=x==="solar-gti"&&s?"Open-Meteo Solar (GTI)":(r==null?void 0:r.datenquelle)||"";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vr,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Prognose-Modus:"}),e.jsxs("select",{value:x,onChange:A=>u(A.target.value),className:"input w-auto text-sm",children:[e.jsx("option",{value:"standard",children:"Standard (GHI-basiert)"}),e.jsx("option",{value:"solar-gti",children:"Solar GTI (Modulneigung)"})]}),e.jsx("button",{onClick:()=>p(!d),className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Info zum Prognose-Modus",children:e.jsx(nt,{className:"h-4 w-4"})})]})}),d&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Prognose-Modi:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Standard:"})," Basiert auf horizontaler Globalstrahlung (GHI). Guter berblick."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Solar GTI:"})," Bercksichtigt Modulneigung und -ausrichtung fr genauere Prognose. Nutzt Open-Meteo Solar API."]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(Ne,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Summe ",j.length," Tage"]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[k.toFixed(0)," kWh"]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ce,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Durchschnitt/Tag"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[_.toFixed(1)," kWh"]})]})]})}),f&&e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ia,{symbol:f.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Heute"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(f.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})}),y&&e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ia,{symbol:y.wetter_symbol||"sunny",className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Morgen"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[(y.pv_prognose_kwh??0).toFixed(1)," kWh"]})]})]})})]}),e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:x==="solar-gti"?"Solar-Prognose (GTI)":"Wettervorhersage"}),e.jsxs("select",{value:g,onChange:A=>o(Number(A.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:7,children:"7 Tage"}),e.jsx("option",{value:14,children:"14 Tage"}),e.jsx("option",{value:16,children:"16 Tage"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 min-w-max pb-2",children:x==="solar-gti"&&s?s.tage.map((A,S)=>{var W;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${S===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:la(A.datum)}),e.jsx(ia,{symbol:Ms(A.bewoelkung_prozent),className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[A.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Br,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((W=A.temperatur_max_c)==null?void 0:W.toFixed(0))??"-","C"]})]}),A.gti_kwh_m2!==null&&A.gti_kwh_m2>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ce,{className:"h-3 w-3 text-orange-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[A.gti_kwh_m2.toFixed(1)," GTI"]})]})]},A.datum)}):r?r.tageswerte.map((A,S)=>{var W;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${S===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:la(A.datum)}),e.jsx(ia,{symbol:A.wetter_symbol,className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[A.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Br,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((W=A.temperatur_max_c)==null?void 0:W.toFixed(0))??"-","C"]})]}),A.sonnenstunden!==null&&A.sonnenstunden>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ce,{className:"h-3 w-3 text-yellow-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[A.sonnenstunden.toFixed(0),"h"]})]})]},A.datum)}):null})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Prognose"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:j,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"datum",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{yAxisId:"left",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(be,{yAxisId:"right",orientation:"right",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"C",angle:90,position:"insideRight"}}),e.jsx(ge,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(A,S)=>S==="pv_kwh"?[`${A.toFixed(1)} kWh`,"PV-Prognose"]:S==="sonnenstunden"?[`${A.toFixed(1)} h`,"Sonnenstunden"]:S==="temperatur"?[`${A.toFixed(0)} C`,"Temperatur"]:[A,S]}),e.jsx(De,{}),e.jsx(oe,{yAxisId:"left",dataKey:"pv_kwh",name:"PV-Prognose",fill:"#eab308",radius:[4,4,0,0]}),e.jsx(qe,{yAxisId:"right",type:"monotone",dataKey:"temperatur",name:"Temperatur",stroke:"#ef4444",strokeWidth:2,dot:{r:3}})]})})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Datum"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Wetter"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Prognose"}),e.jsx("th",{className:"text-right py-2 px-3",children:x==="solar-gti"?"GTI":"Strahlung"}),e.jsx("th",{className:"text-right py-2 px-3",children:x==="solar-gti"?"Bewlkung":"Sonnenstunden"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Temperatur"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Niederschlag"})]})}),e.jsx("tbody",{children:x==="solar-gti"&&s?s.tage.map((A,S)=>{var W,N,z;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${S===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:la(A.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(ia,{symbol:Ms(A.bewoelkung_prozent),className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[A.pv_ertrag_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((W=A.gti_kwh_m2)==null?void 0:W.toFixed(2))??"-"," kWh/m"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((N=A.bewoelkung_prozent)==null?void 0:N.toFixed(0))??"-"," %"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((z=A.temperatur_max_c)==null?void 0:z.toFixed(0))??"-","C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:A.niederschlag_mm!==null&&A.niederschlag_mm!==void 0&&A.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[A.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},A.datum)}):r?r.tageswerte.map((A,S)=>{var W,N,z;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${S===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:la(A.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(ia,{symbol:A.wetter_symbol,className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[A.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((W=A.globalstrahlung_kwh_m2)==null?void 0:W.toFixed(1))??"-"," kWh/m"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((N=A.sonnenstunden)==null?void 0:N.toFixed(1))??"-"," h"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((z=A.temperatur_max_c)==null?void 0:z.toFixed(0))??"-","C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:A.niederschlag_mm!==null&&A.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[A.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},A.datum)}):null})]})})]}),e.jsx(P,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",w.toFixed(1)," kWp"]}),x==="solar-gti"&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Neigung: ",s.anlage.neigung,""]}),e.jsxs("span",{children:["Ausrichtung: ",s.anlage.azimut,""]})]}),x!=="solar-gti"&&r&&e.jsxs("span",{children:["Systemverluste: ",r.system_losses_prozent.toFixed(0),"%"]}),e.jsxs("span",{children:["Datenquelle: ",v]}),e.jsxs("span",{children:["Abgerufen: ",new Date(x==="solar-gti"&&s?s.abgerufen_am:(r==null?void 0:r.abgerufen_am)||new Date().toISOString()).toLocaleString("de-DE")]})]})})]})}function u0({richtung:t}){switch(t){case"positiv":return e.jsx(Fe,{className:"h-5 w-5 text-green-500"});case"negativ":return e.jsx(Gt,{className:"h-5 w-5 text-red-500"});default:return e.jsx(ts,{className:"h-5 w-5 text-gray-400"})}}function Sg({anlageId:t}){const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,l]=m.useState(null),[c,h]=m.useState(12),[g,o]=m.useState(!0);m.useEffect(()=>{x()},[t,c]);async function x(){n(!0),l(null);try{const b=await Dn.getLangfristPrognose(t,c);a(b)}catch(b){l(b.message||"Fehler beim Laden der Prognose")}finally{n(!1)}}if(s)return e.jsx(Se,{text:"Lade Langfrist-Prognose..."});if(i)return e.jsx(te,{type:"error",children:i});if(!r)return e.jsx(te,{type:"warning",children:"Keine Prognose verfgbar"});const u=r.monatswerte.map(b=>({name:`${b.monat_name.substring(0,3)} ${b.jahr}`,monat_name:b.monat_name,jahr:b.jahr,pvgis:b.pvgis_prognose_kwh,trend:b.trend_korrigiert_kwh,min:b.konfidenz_min_kwh,max:b.konfidenz_max_kwh,konfidenz:[b.konfidenz_min_kwh,b.konfidenz_max_kwh],pr:b.historische_performance_ratio})),d=r.trend_analyse,p=(d.durchschnittliche_performance_ratio*100).toFixed(0)+"%";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(Ne,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahresprognose"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx($t,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[c," Monate"]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u0,{richtung:d.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:p})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(nt,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenbasis"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[d.datenbasis_monate," Monate"]})]})]})})]}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatsprognose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:b=>o(b.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Konfidenzband"})]}),e.jsxs("select",{value:c,onChange:b=>h(Number(b.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsx("div",{className:"h-[350px]",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:u,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60,className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ge,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(b,j)=>j==="trend"?[`${b.toFixed(0)} kWh`,"Trend-korrigiert"]:j==="pvgis"?[`${b.toFixed(0)} kWh`,"PVGIS-Prognose"]:j==="konfidenz"&&Array.isArray(b)?[`${b[0].toFixed(0)} - ${b[1].toFixed(0)} kWh`,"Konfidenzband"]:[b,j]}),e.jsx(De,{}),g&&e.jsx(It,{type:"monotone",dataKey:"konfidenz",name:"Konfidenzband",fill:"#3b82f6",fillOpacity:.1,stroke:"none"}),e.jsx(oe,{dataKey:"pvgis",name:"PVGIS-Prognose",fill:"#9ca3af",fillOpacity:.5,radius:[4,4,0,0]}),e.jsx(oe,{dataKey:"trend",name:"Trend-korrigiert",fill:"#eab308",radius:[4,4,0,0]})]})})})}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Trend-Analyse"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(u0,{richtung:d.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trend"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white capitalize",children:d.trend_richtung})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[p,e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(IST / SOLL)"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenquellen"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.datenquellen.join(", ")})]})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PVGIS"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Trend-korrigiert"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Min"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Max"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Hist. PR"})]})}),e.jsx("tbody",{children:r.monatswerte.map(b=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[b.monat_name," ",b.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[b.pvgis_prognose_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[b.trend_korrigiert_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[b.konfidenz_min_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[b.konfidenz_max_kwh.toFixed(0)," kWh"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:b.historische_performance_ratio!==null?e.jsxs("span",{className:b.historische_performance_ratio>1?"text-green-600":b.historische_performance_ratio<.9?"text-red-600":"text-gray-600",children:[(b.historische_performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},`${b.jahr}-${b.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[r.monatswerte.reduce((b,j)=>b+j.pvgis_prognose_kwh,0).toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{colSpan:3})]})})]})})]}),e.jsx(P,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]}),e.jsxs("span",{children:["Spez. Ertrag: ",(r.jahresprognose_kwh/r.anlagenleistung_kwp).toFixed(0)," kWh/kWp"]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function Eg({anlageId:t}){const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,l]=m.useState(null),[c,h]=m.useState(3);m.useEffect(()=>{g()},[t,c]);async function g(){n(!0),l(null);try{const b=await Dn.getTrendAnalyse(t,c);a(b)}catch(b){l(b.message||"Fehler beim Laden der Trend-Analyse")}finally{n(!1)}}if(s)return e.jsx(Se,{text:"Lade Trend-Analyse..."});if(i)return e.jsx(te,{type:"error",children:i});if(!r)return e.jsx(te,{type:"warning",children:"Keine Trend-Daten verfgbar"});if(!r.jahres_vergleich.some(b=>b.gesamt_kwh>0))return e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{className:"p-8 text-center",children:[e.jsx(pt,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine historischen Daten"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Fr eine Trend-Analyse werden mindestens Daten aus einem Jahr bentigt.",e.jsx("br",{}),"Erfasse Monatsdaten, um Trends zu analysieren."]})]})});const x=r.jahres_vergleich.map(b=>({jahr:b.jahr.toString(),kwh:b.gesamt_kwh,spez_ertrag:b.spezifischer_ertrag_kwh_kwp,pr:b.performance_ratio?b.performance_ratio*100:null})),u=r.jahres_vergleich.filter(b=>b.gesamt_kwh>0),d=u.length>0?u.reduce((b,j)=>j.gesamt_kwh>b.gesamt_kwh?j:b,u[0]):null,p=r.degradation.geschaetzt_prozent_jahr;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[d&&e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(ya,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bestes Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:d.jahr}),e.jsxs("p",{className:"text-sm text-green-600",children:[d.gesamt_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx($t,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Analysezeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.analyse_zeitraum.von," - ",r.analyse_zeitraum.bis]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p!==null?p>0?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(Fe,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):p<-1?e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(Gt,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(ts,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(ts,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Degradation/Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:p!==null?e.jsxs("span",{className:p>0?"text-green-600":p<-1?"text-red-600":"",children:[p>0?"+":"",p.toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(Ne,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]})})]}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"}),e.jsxs("select",{value:c,onChange:b=>h(Number(b.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:2,children:"2 Jahre"}),e.jsx("option",{value:3,children:"3 Jahre"}),e.jsx("option",{value:5,children:"5 Jahre"}),e.jsx("option",{value:10,children:"10 Jahre"})]})]})}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresertrge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:x,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(ge,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:b=>[`${b.toLocaleString("de-DE")} kWh`,"Ertrag"]}),e.jsx(De,{}),e.jsx(oe,{dataKey:"kwh",name:"Jahresertrag",radius:[4,4,0,0],children:x.map((b,j)=>e.jsx(Ze,{fill:b.kwh===(d==null?void 0:d.gesamt_kwh)?"#10b981":"#eab308"},`cell-${j}`))})]})})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:x,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(be,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",domain:["auto","auto"]}),e.jsx(ge,{formatter:b=>[`${b.toFixed(0)} kWh/kWp`,"Spez. Ertrag"]}),e.jsx(De,{}),e.jsx(qe,{type:"monotone",dataKey:"spez_ertrag",name:"Spez. Ertrag",stroke:"#3b82f6",strokeWidth:2,dot:{r:5}})]})})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Saisonale Muster"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Beste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.beste_monate.map((b,j)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${j===0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-500"}`,children:b},b))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Schwchste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.schlechteste_monate.map((b,j)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${j===0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-orange-50 text-orange-700 dark:bg-orange-900/20 dark:text-orange-500"}`,children:b},b))})]})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Degradation"}),r.degradation.methode&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.degradation.methode==="vollstaendig"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:r.degradation.methode==="vollstaendig"?"Vollstndige Jahre":"TMY-ergnzt"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:p!==null?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:p>0?e.jsxs("span",{className:"text-green-600",children:["+",p.toFixed(2),"% pro Jahr"]}):p<-1?e.jsxs("span",{className:"text-red-600",children:[p.toFixed(2),"% pro Jahr"]}):e.jsxs("span",{className:"text-gray-600",children:[p.toFixed(2),"% pro Jahr"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.degradation.hinweis}),r.degradation.methode==="tmy_ergaenzt"&&e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:"Unvollstndige Jahre wurden mit PVGIS TMY-Prognosewerten ergnzt."}),p<-1&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-2",children:"Eine Degradation von mehr als 1% pro Jahr kann auf Probleme hinweisen. Typische Modul-Degradation liegt bei 0.3-0.5% pro Jahr."})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r.degradation.hinweis})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresbersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Jahr"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Monate"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Performance-Ratio"})]})}),e.jsx("tbody",{children:r.jahres_vergleich.map(b=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${b.gesamt_kwh===(d==null?void 0:d.gesamt_kwh)&&b.ist_vollstaendig?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[b.jahr,!b.ist_vollstaendig&&b.anzahl_monate>0&&e.jsx("span",{className:"ml-1 text-xs text-orange-500",title:"Unvollstndiges Jahr",children:"*"})]}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:b.ist_vollstaendig?"text-green-600":"text-orange-500",children:[b.anzahl_monate,"/12"]})}),e.jsx("td",{className:"py-2 px-3 text-right",children:b.gesamt_kwh>0?e.jsxs("span",{className:"font-semibold text-yellow-600",children:[b.gesamt_kwh.toLocaleString("de-DE")," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:b.spezifischer_ertrag_kwh_kwp>0?`${b.spezifischer_ertrag_kwh_kwp.toFixed(0)} kWh/kWp`:e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:b.performance_ratio!==null?e.jsxs("span",{className:b.performance_ratio>1?"text-green-600":b.performance_ratio<.9?"text-red-600":"text-gray-600",children:[(b.performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},b.jahr))})]})})]}),e.jsx(P,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})})]})}const Mg=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ec4899"],Wg={speicher:Ce,"e-auto-v2h":Te,"e-auto-ladung":Te,waermepumpe:et};function Fg({anlageId:t}){const[r,a]=m.useState(null),[s,n]=m.useState(!0),[i,l]=m.useState(null),[c,h]=m.useState(12);m.useEffect(()=>{g()},[t,c]);async function g(){n(!0),l(null);try{const d=await Dn.getFinanzPrognose(t,c);a(d)}catch(d){l(d.message||"Fehler beim Laden der Finanzprognose")}finally{n(!1)}}if(s)return e.jsx(Se,{text:"Lade Finanzprognose..."});if(i)return e.jsx(te,{type:"error",children:i});if(!r)return e.jsx(te,{type:"warning",children:"Keine Prognose verfgbar"});const o=r.monatswerte.map(d=>({name:`${d.monat_name.substring(0,3)} ${d.jahr}`,einspeise_erloes:d.einspeise_erloes_euro,ev_ersparnis:d.ev_ersparnis_euro,netto_ertrag:d.netto_ertrag_euro})),x=[{name:"EV-Ersparnis",value:r.jahres_ev_ersparnis_euro},{name:"Einspeise-Erls",value:r.jahres_einspeise_erloes_euro}],u=Math.min(r.amortisations_fortschritt_prozent,100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(dr,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahres-Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," "]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(Fe,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.amortisations_fortschritt_prozent.toFixed(1),"%"]})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[r.amortisation_erreicht?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(vt,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(Lo,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.amortisation_erreicht?e.jsx("span",{className:"text-green-600",children:"Erreicht"}):r.amortisation_prognose_jahr?e.jsx("span",{children:r.amortisation_prognose_jahr}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(ta,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bisherige Ertrge"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," "]})]})]})})]}),e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Amortisations-Fortschritt"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE"),"  von ",r.investition_gesamt_euro.toLocaleString("de-DE")," "]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all ${r.amortisation_erreicht?"bg-green-500":u>75?"bg-blue-500":u>50?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${u}%`}})}),!r.amortisation_erreicht&&r.restlaufzeit_bis_amortisation_monate&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Noch ca. ",r.restlaufzeit_bis_amortisation_monate," Monate bis zur Amortisation (voraussichtlich ",r.amortisation_prognose_jahr,")"]})]}),e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatliche Ertrags-Prognose"}),e.jsxs("select",{value:c,onChange:d=>h(Number(d.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(P,{className:"p-4 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatliche Ertrge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:o,children:[e.jsx(je,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ke,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fontSize:12},label:{value:"",angle:-90,position:"insideLeft"}}),e.jsx(ge,{formatter:(d,p)=>{const b={einspeise_erloes:"Einspeise-Erls",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"};return[`${d.toFixed(2)} `,b[p]||p]}}),e.jsx(De,{formatter:d=>({einspeise_erloes:"Einspeise-Erls",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"})[d]||d}),e.jsx(oe,{dataKey:"einspeise_erloes",stackId:"a",fill:"#3b82f6",name:"einspeise_erloes"}),e.jsx(oe,{dataKey:"ev_ersparnis",stackId:"a",fill:"#10b981",name:"ev_ersparnis"}),e.jsx(qe,{type:"monotone",dataKey:"netto_ertrag",stroke:"#f59e0b",strokeWidth:2,dot:{r:3},name:"netto_ertrag"})]})})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Ertrags-Zusammensetzung"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({percent:d})=>`${(d*100).toFixed(0)}%`,children:x.map((d,p)=>e.jsx(Ze,{fill:Mg[p]},`cell-${p}`))}),e.jsx(ge,{formatter:d=>`${d.toFixed(2)} `}),e.jsx(De,{})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"EV-Quote:"}),e.jsxs("span",{className:"font-medium",children:[r.eigenverbrauchsquote_prozent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]})]})]})]})]}),r.komponenten_beitraege&&r.komponenten_beitraege.length>0&&e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Komponenten-Beitrge zur Finanzierung"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.komponenten_beitraege.map((d,p)=>{const b=Wg[d.typ]||Ce;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(b,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:d.bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500",children:d.beschreibung})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[d.beitrag_kwh_jahr.toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",d.beitrag_euro_jahr.toFixed(0)," /Jahr"]})]})]},p)})}),(r.speicher_ev_erhoehung_kwh>0||r.v2h_rueckspeisung_kwh>0||r.wp_pv_anteil_kwh>0)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.speicher_ev_erhoehung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Speicher EV+"}),e.jsxs("p",{className:"font-semibold",children:[r.speicher_ev_erhoehung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.speicher_ev_erhoehung_euro.toFixed(0)," "]})]}),r.v2h_rueckspeisung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"V2H-Rckspeisung"}),e.jsxs("p",{className:"font-semibold",children:[r.v2h_rueckspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.v2h_ersparnis_euro.toFixed(0)," "]})]}),r.eauto_ladung_pv_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"E-Auto PV-Ladung"}),e.jsxs("p",{className:"font-semibold",children:[r.eauto_ladung_pv_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.eauto_ersparnis_euro.toFixed(0)," "]})]}),r.wp_pv_anteil_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"WP PV-Direkt"}),e.jsxs("p",{className:"font-semibold",children:[r.wp_pv_anteil_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.wp_pv_ersparnis_euro.toFixed(0)," "]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Strompreise"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Einspeisevergtung"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Netzbezugspreis"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:[r.netzbezug_preis_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ersparnis durch EV"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[(r.netzbezug_preis_cent_kwh-r.einspeiseverguetung_cent_kwh).toFixed(2)," ct/kWh"]})]})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Investition & ROI"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Investition gesamt"}),e.jsxs("span",{className:"font-semibold",children:[r.investition_gesamt_euro.toLocaleString("de-DE")," "]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Bisherige Ertrge"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," "]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Prognose Jahres-Ertrag"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE")," /Jahr"]})]})]})]})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeisung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeise-Erls"}),e.jsx("th",{className:"text-right py-2 px-3",children:"EV-Ersparnis"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold",children:"Netto-Ertrag"})]})}),e.jsx("tbody",{children:r.monatswerte.map(d=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[d.monat_name," ",d.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[d.pv_erzeugung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[d.eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[d.einspeisung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[d.einspeise_erloes_euro.toFixed(2)," "]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[d.ev_ersparnis_euro.toFixed(2)," "]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[d.netto_ertrag_euro.toFixed(2)," "]})]},`${d.jahr}-${d.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_erzeugung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[r.jahres_einspeise_erloes_euro.toFixed(2)," "]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[r.jahres_ev_ersparnis_euro.toFixed(2)," "]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahres_netto_ertrag_euro.toFixed(2)," "]})]})})]})})]}),e.jsx(P,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function Ag(){var x;const t=lr(),[r,a]=m.useState("kurzfristig"),{anlagen:s,loading:n}=it(),[i,l]=m.useState(null),c=i??((x=s[0])==null?void 0:x.id);if(n)return e.jsx(Se,{text:"Lade Aussichten..."});if(s.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});const h=s.find(u=>u.id===c);if(!((h==null?void 0:h.latitude)&&(h==null?void 0:h.longitude)))return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsxs(P,{className:"text-center py-12",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Standort nicht konfiguriert"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["Fr Prognosen werden die Koordinaten der Anlage bentigt.",e.jsx("br",{}),"Bitte konfiguriere den Standort in den Anlagen-Einstellungen."]}),e.jsxs(se,{onClick:()=>t("/einstellungen/anlage"),children:["Anlage konfigurieren",e.jsx(ot,{className:"h-4 w-4 ml-2"})]})]})]});const o=[{key:"kurzfristig",label:"Kurzfristig",icon:ce,tooltip:"7-14 Tage Wetterprognose mit PV-Ertragsprognose"},{key:"langfristig",label:"Langfristig",icon:$t,tooltip:"12-Monats-Prognose basierend auf PVGIS-Daten"},{key:"trend",label:"Trend",icon:Fe,tooltip:"Historische Trends und Degradationsanalyse"},{key:"finanzen",label:"Finanzen",icon:dr,tooltip:"Finanzielle Prognosen und Amortisation"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx("div",{className:"flex items-center gap-3",children:s.length>1&&e.jsx("select",{value:c??"",onChange:u=>l(Number(u.target.value)),className:"input w-auto",children:s.map(u=>e.jsx("option",{value:u.id,children:u.anlagenname},u.id))})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:o.map(u=>{const d=u.icon;return e.jsx(Pn,{text:u.tooltip,children:e.jsxs("button",{onClick:()=>a(u.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 ${r===u.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(d,{className:"h-4 w-4"}),u.label]})},u.key)})})})]}),c&&e.jsxs(e.Fragment,{children:[r==="kurzfristig"&&e.jsx(zg,{anlageId:c}),r==="langfristig"&&e.jsx(Sg,{anlageId:c}),r==="trend"&&e.jsx(Eg,{anlageId:c}),r==="finanzen"&&e.jsx(Fg,{anlageId:c})]})]})}const $g=[{key:"strom",label:"Strom",icon:""},{key:"gas",label:"Gas",icon:""},{key:"wasser",label:"Wasser",icon:""}],$a=()=>({name:"",kundennummer:"",portal_url:"",notizen:"",zaehler:[]}),Cg=()=>({bezeichnung:"",nummer:"",notizen:""});function Pg({value:t,onChange:r}){const[a,s]=m.useState({}),n=u=>{s(d=>({...d,[u]:!d[u]}))},i=(u,d)=>{const p={...t};d?p[u]=d:delete p[u],r(p)},l=u=>{i(u,$a()),s(d=>({...d,[u]:!0}))},c=u=>{i(u,void 0)},h=(u,d,p)=>{const b=t[u]||$a();i(u,{...b,[d]:p})},g=u=>{const d=t[u]||$a();i(u,{...d,zaehler:[...d.zaehler,Cg()]})},o=(u,d,p)=>{const b=t[u]||$a(),j=[...b.zaehler];j[d]=p,i(u,{...b,zaehler:j})},x=(u,d)=>{const p=t[u]||$a(),b=p.zaehler.filter((j,f)=>f!==d);i(u,{...p,zaehler:b})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Versorger & Zhler"}),e.jsx("div",{className:"space-y-3",children:$g.map(({key:u,label:d,icon:p})=>{const b=t[u],j=a[u];return b?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer",onClick:()=>n(u),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[j?e.jsx(Mr,{className:"w-4 h-4 text-gray-500"}):e.jsx(Yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-lg",children:p}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:b.name||d}),b.zaehler.length>0&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",b.zaehler.length," Zhler)"]})]}),e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),c(u)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Versorger entfernen",children:e.jsx(Mt,{className:"w-4 h-4"})})]}),j&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Versorger-Name",value:b.name,onChange:f=>h(u,"name",f.target.value),placeholder:`z.B. Stadtwerke ${d}`}),e.jsx(Q,{label:"Kundennummer",value:b.kundennummer,onChange:f=>h(u,"kundennummer",f.target.value),placeholder:"z.B. 12345678"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Q,{label:"Kundenportal-URL",value:b.portal_url||"",onChange:f=>h(u,"portal_url",f.target.value),placeholder:"https://kundenportal.beispiel.de"}),b.portal_url&&e.jsxs("a",{href:b.portal_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qr,{className:"w-3 h-3"}),"Portal ffnen"]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(Q,{label:"Notizen",value:b.notizen||"",onChange:f=>h(u,"notizen",f.target.value),placeholder:"Optionale Anmerkungen..."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Zhler"}),e.jsxs(se,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(u),children:[e.jsx(Wr,{className:"w-4 h-4 mr-1"}),"Zhler"]})]}),b.zaehler.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Noch keine Zhler erfasst"}):e.jsx("div",{className:"space-y-2",children:b.zaehler.map((f,y)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(Q,{label:"Bezeichnung",value:f.bezeichnung,onChange:k=>o(u,y,{...f,bezeichnung:k.target.value}),placeholder:u==="strom"?"z.B. Einspeisung":"z.B. Hauptzhler"}),e.jsx(Q,{label:"Zhlernummer",value:f.nummer,onChange:k=>o(u,y,{...f,nummer:k.target.value}),placeholder:"z.B. 1EMH0012345678"}),e.jsx(Q,{label:"Notizen",value:f.notizen||"",onChange:k=>o(u,y,{...f,notizen:k.target.value}),placeholder:"Optional..."})]}),e.jsx("button",{type:"button",onClick:()=>x(u,y),className:"p-2 text-gray-400 hover:text-red-500 transition-colors mt-6",title:"Zhler entfernen",children:e.jsx(Mt,{className:"w-4 h-4"})})]},y))})]})]})]},u):e.jsxs("button",{type:"button",onClick:()=>l(u),className:"w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-400 hover:text-blue-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Wr,{className:"w-4 h-4"}),e.jsxs("span",{children:[p," ",d,"-Versorger hinzufgen"]})]},u)})})]})}function m0({anlage:t,onSubmit:r,onCancel:a}){var _,w,v,E;const[s,n]=m.useState(!1),[i,l]=m.useState(null),[c,h]=m.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((_=t==null?void 0:t.leistung_kwp)==null?void 0:_.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_land:(t==null?void 0:t.standort_land)||"DE",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((w=t==null?void 0:t.latitude)==null?void 0:w.toString())||"",longitude:((v=t==null?void 0:t.longitude)==null?void 0:v.toString())||"",mastr_id:(t==null?void 0:t.mastr_id)||"",wetter_provider:(t==null?void 0:t.wetter_provider)||"auto",steuerliche_behandlung:(t==null?void 0:t.steuerliche_behandlung)||"keine_ust",ust_satz_prozent:((E=t==null?void 0:t.ust_satz_prozent)==null?void 0:E.toString())||""}),[g,o]=m.useState(!1),[x,u]=m.useState((t==null?void 0:t.versorger_daten)||{}),[d,p]=m.useState([]),[b,j]=m.useState(!1);m.useEffect(()=>{t!=null&&t.id&&t.latitude&&t.longitude&&(j(!0),Cn.getProvider(t.id).then(F=>p(F.provider)).catch(F=>console.warn("Wetter-Provider laden fehlgeschlagen:",F)).finally(()=>j(!1)))},[t==null?void 0:t.id,t==null?void 0:t.latitude,t==null?void 0:t.longitude]);const f={DE:"19",AT:"20",CH:"8.1"},y=F=>{const{name:C,value:D}=F.target;h(A=>{const S={...A,[C]:D};return C==="standort_land"&&!g&&(S.ust_satz_prozent=f[D]||"19"),C==="ust_satz_prozent"&&o(!0),S})},k=async F=>{if(F.preventDefault(),l(null),!c.anlagenname.trim()){l("Bitte einen Namen eingeben");return}if(!c.leistung_kwp||parseFloat(c.leistung_kwp)<=0){l("Bitte eine gltige Leistung eingeben");return}try{n(!0),await r({anlagenname:c.anlagenname.trim(),leistung_kwp:parseFloat(c.leistung_kwp),installationsdatum:c.installationsdatum||void 0,standort_land:c.standort_land||"DE",standort_plz:c.standort_plz||void 0,standort_ort:c.standort_ort||void 0,standort_strasse:c.standort_strasse||void 0,latitude:c.latitude?parseFloat(c.latitude):void 0,longitude:c.longitude?parseFloat(c.longitude):void 0,mastr_id:c.mastr_id||void 0,versorger_daten:Object.keys(x).length>0?x:void 0,wetter_provider:c.wetter_provider,steuerliche_behandlung:c.steuerliche_behandlung||"keine_ust",ust_satz_prozent:c.ust_satz_prozent?parseFloat(c.ust_satz_prozent):void 0})}catch(C){l(C instanceof Error?C.message:"Fehler beim Speichern")}finally{n(!1)}};return e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[i&&e.jsx(te,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Anlagenname",name:"anlagenname",value:c.anlagenname,onChange:y,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(Q,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:c.leistung_kwp,onChange:y,placeholder:"z.B. 10.5",required:!0}),e.jsx(Q,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:c.installationsdatum,onChange:y})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen  Investitionen"})," gepflegt. So knnen auch Anlagen mit mehreren Dachflchen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Land"}),e.jsxs("select",{name:"standort_land",value:c.standort_land,onChange:y,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"DE",children:"Deutschland"}),e.jsx("option",{value:"AT",children:"sterreich"}),e.jsx("option",{value:"CH",children:"Schweiz"})]})]}),e.jsx(Q,{label:"PLZ",name:"standort_plz",value:c.standort_plz,onChange:y,placeholder:c.standort_land==="DE"?"z.B. 12345":"z.B. 1234"}),e.jsx(Q,{label:"Ort",name:"standort_ort",value:c.standort_ort,onChange:y,placeholder:"z.B. Wien"}),e.jsx(Q,{label:"Strae",name:"standort_strasse",value:c.standort_strasse,onChange:y,placeholder:"z.B. Musterstrae 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(fr PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:c.latitude,onChange:y,placeholder:"z.B. 52.520008",hint:"Nrdliche Breite (positiv)"}),e.jsx(Q,{label:"Lngengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:c.longitude,onChange:y,placeholder:"z.B. 13.404954",hint:"stliche Lnge (positiv)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Erweiterte Stammdaten"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(Q,{label:"MaStR-ID",name:"mastr_id",value:c.mastr_id,onChange:y,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID der Anlage"}),c.mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${c.mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qr,{className:"w-3 h-3"}),"Im MaStR ffnen"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ko,{className:"w-4 h-4 text-amber-500"}),"Steuerliche Behandlung"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"steuerliche_behandlung",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"USt-Behandlung"}),e.jsxs("select",{id:"steuerliche_behandlung",name:"steuerliche_behandlung",title:"USt-Behandlung",value:c.steuerliche_behandlung,onChange:y,className:"w-full px-3 py-2 rounded-lg border bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent border-gray-300 dark:border-gray-600",children:[e.jsx("option",{value:"keine_ust",children:"Keine USt-Auswirkung (Standard)"}),e.jsx("option",{value:"regelbesteuerung",children:"Regelbesteuerung (USt auf Eigenverbrauch)"})]})]}),c.steuerliche_behandlung==="regelbesteuerung"&&e.jsx(Q,{label:"USt-Satz (%)",name:"ust_satz_prozent",type:"number",step:"0.1",min:"0",max:"30",value:c.ust_satz_prozent,onChange:y,placeholder:f[c.standort_land]||"19",hint:`Standard: ${f[c.standort_land]||"19"}% (${c.standort_land||"DE"})`})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg flex gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:c.steuerliche_behandlung==="regelbesteuerung"?e.jsxs("p",{children:["Bei ",e.jsx("strong",{children:"Regelbesteuerung"})," wird USt auf den Eigenverbrauch (unentgeltliche Wertabgabe) als Kostenfaktor in den Finanzergebnissen berechnet. Die Bemessungsgrundlage basiert auf den Selbstkosten (Abschreibung + Betriebskosten / Jahresertrag)."]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Keine USt"})," gilt fur PV-Anlagen ab 2023 mit Nullsteuersatz (30 kWp), Kleinunternehmer (19 UStG) oder wenn Sie keine steuerliche Erfassung wunschen."]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ir,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten-Quelle"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"wetter_provider",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bevorzugter Provider"}),e.jsx("select",{id:"wetter_provider",name:"wetter_provider",value:c.wetter_provider,onChange:y,disabled:b,className:"w-full px-3 py-2 rounded-lg border bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed border-gray-300 dark:border-gray-600",children:d.length>0?d.map(F=>e.jsxs("option",{value:F.id,disabled:!F.verfuegbar,children:[F.name,F.empfohlen?" (empfohlen)":"",F.verfuegbar?"":" (nicht verfgbar)"]},F.id)):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"auto",children:"Automatisch (empfohlen)"}),e.jsx("option",{value:"open-meteo",children:"Open-Meteo"}),e.jsx("option",{value:"brightsky",children:"Bright Sky (DWD)"}),e.jsx("option",{value:"open-meteo-solar",children:"Open-Meteo Solar"})]})})]}),e.jsx("div",{className:"flex items-end pb-1",children:e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[c.wetter_provider==="auto"&&e.jsx("span",{children:"Automatische Auswahl: Bright Sky fr DE, Open-Meteo sonst"}),c.wetter_provider==="brightsky"&&e.jsx("span",{children:"DWD-Daten ber Bright Sky API (nur Deutschland)"}),c.wetter_provider==="open-meteo"&&e.jsx("span",{children:"Open-Meteo Archive API (weltweit verfgbar)"}),c.wetter_provider==="open-meteo-solar"&&e.jsx("span",{children:"GTI-Berechnung fr geneigte PV-Module"})]})})]}),!(t!=null&&t.latitude)&&!(t!=null&&t.longitude)&&e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg flex gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"Bitte zuerst Geokoordinaten eintragen, um die verfgbaren Provider zu sehen."})]})]}),e.jsx(Pg,{value:x,onChange:u}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(se,{type:"button",variant:"secondary",onClick:a,children:"Abbrechen"}),e.jsx(se,{type:"submit",loading:s,children:t?"Speichern":"Anlage erstellen"})]})]})}function Dg(){const{anlagen:t,loading:r,error:a,createAnlage:s,updateAnlage:n,deleteAnlage:i}=it(),[l,c]=m.useState(!1),[h,g]=m.useState(null),[o,x]=m.useState(null),u=async b=>{await s(b),c(!1)},d=async b=>{h&&(await n(h.id,b),g(null))},p=async()=>{o&&(await i(o.id),x(null))};return r?e.jsx(Se,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(se,{onClick:()=>c(!0),children:[e.jsx(Wr,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),a&&e.jsx(te,{type:"error",children:a}),t.length===0?e.jsx(P,{children:e.jsx(ka,{icon:ce,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(se,{onClick:()=>c(!0),children:"Erste Anlage anlegen"})})}):e.jsx(P,{padding:"none",children:e.jsxs(ol,{children:[e.jsx(cl,{children:e.jsxs(ja,{children:[e.jsx(yt,{children:"Name"}),e.jsx(yt,{children:"Leistung"}),e.jsx(yt,{children:"Standort"}),e.jsx(yt,{children:"Ausrichtung"}),e.jsx(yt,{children:"Installation"}),e.jsx(yt,{className:"text-right",children:"Aktionen"})]})}),e.jsx(dl,{children:t.map(b=>e.jsxs(ja,{children:[e.jsx(jt,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:b.anlagenname})]})}),e.jsxs(jt,{children:[e.jsx("span",{className:"font-mono",children:b.leistung_kwp})," kWp"]}),e.jsx(jt,{children:b.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(ht,{className:"h-4 w-4"}),b.standort_plz," ",b.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(jt,{children:[b.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),b.neigung_grad&&` / ${b.neigung_grad}`]}),e.jsx(jt,{children:b.installationsdatum?new Date(b.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(jt,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=Jt.getPdfExportUrl(b.id)},title:"PDF-Dokumentation (Gesamtzeitraum)",children:e.jsx($n,{className:"h-4 w-4 text-orange-500"})}),e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=Jt.getFullExportUrl(b.id)},title:"Export (JSON)",children:e.jsx(bt,{className:"h-4 w-4 text-blue-500"})}),e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>g(b),children:e.jsx(il,{className:"h-4 w-4"})}),e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>x(b),children:e.jsx(Mt,{className:"h-4 w-4 text-red-500"})})]})})]},b.id))})]})}),e.jsx(Dt,{isOpen:l,onClose:()=>c(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(m0,{onSubmit:u,onCancel:()=>c(!1)})}),e.jsx(Dt,{isOpen:!!h,onClose:()=>g(null),title:"Anlage bearbeiten",size:"lg",children:h&&e.jsx(m0,{anlage:h,onSubmit:d,onCancel:()=>g(null)})}),e.jsx(Dt,{isOpen:!!o,onClose:()=>x(null),title:"Anlage lschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Mchtest du die Anlage ",e.jsxs("strong",{children:['"',o==null?void 0:o.anlagenname,'"']})," wirklich lschen?"]}),e.jsx(te,{type:"warning",children:"Alle zugehrigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(se,{variant:"secondary",onClick:()=>x(null),children:"Abbrechen"}),e.jsx(se,{variant:"danger",onClick:p,children:"Lschen"})]})]})})]})}function Lg(){var A;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(null),n=a??((A=t[0])==null?void 0:A.id),{strompreise:i,loading:l,error:c,createStrompreis:h,updateStrompreis:g,deleteStrompreis:o}=Dh(n),[x,u]=m.useState(!1),[d,p]=m.useState(null),[b,j]=m.useState(null),[f,y]=m.useState(null),k=async S=>{try{y(null),await h(S),u(!1)}catch(W){y(W instanceof Error?W.message:"Fehler beim Erstellen")}},_=async S=>{if(d)try{y(null),await g(d.id,S),p(null)}catch(W){y(W instanceof Error?W.message:"Fehler beim Aktualisieren")}},w=async()=>{if(b)try{await o(b.id),j(null)}catch(S){y(S instanceof Error?S.message:"Fehler beim Lschen")}},v=S=>{const W=new Date().toISOString().split("T")[0],N=S.gueltig_ab<=W,z=!S.gueltig_bis||S.gueltig_bis>=W;return N&&z};if(r||l)return e.jsx(Se,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const E=S=>{switch(S){case"waermepumpe":return"Warmepumpe";case"wallbox":return"Wallbox";default:return"Standard"}},F=[...i].sort((S,W)=>{const N=v(S),z=v(W);if(N!==z)return N?-1:1;const $=(S.verwendung||"allgemein")==="allgemein",T=(W.verwendung||"allgemein")==="allgemein";return $!==T?$?-1:1:W.gueltig_ab.localeCompare(S.gueltig_ab)}),C=F.filter(S=>v(S)&&S.verwendung&&S.verwendung!=="allgemein"),D=F.find(S=>v(S)&&(!S.verwendung||S.verwendung==="allgemein"));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:n??"",onChange:S=>s(Number(S.target.value)),className:"input w-auto",title:"Anlage auswahlen",children:t.map(S=>e.jsx("option",{value:S.id,children:S.anlagenname},S.id))}),e.jsxs(se,{onClick:()=>u(!0),children:[e.jsx(Wr,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),c&&e.jsx(te,{type:"error",children:c}),D&&e.jsx(P,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(ir,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",D.tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[D.netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]}),"  ","Einspeisung: ",e.jsxs("strong",{children:[D.einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),D.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:["  Grundpreis: ",e.jsxs("strong",{children:[D.grundpreis_euro_monat.toFixed(2)," /Monat"]})]}):null]}),C.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-green-200 dark:border-green-700 space-y-1",children:C.map(S=>e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:[e.jsx("span",{className:`inline-block text-xs px-1.5 py-0.5 rounded mr-2 ${S.verwendung==="waermepumpe"?"bg-orange-100 dark:bg-orange-800 text-orange-700 dark:text-orange-300":"bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300"}`,children:E(S.verwendung)}),e.jsxs("strong",{children:[S.netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," ",e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["(",(D.netzbezug_arbeitspreis_cent_kwh-S.netzbezug_arbeitspreis_cent_kwh).toFixed(2)," ct/kWh gunstiger)"]})]},S.id))})]})]})}),i.length===0?e.jsx(P,{children:e.jsx(ka,{icon:Ne,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(se,{onClick:()=>u(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(P,{padding:"none",children:e.jsxs(ol,{children:[e.jsx(cl,{children:e.jsxs(ja,{children:[e.jsx(yt,{children:"Tarif"}),e.jsx(yt,{children:"Verwendung"}),e.jsx(yt,{children:"Netzbezug"}),e.jsx(yt,{children:"Einspeisung"}),e.jsx(yt,{children:"Grundpreis"}),e.jsx(yt,{children:"Gltigkeit"}),e.jsx(yt,{className:"text-right",children:"Aktionen"})]})}),e.jsx(dl,{children:F.map(S=>{const W=v(S);return e.jsxs(ja,{className:W?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(jt,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:`h-5 w-5 ${W?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:S.tarifname||"Standard"}),W&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),S.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:S.anbieter})]})]})}),e.jsx(jt,{children:!S.verwendung||S.verwendung==="allgemein"?e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded",children:"Standard"}):S.verwendung==="waermepumpe"?e.jsx("span",{className:"text-xs px-2 py-0.5 bg-orange-100 dark:bg-orange-800 text-orange-700 dark:text-orange-300 rounded",children:"Warmepumpe"}):e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 rounded",children:"Wallbox"})}),e.jsxs(jt,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:S.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(jt,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:S.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(jt,{children:S.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:S.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" /Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(jt,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx($t,{className:"h-4 w-4"}),new Date(S.gueltig_ab).toLocaleDateString("de-DE"),S.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(S.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(jt,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>p(S),children:e.jsx(il,{className:"h-4 w-4"})}),e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>j(S),children:e.jsx(Mt,{className:"h-4 w-4 text-red-500"})})]})})]},S.id)})})]})}),e.jsxs(P,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gltige Tarif wird automatisch fr Berechnungen verwendet"}),e.jsx("li",{children:"Fr historische Auswertungen werden die zum jeweiligen Zeitpunkt gltigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gltigkeitszeitraum korrekt setzen"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Spezialtarife:"})," Fr Warmepumpe oder Wallbox mit separatem Stromtarif kann ein eigener Tarif angelegt werden. Ohne Spezialtarif wird automatisch der Standard-Tarif verwendet."]})]})]}),e.jsx(Dt,{isOpen:x,onClose:()=>{u(!1),y(null)},title:"Neuen Tarif anlegen",size:"lg",children:n&&e.jsx(p0,{anlageId:n,onCreate:k,onCancel:()=>{u(!1),y(null)},error:f})}),e.jsx(Dt,{isOpen:!!d,onClose:()=>{p(null),y(null)},title:"Tarif bearbeiten",size:"lg",children:d&&e.jsx(p0,{strompreis:d,anlageId:d.anlage_id,onUpdate:_,onCancel:()=>{p(null),y(null)},error:f})}),e.jsx(Dt,{isOpen:!!b,onClose:()=>j(null),title:"Tarif lschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Mchtest du den Tarif ",e.jsxs("strong",{children:['"',(b==null?void 0:b.tarifname)||"Standard",'"']})," wirklich lschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(se,{variant:"secondary",onClick:()=>j(null),children:"Abbrechen"}),e.jsx(se,{variant:"danger",onClick:w,children:"Lschen"})]})]})})]})}function p0({strompreis:t,anlageId:r,onCreate:a,onUpdate:s,onCancel:n,error:i}){var u,d,p;const[l,c]=m.useState(!1),[h,g]=m.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((u=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:u.toString())||"30",einspeiseverguetung_cent_kwh:((d=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:d.toString())||"8.2",grundpreis_euro_monat:((p=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:p.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||"",verwendung:(t==null?void 0:t.verwendung)||"allgemein"}),o=b=>{const{name:j,value:f}=b.target;g(y=>({...y,[j]:f}))},x=async b=>{b.preventDefault(),c(!0);try{const j={netzbezug_arbeitspreis_cent_kwh:parseFloat(h.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(h.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:h.grundpreis_euro_monat?parseFloat(h.grundpreis_euro_monat):void 0,gueltig_ab:h.gueltig_ab,gueltig_bis:h.gueltig_bis||void 0,tarifname:h.tarifname||void 0,anbieter:h.anbieter||void 0,vertragsart:h.vertragsart||void 0,verwendung:h.verwendung};t&&s?await s(j):a&&await a({...j,anlage_id:r})}finally{c(!1)}};return e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[i&&e.jsx(te,{type:"error",children:i}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarif-Verwendung"}),e.jsxs("select",{name:"verwendung",value:h.verwendung,onChange:o,className:"input w-full",title:"Tarif-Verwendung",children:[e.jsx("option",{value:"allgemein",children:"Standard (allgemein)"}),e.jsx("option",{value:"waermepumpe",children:"Warmepumpe (Spezialtarif)"}),e.jsx("option",{value:"wallbox",children:"Wallbox (Spezialtarif)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:h.verwendung==="allgemein"?"Standard-Tarif fur alle Berechnungen. Wird auch als Fallback fur WP/Wallbox ohne Spezialtarif genutzt.":"Spezialtarif wird nur fur diese Komponente verwendet. Ohne Spezialtarif gilt der Standard-Tarif."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Tarifname",name:"tarifname",value:h.tarifname,onChange:o,placeholder:"z.B. Grundversorgung, ko-Strom"}),e.jsx(Q,{label:"Anbieter",name:"anbieter",value:h.anbieter,onChange:o,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Q,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:h.netzbezug_arbeitspreis_cent_kwh,onChange:o,required:!0,hint:"Arbeitspreis fr Strombezug"}),e.jsx(Q,{label:"Einspeisevergtung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:h.einspeiseverguetung_cent_kwh,onChange:o,required:!0,hint:"EEG-Vergtung oder PPA-Preis"}),e.jsx(Q,{label:"Grundpreis (/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:h.grundpreis_euro_monat,onChange:o,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gltigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Gltig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:h.gueltig_ab,onChange:o,required:!0}),e.jsx(Q,{label:"Gltig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:h.gueltig_bis,onChange:o,hint:"Leer lassen fr unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:h.vertragsart,onChange:o,className:"input w-full",title:"Vertragsart",children:[e.jsx("option",{value:"",children:"Bitte whlen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"kostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(se,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(se,{type:"submit",loading:l,children:t?"Speichern":"Anlegen"})]})]})}function Ig({typ:t,paramData:r,onChange:a,anlage:s,hasParent:n}){const[i,l]=m.useState(!1),[c,h]=m.useState(!1),g=n,o="Wechselrichter";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gertedaten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Hersteller",name:"param_stamm_hersteller",value:r.stamm_hersteller||"",onChange:a,placeholder:"z.B. Fronius, BYD, Longi"}),e.jsx(Q,{label:"Modell",name:"param_stamm_modell",value:r.stamm_modell||"",onChange:a,placeholder:"z.B. Symo GEN24 10.0"}),e.jsx(Q,{label:"Seriennummer",name:"param_stamm_seriennummer",value:r.stamm_seriennummer||"",onChange:a,placeholder:t==="pv-module"?"z.B. SN001-SN020":"z.B. ABC123456"}),e.jsx(Q,{label:"Garantie bis",name:"param_stamm_garantie_bis",type:"date",value:r.stamm_garantie_bis||"",onChange:a}),t==="wechselrichter"&&e.jsxs("div",{children:[e.jsx(Q,{label:"MaStR-ID",name:"param_stamm_mastr_id",value:r.stamm_mastr_id||"",onChange:a,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID des Wechselrichters"}),r.stamm_mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${r.stamm_mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qr,{className:"w-3 h-3"}),"Im MaStR ffnen"]})]}),t==="speicher"&&e.jsx(Q,{label:"Garantie-Zyklen",name:"param_stamm_garantie_zyklen",type:"number",value:r.stamm_garantie_zyklen||"",onChange:a,placeholder:"z.B. 6000",hint:"Garantierte Ladezyklen"}),t==="pv-module"&&e.jsx(Q,{label:"Leistungsgarantie (%)",name:"param_stamm_garantie_leistung_prozent",type:"number",min:"0",max:"100",value:r.stamm_garantie_leistung_prozent||"",onChange:a,placeholder:"z.B. 80",hint:"Garantierte Mindestleistung nach 25 Jahren"}),t==="e-auto"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Kennzeichen",name:"param_stamm_kennzeichen",value:r.stamm_kennzeichen||"",onChange:a,placeholder:"z.B. M-EE 1234"}),e.jsx(Q,{label:"Fahrgestellnummer (VIN)",name:"param_stamm_fahrgestellnummer",value:r.stamm_fahrgestellnummer||"",onChange:a,placeholder:"z.B. WVWZZZ..."}),e.jsx(Q,{label:"Erstzulassung",name:"param_stamm_erstzulassung",type:"date",value:r.stamm_erstzulassung||"",onChange:a}),e.jsx(Q,{label:"Garantie Batterie (km)",name:"param_stamm_garantie_batterie_km",type:"number",value:r.stamm_garantie_batterie_km||"",onChange:a,placeholder:"z.B. 160000"})]}),(t==="waermepumpe"||t==="e-auto")&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Frderung Aktenzeichen",name:"param_stamm_foerderung_aktenzeichen",value:r.stamm_foerderung_aktenzeichen||"",onChange:a,placeholder:"z.B. BAFA-2024-12345"}),e.jsx(Q,{label:"Frderbetrag ()",name:"param_stamm_foerderung_betrag_euro",type:"number",value:r.stamm_foerderung_betrag_euro||"",onChange:a,placeholder:"z.B. 5000"})]}),t==="balkonkraftwerk"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"Anmeldung Netzbetreiber",name:"param_stamm_anmeldung_netzbetreiber",type:"date",value:r.stamm_anmeldung_netzbetreiber||"",onChange:a}),e.jsx(Q,{label:"Anmeldung MaStR",name:"param_stamm_anmeldung_marktstammdaten",type:"date",value:r.stamm_anmeldung_marktstammdaten||"",onChange:a})]})]}),e.jsx("div",{children:e.jsx(Q,{label:"Notizen",name:"param_stamm_notizen",value:r.stamm_notizen||"",onChange:a,placeholder:"Optionale Anmerkungen zu diesem Gert..."})})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>l(!i),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(Mr,{className:"w-4 h-4 text-gray-500"}):e.jsx(Yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ansprechpartner"}),g&&!Vg(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",o,")"]})]})}),i&&e.jsxs("div",{className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder bernehmen automatisch die Werte von ",o,". Nur bei Abweichung ausfllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Firma",name:"param_ansprechpartner_firma",value:r.ansprechpartner_firma||"",onChange:a,placeholder:s?`(${o})`:"z.B. Solar Mustermann GmbH"}),e.jsx(Q,{label:"Name",name:"param_ansprechpartner_name",value:r.ansprechpartner_name||"",onChange:a,placeholder:"Kontaktperson"}),e.jsx(Q,{label:"Telefon",name:"param_ansprechpartner_telefon",value:r.ansprechpartner_telefon||"",onChange:a,placeholder:"+49 123 456789"}),e.jsx(Q,{label:"E-Mail",name:"param_ansprechpartner_email",type:"email",value:r.ansprechpartner_email||"",onChange:a,placeholder:"service@beispiel.de"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Q,{label:"Ticketsystem / Support-Portal",name:"param_ansprechpartner_ticketsystem",value:r.ansprechpartner_ticketsystem||"",onChange:a,placeholder:"https://support.beispiel.de"}),r.ansprechpartner_ticketsystem&&e.jsxs("a",{href:r.ansprechpartner_ticketsystem,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qr,{className:"w-3 h-3"}),"Portal ffnen"]})]}),e.jsx(Q,{label:"Kundennummer",name:"param_ansprechpartner_kundennummer",value:r.ansprechpartner_kundennummer||"",onChange:a,placeholder:"z.B. K-12345"}),e.jsx(Q,{label:"Vertragsnummer",name:"param_ansprechpartner_vertragsnummer",value:r.ansprechpartner_vertragsnummer||"",onChange:a,placeholder:"z.B. V-2024-001"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(Q,{label:"Notizen",name:"param_ansprechpartner_notizen",value:r.ansprechpartner_notizen||"",onChange:a,placeholder:"Optionale Anmerkungen..."})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>h(!c),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx(Mr,{className:"w-4 h-4 text-gray-500"}):e.jsx(Yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wartungsvertrag"}),g&&!Bg(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",o,")"]})]})}),c&&e.jsxs("div",{className:"p-4 space-y-4",children:[g&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder bernehmen automatisch die Werte von ",o,". Nur bei Abweichung ausfllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Vertragsnummer",name:"param_wartung_vertragsnummer",value:r.wartung_vertragsnummer||"",onChange:a,placeholder:"z.B. WV-2024-001"}),e.jsx(Q,{label:"Anbieter",name:"param_wartung_anbieter",value:r.wartung_anbieter||"",onChange:a,placeholder:"z.B. Solar Mustermann GmbH"}),e.jsx(Q,{label:"Gltig bis",name:"param_wartung_gueltig_bis",type:"date",value:r.wartung_gueltig_bis||"",onChange:a}),e.jsx(Q,{label:"Kndigungsfrist",name:"param_wartung_kuendigungsfrist",value:r.wartung_kuendigungsfrist||"",onChange:a,placeholder:"z.B. 3 Monate zum Jahresende"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(Q,{label:"Leistungsumfang",name:"param_wartung_leistungsumfang",value:r.wartung_leistungsumfang||"",onChange:a,placeholder:"z.B. Jhrliche Inspektion, Reinigung, Fernberwachung"})})]})]})]})]})}function Vg(t){return["ansprechpartner_firma","ansprechpartner_name","ansprechpartner_telefon","ansprechpartner_email","ansprechpartner_ticketsystem","ansprechpartner_kundennummer","ansprechpartner_vertragsnummer","ansprechpartner_notizen"].some(a=>t[a]&&String(t[a]).trim()!=="")}function Bg(t){return["wartung_vertragsnummer","wartung_anbieter","wartung_gueltig_bis","wartung_kuendigungsfrist","wartung_leistungsumfang"].some(a=>t[a]&&String(t[a]).trim()!=="")}const Og={"pv-module":"wechselrichter",speicher:"wechselrichter"},Rg=["pv-module"],Ws={wechselrichter:"Wechselrichter"},Jn={"e-auto":"E-Auto",waermepumpe:"Wrmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},Tg={"e-auto":"Kosten eines vergleichbaren Verbrenners (fr ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/lheizung (fr ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function Kg({investition:t,anlageId:r,typ:a,anlage:s,onSubmit:n,onCancel:i}){var C,D,A,S,W,N;const[l,c]=m.useState(!1),[h,g]=m.useState(null),[o,x]=m.useState([]),[u,d]=m.useState(!1),[p,b]=m.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${Jn[a]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((C=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:C.toString())||"",anschaffungskosten_alternativ:((D=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:D.toString())||"",betriebskosten_jahr:((A=t==null?void 0:t.betriebskosten_jahr)==null?void 0:A.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,parent_investition_id:((S=t==null?void 0:t.parent_investition_id)==null?void 0:S.toString())||"",leistung_kwp:((W=t==null?void 0:t.leistung_kwp)==null?void 0:W.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"Sd",neigung_grad:((N=t==null?void 0:t.neigung_grad)==null?void 0:N.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""}),j=Og[a],f=Rg.includes(a);m.useEffect(()=>{j&&(d(!0),tt.list(r,j,!0).then(z=>x(z.filter($=>$.id!==(t==null?void 0:t.id)))).catch(()=>x([])).finally(()=>d(!1)))},[j,r,t==null?void 0:t.id]);const y=(t==null?void 0:t.parameter)||{},k=()=>{var z,$,T,I,V,G,Z,R,M,H,K,O,ee,de,ue,Me,Ae,Be,ne,Ee,ie,q,J,Ie,ye,re,xe,U,pe;return{stamm_hersteller:((z=y.stamm_hersteller)==null?void 0:z.toString())||"",stamm_modell:(($=y.stamm_modell)==null?void 0:$.toString())||"",stamm_seriennummer:((T=y.stamm_seriennummer)==null?void 0:T.toString())||"",stamm_garantie_bis:((I=y.stamm_garantie_bis)==null?void 0:I.toString())||"",stamm_notizen:((V=y.stamm_notizen)==null?void 0:V.toString())||"",stamm_mastr_id:((G=y.stamm_mastr_id)==null?void 0:G.toString())||"",stamm_garantie_zyklen:((Z=y.stamm_garantie_zyklen)==null?void 0:Z.toString())||"",stamm_garantie_leistung_prozent:((R=y.stamm_garantie_leistung_prozent)==null?void 0:R.toString())||"",stamm_kennzeichen:((M=y.stamm_kennzeichen)==null?void 0:M.toString())||"",stamm_fahrgestellnummer:((H=y.stamm_fahrgestellnummer)==null?void 0:H.toString())||"",stamm_erstzulassung:((K=y.stamm_erstzulassung)==null?void 0:K.toString())||"",stamm_garantie_batterie_km:((O=y.stamm_garantie_batterie_km)==null?void 0:O.toString())||"",stamm_foerderung_aktenzeichen:((ee=y.stamm_foerderung_aktenzeichen)==null?void 0:ee.toString())||"",stamm_foerderung_betrag_euro:((de=y.stamm_foerderung_betrag_euro)==null?void 0:de.toString())||"",stamm_anmeldung_netzbetreiber:((ue=y.stamm_anmeldung_netzbetreiber)==null?void 0:ue.toString())||"",stamm_anmeldung_marktstammdaten:((Me=y.stamm_anmeldung_marktstammdaten)==null?void 0:Me.toString())||"",ansprechpartner_firma:((Ae=y.ansprechpartner_firma)==null?void 0:Ae.toString())||"",ansprechpartner_name:((Be=y.ansprechpartner_name)==null?void 0:Be.toString())||"",ansprechpartner_telefon:((ne=y.ansprechpartner_telefon)==null?void 0:ne.toString())||"",ansprechpartner_email:((Ee=y.ansprechpartner_email)==null?void 0:Ee.toString())||"",ansprechpartner_ticketsystem:((ie=y.ansprechpartner_ticketsystem)==null?void 0:ie.toString())||"",ansprechpartner_kundennummer:((q=y.ansprechpartner_kundennummer)==null?void 0:q.toString())||"",ansprechpartner_vertragsnummer:((J=y.ansprechpartner_vertragsnummer)==null?void 0:J.toString())||"",ansprechpartner_notizen:((Ie=y.ansprechpartner_notizen)==null?void 0:Ie.toString())||"",wartung_vertragsnummer:((ye=y.wartung_vertragsnummer)==null?void 0:ye.toString())||"",wartung_anbieter:((re=y.wartung_anbieter)==null?void 0:re.toString())||"",wartung_gueltig_bis:((xe=y.wartung_gueltig_bis)==null?void 0:xe.toString())||"",wartung_kuendigungsfrist:((U=y.wartung_kuendigungsfrist)==null?void 0:U.toString())||"",wartung_leistungsumfang:((pe=y.wartung_leistungsumfang)==null?void 0:pe.toString())||""}},_=()=>{var $,T,I,V,G,Z,R,M,H,K,O,ee,de,ue,Me,Ae,Be,ne,Ee,ie,q,J,Ie,ye,re,xe,U,pe,Oe,B,le,We,$e,Re,xt,Ea,_s,Gl;const z=k();switch(a){case"e-auto":return{...z,batteriekapazitaet_kwh:(($=y.batteriekapazitaet_kwh)==null?void 0:$.toString())||"",verbrauch_kwh_100km:((T=y.verbrauch_kwh_100km)==null?void 0:T.toString())||"18",jahresfahrleistung_km:((I=y.jahresfahrleistung_km)==null?void 0:I.toString())||"15000",pv_ladeanteil_prozent:((V=y.pv_ladeanteil_prozent)==null?void 0:V.toString())||"60",vergleich_verbrauch_l_100km:((G=y.vergleich_verbrauch_l_100km)==null?void 0:G.toString())||"7.5",benzinpreis_euro:((Z=y.benzinpreis_euro)==null?void 0:Z.toString())||"1.65",v2h_faehig:y.v2h_faehig??!1,v2h_entladeleistung_kw:((R=y.v2h_entladeleistung_kw)==null?void 0:R.toString())||"",ist_dienstlich:y.ist_dienstlich??!1};case"speicher":return{...z,kapazitaet_kwh:((M=y.kapazitaet_kwh)==null?void 0:M.toString())||"",nutzbare_kapazitaet_kwh:((H=y.nutzbare_kapazitaet_kwh)==null?void 0:H.toString())||"",max_ladeleistung_kw:((K=y.max_ladeleistung_kw)==null?void 0:K.toString())||"",max_entladeleistung_kw:((O=y.max_entladeleistung_kw)==null?void 0:O.toString())||"",wirkungsgrad_prozent:((ee=y.wirkungsgrad_prozent)==null?void 0:ee.toString())||"95",arbitrage_faehig:y.arbitrage_faehig??!1};case"waermepumpe":return{...z,leistung_kw:((de=y.leistung_kw)==null?void 0:de.toString())||"",effizienz_modus:((ue=y.effizienz_modus)==null?void 0:ue.toString())||"gesamt_jaz",jaz:((Me=y.jaz)==null?void 0:Me.toString())||"3.5",scop_heizung:((Ae=y.scop_heizung)==null?void 0:Ae.toString())||"4.5",scop_warmwasser:((Be=y.scop_warmwasser)==null?void 0:Be.toString())||"3.2",vorlauftemperatur:((ne=y.vorlauftemperatur)==null?void 0:ne.toString())||"35",cop_heizung:((Ee=y.cop_heizung)==null?void 0:Ee.toString())||"3.9",cop_warmwasser:((ie=y.cop_warmwasser)==null?void 0:ie.toString())||"3.0",heizwaermebedarf_kwh:((q=y.heizwaermebedarf_kwh)==null?void 0:q.toString())||"12000",warmwasserbedarf_kwh:((J=y.warmwasserbedarf_kwh)==null?void 0:J.toString())||"3000",pv_anteil_prozent:((Ie=y.pv_anteil_prozent)==null?void 0:Ie.toString())||"30",alter_energietraeger:((ye=y.alter_energietraeger)==null?void 0:ye.toString())||"gas",alter_preis_cent_kwh:((re=y.alter_preis_cent_kwh)==null?void 0:re.toString())||"12",sg_ready:y.sg_ready??!1};case"wallbox":return{...z,max_ladeleistung_kw:((xe=y.max_ladeleistung_kw)==null?void 0:xe.toString())||"11",bidirektional:y.bidirektional??!1,pv_optimiert:y.pv_optimiert??!0,ist_dienstlich:y.ist_dienstlich??!1};case"wechselrichter":return{...z,max_leistung_kw:((U=y.max_leistung_kw)==null?void 0:U.toString())||"",wirkungsgrad_prozent:((pe=y.wirkungsgrad_prozent)==null?void 0:pe.toString())||"97",hybrid:y.hybrid??!1};case"pv-module":return{...z,anzahl_module:((Oe=y.anzahl_module)==null?void 0:Oe.toString())||"",modul_leistung_wp:((B=y.modul_leistung_wp)==null?void 0:B.toString())||"",modul_typ:((le=y.modul_typ)==null?void 0:le.toString())||""};case"balkonkraftwerk":return{...z,leistung_wp:((We=y.leistung_wp)==null?void 0:We.toString())||"",anzahl:(($e=y.anzahl)==null?void 0:$e.toString())||"2",ausrichtung:((Re=y.ausrichtung)==null?void 0:Re.toString())||"Sd",neigung_grad:((xt=y.neigung_grad)==null?void 0:xt.toString())||"30",hat_speicher:y.hat_speicher??!1,speicher_kapazitaet_wh:((Ea=y.speicher_kapazitaet_wh)==null?void 0:Ea.toString())||""};case"sonstiges":return{...z,kategorie:((_s=y.kategorie)==null?void 0:_s.toString())||"erzeuger",beschreibung:((Gl=y.beschreibung)==null?void 0:Gl.toString())||""};default:return z}},[w,v]=m.useState(_),E=z=>{const{name:$,value:T,type:I,checked:V}=z.target;if($.startsWith("param_")){const G=$.replace("param_","");v(Z=>({...Z,[G]:I==="checkbox"?V:T}))}else b(G=>({...G,[$]:I==="checkbox"?V:T}))},F=async z=>{if(z.preventDefault(),g(null),!p.bezeichnung.trim()){g("Bitte eine Bezeichnung eingeben");return}try{c(!0);const $=["stamm_garantie_bis","stamm_erstzulassung","wartung_gueltig_bis","stamm_anmeldung_netzbetreiber","stamm_anmeldung_marktstammdaten"],T={};if(Object.entries(w).forEach(([R,M])=>{if(typeof M=="boolean")T[R]=M;else if(M!=="")if($.includes(R))T[R]=M;else{const H=parseFloat(M);T[R]=isNaN(H)?M:H}}),f&&o.length>0&&!p.parent_investition_id){g(`${Jn[a]} mssen einem ${Ws[j]||j} zugeordnet werden`);return}let I,V,G;if(a==="balkonkraftwerk"){const R=parseInt(w.anzahl)||0,M=parseInt(w.leistung_wp)||0;R>0&&M>0&&(I=R*M/1e3),V=w.ausrichtung||void 0,G=w.neigung_grad?parseFloat(w.neigung_grad):void 0}const Z={...t?{}:{anlage_id:r,typ:a},bezeichnung:p.bezeichnung.trim(),anschaffungsdatum:p.anschaffungsdatum||void 0,anschaffungskosten_gesamt:p.anschaffungskosten_gesamt?parseFloat(p.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:p.anschaffungskosten_alternativ?parseFloat(p.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:p.betriebskosten_jahr?parseFloat(p.betriebskosten_jahr):void 0,aktiv:p.aktiv,parameter:Object.keys(T).length>0?T:void 0,parent_investition_id:p.parent_investition_id?parseInt(p.parent_investition_id):void 0,...a==="pv-module"&&{leistung_kwp:p.leistung_kwp?parseFloat(p.leistung_kwp):void 0,ausrichtung:p.ausrichtung||void 0,neigung_grad:p.neigung_grad?parseFloat(p.neigung_grad):void 0,ha_entity_id:p.ha_entity_id||void 0},...a==="balkonkraftwerk"&&{leistung_kwp:I,ausrichtung:V,neigung_grad:G}};await n(Z)}catch($){g($ instanceof Error?$.message:"Fehler beim Speichern")}finally{c(!1)}};return e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[h&&e.jsx(te,{type:"error",children:h}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Bezeichnung",name:"bezeichnung",value:p.bezeichnung,onChange:E,required:!0}),e.jsx(Q,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:p.anschaffungsdatum,onChange:E}),e.jsx(Q,{label:"Anschaffungskosten ()",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:p.anschaffungskosten_gesamt,onChange:E,hint:"Gesamtkosten inkl. Installation"}),e.jsx(Q,{label:"Alternative Kosten ()",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:p.anschaffungskosten_alternativ,onChange:E,hint:Tg[a]}),e.jsx(Q,{label:"Betriebskosten/Jahr ()",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:p.betriebskosten_jahr,onChange:E,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:p.aktiv,onChange:E,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen bercksichtigen)"})]})]}),j&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehrt zu (",Ws[j]||j,")",f?" *":" (optional)",u&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),o.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:p.parent_investition_id,onChange:z=>b($=>({...$,parent_investition_id:z.target.value})),className:`input w-full ${f&&!p.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:f,children:[e.jsx("option",{value:"",children:f?"-- Bitte whlen --":"-- Keine Zuordnung --"}),o.map(z=>e.jsx("option",{value:z.id,children:z.bezeichnung},z.id))]}),f&&!p.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(ct,{className:"w-4 h-4"}),a==="pv-module"?"PV-Module mssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):u?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 flex-shrink-0"}),f?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:Ws[j]||j})," an, bevor Sie ",Jn[a]," erstellen knnen."]}):e.jsxs("span",{children:["Kein ",Ws[j]||j," vorhanden. Zuordnung ist optional."]})]})})]})]}),a==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:p.leistung_kwp,onChange:E,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:p.ausrichtung,onChange:z=>b($=>({...$,ausrichtung:z.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Sd",children:"Sd (0)"}),e.jsx("option",{value:"Sdost",children:"Sdost (-45)"}),e.jsx("option",{value:"Ost",children:"Ost (-90)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135)"}),e.jsx("option",{value:"Nord",children:"Nord (180)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135)"}),e.jsx("option",{value:"West",children:"West (90)"}),e.jsx("option",{value:"Sdwest",children:"Sdwest (45)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(Q,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:p.neigung_grad,onChange:E,hint:"0 = flach, 90 = senkrecht"})]})]}),e.jsx(Hg,{typ:a,paramData:w,onChange:E}),e.jsx(Ig,{typ:a,paramData:w,onChange:E,anlage:s,hasParent:!!p.parent_investition_id}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(se,{type:"button",variant:"secondary",onClick:i,children:"Abbrechen"}),e.jsx(se,{type:"submit",loading:l,children:t?"Speichern":"Erstellen"})]})]})}function Hg({typ:t,paramData:r,onChange:a}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Batteriekapazitt (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.batteriekapazitaet_kwh,onChange:a}),e.jsx(Q,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:r.verbrauch_kwh_100km,onChange:a}),e.jsx(Q,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:r.jahresfahrleistung_km,onChange:a}),e.jsx(Q,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_ladeanteil_prozent,onChange:a,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:r.vergleich_verbrauch_l_100km,onChange:a,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(Q,{label:"Benzinpreis (/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:r.benzinpreis_euro,onChange:a,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:r.v2h_faehig,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fhig (Vehicle-to-Home)"})]}),r.v2h_faehig&&e.jsx(Q,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.v2h_entladeleistung_kw,onChange:a}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",name:"param_ist_dienstlich",checked:r.ist_dienstlich,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Firmenwagen (dienstlich  kein Benzinvergleich im ROI)"})]}),r.ist_dienstlich&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 ml-6 -mt-1",children:'Die Kraftstoffersparnis geht an den Arbeitgeber. ROI-Berechnung: nur PV-Eigenverbrauchsvorteil und AG-Erstattung (als "Sonstiger Ertrag" im Monatsabschluss erfassen).'})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Kapazitt (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.kapazitaet_kwh,onChange:a}),e.jsx(Q,{label:"Nutzbare Kapazitt (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.nutzbare_kapazitaet_kwh,onChange:a,hint:"Typisch 90-95% der Gesamtkapazitt"}),e.jsx(Q,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:a}),e.jsx(Q,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_entladeleistung_kw,onChange:a}),e.jsx(Q,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:r.arbitrage_faehig,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fhig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":{const n=r.effizienz_modus;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wrmepumpe Parameter"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Berechnungsmodus fr Effizienz"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"gesamt_jaz",checked:n==="gesamt_jaz",onChange:a,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Jahresarbeitszahl (JAZ) - Gemessen vor Ort"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"scop",checked:n==="scop",onChange:a,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"SCOP (EU-Energielabel) - Aus Datenblatt"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"getrennte_cops",checked:n==="getrennte_cops",onChange:a,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Getrennte COPs (Heizung/Warmwasser)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n==="getrennte_cops"?"Separate COPs fr Heizung (~3,9) und Warmwasser (~3,0) - prziser bei unterschiedlichen Betriebspunkten":n==="scop"?"EU-genormter SCOP vom Energielabel - realistischer als Hersteller-COP, aber standortunabhngig":"Gemessene Jahresarbeitszahl am eigenen Standort - der genaueste Wert, wenn verfgbar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:r.leistung_kw,onChange:a,hint:"Thermische Leistung"}),n==="gesamt_jaz"&&e.jsx(Q,{label:"Jahresarbeitszahl (JAZ)",name:"param_jaz",type:"number",step:"0.1",min:"1",max:"10",value:r.jaz,onChange:a,hint:"Typisch 3-4 fr Luft-WP, 4-5 fr Sole-WP",required:!0}),n==="scop"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"SCOP Heizung",name:"param_scop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.scop_heizung,onChange:a,hint:"Vom EU-Energielabel (z.B. 4,5)",required:!0}),e.jsx(Q,{label:"SCOP Warmwasser",name:"param_scop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.scop_warmwasser,onChange:a,hint:"Typisch 2,8-3,5",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vorlauftemperatur (EU-Label)"}),e.jsxs("select",{name:"param_vorlauftemperatur",value:r.vorlauftemperatur,onChange:i=>a({target:{name:"param_vorlauftemperatur",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"35",children:"35C (Fubodenheizung)"}),e.jsx("option",{value:"55",children:"55C (Heizkrper)"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SCOP-Wert muss zur Vorlauftemperatur passen"})]})]}),n==="getrennte_cops"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{label:"COP Heizung",name:"param_cop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_heizung,onChange:a,hint:"Typisch 3,5-4,5 (Vorlauf 35C)",required:!0}),e.jsx(Q,{label:"COP Warmwasser",name:"param_cop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_warmwasser,onChange:a,hint:"Typisch 2,5-3,5 (Vorlauf 55C)",required:!0})]}),e.jsx(Q,{label:"Heizwrmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:r.heizwaermebedarf_kwh,onChange:a,hint:"Aus Energieausweis oder Schtzung"}),e.jsx(Q,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:r.warmwasserbedarf_kwh,onChange:a,hint:"~500 kWh/Person/Jahr typisch"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Vergleich mit alter Heizung (fr ROI-Berechnung)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Alter Energietrger"}),e.jsxs("select",{name:"param_alter_energietraeger",value:r.alter_energietraeger,onChange:i=>a({target:{name:"param_alter_energietraeger",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"gas",children:"Erdgas"}),e.jsx("option",{value:"oel",children:"Heizl"}),e.jsx("option",{value:"strom",children:"Strom (Direktheizung)"})]})]}),e.jsx(Q,{label:"Alter Preis (ct/kWh)",name:"param_alter_preis_cent_kwh",type:"number",step:"0.1",min:"0",value:r.alter_preis_cent_kwh,onChange:a,hint:"Gas ~12 ct, l ~10 ct"}),e.jsx(Q,{label:"PV-Anteil (%)",name:"param_pv_anteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_anteil_prozent,onChange:a,hint:"Anteil des WP-Stroms aus PV"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:r.sg_ready,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fhig)"})]})]})}case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(Q,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:a,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:r.bidirektional,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:r.pv_optimiert,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-berschussladen mglich"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_ist_dienstlich",checked:r.ist_dienstlich,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Ausschlielich dienstliches Laden (Firmenwagen)"})]}),r.ist_dienstlich&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 ml-6 -mt-1",children:'ROI-Berechnung: Netzkosten + entgangene Einspeisung als Ausgaben. Ertrge (z. B. AG-Erstattung) als "Sonstige Ertrge" im Monatsabschluss erfassen. Fr gemischte Nutzung (privat + dienstlich): zwei separate Wallbox-Eintrge anlegen.'})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:r.max_leistung_kw,onChange:a}),e.jsx(Q,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:r.hybrid,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:r.anzahl_module,onChange:a,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(Q,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:r.modul_leistung_wp,onChange:a,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(Q,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:r.modul_typ,onChange:a,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),r.anzahl_module&&r.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(r.anzahl_module)||0)*(parseInt(r.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const s=(parseInt(r.anzahl)||0)*(parseInt(r.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:r.anzahl,onChange:a}),e.jsx(Q,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:r.leistung_wp,onChange:a,hint:s>0?`= ${s.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:r.ausrichtung,onChange:n=>a({target:{name:"param_ausrichtung",value:n.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"Sd",children:"Sd (0)"}),e.jsx("option",{value:"Sdost",children:"Sdost (-45)"}),e.jsx("option",{value:"Ost",children:"Ost (-90)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135)"}),e.jsx("option",{value:"Nord",children:"Nord (180)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135)"}),e.jsx("option",{value:"West",children:"West (90)"}),e.jsx("option",{value:"Sdwest",children:"Sdwest (45)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(Q,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:r.neigung_grad,onChange:a,hint:"0 = flach, 90 = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:r.hat_speicher,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),r.hat_speicher&&e.jsx(Q,{label:"Speicher-Kapazitt (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:r.speicher_kapazitaet_wh,onChange:a,hint:"z.B. 1600 Wh fr Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:r.kategorie,onChange:n=>a({target:{name:"param_kategorie",value:n.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(Q,{label:"Beschreibung",name:"param_beschreibung",value:r.beschreibung,onChange:a,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const qn=[{typ:"e-auto",label:"E-Auto",icon:Te,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wrmepumpe",icon:et,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:Ce,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:Ht,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:Vr,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:ce,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:Vo,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:Vr,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function Gg(){var A;const{anlagen:t,loading:r}=it(),[a,s]=m.useState(null),[n,i]=m.useState(!1),[l,c]=m.useState(null),[h,g]=m.useState(null),[o,x]=m.useState(null),[u,d]=m.useState(null),p=a??((A=t[0])==null?void 0:A.id),b=t.find(S=>S.id===p)??null,{investitionen:j,loading:f,createInvestition:y,updateInvestition:k,deleteInvestition:_}=us(p),w=Ph(j),v=m.useMemo(()=>{const S={};return qn.forEach(W=>{var N;S[W.typ]=((N=w[W.typ])==null?void 0:N.length)||0}),S},[w]),E=S=>{g(S),c(null),i(!0)},F=S=>{c(S),g(S.typ),i(!0)},C=async S=>{try{l?await k(l.id,S):await y(S),i(!1),c(null),g(null)}catch(W){d(W instanceof Error?W.message:"Fehler beim Speichern")}},D=async()=>{if(o)try{await _(o.id),x(null)}catch(S){d(S instanceof Error?S.message:"Fehler beim Lschen")}};return r||f?e.jsx(Se,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:p??"",onChange:S=>s(Number(S.target.value)),className:"input w-auto",children:t.map(S=>e.jsx("option",{value:S.id,children:S.anlagenname},S.id))})})]}),u&&e.jsx(te,{type:"error",onClose:()=>d(null),children:u}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:qn.map(S=>e.jsxs("button",{onClick:()=>E(S.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${S.bgColor}`,children:[e.jsx(S.icon,{className:`h-8 w-8 mx-auto ${S.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:S.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[v[S.typ]," vorhanden"]})]},S.typ))}),j.length===0?e.jsx(ka,{icon:ta,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wrmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(se,{onClick:()=>E("speicher"),children:[e.jsx(Wr,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:qn.map(S=>{const W=w[S.typ];return!W||W.length===0?null:e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${S.bgColor}`,children:e.jsx(S.icon,{className:`h-5 w-5 ${S.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:S.label})]}),e.jsx(se,{variant:"secondary",size:"sm",onClick:()=>E(S.typ),children:e.jsx(Wr,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:W.map(N=>e.jsx(Zg,{investition:N,onEdit:()=>F(N),onDelete:()=>x(N)},N.id))})]},S.typ)})}),e.jsx(Dt,{isOpen:n,onClose:()=>{i(!1),c(null),g(null)},title:l?"Investition bearbeiten":"Neue Investition",size:"lg",children:h&&p&&e.jsx(Kg,{investition:l,anlageId:p,typ:h,anlage:b,onSubmit:C,onCancel:()=>{i(!1),c(null),g(null)}})}),e.jsxs(Dt,{isOpen:!!o,onClose:()=>x(null),title:"Investition lschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Mchtest du die Investition "',o==null?void 0:o.bezeichnung,'" wirklich lschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(se,{variant:"secondary",onClick:()=>x(null),children:"Abbrechen"}),e.jsx(se,{variant:"danger",onClick:D,children:"Lschen"})]})]})]})}function Zg({investition:t,onEdit:r,onDelete:a}){const s=t.parameter||{},i=(()=>{const c=[];switch(t.typ){case"e-auto":s.batteriekapazitaet_kwh&&c.push(`${s.batteriekapazitaet_kwh} kWh Batterie`),s.verbrauch_kwh_100km&&c.push(`${s.verbrauch_kwh_100km} kWh/100km`),s.v2h_faehig&&c.push("V2H fhig");break;case"speicher":s.kapazitaet_kwh&&c.push(`${s.kapazitaet_kwh} kWh`),s.nutzbare_kapazitaet_kwh&&c.push(`${s.nutzbare_kapazitaet_kwh} kWh nutzbar`),s.arbitrage_faehig&&c.push("Arbitrage");break;case"waermepumpe":s.leistung_kw&&c.push(`${s.leistung_kw} kW`),s.cop&&c.push(`COP ${s.cop}`);break;case"wallbox":s.max_ladeleistung_kw&&c.push(`${s.max_ladeleistung_kw} kW`),s.bidirektional&&c.push("Bidirektional");break;case"wechselrichter":s.max_leistung_kw&&c.push(`${s.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":s.leistung_wp&&c.push(`${s.leistung_wp} Wp`),s.anzahl&&c.push(`${s.anzahl} Module`);break}return c})(),l=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join("  ")}),l&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[l.toLocaleString("de-DE")," "]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(lh,{className:"h-4 w-4"})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Lschen",children:e.jsx(Mt,{className:"h-4 w-4"})})]})]})}const Jg=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"Mrz"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function b0({monatsdaten:t,anlageId:r,onSubmit:a,onCancel:s,haVorausfuellung:n}){var K,O,ee,de,ue,Me,Ae,Be,ne,Ee,ie;const i=new Date().getFullYear(),l=new Date().getMonth()+1,[c,h]=m.useState(!1),[g,o]=m.useState(null),{investitionen:x,loading:u}=us(r),d=m.useMemo(()=>x.filter(q=>q.aktiv),[x]),p=d.some(q=>q.typ==="speicher"),b=d.some(q=>q.typ==="e-auto"),j=d.some(q=>q.typ==="wallbox"),f=d.some(q=>q.typ==="waermepumpe"),y=d.some(q=>q.typ==="wechselrichter"),k=d.some(q=>q.typ==="pv-module"),_=d.some(q=>q.typ==="balkonkraftwerk"),w=d.some(q=>q.typ==="sonstiges"),v=q=>{if(!n)return"";const J=n.basis.find(Ie=>Ie.feld===q);return(J==null?void 0:J.wert)!==null&&(J==null?void 0:J.wert)!==void 0?J.wert.toString():""},[E,F]=m.useState({jahr:((K=n==null?void 0:n.jahr)==null?void 0:K.toString())||((O=t==null?void 0:t.jahr)==null?void 0:O.toString())||i.toString(),monat:((ee=n==null?void 0:n.monat)==null?void 0:ee.toString())||((de=t==null?void 0:t.monat)==null?void 0:de.toString())||l.toString(),einspeisung_kwh:v("einspeisung")||((ue=t==null?void 0:t.einspeisung_kwh)==null?void 0:ue.toString())||"",netzbezug_kwh:v("netzbezug")||((Me=t==null?void 0:t.netzbezug_kwh)==null?void 0:Me.toString())||"",pv_erzeugung_kwh:((Ae=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:Ae.toString())||"",batterie_ladung_kwh:((Be=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:Be.toString())||"",batterie_entladung_kwh:((ne=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:ne.toString())||"",globalstrahlung_kwh_m2:((Ee=t==null?void 0:t.globalstrahlung_kwh_m2)==null?void 0:Ee.toString())||"",sonnenstunden:((ie=t==null?void 0:t.sonnenstunden)==null?void 0:ie.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[C,D]=m.useState(!1),[A,S]=m.useState(null),[W,N]=m.useState({}),[z,$]=m.useState({}),[T,I]=m.useState(!1);m.useEffect(()=>{if(d.length===0)return;(async()=>{const J={};d.forEach(ye=>{var re,xe;if(ye.typ==="e-auto")J[ye.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(ye.typ==="speicher")J[ye.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(ye.typ==="wallbox")J[ye.id]={ladung_kwh:"",ladevorgaenge:""};else if(ye.typ==="waermepumpe")J[ye.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(ye.typ==="wechselrichter")J[ye.id]={pv_erzeugung_kwh:""};else if(ye.typ==="pv-module")J[ye.id]={pv_erzeugung_kwh:""};else if(ye.typ==="balkonkraftwerk"){const U=(re=ye.parameter)==null?void 0:re.hat_speicher,pe={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};U?J[ye.id]={...pe,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:J[ye.id]=pe}else if(ye.typ==="sonstiges"){const U=((xe=ye.parameter)==null?void 0:xe.kategorie)||"erzeuger";U==="erzeuger"?J[ye.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:U==="verbraucher"?J[ye.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:U==="speicher"&&(J[ye.id]={ladung_kwh:"",entladung_kwh:""})}});const Ie={};if(t!=null&&t.jahr&&(t!=null&&t.monat)){I(!0);try{const ye=await tt.getMonatsdatenByMonth(r,t.jahr,t.monat);ye.forEach(Oe=>{const B=String(Oe.investition_id),le=Oe.verbrauch_daten;le!=null&&le.sonstige_positionen?Ie[B]=le.sonstige_positionen:le!=null&&le.sonderkosten_euro&&Number(le.sonderkosten_euro)>0&&(Ie[B]=[{bezeichnung:String(le.sonderkosten_notiz||"Sonderkosten (migriert)"),betrag:Number(le.sonderkosten_euro),typ:"ausgabe"}]),J[B]&&Oe.verbrauch_daten&&Object.entries(Oe.verbrauch_daten).forEach(([We,$e])=>{We==="sonstige_positionen"||We==="sonderkosten_euro"||We==="sonderkosten_notiz"||(J[B][We]!==void 0&&(J[B][We]=($e==null?void 0:$e.toString())||""),We==="v2h_entladung_kwh"&&J[B].entladung_v2h_kwh!==void 0&&(J[B].entladung_v2h_kwh=($e==null?void 0:$e.toString())||""),We==="erzeugung_kwh"&&J[B].pv_erzeugung_kwh!==void 0&&(J[B].pv_erzeugung_kwh=($e==null?void 0:$e.toString())||""),We==="verbrauch_kwh"&&J[B].verbrauch_sonstig_kwh!==void 0&&(J[B].verbrauch_sonstig_kwh=($e==null?void 0:$e.toString())||""))})});const re=d.filter(Oe=>Oe.typ==="speicher"),xe=new Set(ye.filter(Oe=>re.some(B=>B.id===Oe.investition_id)).map(Oe=>Oe.investition_id)),U=(t==null?void 0:t.batterie_ladung_kwh)||0,pe=(t==null?void 0:t.batterie_entladung_kwh)||0;if(re.length>0&&(U>0||pe>0)){const Oe=re.filter(B=>!xe.has(B.id));if(Oe.length>0){const B=1/Oe.length;Oe.forEach(le=>{const We=String(le.id);J[We]&&(J[We].ladung_kwh=(U*B).toFixed(1),J[We].entladung_kwh=(pe*B).toFixed(1))}),console.info(`Migration: Legacy-Speicherdaten (${U}/${pe} kWh) auf ${Oe.length} Speicher bertragen`)}}}catch(ye){console.error("Fehler beim Laden der InvestitionMonatsdaten:",ye)}finally{I(!1)}}n!=null&&n.investitionen&&(n.investitionen.forEach(ye=>{const re=String(ye.investition_id);J[re]&&ye.felder.forEach(({feld:xe,wert:U})=>{U!=null&&(J[re][xe]!==void 0&&(J[re][xe]=U.toString()),xe==="pv_erzeugung_kwh"&&J[re].pv_erzeugung_kwh!==void 0&&(J[re].pv_erzeugung_kwh=U.toString()),xe==="ladung_kwh"&&J[re].ladung_kwh!==void 0&&(J[re].ladung_kwh=U.toString()),xe==="entladung_kwh"&&J[re].entladung_kwh!==void 0&&(J[re].entladung_kwh=U.toString()),xe==="ladung_pv_kwh"&&J[re].ladung_pv_kwh!==void 0&&(J[re].ladung_pv_kwh=U.toString()),xe==="ladung_netz_kwh"&&J[re].ladung_netz_kwh!==void 0&&(J[re].ladung_netz_kwh=U.toString()),xe==="km_gefahren"&&J[re].km_gefahren!==void 0&&(J[re].km_gefahren=U.toString()))})}),console.info("HA-Vorausfllung: Investitionswerte aus HA-Statistik eingefgt")),N(J),Object.keys(Ie).length>0&&$(Ie)})()},[d,t==null?void 0:t.jahr,t==null?void 0:t.monat,r,n]);const V=q=>{const{name:J,value:Ie}=q.target;F(ye=>({...ye,[J]:Ie}))},G=(q,J,Ie)=>{N(ye=>({...ye,[q]:{...ye[q],[J]:Ie}}))},Z=(q,J)=>{$(Ie=>({...Ie,[String(q)]:J}))},R=m.useMemo(()=>{let q=0,J=0,Ie=0;return d.forEach(ye=>{var xe,U;const re=W[ye.id];re&&(ye.typ==="speicher"?(q+=parseFloat(re.ladung_kwh)||0,J+=parseFloat(re.entladung_kwh)||0):ye.typ==="pv-module"||ye.typ==="wechselrichter"||ye.typ==="balkonkraftwerk"?(Ie+=parseFloat(re.pv_erzeugung_kwh)||0,ye.typ==="balkonkraftwerk"&&((xe=ye.parameter)!=null&&xe.hat_speicher)&&(q+=parseFloat(re.speicher_ladung_kwh)||0,J+=parseFloat(re.speicher_entladung_kwh)||0)):ye.typ==="sonstiges"&&((U=ye.parameter)==null?void 0:U.kategorie)==="erzeuger"&&(Ie+=parseFloat(re.erzeugung_kwh)||0))}),{batterieLadung:q,batterieEntladung:J,pvErzeugung:Ie}},[d,W]),M=async()=>{if(!E.jahr||!E.monat){o("Bitte zuerst Jahr und Monat auswhlen");return}D(!0),S(null),o(null);try{const q=await Cn.getMonatsdaten(r,parseInt(E.jahr),parseInt(E.monat));F(Ie=>({...Ie,globalstrahlung_kwh_m2:q.globalstrahlung_kwh_m2.toString(),sonnenstunden:q.sonnenstunden.toString()}));const J=q.datenquelle==="open-meteo"?`Historische Daten von Open-Meteo${q.abdeckung_prozent?` (${q.abdeckung_prozent}% Abdeckung)`:""}`:q.datenquelle==="pvgis-tmy"?"Durchschnittswerte von PVGIS (TMY)":"Geschtzte Durchschnittswerte";S(J)}catch(q){o(q instanceof Error?q.message:"Wetterdaten konnten nicht abgerufen werden")}finally{D(!1)}},H=async q=>{if(q.preventDefault(),o(null),!E.einspeisung_kwh||!E.netzbezug_kwh){o("Bitte Einspeisung und Netzbezug eingeben");return}try{h(!0);const J={};d.forEach(xe=>{const U=W[xe.id];if(!U)return;const pe={};xe.typ==="e-auto"?(U.km_gefahren&&(pe.km_gefahren=parseFloat(U.km_gefahren)),U.verbrauch_kwh&&(pe.verbrauch_kwh=parseFloat(U.verbrauch_kwh)),U.ladung_pv_kwh&&(pe.ladung_pv_kwh=parseFloat(U.ladung_pv_kwh)),U.ladung_netz_kwh&&(pe.ladung_netz_kwh=parseFloat(U.ladung_netz_kwh)),U.ladung_extern_kwh&&(pe.ladung_extern_kwh=parseFloat(U.ladung_extern_kwh)),U.ladung_extern_euro&&(pe.ladung_extern_euro=parseFloat(U.ladung_extern_euro)),U.entladung_v2h_kwh&&(pe.v2h_entladung_kwh=parseFloat(U.entladung_v2h_kwh))):xe.typ==="speicher"?(U.ladung_kwh&&(pe.ladung_kwh=parseFloat(U.ladung_kwh)),U.entladung_kwh&&(pe.entladung_kwh=parseFloat(U.entladung_kwh)),U.speicher_ladung_netz_kwh&&(pe.speicher_ladung_netz_kwh=parseFloat(U.speicher_ladung_netz_kwh)),U.speicher_ladepreis_cent&&(pe.speicher_ladepreis_cent=parseFloat(U.speicher_ladepreis_cent))):xe.typ==="wallbox"?(U.ladung_kwh&&(pe.ladung_kwh=parseFloat(U.ladung_kwh)),U.ladevorgaenge&&(pe.ladevorgaenge=parseInt(U.ladevorgaenge))):xe.typ==="waermepumpe"?(U.stromverbrauch_kwh&&(pe.stromverbrauch_kwh=parseFloat(U.stromverbrauch_kwh)),U.heizenergie_kwh&&(pe.heizenergie_kwh=parseFloat(U.heizenergie_kwh)),U.warmwasser_kwh&&(pe.warmwasser_kwh=parseFloat(U.warmwasser_kwh))):xe.typ==="wechselrichter"||xe.typ==="pv-module"?U.pv_erzeugung_kwh&&(pe.pv_erzeugung_kwh=parseFloat(U.pv_erzeugung_kwh)):xe.typ==="balkonkraftwerk"?(U.pv_erzeugung_kwh&&(pe.erzeugung_kwh=parseFloat(U.pv_erzeugung_kwh)),U.eigenverbrauch_kwh&&(pe.eigenverbrauch_kwh=parseFloat(U.eigenverbrauch_kwh)),U.einspeisung_kwh&&(pe.einspeisung_kwh=parseFloat(U.einspeisung_kwh)),U.speicher_ladung_kwh&&(pe.speicher_ladung_kwh=parseFloat(U.speicher_ladung_kwh)),U.speicher_entladung_kwh&&(pe.speicher_entladung_kwh=parseFloat(U.speicher_entladung_kwh))):xe.typ==="sonstiges"&&(U.erzeugung_kwh&&(pe.erzeugung_kwh=parseFloat(U.erzeugung_kwh)),U.eigenverbrauch_kwh&&(pe.eigenverbrauch_kwh=parseFloat(U.eigenverbrauch_kwh)),U.einspeisung_kwh&&(pe.einspeisung_kwh=parseFloat(U.einspeisung_kwh)),U.verbrauch_sonstig_kwh&&(pe.verbrauch_kwh=parseFloat(U.verbrauch_sonstig_kwh)),U.bezug_pv_kwh&&(pe.bezug_pv_kwh=parseFloat(U.bezug_pv_kwh)),U.bezug_netz_kwh&&(pe.bezug_netz_kwh=parseFloat(U.bezug_netz_kwh)),U.ladung_kwh&&(pe.ladung_kwh=parseFloat(U.ladung_kwh)),U.entladung_kwh&&(pe.entladung_kwh=parseFloat(U.entladung_kwh)));const Oe=z[String(xe.id)];if(Oe&&Oe.length>0){const B=Oe.filter(le=>le.betrag>0&&le.bezeichnung.trim());B.length>0&&(pe.sonstige_positionen=B)}Object.keys(pe).length>0&&(J[xe.id]=pe)});const Ie=E.batterie_ladung_kwh?parseFloat(E.batterie_ladung_kwh):R.batterieLadung||void 0,ye=E.batterie_entladung_kwh?parseFloat(E.batterie_entladung_kwh):R.batterieEntladung||void 0,re=E.pv_erzeugung_kwh?parseFloat(E.pv_erzeugung_kwh):R.pvErzeugung||void 0;await a({anlage_id:r,jahr:parseInt(E.jahr),monat:parseInt(E.monat),einspeisung_kwh:parseFloat(E.einspeisung_kwh),netzbezug_kwh:parseFloat(E.netzbezug_kwh),pv_erzeugung_kwh:re,batterie_ladung_kwh:Ie,batterie_entladung_kwh:ye,globalstrahlung_kwh_m2:E.globalstrahlung_kwh_m2?parseFloat(E.globalstrahlung_kwh_m2):void 0,sonnenstunden:E.sonnenstunden?parseFloat(E.sonnenstunden):void 0,notizen:E.notizen||void 0,investitionen_daten:Object.keys(J).length>0?J:void 0})}catch(J){o(J instanceof Error?J.message:"Fehler beim Speichern")}finally{h(!1)}};return u||T?e.jsx("div",{className:"text-center py-4 text-gray-500",children:T?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[g&&e.jsx(te,{type:"error",children:g}),n&&e.jsx(te,{type:"info",children:"Die Werte wurden aus der Home Assistant Langzeitstatistik geladen. Bitte prfen Sie die Daten und ergnzen Sie fehlende Werte vor dem Speichern."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:E.jahr,onChange:V,required:!0,disabled:!!t||!!n}),e.jsx(Zt,{label:"Monat",name:"monat",value:E.monat,onChange:V,options:Jg,required:!0,disabled:!!t||!!n})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:E.einspeisung_kwh,onChange:V,placeholder:"z.B. 450",required:!0}),e.jsx(Q,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:E.netzbezug_kwh,onChange:V,placeholder:"z.B. 120",required:!0}),(k||y)&&R.pvErzeugung>0?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PV-Erzeugung (berechnet)"}),e.jsx("input",{type:"text",value:`${R.pvErzeugung.toFixed(1)} kWh`,readOnly:!0,disabled:!0,className:"input bg-gray-100 dark:bg-gray-800 cursor-not-allowed"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Aus ",k?"PV-Modulen":"Wechselrichtern",": ",R.pvErzeugung.toFixed(1)," kWh"]})]}):e.jsx(Q,{label:k||y?"PV-Erzeugung (aus Modulen unten)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:E.pv_erzeugung_kwh,onChange:V,placeholder:"z.B. 800",hint:k||y?"Wird aus PV-Modulen berechnet":"Manuell eingeben wenn keine PV-Module definiert"})]})]}),k&&e.jsx(Fs,{title:"PV-Module",icon:ce,iconColor:"text-yellow-500",investitionen:d.filter(q=>q.typ==="pv-module"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),y&&!k&&e.jsx(Fs,{title:"Wechselrichter",icon:ce,iconColor:"text-yellow-500",investitionen:d.filter(q=>q.typ==="wechselrichter"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),p&&e.jsxs(e.Fragment,{children:[e.jsx(qg,{investitionen:d.filter(q=>q.typ==="speicher"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z}),(R.batterieLadung>0||R.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",R.batterieLadung.toFixed(1)," kWh | Entladung ",R.batterieEntladung.toFixed(1)," kWh"]})]}),b&&e.jsx(Ug,{investitionen:d.filter(q=>q.typ==="e-auto"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z}),j&&e.jsx(Fs,{title:"Wallbox",icon:Ht,iconColor:"text-purple-500",investitionen:d.filter(q=>q.typ==="wallbox"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgnge",unit:"",placeholder:"z.B. 12"}]}),f&&e.jsx(Fs,{title:"Wrmepumpe",icon:et,iconColor:"text-orange-500",investitionen:d.filter(q=>q.typ==="waermepumpe"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),_&&e.jsx(Yg,{investitionen:d.filter(q=>q.typ==="balkonkraftwerk"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z}),w&&e.jsx(Xg,{investitionen:d.filter(q=>q.typ==="sonstiges"),investitionsDaten:W,onInvChange:G,sonstigePositionen:z,onPositionenChange:Z}),!p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:E.batterie_ladung_kwh,onChange:V,placeholder:"z.B. 150"}),e.jsx(Q,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:E.batterie_entladung_kwh,onChange:V,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ir,{className:"w-4 h-4"}),"Wetterdaten (optional)"]}),e.jsx(se,{type:"button",variant:"secondary",size:"sm",onClick:M,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 animate-spin mr-1"})," Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ir,{className:"w-4 h-4 mr-1"})," Auto-Fill"]})})]}),A&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-3 py-2 rounded",children:A}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Q,{label:"Globalstrahlung",name:"globalstrahlung_kwh_m2",type:"number",step:"0.1",min:"0",value:E.globalstrahlung_kwh_m2,onChange:V,placeholder:"z.B. 152",hint:"kWh/m"}),e.jsx(Q,{label:"Sonnenstunden",name:"sonnenstunden",type:"number",step:"0.1",min:"0",value:E.sonnenstunden,onChange:V,placeholder:"z.B. 245",hint:"Stunden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:E.notizen,onChange:V,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(se,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(se,{type:"submit",loading:c,children:t?"Speichern":"Monat erfassen"})]})]})}function qg({investitionen:t,investitionsDaten:r,onInvChange:a,sonstigePositionen:s,onPositionenChange:n}){if(t.length===0)return null;const i=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],l=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:" Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),t.map(c=>{var o;const g=((o=c.parameter)==null?void 0:o.arbitrage_faehig)?[...i,...l]:i;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:c.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:g.map(x=>{var u;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[x.label," ",x.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",x.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[c.id])==null?void 0:u[x.key])||"",onChange:d=>a(c.id,x.key,d.target.value),placeholder:x.placeholder,className:"input text-sm py-1.5",title:x.hint}),x.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:x.hint,children:x.hint})]},x.key)})}),e.jsx(ps,{invId:c.id,positionen:s[String(c.id)]||[],onChange:x=>n(c.id,x)})]},c.id)})]})}function Ug({investitionen:t,investitionsDaten:r,onInvChange:a,sonstigePositionen:s,onPositionenChange:n}){if(t.length===0)return null;const i=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"",placeholder:"z.B. 18.00"}],l={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),t.map(c=>{var o,x;const g=((o=c.parameter)==null?void 0:o.v2h_faehig)||((x=c.parameter)==null?void 0:x.nutzt_v2h)?[...i,l]:i;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:c.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:g.map(u=>{var d;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[u.label," ",u.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",u.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=r[c.id])==null?void 0:d[u.key])||"",onChange:p=>a(c.id,u.key,p.target.value),placeholder:u.placeholder,className:"input text-sm py-1.5",title:u.hint}),u.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:u.hint,children:u.hint})]},u.key)})}),e.jsx(ps,{invId:c.id,positionen:s[String(c.id)]||[],onChange:u=>n(c.id,u)})]},c.id)})]})}function Fs({title:t,icon:r,iconColor:a,investitionen:s,investitionsDaten:n,onInvChange:i,felder:l,sonstigePositionen:c,onPositionenChange:h}){return s.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`h-5 w-5 ${a}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),s.map(g=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:g.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:l.map(o=>{var x;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[o.label," ",o.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",o.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=n[g.id])==null?void 0:x[o.key])||"",onChange:u=>i(g.id,o.key,u.target.value),placeholder:o.placeholder,className:"input text-sm py-1.5",title:o.hint}),o.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:o.hint,children:o.hint})]},o.key)})}),e.jsx(ps,{invId:g.id,positionen:c[String(g.id)]||[],onChange:o=>h(g.id,o)})]},g.id))]})}function Yg({investitionen:t,investitionsDaten:r,onInvChange:a,sonstigePositionen:s,onPositionenChange:n}){return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),t.map(i=>{var c,h,g,o,x;const l=!!((c=i.parameter)!=null&&c.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[i.bezeichnung,i.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",i.leistung_kwp," kWp)"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:l?"Mit Speicher: Bei Nulleinspeisung entspricht Eigenverbrauch meist der Erzeugung.":"Ohne Speicher: Eigenverbrauch ist der direkt genutzte Anteil (typisch 30-40% der Erzeugung)."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[i.id])==null?void 0:h.pv_erzeugung_kwh)||"",onChange:u=>a(i.id,"pv_erzeugung_kwh",u.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=r[i.id])==null?void 0:g.eigenverbrauch_kwh)||"",onChange:u=>a(i.id,"eigenverbrauch_kwh",u.target.value),placeholder:l?"z.B. 43 (Erzeugung)":"z.B. 15 (30-40%)",className:"input text-sm py-1.5"})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=r[i.id])==null?void 0:o.speicher_ladung_kwh)||"",onChange:u=>a(i.id,"speicher_ladung_kwh",u.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[i.id])==null?void 0:x.speicher_entladung_kwh)||"",onChange:u=>a(i.id,"speicher_entladung_kwh",u.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(ps,{invId:i.id,positionen:s[String(i.id)]||[],onChange:u=>n(i.id,u)})]},i.id)})]})}function Xg({investitionen:t,investitionsDaten:r,onInvChange:a,sonstigePositionen:s,onPositionenChange:n}){if(t.length===0)return null;const i={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nh,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),t.map(l=>{var h,g,o,x,u,d,p,b,j,f;const c=((h=l.parameter)==null?void 0:h.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:l.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[i[c]||c,(g=l.parameter)!=null&&g.beschreibung?` - ${String(l.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[c==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=r[l.id])==null?void 0:o.erzeugung_kwh)||"",onChange:y=>a(l.id,"erzeugung_kwh",y.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[l.id])==null?void 0:x.eigenverbrauch_kwh)||"",onChange:y=>a(l.id,"eigenverbrauch_kwh",y.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[l.id])==null?void 0:u.einspeisung_kwh)||"",onChange:y=>a(l.id,"einspeisung_kwh",y.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),c==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=r[l.id])==null?void 0:d.verbrauch_sonstig_kwh)||"",onChange:y=>a(l.id,"verbrauch_sonstig_kwh",y.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=r[l.id])==null?void 0:p.bezug_pv_kwh)||"",onChange:y=>a(l.id,"bezug_pv_kwh",y.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((b=r[l.id])==null?void 0:b.bezug_netz_kwh)||"",onChange:y=>a(l.id,"bezug_netz_kwh",y.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),c==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((j=r[l.id])==null?void 0:j.ladung_kwh)||"",onChange:y=>a(l.id,"ladung_kwh",y.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((f=r[l.id])==null?void 0:f.entladung_kwh)||"",onChange:y=>a(l.id,"entladung_kwh",y.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(ps,{invId:l.id,positionen:s[String(l.id)]||[],onChange:y=>n(l.id,y)})]},l.id)})]})}function ps({positionen:t,onChange:r}){const[a,s]=m.useState(t.length>0),n=()=>{r([...t,{bezeichnung:"",betrag:0,typ:"ausgabe"}]),s(!0)},i=o=>{r(t.filter((x,u)=>u!==o))},l=(o,x,u)=>{const d=[...t];d[o]={...d[o],[x]:u},r(d)},c=t.filter(o=>o.typ==="ertrag").reduce((o,x)=>o+(x.betrag||0),0),h=t.filter(o=>o.typ==="ausgabe").reduce((o,x)=>o+(x.betrag||0),0),g=c-h;return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:!a&&t.length===0?e.jsx("button",{type:"button",onClick:n,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonstige Ertrge & Ausgaben erfassen"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Sonstige Ertrge & Ausgaben"}),e.jsx("button",{type:"button",onClick:n,className:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"+ Position"})]}),t.map((o,x)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsxs("div",{className:"col-span-5",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Bezeichnung"}),e.jsx("input",{type:"text",value:o.bezeichnung,onChange:u=>l(x,"bezeichnung",u.target.value),placeholder:"z.B. THG-Quote, Reparatur",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"col-span-3",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Betrag (EUR)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.betrag||"",onChange:u=>l(x,"betrag",parseFloat(u.target.value)||0),placeholder:"0.00",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"col-span-3",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Typ"}),e.jsxs("select",{value:o.typ,onChange:u=>l(x,"typ",u.target.value),className:"input text-sm py-1.5",title:"Typ: Ertrag oder Ausgabe",children:[e.jsx("option",{value:"ertrag",children:"Ertrag"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{className:"col-span-1 flex justify-center",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:""}),e.jsx("button",{type:"button",onClick:()=>i(x),className:"text-red-400 hover:text-red-600 dark:text-red-500 dark:hover:text-red-400 p-1 text-sm",title:"Position entfernen",children:""})]})]},x)),t.length>0&&e.jsxs("div",{className:"text-xs flex gap-3 pt-1",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Ertrge: ",c.toFixed(2)," "]}),e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Ausgaben: ",h.toFixed(2)," "]}),e.jsxs("span",{className:`font-medium ${g>=0?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:["Netto: ",g>=0?"+":"",g.toFixed(2)," "]})]})]})})}const f0=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],y0={zaehler:{label:"Zhlerwerte",color:"bg-blue-500"},komponenten:{label:"Komponenten",color:"bg-amber-500"},berechnet:{label:"Berechnungen",color:"bg-green-500"}},Ca=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",group:"zaehler",getValue:t=>t.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",group:"zaehler",getValue:t=>t.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",group:"komponenten",getValue:t=>t.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"speicher_ladung",label:"Speicher Ladung",shortLabel:"Sp.Lad",group:"komponenten",getValue:t=>t.speicher_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"speicher_entladung",label:"Speicher Entladung",shortLabel:"Sp.Entl",group:"komponenten",getValue:t=>t.speicher_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_strom",label:"WP Strom",shortLabel:"WP",group:"komponenten",getValue:t=>t.wp_strom_kwh,format:"kwh",defaultVisible:!1},{key:"wp_heizung",label:"WP Heizung",shortLabel:"WP Hz",group:"komponenten",getValue:t=>t.wp_heizung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_warmwasser",label:"WP Warmwasser",shortLabel:"WP WW",group:"komponenten",getValue:t=>t.wp_warmwasser_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_ladung",label:"E-Auto Ladung",shortLabel:"E-Auto",group:"komponenten",getValue:t=>t.eauto_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_km",label:"E-Auto km",shortLabel:"km",group:"komponenten",getValue:t=>t.eauto_km,defaultVisible:!1},{key:"wallbox_ladung",label:"Wallbox Ladung",shortLabel:"WB",group:"komponenten",getValue:t=>t.wallbox_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",group:"berechnet",getValue:t=>t.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",group:"berechnet",getValue:t=>t.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",group:"berechnet",getValue:t=>t.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",group:"berechnet",getValue:t=>t.autarkie_prozent,format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",group:"berechnet",getValue:t=>t.eigenverbrauchsquote_prozent,format:"percent",defaultVisible:!1}],j0="eedc-monatsdaten-columns-v3";function Qg(){var pe,Oe;const t=lr(),{anlagen:r,loading:a}=it(),[s,n]=m.useState(void 0),{monatsdaten:i,loading:l,error:c,createMonatsdaten:h,updateMonatsdaten:g,deleteMonatsdaten:o}=Ah(s);us(s);const[x,u]=m.useState([]),[d,p]=m.useState(!1),[b,j]=m.useState(!1),[f,y]=m.useState(null),[k,_]=m.useState(null),[w,v]=m.useState(!1),[E,F]=m.useState(!1),[C,D]=m.useState(null),[A,S]=m.useState(!1),[W,N]=m.useState([]),[z,$]=m.useState(!1),[T,I]=m.useState(null),[V,G]=m.useState(new Date().getFullYear()),[Z,R]=m.useState(new Date().getMonth()),[M,H]=m.useState(null),[K,O]=m.useState(!1),[ee,de]=m.useState(null),[ue,Me]=m.useState(()=>{try{const B=localStorage.getItem(j0);if(B)return new Set(JSON.parse(B))}catch{}return new Set(Ca.filter(B=>B.defaultVisible).map(B=>B.key))});m.useEffect(()=>{localStorage.setItem(j0,JSON.stringify([...ue]))},[ue]),m.useEffect(()=>{if(!s)return;(async()=>{p(!0);try{const le=await _r.listAggregiert(s);u(le)}catch(le){console.error("Fehler beim Laden der aggregierten Daten:",le)}finally{p(!1)}})()},[s,i]),m.useEffect(()=>{if(A)return;(async()=>{try{const le=await ur.getStatus();D(le.verfuegbar)}catch{D(!1)}finally{S(!0)}})()},[A]),m.useEffect(()=>{if(!E||!s)return;(async()=>{$(!0),I(null);try{const le=await ur.getVerfuegbareMonate(s);N(le)}catch(le){I("Fehler beim Laden der verfgbaren Monate"),console.error(le)}finally{$(!1)}})()},[E,s]);const Ae=async()=>{if(!(!s||!V||!Z)){$(!0),I(null);try{const B=await ur.getMonatswerte(s,V,Z),le=i.find(We=>We.jahr===V&&We.monat===Z);if(le){const We=await tt.getMonatsdatenByMonth(s,V,Z);de({haWerte:B,vorhandeneDaten:le,vorhandeneInvestitionsDaten:We}),F(!1),O(!0)}else H(B),F(!1),j(!0)}catch(B){I("Fehler beim Laden der Monatswerte aus HA-Statistik"),console.error(B)}finally{$(!1)}}},Be=()=>{ee&&(H(ee.haWerte),y(ee.vorhandeneDaten),O(!1),de(null))},ne=()=>{O(!1),de(null)},Ee=B=>{Me(le=>{const We=new Set(le);return We.has(B)?We.delete(B):We.add(B),We})},ie=B=>{const le=Ca.filter($e=>$e.group===B),We=le.every($e=>ue.has($e.key));Me($e=>{const Re=new Set($e);return le.forEach(xt=>{We?Re.delete(xt.key):Re.add(xt.key)}),Re})},q=Ca.filter(B=>ue.has(B.key));!s&&r.length>0&&!a&&n(r[0].id);const J=m.useMemo(()=>x.filter(B=>B.hat_legacy_daten).length,[x]),Ie=async B=>{await h(B),j(!1)},ye=async B=>{f&&(await g(f.id,B),y(null))},re=async()=>{k&&(await o(k.id),_(null))},xe=B=>i.find(le=>le.id===B.id),U=(B,le)=>{if(B==null||isNaN(B))return"-";switch(le){case"kwh":return B.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${B.toFixed(1)}%`;default:return B.toLocaleString("de-DE",{maximumFractionDigits:1})}};return a||l?e.jsx(Se,{text:"Lade Daten..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(P,{children:e.jsx(ka,{icon:ct,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(se,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Zt,{value:(s==null?void 0:s.toString())||"",onChange:B=>n(parseInt(B.target.value)),options:r.map(B=>({value:B.id.toString(),label:B.anlagenname}))}),C&&e.jsxs(se,{variant:"secondary",onClick:()=>F(!0),children:[e.jsx(Yr,{className:"h-5 w-5 mr-2"}),"Aus HA laden"]}),e.jsxs(se,{onClick:()=>{H(null),j(!0)},children:[e.jsx(Wr,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),c&&e.jsx(te,{type:"error",children:c}),J>0&&e.jsxs(te,{type:"warning",className:"flex items-start gap-3",children:[e.jsx(pt,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Legacy-Daten gefunden"}),e.jsxs("p",{className:"text-sm mt-1",children:[J," Monat",J>1?"e":""," enthlt",J>1?"en":""," Daten im alten Format (PV-Erzeugung/Speicher in Monatsdaten statt InvestitionMonatsdaten). Bitte jeden betroffenen Monat einmal ffnen und speichern."]})]})]}),d?e.jsx(Se,{text:"Lade aggregierte Daten..."}):x.length===0?e.jsx(P,{children:e.jsx(ka,{icon:$t,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(se,{onClick:()=>j(!0),children:"Manuell erfassen"}),e.jsx(se,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(se,{variant:"secondary",size:"sm",onClick:()=>v(!w),children:[e.jsx(Xd,{className:"h-4 w-4 mr-2"}),"Spalten (",q.length,"/",Ca.length,")"]})}),w&&e.jsxs(P,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"space-y-4",children:Object.keys(y0).map(B=>{const le=y0[B],We=Ca.filter(Re=>Re.group===B),$e=We.filter(Re=>ue.has(Re.key)).length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${le.color}`}),e.jsxs("button",{onClick:()=>ie(B),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600",children:[le.label," (",$e,"/",We.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-5",children:We.map(Re=>e.jsx("button",{onClick:()=>Ee(Re.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${ue.has(Re.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:Re.label},Re.key))})]},B)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"Klicke auf Gruppen-Namen um alle Spalten ein-/auszublenden, oder auf einzelne Spalten."})]}),e.jsx(P,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ol,{children:[e.jsx(cl,{children:e.jsxs(ja,{children:[e.jsx(yt,{children:"Monat"}),q.map(B=>e.jsxs(yt,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:B.label}),e.jsx("span",{className:"sm:hidden",children:B.shortLabel||B.label})]},B.key)),e.jsx(yt,{className:"text-right",children:"Aktionen"})]})}),e.jsx(dl,{children:x.map(B=>e.jsxs(ja,{className:B.hat_legacy_daten?"bg-amber-50 dark:bg-amber-900/10":"",children:[e.jsxs(jt,{children:[e.jsxs("span",{className:"font-medium",children:[f0[B.monat]," ",B.jahr]}),B.hat_legacy_daten&&e.jsx("span",{title:"Legacy-Daten",children:e.jsx(pt,{className:"h-3 w-3 text-amber-500 inline ml-1"})})]}),q.map(le=>{const We=le.getValue(B);return e.jsx(jt,{className:`text-right font-mono ${le.className||""}`,children:U(We,le.format)},le.key)}),e.jsx(jt,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>{const le=xe(B);le&&y(le)},children:e.jsx(il,{className:"h-4 w-4"})}),e.jsx(se,{variant:"ghost",size:"sm",onClick:()=>{const le=xe(B);le&&_(le)},children:e.jsx(Mt,{className:"h-4 w-4 text-red-500"})})]})})]},B.id))})]})})})]}),e.jsx(Dt,{isOpen:E,onClose:()=>F(!1),title:"Monatsdaten aus HA-Statistik laden",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[T&&e.jsx(te,{type:"error",children:T}),z&&!W.length?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Ke,{className:"h-8 w-8 animate-spin text-primary-500"})}):W.length===0?e.jsx(te,{type:"warning",children:"Keine Daten in HA-Statistik gefunden. Stellen Sie sicher, dass das Sensor-Mapping konfiguriert ist und die Sensoren Langzeit-Statistiken haben."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Whlen Sie einen Monat aus, dessen Daten aus der Home Assistant Langzeitstatistik geladen werden sollen. Die Werte werden im Formular vorausgefllt und knnen vor dem Speichern angepasst werden."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Jahr"}),e.jsx("select",{value:V,onChange:B=>G(parseInt(B.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[...new Set(W.map(B=>B.jahr))].sort((B,le)=>le-B).map(B=>e.jsx("option",{value:B,children:B},B))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Monat"}),e.jsx("select",{value:Z,onChange:B=>R(parseInt(B.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:W.filter(B=>B.jahr===V).sort((B,le)=>le.monat-B.monat).map(B=>e.jsxs("option",{value:B.monat,children:[B.monat_name," ",B.hat_daten?"":"(keine Daten)"]},B.monat))})]})]}),i.some(B=>B.jahr===V&&B.monat===Z)&&e.jsx(te,{type:"info",children:"Fr diesen Monat existieren bereits Daten. Nach dem Laden wird ein Vergleich angezeigt, damit Sie die Unterschiede prfen knnen."}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(se,{variant:"secondary",onClick:()=>F(!1),children:"Abbrechen"}),e.jsx(se,{onClick:Ae,disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-4 w-4 mr-2 animate-spin"}),"Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yr,{className:"h-4 w-4 mr-2"}),"Werte laden"]})})]})]})]})}),e.jsx(Dt,{isOpen:K,onClose:ne,title:`Vergleich: ${ee==null?void 0:ee.haWerte.monat_name} ${ee==null?void 0:ee.haWerte.jahr}`,size:"lg",children:ee&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(te,{type:"warning",children:"Fr diesen Monat existieren bereits Daten. Bitte prfen Sie die Unterschiede und entscheiden Sie, ob die HA-Werte bernommen werden sollen."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Werte (kWh)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsxs("tbody",{children:[e.jsx(As,{label:"Einspeisung",vorhanden:ee.vorhandeneDaten.einspeisung_kwh,haWert:(pe=ee.haWerte.basis.find(B=>B.feld==="einspeisung"))==null?void 0:pe.wert}),e.jsx(As,{label:"Netzbezug",vorhanden:ee.vorhandeneDaten.netzbezug_kwh,haWert:(Oe=ee.haWerte.basis.find(B=>B.feld==="netzbezug"))==null?void 0:Oe.wert})]})]})})]}),(ee.haWerte.investitionen.length>0||ee.vorhandeneInvestitionsDaten.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Komponenten-Werte (kWh)"}),ee.haWerte.investitionen.map(B=>{const le=ee.vorhandeneInvestitionsDaten.find(Re=>Re.investition_id===B.investition_id),We=(le==null?void 0:le.verbrauch_daten)||{},$e=new Set;return B.felder.forEach(Re=>$e.add(Re.feld)),Object.keys(We).forEach(Re=>$e.add(Re)),e.jsxs("div",{className:"border rounded-lg overflow-hidden dark:border-gray-700",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[B.bezeichnung," (",B.typ,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsx("tbody",{children:[...$e].map(Re=>{const xt=B.felder.find(_s=>_s.feld===Re),Ea=We[Re];return(xt==null?void 0:xt.wert)===null&&Ea===void 0?null:e.jsx(As,{label:(xt==null?void 0:xt.label)||Re.replace(/_/g," "),vorhanden:Ea,haWert:xt==null?void 0:xt.wert},Re)})})]})})]},B.investition_id)}),ee.vorhandeneInvestitionsDaten.filter(B=>!ee.haWerte.investitionen.some(le=>le.investition_id===B.investition_id)).filter(B=>Object.keys(B.verbrauch_daten).length>0).map(B=>e.jsxs("div",{className:"border rounded-lg overflow-hidden dark:border-gray-700 opacity-75",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h5",{className:"text-xs font-medium text-gray-500 dark:text-gray-400",children:["Investition #",B.investition_id," (nur Bestandsdaten, kein HA-Mapping)"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium",children:"Feld"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-blue-600",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium text-green-600",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-2 px-3 font-medium",children:"Diff"})]})}),e.jsx("tbody",{children:Object.entries(B.verbrauch_daten).map(([le,We])=>e.jsx(As,{label:le.replace(/_/g," "),vorhanden:We,haWert:null},le))})]})})]},B.investition_id))]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(se,{variant:"secondary",onClick:ne,children:"Abbrechen"}),e.jsxs(se,{onClick:Be,children:[e.jsx(Yr,{className:"h-4 w-4 mr-2"}),"Mit HA-Werten fortfahren"]})]})]})}),e.jsx(Dt,{isOpen:b,onClose:()=>{j(!1),H(null)},title:M?`Monatsdaten aus HA laden - ${M.monat_name} ${M.jahr}`:"Monatsdaten erfassen",size:"lg",children:s&&e.jsx(b0,{anlageId:s,onSubmit:Ie,onCancel:()=>{j(!1),H(null)},haVorausfuellung:M})}),e.jsx(Dt,{isOpen:!!f,onClose:()=>{y(null),H(null)},title:M?`HA-Werte bernehmen - ${M.monat_name} ${M.jahr}`:"Monatsdaten bearbeiten",size:"lg",children:f&&s&&e.jsx(b0,{monatsdaten:f,anlageId:s,onSubmit:ye,onCancel:()=>{y(null),H(null)},haVorausfuellung:M})}),e.jsx(Dt,{isOpen:!!k,onClose:()=>_(null),title:"Monatsdaten lschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Mchtest du die Daten fr ",e.jsxs("strong",{children:[f0[(k==null?void 0:k.monat)||0]," ",k==null?void 0:k.jahr]})," wirklich lschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(se,{variant:"secondary",onClick:()=>_(null),children:"Abbrechen"}),e.jsx(se,{variant:"danger",onClick:re,children:"Lschen"})]})]})})]})}function As({label:t,vorhanden:r,haWert:a}){const s=r??null,n=a??null;let i=null,l="";s!==null&&n!==null&&(i=n-s,Math.abs(i)<.1?l="text-gray-500":i>0?l="text-green-600 dark:text-green-400":l="text-red-600 dark:text-red-400");const c=g=>g!==null?g.toLocaleString("de-DE",{maximumFractionDigits:1}):"",h=s!==null&&n!==null&&Math.abs(n-s)>.1;return e.jsxs("tr",{className:`border-b dark:border-gray-700 ${h?"bg-amber-50 dark:bg-amber-900/10":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:t}),e.jsx("td",{className:"py-2 px-3 text-right text-blue-600 dark:text-blue-400",children:c(s)}),e.jsx("td",{className:"py-2 px-3 text-right text-green-600 dark:text-green-400 font-medium",children:c(n)}),e.jsx("td",{className:`py-2 px-3 text-right font-medium ${l}`,children:i!==null?(i>=0?"+":"")+i.toLocaleString("de-DE",{maximumFractionDigits:1}):""})]})}function k0(){var Be;const t=Qi(),r=m.useRef(null),a=t.pathname.endsWith("/demo"),{anlagen:s,loading:n,refresh:i}=it(),[l,c]=m.useState(null),[h,g]=m.useState(!1),[o,x]=m.useState(!1),[u,d]=m.useState(null),[p,b]=m.useState(null),[j,f]=m.useState(!1),[y,k]=m.useState(!1),[_,w]=m.useState(null),v=m.useRef(null),[E,F]=m.useState(!1),[C,D]=m.useState(!1),[A,S]=m.useState(null),[W,N]=m.useState(!1),z=m.useRef(null),$=s.some(ne=>ne.anlagenname==="Demo-Anlage"),T=l??((Be=s[0])==null?void 0:Be.id);m.useEffect(()=>{a&&!n&&r.current&&r.current.scrollIntoView({behavior:"smooth",block:"start"})},[a,n]);const I=ne=>{ne.preventDefault(),g(!0)},V=ne=>{ne.preventDefault(),g(!1)},G=async ne=>{ne.preventDefault(),g(!1);const Ee=ne.dataTransfer.files;Ee.length>0&&await R(Ee[0])},Z=async ne=>{const Ee=ne.target.files;Ee&&Ee.length>0&&await R(Ee[0]),v.current&&(v.current.value="")},R=async ne=>{if(!T){b("Bitte zuerst eine Anlage auswhlen");return}if(!ne.name.endsWith(".csv")){b("Bitte eine CSV-Datei auswhlen");return}b(null),d(null),x(!0);try{const Ee=await Jt.importCSV(T,ne,j);d(Ee)}catch(Ee){b(Ee instanceof Error?Ee.message:"Import fehlgeschlagen")}finally{x(!1)}},M=()=>{if(!T){b("Bitte zuerst eine Anlage auswhlen");return}window.location.href=Jt.getTemplateDownloadUrl(T)},H=()=>{if(!T){b("Bitte zuerst eine Anlage auswhlen");return}window.location.href=Jt.getExportUrl(T)},K=async()=>{b(null),w(null),k(!0);try{const ne=await Jt.createDemoData();w(ne),i()}catch(ne){b(ne instanceof Error?ne.message:"Fehler beim Erstellen der Demo-Daten")}finally{k(!1)}},O=async()=>{b(null),w(null),k(!0);try{await Jt.deleteDemoData(),i()}catch(ne){b(ne instanceof Error?ne.message:"Fehler beim Lschen der Demo-Daten")}finally{k(!1)}},ee=ne=>{ne.preventDefault(),F(!0)},de=ne=>{ne.preventDefault(),F(!1)},ue=async ne=>{ne.preventDefault(),F(!1);const Ee=ne.dataTransfer.files;Ee.length>0&&await Ae(Ee[0])},Me=async ne=>{const Ee=ne.target.files;Ee&&Ee.length>0&&await Ae(Ee[0]),z.current&&(z.current.value="")},Ae=async ne=>{if(!ne.name.endsWith(".json")){b("Bitte eine JSON-Datei auswhlen");return}b(null),S(null),D(!0);try{const Ee=await Jt.importJSON(ne,W);S(Ee),Ee.erfolg&&i()}catch(Ee){b(Ee instanceof Error?Ee.message:"JSON-Import fehlgeschlagen")}finally{D(!1)}};return n?e.jsx(Se,{text:"Lade..."}):s.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsx("div",{ref:r}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(ga,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wrmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(se,{onClick:K,loading:y,className:"w-full",children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),_&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ir,{className:"inline h-4 w-4 mr-1"}),_.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),s.length>1&&e.jsx("select",{value:T??"",onChange:ne=>c(Number(ne.target.value)),className:"input w-auto",children:s.map(ne=>e.jsx("option",{value:ne.id,children:ne.anlagenname},ne.id))})]}),p&&e.jsx(te,{type:"error",onClose:()=>b(null),children:p}),u&&e.jsx(tx,{result:u,onClose:()=>d(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(ea,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthlt alle verfgbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(se,{variant:"secondary",className:"w-full",onClick:M,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:I,onDragLeave:V,onDrop:G,onClick:()=>{var ne;return(ne=v.current)==null?void 0:ne.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${h?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${o?"opacity-50 pointer-events-none":""}
              `,children:o?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Se,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswhlen"})]})}),e.jsx("input",{ref:v,type:"file",accept:".csv",onChange:Z,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:ne=>f(ne.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten berschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(se,{variant:"secondary",size:"sm",onClick:H,children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsx("div",{ref:r}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(ga,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:$?"Demo-Anlage ist bereits vorhanden. Du kannst sie lschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),$?e.jsxs(se,{variant:"danger",onClick:O,loading:y,className:"w-full",children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Demo-Anlage lschen"]}):e.jsxs(se,{onClick:K,loading:y,className:"w-full",children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),_&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(ir,{className:"inline h-4 w-4 mr-1"}),_.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthlt:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, Wrmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:e.jsx(pi,{className:"h-6 w-6 text-purple-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"JSON Import (Anlage wiederherstellen)"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere eine komplette Anlage aus einer JSON-Export-Datei. Alle Investitionen, Monatsdaten, Strompreise und PVGIS-Prognosen werden importiert."}),A&&e.jsx(ex,{result:A,onClose:()=>S(null)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:ee,onDragLeave:de,onDrop:ue,onClick:()=>{var ne;return(ne=z.current)==null?void 0:ne.click()},className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
              ${E?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600 hover:border-purple-500"}
              ${C?"opacity-50 pointer-events-none":""}
            `,children:C?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Se,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pi,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"JSON-Datei hierher ziehen oder klicken zum Auswhlen"})]})}),e.jsx("input",{ref:z,type:"file",accept:".json",onChange:Me,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:ne=>N(ne.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),"Existierende Anlage mit gleichem Namen berschreiben"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"}),' JSON-Dateien knnen ber den "Export (JSON)"-Button in der Anlagen-bersicht erstellt werden. Bei Namenskonflikt wird automatisch ein Suffix hinzugefgt, es sei denn "berschreiben" ist aktiviert.']})]}),e.jsxs(P,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:" Tipp: Template herunterladen"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["Das Template enthlt automatisch alle Spalten passend zu deinen angelegten Investitionen (z.B. ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"Sueddach_kWh"}),","," ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"BYD_HVS_Ladung_kWh"}),")."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Pflichtspalten:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Investitions-Spalten (automatisch im Template):"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:["PV-Module: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_kWh"})]}),e.jsxs("li",{children:["Speicher: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Ladung_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Entladung_kWh"})]}),e.jsxs("li",{children:["E-Auto: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_km"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Verbrauch_kWh"}),", etc."]}),e.jsxs("li",{children:["Wrmepumpe: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Strom_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Heizung_kWh"})]})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg mt-2",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200 mb-1",children:" Hinweis zu Legacy-Spalten"}),e.jsxs("p",{className:"text-amber-700 dark:text-amber-300 text-xs",children:["Die Spalten ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," und"," ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"Batterie_*_kWh"})," werden nicht mehr untersttzt, wenn PV-Module/Speicher als Investitionen angelegt sind. Verwende stattdessen die individuellen Investitions-Spalten."]})]})]})]})]})}function ex({result:t,onClose:r}){const a=t.fehler.length>0,s=t.warnungen.length>0,n=()=>a?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>a?"text-red-800 dark:text-red-200":s?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",l=()=>a?"text-red-700 dark:text-red-300":s?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300",c=Object.values(t.importiert).reduce((g,o)=>g+o,0),h={strompreise:"Strompreise",investitionen:"Investitionen",investition_monatsdaten:"Investition-Monatsdaten",monatsdaten:"Monatsdaten",pvgis_prognosen:"PVGIS-Prognosen",pvgis_monatsprognosen:"PVGIS-Monatsprognosen"};return e.jsxs("div",{className:`relative p-4 rounded-lg border mb-4 ${n()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Rr,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[a?e.jsx(Rr,{className:"h-5 w-5 text-red-500 mt-0.5"}):s?e.jsx(pt,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(ir,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:a?"Import fehlgeschlagen":s?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[t.erfolg&&t.anlage_name&&e.jsxs("p",{className:l(),children:[e.jsx("strong",{children:"Anlage:"})," ",t.anlage_name]}),c>0&&e.jsxs("div",{className:l(),children:[e.jsx("p",{className:"font-medium",children:"Importierte Datenstze:"}),e.jsx("ul",{className:"list-disc list-inside ml-2",children:Object.entries(t.importiert).filter(([,g])=>g>0).map(([g,o])=>e.jsxs("li",{children:[h[g]||g,": ",o]},g))})]}),a&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((g,o)=>e.jsx("li",{children:g},o)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((g,o)=>e.jsx("li",{children:g},o)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function tx({result:t,onClose:r}){const a=t.fehler.length>0,s=t.warnungen&&t.warnungen.length>0,n=()=>a?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>a?"text-red-800 dark:text-red-200":s?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",l=()=>a?"text-red-700 dark:text-red-300":s?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300";return e.jsxs("div",{className:`relative p-4 rounded-lg border ${n()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(Rr,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[a?e.jsx(Rr,{className:"h-5 w-5 text-red-500 mt-0.5"}):s?e.jsx(pt,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(ir,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:a?"Import mit Fehlern":s?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[e.jsxs("p",{className:l(),children:[t.importiert," Datenstze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} bersprungen`]}),a&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((c,h)=>e.jsx("li",{children:c},h)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((c,h)=>e.jsx("li",{children:c},h)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function rx(){var E,F;const{anlagen:t,loading:r,refresh:a}=it(),[s,n]=m.useState(null),[i,l]=m.useState(!1),[c,h]=m.useState(!1),[g,o]=m.useState(null),[x,u]=m.useState(!1),[d,p]=m.useState(null),b=m.useRef(null),j=s??((E=t[0])==null?void 0:E.id),f=()=>{j&&window.open(Jt.getFullExportUrl(j),"_blank")},y=C=>{C.preventDefault(),l(!0)},k=C=>{C.preventDefault(),l(!1)},_=async C=>{C.preventDefault(),l(!1);const D=C.dataTransfer.files;D.length>0&&await v(D[0])},w=async C=>{const D=C.target.files;D&&D.length>0&&await v(D[0]),b.current&&(b.current.value="")},v=async C=>{if(!C.name.endsWith(".json")){p("Bitte eine JSON-Datei auswhlen");return}p(null),o(null),h(!0);try{const D=await Jt.importJSON(C,x);o(D),D.erfolg&&a()}catch(D){p(D instanceof Error?D.message:"Import fehlgeschlagen")}finally{h(!1)}};return r?e.jsx(Se,{text:"Lade..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Io,{className:"w-6 h-6 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Backup & Restore"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erstelle ein vollstndiges Backup deiner Anlage (Stammdaten, Investitionen, Monatsdaten, Strompreise, PVGIS-Prognosen) oder stelle eine Anlage aus einem Backup wieder her."}),d&&e.jsx(te,{type:"error",onClose:()=>p(null),children:d}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(bt,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Backup erstellen"})]}),t.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Anlagen vorhanden. Lege zuerst eine Anlage an."}):e.jsxs("div",{className:"space-y-4",children:[t.length>1&&e.jsx("select",{value:j??"",onChange:C=>n(Number(C.target.value)),className:"input w-full",children:t.map(C=>e.jsxs("option",{value:C.id,children:[C.anlagenname," (",C.leistung_kwp," kWp)"]},C.id))}),e.jsxs(se,{onClick:f,className:"w-full",children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Backup als JSON herunterladen"]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Enthlt alle Daten der Anlage. Sensor-Mapping wird mitexportiert, MQTT-Setup muss nach Restore neu eingerichtet werden."})]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-50 dark:bg-green-900/20",children:e.jsx(Or,{className:"h-6 w-6 text-green-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Restore aus Backup"})]}),g&&g.erfolg&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-300 font-medium mb-2",children:[e.jsx(ir,{className:"h-5 w-5"}),"Anlage ",g.anlage_name,'" erfolgreich importiert']}),e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400 space-y-1",children:g.importiert&&Object.entries(g.importiert).map(([C,D])=>D>0&&e.jsxs("div",{children:[C,": ",D]},C))}),g.warnungen&&g.warnungen.length>0&&e.jsx("div",{className:"mt-3 space-y-1",children:g.warnungen.map((C,D)=>e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-amber-600 dark:text-amber-400",children:[e.jsx(pt,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0"}),C]},D))})]}),g&&!g.erfolg&&e.jsx(te,{type:"error",className:"mb-4",children:((F=g.fehler)==null?void 0:F.join(", "))||"Import fehlgeschlagen"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onDragOver:y,onDragLeave:k,onDrop:_,onClick:()=>{var C;return(C=b.current)==null?void 0:C.click()},className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
              ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}
            `,children:[e.jsx(pi,{className:"h-10 w-10 mx-auto mb-3 text-gray-400"}),c?e.jsx(Se,{text:"Importiere..."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 font-medium",children:"JSON-Backup hierher ziehen oder klicken"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:".json Datei aus einem frheren EEDC-Export"})]}),e.jsx("input",{ref:b,type:"file",accept:".json",onChange:w,className:"hidden"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:C=>u(C.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Existierende Anlage mit gleichem Namen berschreiben"]})]})]})]})}function ax(){const{theme:t,setTheme:r}=Uo(),[a,s]=m.useState(null),[n,i]=m.useState(null),[l,c]=m.useState([]),[h,g]=m.useState(!0),[o,x]=m.useState(null),u=async()=>{try{g(!0),x(null);const[d,p]=await Promise.all([fi.getStats(),fi.getSettings()]);if(s(d),i(p),p.ha_integration_enabled)try{const b=await Cr.getSensors();c(b)}catch{}}catch(d){x(d instanceof Error?d.message:"Fehler beim Laden der Einstellungen")}finally{g(!1)}};return m.useEffect(()=>{u()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:u,disabled:h,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(sr,{className:`h-5 w-5 ${h?"animate-spin":""}`})})]}),o&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:o})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:ce},{value:"dark",label:"Dunkel",icon:Ro},{value:"system",label:"System",icon:Oo}].map(d=>e.jsxs("button",{onClick:()=>r(d.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===d.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(d.icon,{className:"h-5 w-5"}),d.label]},d.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(dt,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:n!=null&&n.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),l.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",l.length," Energy-Sensoren verfgbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt ber ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen  Import/Export"})," um deine Daten zu importieren."]})]})]}),l.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfgbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:l.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:d.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:d.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:d.unit_of_measurement||"-"})]},d.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Yr,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),h?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Ke,{className:"h-6 w-6 animate-spin text-gray-400"})}):a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),a.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(a.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",a.daten_zeitraum&&e.jsxs("span",{children:[" (",a.daten_zeitraum.von," - ",a.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",a.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(n==null?void 0:n.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfgbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"./api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]})]})}const v0=["","Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function sx(){const{anlagen:t,loading:r}=it(),[a,s]=m.useState(),[n,i]=m.useState(null),[l,c]=m.useState([]),[h,g]=m.useState(null),[o,x]=m.useState(null),[u,d]=m.useState(null),[p,b]=m.useState(!1),[j,f]=m.useState(!1),[y,k]=m.useState(!1),[_,w]=m.useState(null),[v,E]=m.useState(null),[F,C]=m.useState(null),[D,A]=m.useState(!1),S=m.useRef(null),[W,N]=m.useState(14);m.useEffect(()=>{t.length>0&&!a&&s(t[0].id)},[t,a]),m.useEffect(()=>{a&&z()},[a]);const z=async()=>{if(a){b(!0),w(null),E(null);try{const[M,H,K,O]=await Promise.all([Nt.getAktivePrognose(a),Nt.listeGespeichertePrognosen(a),Cn.getProvider(a).catch(()=>null),Nt.getHorizont(a).catch(()=>null)]);i(M),c(H),d(K),C(O)}catch(M){w(M instanceof Error?M.message:"Fehler beim Laden")}finally{b(!1)}}},$=async()=>{if(a){f(!0),w(null);try{const M=await Nt.getPrognose(a,{system_losses:W});g(M)}catch(M){w(M instanceof Error?M.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{f(!1)}}},T=async()=>{if(a){k(!0),w(null);try{const M=await Nt.getOptimum(a);x(M)}catch(M){w(M instanceof Error?M.message:"Fehler beim Ermitteln des Optimums")}finally{k(!1)}}},I=async()=>{if(a){b(!0),w(null);try{await Nt.speicherePrognose(a,{system_losses:W}),E("Prognose erfolgreich gespeichert"),g(null),await z()}catch(M){w(M instanceof Error?M.message:"Fehler beim Speichern")}finally{b(!1)}}},V=async M=>{try{await Nt.aktivierePrognose(M),E("Prognose aktiviert"),await z()}catch(H){w(H instanceof Error?H.message:"Fehler beim Aktivieren")}},G=async M=>{if(confirm("Prognose wirklich lschen?"))try{await Nt.loeschePrognose(M),E("Prognose gelscht"),await z()}catch(H){w(H instanceof Error?H.message:"Fehler beim Lschen")}},Z=t.find(M=>M.id===a),R=(Z==null?void 0:Z.latitude)&&(Z==null?void 0:Z.longitude);return r?e.jsx(Se,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"}),e.jsx(te,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Solarprognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Zt,{value:(a==null?void 0:a.toString())||"",onChange:M=>s(parseInt(M.target.value)),options:t.map(M=>({value:M.id.toString(),label:M.anlagenname}))}),e.jsx("button",{onClick:z,disabled:p,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(sr,{className:`h-5 w-5 ${p?"animate-spin":""}`})})]})]}),_&&e.jsx(te,{type:"error",children:_}),v&&e.jsx(te,{type:"success",children:v}),!R&&e.jsx(te,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ht,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergnze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu knnen."})]})]})}),R&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),p?e.jsx(Se,{}):n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[n.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.neigung_grad,""]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:n.ausrichtung_richtung})]})]}),n.monatswerte&&n.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:n.monatswerte.map(M=>({name:v0[M.monat],prognose:M.e_m})),children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name"}),e.jsx(be,{tickFormatter:M=>`${M} kWh`}),e.jsx(ge,{formatter:M=>`${M.toFixed(0)} kWh`}),e.jsx(oe,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(n.abgerufen_am).toLocaleDateString("de-DE"),"  ","Koordinaten: ",n.latitude.toFixed(4),"N, ",n.longitude.toFixed(4),"E","  ","Horizont: ",n.horizont_verwendet?"Eigenes Profil":"PVGIS-Gelnde"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ql,{className:"h-5 w-5"}),"Horizontprofil"]}),F!=null&&F.hat_horizont?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-300 mb-2",children:"Profil vorhanden"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 dark:text-green-400",children:"Datenpunkte"}),e.jsx("p",{className:"font-bold text-green-700 dark:text-green-300",children:F.anzahl_punkte})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 dark:text-green-400",children:"Min. Elevation"}),e.jsxs("p",{className:"font-bold text-green-700 dark:text-green-300",children:[F.min_elevation,""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 dark:text-green-400",children:"Max. Elevation"}),e.jsxs("p",{className:"font-bold text-green-700 dark:text-green-300",children:[F.max_elevation,""]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(se,{variant:"secondary",onClick:()=>{var M;return(M=S.current)==null?void 0:M.click()},disabled:D,children:[e.jsx(Or,{className:"h-4 w-4 mr-2"}),"Eigene Datei"]}),e.jsxs(se,{variant:"secondary",onClick:async()=>{if(!(!a||!confirm("Horizontprofil lschen?")))try{await Nt.deleteHorizont(a),C(null),E("Horizontprofil gelscht")}catch(M){w(M instanceof Error?M.message:"Fehler beim Lschen")}},children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Lschen"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Das Horizontprofil beschreibt, wie hoch Berge, Gebude oder Bume den Horizont in jeder Himmelsrichtung verdecken. Ohne Profil verwendet PVGIS automatisch Gelndedaten (~90m Auflsung) bei der Ertragsprognose."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs(se,{onClick:async()=>{if(a){A(!0),w(null);try{const M=await Nt.abrufeHorizont(a);C(M),E("Gelndeprofil von PVGIS abgerufen")}catch(M){w((M==null?void 0:M.detail)||(M==null?void 0:M.message)||"Abruf fehlgeschlagen")}finally{A(!1)}}},disabled:D,children:[D?e.jsx(sr,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Gelndeprofil von PVGIS abrufen"]}),e.jsxs(se,{variant:"secondary",onClick:()=>{var M;return(M=S.current)==null?void 0:M.click()},disabled:D,children:[e.jsx(Or,{className:"h-4 w-4 mr-2"}),"Eigene Datei hochladen"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Gelndeprofil:"})," Erfasst Berge und groe Gelndestrukturen (aus Satellitendaten).",e.jsx("br",{}),e.jsx("strong",{children:"Eigene Datei:"}),' Fr lokale Hindernisse (Gebude, Bume), die im Gelndemodell fehlen. Kann z.B. mit Smartphone-Apps wie "Sun Surveyor" erstellt oder von'," ",e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"PVGIS"})," ","heruntergeladen werden."]})]}),e.jsx("input",{ref:S,type:"file",accept:".txt,.csv,.hor",className:"hidden",onChange:async M=>{var K;const H=(K=M.target.files)==null?void 0:K[0];if(!(!H||!a)){A(!0),w(null);try{const O=await Nt.uploadHorizont(a,H);C(O),E("Horizontprofil gespeichert")}catch(O){w((O==null?void 0:O.detail)||(O==null?void 0:O.message)||"Upload fehlgeschlagen")}finally{A(!1),S.current&&(S.current.value="")}}}})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:W,onChange:M=>N(parseFloat(M.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(se,{onClick:$,disabled:j,className:"w-full",children:[j?e.jsx(sr,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),h&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(se,{onClick:I,disabled:p,children:[e.jsx(ir,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[h.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[h.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[h.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:h.module.length})]})]}),h.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:h.module.map(M=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:M.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[M.leistung_kwp," kWp  ",M.ausrichtung,"  ",M.neigung_grad,"  ",M.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},M.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:h.monatsdaten.map(M=>({name:v0[M.monat],ertrag:M.e_m})),children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",fontSize:10}),e.jsx(be,{tickFormatter:M=>`${M}`}),e.jsx(ge,{formatter:M=>`${M.toFixed(0)} kWh`}),e.jsx(oe,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Qd,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(se,{onClick:T,disabled:y,variant:"secondary",children:[y?e.jsx(sr,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),o?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter fr Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[o.optimal.neigung_grad,""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:o.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[o.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),o.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung fr deinen Standort zu ermitteln.'})]}),l.length>0&&e.jsxs(P,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Horizont"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:l.map(M=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(M.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[M.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:M.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[M.neigung_grad,""]}),e.jsx("td",{className:"text-center py-2 px-2",children:M.horizont_verwendet?e.jsx("span",{title:"Eigenes Profil",children:e.jsx(Ql,{className:"h-4 w-4 text-green-500 mx-auto"})}):e.jsx("span",{className:"text-gray-400 text-xs",children:"DEM"})}),e.jsx("td",{className:"text-center py-2 px-2",children:M.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(ir,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!M.ist_aktiv&&e.jsx("button",{onClick:()=>V(M.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(ir,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>G(M.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Lschen",children:e.jsx(Mt,{className:"h-4 w-4"})})]})})]},M.id))})]})})]}),u&&e.jsxs(P,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ir,{className:"h-5 w-5"}),"Wetterdaten-Provider"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Der Wetter-Provider bestimmt die Quelle fr Globalstrahlungsdaten bei der Ist-Erfassung und der Kurzfrist-Prognose. Die Einstellung kann in den Anlagen-Stammdaten gendert werden."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Aktueller Provider"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:u.aktueller_provider==="auto"?"Automatisch":u.aktueller_provider==="brightsky"?"Bright Sky (DWD)":u.aktueller_provider==="open-meteo"?"Open-Meteo":u.aktueller_provider==="open-meteo-solar"?"Open-Meteo Solar (GTI)":u.aktueller_provider})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Standort"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[u.standort.land||"Unbekannt",u.standort.in_deutschland&&" (DWD verfgbar)"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Verfgbare Provider"}),e.jsx("div",{className:"grid gap-2",children:u.provider.map(M=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${M.verfuegbar?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 opacity-60"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${M.verfuegbar?"text-green-700 dark:text-green-300":"text-gray-500 dark:text-gray-400"}`,children:M.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:M.beschreibung})]}),e.jsx("div",{className:"text-sm",children:M.verfuegbar?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:" Verfgbar"}):e.jsx("span",{className:"text-gray-400",children:"Nicht verfgbar"})})]},M.id))})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ct,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"ber Solarprognose"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"PVGIS"})," (Langfrist): EU-Tool fr Ertragsprognosen basierend auf Satellitendaten und Klimamodellen. Nutzt historische TMY-Daten (Typical Meteorological Year)."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Wetter-Provider"})," (Kurzfrist): Aktuelle und historische Wetterdaten fr SOLL-IST-Vergleiche. Bright Sky liefert DWD-Daten (Deutschland), Open-Meteo weltweit."]}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"PVGIS-Dokumentation "})]})]})})]})]})}const w0=`# Utility Meter fr monatliche Aggregation
# Fge dies in deine configuration.yaml ein

utility_meter:
  # PV-Erzeugung (von deinem Wechselrichter)
  pv_erzeugung_monatlich:
    source: sensor.DEIN_WR_total_yield  # <- Anpassen!
    cycle: monthly

  # Einspeisung ins Netz
  einspeisung_monatlich:
    source: sensor.DEIN_ZAEHLER_export  # <- Anpassen!
    cycle: monthly

  # Netzbezug
  netzbezug_monatlich:
    source: sensor.DEIN_ZAEHLER_import  # <- Anpassen!
    cycle: monthly

  # Speicher Ladung (optional)
  speicher_ladung_monatlich:
    source: sensor.DEIN_SPEICHER_charge_total  # <- Anpassen!
    cycle: monthly`;function nx(){const[t,r]=m.useState(!1),[a,s]=m.useState(!1),n=i=>{navigator.clipboard.writeText(i),s(!0),setTimeout(()=>s(!1),2e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ea,{className:"w-6 h-6"}),"Datenerfassung"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wie Sie Ihre monatlichen Energiedaten in EEDC erfassen"})]}),e.jsx("div",{className:"bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(uh,{className:"w-5 h-5 text-primary-600 dark:text-primary-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-primary-800 dark:text-primary-200 mb-1",children:"Empfohlener Workflow"}),e.jsxs("p",{className:"text-sm text-primary-700 dark:text-primary-300",children:["Einmalig: ",e.jsx("strong",{children:"Sensor-Zuordnung"})," konfigurieren  Monatlich: ",e.jsx("strong",{children:"Monatsabschluss-Wizard"})," aufrufen (Werte direkt aus HA laden oder manuell eingeben)"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-primary-200 dark:border-primary-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 dark:bg-primary-900 rounded-lg",children:e.jsx(ui,{className:"w-6 h-6 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"HA-Statistik-Import"}),e.jsx("span",{className:"text-xs bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300 px-2 py-0.5 rounded",children:"Primr fr HA-Benutzer"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4 text-sm",children:"Liest Monatswerte direkt aus der Home Assistant Langzeitstatistik. Rckwirkend fr alle vorhandenen Monate seit Installation."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-primary-500"}),"Kein manuelles Ablesen notwendig"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-primary-500"}),"Bulk-Import aller Monate seit Installation"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-primary-500"}),"Konflikterkennung  vorhandene Daten werden geschtzt"]})]}),e.jsxs(ha,{to:"/einstellungen/ha-statistik-import",className:"btn btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(ui,{className:"w-4 h-4"}),"Zum HA-Statistik-Import"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(mi,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatsabschluss-Wizard"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 px-2 py-0.5 rounded",children:"Empfohlen fr alle"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4 text-sm",children:"Gefhrte Eingabe aller Monatsdaten in einem Schritt  inklusive Zhlerwerte, Komponenten-Daten und Sonstige Positionen."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-green-500"}),"Vorschlge aus HA-Sensoren oder historischen Werten"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-green-500"}),"Vollstndig: alle Komponenten in einem Formular"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-green-500"}),"Plausibilittsprfung und Warnungen"]})]}),e.jsxs(ha,{to:"/einstellungen/monatsabschluss",className:"btn btn-primary w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(mi,{className:"w-4 h-4"}),"Zum Monatsabschluss"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(ht,{className:"w-6 h-6 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-1",children:"Einmalige Einrichtung: Sensor-Zuordnung"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"Verknpfen Sie Ihre Home Assistant Sensoren einmalig mit den EEDC-Feldern. Danach werden im Monatsabschluss-Wizard automatisch Vorschlge aus HA geliefert."}),e.jsxs(ha,{to:"/einstellungen/sensor-mapping",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1 w-fit",children:[e.jsx(ht,{className:"w-3 h-3"}),"Sensor-Zuordnung konfigurieren"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:e.jsx(al,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Manuelles Formular"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Einzelne Monate direkt anlegen oder bearbeiten  z.B. fr Korrekturen."}),e.jsxs(ha,{to:"/einstellungen/monatsdaten",className:"text-sm text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[e.jsx(ot,{className:"w-3 h-3"}),"Zu Monatsdaten"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:e.jsx(Or,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"CSV-Import"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Bulk-Import aus Tabellenkalkulationen oder externen Quellen. Vorlage im Import-Dialog herunterladen."}),e.jsxs(ha,{to:"/einstellungen/import",className:"text-sm text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[e.jsx(ot,{className:"w-3 h-3"}),"Zum Import/Export"]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[e.jsx(nt,{className:"w-5 h-5 text-gray-500 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Tipps"})]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 ml-7",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"EEDC erwartet Monatswerte"})," (Differenz Monatsanfang  Monatsende), keine kumulierten Zhlerstnde."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Wetterdaten"})," (Globalstrahlung, Sonnenstunden) werden automatisch aus Open-Meteo geladen, wenn Ihre Anlage Koordinaten hat."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sonstige Ertrge & Ausgaben"})," (z.B. THG-Quote, Wartungskosten) knnen pro Investition im Monatsabschluss-Wizard erfasst werden."]})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-5",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(nt,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-semibold text-amber-800 dark:text-amber-200",children:"Firmenwagen & dienstliches Laden an der Wallbox"})]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300 mb-3",children:"Wenn an Ihrer Wallbox ausschlielich Firmenwagen geladen werden (alle gefahrenen km sind erstattungspflichtig), unterscheidet sich die ROI-Berechnung grundlegend:"}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-amber-700 dark:text-amber-300 ml-4 mb-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Kosten:"})," Netzbezug  Strompreis + PV-Anteil  Einspeisevergtung (= entgangene Einspeisung)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Ertrag:"}),' AG-Erstattung (km-Pauschale) als "Sonstiger Ertrag" im Monatsabschluss erfassen']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Kein Benzinvergleich"}),"  der Kraftstoffvorteil geht an den Arbeitgeber, nicht an den Haushalt"]})]}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mb-3",children:[e.jsx("strong",{children:"Einrichtung:"}),' Aktivieren Sie das Flag "Ausschlielich dienstliches Laden" in den Wallbox-Parametern (Investitionen  Wallbox bearbeiten).']}),e.jsxs("div",{className:"bg-amber-100 dark:bg-amber-900/40 rounded p-3 text-xs text-amber-800 dark:text-amber-300",children:[e.jsx("strong",{children:"Gemischte Nutzung (privat + dienstlich)?"})," Legen Sie zwei separate Wallbox-Eintrge an  einen ohne Flag fr private Ladevorgnge, einen mit Flag fr dienstliche Ladevorgnge. Das entspricht der empfohlenen Praxis mit separatem Zhler (steuerlich oft ohnehin sinnvoll)."]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!t),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(ea,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Legacy: CSV aus Home Assistant erstellen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Utility Meter einrichten und monatlich exportieren (ltere Methode)"})]})]}),t?e.jsx(Jd,{className:"w-5 h-5 text-gray-400"}):e.jsx(Mr,{className:"w-5 h-5 text-gray-400"})]}),t&&e.jsxs("div",{className:"px-4 pb-4 space-y-5 border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Hinweis:"})," Der HA-Statistik-Import (oben) ist die einfachere Alternative  er liest die HA Langzeitstatistiken direkt ohne Utility Meter Konfiguration."]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"1"}),"Utility Meter einrichten"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:["Fgen Sie folgendes in Ihre"," ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"configuration.yaml"})," ","ein und passen Sie die Sensor-IDs an:"]}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-64",children:w0}),e.jsx("button",{onClick:()=>n(w0),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:a?e.jsx(ir,{className:"w-4 h-4 text-green-400"}):e.jsx(el,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"2"}),"Sensoren identifizieren"]}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-2",children:[e.jsxs("li",{children:[" ",e.jsx("strong",{children:"Entwicklerwerkzeuge  Zustnde"})," in HA ffnen"]}),e.jsx("li",{children:' Nach "total" oder "energy" filtern'}),e.jsxs("li",{children:[" Sensoren mit ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"state_class: total_increasing"})," sind ideal"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"3"}),"CSV-Datei erstellen"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Am Monatsende die Utility Meter Werte ablesen und in eine CSV eintragen. Laden Sie im Import-Dialog eine Vorlage herunter  sie enthlt alle Spalten passend zu Ihren Investitionen."}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs font-mono overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"// Mindestpflicht-Spalten:"}),e.jsx("div",{children:"Jahr,Monat,Einspeisung_kWh,Netzbezug_kWh"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"// Beispiel:"}),e.jsx("div",{children:"2025,12,125.9,405.5"})]})]})]})]})]})}function ix(){const[t,r]=m.useState([]),[a,s]=m.useState(null),[n,i]=m.useState(null),[l,c]=m.useState(null),[h,g]=m.useState(null),[o,x]=m.useState(!0),[u,d]=m.useState(null),[p,b]=m.useState(null),[j,f]=m.useState("core-mosquitto"),[y,k]=m.useState(1883),[_,w]=m.useState(""),[v,E]=m.useState(""),[F,C]=m.useState(null),[D,A]=m.useState(null),[S,W]=m.useState(!1),[N,z]=m.useState(!1),[$,T]=m.useState(!1),[I,V]=m.useState("mqtt"),[G,Z]=m.useState(new Set(["energie","finanzen"])),[R,M]=m.useState(!1),H=async()=>{try{x(!0),d(null);const[ie,q,J]=await Promise.all([Lt.list(),Cr.getExportSensors(),Cr.getMqttConfig().catch(()=>null)]);r(ie),i(q),J&&(b(J),f(J.host),k(J.port),w(J.username)),ie.length>0&&!a&&s(ie[0].id)}catch(ie){d(ie instanceof Error?ie.message:"Fehler beim Laden")}finally{x(!1)}},K=async ie=>{try{const[q,J]=await Promise.all([Cr.getAnlageSensors(ie),Cr.getYamlSnippet(ie)]);c(q),g(J)}catch(q){console.error("Fehler beim Laden der Anlage-Daten:",q)}};m.useEffect(()=>{H()},[]),m.useEffect(()=>{a&&K(a)},[a]);const O=async()=>{W(!0),C(null);try{const ie=await Cr.testMqtt({host:j,port:y,username:_||void 0,password:v||void 0});C(ie)}catch(ie){C({connected:!1,error:ie instanceof Error?ie.message:"Verbindungsfehler"})}finally{W(!1)}},ee=async()=>{if(a){z(!0),A(null);try{const ie=await Cr.publishMqtt(a,{host:j,port:y,username:_||void 0,password:v||void 0});A(ie)}catch(ie){A({message:ie instanceof Error?ie.message:"Fehler beim Publizieren",anlage_id:a,total:0,success:0,failed:0})}finally{z(!1)}}},de=async()=>{if(a&&confirm("Alle EEDC-Sensoren fr diese Anlage aus Home Assistant entfernen?")){T(!0);try{await Cr.removeMqtt(a,{host:j,port:y,username:_||void 0,password:v||void 0}),A(null)}catch(ie){d(ie instanceof Error?ie.message:"Fehler beim Entfernen")}finally{T(!1)}}},ue=async()=>{if(h)try{await navigator.clipboard.writeText(h.yaml),M(!0),setTimeout(()=>M(!1),2e3)}catch{const ie=document.createElement("textarea");ie.value=h.yaml,document.body.appendChild(ie),ie.select(),document.execCommand("copy"),document.body.removeChild(ie),M(!0),setTimeout(()=>M(!1),2e3)}},Me=()=>{if(!h||!l)return;const ie=new Blob([h.yaml],{type:"text/yaml"}),q=URL.createObjectURL(ie),J=document.createElement("a");J.href=q,J.download=`eedc_sensors_${l.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(q)},Ae=ie=>{Z(q=>{const J=new Set(q);return J.has(ie)?J.delete(ie):J.add(ie),J})},Be=ie=>{const q={};return ie.forEach(J=>{const Ie=J.category||"sonstige";q[Ie]||(q[Ie]=[]),q[Ie].push(J)}),q},ne={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},Ee={energie:"",finanzen:"",autarkie:"",umwelt:"",performance:"",sonstige:""};return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ke,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(dt,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:H,disabled:o,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(sr,{className:`h-5 w-5 ${o?"animate-spin":""}`})})]}),u&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:u})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(nt,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO, ROI) als Sensoren an Home Assistant zurckgeben. Whle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entitten)."})]})]}),t.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswhlen"}),e.jsx("select",{value:a||"",onChange:ie=>s(Number(ie.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:t.map(ie=>e.jsx("option",{value:ie.id,children:ie.anlagenname},ie.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>V("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${I==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>V("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${I==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),I==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),p&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:j,onChange:ie=>f(ie.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:y,onChange:ie=>k(Number(ie.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:_,onChange:ie=>w(ie.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:v,onChange:ie=>E(ie.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),F&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${F.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:F.connected?e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",F.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:F.error})]})}),F.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:F.hint})]}),D&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${D.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[D.success," von ",D.total," Sensoren publiziert"]})]}),D.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[D.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:O,disabled:S,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[S?e.jsx(Ke,{className:"w-4 h-4 animate-spin"}):e.jsx(sr,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:ee,disabled:N||!a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[N?e.jsx(Ke,{className:"w-4 h-4 animate-spin"}):e.jsx(Go,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:de,disabled:$||!a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[$?e.jsx(Ke,{className:"w-4 h-4 animate-spin"}):e.jsx(Mt,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${p!=null&&p.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[p!=null&&p.auto_publish?e.jsx(vt,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(pt,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${p!=null&&p.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen  Gerte & Dienste  MQTT"}),".",p!=null&&p.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",p.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelmig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen fr automatische Updates."]})]})]})]})]}),I==="rest"&&h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML fr configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ue,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:R?e.jsxs(e.Fragment,{children:[e.jsx(vt,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(el,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:Me,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(bt,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:h.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:h.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(nt,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["Fge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",h.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach nderungen muss Home Assistant neu gestartet werden."]})]})]})]}),l&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verfgbare Sensoren (",l.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(Be(l.sensors)).map(([ie,q])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>Ae(ie),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:Ee[ie]||""}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ne[ie]||ie}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",q.length,")"]})]}),G.has(ie)?e.jsx(Mr,{className:"w-5 h-5 text-gray-400"}):e.jsx(Yt,{className:"w-5 h-5 text-gray-400"})]}),G.has(ie)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:q.map(J=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:J.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:J.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:J.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:J.value!==null?typeof J.value=="number"?J.value.toLocaleString("de-DE",{maximumFractionDigits:2}):J.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:J.unit})]})]}),J.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",J.formel,J.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",J.berechnung]})]})]},J.key))})]},ie))})]}),n&&n.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:n.investitionen.map(ie=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ie.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",ie.typ," - ",ie.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:ie.sensors.map(q=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:q.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:q.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:q.value!==null?typeof q.value=="number"?q.value.toLocaleString("de-DE",{maximumFractionDigits:2}):q.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:q.unit})]})]},q.key))})]},ie.investition_id))})]})]})}function lx({value:t,onChange:r,sensors:a,placeholder:s}){const[n,i]=m.useState(""),[l,c]=m.useState(!1),h=a.filter(d=>{var p;return d.entity_id.toLowerCase().includes(n.toLowerCase())||((p=d.friendly_name)==null?void 0:p.toLowerCase().includes(n.toLowerCase()))}),g=a.find(d=>d.entity_id===t),o=m.useCallback(d=>{r(d),i(""),c(!1)},[r]),x=m.useCallback(()=>{r(null),i("")},[r]),u=t&&t.length>0;return e.jsxs("div",{className:"relative",children:[u?e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg ${g?"bg-gray-100 dark:bg-gray-700":"bg-amber-50 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700"}`,children:[e.jsxs("span",{className:"flex-1 text-sm truncate",children:[(g==null?void 0:g.friendly_name)||t,!g&&e.jsx("span",{className:"ml-2 text-xs text-amber-600 dark:text-amber-400",children:"(nicht verfgbar)"})]}),e.jsx("button",{onClick:x,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:e.jsx(Rr,{className:"w-4 h-4 text-gray-500"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(Ho,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:d=>{i(d.target.value),c(!0)},onFocus:()=>c(!0),placeholder:s||"Sensor suchen...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"})]}),l&&!t&&e.jsx("div",{className:"absolute z-10 w-full mt-1 max-h-60 overflow-auto bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:h.length===0?e.jsx("div",{className:"px-4 py-3 text-sm text-gray-500",children:n?"Keine Sensoren gefunden":"Sensor eingeben..."}):h.slice(0,50).map(d=>e.jsxs("button",{onClick:()=>o(d.entity_id),className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:d.friendly_name||d.entity_id}),e.jsxs("div",{className:"text-xs text-gray-500 truncate",children:[d.entity_id,d.unit&&` (${d.unit})`,d.state&&` - ${d.state}`]})]},d.entity_id))})]})}function Qe({label:t,einheit:r,value:a,onChange:s,availableSensors:n,strategieOptionen:i,defaultStrategie:l="sensor",kwpAnteil:c,copDefault:h}){const g=(a==null?void 0:a.strategie)||l,o=d=>{d==="keine"?s({strategie:"keine"}):d==="manuell"?s({strategie:"manuell"}):d==="sensor"?s({strategie:"sensor",sensor_id:(a==null?void 0:a.sensor_id)||null}):d==="kwp_verteilung"?s({strategie:"kwp_verteilung",parameter:{anteil:c||0,basis_sensor:"pv_gesamt"}}):d==="cop_berechnung"?s({strategie:"cop_berechnung",parameter:{cop:h||3.5,basis_feld:"stromverbrauch_kwh"}}):d==="ev_quote"&&s({strategie:"ev_quote",parameter:{}})},x=d=>{s({strategie:"sensor",sensor_id:d})},u=d=>{s({strategie:"cop_berechnung",parameter:{...a==null?void 0:a.parameter,cop:d}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",r,")"]})]})}),e.jsx("div",{className:"space-y-3",children:i.map(d=>{var p;return e.jsxs("label",{className:`
              flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-colors
              ${g===d.value?"bg-amber-50 dark:bg-amber-900/20 ring-1 ring-amber-500":"hover:bg-gray-50 dark:hover:bg-gray-700/50"}
            `,children:[e.jsx("input",{type:"radio",name:`strategie-${t}`,checked:g===d.value,onChange:()=>o(d.value),className:"mt-1 w-4 h-4 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:d.label}),d.description&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:d.description}),g==="sensor"&&d.value==="sensor"&&e.jsx("div",{className:"mt-3",children:e.jsx(lx,{value:a==null?void 0:a.sensor_id,onChange:x,sensors:n})}),g==="kwp_verteilung"&&d.value==="kwp_verteilung"&&c!==void 0&&e.jsxs("div",{className:"mt-2 text-xs text-amber-600 dark:text-amber-400",children:[(c*100).toFixed(1),"% von PV Gesamt"]}),g==="cop_berechnung"&&d.value==="cop_berechnung"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"COP:"}),e.jsx("input",{type:"number",step:"0.1",min:"1",max:"10",value:((p=a==null?void 0:a.parameter)==null?void 0:p.cop)||h||3.5,onChange:b=>u(parseFloat(b.target.value)||3.5),className:"w-20 px-2 py-1 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-amber-500"})]})]})]},d.value)})})]})}function ox({value:t,onChange:r,availableSensors:a}){const s=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant Sensor lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard manuell erfassen"}],n=[{value:"sensor",label:"HA-Sensor",description:"PV-Gesamterzeugung aus Wechselrichter-Sensor"},{value:"keine",label:"Nicht verwenden",description:"Jeder PV-String hat einen eigenen Sensor"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{type:"info",title:"Basis-Sensoren",children:"Diese sind die Grundlage fr alle Energie-Berechnungen. Die Werte werden typischerweise vom Stromzhler oder Wechselrichter erfasst."}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Or,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Qe,{label:"Einspeisung",einheit:"kWh",value:t.einspeisung,onChange:i=>r("einspeisung",i),availableSensors:a,strategieOptionen:s})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(bt,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Qe,{label:"Netzbezug",einheit:"kWh",value:t.netzbezug,onChange:i=>r("netzbezug",i),availableSensors:a,strategieOptionen:s})})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Qe,{label:"PV Erzeugung Gesamt",einheit:"kWh",value:t.pv_gesamt,onChange:i=>r("pv_gesamt",i),availableSensors:a,strategieOptionen:n,defaultStrategie:"keine"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Optional: Wenn du mehrere PV-Strings hast, aber nur einen Gesamtsensor, kann die Erzeugung anteilig nach kWp auf die Strings verteilt werden."})]})]})]})}function cx({investitionen:t,mappings:r,onChange:a,availableSensors:s,gesamtKwp:n,basisPvGesamt:i}){const l=(i==null?void 0:i.strategie)==="sensor"&&(i==null?void 0:i.sensor_id);return e.jsxs("div",{className:"space-y-6",children:[t.length>1&&e.jsx(te,{type:"info",title:l?"kWp-Verteilung verfgbar":"Tipp",children:l?e.jsx(e.Fragment,{children:"Du hast einen PV-Gesamt-Sensor konfiguriert. Die Erzeugung kann anteilig auf die einzelnen Strings verteilt werden."}):e.jsx(e.Fragment,{children:'Wenn du keinen separaten Sensor pro String hast, konfiguriere zuerst unter "Basis-Sensoren" einen PV-Gesamt-Sensor.'})}),t.map(c=>{var o,x;const h=n>0&&c.kwp?c.kwp/n:0,g=[{value:"sensor",label:"Eigener Sensor",description:"Separater Sensor fr diesen PV-String"}];return l&&h>0&&g.push({value:"kwp_verteilung",label:`kWp-Verteilung (${(h*100).toFixed(1)}%)`,description:`${(o=c.kwp)==null?void 0:o.toFixed(1)} kWp von ${n.toFixed(1)} kWp gesamt`}),g.push({value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung}),c.kwp&&e.jsxs("div",{className:"text-xs text-gray-500",children:[c.kwp.toFixed(1)," kWp",h>0&&` (${(h*100).toFixed(1)}%)`]})]})]}),e.jsx("div",{className:"p-4",children:e.jsx(Qe,{label:"PV-Erzeugung",einheit:"kWh",value:((x=r[c.id.toString()])==null?void 0:x.pv_erzeugung_kwh)||null,onChange:u=>a(c.id,"pv_erzeugung_kwh",u),availableSensors:s,strategieOptionen:g,kwpAnteil:h,defaultStrategie:l&&h>0?"kwp_verteilung":"sensor"})})]},c.id)})]})}function dx({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Wert direkt aus Home Assistant lesen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor fr Netzladung"},{value:"keine",label:"Nicht erfassen",description:"Speicher wird nicht aus dem Netz geladen"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}];return e.jsx("div",{className:"space-y-6",children:t.map(l=>{var c,h,g;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:l.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Qe,{label:"Ladung",einheit:"kWh",value:((c=r[l.id.toString()])==null?void 0:c.ladung_kwh)||null,onChange:o=>a(l.id,"ladung_kwh",o),availableSensors:s,strategieOptionen:n}),e.jsx(Qe,{label:"Entladung",einheit:"kWh",value:((h=r[l.id.toString()])==null?void 0:h.entladung_kwh)||null,onChange:o=>a(l.id,"entladung_kwh",o),availableSensors:s,strategieOptionen:n}),e.jsx(Qe,{label:"Netzladung",einheit:"kWh",value:((g=r[l.id.toString()])==null?void 0:g.ladung_netz_kwh)||null,onChange:o=>a(l.id,"ladung_netz_kwh",o),availableSensors:s,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2 ml-1",children:"Netzladung wird fr Arbitrage-Auswertung (Speicher aus Netz laden) bentigt."})]})]},l.id)})})}function hx({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Stromverbrauch aus Energiemessung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],i=[{value:"sensor",label:"Wrmemengenzhler",description:"Direkte Messung der Heizenergie"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Stromverbrauch  COP (JAZ)"}],l=[{value:"sensor",label:"Wrmemengenzhler",description:"Separater Sensor fr Warmwasser"},{value:"cop_berechnung",label:"COP-Berechnung",description:"Anteil Strom  COP"},{value:"keine",label:"Nicht separat erfassen",description:"Warmwasser ist in Heizenergie enthalten"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{type:"info",title:"COP-Berechnung",children:"Wenn kein Wrmemengenzhler vorhanden ist, kann die Heizenergie ber den COP (Coefficient of Performance) berechnet werden. Der COP sollte aus den Investitions-Parametern bernommen werden."}),t.map(c=>{var h,g,o;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Br,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung}),c.cop&&e.jsxs("div",{className:"text-xs text-gray-500",children:["JAZ/COP: ",c.cop.toFixed(1)]})]})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-amber-100 dark:bg-amber-900/30 rounded flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(Ne,{className:"w-3 h-3 text-amber-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx(Qe,{label:"Stromverbrauch",einheit:"kWh",value:((h=r[c.id.toString()])==null?void 0:h.stromverbrauch_kwh)||null,onChange:x=>a(c.id,"stromverbrauch_kwh",x),availableSensors:s,strategieOptionen:n})})]}),e.jsx(Qe,{label:"Heizenergie",einheit:"kWh",value:((g=r[c.id.toString()])==null?void 0:g.heizenergie_kwh)||null,onChange:x=>a(c.id,"heizenergie_kwh",x),availableSensors:s,strategieOptionen:i,copDefault:c.cop||3.5}),e.jsx(Qe,{label:"Warmwasser",einheit:"kWh",value:((o=r[c.id.toString()])==null?void 0:o.warmwasser_kwh)||null,onChange:x=>a(c.id,"warmwasser_kwh",x),availableSensors:s,strategieOptionen:l,copDefault:c.cop?c.cop-.5:3,defaultStrategie:"keine"})]})]},c.id)})]})}function gx({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=t.filter(d=>d.typ==="e-auto"),i=t.filter(d=>d.typ==="wallbox"),l=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],c=[{value:"sensor",label:"HA-Sensor",description:"Separater Sensor fr Netzladung"},{value:"ev_quote",label:"EV-Quote berechnen",description:"Basierend auf Anlagen-Eigenverbrauchsquote"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss-Wizard erfassen"}],h=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Kilometerstand monatlich erfassen"}],g=[{value:"sensor",label:"HA-Sensor",description:"V2H/V2G Entladung"},{value:"keine",label:"Nicht vorhanden",description:"Kein Vehicle-to-Home"}],o=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Keine externe Ladung"}],x=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Auto-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Wird aus Ladung berechnet"}],u=[{value:"sensor",label:"HA-Sensor",description:"Z.B. aus Wallbox-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Optional"}];return e.jsxs("div",{className:"space-y-6",children:[n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"E-Autos"]}),n.map(d=>{var p,b,j,f,y,k;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:e.jsx(Te,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:d.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Qe,{label:"Ladung PV",einheit:"kWh",value:((p=r[d.id.toString()])==null?void 0:p.ladung_pv_kwh)||null,onChange:_=>a(d.id,"ladung_pv_kwh",_),availableSensors:s,strategieOptionen:l}),e.jsx(Qe,{label:"Ladung Netz",einheit:"kWh",value:((b=r[d.id.toString()])==null?void 0:b.ladung_netz_kwh)||null,onChange:_=>a(d.id,"ladung_netz_kwh",_),availableSensors:s,strategieOptionen:c}),e.jsx(Qe,{label:"Gefahrene Kilometer",einheit:"km",value:((j=r[d.id.toString()])==null?void 0:j.km_gefahren)||null,onChange:_=>a(d.id,"km_gefahren",_),availableSensors:s,strategieOptionen:h,defaultStrategie:"manuell"}),e.jsx(Qe,{label:"V2H Entladung",einheit:"kWh",value:((f=r[d.id.toString()])==null?void 0:f.v2h_entladung_kwh)||null,onChange:_=>a(d.id,"v2h_entladung_kwh",_),availableSensors:s,strategieOptionen:g,defaultStrategie:"keine"}),e.jsx(Qe,{label:"Verbrauch gesamt",einheit:"kWh",value:((y=r[d.id.toString()])==null?void 0:y.verbrauch_kwh)||null,onChange:_=>a(d.id,"verbrauch_kwh",_),availableSensors:s,strategieOptionen:x,defaultStrategie:"keine"}),e.jsx(Qe,{label:"Ladung Extern",einheit:"kWh",value:((k=r[d.id.toString()])==null?void 0:k.ladung_extern_kwh)||null,onChange:_=>a(d.id,"ladung_extern_kwh",_),availableSensors:s,strategieOptionen:o,defaultStrategie:"keine"})]})]},d.id)})]}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white flex items-center gap-2 mt-8",children:[e.jsx(e0,{className:"w-5 h-5"}),"Wallboxen"]}),e.jsx(te,{type:"info",children:"Wallbox-Ladung wird fr die Gesamtbersicht verwendet. Die Zuordnung PV/Netz erfolgt ber die E-Auto-Konfiguration."}),i.map(d=>{var p,b;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:e.jsx(e0,{className:"w-4 h-4 text-purple-600 dark:text-purple-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:d.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Qe,{label:"Ladung Gesamt",einheit:"kWh",value:((p=r[d.id.toString()])==null?void 0:p.ladung_kwh)||null,onChange:j=>a(d.id,"ladung_kwh",j),availableSensors:s,strategieOptionen:l}),e.jsx(Qe,{label:"Ladevorgnge",einheit:"Anzahl",value:((b=r[d.id.toString()])==null?void 0:b.ladevorgaenge)||null,onChange:j=>a(d.id,"ladevorgaenge",j),availableSensors:s,strategieOptionen:u,defaultStrategie:"keine"})]})]},d.id)})]})]})}function xx({investitionen:t,mappings:r,onChange:a,availableSensors:s}){const n=[{value:"sensor",label:"HA-Sensor",description:"Direkte Messung vom Wechselrichter"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"}],i=[{value:"sensor",label:"HA-Sensor",description:"Falls separater Sensor vorhanden"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Nicht erfassen",description:"Wird aus Erzeugung - Einspeisung berechnet"}],l=[{value:"sensor",label:"HA-Sensor",description:"Z.B. von Speicher-Integration"},{value:"manuell",label:"Manuell eingeben",description:"Im Monatsabschluss erfassen"},{value:"keine",label:"Kein Speicher",description:"BKW ohne Speicher"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{type:"info",children:"Balkonkraftwerke knnen optional einen integrierten Speicher haben. Konfiguriere die Speicher-Felder nur, wenn dein BKW einen Speicher hat."}),t.map(c=>{var h,g,o,x;return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:c.bezeichnung})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Qe,{label:"PV-Erzeugung",einheit:"kWh",value:((h=r[c.id.toString()])==null?void 0:h.pv_erzeugung_kwh)||null,onChange:u=>a(c.id,"pv_erzeugung_kwh",u),availableSensors:s,strategieOptionen:n}),e.jsx(Qe,{label:"Eigenverbrauch",einheit:"kWh",value:((g=r[c.id.toString()])==null?void 0:g.eigenverbrauch_kwh)||null,onChange:u=>a(c.id,"eigenverbrauch_kwh",u),availableSensors:s,strategieOptionen:i,defaultStrategie:"keine"}),e.jsx(Qe,{label:"Speicher Ladung",einheit:"kWh",value:((o=r[c.id.toString()])==null?void 0:o.speicher_ladung_kwh)||null,onChange:u=>a(c.id,"speicher_ladung_kwh",u),availableSensors:s,strategieOptionen:l,defaultStrategie:"keine"}),e.jsx(Qe,{label:"Speicher Entladung",einheit:"kWh",value:((x=r[c.id.toString()])==null?void 0:x.speicher_entladung_kwh)||null,onChange:u=>a(c.id,"speicher_entladung_kwh",u),availableSensors:s,strategieOptionen:l,defaultStrategie:"keine"})]})]},c.id)})]})}const ux={sensor:e.jsx(Jo,{className:"w-4 h-4 text-green-500"}),kwp_verteilung:e.jsx(rs,{className:"w-4 h-4 text-blue-500"}),cop_berechnung:e.jsx(Po,{className:"w-4 h-4 text-purple-500"}),ev_quote:e.jsx(rs,{className:"w-4 h-4 text-amber-500"}),manuell:e.jsx(al,{className:"w-4 h-4 text-gray-500"}),keine:e.jsx(Bo,{className:"w-4 h-4 text-gray-400"})},mx={sensor:"HA-Sensor",kwp_verteilung:"kWp-Verteilung",cop_berechnung:"COP-Berechnung",ev_quote:"EV-Quote",manuell:"Manuell",keine:"Nicht erfassen"},px={"pv-module":e.jsx(ce,{className:"w-4 h-4"}),speicher:e.jsx(Ce,{className:"w-4 h-4"}),waermepumpe:e.jsx(Br,{className:"w-4 h-4"}),"e-auto":e.jsx(Te,{className:"w-4 h-4"}),wallbox:e.jsx(Ne,{className:"w-4 h-4"})};function $s({label:t,mapping:r}){var a,s;return r?e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[ux[r.strategie],e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:mx[r.strategie]}),r.strategie==="sensor"&&r.sensor_id&&e.jsxs("span",{className:"text-xs text-gray-500 max-w-[200px] truncate",children:["(",r.sensor_id,")"]}),r.strategie==="cop_berechnung"&&((a=r.parameter)==null?void 0:a.cop)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(COP: ",r.parameter.cop,")"]}),r.strategie==="kwp_verteilung"&&((s=r.parameter)==null?void 0:s.anteil)&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(r.parameter.anteil*100).toFixed(1),"%)"]})]})]}):e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsx("span",{className:"text-sm text-gray-400 italic",children:"Nicht konfiguriert"})]})}function bx({state:t,investitionen:r}){const a={sensor:0,kwp_verteilung:0,cop_berechnung:0,ev_quote:0,manuell:0,keine:0},s=i=>{i!=null&&i.strategie&&a[i.strategie]++};s(t.basis.einspeisung),s(t.basis.netzbezug),s(t.basis.pv_gesamt),Object.values(t.investitionen).forEach(i=>{Object.values(i).forEach(l=>{s(l)})});const n=a.sensor+a.kwp_verteilung+a.cop_berechnung+a.ev_quote+a.manuell;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(oa,{icon:e.jsx(Jo,{className:"w-5 h-5 text-green-500"}),label:"HA-Sensor",count:a.sensor}),e.jsx(oa,{icon:e.jsx(rs,{className:"w-5 h-5 text-blue-500"}),label:"kWp-Verteilung",count:a.kwp_verteilung}),e.jsx(oa,{icon:e.jsx(Po,{className:"w-5 h-5 text-purple-500"}),label:"COP-Berechnung",count:a.cop_berechnung}),e.jsx(oa,{icon:e.jsx(rs,{className:"w-5 h-5 text-amber-500"}),label:"EV-Quote",count:a.ev_quote}),e.jsx(oa,{icon:e.jsx(al,{className:"w-5 h-5 text-gray-500"}),label:"Manuell",count:a.manuell}),e.jsx(oa,{icon:e.jsx(Bo,{className:"w-5 h-5 text-gray-400"}),label:"Keine",count:a.keine})]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[n," Felder konfiguriert"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Basis-Sensoren"})]}),e.jsxs("div",{className:"px-4 py-2",children:[e.jsx($s,{label:"Einspeisung",mapping:t.basis.einspeisung}),e.jsx($s,{label:"Netzbezug",mapping:t.basis.netzbezug}),e.jsx($s,{label:"PV Gesamt",mapping:t.basis.pv_gesamt})]})]}),r.map(i=>{const l=t.investitionen[i.id.toString()]||{};return Object.keys(l).length===0?null:e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:px[i.typ]||e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:i.bezeichnung}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.typ,")"]})]}),e.jsx("div",{className:"px-4 py-2",children:Object.entries(l).map(([c,h])=>e.jsx($s,{label:c.replace(/_/g," ").replace("kwh","(kWh)"),mapping:h},c))})]},i.id)})]})}function oa({icon:t,label:r,count:a}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"flex justify-center mb-1",children:t}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:a}),e.jsx("div",{className:"text-xs text-gray-500",children:r})]})}const N0={basis:{einspeisung:null,netzbezug:null,pv_gesamt:null},investitionen:{}};function fx(){var J,Ie,ye;const t=lr(),[r]=zd(),a=r.get("anlage"),s=a?parseInt(a,10):null,[n,i]=m.useState(0),[l,c]=m.useState(N0),[h,g]=m.useState(null),[o,x]=m.useState(!1),[u,d]=m.useState(!1),[p,b]=m.useState(!1),[j,f]=m.useState(null),[y,k]=m.useState(null),[_,w]=m.useState(!1),[v,E]=m.useState(!1),[F,C]=m.useState(!1),[D,A]=m.useState(!1),[S,W]=m.useState(null),[N,z]=m.useState(null),[$,T]=m.useState([]),[I,V]=m.useState(!0),[G,Z]=m.useState(null),R=s||((J=S==null?void 0:S[0])==null?void 0:J.id);m.useEffect(()=>{async function re(){var xe,U,pe,Oe;V(!0),Z(null);try{if(!s){const $e=await Lt.list();if(W($e),!$e.length){V(!1);return}}const B=s||((xe=S==null?void 0:S[0])==null?void 0:xe.id);if(!B)return;const[le,We]=await Promise.all([Wa.getMapping(B),Wa.getAvailableSensors(B).catch(()=>[])]);if(z(le),T(We),le!=null&&le.mapping){const $e=le.mapping;c({basis:{einspeisung:((U=$e.basis)==null?void 0:U.einspeisung)||null,netzbezug:((pe=$e.basis)==null?void 0:pe.netzbezug)||null,pv_gesamt:((Oe=$e.basis)==null?void 0:Oe.pv_gesamt)||null},investitionen:Object.fromEntries(Object.entries($e.investitionen||{}).map(([Re,xt])=>[Re,xt.felder||{}]))})}}catch(B){Z(B.message||"Fehler beim Laden")}finally{V(!1)}}re()},[s,(Ie=S==null?void 0:S[0])==null?void 0:Ie.id]);const M=m.useMemo(()=>{var U,pe,Oe,B,le,We;if(!N)return[];const re=[{id:"basis",title:"Basis-Sensoren",icon:e.jsx(Ne,{className:"w-5 h-5"})}],xe=N.investitionen.reduce(($e,Re)=>($e[Re.typ]||($e[Re.typ]=[]),$e[Re.typ].push(Re),$e),{});return(U=xe["pv-module"])!=null&&U.length&&re.push({id:"pv",title:"PV-Module",icon:e.jsx(ce,{className:"w-5 h-5"}),investitionen:xe["pv-module"]}),(pe=xe.speicher)!=null&&pe.length&&re.push({id:"speicher",title:"Speicher",icon:e.jsx(Ce,{className:"w-5 h-5"}),investitionen:xe.speicher}),(Oe=xe.waermepumpe)!=null&&Oe.length&&re.push({id:"wp",title:"Wrmepumpe",icon:e.jsx(Br,{className:"w-5 h-5"}),investitionen:xe.waermepumpe}),((B=xe["e-auto"])!=null&&B.length||(le=xe.wallbox)!=null&&le.length)&&re.push({id:"eauto",title:"E-Auto & Wallbox",icon:e.jsx(Te,{className:"w-5 h-5"}),investitionen:[...xe["e-auto"]||[],...xe.wallbox||[]]}),(We=xe.balkonkraftwerk)!=null&&We.length&&re.push({id:"bkw",title:"Balkonkraftwerk",icon:e.jsx(ce,{className:"w-5 h-5"}),investitionen:xe.balkonkraftwerk}),re.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(Nr,{className:"w-5 h-5"})}),re},[N]),H=m.useCallback((re,xe)=>{c(U=>({...U,basis:{...U.basis,[re]:xe}}))},[]),K=m.useCallback((re,xe,U)=>{U&&c(pe=>({...pe,investitionen:{...pe.investitionen,[re.toString()]:{...pe.investitionen[re.toString()],[xe]:U}}}))},[]),O=m.useCallback(async()=>{if(R){x(!0),g(null);try{const re={basis:{einspeisung:l.basis.einspeisung,netzbezug:l.basis.netzbezug,pv_gesamt:l.basis.pv_gesamt},investitionen:Object.fromEntries(Object.entries(l.investitionen).map(([xe,U])=>[xe,{felder:U}]))};await Wa.saveMapping(R,re),d(!0)}catch(re){g(re.message||"Fehler beim Speichern")}finally{x(!1)}}},[l,R]),ee=m.useCallback(async()=>{if(R){b(!0);try{const re=await Wa.initStartValues(R);f(re)}catch(re){f({success:!1,message:re.message||"Fehler beim Initialisieren",updated_fields:0})}finally{b(!1)}}},[R]);m.useEffect(()=>{u&&y===null&&(w(!0),ur.getStatus().then(re=>k(re.verfuegbar)).catch(()=>k(!1)).finally(()=>w(!1)))},[u,y]);const de=m.useCallback(async()=>{if(R){E(!0);try{const re=new Date,xe=re.getFullYear(),U=re.getMonth()+1,Oe=(await ur.getMonatsanfangWerte(R,xe,U)).startwerte||{},B=Object.keys(Oe).length;B>0?f({success:!0,message:`Startwerte fr ${U}/${xe} aus HA-Statistik geladen`,updated_fields:B}):f({success:!1,message:"Keine Daten in HA-Statistik fr diesen Monat gefunden. Mglicherweise sind noch keine Langzeit-Statistiken fr die konfigurierten Sensoren vorhanden.",updated_fields:0})}catch(re){f({success:!1,message:re.message||"Fehler beim Laden aus HA-Statistik",updated_fields:0})}finally{E(!1)}}},[R]),ue=m.useCallback(()=>{t("/einstellungen/ha-export?saved=true")},[t]),Me=m.useCallback(async()=>{if(R){C(!0);try{await Wa.deleteMapping(R),c(N0),z(re=>re?{...re,mapping:null,mqtt_setup_complete:!1}:null),A(!1),window.location.reload()}catch(re){g(re.message||"Fehler beim Lschen")}finally{C(!1)}}},[R]),Ae=n<M.length-1,Be=n>0,ne=n===M.length-1,Ee=()=>{Ae&&i(re=>re+1)},ie=()=>{Be&&i(re=>re-1)};if(!R&&!I)return e.jsx("div",{className:"p-6",children:e.jsx(te,{type:"warning",children:"Keine Anlage vorhanden. Bitte zuerst eine Anlage erstellen."})});if(I)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Ke,{className:"w-8 h-8 animate-spin text-amber-500"})});if(G)return e.jsx("div",{className:"p-6",children:e.jsxs(te,{type:"error",children:["Fehler beim Laden: ",G]})});if(u)return e.jsx("div",{className:"max-w-2xl mx-auto p-6 space-y-6",children:e.jsxs(P,{children:[e.jsx(n0,{title:"Sensor-Zuordnung gespeichert",subtitle:"MQTT-Sensoren wurden erfolgreich erstellt"}),e.jsx("div",{className:"mt-6 space-y-4",children:j?e.jsxs(e.Fragment,{children:[e.jsx(te,{type:j.success?"success":"error",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:j.message}),j.updated_fields>0&&e.jsxs("p",{className:"text-sm opacity-80",children:[j.updated_fields," Startwert(e) wurden in Home Assistant gesetzt."]})]})}),e.jsxs(se,{onClick:ue,children:[e.jsx(Nr,{className:"w-4 h-4 mr-2"}),"Fertig"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{type:"info",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Mchten Sie die Monatsstart-Werte jetzt initialisieren?"}),e.jsx("p",{className:"text-sm opacity-80",children:"Die Startwerte werden als Basis fr die monatliche Berechnung bentigt. Der berechnete Monatswert startet dann bei 0 und steigt mit der Zeit."})]})}),e.jsxs("div",{className:"space-y-3",children:[_?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(Ke,{className:"w-4 h-4 animate-spin"}),"Prfe HA-Statistik-Verfgbarkeit..."]}):y&&e.jsxs("div",{className:"p-4 border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200 mb-2",children:[e.jsx("strong",{children:"Empfohlen:"})," Startwerte aus HA-Langzeitstatistik laden"]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mb-3",children:"Verwendet die gespeicherten Zhlerstnde vom Monatsanfang aus der HA-Datenbank."}),e.jsx(se,{onClick:de,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Lade aus HA-DB..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Nr,{className:"w-4 h-4 mr-2"}),"Aus HA-Statistik laden (empfohlen)"]})})]}),e.jsxs("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Aktuelle Sensor-Werte als Startwerte setzen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:"Verwendet die aktuellen Zhlerstnde. Der Monatswert startet dann bei 0."}),e.jsx(se,{variant:"secondary",onClick:ee,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Initialisiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Aktuelle Werte verwenden"]})})]}),e.jsx(se,{variant:"secondary",onClick:ue,className:"mt-2",children:"berspringen"})]})]})})]})});if(M.length===0)return e.jsx("div",{className:"p-6",children:e.jsx(te,{type:"info",children:"Keine Konfiguration erforderlich. Bitte zuerst Investitionen (PV-Module, Speicher, etc.) anlegen."})});const q=M[n];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sensor-Zuordnung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[N==null?void 0:N.anlage_name," - Home Assistant Sensoren konfigurieren"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(N==null?void 0:N.mapping)&&Object.keys(N.mapping).length>0&&e.jsxs(se,{variant:"secondary",onClick:()=>A(!0),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Mapping lschen"]}),e.jsx(se,{variant:"secondary",onClick:()=>t(-1),children:"Abbrechen"})]})]}),D&&e.jsx(te,{type:"warning",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Sensor-Mapping wirklich lschen?"}),e.jsx("p",{className:"text-sm mt-1",children:"Alle Sensor-Zuordnungen und MQTT-Entities werden entfernt. Die Monatsdaten bleiben erhalten."})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(se,{variant:"secondary",size:"sm",onClick:()=>A(!1),disabled:F,children:"Abbrechen"}),e.jsx(se,{size:"sm",onClick:Me,disabled:F,className:"bg-red-600 hover:bg-red-700",children:F?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Lsche..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Lschen"]})})]})]})}),e.jsx(P,{padding:"sm",children:e.jsx("div",{className:"flex items-center overflow-x-auto py-2",children:M.map((re,xe)=>{const U=xe<n,pe=xe===n;return e.jsxs("div",{className:"flex items-center flex-shrink-0",children:[e.jsxs("button",{onClick:()=>i(xe),className:`
                    flex items-center gap-2 px-3 py-2 rounded-lg transition-all
                    ${pe?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":U?"text-green-600 dark:text-green-400 hover:bg-gray-100 dark:hover:bg-gray-700":"text-gray-400 dark:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("div",{className:`
                      w-7 h-7 rounded-full flex items-center justify-center text-sm
                      ${U?"bg-green-500 text-white":pe?"bg-amber-500 text-white":"bg-gray-200 dark:bg-gray-700"}
                    `,children:U?e.jsx(Nr,{className:"w-4 h-4"}):xe+1}),e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:re.title})]}),xe<M.length-1&&e.jsx(Yt,{className:"w-5 h-5 text-gray-300 dark:text-gray-600 mx-1"})]},re.id)})})}),e.jsxs(P,{children:[e.jsx(n0,{title:q.title,subtitle:q.id==="basis"?"Ordne die grundlegenden Energie-Sensoren zu":q.id==="summary"?"berprfe deine Einstellungen":`Konfiguriere die Sensoren fr ${((ye=q.investitionen)==null?void 0:ye.length)||0} Komponente(n)`,action:e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[q.icon,e.jsxs("span",{className:"text-sm",children:[n+1," / ",M.length]})]})}),e.jsxs("div",{className:"mt-6",children:[q.id==="basis"&&e.jsx(ox,{value:l.basis,onChange:H,availableSensors:$}),q.id==="pv"&&e.jsx(cx,{investitionen:q.investitionen||[],mappings:l.investitionen,onChange:K,availableSensors:$,gesamtKwp:(N==null?void 0:N.gesamt_kwp)||0,basisPvGesamt:l.basis.pv_gesamt}),q.id==="speicher"&&e.jsx(dx,{investitionen:q.investitionen||[],mappings:l.investitionen,onChange:K,availableSensors:$}),q.id==="wp"&&e.jsx(hx,{investitionen:q.investitionen||[],mappings:l.investitionen,onChange:K,availableSensors:$}),q.id==="eauto"&&e.jsx(gx,{investitionen:q.investitionen||[],mappings:l.investitionen,onChange:K,availableSensors:$}),q.id==="bkw"&&e.jsx(xx,{investitionen:q.investitionen||[],mappings:l.investitionen,onChange:K,availableSensors:$}),q.id==="summary"&&e.jsx(bx,{state:l,investitionen:(N==null?void 0:N.investitionen)||[]})]}),h&&e.jsxs(te,{type:"error",className:"mt-6",children:[e.jsx(ct,{className:"w-4 h-4 inline mr-2"}),h]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(se,{variant:"secondary",onClick:ie,disabled:!Be,children:[e.jsx(Do,{className:"w-4 h-4 mr-2"}),"Zurck"]}),ne?e.jsx(se,{onClick:O,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 mr-2 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vr,{className:"w-4 h-4 mr-2"}),"Speichern & Abschlieen"]})}):e.jsxs(se,{onClick:Ee,children:["Weiter",e.jsx(Yt,{className:"w-4 h-4 ml-2"})]})]})]})]})}function yx({positionen:t,onChange:r}){const[a,s]=m.useState(t.length>0),n=()=>{r([...t,{bezeichnung:"",betrag:0,typ:"ausgabe"}]),s(!0)},i=o=>{r(t.filter((x,u)=>u!==o))},l=(o,x,u)=>{const d=[...t];d[o]={...d[o],[x]:u},r(d)},c=t.filter(o=>o.typ==="ertrag").reduce((o,x)=>o+(x.betrag||0),0),h=t.filter(o=>o.typ==="ausgabe").reduce((o,x)=>o+(x.betrag||0),0),g=c-h;return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:!a&&t.length===0?e.jsx("button",{type:"button",onClick:n,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonstige Ertrge & Ausgaben erfassen"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"Sonstige Ertrge & Ausgaben"}),e.jsx("button",{type:"button",onClick:n,className:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"+ Position"})]}),t.map((o,x)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsxs("div",{className:"col-span-5",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Bezeichnung"}),e.jsx("input",{type:"text",value:o.bezeichnung,onChange:u=>l(x,"bezeichnung",u.target.value),placeholder:"z.B. THG-Quote, Reparatur",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"col-span-3",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Betrag (EUR)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:o.betrag||"",onChange:u=>l(x,"betrag",parseFloat(u.target.value)||0),placeholder:"0.00",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"col-span-3",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Typ"}),e.jsxs("select",{value:o.typ,onChange:u=>l(x,"typ",u.target.value),className:"input text-sm py-1.5",title:"Typ: Ertrag oder Ausgabe",children:[e.jsx("option",{value:"ertrag",children:"Ertrag"}),e.jsx("option",{value:"ausgabe",children:"Ausgabe"})]})]}),e.jsxs("div",{className:"col-span-1 flex justify-center",children:[x===0&&e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:""}),e.jsx("button",{type:"button",onClick:()=>i(x),className:"text-red-400 hover:text-red-600 dark:text-red-500 dark:hover:text-red-400 p-1 text-sm",title:"Position entfernen",children:""})]})]},x)),t.length>0&&e.jsxs("div",{className:"text-xs flex gap-3 pt-1",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Ertrge: ",c.toFixed(2)," "]}),e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["Ausgaben: ",h.toFixed(2)," "]}),e.jsxs("span",{className:`font-medium ${g>=0?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:["Netto: ",g>=0?"+":"",g.toFixed(2)," "]})]})]})})}const jx=["","Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],ul={"pv-module":e.jsx(ce,{className:"w-5 h-5"}),speicher:e.jsx(Ce,{className:"w-5 h-5"}),waermepumpe:e.jsx(Br,{className:"w-5 h-5"}),"e-auto":e.jsx(Te,{className:"w-5 h-5"}),wallbox:e.jsx(Ne,{className:"w-5 h-5"}),balkonkraftwerk:e.jsx(ce,{className:"w-5 h-5"}),sonstiges:e.jsx(as,{className:"w-5 h-5"})};function Un(){const{anlageId:t,jahr:r,monat:a}=Sd(),s=lr(),n=ll(),[i,l]=m.useState(!0),[c,h]=m.useState(!1),[g,o]=m.useState(!1),[x,u]=m.useState(null),[d,p]=m.useState(null),[b,j]=m.useState(null),[f,y]=m.useState(""),[k,_]=m.useState(null),[w,v]=m.useState(0),[E,F]=m.useState({basis:{},optionale:{},investitionen:{},sonstigePositionen:{}}),[C,D]=m.useState(r?parseInt(r):new Date().getFullYear()),[A,S]=m.useState(a?parseInt(a):new Date().getMonth()+1);m.useEffect(()=>{(async()=>{if(!t){try{const V=await Lt.list();V.length>0?s(`/monatsabschluss/${V[0].id}`):u("Keine Anlage gefunden")}catch{u("Fehler beim Laden der Anlagen")}l(!1);return}l(!0),u(null);try{let V=C,G=A;if(!r||!a){const O=await Tn.getNaechsterMonat(parseInt(t));O&&(V=O.jahr,G=O.monat,D(V),S(G))}const Z=await Tn.getStatus(parseInt(t),V,G);_(Z),y(Z.anlage_name);const R={};for(const O of Z.basis_felder)R[O.feld]=O.aktueller_wert;const M={};for(const O of Z.optionale_felder||[])O.typ==="text"?M[O.feld]=O.aktueller_text:M[O.feld]=O.aktueller_wert;const H={},K={};for(const O of Z.investitionen){H[O.id]={};for(const ee of O.felder)H[O.id][ee.feld]=ee.aktueller_wert;K[O.id]=O.sonstige_positionen||[]}F({basis:R,optionale:M,investitionen:H,sonstigePositionen:K})}catch(V){u("Fehler beim Laden der Monatsdaten"),console.error(V)}finally{l(!1)}})()},[t,r,a,C,A,s]);const W=m.useMemo(()=>{if(!k)return[];const I=[{id:"basis",title:"Zhlerdaten",icon:e.jsx(Ne,{className:"w-4 h-4"})}],V={};for(const G of k.investitionen)V[G.typ]||(V[G.typ]=[]),V[G.typ].push(G);for(const G of Object.keys(V))I.push({id:G,title:rc(G),icon:ul[G]||e.jsx(Ne,{className:"w-4 h-4"})});return k.optionale_felder&&k.optionale_felder.length>0&&I.push({id:"optionale",title:"Sonstiges",icon:e.jsx($n,{className:"w-4 h-4"})}),I.push({id:"summary",title:"Zusammenfassung",icon:e.jsx(vt,{className:"w-4 h-4"})}),I},[k]),N=(I,V,G)=>{F(G?Z=>({...Z,investitionen:{...Z.investitionen,[G]:{...Z.investitionen[G],[I]:V}}}):Z=>({...Z,basis:{...Z.basis,[I]:V}}))},z=(I,V)=>{F(G=>({...G,optionale:{...G.optionale,[I]:V}}))},$=async()=>{if(t){o(!0),u(null),j(null);try{if(!(await ur.getStatus()).verfuegbar){u("Home Assistant Datenbank nicht verfgbar");return}const V=await ur.getMonatswerte(parseInt(t),C,A);let G=0;const Z={...E.basis};for(const M of V.basis)M.wert!==null&&M.wert!==void 0&&(Z[M.feld]=M.wert,G++);const R={...E.investitionen};for(const M of V.investitionen){R[M.investition_id]||(R[M.investition_id]={});for(const H of M.felder)H.wert!==null&&H.wert!==void 0&&(R[M.investition_id][H.feld]=H.wert,G++)}F(M=>({...M,basis:Z,investitionen:R})),j(`${G} Werte aus HA-Statistik geladen`)}catch(I){console.error(I),u("Fehler beim Laden der HA-Werte. Ist das Sensor-Mapping konfiguriert?")}finally{o(!1)}}},T=async()=>{if(!(!k||!t)){h(!0),u(null),p(null);try{const I={einspeisung_kwh:E.basis.einspeisung_kwh,netzbezug_kwh:E.basis.netzbezug_kwh,globalstrahlung_kwh_m2:E.basis.globalstrahlung_kwh_m2,sonnenstunden:E.basis.sonnenstunden,durchschnittstemperatur:E.basis.durchschnittstemperatur,sonderkosten_euro:typeof E.optionale.sonderkosten_euro=="number"?E.optionale.sonderkosten_euro:null,sonderkosten_beschreibung:typeof E.optionale.sonderkosten_beschreibung=="string"?E.optionale.sonderkosten_beschreibung:null,notizen:typeof E.optionale.notizen=="string"?E.optionale.notizen:null,investitionen:[]};for(const G of k.investitionen){const Z=[],R=E.investitionen[G.id]||{};for(const[K,O]of Object.entries(R))O!=null&&Z.push({feld:K,wert:O});const H=(E.sonstigePositionen[G.id]||[]).filter(K=>K.betrag>0&&K.bezeichnung.trim());(Z.length>0||H.length>0)&&I.investitionen.push({investition_id:G.id,felder:Z,sonstige_positionen:H.length>0?H:null})}const V=await Tn.save(parseInt(t),C,A,I);V.success?(p(V.message),setTimeout(()=>{s("/einstellungen/monatsdaten")},2e3)):u("Speichern fehlgeschlagen")}catch(I){u("Fehler beim Speichern"),console.error(I)}finally{h(!1)}}};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ke,{className:"w-8 h-8 animate-spin text-primary-500"})}):x&&!k?e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(te,{type:"error",children:x})}):k?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-2",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{children:f})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Monatsabschluss ",jx[A]," ",C]}),k.ha_mapping_konfiguriert?e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsx("button",{onClick:$,disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 animate-spin"}),"Lade HA-Werte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yr,{className:"w-4 h-4"}),"Werte aus HA-Statistik laden"]})}),b&&e.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:b})]}):n&&e.jsx(te,{type:"info",className:"mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Home Assistant Sensor-Zuordnung nicht konfiguriert. Werte mssen manuell eingegeben werden."}),e.jsxs(ha,{to:`/einstellungen/sensor-mapping?anlageId=${t}`,className:"flex items-center gap-1 text-primary-600 hover:underline",children:[e.jsx(sl,{className:"w-4 h-4"}),"Konfigurieren"]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:W.map((I,V)=>e.jsxs("button",{onClick:()=>v(V),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${w===V?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:[I.icon,e.jsx("span",{className:"hidden sm:inline",children:I.title})]},I.id))})}),x&&e.jsx(te,{type:"error",className:"mb-6",children:x}),d&&e.jsx(te,{type:"success",className:"mb-6",children:d}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-8",children:[w===0&&e.jsx(kx,{felder:k.basis_felder,values:E.basis,onChange:(I,V)=>N(I,V)}),w>0&&w<W.length-1&&W[w].id!=="optionale"&&e.jsx(wx,{typ:W[w].id,investitionen:k.investitionen.filter(I=>I.typ===W[w].id),values:E.investitionen,onChange:(I,V,G)=>N(V,G,I),sonstigePositionen:E.sonstigePositionen,onSonstigePositionenChange:(I,V)=>F(G=>({...G,sonstigePositionen:{...G.sonstigePositionen,[I]:V}}))}),W[w].id==="optionale"&&e.jsx(vx,{felder:k.optionale_felder||[],values:E.optionale,onChange:z}),w===W.length-1&&e.jsx(Nx,{data:k,values:E})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>v(I=>Math.max(0,I-1)),disabled:w===0,className:"flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Do,{className:"w-4 h-4"}),"Zurck"]}),w<W.length-1?e.jsxs("button",{onClick:()=>v(I=>Math.min(W.length-1,I+1)),className:"flex items-center gap-2 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:["Weiter",e.jsx(Yt,{className:"w-4 h-4"})]}):e.jsx("button",{onClick:T,disabled:c,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:[e.jsx(gh,{className:"w-4 h-4"}),"Speichern"]})})]})]}):e.jsx("div",{className:"max-w-2xl mx-auto p-6",children:e.jsx(te,{type:"info",children:"Keine Daten verfgbar"})})}function kx({felder:t,values:r,onChange:a}){const s=["einspeisung_kwh","netzbezug_kwh"],n=["globalstrahlung_kwh_m2","sonnenstunden","durchschnittstemperatur"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-amber-500"}),"Zhlerdaten"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.filter(i=>s.includes(i.feld)).map(i=>e.jsx(yi,{feld:i,value:r[i.feld],onChange:l=>a(i.feld,l)},i.feld))}),e.jsxs("details",{className:"mt-6",children:[e.jsx("summary",{className:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Wetterdaten (optional)"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:t.filter(i=>n.includes(i.feld)).map(i=>e.jsx(yi,{feld:i,value:r[i.feld],onChange:l=>a(i.feld,l),compact:!0},i.feld))})]})]})}function vx({felder:t,values:r,onChange:a}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx($n,{className:"w-5 h-5 text-gray-500"}),"Sonstiges"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Optionale Eingaben fr diesen Monat - knnen auch leer bleiben."}),e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[s.label,s.einheit&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",s.einheit,")"]})]}),s.typ==="text"?e.jsx("textarea",{value:r[s.feld]||"",onChange:n=>a(s.feld,n.target.value||null),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:s.label}):e.jsx("input",{type:"number",step:"0.01",value:r[s.feld]??"",onChange:n=>a(s.feld,n.target.value?parseFloat(n.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:s.label})]},s.feld))})]})}function wx({typ:t,investitionen:r,values:a,onChange:s,sonstigePositionen:n,onSonstigePositionenChange:i}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[ul[t],rc(t)]}),r.map(l=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white",children:[l.bezeichnung,l.kategorie&&e.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-500 dark:text-gray-400",children:["(",l.kategorie,")"]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:l.felder.map(c=>{var h;return e.jsx(yi,{feld:c,value:(h=a[l.id])==null?void 0:h[c.feld],onChange:g=>s(l.id,c.feld,g)},c.feld)})}),e.jsx(yx,{positionen:n[l.id]||[],onChange:c=>i(l.id,c)})]})]},l.id))]})}function Nx({data:t,values:r}){var n,i;let a=0,s=0;for(const l of t.basis_felder)["einspeisung_kwh","netzbezug_kwh"].includes(l.feld)&&(s++,r.basis[l.feld]!==null&&r.basis[l.feld]!==void 0&&a++);for(const l of t.investitionen)for(const c of l.felder)s++,((n=r.investitionen[l.id])==null?void 0:n[c.feld])!==null&&((i=r.investitionen[l.id])==null?void 0:i[c.feld])!==void 0&&a++;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-green-500"}),"Zusammenfassung"]}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("span",{className:"font-medium text-green-800 dark:text-green-200",children:[a," von ",s," Feldern ausgefllt"]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50",children:e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Zhlerdaten"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:t.basis_felder.filter(l=>["einspeisung_kwh","netzbezug_kwh"].includes(l.feld)).map(l=>e.jsx(Yn,{label:l.label,wert:r.basis[l.feld],einheit:l.einheit},l.feld))})]}),t.investitionen.map(l=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[ul[l.typ],e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:l.bezeichnung})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:l.felder.map(c=>{var h;return e.jsx(Yn,{label:c.label,wert:(h=r.investitionen[l.id])==null?void 0:h[c.feld],einheit:c.einheit},c.feld)})})]},l.id)),t.optionale_felder&&t.optionale_felder.length>0&&e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center gap-2",children:[e.jsx($n,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:t.optionale_felder.map(l=>e.jsx(Yn,{label:l.label,wert:(l.typ==="text",r.optionale[l.feld]),einheit:l.einheit,isText:l.typ==="text"},l.feld))})]})]})}function yi({feld:t,value:r,onChange:a,compact:s=!1}){const n=t.warnungen.length>0,i=t.vorschlaege.length>0;return e.jsxs("div",{className:s?"":"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.label,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t.einheit,")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:r??"",onChange:l=>a(l.target.value?parseFloat(l.target.value):null),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${n?"border-amber-300 focus:border-amber-500":"border-gray-300"}`,placeholder:i?`Vorschlag: ${t.vorschlaege[0].wert}`:""}),i&&r===null&&e.jsx("button",{type:"button",onClick:()=>a(t.vorschlaege[0].wert),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-primary-600 hover:text-primary-700 dark:text-primary-400",children:"bernehmen"})]}),i&&!s&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:t.vorschlaege.slice(0,3).map((l,c)=>e.jsxs("button",{type:"button",onClick:()=>a(l.wert),className:"text-xs px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300",title:l.beschreibung,children:[l.wert," ",t.einheit,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",l.quelle,")"]})]},c))}),n&&e.jsx("div",{className:"mt-1",children:t.warnungen.map((l,c)=>e.jsxs("div",{className:`flex items-center gap-1 text-xs ${l.schwere==="error"?"text-red-600 dark:text-red-400":l.schwere==="warning"?"text-amber-600 dark:text-amber-400":"text-blue-600 dark:text-blue-400"}`,children:[l.schwere==="error"?e.jsx(pt,{className:"w-3 h-3"}):l.schwere==="warning"?e.jsx(pt,{className:"w-3 h-3"}):e.jsx(nt,{className:"w-3 h-3"}),l.meldung]},c))})]})}function Yn({label:t,wert:r,einheit:a,isText:s=!1}){const n=r!=null&&r!=="";return e.jsxs("div",{className:"flex items-center justify-between px-4 py-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n?s?e.jsx("span",{className:"max-w-xs truncate",children:r}):e.jsxs(e.Fragment,{children:[typeof r=="number"?r.toLocaleString("de-DE",{maximumFractionDigits:1}):r," ",a]}):e.jsx("span",{className:"text-gray-400 italic",children:"nicht ausgefllt"})})]})}function rc(t){return{"pv-module":"PV-Module",speicher:"Speicher",waermepumpe:"Wrmepumpe","e-auto":"E-Auto",wallbox:"Wallbox",balkonkraftwerk:"Balkonkraftwerk"}[t]||t}function _x(){const t=lr(),[r,a]=m.useState([]),[s,n]=m.useState(null),[i,l]=m.useState(!0),[c,h]=m.useState(!1),[g,o]=m.useState(!1),[x,u]=m.useState(!1),[d,p]=m.useState(null),[b,j]=m.useState(null),[f,y]=m.useState(null),[k,_]=m.useState(null),[w,v]=m.useState(null),[E,F]=m.useState(new Set),[C,D]=m.useState(new Map),[A,S]=m.useState("alle"),[W,N]=m.useState(new Map);m.useEffect(()=>{(async()=>{try{const O=await Lt.list();a(O.map(ee=>({id:ee.id,anlagenname:ee.anlagenname}))),O.length>0&&n(O[0].id)}catch(O){_("Fehler beim Laden der Anlagen"),console.error(O)}finally{l(!1)}})()},[]),m.useEffect(()=>{(async()=>{h(!0);try{const O=await ur.getStatus();p(O.verfuegbar),j(O.fehler||null)}catch(O){p(!1),j("Fehler bei der Statusprfung"),console.error(O)}finally{h(!1)}})()},[]);const z=async()=>{if(s){o(!0),_(null),y(null),D(new Map),N(new Map);try{const K=await ur.getImportVorschau(s);y(K);const O=new Map,ee=new Map;K.monate.forEach(de=>{const ue=`${de.jahr}-${de.monat}`;O.set(ue,de.aktion==="importieren"||de.aktion==="konflikt");const Me=new Set(Object.keys(de.ha_werte)),Ae=new Map;de.investitionen&&de.investitionen.forEach(Be=>{Ae.set(Be.investition_id,new Set(Object.keys(Be.ha_werte)))}),ee.set(ue,{basis:Me,investitionen:Ae})}),D(O),N(ee)}catch(K){_("Fehler beim Laden der Vorschau"),console.error(K)}finally{o(!1)}}},$=(K,O)=>{const ee=`${K}-${O}`,de=new Map(C);de.set(ee,!de.get(ee)),D(de)},T=(K,O,ee)=>{const de=`${K}-${O}`,ue=new Map(W),Me=ue.get(de)||{basis:new Set,investitionen:new Map},Ae=new Set(Me.basis);Ae.has(ee)?Ae.delete(ee):Ae.add(ee),ue.set(de,{...Me,basis:Ae}),N(ue),S("manuell")},I=(K,O,ee,de)=>{const ue=`${K}-${O}`,Me=new Map(W),Ae=Me.get(ue)||{basis:new Set,investitionen:new Map},Be=new Map(Ae.investitionen),ne=new Set(Be.get(ee)||[]);ne.has(de)?ne.delete(de):ne.add(de),Be.set(ee,ne),Me.set(ue,{...Ae,investitionen:Be}),N(Me),S("manuell")},V=K=>{if(S(K),!f)return;const O=new Map;f.monate.forEach(ee=>{var Ae,Be;const de=`${ee.jahr}-${ee.monat}`;let ue=new Set;const Me=new Map;switch(K){case"alle":ue=new Set(Object.keys(ee.ha_werte)),(Ae=ee.investitionen)==null||Ae.forEach(Ee=>{Me.set(Ee.investition_id,new Set(Object.keys(Ee.ha_werte)))});break;case"nur_basis":ue=new Set(Object.keys(ee.ha_werte));break;case"nur_komponenten":(Be=ee.investitionen)==null||Be.forEach(Ee=>{Me.set(Ee.investition_id,new Set(Object.keys(Ee.ha_werte)))});break;case"manuell":const ne=W.get(de);if(ne){O.set(de,ne);return}break}O.set(de,{basis:ue,investitionen:Me})}),N(O)},G=(f==null?void 0:f.monate.filter(K=>{const O=`${K.jahr}-${K.monat}`;return C.get(O)&&K.aktion!=="ueberspringen"}).length)||0,Z=async()=>{if(!s||!f)return;const K=f.monate.filter(O=>{const ee=`${O.jahr}-${O.monat}`;return C.get(ee)&&O.aktion!=="ueberspringen"}).map(O=>{const ee=`${O.jahr}-${O.monat}`,de=W.get(ee),ue=de!=null&&de.basis.size?Array.from(de.basis):[],Me={};return de==null||de.investitionen.forEach((Ae,Be)=>{Ae.size>0&&(Me[String(Be)]=Array.from(Ae))}),{jahr:O.jahr,monat:O.monat,basis_felder:ue.length>0?ue:[],investition_felder:Object.keys(Me).length>0?Me:{}}}).filter(O=>O.basis_felder&&O.basis_felder.length>0||O.investition_felder&&Object.keys(O.investition_felder).length>0);if(K.length===0){_("Keine Felder zum Import ausgewhlt");return}u(!0),_(null),v(null);try{const O=await ur.importieren(s,{monate:K,ueberschreiben:!0});O.erfolg?(v(`Import erfolgreich: ${O.importiert} Monate importiert`+(O.uebersprungen>0?`, ${O.uebersprungen} bersprungen`:"")+(O.ueberschrieben>0?`, ${O.ueberschrieben} berschrieben`:"")+(O.fehler.length>0?`, ${O.fehler.length} Fehler`:"")),await z()):_(O.fehler.join(", ")||"Import fehlgeschlagen")}catch(O){_("Fehler beim Import"),console.error(O)}finally{u(!1)}},R=K=>{const O=new Set(E);O.has(K)?O.delete(K):O.add(K),F(O)},M=K=>{switch(K){case"importieren":return e.jsx(vt,{className:"w-4 h-4 text-green-500"});case"ueberspringen":return e.jsx(ot,{className:"w-4 h-4 text-gray-400"});case"konflikt":return e.jsx(pt,{className:"w-4 h-4 text-amber-500"});case"ueberschreiben":return e.jsx(pt,{className:"w-4 h-4 text-red-500"});default:return e.jsx(nt,{className:"w-4 h-4 text-blue-500"})}},H=K=>{const O={importieren:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",ueberspringen:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400",konflikt:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300",ueberschreiben:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},ee={importieren:"Importieren",ueberspringen:"bersprungen",konflikt:"Konflikt",ueberschreiben:"berschreiben"};return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${O[K]||""}`,children:ee[K]||K})};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ke,{className:"w-8 h-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(Yr,{className:"w-7 h-7 text-primary-500"}),"HA-Statistik Import"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Importiere historische Monatsdaten aus der Home Assistant Langzeitstatistik-Datenbank."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Datenbank-Status"}),c?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(Ke,{className:"w-5 h-5 animate-spin"}),"Prfe Verbindung..."]}):d?e.jsx(te,{type:"success",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),"Home Assistant Datenbank ist verfgbar"]})}):e.jsx(te,{type:"error",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"w-5 h-5"}),"Home Assistant Datenbank nicht verfgbar"]}),b&&e.jsx("p",{className:"text-sm",children:b}),e.jsxs("p",{className:"text-sm",children:["Stellen Sie sicher, dass das Add-on mit ",e.jsx("code",{children:"config:ro"})," Volume-Mapping installiert ist. Siehe CHANGELOG v2.0.0 fr Upgrade-Anleitung."]})]})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Anlage auswhlen"}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage"}),e.jsx("select",{value:s||"",onChange:K=>{n(Number(K.target.value)),y(null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:r.map(K=>e.jsx("option",{value:K.id,children:K.anlagenname},K.id))})]}),e.jsx("button",{onClick:z,disabled:!s||g,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 animate-spin"}),"Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-4 h-4"}),"Vorschau laden"]})})]}),!f&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:"Wichtig: Stellen Sie sicher, dass das Sensor-Mapping fr diese Anlage konfiguriert ist, damit die HA-Sensoren den EEDC-Feldern zugeordnet werden knnen."})]}),k&&e.jsx(te,{type:"error",className:"mb-6",children:k}),w&&e.jsx(te,{type:"success",className:"mb-6",children:w}),f&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Import-Vorschau"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Cs,{label:"Verfgbare Monate",value:f.anzahl_monate,color:"blue"}),e.jsx(Cs,{label:"Zum Import",value:f.anzahl_importieren,color:"green"}),e.jsx(Cs,{label:"Konflikte",value:f.anzahl_konflikte,color:"amber"}),e.jsx(Cs,{label:"bersprungen",value:f.anzahl_ueberspringen,color:"gray"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Import-Modus"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>V("alle"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${A==="alle"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Alles importieren"}),e.jsx("button",{onClick:()=>V("nur_basis"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${A==="nur_basis"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Nur Basis (Einspeisung/Netzbezug)"}),e.jsx("button",{onClick:()=>V("nur_komponenten"),className:`px-3 py-1.5 text-sm rounded-lg border transition-colors ${A==="nur_komponenten"?"bg-primary-100 border-primary-500 text-primary-700 dark:bg-primary-900/30 dark:border-primary-400 dark:text-primary-300":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:border-gray-400"}`,children:"Nur Komponenten"}),A==="manuell"&&e.jsx("span",{className:"px-3 py-1.5 text-sm rounded-lg bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 border border-amber-300 dark:border-amber-700",children:"Manuell (individuelle Auswahl)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Klicken Sie auf einzelne Felder in der Vorschau, um die Auswahl anzupassen."})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Hinweis:"})," Whlen Sie die Monate und Felder aus, die importiert werden sollen. Bei Konflikten (gelb markiert) werden nur die ausgewhlten Felder berschrieben."]})}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden mb-6",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:f.monate.map(K=>{const O=`${K.jahr}-${K.monat}`;return e.jsx(zx,{monat:K,expanded:E.has(O),onToggle:()=>R(O),getAktionIcon:M,getAktionBadge:H,selected:C.get(O)||!1,onSelectionChange:()=>$(K.jahr,K.monat),feldAuswahl:W.get(O),onToggleBasisFeld:ee=>T(K.jahr,K.monat,ee),onToggleInvFeld:(ee,de)=>I(K.jahr,K.monat,ee,de)},O)})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:Z,disabled:x||G===0,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center gap-2 font-medium",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-5 h-5 animate-spin"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-5 h-5"}),G," Monate importieren"]})})})]})]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx("button",{onClick:()=>t("/einstellungen/sensor-mapping"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:" Zurck zu Sensor-Zuordnung"}),e.jsx("button",{onClick:()=>t("/einstellungen/monatsdaten"),className:"text-primary-600 hover:text-primary-700",children:"Zu Monatsdaten "})]})]})}function Cs({label:t,value:r,color:a}){const s={blue:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400",green:"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400",amber:"bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400",gray:"bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-400"};return e.jsxs("div",{className:`p-4 rounded-lg ${s[a]}`,children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),e.jsx("div",{className:"text-sm",children:t})]})}function zx({monat:t,expanded:r,onToggle:a,getAktionIcon:s,getAktionBadge:n,selected:i,onSelectionChange:l,feldAuswahl:c,onToggleBasisFeld:h,onToggleInvFeld:g}){const o=t.aktion!=="ueberspringen",x=Object.keys(t.ha_werte).length>0||t.vorhandene_werte&&Object.keys(t.vorhandene_werte).length>0||t.investitionen&&t.investitionen.length>0;return e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"px-3 py-3",children:o?e.jsx("input",{type:"checkbox",checked:i,onChange:u=>{u.stopPropagation(),l()},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"}):e.jsx("div",{className:"w-4 h-4"})}),e.jsxs("button",{onClick:a,className:"flex-1 px-2 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x?r?e.jsx(Mr,{className:"w-4 h-4 text-gray-400"}):e.jsx(Yt,{className:"w-4 h-4 text-gray-400"}):e.jsx("div",{className:"w-4"}),e.jsx($t,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.monat_name," ",t.jahr]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s(t.aktion),n(t.aktion)]})]})]}),r&&x&&e.jsxs("div",{className:"px-4 pb-4 pt-2 bg-gray-50 dark:bg-gray-700/30",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t.grund}),(Object.keys(t.ha_werte).length>0||t.vorhandene_werte&&Object.keys(t.vorhandene_werte).length>0)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase mb-2",children:"Basis-Werte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"w-8 py-1"}),e.jsx("th",{className:"text-left py-1 pr-4 font-medium text-gray-600 dark:text-gray-300",children:"Feld"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-gray-600 dark:text-gray-300",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-blue-600 dark:text-blue-400",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-1 pl-2 font-medium text-gray-600 dark:text-gray-300",children:"Diff"})]})}),e.jsx("tbody",{children:Object.keys(t.ha_werte).map(u=>{var y;const d=t.ha_werte[u],p=((y=t.vorhandene_werte)==null?void 0:y[u])??null,b=d!==null&&p!==null?d-p:null,j=b!==null&&Math.abs(b)>=1,f=(c==null?void 0:c.basis.has(u))??!0;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 ${j?"bg-amber-50/50 dark:bg-amber-900/10":""} ${f?"":"opacity-50"}`,onClick:()=>h(u),children:[e.jsx("td",{className:"py-1 pl-2",children:e.jsx("input",{type:"checkbox",checked:f,onChange:()=>{},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"py-1 pr-4 text-gray-700 dark:text-gray-300",children:u}),e.jsx("td",{className:"py-1 px-2 text-right text-gray-600 dark:text-gray-400",children:p!=null?p.toLocaleString("de-DE",{maximumFractionDigits:1}):""}),e.jsx("td",{className:"py-1 px-2 text-right font-medium text-blue-700 dark:text-blue-300",children:d!==null?d.toLocaleString("de-DE",{maximumFractionDigits:1}):""}),e.jsx("td",{className:`py-1 pl-2 text-right ${j?"font-medium text-amber-600 dark:text-amber-400":"text-gray-500"}`,children:b!==null?(b>=0?"+":"")+b.toLocaleString("de-DE",{maximumFractionDigits:1}):""})]},u)})})]})})]}),t.investitionen&&t.investitionen.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Komponenten"}),t.investitionen.map(u=>{const d=c==null?void 0:c.investitionen.get(u.investition_id);return e.jsxs("div",{className:`rounded-lg border p-3 ${u.hat_abweichung?"border-amber-300 dark:border-amber-700 bg-amber-50/50 dark:bg-amber-900/10":"border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white text-sm",children:u.bezeichnung}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400",children:u.typ}),u.hat_abweichung&&e.jsx(pt,{className:"w-4 h-4 text-amber-500"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"w-8 py-1"}),e.jsx("th",{className:"text-left py-1 pr-4 font-medium text-gray-600 dark:text-gray-300",children:"Feld"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-gray-600 dark:text-gray-300",children:"Vorhanden"}),e.jsx("th",{className:"text-right py-1 px-2 font-medium text-blue-600 dark:text-blue-400",children:"HA-Statistik"}),e.jsx("th",{className:"text-right py-1 pl-2 font-medium text-gray-600 dark:text-gray-300",children:"Diff"})]})}),e.jsx("tbody",{children:Object.keys(u.ha_werte).map(p=>{const b=u.ha_werte[p],j=u.vorhandene_werte[p],f=b!==null&&j!==null?b-j:null,y=f!==null&&Math.abs(f)>=1,k=(d==null?void 0:d.has(p))??!0;return e.jsxs("tr",{className:`cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50 ${y?"bg-amber-50/30 dark:bg-amber-900/5":""} ${k?"":"opacity-50"}`,onClick:()=>g(u.investition_id,p),children:[e.jsx("td",{className:"py-1 pl-2",children:e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},className:"w-4 h-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"})}),e.jsx("td",{className:"py-1 pr-4 text-gray-700 dark:text-gray-300",children:p}),e.jsx("td",{className:"py-1 px-2 text-right text-gray-600 dark:text-gray-400",children:j!=null?j.toLocaleString("de-DE",{maximumFractionDigits:1}):""}),e.jsx("td",{className:"py-1 px-2 text-right font-medium text-blue-700 dark:text-blue-300",children:b!==null?b.toLocaleString("de-DE",{maximumFractionDigits:1}):""}),e.jsx("td",{className:`py-1 pl-2 text-right ${y?"font-medium text-amber-600 dark:text-amber-400":"text-gray-500"}`,children:f!==null?(f>=0?"+":"")+f.toLocaleString("de-DE",{maximumFractionDigits:1}):""})]},p)})})]})})]},u.investition_id)})]})]})]})}const Sx={BW:"Baden-Wrttemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thringen",AT:"sterreich",CH:"Schweiz",XX:"Unbekannt"};function Ex(){const t=lr(),[r,a]=m.useState([]),[s,n]=m.useState(null),[i,l]=m.useState(null),[c,h]=m.useState(null),[g,o]=m.useState(null),[x,u]=m.useState(!0),[d,p]=m.useState(!1),[b,j]=m.useState(!1),[f,y]=m.useState(!1),[k,_]=m.useState(null),[w,v]=m.useState(!1),[E,F]=m.useState(!1),[C,D]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const N=await Lt.list();a(N),N.length===1&&n(N[0].id)}catch(N){const z=N instanceof Error?N.message:"Fehler beim Laden";_(z)}finally{u(!1)}})()},[]),m.useEffect(()=>{(async()=>{try{const N=await rt.getStatus();l(N)}catch{l({online:!1,url:"https://energy.raunet.eu",error:"Nicht erreichbar"})}})()},[]),m.useEffect(()=>{if(!s){h(null);return}(async()=>{p(!0),_(null);try{const N=await rt.getPreview(s);h(N)}catch(N){const z=N instanceof Error?N.message:"Fehler beim Laden der Vorschau";_(z)}finally{p(!1)}})()},[s]);const A=async()=>{if(s){j(!0),_(null);try{const W=await rt.share(s);o(W)}catch(W){const N=W instanceof Error?W.message:"Fehler beim Teilen";_(N)}finally{j(!1)}}},S=async()=>{if(s){y(!0),_(null);try{const W=await rt.delete(s);if(W.success){const N=await rt.getPreview(s);h(N),F(!1),_(null),alert(`Gelscht! ${W.anzahl_geloeschte_monate} Monatswerte wurden entfernt.`)}}catch(W){const N=W instanceof Error?W.message:"Fehler beim Lschen";_(N)}finally{y(!1)}}};if(x)return e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx(Ke,{className:"h-8 w-8 animate-spin text-blue-500"})});if(r.length===0)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-yellow-800",children:"Keine Anlagen vorhanden. Bitte zuerst eine Anlage anlegen."})})});if(g!=null&&g.success){const W=g.benchmark,N=W?(W.spez_ertrag_anlage-W.spez_ertrag_durchschnitt)/W.spez_ertrag_durchschnitt*100:0;return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx(vt,{className:"h-12 w-12 text-green-500 mx-auto mb-3"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"Vielen Dank fr deinen Beitrag!"}),e.jsxs("p",{className:"text-green-700",children:[g.anzahl_monate," Monatswerte wurden mit der Community geteilt."]})]}),W&&e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-orange-50 px-4 py-3 border-b",children:e.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(Kt,{className:"h-5 w-5 text-orange-500"}),"Dein Anlagenvergleich"]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Dein spezifischer Ertrag"}),e.jsxs("p",{className:"text-4xl font-bold text-orange-500",children:[W.spez_ertrag_anlage.toFixed(0),e.jsx("span",{className:"text-lg font-normal text-gray-500 ml-1",children:"kWh/kWp"})]}),e.jsxs("p",{className:`text-sm mt-1 ${N>=0?"text-green-600":"text-red-600"}`,children:[N>=0?"+":"",N.toFixed(1),"% vs. Durchschnitt"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Durchschnitt"}),e.jsxs("p",{className:"text-lg font-semibold",children:[W.spez_ertrag_durchschnitt.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Region"}),e.jsxs("p",{className:"text-lg font-semibold",children:[W.spez_ertrag_region.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Xr,{className:"h-4 w-4 text-yellow-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Rang gesamt"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["#",W.rang_gesamt," ",e.jsxs("span",{className:"text-sm text-gray-400",children:["/ ",W.anzahl_anlagen_gesamt]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ht,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Rang Region"})]}),e.jsxs("p",{className:"text-lg font-semibold",children:["#",W.rang_region," ",e.jsxs("span",{className:"text-sm text-gray-400",children:["/ ",W.anzahl_anlagen_region]})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[e.jsxs("a",{href:g!=null&&g.anlage_hash?`${(c==null?void 0:c.community_url)||"https://energy.raunet.eu"}?anlage=${g.anlage_hash}`:(c==null?void 0:c.community_url)||"https://energy.raunet.eu",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-5 py-2.5 bg-orange-500 text-white rounded-lg hover:bg-orange-600 font-medium",children:[e.jsx(Qr,{className:"h-4 w-4"}),"Dein persnliches Benchmark ffnen"]}),e.jsxs("button",{onClick:()=>{o(null),h(null),s&&rt.getPreview(s).then(h)},className:"inline-flex items-center gap-2 px-5 py-2.5 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:[e.jsx(sr,{className:"h-4 w-4"}),"Erneut teilen"]}),e.jsx("button",{onClick:()=>t("/"),className:"px-5 py-2.5 text-gray-500 hover:text-gray-700",children:"Zum Dashboard"})]})]})}return e.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(nl,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Mit Community teilen"}),e.jsx("p",{className:"text-gray-500",children:"Teile deine anonymisierten Anlagendaten mit der PV-Community"})]})]}),r.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anlage auswhlen"}),e.jsxs("select",{value:s||"",onChange:W=>n(Number(W.target.value)||null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"-- Anlage whlen --"}),r.map(W=>e.jsx("option",{value:W.id,children:W.anlagenname},W.id))]})]}),e.jsx("div",{className:`p-4 rounded-lg border ${i!=null&&i.online?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[i!=null&&i.online?e.jsx(vt,{className:"h-5 w-5 text-green-500"}):e.jsx(ct,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:i!=null&&i.online?"text-green-800":"text-red-800",children:["Community-Server: ",i!=null&&i.online?"Online":"Offline"]}),(i==null?void 0:i.version)&&e.jsxs("p",{className:"text-sm text-green-600",children:["Version ",i.version]}),(i==null?void 0:i.error)&&e.jsx("p",{className:"text-sm text-red-600",children:i.error})]})]})}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-800",children:k})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Zo,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Datenschutz"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:" Keine persnlichen Daten (Name, Adresse) werden bertragen"}),e.jsx("li",{children:" PLZ wird auf Bundesland reduziert"}),e.jsx("li",{children:" Nur aggregierte Monatswerte"}),e.jsx("li",{children:" Daten sind anonym und knnen nicht zu dir zurckverfolgt werden"})]})]})]})}),!(c!=null&&c.bereits_geteilt)&&(c==null?void 0:c.anzahl_monate)&&c.anzahl_monate>0&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:W=>D(W.target.checked),className:"mt-1 h-4 w-4 text-orange-500 border-gray-300 rounded focus:ring-orange-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Ich stimme der anonymen bertragung meiner PV-Anlagendaten an die EEDC Community zu. Die Daten werden gem der"," ",e.jsx("a",{href:"https://energy.raunet.eu/datenschutz",target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline",children:"Datenschutzerklrung"})," ","verarbeitet. Ich kann meine Daten jederzeit lschen."]})]})}),d&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ke,{className:"h-6 w-6 animate-spin text-orange-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Lade Vorschau..."})]}),c&&!d&&e.jsxs("div",{className:"bg-white border rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>v(!w),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(th,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Datenvorschau"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:w?"Ausblenden":"Anzeigen"})]}),w&&e.jsxs("div",{className:"border-t p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Region"}),e.jsx("p",{className:"font-medium",children:Sx[c.vorschau.region]||c.vorschau.region})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Leistung"}),e.jsxs("p",{className:"font-medium",children:[c.vorschau.kwp," kWp"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ausrichtung"}),e.jsx("p",{className:"font-medium capitalize",children:c.vorschau.ausrichtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Neigung"}),e.jsxs("p",{className:"font-medium",children:[c.vorschau.neigung_grad,""]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.vorschau.speicher_kwh&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded text-sm",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Speicher (",c.vorschau.speicher_kwh," kWh)"]}),c.vorschau.hat_waermepumpe&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-700 rounded text-sm",children:[e.jsx(dt,{className:"h-4 w-4"}),"Wrmepumpe"]}),c.vorschau.hat_eauto&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-700 rounded text-sm",children:[e.jsx(Te,{className:"h-4 w-4"}),"E-Auto"]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:c.anzahl_monate})," Monatswerte werden geteilt",c.vorschau.monatswerte.length>0&&e.jsxs("span",{className:"text-gray-400",children:[" ","(von ",c.vorschau.monatswerte[0].monat,"/",c.vorschau.monatswerte[0].jahr," ","bis ",c.vorschau.monatswerte[c.vorschau.monatswerte.length-1].monat,"/",c.vorschau.monatswerte[c.vorschau.monatswerte.length-1].jahr,")"]})]})})]})]}),(c==null?void 0:c.bereits_geteilt)&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(vt,{className:"h-5 w-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Bereits mit Community geteilt"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Deine Daten sind bereits im Community-Dashboard sichtbar. Du kannst sie aktualisieren oder lschen."})]})]}),e.jsx("button",{onClick:()=>F(!0),className:"text-red-600 hover:text-red-800 p-1",title:"Daten lschen",children:e.jsx(Mt,{className:"h-5 w-5"})})]})}),E&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-red-800 mb-2",children:"Daten wirklich lschen?"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"Alle deine geteilten Daten werden vom Community-Server entfernt. Dies kann nicht rckgngig gemacht werden."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:S,disabled:f,className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:f?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-4 w-4 animate-spin"}),"Wird gelscht..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"h-4 w-4"}),"Ja, lschen"]})}),e.jsx("button",{onClick:()=>F(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Abbrechen"})]})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:A,disabled:!(i!=null&&i.online)||b||!(c!=null&&c.anzahl_monate)||!s||!(c!=null&&c.bereits_geteilt)&&!C,className:`
            inline-flex items-center gap-2 px-6 py-3 rounded-lg text-lg font-medium
            ${i!=null&&i.online&&(c!=null&&c.anzahl_monate)&&s&&(c!=null&&c.bereits_geteilt||C)?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}
          `,children:b?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-5 w-5 animate-spin"}),"Wird geteilt..."]}):c!=null&&c.bereits_geteilt?e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"h-5 w-5"}),"Daten aktualisieren"]}):e.jsxs(e.Fragment,{children:[e.jsx(Go,{className:"h-5 w-5"}),"Jetzt anonym teilen"]})})}),!(c!=null&&c.anzahl_monate)&&s&&!d&&e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Keine Monatsdaten vorhanden. Bitte zuerst Daten erfassen."}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("a",{href:(c==null?void 0:c.community_url)||"https://energy.raunet.eu",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline inline-flex items-center gap-1",children:[e.jsx(Qr,{className:"h-4 w-4"}),"Community-Dashboard ansehen"]})})]})}const Mx={BW:"Baden-Wrttemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thringen",AT:"sterreich",CH:"Schweiz"},Gr={solarprofi:{name:"Solarprofi",beschreibung:"Top 10% beim spezifischen Ertrag",icon:e.jsx(ce,{className:"h-5 w-5"}),farbe:"yellow"},autarkiemeister:{name:"Autarkiemeister",beschreibung:"Autarkiegrad ber 80%",icon:e.jsx(Zo,{className:"h-5 w-5"}),farbe:"green"},effizienzwunder:{name:"Effizienzwunder",beschreibung:"Speicher-Wirkungsgrad ber 90%",icon:e.jsx(Ce,{className:"h-5 w-5"}),farbe:"emerald"},waermekoenig:{name:"Wrmeknig",beschreibung:"Wrmepumpe JAZ ber 4.0",icon:e.jsx(dt,{className:"h-5 w-5"}),farbe:"blue"},gruenerfahrer:{name:"Grner Fahrer",beschreibung:"E-Auto PV-Ladeanteil ber 70%",icon:e.jsx(Te,{className:"h-5 w-5"}),farbe:"purple"},regionalchampion:{name:"Regionalchampion",beschreibung:"Top 3 in deiner Region",icon:e.jsx(ht,{className:"h-5 w-5"}),farbe:"cyan"},dauerbrenner:{name:"Dauerbrenner",beschreibung:"12 Monate in Folge ber Durchschnitt",icon:e.jsx(et,{className:"h-5 w-5"}),farbe:"orange"}};function Wx({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(!1),[l,c]=m.useState(null);m.useEffect(()=>{(async()=>{i(!0),c(null);try{const p=await rt.getBenchmark(t,r);s(p)}catch(p){c(p instanceof Error?p.message:"Fehler beim Laden")}finally{i(!1)}})()},[t,r]);const h=m.useMemo(()=>{if(!a)return null;const{rang_gesamt:d,anzahl_anlagen_gesamt:p}=a.benchmark,b=d/p*100;return b<=10?{label:"Top 10%",color:"bg-yellow-500",textColor:"text-yellow-500"}:b<=25?{label:"Top 25%",color:"bg-gray-400",textColor:"text-gray-500"}:b<=50?{label:"Top 50%",color:"bg-amber-700",textColor:"text-amber-700"}:null},[a]),g=m.useMemo(()=>{var I,V,G,Z;if(!a)return{erreichte:[],nichtErreichte:[]};const d=[],p=[],{rang_gesamt:b,anzahl_anlagen_gesamt:j,rang_region:f,anzahl_anlagen_region:y}=a.benchmark,k=b/j*100,_=k<=10,w={id:"solarprofi",...Gr.solarprofi,erreicht:_,fortschritt:_?100:Math.max(0,100-k)};_?d.push(w):p.push(w);const v=f<=3,E={id:"regionalchampion",...Gr.regionalchampion,erreicht:v,fortschritt:v?100:Math.max(0,(1-f/Math.min(10,y))*100)};v?d.push(E):p.push(E);const F=(I=a.anlage.monatswerte)==null?void 0:I[a.anlage.monatswerte.length-1];if((F==null?void 0:F.autarkie_prozent)!==void 0&&F.autarkie_prozent!==null){const R=F.autarkie_prozent>=80,M={id:"autarkiemeister",...Gr.autarkiemeister,erreicht:R,fortschritt:R?100:F.autarkie_prozent/80*100};R?d.push(M):p.push(M)}const C=(V=a.benchmark_erweitert)==null?void 0:V.speicher;if(C!=null&&C.wirkungsgrad){const R=C.wirkungsgrad.wert>=90,M={id:"effizienzwunder",...Gr.effizienzwunder,erreicht:R,fortschritt:R?100:C.wirkungsgrad.wert/90*100};R?d.push(M):p.push(M)}const D=(G=a.benchmark_erweitert)==null?void 0:G.waermepumpe;if(D!=null&&D.jaz){const R=D.jaz.wert>=4,M={id:"waermekoenig",...Gr.waermekoenig,erreicht:R,fortschritt:R?100:D.jaz.wert/4*100};R?d.push(M):p.push(M)}const A=(Z=a.benchmark_erweitert)==null?void 0:Z.eauto;if(A!=null&&A.pv_anteil){const R=A.pv_anteil.wert>=70,M={id:"gruenerfahrer",...Gr.gruenerfahrer,erreicht:R,fortschritt:R?100:A.pv_anteil.wert/70*100};R?d.push(M):p.push(M)}const W=(a.anlage.monatswerte||[]).slice(-12),N=a.benchmark.spez_ertrag_durchschnitt/12;let z=0;for(const R of W)(R.spez_ertrag_kwh_kwp||0)>N&&z++;const $=z===12&&W.length===12,T={id:"dauerbrenner",...Gr.dauerbrenner,erreicht:$,fortschritt:W.length>0?z/Math.max(12,W.length)*100:0};return $?d.push(T):W.length>=6&&p.push(T),{erreichte:d,nichtErreichte:p}},[a]),{staerken:o,schwaechen:x}=m.useMemo(()=>{var y,k,_,w,v,E,F,C,D,A,S,W;if(!a)return{staerken:[],schwaechen:[]};const d=[],p=(a.benchmark.spez_ertrag_anlage-a.benchmark.spez_ertrag_durchschnitt)/a.benchmark.spez_ertrag_durchschnitt*100;if(d.push({label:"PV-Ertrag",abweichungProzent:p,icon:e.jsx(ce,{className:"h-4 w-4"}),kategorie:"pv"}),(y=a.benchmark_erweitert)!=null&&y.speicher){const N=a.benchmark_erweitert.speicher;if((k=N.wirkungsgrad)!=null&&k.community_avg){const z=(N.wirkungsgrad.wert-N.wirkungsgrad.community_avg)/N.wirkungsgrad.community_avg*100;d.push({label:"Speicher-Effizienz",abweichungProzent:z,icon:e.jsx(Ce,{className:"h-4 w-4"}),kategorie:"speicher"})}if((_=N.netz_anteil)!=null&&_.community_avg){const z=(N.netz_anteil.community_avg-N.netz_anteil.wert)/N.netz_anteil.community_avg*100;d.push({label:"PV-Ladeanteil Speicher",abweichungProzent:z,icon:e.jsx(Ne,{className:"h-4 w-4"}),kategorie:"speicher"})}}if((E=(v=(w=a.benchmark_erweitert)==null?void 0:w.waermepumpe)==null?void 0:v.jaz)!=null&&E.community_avg){const N=a.benchmark_erweitert.waermepumpe,z=(N.jaz.wert-N.jaz.community_avg)/N.jaz.community_avg*100;d.push({label:"Wrmepumpe JAZ",abweichungProzent:z,icon:e.jsx(dt,{className:"h-4 w-4"}),kategorie:"waermepumpe"})}if((D=(C=(F=a.benchmark_erweitert)==null?void 0:F.eauto)==null?void 0:C.pv_anteil)!=null&&D.community_avg){const N=a.benchmark_erweitert.eauto,z=(N.pv_anteil.wert-N.pv_anteil.community_avg)/N.pv_anteil.community_avg*100;d.push({label:"E-Auto PV-Anteil",abweichungProzent:z,icon:e.jsx(Te,{className:"h-4 w-4"}),kategorie:"eauto"})}if((W=(S=(A=a.benchmark_erweitert)==null?void 0:A.wallbox)==null?void 0:S.pv_anteil)!=null&&W.community_avg){const N=a.benchmark_erweitert.wallbox,z=(N.pv_anteil.wert-N.pv_anteil.community_avg)/N.pv_anteil.community_avg*100;d.push({label:"Wallbox PV-Anteil",abweichungProzent:z,icon:e.jsx(Ht,{className:"h-4 w-4"}),kategorie:"wallbox"})}const b=[...d].sort((N,z)=>z.abweichungProzent-N.abweichungProzent),j=b.filter(N=>N.abweichungProzent>0).slice(0,3),f=b.filter(N=>N.abweichungProzent<0).slice(-3).reverse();return{staerken:j,schwaechen:f}},[a]),u=m.useMemo(()=>{var j,f,y,k,_,w,v,E,F,C;if(!a)return[];const d=[],p=Math.max(a.benchmark.spez_ertrag_anlage,a.benchmark.spez_ertrag_durchschnitt)*1.2;d.push({kategorie:"PV-Ertrag",du:a.benchmark.spez_ertrag_anlage/p*100,community:a.benchmark.spez_ertrag_durchschnitt/p*100,fullMark:100});const b=(j=a.anlage.monatswerte)==null?void 0:j[a.anlage.monatswerte.length-1];if(b!=null&&b.autarkie_prozent&&d.push({kategorie:"Autarkie",du:b.autarkie_prozent,community:65,fullMark:100}),b!=null&&b.eigenverbrauch_prozent&&d.push({kategorie:"Eigenverbrauch",du:b.eigenverbrauch_prozent,community:45,fullMark:100}),(k=(y=(f=a.benchmark_erweitert)==null?void 0:f.speicher)==null?void 0:y.wirkungsgrad)!=null&&k.community_avg){const D=a.benchmark_erweitert.speicher;d.push({kategorie:"Speicher",du:D.wirkungsgrad.wert,community:D.wirkungsgrad.community_avg,fullMark:100})}if((v=(w=(_=a.benchmark_erweitert)==null?void 0:_.waermepumpe)==null?void 0:w.jaz)!=null&&v.community_avg){const D=a.benchmark_erweitert.waermepumpe,A=Math.max(D.jaz.wert,D.jaz.community_avg)*1.2;d.push({kategorie:"WP-Effizienz",du:D.jaz.wert/A*100,community:D.jaz.community_avg/A*100,fullMark:100})}if((C=(F=(E=a.benchmark_erweitert)==null?void 0:E.eauto)==null?void 0:F.pv_anteil)!=null&&C.community_avg){const D=a.benchmark_erweitert.eauto;d.push({kategorie:"E-Auto PV",du:D.pv_anteil.wert,community:D.pv_anteil.community_avg,fullMark:100})}return d},[a]);return n?e.jsx(Se,{text:"Lade Community-Daten..."}):l?e.jsx(te,{type:"error",children:l}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Xr,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Dein PV-Ertrag im Vergleich"}),h&&e.jsxs("span",{className:`ml-2 px-3 py-1 rounded-full text-white text-sm font-medium ${h.color}`,children:[e.jsx(ya,{className:"h-4 w-4 inline mr-1"}),h.label]}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center md:col-span-1",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Dein spez. Ertrag"}),e.jsx("p",{className:"text-4xl font-bold text-primary-500",children:a.benchmark.spez_ertrag_anlage.toFixed(0)}),e.jsx("p",{className:"text-gray-500",children:"kWh/kWp"}),e.jsx(Fx,{wert:a.benchmark.spez_ertrag_anlage,durchschnitt:a.benchmark.spez_ertrag_durchschnitt})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(Ps,{label:"Community Durchschnitt",wert:a.benchmark.spez_ertrag_durchschnitt,einheit:"kWh/kWp",icon:e.jsx(Kt,{className:"h-5 w-5 text-gray-400"})}),e.jsx(Ps,{label:Mx[a.anlage.region]||a.anlage.region,wert:a.benchmark.spez_ertrag_region,einheit:"kWh/kWp",icon:e.jsx(ht,{className:"h-5 w-5 text-blue-400"})}),e.jsx(Ps,{label:"Rang gesamt",wert:a.benchmark.rang_gesamt,zusatz:`von ${a.benchmark.anzahl_anlagen_gesamt}`,icon:e.jsx(Xr,{className:"h-5 w-5 text-yellow-500"}),isRank:!0}),e.jsx(Ps,{label:"Rang Region",wert:a.benchmark.rang_region,zusatz:`von ${a.benchmark.anzahl_anlagen_region}`,icon:e.jsx(Xr,{className:"h-5 w-5 text-blue-500"}),isRank:!0})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(o.length>0||x.length>0)&&e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Deine Performance"}),o.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ph,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Strken"})]}),e.jsx("div",{className:"space-y-2",children:o.map((d,p)=>e.jsxs("div",{className:"flex items-center justify-between bg-green-50 dark:bg-green-900/20 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon,e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:d.label})]}),e.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["+",d.abweichungProzent.toFixed(1),"%"]})]},p))})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(mh,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Verbesserungspotenzial"})]}),e.jsx("div",{className:"space-y-2",children:x.map((d,p)=>e.jsxs("div",{className:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon,e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:d.label})]}),e.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:[d.abweichungProzent.toFixed(1),"%"]})]},p))})]})]}),u.length>=3&&e.jsxs(P,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Profil"}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Fd,{data:u,children:[e.jsx(Ad,{stroke:"#e5e7eb"}),e.jsx($d,{dataKey:"kategorie",tick:{fill:"#6b7280",fontSize:11}}),e.jsx(Cd,{angle:90,domain:[0,100],tick:{fill:"#9ca3af",fontSize:10}}),e.jsx(Jl,{name:"Du",dataKey:"du",stroke:"var(--color-primary-500, #3b82f6)",fill:"var(--color-primary-500, #3b82f6)",fillOpacity:.3}),e.jsx(Jl,{name:"Community",dataKey:"community",stroke:"#9ca3af",fill:"#9ca3af",fillOpacity:.1}),e.jsx(De,{})]})})})]})]}),(g.erreichte.length>0||g.nichtErreichte.length>0)&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ga,{className:"h-5 w-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Achievements"}),g.erreichte.length>0&&e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:[g.erreichte.length," von ",g.erreichte.length+g.nichtErreichte.length," erreicht"]})]}),g.erreichte.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Erreicht"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:g.erreichte.map(d=>e.jsx(_0,{achievement:d},d.id))})]}),g.nichtErreichte.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"In Reichweite"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:g.nichtErreichte.slice(0,4).map(d=>e.jsx(_0,{achievement:d},d.id))})]})]}),a.benchmark_erweitert&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.benchmark_erweitert.speicher&&a.anlage.speicher_kwh&&e.jsxs(Pa,{title:"Speicher",icon:e.jsx(Ce,{className:"h-6 w-6 text-green-500"}),kapazitaet:`${a.anlage.speicher_kwh} kWh`,children:[e.jsx(ft,{label:"Zyklen/Jahr",kpi:a.benchmark_erweitert.speicher.zyklen_jahr,einheit:""}),e.jsx(ft,{label:"Wirkungsgrad",kpi:a.benchmark_erweitert.speicher.wirkungsgrad,einheit:"%"}),e.jsx(ft,{label:"Netzladung",kpi:a.benchmark_erweitert.speicher.netz_anteil,einheit:"%",invertColors:!0})]}),a.benchmark_erweitert.waermepumpe&&a.anlage.hat_waermepumpe&&e.jsxs(Pa,{title:"Wrmepumpe",icon:e.jsx(dt,{className:"h-6 w-6 text-blue-500"}),children:[e.jsx(ft,{label:"JAZ (Jahresarbeitszahl)",kpi:a.benchmark_erweitert.waermepumpe.jaz,einheit:""}),e.jsx(ft,{label:"Stromverbrauch",kpi:a.benchmark_erweitert.waermepumpe.stromverbrauch,einheit:"kWh",hideComparison:!0}),e.jsx(ft,{label:"Wrmeerzeugung",kpi:a.benchmark_erweitert.waermepumpe.waermeerzeugung,einheit:"kWh",hideComparison:!0})]}),a.benchmark_erweitert.eauto&&a.anlage.hat_eauto&&e.jsxs(Pa,{title:"E-Auto",icon:e.jsx(Te,{className:"h-6 w-6 text-purple-500"}),children:[e.jsx(ft,{label:"PV-Anteil",kpi:a.benchmark_erweitert.eauto.pv_anteil,einheit:"%"}),e.jsx(ft,{label:"Ladung gesamt",kpi:a.benchmark_erweitert.eauto.ladung_gesamt,einheit:"kWh",hideComparison:!0}),e.jsx(ft,{label:"Verbrauch",kpi:a.benchmark_erweitert.eauto.verbrauch_100km,einheit:"kWh/100km",invertColors:!0}),a.benchmark_erweitert.eauto.v2h&&e.jsx(ft,{label:"V2H Entladung",kpi:a.benchmark_erweitert.eauto.v2h,einheit:"kWh",hideComparison:!0})]}),a.benchmark_erweitert.wallbox&&a.anlage.hat_wallbox&&e.jsxs(Pa,{title:"Wallbox",icon:e.jsx(Ht,{className:"h-6 w-6 text-cyan-500"}),kapazitaet:a.anlage.wallbox_kw?`${a.anlage.wallbox_kw} kW`:void 0,children:[e.jsx(ft,{label:"PV-Anteil Ladung",kpi:a.benchmark_erweitert.wallbox.pv_anteil,einheit:"%"}),e.jsx(ft,{label:"Ladung gesamt",kpi:a.benchmark_erweitert.wallbox.ladung,einheit:"kWh",hideComparison:!0}),e.jsx(ft,{label:"Ladevorgnge",kpi:a.benchmark_erweitert.wallbox.ladevorgaenge,einheit:"",hideComparison:!0})]}),a.benchmark_erweitert.balkonkraftwerk&&a.anlage.hat_balkonkraftwerk&&e.jsxs(Pa,{title:"Balkonkraftwerk",icon:e.jsx(ce,{className:"h-6 w-6 text-amber-500"}),kapazitaet:a.anlage.bkw_wp?`${a.anlage.bkw_wp} Wp`:void 0,children:[e.jsx(ft,{label:"Spez. Ertrag",kpi:a.benchmark_erweitert.balkonkraftwerk.spez_ertrag,einheit:"kWh/kWp"}),e.jsx(ft,{label:"Erzeugung",kpi:a.benchmark_erweitert.balkonkraftwerk.erzeugung,einheit:"kWh",hideComparison:!0}),e.jsx(ft,{label:"Eigenverbrauchsquote",kpi:a.benchmark_erweitert.balkonkraftwerk.eigenverbrauch,einheit:"%",hideComparison:!0})]})]})]}):null}function Fx({wert:t,durchschnitt:r}){const a=(t-r)/r*100,s=a>=0;return e.jsxs("span",{className:`inline-flex items-center gap-1 mt-2 px-2 py-1 rounded text-sm font-medium ${s?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[s?e.jsx(Fe,{className:"h-4 w-4"}):e.jsx(Gt,{className:"h-4 w-4"}),s?"+":"",a.toFixed(1),"% vs. Durchschnitt"]})}const Ax={"Rang gesamt":"Deine Position im Vergleich zu allen teilnehmenden Anlagen","Rang Region":"Deine Position im Vergleich zu Anlagen in deiner Region","Spez. Ertrag":"Dein normierter Ertrag (kWh/kWp) im Vergleichszeitraum"};function Ps({label:t,wert:r,einheit:a,zusatz:s,icon:n,isRank:i,tooltip:l}){const c=l||Ax[t];return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n,e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[t,c&&e.jsx(Pn,{text:c,children:e.jsx(tl,{className:"h-3 w-3 text-gray-400 opacity-60"})})]})]}),e.jsxs("p",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:[i?"#":"",r.toFixed(0),a&&e.jsx("span",{className:"text-sm font-normal text-gray-500 ml-1",children:a}),s&&e.jsx("span",{className:"text-sm font-normal text-gray-400 ml-2",children:s})]})]})}function Pa({title:t,icon:r,kapazitaet:a,children:s}){return e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r,e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),a&&e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]}),e.jsx("div",{className:"space-y-3",children:s})]})}const $x={"Spez. Ertrag":"Ertrag normiert auf installierte Leistung (kWh pro kWp)",Autarkie:"Anteil des Eigenverbrauchs am Gesamtverbrauch",Eigenverbrauch:"Anteil der selbst genutzten PV-Erzeugung",Eigenverbrauchsquote:"Anteil der selbst genutzten PV-Erzeugung","Zyklen/Jahr":"Vollstndige Lade-/Entladezyklen pro Jahr",Wirkungsgrad:"Verhltnis von Entladung zu Ladung (Effizienz)","Netzlade-Anteil":"Anteil der Speicherladung aus dem Netz statt PV",JAZ:"Jahresarbeitszahl: Wrmeenergie geteilt durch Stromverbrauch",Stromverbrauch:"Gesamter Stromverbrauch der Wrmepumpe",Wrmeerzeugung:"Erzeugte Wrme fr Heizung und Warmwasser","PV-Anteil":"Anteil der Ladung aus PV-berschuss",Ladung:"Gesamte Lademenge im Zeitraum",Verbrauch:"Durchschnittlicher Energieverbrauch",Erzeugung:"Gesamte PV-Erzeugung im Zeitraum"};function ft({label:t,kpi:r,einheit:a,hideComparison:s,invertColors:n,tooltip:i}){if(!r)return null;const l=!s&&r.community_avg!==void 0&&r.community_avg!==null,c=l?(r.wert-r.community_avg)/r.community_avg*100:null,h=c!==null?n?c<0:c>0:null,g=i||$x[t];return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-700 last:border-0",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[t,g&&e.jsx(Pn,{text:g,children:e.jsx(tl,{className:"h-3.5 w-3.5 text-gray-400 opacity-60"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[r.wert.toFixed(a==="%"||a===""?1:0)," ",a]}),l&&c!==null&&e.jsxs("span",{className:`text-sm ${h?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:["(",c>=0?"+":"",c.toFixed(1),"%)"]})]})]})}function _0({achievement:t}){const r={yellow:{bg:t.erreicht?"bg-yellow-100 dark:bg-yellow-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-yellow-300 dark:border-yellow-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-yellow-500":"text-gray-400",text:t.erreicht?"text-yellow-700 dark:text-yellow-300":"text-gray-500"},green:{bg:t.erreicht?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-green-300 dark:border-green-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-green-500":"text-gray-400",text:t.erreicht?"text-green-700 dark:text-green-300":"text-gray-500"},emerald:{bg:t.erreicht?"bg-emerald-100 dark:bg-emerald-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-emerald-300 dark:border-emerald-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-emerald-500":"text-gray-400",text:t.erreicht?"text-emerald-700 dark:text-emerald-300":"text-gray-500"},blue:{bg:t.erreicht?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-blue-300 dark:border-blue-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-blue-500":"text-gray-400",text:t.erreicht?"text-blue-700 dark:text-blue-300":"text-gray-500"},purple:{bg:t.erreicht?"bg-purple-100 dark:bg-purple-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-purple-300 dark:border-purple-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-purple-500":"text-gray-400",text:t.erreicht?"text-purple-700 dark:text-purple-300":"text-gray-500"},cyan:{bg:t.erreicht?"bg-cyan-100 dark:bg-cyan-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-cyan-300 dark:border-cyan-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-cyan-500":"text-gray-400",text:t.erreicht?"text-cyan-700 dark:text-cyan-300":"text-gray-500"},orange:{bg:t.erreicht?"bg-orange-100 dark:bg-orange-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-orange-300 dark:border-orange-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-orange-500":"text-gray-400",text:t.erreicht?"text-orange-700 dark:text-orange-300":"text-gray-500"},indigo:{bg:t.erreicht?"bg-indigo-100 dark:bg-indigo-900/30":"bg-gray-100 dark:bg-gray-800",border:t.erreicht?"border-indigo-300 dark:border-indigo-700":"border-gray-200 dark:border-gray-700",icon:t.erreicht?"text-indigo-500":"text-gray-400",text:t.erreicht?"text-indigo-700 dark:text-indigo-300":"text-gray-500"}},a=r[t.farbe]||r.yellow;return e.jsxs("div",{className:`relative rounded-xl p-3 border ${a.bg} ${a.border} ${t.erreicht?"":"opacity-70"}`,title:t.beschreibung,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:a.icon,children:t.icon}),e.jsx("span",{className:`text-sm font-medium ${a.text}`,children:t.name})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:t.beschreibung}),!t.erreicht&&t.fortschritt!==void 0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.farbe==="yellow"?"bg-yellow-400":t.farbe==="green"?"bg-green-400":t.farbe==="blue"?"bg-blue-400":t.farbe==="purple"?"bg-purple-400":t.farbe==="cyan"?"bg-cyan-400":t.farbe==="orange"?"bg-orange-400":"bg-gray-400"}`,style:{width:`${Math.min(100,Math.max(0,t.fortschritt))}%`}})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t.fortschritt.toFixed(0),"%"]})]}),t.erreicht&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(sh,{className:`h-4 w-4 ${a.icon}`})})]})}function Cx({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(null),[l,c]=m.useState(null),[h,g]=m.useState(!1),[o,x]=m.useState(null);m.useEffect(()=>{(async()=>{g(!0),x(null);try{const[f,y,k]=await Promise.all([rt.getBenchmark(t,r),rt.getDistribution("spez_ertrag",15).catch(()=>null),rt.getMonthlyAverages(24).catch(()=>null)]);s(f),i(y),c(k)}catch(f){x(f instanceof Error?f.message:"Fehler beim Laden")}finally{g(!1)}})()},[t,r]);const u=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return[];const j=["Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],f=new Map;return l!=null&&l.monate&&l.monate.forEach(k=>{f.set(`${k.jahr}-${k.monat}`,k.spez_ertrag_avg)}),[...a.anlage.monatswerte].sort((k,_)=>k.jahr-_.jahr||k.monat-_.monat).slice(-12).map(k=>{const _=k.spez_ertrag_kwh_kwp||0;let w=f.get(`${k.jahr}-${k.monat}`);w===void 0&&(w=f.get(`${k.jahr-1}-${k.monat}`)),w===void 0&&(w=a.benchmark.spez_ertrag_durchschnitt/12);const v=w>0?(_-w)/w*100:0;return{name:`${j[k.monat-1]} ${k.jahr%100}`,monat:k.monat,jahr:k.jahr,ertrag:_,durchschnitt:w,abweichung:v,isPositive:v>=0}})},[a,l]),d=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return null;const j=a.anlage.monatswerte;return[...new Set(j.map(y=>y.jahr))].sort().map(y=>{const k=j.filter(v=>v.jahr===y),_=k.reduce((v,E)=>v+(E.spez_ertrag_kwh_kwp||0),0),w=k.length;return{jahr:y,spezErtrag:_,anzahlMonate:w,vollstaendig:w===12}})},[a]),p=m.useMemo(()=>{if(!a)return null;const{rang_gesamt:j,anzahl_anlagen_gesamt:f}=a.benchmark;return Math.round((1-j/f)*100)},[a]),b=m.useMemo(()=>{if(!a)return null;const{spez_ertrag_anlage:j,spez_ertrag_durchschnitt:f,spez_ertrag_region:y}=a.benchmark;return{abweichungGesamt:(j-f)/f*100,abweichungRegion:(j-y)/y*100,differenzAbsolut:j-f}},[a]);return h?e.jsx(Se,{text:"Lade PV-Ertragsdaten..."}):o?e.jsx(te,{type:"error",children:o}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary-100 dark:bg-primary-900/30",children:e.jsx(ya,{className:"h-5 w-5 text-primary-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Deine Position"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["Top ",100-(p||0),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Besser als ",p,"% der Community"]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${((b==null?void 0:b.abweichungGesamt)||0)>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:((b==null?void 0:b.abweichungGesamt)||0)>=0?e.jsx(Fe,{className:"h-5 w-5 text-green-500"}):e.jsx(Gt,{className:"h-5 w-5 text-red-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Community"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${((b==null?void 0:b.abweichungGesamt)||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[((b==null?void 0:b.abweichungGesamt)||0)>=0?"+":"",b==null?void 0:b.abweichungGesamt.toFixed(1),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[b==null?void 0:b.differenzAbsolut.toFixed(0)," kWh/kWp Differenz"]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${((b==null?void 0:b.abweichungRegion)||0)>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:e.jsx(bi,{className:"h-5 w-5 text-blue-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Region"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${((b==null?void 0:b.abweichungRegion)||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[((b==null?void 0:b.abweichungRegion)||0)>=0?"+":"",b==null?void 0:b.abweichungRegion.toFixed(1),"%"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Vergleich mit deinem Bundesland"})]})]}),u.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatlicher Ertrag vs. Community"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:u,children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ke,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11},interval:0,angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(ge,{formatter:(j,f)=>f==="ertrag"?[`${j.toFixed(1)} kWh/kWp`,"Dein Ertrag"]:f==="durchschnitt"?[`${j.toFixed(1)} kWh/kWp`," Community"]:[j,f],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(qe,{type:"monotone",dataKey:"durchschnitt",stroke:"#9ca3af",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"durchschnitt"}),e.jsx(oe,{dataKey:"ertrag",radius:[4,4,0,0],name:"ertrag",children:u.map((j,f)=>e.jsx(Ze,{fill:j.isPositive?"#22c55e":"#ef4444",fillOpacity:.8},`cell-${f}`))})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ber Monats-"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-red-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unter Monats-"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-0 border-t-2 border-dashed border-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Community Monats-"})]})]})]}),d&&d.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($t,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Jahresbersicht"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Jahr"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"vs. Community"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Monate"})]})}),e.jsx("tbody",{children:d.map(j=>{const f=(j.spezErtrag-a.benchmark.spez_ertrag_durchschnitt)/a.benchmark.spez_ertrag_durchschnitt*100,y=f>=0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 last:border-0",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:j.jahr}),!j.vollstaendig&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(unvollstndig)"})]}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[j.spezErtrag.toFixed(0)," kWh/kWp"]})}),e.jsx("td",{className:"text-right py-3 px-4",children:e.jsxs("span",{className:`font-medium ${y?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[y?"+":"",f.toFixed(1),"%"]})}),e.jsxs("td",{className:"text-right py-3 px-4 text-gray-500 dark:text-gray-400",children:[j.anzahlMonate,"/12"]})]},j.jahr)})})]})})]}),n&&n.bins.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(bi,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Verteilung in der Community"})]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Et,{data:n.bins.map(j=>({range:`${j.von.toFixed(0)}-${j.bis.toFixed(0)}`,anzahl:j.anzahl,isOwn:a.benchmark.spez_ertrag_anlage>=j.von&&a.benchmark.spez_ertrag_anlage<j.bis})),children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ke,{dataKey:"range",tick:{fill:"#6b7280",fontSize:10},angle:-45,textAnchor:"end",height:60}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12}}),e.jsx(ge,{formatter:j=>[`${j} Anlagen`,"Anzahl"],labelFormatter:j=>`${j} kWh/kWp`,contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(oe,{dataKey:"anzahl",radius:[4,4,0,0],children:n.bins.map((j,f)=>{const y=a.benchmark.spez_ertrag_anlage>=j.von&&a.benchmark.spez_ertrag_anlage<j.bis;return e.jsx(Ze,{fill:y?"#8b5cf6":"#d1d5db",fillOpacity:y?1:.7},`cell-${f}`)})})]})})}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Minimum"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.min.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Durchschnitt"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.durchschnitt.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Median"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.median.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Maximum"}),e.jsxs("p",{className:"font-semibold",children:[n.statistik.max.toFixed(0)," kWh/kWp"]})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-3 bg-purple-500 rounded"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Deine Position"})]})})]}),e.jsx(P,{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{className:"h-5 w-5 text-primary-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"ber den Vergleich"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Der Community-Durchschnitt basiert auf ",a.benchmark.anzahl_anlagen_gesamt," Anlagen. Dein spezifischer Ertrag von ",e.jsxs("strong",{children:[a.benchmark.spez_ertrag_anlage.toFixed(0)," kWh/kWp"]})," liegt"," ",((b==null?void 0:b.abweichungGesamt)||0)>=0?"ber":"unter"," dem Durchschnitt von"," ",e.jsxs("strong",{children:[a.benchmark.spez_ertrag_durchschnitt.toFixed(0)," kWh/kWp"]}),". Faktoren wie Ausrichtung (",a.anlage.ausrichtung,"), Neigung (",a.anlage.neigung_grad,") und regionale Sonneneinstrahlung beeinflussen die Ergebnisse."]})]})]})})]}):null}function Px({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(!1),[l,c]=m.useState(null),[h,g]=m.useState(null),[o,x]=m.useState(null),[u,d]=m.useState(null);m.useEffect(()=>{(async()=>{i(!0),c(null);try{const j=await rt.getBenchmark(t,r);s(j)}catch(j){c(j instanceof Error?j.message:"Fehler beim Laden")}finally{i(!1)}})()},[t,r]),m.useEffect(()=>{(async()=>{try{const[j,f,y]=await Promise.all([rt.getSpeicherByClass().catch(()=>null),rt.getWaermepumpeByRegion().catch(()=>null),rt.getEAutoByUsage().catch(()=>null)]);g(j),x(f),d(y)}catch{}})()},[]);const p=m.useMemo(()=>{var j,f,y,k,_;if(!a)return[];const b=[];return a.anlage.speicher_kwh&&((j=a.benchmark_erweitert)!=null&&j.speicher)&&b.push("speicher"),a.anlage.hat_waermepumpe&&((f=a.benchmark_erweitert)!=null&&f.waermepumpe)&&b.push("waermepumpe"),a.anlage.hat_eauto&&((y=a.benchmark_erweitert)!=null&&y.eauto)&&b.push("eauto"),a.anlage.hat_wallbox&&((k=a.benchmark_erweitert)!=null&&k.wallbox)&&b.push("wallbox"),a.anlage.hat_balkonkraftwerk&&((_=a.benchmark_erweitert)!=null&&_.balkonkraftwerk)&&b.push("bkw"),b},[a]);return n?e.jsx(Se,{text:"Lade Komponenten-Daten..."}):l?r==="letzter_monat"?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Daten fr letzten Monat"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Fr den letzten Monat liegen noch keine Komponenten-Daten vor. Whle einen lngeren Zeitraum fr den Vergleich."})]})}):e.jsx(te,{type:"error",children:l}):a?p.length===0?e.jsx(P,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 dark:bg-gray-800 mb-4",children:e.jsx(Ce,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Keine Komponenten-Daten"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto",children:"Fr Komponenten-Vergleiche bentigst du mindestens eine Zusatzkomponente (Speicher, Wrmepumpe, E-Auto, Wallbox oder Balkonkraftwerk) mit erfassten Monatsdaten."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Betrachtungszeitraum: ",a.zeitraum_label]})}),p.includes("speicher")&&e.jsx(Dx,{benchmark:a,communityStats:h}),p.includes("waermepumpe")&&e.jsx(Lx,{benchmark:a,communityStats:o}),p.includes("eauto")&&e.jsx(Ix,{benchmark:a,communityStats:u}),p.includes("wallbox")&&e.jsx(Vx,{benchmark:a}),p.includes("bkw")&&e.jsx(Bx,{benchmark:a})]}):null}const z0=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];function Dx({benchmark:t,communityStats:r}){var g,o;const a=(g=t.benchmark_erweitert)==null?void 0:g.speicher;if(!a)return null;const s=t.anlage.speicher_kwh||0,n=m.useMemo(()=>s<=5?"5 kWh":s<=10?"5-10 kWh":s<=15?"10-15 kWh":s<=20?"15-20 kWh":">20 kWh",[s]),i=m.useMemo(()=>{var u,d;const x=[];return(u=a.wirkungsgrad)!=null&&u.community_avg&&x.push({name:"Wirkungsgrad",du:a.wirkungsgrad.wert,community:a.wirkungsgrad.community_avg}),(d=a.netz_anteil)!=null&&d.community_avg&&x.push({name:"Netz-Anteil",du:a.netz_anteil.wert,community:a.netz_anteil.community_avg}),x},[a]),l=m.useMemo(()=>r!=null&&r.klassen?r.klassen.filter(x=>x.anzahl>0).map((x,u)=>({name:x.bis_kwh?`${x.von_kwh}-${x.bis_kwh} kWh`:`>${x.von_kwh} kWh`,anzahl:x.anzahl,fill:z0[u%z0.length],avg_zyklen:x.durchschnitt_zyklen??0,avg_wirkungsgrad:x.durchschnitt_wirkungsgrad??0})):[],[r]),c=m.useMemo(()=>r!=null&&r.klassen?r.klassen.reduce((x,u)=>x+u.anzahl,0):0,[r]),h=m.useMemo(()=>{const x=[];return a.netz_anteil&&a.netz_anteil.wert>20&&x.push("Hoher Netzlade-Anteil: Prfe, ob die PV-berschussladung optimal konfiguriert ist."),a.wirkungsgrad&&a.wirkungsgrad.wert<85&&x.push("Der Wirkungsgrad liegt unter 85%. Bei lteren Speichern kann die Kapazitt nachlassen."),a.zyklen_jahr&&a.zyklen_jahr.wert<200&&x.push("Wenige Zyklen: Der Speicher wird nicht voll genutzt. berlege, mehr Eigenverbrauch zu priorisieren."),x.length===0&&x.push("Dein Speicher arbeitet im normalen Bereich."),x},[a]);return e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100 dark:bg-green-900/30",children:e.jsx(Ce,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Speicher"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s," kWh Kapazitt"]})]})]}),((o=a.zyklen_jahr)==null?void 0:o.rang)&&a.zyklen_jahr.von&&e.jsx(bs,{rang:a.zyklen_jahr.rang,von:a.zyklen_jahr.von})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(mt,{label:"Zyklen/Jahr",icon:e.jsx(Co,{className:"h-5 w-5 text-green-500"}),kpi:a.zyklen_jahr,einheit:"",beschreibung:"Vollstndige Lade-/Entladezyklen"}),e.jsx(mt,{label:"Wirkungsgrad",icon:e.jsx(Za,{className:"h-5 w-5 text-blue-500"}),kpi:a.wirkungsgrad,einheit:"%",beschreibung:"Entladen / Geladen"}),e.jsx(mt,{label:"Netzlade-Anteil",icon:e.jsx(Ne,{className:"h-5 w-5 text-yellow-500"}),kpi:a.netz_anteil,einheit:"%",beschreibung:"Anteil Ladung aus Netz statt PV",invertColors:!0})]}),i.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Vergleich mit Community"}),e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:i,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(ke,{type:"number",domain:[0,100],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:90}),e.jsx(ge,{formatter:x=>[`${x.toFixed(1)}%`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(oe,{dataKey:"du",name:"Du",fill:"#22c55e",radius:[0,4,4,0]}),e.jsx(oe,{dataKey:"community",name:"Community",fill:"#9ca3af",radius:[0,4,4,0]})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Du"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Community "})]})]})]})]}),l.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Er,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: Speicher nach Kapazittsklasse"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",c," Anlagen)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:l,dataKey:"anzahl",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:x,percent:u})=>`${x} (${(u*100).toFixed(0)}%)`,labelLine:!1,children:l.map((x,u)=>e.jsx(Ze,{fill:x.fill,stroke:x.name===n?"#000":"none",strokeWidth:x.name===n?2:0},`cell-${u}`))}),e.jsx(ge,{formatter:(x,u)=>[`${x} Anlagen`,u]})]})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"text-left pb-2",children:"Klasse"}),e.jsx("th",{className:"text-right pb-2",children:" Zyklen/Jahr"}),e.jsx("th",{className:"text-right pb-2",children:" Wirkungsgrad"})]})}),e.jsx("tbody",{children:l.map(x=>e.jsxs("tr",{className:x.name===n?"bg-primary-50 dark:bg-primary-900/20 font-medium":"",children:[e.jsxs("td",{className:"py-1 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:x.fill}}),x.name,x.name===n&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]}),e.jsx("td",{className:"text-right py-1",children:x.avg_zyklen.toFixed(0)}),e.jsxs("td",{className:"text-right py-1",children:[x.avg_wirkungsgrad.toFixed(1),"%"]})]},x.name))})]})})]})]}),e.jsx(fs,{tipps:h})]})}function Lx({benchmark:t,communityStats:r}){var c,h;const a=(c=t.benchmark_erweitert)==null?void 0:c.waermepumpe;if(!a)return null;const s=t.anlage.region,n=m.useMemo(()=>r!=null&&r.regionen?r.regionen.filter(g=>g.anzahl>0&&g.durchschnitt_jaz!=null).sort((g,o)=>(o.durchschnitt_jaz??0)-(g.durchschnitt_jaz??0)).slice(0,10).map(g=>({name:g.region.replace("_"," "),region:g.region,jaz:g.durchschnitt_jaz??0,anzahl:g.anzahl})):[],[r]),i=m.useMemo(()=>r!=null&&r.regionen?r.regionen.reduce((g,o)=>g+o.anzahl,0):0,[r]),l=m.useMemo(()=>{const g=[];return a.jaz&&a.jaz.wert<3&&g.push("JAZ unter 3.0: Prfe Vorlauftemperaturen und Wrmedmmung. Hhere Temperaturen senken die Effizienz."),i>=3&&a.jaz&&a.jaz.community_avg&&a.jaz.wert<a.jaz.community_avg*.9&&g.push("Deine JAZ liegt deutlich unter dem Community-Durchschnitt. Eine Optimierung der Heizkurve knnte helfen."),g.length===0&&a.jaz&&a.jaz.wert>=3.5?g.push("Gute Effizienz! Eine JAZ von 3.5+ ist ein solider Wert fr Wrmepumpen."):g.length===0&&g.push("Deine Wrmepumpe arbeitet im normalen Effizienzbereich."),g},[a,i]);return e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(dt,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Wrmepumpe"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Effizienz-Analyse"})]})]}),((h=a.jaz)==null?void 0:h.rang)&&a.jaz.von&&e.jsx(bs,{rang:a.jaz.rang,von:a.jaz.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(mt,{label:"Jahresarbeitszahl (JAZ)",icon:e.jsx(Br,{className:"h-5 w-5 text-blue-500"}),kpi:a.jaz,einheit:"",beschreibung:"Wrmeenergie / Stromverbrauch",large:!0}),e.jsx(mt,{label:"Stromverbrauch",icon:e.jsx(Ne,{className:"h-5 w-5 text-yellow-500"}),kpi:a.stromverbrauch,einheit:"kWh",beschreibung:"Gesamt im Zeitraum"}),e.jsx(mt,{label:"Wrmeerzeugung",icon:e.jsx(dt,{className:"h-5 w-5 text-red-500"}),kpi:a.waermeerzeugung,einheit:"kWh",beschreibung:"Heizung + Warmwasser"})]}),n.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: JAZ nach Region"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i," ",i===1?"Anlage":"Anlagen",")"]})]}),i<3?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Noch nicht genug Vergleichsdaten."})," Fr einen aussagekrftigen regionalen Vergleich werden mindestens 3 Anlagen mit Wrmepumpe bentigt."]}),n.length===1&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Aktuell: ",n[0].name," mit JAZ ",n[0].jaz.toFixed(2)," (",n[0].anzahl," Anlage)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:n,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(ke,{type:"number",domain:[0,5],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:11},width:120}),e.jsx(ge,{formatter:g=>[`JAZ: ${g.toFixed(2)}`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsxs(oe,{dataKey:"jaz",radius:[0,4,4,0],children:[n.map((g,o)=>e.jsx(Ze,{fill:g.region===s?"#3b82f6":"#9ca3af"},`cell-${o}`)),e.jsx(Pd,{dataKey:"jaz",position:"right",formatter:g=>g.toFixed(2),style:{fill:"#374151",fontSize:11}})]})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Deine Region"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-500",children:"Andere Regionen"})]})]})]})]}),e.jsx(fs,{tipps:l})]})}const S0=["#22c55e","#3b82f6","#f59e0b","#ef4444"];function Ix({benchmark:t,communityStats:r}){var h,g;const a=(h=t.benchmark_erweitert)==null?void 0:h.eauto;if(!a)return null;const s=m.useMemo(()=>{var x;if(!((x=a.km)!=null&&x.wert))return null;const o=a.km.wert/12;return o<=500?"Wenig":o<=1e3?"Normal":o<=2e3?"Viel":"Intensiv"},[a.km]),n=m.useMemo(()=>r!=null&&r.klassen?r.klassen.filter(o=>o.anzahl>0).map((o,x)=>({name:o.klasse.charAt(0).toUpperCase()+o.klasse.slice(1),beschreibung:o.beschreibung,anzahl:o.anzahl,fill:S0[x%S0.length],avg_pv_anteil:o.durchschnitt_pv_anteil??0,avg_verbrauch:o.durchschnitt_verbrauch_100km??0})):[],[r]),i=m.useMemo(()=>r!=null&&r.klassen?r.klassen.reduce((o,x)=>o+x.anzahl,0):0,[r]),l=m.useMemo(()=>{if(!a.pv_anteil)return[];const o=a.pv_anteil.wert;return[{name:"PV",wert:o,fill:"#22c55e"},{name:"Netz/Extern",wert:100-o,fill:"#ef4444"}]},[a]),c=m.useMemo(()=>{const o=[];return a.pv_anteil&&a.pv_anteil.wert<50&&o.push("Unter 50% PV-Anteil: Versuche, das Laden tagsber bei PV-berschuss zu priorisieren."),a.verbrauch_100km&&a.verbrauch_100km.wert>20&&o.push("Hoher Verbrauch: Prfe Reifendruck, Fahrweise und Klimaanlagen-Nutzung."),a.v2h&&a.v2h.wert>0&&o.push("V2H aktiv: Du nutzt dein Auto als zustzlichen Speicher - sehr gut!"),o.length===0&&o.push("Dein E-Auto ist gut in das Energiesystem integriert."),o},[a]);return e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-100 dark:bg-purple-900/30",children:e.jsx(Te,{className:"h-6 w-6 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"E-Auto"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Lade- und Verbrauchsanalyse"})]})]}),((g=a.pv_anteil)==null?void 0:g.rang)&&a.pv_anteil.von&&e.jsx(bs,{rang:a.pv_anteil.rang,von:a.pv_anteil.von})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(mt,{label:"PV-Ladeanteil",icon:e.jsx(ce,{className:"h-5 w-5 text-yellow-500"}),kpi:a.pv_anteil,einheit:"%",beschreibung:"Anteil PV an Gesamtladung"}),e.jsx(mt,{label:"Ladung gesamt",icon:e.jsx(Co,{className:"h-5 w-5 text-purple-500"}),kpi:a.ladung_gesamt,einheit:"kWh",beschreibung:"Gesamte Lademenge"}),e.jsx(mt,{label:"Verbrauch",icon:e.jsx(Za,{className:"h-5 w-5 text-blue-500"}),kpi:a.verbrauch_100km,einheit:"kWh/100km",beschreibung:"Durchschnittsverbrauch",invertColors:!0}),a.km&&e.jsx(mt,{label:"Gefahrene km",icon:e.jsx(hh,{className:"h-5 w-5 text-gray-500"}),kpi:a.km,einheit:"km",beschreibung:"Im Zeitraum"}),a.v2h&&a.v2h.wert>0&&e.jsx(mt,{label:"V2H Entladung",icon:e.jsx(Ne,{className:"h-5 w-5 text-green-500"}),kpi:a.v2h,einheit:"kWh",beschreibung:"Rckspeisung ins Haus"})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ladequellen-Verteilung"}),e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:l,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!1}),e.jsx(ke,{type:"number",domain:[0,100],tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:80}),e.jsx(ge,{formatter:o=>[`${o.toFixed(1)}%`,""],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(oe,{dataKey:"wert",radius:[0,4,4,0],children:l.map((o,x)=>e.jsx(Ze,{fill:o.fill},`cell-${x}`))})]})})})]})]}),n.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Er,{className:"h-5 w-5 text-gray-500"}),e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Community: E-Autos nach Nutzungsintensitt"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i," E-Autos)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-48",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Xt,{children:[e.jsx(Qt,{data:n,dataKey:"anzahl",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:o,percent:x})=>`${o} (${(x*100).toFixed(0)}%)`,labelLine:!1,children:n.map((o,x)=>e.jsx(Ze,{fill:o.fill,stroke:o.name.toLowerCase()===(s==null?void 0:s.toLowerCase())?"#000":"none",strokeWidth:o.name.toLowerCase()===(s==null?void 0:s.toLowerCase())?2:0},`cell-${x}`))}),e.jsx(ge,{formatter:(o,x)=>[`${o} E-Autos`,x]})]})})}),e.jsx("div",{className:"text-sm",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("th",{className:"text-left pb-2",children:"Nutzung"}),e.jsx("th",{className:"text-right pb-2",children:" Verbrauch"}),e.jsx("th",{className:"text-right pb-2",children:" PV-Anteil"})]})}),e.jsx("tbody",{children:n.map(o=>e.jsxs("tr",{className:o.name.toLowerCase()===(s==null?void 0:s.toLowerCase())?"bg-primary-50 dark:bg-primary-900/20 font-medium":"",children:[e.jsxs("td",{className:"py-1 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:o.fill}}),e.jsx("span",{title:o.beschreibung,children:o.name}),o.name.toLowerCase()===(s==null?void 0:s.toLowerCase())&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]}),e.jsxs("td",{className:"text-right py-1",children:[o.avg_verbrauch.toFixed(1)," kWh/100km"]}),e.jsxs("td",{className:"text-right py-1",children:[o.avg_pv_anteil.toFixed(0),"%"]})]},o.name))})]})})]})]}),e.jsx(fs,{tipps:c})]})}function Vx({benchmark:t}){var n,i;const r=(n=t.benchmark_erweitert)==null?void 0:n.wallbox;if(!r)return null;const a=t.anlage.wallbox_kw,s=m.useMemo(()=>{const l=[];return r.pv_anteil&&r.pv_anteil.wert<60&&l.push("Der PV-Anteil knnte hher sein. Nutze PV-gefhrtes Laden fr mehr Eigenverbrauch."),r.pv_anteil&&r.pv_anteil.wert>=80&&l.push("Exzellenter PV-Anteil! Deine Wallbox ist optimal ins PV-System integriert."),l.length===0&&l.push("Deine Wallbox arbeitet im normalen Bereich."),l},[r]);return e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-100 dark:bg-cyan-900/30",children:e.jsx(Ht,{className:"h-6 w-6 text-cyan-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Wallbox"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a?`${a} kW Ladeleistung`:"Ladeverhalten"})]})]}),((i=r.pv_anteil)==null?void 0:i.rang)&&r.pv_anteil.von&&e.jsx(bs,{rang:r.pv_anteil.rang,von:r.pv_anteil.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(mt,{label:"PV-Ladeanteil",icon:e.jsx(ce,{className:"h-5 w-5 text-yellow-500"}),kpi:r.pv_anteil,einheit:"%",beschreibung:"Anteil PV an Gesamtladung",large:!0}),e.jsx(mt,{label:"Ladung gesamt",icon:e.jsx(Ne,{className:"h-5 w-5 text-cyan-500"}),kpi:r.ladung,einheit:"kWh",beschreibung:"Im Zeitraum"}),e.jsx(mt,{label:"Ladevorgnge",icon:e.jsx(Kt,{className:"h-5 w-5 text-gray-500"}),kpi:r.ladevorgaenge,einheit:"",beschreibung:"Anzahl"})]}),e.jsx(fs,{tipps:s})]})}function Bx({benchmark:t}){var n,i;const r=(n=t.benchmark_erweitert)==null?void 0:n.balkonkraftwerk;if(!r)return null;const a=t.anlage.bkw_wp,s=m.useMemo(()=>{const l=[];return r.spez_ertrag&&r.spez_ertrag.community_avg&&(r.spez_ertrag.wert-r.spez_ertrag.community_avg)/r.spez_ertrag.community_avg*100<-15&&l.push("Dein spezifischer Ertrag liegt deutlich unter dem Durchschnitt. Prfe Verschattung und Ausrichtung."),r.eigenverbrauch&&r.eigenverbrauch.wert<70&&l.push("Der Eigenverbrauchsanteil knnte hher sein. Versuche, Verbraucher tagsber zu nutzen."),l.length===0&&l.push("Dein Balkonkraftwerk arbeitet gut!"),l},[r]);return e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(ce,{className:"h-6 w-6 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Balkonkraftwerk"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a?`${a} Wp`:"Mini-PV"})]})]}),((i=r.spez_ertrag)==null?void 0:i.rang)&&r.spez_ertrag.von&&e.jsx(bs,{rang:r.spez_ertrag.rang,von:r.spez_ertrag.von})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(mt,{label:"Spezifischer Ertrag",icon:e.jsx(Fe,{className:"h-5 w-5 text-amber-500"}),kpi:r.spez_ertrag,einheit:"kWh/kWp",beschreibung:"Normierter Ertrag",large:!0}),e.jsx(mt,{label:"Erzeugung",icon:e.jsx(Ne,{className:"h-5 w-5 text-yellow-500"}),kpi:r.erzeugung,einheit:"kWh",beschreibung:"Im Zeitraum"}),e.jsx(mt,{label:"Eigenverbrauch",icon:e.jsx(dt,{className:"h-5 w-5 text-green-500"}),kpi:r.eigenverbrauch,einheit:"%",beschreibung:"Direkt genutzt"})]}),e.jsx(fs,{tipps:s})]})}function bs({rang:t,von:r}){const a=t/r*100;let s="bg-gray-100 dark:bg-gray-800",n="text-gray-600 dark:text-gray-400";return a<=10?(s="bg-yellow-100 dark:bg-yellow-900/30",n="text-yellow-600 dark:text-yellow-400"):a<=25?(s="bg-blue-100 dark:bg-blue-900/30",n="text-blue-600 dark:text-blue-400"):a<=50&&(s="bg-green-100 dark:bg-green-900/30",n="text-green-600 dark:text-green-400"),e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full ${s}`,children:[e.jsx(ya,{className:`h-4 w-4 ${n}`}),e.jsxs("span",{className:`text-sm font-medium ${n}`,children:["#",t," von ",r]})]})}function mt({label:t,icon:r,kpi:a,einheit:s,beschreibung:n,invertColors:i,large:l}){if(!a)return null;const c=a.community_avg!==void 0&&a.community_avg!==null,h=c?(a.wert-a.community_avg)/a.community_avg*100:null,g=h!==null?i?h<0:h>0:null;return e.jsxs("div",{className:`bg-gray-50 dark:bg-gray-800 rounded-lg p-4 ${l?"md:col-span-1":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r,e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:`font-bold text-gray-900 dark:text-white ${l?"text-3xl":"text-xl"}`,children:a.wert.toFixed(s==="%"||s===""?1:0)}),s&&e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:s})]}),c&&h!==null&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-sm ${g?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[g?e.jsx(Fe,{className:"h-3 w-3"}):e.jsx(Gt,{className:"h-3 w-3"}),e.jsxs("span",{children:[h>=0?"+":"",h.toFixed(1),"% vs. "]})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]})}function fs({tipps:t}){return e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ah,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Tipps"})]}),e.jsx("ul",{className:"space-y-2",children:t.map((r,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"text-primary-500 mt-0.5",children:""}),e.jsx("span",{children:r})]},a))})]})}class wt{constructor(){this._partials=new Float64Array(32),this._n=0}add(r){const a=this._partials;let s=0;for(let n=0;n<this._n&&n<32;n++){const i=a[n],l=r+i,c=Math.abs(r)<Math.abs(i)?r-(l-i):i-(l-r);c&&(a[s++]=c),r=l}return a[s]=r,this._n=s+1,this}valueOf(){const r=this._partials;let a=this._n,s,n,i,l=0;if(a>0){for(l=r[--a];a>0&&(s=l,n=r[--a],l=s+n,i=n-(l-s),!i););a>0&&(i<0&&r[a-1]<0||i>0&&r[a-1]>0)&&(n=i*2,s=l+n,n==s-l&&(l=s))}return l}}function*Ox(t){for(const r of t)yield*r}function ac(t){return Array.from(Ox(t))}function ua(t,r,a){t=+t,r=+r,a=(n=arguments.length)<2?(r=t,t=0,1):n<3?1:+a;for(var s=-1,n=Math.max(0,Math.ceil((r-t)/a))|0,i=new Array(n);++s<n;)i[s]=t+s*a;return i}var ve=1e-6,ss=1e-12,Pe=Math.PI,at=Pe/2,rn=Pe/4,Wt=Pe*2,Ge=180/Pe,we=Pe/180,Ve=Math.abs,Sa=Math.atan,Ft=Math.atan2,fe=Math.cos,Ds=Math.ceil,sc=Math.exp,ji=Math.hypot,an=Math.log,Xn=Math.pow,me=Math.sin,Ut=Math.sign||function(t){return t>0?1:t<0?-1:0},gt=Math.sqrt,ml=Math.tan;function nc(t){return t>1?0:t<-1?Pe:Math.acos(t)}function At(t){return t>1?at:t<-1?-at:Math.asin(t)}function E0(t){return(t=me(t/2))*t}function Ye(){}function sn(t,r){t&&W0.hasOwnProperty(t.type)&&W0[t.type](t,r)}var M0={Feature:function(t,r){sn(t.geometry,r)},FeatureCollection:function(t,r){for(var a=t.features,s=-1,n=a.length;++s<n;)sn(a[s].geometry,r)}},W0={Sphere:function(t,r){r.sphere()},Point:function(t,r){t=t.coordinates,r.point(t[0],t[1],t[2])},MultiPoint:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)t=a[s],r.point(t[0],t[1],t[2])},LineString:function(t,r){ki(t.coordinates,r,0)},MultiLineString:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)ki(a[s],r,0)},Polygon:function(t,r){F0(t.coordinates,r)},MultiPolygon:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)F0(a[s],r)},GeometryCollection:function(t,r){for(var a=t.geometries,s=-1,n=a.length;++s<n;)sn(a[s],r)}};function ki(t,r,a){var s=-1,n=t.length-a,i;for(r.lineStart();++s<n;)i=t[s],r.point(i[0],i[1],i[2]);r.lineEnd()}function F0(t,r){var a=-1,s=t.length;for(r.polygonStart();++a<s;)ki(t[a],r,1);r.polygonEnd()}function ar(t,r){t&&M0.hasOwnProperty(t.type)?M0[t.type](t,r):sn(t,r)}var nn=new wt,ln=new wt,ic,lc,vi,wi,Ni,br={point:Ye,lineStart:Ye,lineEnd:Ye,polygonStart:function(){nn=new wt,br.lineStart=Rx,br.lineEnd=Tx},polygonEnd:function(){var t=+nn;ln.add(t<0?Wt+t:t),this.lineStart=this.lineEnd=this.point=Ye},sphere:function(){ln.add(Wt)}};function Rx(){br.point=Kx}function Tx(){oc(ic,lc)}function Kx(t,r){br.point=oc,ic=t,lc=r,t*=we,r*=we,vi=t,wi=fe(r=r/2+rn),Ni=me(r)}function oc(t,r){t*=we,r*=we,r=r/2+rn;var a=t-vi,s=a>=0?1:-1,n=s*a,i=fe(r),l=me(r),c=Ni*l,h=wi*i+c*fe(n),g=c*s*me(n);nn.add(Ft(g,h)),vi=t,wi=i,Ni=l}function Hx(t){return ln=new wt,ar(t,br),ln*2}function on(t){return[Ft(t[1],t[0]),At(t[2])]}function ra(t){var r=t[0],a=t[1],s=fe(a);return[s*fe(r),s*me(r),me(a)]}function Ls(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function va(t,r){return[t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]]}function Qn(t,r){t[0]+=r[0],t[1]+=r[1],t[2]+=r[2]}function Is(t,r){return[t[0]*r,t[1]*r,t[2]*r]}function cn(t){var r=gt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=r,t[1]/=r,t[2]/=r}var Ue,Pt,Xe,Rt,qr,cc,dc,ba,Ja,Pr,Fr,kr={point:_i,lineStart:A0,lineEnd:$0,polygonStart:function(){kr.point=gc,kr.lineStart=Gx,kr.lineEnd=Zx,Ja=new wt,br.polygonStart()},polygonEnd:function(){br.polygonEnd(),kr.point=_i,kr.lineStart=A0,kr.lineEnd=$0,nn<0?(Ue=-(Xe=180),Pt=-(Rt=90)):Ja>ve?Rt=90:Ja<-ve&&(Pt=-90),Fr[0]=Ue,Fr[1]=Xe},sphere:function(){Ue=-(Xe=180),Pt=-(Rt=90)}};function _i(t,r){Pr.push(Fr=[Ue=t,Xe=t]),r<Pt&&(Pt=r),r>Rt&&(Rt=r)}function hc(t,r){var a=ra([t*we,r*we]);if(ba){var s=va(ba,a),n=[s[1],-s[0],0],i=va(n,s);cn(i),i=on(i);var l=t-qr,c=l>0?1:-1,h=i[0]*Ge*c,g,o=Ve(l)>180;o^(c*qr<h&&h<c*t)?(g=i[1]*Ge,g>Rt&&(Rt=g)):(h=(h+360)%360-180,o^(c*qr<h&&h<c*t)?(g=-i[1]*Ge,g<Pt&&(Pt=g)):(r<Pt&&(Pt=r),r>Rt&&(Rt=r))),o?t<qr?Ot(Ue,t)>Ot(Ue,Xe)&&(Xe=t):Ot(t,Xe)>Ot(Ue,Xe)&&(Ue=t):Xe>=Ue?(t<Ue&&(Ue=t),t>Xe&&(Xe=t)):t>qr?Ot(Ue,t)>Ot(Ue,Xe)&&(Xe=t):Ot(t,Xe)>Ot(Ue,Xe)&&(Ue=t)}else Pr.push(Fr=[Ue=t,Xe=t]);r<Pt&&(Pt=r),r>Rt&&(Rt=r),ba=a,qr=t}function A0(){kr.point=hc}function $0(){Fr[0]=Ue,Fr[1]=Xe,kr.point=_i,ba=null}function gc(t,r){if(ba){var a=t-qr;Ja.add(Ve(a)>180?a+(a>0?360:-360):a)}else cc=t,dc=r;br.point(t,r),hc(t,r)}function Gx(){br.lineStart()}function Zx(){gc(cc,dc),br.lineEnd(),Ve(Ja)>ve&&(Ue=-(Xe=180)),Fr[0]=Ue,Fr[1]=Xe,ba=null}function Ot(t,r){return(r-=t)<0?r+360:r}function Jx(t,r){return t[0]-r[0]}function C0(t,r){return t[0]<=t[1]?t[0]<=r&&r<=t[1]:r<t[0]||t[1]<r}function qx(t){var r,a,s,n,i,l,c;if(Rt=Xe=-(Ue=Pt=1/0),Pr=[],ar(t,kr),a=Pr.length){for(Pr.sort(Jx),r=1,s=Pr[0],i=[s];r<a;++r)n=Pr[r],C0(s,n[0])||C0(s,n[1])?(Ot(s[0],n[1])>Ot(s[0],s[1])&&(s[1]=n[1]),Ot(n[0],s[1])>Ot(s[0],s[1])&&(s[0]=n[0])):i.push(s=n);for(l=-1/0,a=i.length-1,r=0,s=i[a];r<=a;s=n,++r)n=i[r],(c=Ot(s[1],n[0]))>l&&(l=c,Ue=n[0],Xe=s[1])}return Pr=Fr=null,Ue===1/0||Pt===1/0?[[NaN,NaN],[NaN,NaN]]:[[Ue,Pt],[Xe,Rt]]}var Va,dn,hn,gn,xn,un,mn,pn,zi,Si,Ei,xc,uc,_t,zt,St,nr={sphere:Ye,point:pl,lineStart:P0,lineEnd:D0,polygonStart:function(){nr.lineStart=Xx,nr.lineEnd=Qx},polygonEnd:function(){nr.lineStart=P0,nr.lineEnd=D0}};function pl(t,r){t*=we,r*=we;var a=fe(r);ys(a*fe(t),a*me(t),me(r))}function ys(t,r,a){++Va,hn+=(t-hn)/Va,gn+=(r-gn)/Va,xn+=(a-xn)/Va}function P0(){nr.point=Ux}function Ux(t,r){t*=we,r*=we;var a=fe(r);_t=a*fe(t),zt=a*me(t),St=me(r),nr.point=Yx,ys(_t,zt,St)}function Yx(t,r){t*=we,r*=we;var a=fe(r),s=a*fe(t),n=a*me(t),i=me(r),l=Ft(gt((l=zt*i-St*n)*l+(l=St*s-_t*i)*l+(l=_t*n-zt*s)*l),_t*s+zt*n+St*i);dn+=l,un+=l*(_t+(_t=s)),mn+=l*(zt+(zt=n)),pn+=l*(St+(St=i)),ys(_t,zt,St)}function D0(){nr.point=pl}function Xx(){nr.point=eu}function Qx(){mc(xc,uc),nr.point=pl}function eu(t,r){xc=t,uc=r,t*=we,r*=we,nr.point=mc;var a=fe(r);_t=a*fe(t),zt=a*me(t),St=me(r),ys(_t,zt,St)}function mc(t,r){t*=we,r*=we;var a=fe(r),s=a*fe(t),n=a*me(t),i=me(r),l=zt*i-St*n,c=St*s-_t*i,h=_t*n-zt*s,g=ji(l,c,h),o=At(g),x=g&&-o/g;zi.add(x*l),Si.add(x*c),Ei.add(x*h),dn+=o,un+=o*(_t+(_t=s)),mn+=o*(zt+(zt=n)),pn+=o*(St+(St=i)),ys(_t,zt,St)}function tu(t){Va=dn=hn=gn=xn=un=mn=pn=0,zi=new wt,Si=new wt,Ei=new wt,ar(t,nr);var r=+zi,a=+Si,s=+Ei,n=ji(r,a,s);return n<ss&&(r=un,a=mn,s=pn,dn<ve&&(r=hn,a=gn,s=xn),n=ji(r,a,s),n<ss)?[NaN,NaN]:[Ft(a,r)*Ge,At(s/n)*Ge]}function ca(t){return function(){return t}}function Mi(t,r){function a(s,n){return s=t(s,n),r(s[0],s[1])}return t.invert&&r.invert&&(a.invert=function(s,n){return s=r.invert(s,n),s&&t.invert(s[0],s[1])}),a}function Wi(t,r){return[Ve(t)>Pe?t+Math.round(-t/Wt)*Wt:t,r]}Wi.invert=Wi;function bl(t,r,a){return(t%=Wt)?r||a?Mi(I0(t),V0(r,a)):I0(t):r||a?V0(r,a):Wi}function L0(t){return function(r,a){return r+=t,[r>Pe?r-Wt:r<-Pe?r+Wt:r,a]}}function I0(t){var r=L0(t);return r.invert=L0(-t),r}function V0(t,r){var a=fe(t),s=me(t),n=fe(r),i=me(r);function l(c,h){var g=fe(h),o=fe(c)*g,x=me(c)*g,u=me(h),d=u*a+o*s;return[Ft(x*n-d*i,o*a-u*s),At(d*n+x*i)]}return l.invert=function(c,h){var g=fe(h),o=fe(c)*g,x=me(c)*g,u=me(h),d=u*n-x*i;return[Ft(x*n+u*i,o*a+d*s),At(d*a-o*s)]},l}function pc(t){t=bl(t[0]*we,t[1]*we,t.length>2?t[2]*we:0);function r(a){return a=t(a[0]*we,a[1]*we),a[0]*=Ge,a[1]*=Ge,a}return r.invert=function(a){return a=t.invert(a[0]*we,a[1]*we),a[0]*=Ge,a[1]*=Ge,a},r}function bc(t,r,a,s,n,i){if(a){var l=fe(r),c=me(r),h=s*a;n==null?(n=r+s*Wt,i=r-h/2):(n=B0(l,n),i=B0(l,i),(s>0?n<i:n>i)&&(n+=s*Wt));for(var g,o=n;s>0?o>i:o<i;o-=h)g=on([l,-c*fe(o),-c*me(o)]),t.point(g[0],g[1])}}function B0(t,r){r=ra(r),r[0]-=t,cn(r);var a=nc(-r[1]);return((-r[2]<0?-a:a)+Wt-ve)%Wt}function ru(){var t=ca([0,0]),r=ca(90),a=ca(6),s,n,i={point:l};function l(h,g){s.push(h=n(h,g)),h[0]*=Ge,h[1]*=Ge}function c(){var h=t.apply(this,arguments),g=r.apply(this,arguments)*we,o=a.apply(this,arguments)*we;return s=[],n=bl(-h[0]*we,-h[1]*we,0).invert,bc(i,g,o,1),h={type:"Polygon",coordinates:[s]},s=n=null,h}return c.center=function(h){return arguments.length?(t=typeof h=="function"?h:ca([+h[0],+h[1]]),c):t},c.radius=function(h){return arguments.length?(r=typeof h=="function"?h:ca(+h),c):r},c.precision=function(h){return arguments.length?(a=typeof h=="function"?h:ca(+h),c):a},c}function fc(){var t=[],r;return{point:function(a,s,n){r.push([a,s,n])},lineStart:function(){t.push(r=[])},lineEnd:Ye,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var a=t;return t=[],r=null,a}}}function qs(t,r){return Ve(t[0]-r[0])<ve&&Ve(t[1]-r[1])<ve}function Vs(t,r,a,s){this.x=t,this.z=r,this.o=a,this.e=s,this.v=!1,this.n=this.p=null}function yc(t,r,a,s,n){var i=[],l=[],c,h;if(t.forEach(function(p){if(!((b=p.length-1)<=0)){var b,j=p[0],f=p[b],y;if(qs(j,f)){if(!j[2]&&!f[2]){for(n.lineStart(),c=0;c<b;++c)n.point((j=p[c])[0],j[1]);n.lineEnd();return}f[0]+=2*ve}i.push(y=new Vs(j,p,null,!0)),l.push(y.o=new Vs(j,null,y,!1)),i.push(y=new Vs(f,p,null,!1)),l.push(y.o=new Vs(f,null,y,!0))}}),!!i.length){for(l.sort(r),O0(i),O0(l),c=0,h=l.length;c<h;++c)l[c].e=a=!a;for(var g=i[0],o,x;;){for(var u=g,d=!0;u.v;)if((u=u.n)===g)return;o=u.z,n.lineStart();do{if(u.v=u.o.v=!0,u.e){if(d)for(c=0,h=o.length;c<h;++c)n.point((x=o[c])[0],x[1]);else s(u.x,u.n.x,1,n);u=u.n}else{if(d)for(o=u.p.z,c=o.length-1;c>=0;--c)n.point((x=o[c])[0],x[1]);else s(u.x,u.p.x,-1,n);u=u.p}u=u.o,o=u.z,d=!d}while(!u.v);n.lineEnd()}}}function O0(t){if(r=t.length){for(var r,a=0,s=t[0],n;++a<r;)s.n=n=t[a],n.p=s,s=n;s.n=n=t[0],n.p=s}}function ei(t){return Ve(t[0])<=Pe?t[0]:Ut(t[0])*((Ve(t[0])+Pe)%Wt-Pe)}function jc(t,r){var a=ei(r),s=r[1],n=me(s),i=[me(a),-fe(a),0],l=0,c=0,h=new wt;n===1?s=at+ve:n===-1&&(s=-at-ve);for(var g=0,o=t.length;g<o;++g)if(u=(x=t[g]).length)for(var x,u,d=x[u-1],p=ei(d),b=d[1]/2+rn,j=me(b),f=fe(b),y=0;y<u;++y,p=_,j=v,f=E,d=k){var k=x[y],_=ei(k),w=k[1]/2+rn,v=me(w),E=fe(w),F=_-p,C=F>=0?1:-1,D=C*F,A=D>Pe,S=j*v;if(h.add(Ft(S*C*me(D),f*E+S*fe(D))),l+=A?F+C*Wt:F,A^p>=a^_>=a){var W=va(ra(d),ra(k));cn(W);var N=va(i,W);cn(N);var z=(A^F>=0?-1:1)*At(N[2]);(s>z||s===z&&(W[0]||W[1]))&&(c+=A^F>=0?1:-1)}}return(l<-ve||l<ve&&h<-ss)^c&1}function kc(t,r,a,s){return function(n){var i=r(n),l=fc(),c=r(l),h=!1,g,o,x,u={point:d,lineStart:b,lineEnd:j,polygonStart:function(){u.point=f,u.lineStart=y,u.lineEnd=k,o=[],g=[]},polygonEnd:function(){u.point=d,u.lineStart=b,u.lineEnd=j,o=ac(o);var _=jc(g,s);o.length?(h||(n.polygonStart(),h=!0),yc(o,su,_,a,n)):_&&(h||(n.polygonStart(),h=!0),n.lineStart(),a(null,null,1,n),n.lineEnd()),h&&(n.polygonEnd(),h=!1),o=g=null},sphere:function(){n.polygonStart(),n.lineStart(),a(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function d(_,w){t(_,w)&&n.point(_,w)}function p(_,w){i.point(_,w)}function b(){u.point=p,i.lineStart()}function j(){u.point=d,i.lineEnd()}function f(_,w){x.push([_,w]),c.point(_,w)}function y(){c.lineStart(),x=[]}function k(){f(x[0][0],x[0][1]),c.lineEnd();var _=c.clean(),w=l.result(),v,E=w.length,F,C,D;if(x.pop(),g.push(x),x=null,!!E){if(_&1){if(C=w[0],(F=C.length-1)>0){for(h||(n.polygonStart(),h=!0),n.lineStart(),v=0;v<F;++v)n.point((D=C[v])[0],D[1]);n.lineEnd()}return}E>1&&_&2&&w.push(w.pop().concat(w.shift())),o.push(w.filter(au))}}return u}}function au(t){return t.length>1}function su(t,r){return((t=t.x)[0]<0?t[1]-at-ve:at-t[1])-((r=r.x)[0]<0?r[1]-at-ve:at-r[1])}const Fi=kc(function(){return!0},nu,lu,[-Pe,-at]);function nu(t){var r=NaN,a=NaN,s=NaN,n;return{lineStart:function(){t.lineStart(),n=1},point:function(i,l){var c=i>0?Pe:-Pe,h=Ve(i-r);Ve(h-Pe)<ve?(t.point(r,a=(a+l)/2>0?at:-at),t.point(s,a),t.lineEnd(),t.lineStart(),t.point(c,a),t.point(i,a),n=0):s!==c&&h>=Pe&&(Ve(r-s)<ve&&(r-=s*ve),Ve(i-c)<ve&&(i-=c*ve),a=iu(r,a,i,l),t.point(s,a),t.lineEnd(),t.lineStart(),t.point(c,a),n=0),t.point(r=i,a=l),s=c},lineEnd:function(){t.lineEnd(),r=a=NaN},clean:function(){return 2-n}}}function iu(t,r,a,s){var n,i,l=me(t-a);return Ve(l)>ve?Sa((me(r)*(i=fe(s))*me(a)-me(s)*(n=fe(r))*me(t))/(n*i*l)):(r+s)/2}function lu(t,r,a,s){var n;if(t==null)n=a*at,s.point(-Pe,n),s.point(0,n),s.point(Pe,n),s.point(Pe,0),s.point(Pe,-n),s.point(0,-n),s.point(-Pe,-n),s.point(-Pe,0),s.point(-Pe,n);else if(Ve(t[0]-r[0])>ve){var i=t[0]<r[0]?Pe:-Pe;n=a*i/2,s.point(-i,n),s.point(0,n),s.point(i,n)}else s.point(r[0],r[1])}function vc(t){var r=fe(t),a=6*we,s=r>0,n=Ve(r)>ve;function i(o,x,u,d){bc(d,t,a,u,o,x)}function l(o,x){return fe(o)*fe(x)>r}function c(o){var x,u,d,p,b;return{lineStart:function(){p=d=!1,b=1},point:function(j,f){var y=[j,f],k,_=l(j,f),w=s?_?0:g(j,f):_?g(j+(j<0?Pe:-Pe),f):0;if(!x&&(p=d=_)&&o.lineStart(),_!==d&&(k=h(x,y),(!k||qs(x,k)||qs(y,k))&&(y[2]=1)),_!==d)b=0,_?(o.lineStart(),k=h(y,x),o.point(k[0],k[1])):(k=h(x,y),o.point(k[0],k[1],2),o.lineEnd()),x=k;else if(n&&x&&s^_){var v;!(w&u)&&(v=h(y,x,!0))&&(b=0,s?(o.lineStart(),o.point(v[0][0],v[0][1]),o.point(v[1][0],v[1][1]),o.lineEnd()):(o.point(v[1][0],v[1][1]),o.lineEnd(),o.lineStart(),o.point(v[0][0],v[0][1],3)))}_&&(!x||!qs(x,y))&&o.point(y[0],y[1]),x=y,d=_,u=w},lineEnd:function(){d&&o.lineEnd(),x=null},clean:function(){return b|(p&&d)<<1}}}function h(o,x,u){var d=ra(o),p=ra(x),b=[1,0,0],j=va(d,p),f=Ls(j,j),y=j[0],k=f-y*y;if(!k)return!u&&o;var _=r*f/k,w=-r*y/k,v=va(b,j),E=Is(b,_),F=Is(j,w);Qn(E,F);var C=v,D=Ls(E,C),A=Ls(C,C),S=D*D-A*(Ls(E,E)-1);if(!(S<0)){var W=gt(S),N=Is(C,(-D-W)/A);if(Qn(N,E),N=on(N),!u)return N;var z=o[0],$=x[0],T=o[1],I=x[1],V;$<z&&(V=z,z=$,$=V);var G=$-z,Z=Ve(G-Pe)<ve,R=Z||G<ve;if(!Z&&I<T&&(V=T,T=I,I=V),R?Z?T+I>0^N[1]<(Ve(N[0]-z)<ve?T:I):T<=N[1]&&N[1]<=I:G>Pe^(z<=N[0]&&N[0]<=$)){var M=Is(C,(-D+W)/A);return Qn(M,E),[N,on(M)]}}}function g(o,x){var u=s?t:Pe-t,d=0;return o<-u?d|=1:o>u&&(d|=2),x<-u?d|=4:x>u&&(d|=8),d}return kc(l,c,i,s?[0,-t]:[-Pe,t-Pe])}function ou(t,r,a,s,n,i){var l=t[0],c=t[1],h=r[0],g=r[1],o=0,x=1,u=h-l,d=g-c,p;if(p=a-l,!(!u&&p>0)){if(p/=u,u<0){if(p<o)return;p<x&&(x=p)}else if(u>0){if(p>x)return;p>o&&(o=p)}if(p=n-l,!(!u&&p<0)){if(p/=u,u<0){if(p>x)return;p>o&&(o=p)}else if(u>0){if(p<o)return;p<x&&(x=p)}if(p=s-c,!(!d&&p>0)){if(p/=d,d<0){if(p<o)return;p<x&&(x=p)}else if(d>0){if(p>x)return;p>o&&(o=p)}if(p=i-c,!(!d&&p<0)){if(p/=d,d<0){if(p>x)return;p>o&&(o=p)}else if(d>0){if(p<o)return;p<x&&(x=p)}return o>0&&(t[0]=l+o*u,t[1]=c+o*d),x<1&&(r[0]=l+x*u,r[1]=c+x*d),!0}}}}}var Ba=1e9,Bs=-Ba;function Ln(t,r,a,s){function n(g,o){return t<=g&&g<=a&&r<=o&&o<=s}function i(g,o,x,u){var d=0,p=0;if(g==null||(d=l(g,x))!==(p=l(o,x))||h(g,o)<0^x>0)do u.point(d===0||d===3?t:a,d>1?s:r);while((d=(d+x+4)%4)!==p);else u.point(o[0],o[1])}function l(g,o){return Ve(g[0]-t)<ve?o>0?0:3:Ve(g[0]-a)<ve?o>0?2:1:Ve(g[1]-r)<ve?o>0?1:0:o>0?3:2}function c(g,o){return h(g.x,o.x)}function h(g,o){var x=l(g,1),u=l(o,1);return x!==u?x-u:x===0?o[1]-g[1]:x===1?g[0]-o[0]:x===2?g[1]-o[1]:o[0]-g[0]}return function(g){var o=g,x=fc(),u,d,p,b,j,f,y,k,_,w,v,E={point:F,lineStart:S,lineEnd:W,polygonStart:D,polygonEnd:A};function F(z,$){n(z,$)&&o.point(z,$)}function C(){for(var z=0,$=0,T=d.length;$<T;++$)for(var I=d[$],V=1,G=I.length,Z=I[0],R,M,H=Z[0],K=Z[1];V<G;++V)R=H,M=K,Z=I[V],H=Z[0],K=Z[1],M<=s?K>s&&(H-R)*(s-M)>(K-M)*(t-R)&&++z:K<=s&&(H-R)*(s-M)<(K-M)*(t-R)&&--z;return z}function D(){o=x,u=[],d=[],v=!0}function A(){var z=C(),$=v&&z,T=(u=ac(u)).length;($||T)&&(g.polygonStart(),$&&(g.lineStart(),i(null,null,1,g),g.lineEnd()),T&&yc(u,c,z,i,g),g.polygonEnd()),o=g,u=d=p=null}function S(){E.point=N,d&&d.push(p=[]),w=!0,_=!1,y=k=NaN}function W(){u&&(N(b,j),f&&_&&x.rejoin(),u.push(x.result())),E.point=F,_&&o.lineEnd()}function N(z,$){var T=n(z,$);if(d&&p.push([z,$]),w)b=z,j=$,f=T,w=!1,T&&(o.lineStart(),o.point(z,$));else if(T&&_)o.point(z,$);else{var I=[y=Math.max(Bs,Math.min(Ba,y)),k=Math.max(Bs,Math.min(Ba,k))],V=[z=Math.max(Bs,Math.min(Ba,z)),$=Math.max(Bs,Math.min(Ba,$))];ou(I,V,t,r,a,s)?(_||(o.lineStart(),o.point(I[0],I[1])),o.point(V[0],V[1]),T||o.lineEnd(),v=!1):T&&(o.lineStart(),o.point(z,$),v=!1)}y=z,k=$,_=T}return E}}function cu(){var t=0,r=0,a=960,s=500,n,i,l;return l={stream:function(c){return n&&i===c?n:n=Ln(t,r,a,s)(i=c)},extent:function(c){return arguments.length?(t=+c[0][0],r=+c[0][1],a=+c[1][0],s=+c[1][1],n=i=null,l):[[t,r],[a,s]]}}}var Ai,$i,Us,Ys,wa={sphere:Ye,point:Ye,lineStart:du,lineEnd:Ye,polygonStart:Ye,polygonEnd:Ye};function du(){wa.point=gu,wa.lineEnd=hu}function hu(){wa.point=wa.lineEnd=Ye}function gu(t,r){t*=we,r*=we,$i=t,Us=me(r),Ys=fe(r),wa.point=xu}function xu(t,r){t*=we,r*=we;var a=me(r),s=fe(r),n=Ve(t-$i),i=fe(n),l=me(n),c=s*l,h=Ys*a-Us*s*i,g=Us*a+Ys*s*i;Ai.add(Ft(gt(c*c+h*h),g)),$i=t,Us=a,Ys=s}function wc(t){return Ai=new wt,ar(t,wa),+Ai}var Ci=[null,null],uu={type:"LineString",coordinates:Ci};function bn(t,r){return Ci[0]=t,Ci[1]=r,wc(uu)}var R0={Feature:function(t,r){return fn(t.geometry,r)},FeatureCollection:function(t,r){for(var a=t.features,s=-1,n=a.length;++s<n;)if(fn(a[s].geometry,r))return!0;return!1}},T0={Sphere:function(){return!0},Point:function(t,r){return K0(t.coordinates,r)},MultiPoint:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)if(K0(a[s],r))return!0;return!1},LineString:function(t,r){return H0(t.coordinates,r)},MultiLineString:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)if(H0(a[s],r))return!0;return!1},Polygon:function(t,r){return G0(t.coordinates,r)},MultiPolygon:function(t,r){for(var a=t.coordinates,s=-1,n=a.length;++s<n;)if(G0(a[s],r))return!0;return!1},GeometryCollection:function(t,r){for(var a=t.geometries,s=-1,n=a.length;++s<n;)if(fn(a[s],r))return!0;return!1}};function fn(t,r){return t&&T0.hasOwnProperty(t.type)?T0[t.type](t,r):!1}function K0(t,r){return bn(t,r)===0}function H0(t,r){for(var a,s,n,i=0,l=t.length;i<l;i++){if(s=bn(t[i],r),s===0||i>0&&(n=bn(t[i],t[i-1]),n>0&&a<=n&&s<=n&&(a+s-n)*(1-Math.pow((a-s)/n,2))<ss*n))return!0;a=s}return!1}function G0(t,r){return!!jc(t.map(mu),Nc(r))}function mu(t){return t=t.map(Nc),t.pop(),t}function Nc(t){return[t[0]*we,t[1]*we]}function pu(t,r){return(t&&R0.hasOwnProperty(t.type)?R0[t.type]:fn)(t,r)}function Z0(t,r,a){var s=ua(t,r-ve,a).concat(r);return function(n){return s.map(function(i){return[n,i]})}}function J0(t,r,a){var s=ua(t,r-ve,a).concat(r);return function(n){return s.map(function(i){return[i,n]})}}function fl(){var t,r,a,s,n,i,l,c,h=10,g=h,o=90,x=360,u,d,p,b,j=2.5;function f(){return{type:"MultiLineString",coordinates:y()}}function y(){return ua(Ds(s/o)*o,a,o).map(p).concat(ua(Ds(c/x)*x,l,x).map(b)).concat(ua(Ds(r/h)*h,t,h).filter(function(k){return Ve(k%o)>ve}).map(u)).concat(ua(Ds(i/g)*g,n,g).filter(function(k){return Ve(k%x)>ve}).map(d))}return f.lines=function(){return y().map(function(k){return{type:"LineString",coordinates:k}})},f.outline=function(){return{type:"Polygon",coordinates:[p(s).concat(b(l).slice(1),p(a).reverse().slice(1),b(c).reverse().slice(1))]}},f.extent=function(k){return arguments.length?f.extentMajor(k).extentMinor(k):f.extentMinor()},f.extentMajor=function(k){return arguments.length?(s=+k[0][0],a=+k[1][0],c=+k[0][1],l=+k[1][1],s>a&&(k=s,s=a,a=k),c>l&&(k=c,c=l,l=k),f.precision(j)):[[s,c],[a,l]]},f.extentMinor=function(k){return arguments.length?(r=+k[0][0],t=+k[1][0],i=+k[0][1],n=+k[1][1],r>t&&(k=r,r=t,t=k),i>n&&(k=i,i=n,n=k),f.precision(j)):[[r,i],[t,n]]},f.step=function(k){return arguments.length?f.stepMajor(k).stepMinor(k):f.stepMinor()},f.stepMajor=function(k){return arguments.length?(o=+k[0],x=+k[1],f):[o,x]},f.stepMinor=function(k){return arguments.length?(h=+k[0],g=+k[1],f):[h,g]},f.precision=function(k){return arguments.length?(j=+k,u=Z0(i,n,90),d=J0(r,t,j),p=Z0(c,l,90),b=J0(s,a,j),f):j},f.extentMajor([[-180,-90+ve],[180,90-ve]]).extentMinor([[-180,-80-ve],[180,80+ve]])}function bu(){return fl()()}function fu(t,r){var a=t[0]*we,s=t[1]*we,n=r[0]*we,i=r[1]*we,l=fe(s),c=me(s),h=fe(i),g=me(i),o=l*fe(a),x=l*me(a),u=h*fe(n),d=h*me(n),p=2*At(gt(E0(i-s)+l*h*E0(n-a))),b=me(p),j=p?function(f){var y=me(f*=p)/b,k=me(p-f)/b,_=k*o+y*u,w=k*x+y*d,v=k*c+y*g;return[Ft(w,_)*Ge,Ft(v,gt(_*_+w*w))*Ge]}:function(){return[a*Ge,s*Ge]};return j.distance=p,j}const ns=t=>t;var ti=new wt,Pi=new wt,_c,zc,Di,Li,vr={point:Ye,lineStart:Ye,lineEnd:Ye,polygonStart:function(){vr.lineStart=yu,vr.lineEnd=ku},polygonEnd:function(){vr.lineStart=vr.lineEnd=vr.point=Ye,ti.add(Ve(Pi)),Pi=new wt},result:function(){var t=ti/2;return ti=new wt,t}};function yu(){vr.point=ju}function ju(t,r){vr.point=Sc,_c=Di=t,zc=Li=r}function Sc(t,r){Pi.add(Li*t-Di*r),Di=t,Li=r}function ku(){Sc(_c,zc)}var Na=1/0,yn=Na,is=-Na,jn=is,kn={point:vu,lineStart:Ye,lineEnd:Ye,polygonStart:Ye,polygonEnd:Ye,result:function(){var t=[[Na,yn],[is,jn]];return is=jn=-(yn=Na=1/0),t}};function vu(t,r){t<Na&&(Na=t),t>is&&(is=t),r<yn&&(yn=r),r>jn&&(jn=r)}var Ii=0,Vi=0,Oa=0,vn=0,wn=0,ma=0,Bi=0,Oi=0,Ra=0,Ec,Mc,hr,gr,qt={point:aa,lineStart:q0,lineEnd:U0,polygonStart:function(){qt.lineStart=_u,qt.lineEnd=zu},polygonEnd:function(){qt.point=aa,qt.lineStart=q0,qt.lineEnd=U0},result:function(){var t=Ra?[Bi/Ra,Oi/Ra]:ma?[vn/ma,wn/ma]:Oa?[Ii/Oa,Vi/Oa]:[NaN,NaN];return Ii=Vi=Oa=vn=wn=ma=Bi=Oi=Ra=0,t}};function aa(t,r){Ii+=t,Vi+=r,++Oa}function q0(){qt.point=wu}function wu(t,r){qt.point=Nu,aa(hr=t,gr=r)}function Nu(t,r){var a=t-hr,s=r-gr,n=gt(a*a+s*s);vn+=n*(hr+t)/2,wn+=n*(gr+r)/2,ma+=n,aa(hr=t,gr=r)}function U0(){qt.point=aa}function _u(){qt.point=Su}function zu(){Wc(Ec,Mc)}function Su(t,r){qt.point=Wc,aa(Ec=hr=t,Mc=gr=r)}function Wc(t,r){var a=t-hr,s=r-gr,n=gt(a*a+s*s);vn+=n*(hr+t)/2,wn+=n*(gr+r)/2,ma+=n,n=gr*t-hr*r,Bi+=n*(hr+t),Oi+=n*(gr+r),Ra+=n*3,aa(hr=t,gr=r)}function Fc(t){this._context=t}Fc.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,r){switch(this._point){case 0:{this._context.moveTo(t,r),this._point=1;break}case 1:{this._context.lineTo(t,r);break}default:{this._context.moveTo(t+this._radius,r),this._context.arc(t,r,this._radius,0,Wt);break}}},result:Ye};var Ri=new wt,ri,Ac,$c,Ta,Ka,ls={point:Ye,lineStart:function(){ls.point=Eu},lineEnd:function(){ri&&Cc(Ac,$c),ls.point=Ye},polygonStart:function(){ri=!0},polygonEnd:function(){ri=null},result:function(){var t=+Ri;return Ri=new wt,t}};function Eu(t,r){ls.point=Cc,Ac=Ta=t,$c=Ka=r}function Cc(t,r){Ta-=t,Ka-=r,Ri.add(gt(Ta*Ta+Ka*Ka)),Ta=t,Ka=r}function Pc(){this._string=[]}Pc.prototype={_radius:4.5,_circle:Y0(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(t,r){switch(this._point){case 0:{this._string.push("M",t,",",r),this._point=1;break}case 1:{this._string.push("L",t,",",r);break}default:{this._circle==null&&(this._circle=Y0(this._radius)),this._string.push("M",t,",",r,this._circle);break}}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}else return null}};function Y0(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Dc(t,r){var a=4.5,s,n;function i(l){return l&&(typeof a=="function"&&n.pointRadius(+a.apply(this,arguments)),ar(l,s(n))),n.result()}return i.area=function(l){return ar(l,s(vr)),vr.result()},i.measure=function(l){return ar(l,s(ls)),ls.result()},i.bounds=function(l){return ar(l,s(kn)),kn.result()},i.centroid=function(l){return ar(l,s(qt)),qt.result()},i.projection=function(l){return arguments.length?(s=l==null?(t=null,ns):(t=l).stream,i):t},i.context=function(l){return arguments.length?(n=l==null?(r=null,new Pc):new Fc(r=l),typeof a!="function"&&n.pointRadius(a),i):r},i.pointRadius=function(l){return arguments.length?(a=typeof l=="function"?l:(n.pointRadius(+l),+l),i):a},i.projection(t).context(r)}function Mu(t){return{stream:js(t)}}function js(t){return function(r){var a=new Ti;for(var s in t)a[s]=t[s];return a.stream=r,a}}function Ti(){}Ti.prototype={constructor:Ti,point:function(t,r){this.stream.point(t,r)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function yl(t,r,a){var s=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),s!=null&&t.clipExtent(null),ar(a,t.stream(kn)),r(kn.result()),s!=null&&t.clipExtent(s),t}function In(t,r,a){return yl(t,function(s){var n=r[1][0]-r[0][0],i=r[1][1]-r[0][1],l=Math.min(n/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),c=+r[0][0]+(n-l*(s[1][0]+s[0][0]))/2,h=+r[0][1]+(i-l*(s[1][1]+s[0][1]))/2;t.scale(150*l).translate([c,h])},a)}function jl(t,r,a){return In(t,[[0,0],r],a)}function kl(t,r,a){return yl(t,function(s){var n=+r,i=n/(s[1][0]-s[0][0]),l=(n-i*(s[1][0]+s[0][0]))/2,c=-i*s[0][1];t.scale(150*i).translate([l,c])},a)}function vl(t,r,a){return yl(t,function(s){var n=+r,i=n/(s[1][1]-s[0][1]),l=-i*s[0][0],c=(n-i*(s[1][1]+s[0][1]))/2;t.scale(150*i).translate([l,c])},a)}var X0=16,Wu=fe(30*we);function Q0(t,r){return+r?Au(t,r):Fu(t)}function Fu(t){return js({point:function(r,a){r=t(r,a),this.stream.point(r[0],r[1])}})}function Au(t,r){function a(s,n,i,l,c,h,g,o,x,u,d,p,b,j){var f=g-s,y=o-n,k=f*f+y*y;if(k>4*r&&b--){var _=l+u,w=c+d,v=h+p,E=gt(_*_+w*w+v*v),F=At(v/=E),C=Ve(Ve(v)-1)<ve||Ve(i-x)<ve?(i+x)/2:Ft(w,_),D=t(C,F),A=D[0],S=D[1],W=A-s,N=S-n,z=y*W-f*N;(z*z/k>r||Ve((f*W+y*N)/k-.5)>.3||l*u+c*d+h*p<Wu)&&(a(s,n,i,l,c,h,A,S,C,_/=E,w/=E,v,b,j),j.point(A,S),a(A,S,C,_,w,v,g,o,x,u,d,p,b,j))}}return function(s){var n,i,l,c,h,g,o,x,u,d,p,b,j={point:f,lineStart:y,lineEnd:_,polygonStart:function(){s.polygonStart(),j.lineStart=w},polygonEnd:function(){s.polygonEnd(),j.lineStart=y}};function f(F,C){F=t(F,C),s.point(F[0],F[1])}function y(){x=NaN,j.point=k,s.lineStart()}function k(F,C){var D=ra([F,C]),A=t(F,C);a(x,u,o,d,p,b,x=A[0],u=A[1],o=F,d=D[0],p=D[1],b=D[2],X0,s),s.point(x,u)}function _(){j.point=f,s.lineEnd()}function w(){y(),j.point=v,j.lineEnd=E}function v(F,C){k(n=F,C),i=x,l=u,c=d,h=p,g=b,j.point=k}function E(){a(x,u,o,d,p,b,i,l,n,c,h,g,X0,s),j.lineEnd=_,_()}return j}}var $u=js({point:function(t,r){this.stream.point(t*we,r*we)}});function Cu(t){return js({point:function(r,a){var s=t(r,a);return this.stream.point(s[0],s[1])}})}function Pu(t,r,a,s,n){function i(l,c){return l*=s,c*=n,[r+t*l,a-t*c]}return i.invert=function(l,c){return[(l-r)/t*s,(a-c)/t*n]},i}function eo(t,r,a,s,n,i){if(!i)return Pu(t,r,a,s,n);var l=fe(i),c=me(i),h=l*t,g=c*t,o=l/t,x=c/t,u=(c*a-l*r)/t,d=(c*r+l*a)/t;function p(b,j){return b*=s,j*=n,[h*b-g*j+r,a-g*b-h*j]}return p.invert=function(b,j){return[s*(o*b-x*j+u),n*(d-x*b-o*j)]},p}function fr(t){return wl(function(){return t})()}function wl(t){var r,a=150,s=480,n=250,i=0,l=0,c=0,h=0,g=0,o,x=0,u=1,d=1,p=null,b=Fi,j=null,f,y,k,_=ns,w=.5,v,E,F,C,D;function A(z){return F(z[0]*we,z[1]*we)}function S(z){return z=F.invert(z[0],z[1]),z&&[z[0]*Ge,z[1]*Ge]}A.stream=function(z){return C&&D===z?C:C=$u(Cu(o)(b(v(_(D=z)))))},A.preclip=function(z){return arguments.length?(b=z,p=void 0,N()):b},A.postclip=function(z){return arguments.length?(_=z,j=f=y=k=null,N()):_},A.clipAngle=function(z){return arguments.length?(b=+z?vc(p=z*we):(p=null,Fi),N()):p*Ge},A.clipExtent=function(z){return arguments.length?(_=z==null?(j=f=y=k=null,ns):Ln(j=+z[0][0],f=+z[0][1],y=+z[1][0],k=+z[1][1]),N()):j==null?null:[[j,f],[y,k]]},A.scale=function(z){return arguments.length?(a=+z,W()):a},A.translate=function(z){return arguments.length?(s=+z[0],n=+z[1],W()):[s,n]},A.center=function(z){return arguments.length?(i=z[0]%360*we,l=z[1]%360*we,W()):[i*Ge,l*Ge]},A.rotate=function(z){return arguments.length?(c=z[0]%360*we,h=z[1]%360*we,g=z.length>2?z[2]%360*we:0,W()):[c*Ge,h*Ge,g*Ge]},A.angle=function(z){return arguments.length?(x=z%360*we,W()):x*Ge},A.reflectX=function(z){return arguments.length?(u=z?-1:1,W()):u<0},A.reflectY=function(z){return arguments.length?(d=z?-1:1,W()):d<0},A.precision=function(z){return arguments.length?(v=Q0(E,w=z*z),N()):gt(w)},A.fitExtent=function(z,$){return In(A,z,$)},A.fitSize=function(z,$){return jl(A,z,$)},A.fitWidth=function(z,$){return kl(A,z,$)},A.fitHeight=function(z,$){return vl(A,z,$)};function W(){var z=eo(a,0,0,u,d,x).apply(null,r(i,l)),$=eo(a,s-z[0],n-z[1],u,d,x);return o=bl(c,h,g),E=Mi(r,$),F=Mi(o,E),v=Q0(E,w),N()}function N(){return C=D=null,A}return function(){return r=t.apply(this,arguments),A.invert=r.invert&&S,W()}}function Nl(t){var r=0,a=Pe/3,s=wl(t),n=s(r,a);return n.parallels=function(i){return arguments.length?s(r=i[0]*we,a=i[1]*we):[r*Ge,a*Ge]},n}function Du(t){var r=fe(t);function a(s,n){return[s*r,me(n)/r]}return a.invert=function(s,n){return[s/r,At(n*r)]},a}function Lc(t,r){var a=me(t),s=(a+me(r))/2;if(Ve(s)<ve)return Du(t);var n=1+a*(2*s-a),i=gt(n)/s;function l(c,h){var g=gt(n-2*s*me(h))/s;return[g*me(c*=s),i-g*fe(c)]}return l.invert=function(c,h){var g=i-h,o=Ft(c,Ve(g))*Ut(g);return g*s<0&&(o-=Pe*Ut(c)*Ut(g)),[o/s,At((n-(c*c+g*g)*s*s)/(2*s))]},l}function Nn(){return Nl(Lc).scale(155.424).center([0,33.6442])}function Ic(){return Nn().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Lu(t){var r=t.length;return{point:function(a,s){for(var n=-1;++n<r;)t[n].point(a,s)},sphere:function(){for(var a=-1;++a<r;)t[a].sphere()},lineStart:function(){for(var a=-1;++a<r;)t[a].lineStart()},lineEnd:function(){for(var a=-1;++a<r;)t[a].lineEnd()},polygonStart:function(){for(var a=-1;++a<r;)t[a].polygonStart()},polygonEnd:function(){for(var a=-1;++a<r;)t[a].polygonEnd()}}}function Iu(){var t,r,a=Ic(),s,n=Nn().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i,l=Nn().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c,h,g={point:function(u,d){h=[u,d]}};function o(u){var d=u[0],p=u[1];return h=null,s.point(d,p),h||(i.point(d,p),h)||(c.point(d,p),h)}o.invert=function(u){var d=a.scale(),p=a.translate(),b=(u[0]-p[0])/d,j=(u[1]-p[1])/d;return(j>=.12&&j<.234&&b>=-.425&&b<-.214?n:j>=.166&&j<.234&&b>=-.214&&b<-.115?l:a).invert(u)},o.stream=function(u){return t&&r===u?t:t=Lu([a.stream(r=u),n.stream(u),l.stream(u)])},o.precision=function(u){return arguments.length?(a.precision(u),n.precision(u),l.precision(u),x()):a.precision()},o.scale=function(u){return arguments.length?(a.scale(u),n.scale(u*.35),l.scale(u),o.translate(a.translate())):a.scale()},o.translate=function(u){if(!arguments.length)return a.translate();var d=a.scale(),p=+u[0],b=+u[1];return s=a.translate(u).clipExtent([[p-.455*d,b-.238*d],[p+.455*d,b+.238*d]]).stream(g),i=n.translate([p-.307*d,b+.201*d]).clipExtent([[p-.425*d+ve,b+.12*d+ve],[p-.214*d-ve,b+.234*d-ve]]).stream(g),c=l.translate([p-.205*d,b+.212*d]).clipExtent([[p-.214*d+ve,b+.166*d+ve],[p-.115*d-ve,b+.234*d-ve]]).stream(g),x()},o.fitExtent=function(u,d){return In(o,u,d)},o.fitSize=function(u,d){return jl(o,u,d)},o.fitWidth=function(u,d){return kl(o,u,d)},o.fitHeight=function(u,d){return vl(o,u,d)};function x(){return t=r=null,o}return o.scale(1070)}function Vc(t){return function(r,a){var s=fe(r),n=fe(a),i=t(s*n);return i===1/0?[2,0]:[i*n*me(r),i*me(a)]}}function ks(t){return function(r,a){var s=gt(r*r+a*a),n=t(s),i=me(n),l=fe(n);return[Ft(r*i,s*l),At(s&&a*i/s)]}}var _l=Vc(function(t){return gt(2/(1+t))});_l.invert=ks(function(t){return 2*At(t/2)});function Vu(){return fr(_l).scale(124.75).clipAngle(180-.001)}var zl=Vc(function(t){return(t=nc(t))&&t/me(t)});zl.invert=ks(function(t){return t});function Bu(){return fr(zl).scale(79.4188).clipAngle(180-.001)}function vs(t,r){return[t,an(ml((at+r)/2))]}vs.invert=function(t,r){return[t,2*Sa(sc(r))-at]};function Ou(){return Bc(vs).scale(961/Wt)}function Bc(t){var r=fr(t),a=r.center,s=r.scale,n=r.translate,i=r.clipExtent,l=null,c,h,g;r.scale=function(x){return arguments.length?(s(x),o()):s()},r.translate=function(x){return arguments.length?(n(x),o()):n()},r.center=function(x){return arguments.length?(a(x),o()):a()},r.clipExtent=function(x){return arguments.length?(x==null?l=c=h=g=null:(l=+x[0][0],c=+x[0][1],h=+x[1][0],g=+x[1][1]),o()):l==null?null:[[l,c],[h,g]]};function o(){var x=Pe*s(),u=r(pc(r.rotate()).invert([0,0]));return i(l==null?[[u[0]-x,u[1]-x],[u[0]+x,u[1]+x]]:t===vs?[[Math.max(u[0]-x,l),c],[Math.min(u[0]+x,h),g]]:[[l,Math.max(u[1]-x,c)],[h,Math.min(u[1]+x,g)]])}return o()}function Os(t){return ml((at+t)/2)}function Oc(t,r){var a=fe(t),s=t===r?me(t):an(a/fe(r))/an(Os(r)/Os(t)),n=a*Xn(Os(t),s)/s;if(!s)return vs;function i(l,c){n>0?c<-at+ve&&(c=-at+ve):c>at-ve&&(c=at-ve);var h=n/Xn(Os(c),s);return[h*me(s*l),n-h*fe(s*l)]}return i.invert=function(l,c){var h=n-c,g=Ut(s)*gt(l*l+h*h),o=Ft(l,Ve(h))*Ut(h);return h*s<0&&(o-=Pe*Ut(l)*Ut(h)),[o/s,2*Sa(Xn(n/g,1/s))-at]},i}function Ru(){return Nl(Oc).scale(109.5).parallels([30,30])}function os(t,r){return[t,r]}os.invert=os;function Tu(){return fr(os).scale(152.63)}function Rc(t,r){var a=fe(t),s=t===r?me(t):(a-fe(r))/(r-t),n=a/s+t;if(Ve(s)<ve)return os;function i(l,c){var h=n-c,g=s*l;return[h*me(g),n-h*fe(g)]}return i.invert=function(l,c){var h=n-c,g=Ft(l,Ve(h))*Ut(h);return h*s<0&&(g-=Pe*Ut(l)*Ut(h)),[g/s,n-Ut(s)*gt(l*l+h*h)]},i}function Ku(){return Nl(Rc).scale(131.154).center([0,13.9389])}var qa=1.340264,Ua=-.081106,Ya=893e-6,Xa=.003796,_n=gt(3)/2,Hu=12;function Sl(t,r){var a=At(_n*me(r)),s=a*a,n=s*s*s;return[t*fe(a)/(_n*(qa+3*Ua*s+n*(7*Ya+9*Xa*s))),a*(qa+Ua*s+n*(Ya+Xa*s))]}Sl.invert=function(t,r){for(var a=r,s=a*a,n=s*s*s,i=0,l,c,h;i<Hu&&(c=a*(qa+Ua*s+n*(Ya+Xa*s))-r,h=qa+3*Ua*s+n*(7*Ya+9*Xa*s),a-=l=c/h,s=a*a,n=s*s*s,!(Ve(l)<ss));++i);return[_n*t*(qa+3*Ua*s+n*(7*Ya+9*Xa*s))/fe(a),At(me(a)/_n)]};function Gu(){return fr(Sl).scale(177.158)}function El(t,r){var a=fe(r),s=fe(t)*a;return[a*me(t)/s,me(r)/s]}El.invert=ks(Sa);function Zu(){return fr(El).scale(144.049).clipAngle(60)}function Ju(){var t=1,r=0,a=0,s=1,n=1,i=0,l,c,h=null,g,o,x,u=1,d=1,p=js({point:function(_,w){var v=k([_,w]);this.stream.point(v[0],v[1])}}),b=ns,j,f;function y(){return u=t*s,d=t*n,j=f=null,k}function k(_){var w=_[0]*u,v=_[1]*d;if(i){var E=v*l-w*c;w=w*l+v*c,v=E}return[w+r,v+a]}return k.invert=function(_){var w=_[0]-r,v=_[1]-a;if(i){var E=v*l+w*c;w=w*l-v*c,v=E}return[w/u,v/d]},k.stream=function(_){return j&&f===_?j:j=p(b(f=_))},k.postclip=function(_){return arguments.length?(b=_,h=g=o=x=null,y()):b},k.clipExtent=function(_){return arguments.length?(b=_==null?(h=g=o=x=null,ns):Ln(h=+_[0][0],g=+_[0][1],o=+_[1][0],x=+_[1][1]),y()):h==null?null:[[h,g],[o,x]]},k.scale=function(_){return arguments.length?(t=+_,y()):t},k.translate=function(_){return arguments.length?(r=+_[0],a=+_[1],y()):[r,a]},k.angle=function(_){return arguments.length?(i=_%360*we,c=me(i),l=fe(i),y()):i*Ge},k.reflectX=function(_){return arguments.length?(s=_?-1:1,y()):s<0},k.reflectY=function(_){return arguments.length?(n=_?-1:1,y()):n<0},k.fitExtent=function(_,w){return In(k,_,w)},k.fitSize=function(_,w){return jl(k,_,w)},k.fitWidth=function(_,w){return kl(k,_,w)},k.fitHeight=function(_,w){return vl(k,_,w)},k}function Ml(t,r){var a=r*r,s=a*a;return[t*(.8707-.131979*a+s*(-.013791+s*(.003971*a-.001529*s))),r*(1.007226+a*(.015085+s*(-.044475+.028874*a-.005916*s)))]}Ml.invert=function(t,r){var a=r,s=25,n;do{var i=a*a,l=i*i;a-=n=(a*(1.007226+i*(.015085+l*(-.044475+.028874*i-.005916*l)))-r)/(1.007226+i*(.015085*3+l*(-.044475*7+.028874*9*i-.005916*11*l)))}while(Ve(n)>ve&&--s>0);return[t/(.8707+(i=a*a)*(-.131979+i*(-.013791+i*i*i*(.003971-.001529*i)))),a]};function qu(){return fr(Ml).scale(175.295)}function Wl(t,r){return[fe(r)*me(t),me(r)]}Wl.invert=ks(At);function Uu(){return fr(Wl).scale(249.5).clipAngle(90+ve)}function Fl(t,r){var a=fe(r),s=1+fe(t)*a;return[a*me(t)/s,me(r)/s]}Fl.invert=ks(function(t){return 2*Sa(t)});function Yu(){return fr(Fl).scale(250).clipAngle(142)}function Al(t,r){return[an(ml((at+r)/2)),-t]}Al.invert=function(t,r){return[-r,2*Sa(sc(t))-at]};function Xu(){var t=Bc(Al),r=t.center,a=t.rotate;return t.center=function(s){return arguments.length?r([-s[1],s[0]]):(s=r(),[s[1],-s[0]])},t.rotate=function(s){return arguments.length?a([s[0],s[1],s.length>2?s[2]+90:90]):(s=a(),[s[0],s[1],s[2]-90])},a([0,0,90]).scale(159.155)}const Qu=Object.freeze(Object.defineProperty({__proto__:null,geoAlbers:Ic,geoAlbersUsa:Iu,geoArea:Hx,geoAzimuthalEqualArea:Vu,geoAzimuthalEqualAreaRaw:_l,geoAzimuthalEquidistant:Bu,geoAzimuthalEquidistantRaw:zl,geoBounds:qx,geoCentroid:tu,geoCircle:ru,geoClipAntimeridian:Fi,geoClipCircle:vc,geoClipExtent:cu,geoClipRectangle:Ln,geoConicConformal:Ru,geoConicConformalRaw:Oc,geoConicEqualArea:Nn,geoConicEqualAreaRaw:Lc,geoConicEquidistant:Ku,geoConicEquidistantRaw:Rc,geoContains:pu,geoDistance:bn,geoEqualEarth:Gu,geoEqualEarthRaw:Sl,geoEquirectangular:Tu,geoEquirectangularRaw:os,geoGnomonic:Zu,geoGnomonicRaw:El,geoGraticule:fl,geoGraticule10:bu,geoIdentity:Ju,geoInterpolate:fu,geoLength:wc,geoMercator:Ou,geoMercatorRaw:vs,geoNaturalEarth1:qu,geoNaturalEarth1Raw:Ml,geoOrthographic:Uu,geoOrthographicRaw:Wl,geoPath:Dc,geoProjection:fr,geoProjectionMutator:wl,geoRotation:pc,geoStereographic:Yu,geoStereographicRaw:Fl,geoStream:ar,geoTransform:Mu,geoTransverseMercator:Xu,geoTransverseMercatorRaw:Al},Symbol.toStringTag,{value:"Module"}));function em(t){return t}function tm(t){if(t==null)return em;var r,a,s=t.scale[0],n=t.scale[1],i=t.translate[0],l=t.translate[1];return function(c,h){h||(r=a=0);var g=2,o=c.length,x=new Array(o);for(x[0]=(r+=c[0])*s+i,x[1]=(a+=c[1])*n+l;g<o;)x[g]=c[g],++g;return x}}function rm(t,r){for(var a,s=t.length,n=s-r;n<--s;)a=t[n],t[n++]=t[s],t[s]=a}function am(t,r){return typeof r=="string"&&(r=t.objects[r]),r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(a){return to(t,a)})}:to(t,r)}function to(t,r){var a=r.id,s=r.bbox,n=r.properties==null?{}:r.properties,i=Tc(t,r);return a==null&&s==null?{type:"Feature",properties:n,geometry:i}:s==null?{type:"Feature",id:a,properties:n,geometry:i}:{type:"Feature",id:a,bbox:s,properties:n,geometry:i}}function Tc(t,r){var a=tm(t.transform),s=t.arcs;function n(o,x){x.length&&x.pop();for(var u=s[o<0?~o:o],d=0,p=u.length;d<p;++d)x.push(a(u[d],d));o<0&&rm(x,p)}function i(o){return a(o)}function l(o){for(var x=[],u=0,d=o.length;u<d;++u)n(o[u],x);return x.length<2&&x.push(x[0]),x}function c(o){for(var x=l(o);x.length<4;)x.push(x[0]);return x}function h(o){return o.map(c)}function g(o){var x=o.type,u;switch(x){case"GeometryCollection":return{type:x,geometries:o.geometries.map(g)};case"Point":u=i(o.coordinates);break;case"MultiPoint":u=o.coordinates.map(i);break;case"LineString":u=l(o.arcs);break;case"MultiLineString":u=o.arcs.map(l);break;case"Polygon":u=h(o.arcs);break;case"MultiPolygon":u=o.arcs.map(h);break;default:return null}return{type:x,coordinates:u}}return g(r)}function sm(t,r){var a={},s={},n={},i=[],l=-1;r.forEach(function(g,o){var x=t.arcs[g<0?~g:g],u;x.length<3&&!x[1][0]&&!x[1][1]&&(u=r[++l],r[l]=g,r[o]=u)}),r.forEach(function(g){var o=c(g),x=o[0],u=o[1],d,p;if(d=n[x])if(delete n[d.end],d.push(g),d.end=u,p=s[u]){delete s[p.start];var b=p===d?d:d.concat(p);s[b.start=d.start]=n[b.end=p.end]=b}else s[d.start]=n[d.end]=d;else if(d=s[u])if(delete s[d.start],d.unshift(g),d.start=x,p=n[x]){delete n[p.end];var j=p===d?d:p.concat(d);s[j.start=p.start]=n[j.end=d.end]=j}else s[d.start]=n[d.end]=d;else d=[g],s[d.start=x]=n[d.end=u]=d});function c(g){var o=t.arcs[g<0?~g:g],x=o[0],u;return t.transform?(u=[0,0],o.forEach(function(d){u[0]+=d[0],u[1]+=d[1]})):u=o[o.length-1],g<0?[u,x]:[x,u]}function h(g,o){for(var x in g){var u=g[x];delete o[u.start],delete u.start,delete u.end,u.forEach(function(d){a[d<0?~d:d]=1}),i.push(u)}}return h(n,s),h(s,n),r.forEach(function(g){a[g<0?~g:g]||i.push([g])}),i}function ro(t){return Tc(t,nm.apply(this,arguments))}function nm(t,r,a){var s,n,i;if(arguments.length>1)s=im(t,r,a);else for(n=0,s=new Array(i=t.arcs.length);n<i;++n)s[n]=n;return{type:"MultiLineString",arcs:sm(t,s)}}function im(t,r,a){var s=[],n=[],i;function l(x){var u=x<0?~x:x;(n[u]||(n[u]=[])).push({i:x,g:i})}function c(x){x.forEach(l)}function h(x){x.forEach(c)}function g(x){x.forEach(h)}function o(x){switch(i=x,x.type){case"GeometryCollection":x.geometries.forEach(o);break;case"LineString":c(x.arcs);break;case"MultiLineString":case"Polygon":h(x.arcs);break;case"MultiPolygon":g(x.arcs);break}}return o(r),n.forEach(a==null?function(x){s.push(x[0].i)}:function(x){a(x[0].g,x[x.length-1].g)&&s.push(x[0].i)}),s}var lm={value:()=>{}};function $l(){for(var t=0,r=arguments.length,a={},s;t<r;++t){if(!(s=arguments[t]+"")||s in a||/[\s.]/.test(s))throw new Error("illegal type: "+s);a[s]=[]}return new Xs(a)}function Xs(t){this._=t}function om(t,r){return t.trim().split(/^|\s+/).map(function(a){var s="",n=a.indexOf(".");if(n>=0&&(s=a.slice(n+1),a=a.slice(0,n)),a&&!r.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:s}})}Xs.prototype=$l.prototype={constructor:Xs,on:function(t,r){var a=this._,s=om(t+"",a),n,i=-1,l=s.length;if(arguments.length<2){for(;++i<l;)if((n=(t=s[i]).type)&&(n=cm(a[n],t.name)))return n;return}if(r!=null&&typeof r!="function")throw new Error("invalid callback: "+r);for(;++i<l;)if(n=(t=s[i]).type)a[n]=ao(a[n],t.name,r);else if(r==null)for(n in a)a[n]=ao(a[n],t.name,null);return this},copy:function(){var t={},r=this._;for(var a in r)t[a]=r[a].slice();return new Xs(t)},call:function(t,r){if((n=arguments.length-2)>0)for(var a=new Array(n),s=0,n,i;s<n;++s)a[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],s=0,n=i.length;s<n;++s)i[s].value.apply(r,a)},apply:function(t,r,a){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var s=this._[t],n=0,i=s.length;n<i;++n)s[n].value.apply(r,a)}};function cm(t,r){for(var a=0,s=t.length,n;a<s;++a)if((n=t[a]).name===r)return n.value}function ao(t,r,a){for(var s=0,n=t.length;s<n;++s)if(t[s].name===r){t[s]=lm,t=t.slice(0,s).concat(t.slice(s+1));break}return a!=null&&t.push({name:r,value:a}),t}var Ki="http://www.w3.org/1999/xhtml";const so={svg:"http://www.w3.org/2000/svg",xhtml:Ki,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Vn(t){var r=t+="",a=r.indexOf(":");return a>=0&&(r=t.slice(0,a))!=="xmlns"&&(t=t.slice(a+1)),so.hasOwnProperty(r)?{space:so[r],local:t}:t}function dm(t){return function(){var r=this.ownerDocument,a=this.namespaceURI;return a===Ki&&r.documentElement.namespaceURI===Ki?r.createElement(t):r.createElementNS(a,t)}}function hm(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Kc(t){var r=Vn(t);return(r.local?hm:dm)(r)}function gm(){}function Cl(t){return t==null?gm:function(){return this.querySelector(t)}}function xm(t){typeof t!="function"&&(t=Cl(t));for(var r=this._groups,a=r.length,s=new Array(a),n=0;n<a;++n)for(var i=r[n],l=i.length,c=s[n]=new Array(l),h,g,o=0;o<l;++o)(h=i[o])&&(g=t.call(h,h.__data__,o,i))&&("__data__"in h&&(g.__data__=h.__data__),c[o]=g);return new Vt(s,this._parents)}function Hc(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function um(){return[]}function Gc(t){return t==null?um:function(){return this.querySelectorAll(t)}}function mm(t){return function(){var r=t.apply(this,arguments);return r==null?[]:Hc(r)}}function pm(t){typeof t=="function"?t=mm(t):t=Gc(t);for(var r=this._groups,a=r.length,s=[],n=[],i=0;i<a;++i)for(var l=r[i],c=l.length,h,g=0;g<c;++g)(h=l[g])&&(s.push(t.call(h,h.__data__,g,l)),n.push(h));return new Vt(s,n)}function Zc(t){return function(){return this.matches(t)}}function Jc(t){return function(r){return r.matches(t)}}var bm=Array.prototype.find;function fm(t){return function(){return bm.call(this.children,t)}}function ym(){return this.firstElementChild}function jm(t){return this.select(t==null?ym:fm(typeof t=="function"?t:Jc(t)))}var km=Array.prototype.filter;function vm(){return this.children}function wm(t){return function(){return km.call(this.children,t)}}function Nm(t){return this.selectAll(t==null?vm:wm(typeof t=="function"?t:Jc(t)))}function _m(t){typeof t!="function"&&(t=Zc(t));for(var r=this._groups,a=r.length,s=new Array(a),n=0;n<a;++n)for(var i=r[n],l=i.length,c=s[n]=[],h,g=0;g<l;++g)(h=i[g])&&t.call(h,h.__data__,g,i)&&c.push(h);return new Vt(s,this._parents)}function qc(t){return new Array(t.length)}function zm(){return new Vt(this._enter||this._groups.map(qc),this._parents)}function zn(t,r){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=r}zn.prototype={constructor:zn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,r){return this._parent.insertBefore(t,r)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Sm(t){return function(){return t}}function Em(t,r,a,s,n,i){for(var l=0,c,h=r.length,g=i.length;l<g;++l)(c=r[l])?(c.__data__=i[l],s[l]=c):a[l]=new zn(t,i[l]);for(;l<h;++l)(c=r[l])&&(n[l]=c)}function Mm(t,r,a,s,n,i,l){var c,h,g=new Map,o=r.length,x=i.length,u=new Array(o),d;for(c=0;c<o;++c)(h=r[c])&&(u[c]=d=l.call(h,h.__data__,c,r)+"",g.has(d)?n[c]=h:g.set(d,h));for(c=0;c<x;++c)d=l.call(t,i[c],c,i)+"",(h=g.get(d))?(s[c]=h,h.__data__=i[c],g.delete(d)):a[c]=new zn(t,i[c]);for(c=0;c<o;++c)(h=r[c])&&g.get(u[c])===h&&(n[c]=h)}function Wm(t){return t.__data__}function Fm(t,r){if(!arguments.length)return Array.from(this,Wm);var a=r?Mm:Em,s=this._parents,n=this._groups;typeof t!="function"&&(t=Sm(t));for(var i=n.length,l=new Array(i),c=new Array(i),h=new Array(i),g=0;g<i;++g){var o=s[g],x=n[g],u=x.length,d=Hc(t.call(o,o&&o.__data__,g,s)),p=d.length,b=c[g]=new Array(p),j=l[g]=new Array(p),f=h[g]=new Array(u);a(o,x,b,j,f,d,r);for(var y=0,k=0,_,w;y<p;++y)if(_=b[y]){for(y>=k&&(k=y+1);!(w=j[k])&&++k<p;);_._next=w||null}}return l=new Vt(l,s),l._enter=c,l._exit=h,l}function Am(){return new Vt(this._exit||this._groups.map(qc),this._parents)}function $m(t,r,a){var s=this.enter(),n=this,i=this.exit();return s=typeof t=="function"?t(s):s.append(t+""),r!=null&&(n=r(n)),a==null?i.remove():a(i),s&&n?s.merge(n).order():n}function Cm(t){if(!(t instanceof Vt))throw new Error("invalid merge");for(var r=this._groups,a=t._groups,s=r.length,n=a.length,i=Math.min(s,n),l=new Array(s),c=0;c<i;++c)for(var h=r[c],g=a[c],o=h.length,x=l[c]=new Array(o),u,d=0;d<o;++d)(u=h[d]||g[d])&&(x[d]=u);for(;c<s;++c)l[c]=r[c];return new Vt(l,this._parents)}function Pm(){for(var t=this._groups,r=-1,a=t.length;++r<a;)for(var s=t[r],n=s.length-1,i=s[n],l;--n>=0;)(l=s[n])&&(i&&l.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(l,i),i=l);return this}function Dm(t){t||(t=Lm);function r(x,u){return x&&u?t(x.__data__,u.__data__):!x-!u}for(var a=this._groups,s=a.length,n=new Array(s),i=0;i<s;++i){for(var l=a[i],c=l.length,h=n[i]=new Array(c),g,o=0;o<c;++o)(g=l[o])&&(h[o]=g);h.sort(r)}return new Vt(n,this._parents).order()}function Lm(t,r){return t<r?-1:t>r?1:t>=r?0:NaN}function Im(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Vm(){return Array.from(this)}function Bm(){for(var t=this._groups,r=0,a=t.length;r<a;++r)for(var s=t[r],n=0,i=s.length;n<i;++n){var l=s[n];if(l)return l}return null}function Om(){let t=0;for(const r of this)++t;return t}function Rm(){return!this.node()}function Tm(t){for(var r=this._groups,a=0,s=r.length;a<s;++a)for(var n=r[a],i=0,l=n.length,c;i<l;++i)(c=n[i])&&t.call(c,c.__data__,i,n);return this}function Km(t){return function(){this.removeAttribute(t)}}function Hm(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Gm(t,r){return function(){this.setAttribute(t,r)}}function Zm(t,r){return function(){this.setAttributeNS(t.space,t.local,r)}}function Jm(t,r){return function(){var a=r.apply(this,arguments);a==null?this.removeAttribute(t):this.setAttribute(t,a)}}function qm(t,r){return function(){var a=r.apply(this,arguments);a==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,a)}}function Um(t,r){var a=Vn(t);if(arguments.length<2){var s=this.node();return a.local?s.getAttributeNS(a.space,a.local):s.getAttribute(a)}return this.each((r==null?a.local?Hm:Km:typeof r=="function"?a.local?qm:Jm:a.local?Zm:Gm)(a,r))}function Uc(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ym(t){return function(){this.style.removeProperty(t)}}function Xm(t,r,a){return function(){this.style.setProperty(t,r,a)}}function Qm(t,r,a){return function(){var s=r.apply(this,arguments);s==null?this.style.removeProperty(t):this.style.setProperty(t,s,a)}}function e1(t,r,a){return arguments.length>1?this.each((r==null?Ym:typeof r=="function"?Qm:Xm)(t,r,a??"")):_a(this.node(),t)}function _a(t,r){return t.style.getPropertyValue(r)||Uc(t).getComputedStyle(t,null).getPropertyValue(r)}function t1(t){return function(){delete this[t]}}function r1(t,r){return function(){this[t]=r}}function a1(t,r){return function(){var a=r.apply(this,arguments);a==null?delete this[t]:this[t]=a}}function s1(t,r){return arguments.length>1?this.each((r==null?t1:typeof r=="function"?a1:r1)(t,r)):this.node()[t]}function Yc(t){return t.trim().split(/^|\s+/)}function Pl(t){return t.classList||new Xc(t)}function Xc(t){this._node=t,this._names=Yc(t.getAttribute("class")||"")}Xc.prototype={add:function(t){var r=this._names.indexOf(t);r<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var r=this._names.indexOf(t);r>=0&&(this._names.splice(r,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Qc(t,r){for(var a=Pl(t),s=-1,n=r.length;++s<n;)a.add(r[s])}function ed(t,r){for(var a=Pl(t),s=-1,n=r.length;++s<n;)a.remove(r[s])}function n1(t){return function(){Qc(this,t)}}function i1(t){return function(){ed(this,t)}}function l1(t,r){return function(){(r.apply(this,arguments)?Qc:ed)(this,t)}}function o1(t,r){var a=Yc(t+"");if(arguments.length<2){for(var s=Pl(this.node()),n=-1,i=a.length;++n<i;)if(!s.contains(a[n]))return!1;return!0}return this.each((typeof r=="function"?l1:r?n1:i1)(a,r))}function c1(){this.textContent=""}function d1(t){return function(){this.textContent=t}}function h1(t){return function(){var r=t.apply(this,arguments);this.textContent=r??""}}function g1(t){return arguments.length?this.each(t==null?c1:(typeof t=="function"?h1:d1)(t)):this.node().textContent}function x1(){this.innerHTML=""}function u1(t){return function(){this.innerHTML=t}}function m1(t){return function(){var r=t.apply(this,arguments);this.innerHTML=r??""}}function p1(t){return arguments.length?this.each(t==null?x1:(typeof t=="function"?m1:u1)(t)):this.node().innerHTML}function b1(){this.nextSibling&&this.parentNode.appendChild(this)}function f1(){return this.each(b1)}function y1(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function j1(){return this.each(y1)}function k1(t){var r=typeof t=="function"?t:Kc(t);return this.select(function(){return this.appendChild(r.apply(this,arguments))})}function v1(){return null}function w1(t,r){var a=typeof t=="function"?t:Kc(t),s=r==null?v1:typeof r=="function"?r:Cl(r);return this.select(function(){return this.insertBefore(a.apply(this,arguments),s.apply(this,arguments)||null)})}function N1(){var t=this.parentNode;t&&t.removeChild(this)}function _1(){return this.each(N1)}function z1(){var t=this.cloneNode(!1),r=this.parentNode;return r?r.insertBefore(t,this.nextSibling):t}function S1(){var t=this.cloneNode(!0),r=this.parentNode;return r?r.insertBefore(t,this.nextSibling):t}function E1(t){return this.select(t?S1:z1)}function M1(t){return arguments.length?this.property("__data__",t):this.node().__data__}function W1(t){return function(r){t.call(this,r,this.__data__)}}function F1(t){return t.trim().split(/^|\s+/).map(function(r){var a="",s=r.indexOf(".");return s>=0&&(a=r.slice(s+1),r=r.slice(0,s)),{type:r,name:a}})}function A1(t){return function(){var r=this.__on;if(r){for(var a=0,s=-1,n=r.length,i;a<n;++a)i=r[a],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):r[++s]=i;++s?r.length=s:delete this.__on}}}function $1(t,r,a){return function(){var s=this.__on,n,i=W1(r);if(s){for(var l=0,c=s.length;l<c;++l)if((n=s[l]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=i,n.options=a),n.value=r;return}}this.addEventListener(t.type,i,a),n={type:t.type,name:t.name,value:r,listener:i,options:a},s?s.push(n):this.__on=[n]}}function C1(t,r,a){var s=F1(t+""),n,i=s.length,l;if(arguments.length<2){var c=this.node().__on;if(c){for(var h=0,g=c.length,o;h<g;++h)for(n=0,o=c[h];n<i;++n)if((l=s[n]).type===o.type&&l.name===o.name)return o.value}return}for(c=r?$1:A1,n=0;n<i;++n)this.each(c(s[n],r,a));return this}function td(t,r,a){var s=Uc(t),n=s.CustomEvent;typeof n=="function"?n=new n(r,a):(n=s.document.createEvent("Event"),a?(n.initEvent(r,a.bubbles,a.cancelable),n.detail=a.detail):n.initEvent(r,!1,!1)),t.dispatchEvent(n)}function P1(t,r){return function(){return td(this,t,r)}}function D1(t,r){return function(){return td(this,t,r.apply(this,arguments))}}function L1(t,r){return this.each((typeof r=="function"?D1:P1)(t,r))}function*I1(){for(var t=this._groups,r=0,a=t.length;r<a;++r)for(var s=t[r],n=0,i=s.length,l;n<i;++n)(l=s[n])&&(yield l)}var rd=[null];function Vt(t,r){this._groups=t,this._parents=r}function ws(){return new Vt([[document.documentElement]],rd)}function V1(){return this}Vt.prototype=ws.prototype={constructor:Vt,select:xm,selectAll:pm,selectChild:jm,selectChildren:Nm,filter:_m,data:Fm,enter:zm,exit:Am,join:$m,merge:Cm,selection:V1,order:Pm,sort:Dm,call:Im,nodes:Vm,node:Bm,size:Om,empty:Rm,each:Tm,attr:Um,style:e1,property:s1,classed:o1,text:g1,html:p1,raise:f1,lower:j1,append:k1,insert:w1,remove:_1,clone:E1,datum:M1,on:C1,dispatch:L1,[Symbol.iterator]:I1};function wr(t){return typeof t=="string"?new Vt([[document.querySelector(t)]],[document.documentElement]):new Vt([[t]],rd)}function B1(t){let r;for(;r=t.sourceEvent;)t=r;return t}function Zr(t,r){if(t=B1(t),r===void 0&&(r=t.currentTarget),r){var a=r.ownerSVGElement||r;if(a.createSVGPoint){var s=a.createSVGPoint();return s.x=t.clientX,s.y=t.clientY,s=s.matrixTransform(r.getScreenCTM().inverse()),[s.x,s.y]}if(r.getBoundingClientRect){var n=r.getBoundingClientRect();return[t.clientX-n.left-r.clientLeft,t.clientY-n.top-r.clientTop]}}return[t.pageX,t.pageY]}function Hi(t){t.preventDefault(),t.stopImmediatePropagation()}function O1(t){var r=t.document.documentElement,a=wr(t).on("dragstart.drag",Hi,!0);"onselectstart"in r?a.on("selectstart.drag",Hi,!0):(r.__noselect=r.style.MozUserSelect,r.style.MozUserSelect="none")}function R1(t,r){var a=t.document.documentElement,s=wr(t).on("dragstart.drag",null);r&&(s.on("click.drag",Hi,!0),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in a?s.on("selectstart.drag",null):(a.style.MozUserSelect=a.__noselect,delete a.__noselect)}var T1=1e-12;function no(t){return((t=Math.exp(t))+1/t)/2}function K1(t){return((t=Math.exp(t))-1/t)/2}function H1(t){return((t=Math.exp(2*t))-1)/(t+1)}const G1=function t(r,a,s){function n(i,l){var c=i[0],h=i[1],g=i[2],o=l[0],x=l[1],u=l[2],d=o-c,p=x-h,b=d*d+p*p,j,f;if(b<T1)f=Math.log(u/g)/r,j=function(E){return[c+E*d,h+E*p,g*Math.exp(r*E*f)]};else{var y=Math.sqrt(b),k=(u*u-g*g+s*b)/(2*g*a*y),_=(u*u-g*g-s*b)/(2*u*a*y),w=Math.log(Math.sqrt(k*k+1)-k),v=Math.log(Math.sqrt(_*_+1)-_);f=(v-w)/r,j=function(E){var F=E*f,C=no(w),D=g/(a*y)*(C*H1(r*F+w)-K1(w));return[c+D*d,h+D*p,g*C/no(r*F+w)]}}return j.duration=f*1e3*r/Math.SQRT2,j}return n.rho=function(i){var l=Math.max(.001,+i),c=l*l,h=c*c;return t(l,c,h)},n}(Math.SQRT2,2,4);var za=0,Ha=0,Da=0,ad=1e3,Sn,Ga,En=0,sa=0,Bn=0,cs=typeof performance=="object"&&performance.now?performance:Date,sd=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Dl(){return sa||(sd(Z1),sa=cs.now()+Bn)}function Z1(){sa=0}function Mn(){this._call=this._time=this._next=null}Mn.prototype=nd.prototype={constructor:Mn,restart:function(t,r,a){if(typeof t!="function")throw new TypeError("callback is not a function");a=(a==null?Dl():+a)+(r==null?0:+r),!this._next&&Ga!==this&&(Ga?Ga._next=this:Sn=this,Ga=this),this._call=t,this._time=a,Gi()},stop:function(){this._call&&(this._call=null,this._time=1/0,Gi())}};function nd(t,r,a){var s=new Mn;return s.restart(t,r,a),s}function J1(){Dl(),++za;for(var t=Sn,r;t;)(r=sa-t._time)>=0&&t._call.call(null,r),t=t._next;--za}function io(){sa=(En=cs.now())+Bn,za=Ha=0;try{J1()}finally{za=0,U1(),sa=0}}function q1(){var t=cs.now(),r=t-En;r>ad&&(Bn-=r,En=t)}function U1(){for(var t,r=Sn,a,s=1/0;r;)r._call?(s>r._time&&(s=r._time),t=r,r=r._next):(a=r._next,r._next=null,r=t?t._next=a:Sn=a);Ga=t,Gi(s)}function Gi(t){if(!za){Ha&&(Ha=clearTimeout(Ha));var r=t-sa;r>24?(t<1/0&&(Ha=setTimeout(io,t-cs.now()-Bn)),Da&&(Da=clearInterval(Da))):(Da||(En=cs.now(),Da=setInterval(q1,ad)),za=1,sd(io))}}function lo(t,r,a){var s=new Mn;return r=r==null?0:+r,s.restart(n=>{s.stop(),t(n+r)},r,a),s}var Y1=$l("start","end","cancel","interrupt"),X1=[],id=0,oo=1,Zi=2,Qs=3,co=4,Ji=5,en=6;function On(t,r,a,s,n,i){var l=t.__transition;if(!l)t.__transition={};else if(a in l)return;Q1(t,a,{name:r,index:s,group:n,on:Y1,tween:X1,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:id})}function Ll(t,r){var a=or(t,r);if(a.state>id)throw new Error("too late; already scheduled");return a}function yr(t,r){var a=or(t,r);if(a.state>Qs)throw new Error("too late; already running");return a}function or(t,r){var a=t.__transition;if(!a||!(a=a[r]))throw new Error("transition not found");return a}function Q1(t,r,a){var s=t.__transition,n;s[r]=a,a.timer=nd(i,0,a.time);function i(g){a.state=oo,a.timer.restart(l,a.delay,a.time),a.delay<=g&&l(g-a.delay)}function l(g){var o,x,u,d;if(a.state!==oo)return h();for(o in s)if(d=s[o],d.name===a.name){if(d.state===Qs)return lo(l);d.state===co?(d.state=en,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete s[o]):+o<r&&(d.state=en,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete s[o])}if(lo(function(){a.state===Qs&&(a.state=co,a.timer.restart(c,a.delay,a.time),c(g))}),a.state=Zi,a.on.call("start",t,t.__data__,a.index,a.group),a.state===Zi){for(a.state=Qs,n=new Array(u=a.tween.length),o=0,x=-1;o<u;++o)(d=a.tween[o].value.call(t,t.__data__,a.index,a.group))&&(n[++x]=d);n.length=x+1}}function c(g){for(var o=g<a.duration?a.ease.call(null,g/a.duration):(a.timer.restart(h),a.state=Ji,1),x=-1,u=n.length;++x<u;)n[x].call(t,o);a.state===Ji&&(a.on.call("end",t,t.__data__,a.index,a.group),h())}function h(){a.state=en,a.timer.stop(),delete s[r];for(var g in s)return;delete t.__transition}}function tn(t,r){var a=t.__transition,s,n,i=!0,l;if(a){r=r==null?null:r+"";for(l in a){if((s=a[l]).name!==r){i=!1;continue}n=s.state>Zi&&s.state<Ji,s.state=en,s.timer.stop(),s.on.call(n?"interrupt":"cancel",t,t.__data__,s.index,s.group),delete a[l]}i&&delete t.__transition}}function ep(t){return this.each(function(){tn(this,t)})}function Il(t,r,a){t.prototype=r.prototype=a,a.constructor=t}function ld(t,r){var a=Object.create(t.prototype);for(var s in r)a[s]=r[s];return a}function Ns(){}var ds=.7,Wn=1/ds,fa="\\s*([+-]?\\d+)\\s*",hs="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",mr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",tp=/^#([0-9a-f]{3,8})$/,rp=new RegExp("^rgb\\("+[fa,fa,fa]+"\\)$"),ap=new RegExp("^rgb\\("+[mr,mr,mr]+"\\)$"),sp=new RegExp("^rgba\\("+[fa,fa,fa,hs]+"\\)$"),np=new RegExp("^rgba\\("+[mr,mr,mr,hs]+"\\)$"),ip=new RegExp("^hsl\\("+[hs,mr,mr]+"\\)$"),lp=new RegExp("^hsla\\("+[hs,mr,mr,hs]+"\\)$"),ho={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Il(Ns,gs,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:go,formatHex:go,formatHsl:op,formatRgb:xo,toString:xo});function go(){return this.rgb().formatHex()}function op(){return od(this).formatHsl()}function xo(){return this.rgb().formatRgb()}function gs(t){var r,a;return t=(t+"").trim().toLowerCase(),(r=tp.exec(t))?(a=r[1].length,r=parseInt(r[1],16),a===6?uo(r):a===3?new Tt(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):a===8?Rs(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):a===4?Rs(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=rp.exec(t))?new Tt(r[1],r[2],r[3],1):(r=ap.exec(t))?new Tt(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=sp.exec(t))?Rs(r[1],r[2],r[3],r[4]):(r=np.exec(t))?Rs(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=ip.exec(t))?bo(r[1],r[2]/100,r[3]/100,1):(r=lp.exec(t))?bo(r[1],r[2]/100,r[3]/100,r[4]):ho.hasOwnProperty(t)?uo(ho[t]):t==="transparent"?new Tt(NaN,NaN,NaN,0):null}function uo(t){return new Tt(t>>16&255,t>>8&255,t&255,1)}function Rs(t,r,a,s){return s<=0&&(t=r=a=NaN),new Tt(t,r,a,s)}function cp(t){return t instanceof Ns||(t=gs(t)),t?(t=t.rgb(),new Tt(t.r,t.g,t.b,t.opacity)):new Tt}function qi(t,r,a,s){return arguments.length===1?cp(t):new Tt(t,r,a,s??1)}function Tt(t,r,a,s){this.r=+t,this.g=+r,this.b=+a,this.opacity=+s}Il(Tt,qi,ld(Ns,{brighter:function(t){return t=t==null?Wn:Math.pow(Wn,t),new Tt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?ds:Math.pow(ds,t),new Tt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mo,formatHex:mo,formatRgb:po,toString:po}));function mo(){return"#"+ai(this.r)+ai(this.g)+ai(this.b)}function po(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function ai(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function bo(t,r,a,s){return s<=0?t=r=a=NaN:a<=0||a>=1?t=r=NaN:r<=0&&(t=NaN),new xr(t,r,a,s)}function od(t){if(t instanceof xr)return new xr(t.h,t.s,t.l,t.opacity);if(t instanceof Ns||(t=gs(t)),!t)return new xr;if(t instanceof xr)return t;t=t.rgb();var r=t.r/255,a=t.g/255,s=t.b/255,n=Math.min(r,a,s),i=Math.max(r,a,s),l=NaN,c=i-n,h=(i+n)/2;return c?(r===i?l=(a-s)/c+(a<s)*6:a===i?l=(s-r)/c+2:l=(r-a)/c+4,c/=h<.5?i+n:2-i-n,l*=60):c=h>0&&h<1?0:l,new xr(l,c,h,t.opacity)}function dp(t,r,a,s){return arguments.length===1?od(t):new xr(t,r,a,s??1)}function xr(t,r,a,s){this.h=+t,this.s=+r,this.l=+a,this.opacity=+s}Il(xr,dp,ld(Ns,{brighter:function(t){return t=t==null?Wn:Math.pow(Wn,t),new xr(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?ds:Math.pow(ds,t),new xr(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,r=isNaN(t)||isNaN(this.s)?0:this.s,a=this.l,s=a+(a<.5?a:1-a)*r,n=2*a-s;return new Tt(si(t>=240?t-240:t+120,n,s),si(t,n,s),si(t<120?t+240:t-120,n,s),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function si(t,r,a){return(t<60?r+(a-r)*t/60:t<180?a:t<240?r+(a-r)*(240-t)/60:r)*255}const cd=t=>()=>t;function hp(t,r){return function(a){return t+a*r}}function gp(t,r,a){return t=Math.pow(t,a),r=Math.pow(r,a)-t,a=1/a,function(s){return Math.pow(t+s*r,a)}}function xp(t){return(t=+t)==1?dd:function(r,a){return a-r?gp(r,a,t):cd(isNaN(r)?a:r)}}function dd(t,r){var a=r-t;return a?hp(t,a):cd(isNaN(t)?r:t)}const fo=function t(r){var a=xp(r);function s(n,i){var l=a((n=qi(n)).r,(i=qi(i)).r),c=a(n.g,i.g),h=a(n.b,i.b),g=dd(n.opacity,i.opacity);return function(o){return n.r=l(o),n.g=c(o),n.b=h(o),n.opacity=g(o),n+""}}return s.gamma=t,s}(1);function Dr(t,r){return t=+t,r=+r,function(a){return t*(1-a)+r*a}}var Ui=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ni=new RegExp(Ui.source,"g");function up(t){return function(){return t}}function mp(t){return function(r){return t(r)+""}}function pp(t,r){var a=Ui.lastIndex=ni.lastIndex=0,s,n,i,l=-1,c=[],h=[];for(t=t+"",r=r+"";(s=Ui.exec(t))&&(n=ni.exec(r));)(i=n.index)>a&&(i=r.slice(a,i),c[l]?c[l]+=i:c[++l]=i),(s=s[0])===(n=n[0])?c[l]?c[l]+=n:c[++l]=n:(c[++l]=null,h.push({i:l,x:Dr(s,n)})),a=ni.lastIndex;return a<r.length&&(i=r.slice(a),c[l]?c[l]+=i:c[++l]=i),c.length<2?h[0]?mp(h[0].x):up(r):(r=h.length,function(g){for(var o=0,x;o<r;++o)c[(x=h[o]).i]=x.x(g);return c.join("")})}var yo=180/Math.PI,Yi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hd(t,r,a,s,n,i){var l,c,h;return(l=Math.sqrt(t*t+r*r))&&(t/=l,r/=l),(h=t*a+r*s)&&(a-=t*h,s-=r*h),(c=Math.sqrt(a*a+s*s))&&(a/=c,s/=c,h/=c),t*s<r*a&&(t=-t,r=-r,h=-h,l=-l),{translateX:n,translateY:i,rotate:Math.atan2(r,t)*yo,skewX:Math.atan(h)*yo,scaleX:l,scaleY:c}}var Ts;function bp(t){const r=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return r.isIdentity?Yi:hd(r.a,r.b,r.c,r.d,r.e,r.f)}function fp(t){return t==null||(Ts||(Ts=document.createElementNS("http://www.w3.org/2000/svg","g")),Ts.setAttribute("transform",t),!(t=Ts.transform.baseVal.consolidate()))?Yi:(t=t.matrix,hd(t.a,t.b,t.c,t.d,t.e,t.f))}function gd(t,r,a,s){function n(g){return g.length?g.pop()+" ":""}function i(g,o,x,u,d,p){if(g!==x||o!==u){var b=d.push("translate(",null,r,null,a);p.push({i:b-4,x:Dr(g,x)},{i:b-2,x:Dr(o,u)})}else(x||u)&&d.push("translate("+x+r+u+a)}function l(g,o,x,u){g!==o?(g-o>180?o+=360:o-g>180&&(g+=360),u.push({i:x.push(n(x)+"rotate(",null,s)-2,x:Dr(g,o)})):o&&x.push(n(x)+"rotate("+o+s)}function c(g,o,x,u){g!==o?u.push({i:x.push(n(x)+"skewX(",null,s)-2,x:Dr(g,o)}):o&&x.push(n(x)+"skewX("+o+s)}function h(g,o,x,u,d,p){if(g!==x||o!==u){var b=d.push(n(d)+"scale(",null,",",null,")");p.push({i:b-4,x:Dr(g,x)},{i:b-2,x:Dr(o,u)})}else(x!==1||u!==1)&&d.push(n(d)+"scale("+x+","+u+")")}return function(g,o){var x=[],u=[];return g=t(g),o=t(o),i(g.translateX,g.translateY,o.translateX,o.translateY,x,u),l(g.rotate,o.rotate,x,u),c(g.skewX,o.skewX,x,u),h(g.scaleX,g.scaleY,o.scaleX,o.scaleY,x,u),g=o=null,function(d){for(var p=-1,b=u.length,j;++p<b;)x[(j=u[p]).i]=j.x(d);return x.join("")}}}var yp=gd(bp,"px, ","px)","deg)"),jp=gd(fp,", ",")",")");function kp(t,r){var a,s;return function(){var n=yr(this,t),i=n.tween;if(i!==a){s=a=i;for(var l=0,c=s.length;l<c;++l)if(s[l].name===r){s=s.slice(),s.splice(l,1);break}}n.tween=s}}function vp(t,r,a){var s,n;if(typeof a!="function")throw new Error;return function(){var i=yr(this,t),l=i.tween;if(l!==s){n=(s=l).slice();for(var c={name:r,value:a},h=0,g=n.length;h<g;++h)if(n[h].name===r){n[h]=c;break}h===g&&n.push(c)}i.tween=n}}function wp(t,r){var a=this._id;if(t+="",arguments.length<2){for(var s=or(this.node(),a).tween,n=0,i=s.length,l;n<i;++n)if((l=s[n]).name===t)return l.value;return null}return this.each((r==null?kp:vp)(a,t,r))}function Vl(t,r,a){var s=t._id;return t.each(function(){var n=yr(this,s);(n.value||(n.value={}))[r]=a.apply(this,arguments)}),function(n){return or(n,s).value[r]}}function xd(t,r){var a;return(typeof r=="number"?Dr:r instanceof gs?fo:(a=gs(r))?(r=a,fo):pp)(t,r)}function Np(t){return function(){this.removeAttribute(t)}}function _p(t){return function(){this.removeAttributeNS(t.space,t.local)}}function zp(t,r,a){var s,n=a+"",i;return function(){var l=this.getAttribute(t);return l===n?null:l===s?i:i=r(s=l,a)}}function Sp(t,r,a){var s,n=a+"",i;return function(){var l=this.getAttributeNS(t.space,t.local);return l===n?null:l===s?i:i=r(s=l,a)}}function Ep(t,r,a){var s,n,i;return function(){var l,c=a(this),h;return c==null?void this.removeAttribute(t):(l=this.getAttribute(t),h=c+"",l===h?null:l===s&&h===n?i:(n=h,i=r(s=l,c)))}}function Mp(t,r,a){var s,n,i;return function(){var l,c=a(this),h;return c==null?void this.removeAttributeNS(t.space,t.local):(l=this.getAttributeNS(t.space,t.local),h=c+"",l===h?null:l===s&&h===n?i:(n=h,i=r(s=l,c)))}}function Wp(t,r){var a=Vn(t),s=a==="transform"?jp:xd;return this.attrTween(t,typeof r=="function"?(a.local?Mp:Ep)(a,s,Vl(this,"attr."+t,r)):r==null?(a.local?_p:Np)(a):(a.local?Sp:zp)(a,s,r))}function Fp(t,r){return function(a){this.setAttribute(t,r.call(this,a))}}function Ap(t,r){return function(a){this.setAttributeNS(t.space,t.local,r.call(this,a))}}function $p(t,r){var a,s;function n(){var i=r.apply(this,arguments);return i!==s&&(a=(s=i)&&Ap(t,i)),a}return n._value=r,n}function Cp(t,r){var a,s;function n(){var i=r.apply(this,arguments);return i!==s&&(a=(s=i)&&Fp(t,i)),a}return n._value=r,n}function Pp(t,r){var a="attr."+t;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(r==null)return this.tween(a,null);if(typeof r!="function")throw new Error;var s=Vn(t);return this.tween(a,(s.local?$p:Cp)(s,r))}function Dp(t,r){return function(){Ll(this,t).delay=+r.apply(this,arguments)}}function Lp(t,r){return r=+r,function(){Ll(this,t).delay=r}}function Ip(t){var r=this._id;return arguments.length?this.each((typeof t=="function"?Dp:Lp)(r,t)):or(this.node(),r).delay}function Vp(t,r){return function(){yr(this,t).duration=+r.apply(this,arguments)}}function Bp(t,r){return r=+r,function(){yr(this,t).duration=r}}function Op(t){var r=this._id;return arguments.length?this.each((typeof t=="function"?Vp:Bp)(r,t)):or(this.node(),r).duration}function Rp(t,r){if(typeof r!="function")throw new Error;return function(){yr(this,t).ease=r}}function Tp(t){var r=this._id;return arguments.length?this.each(Rp(r,t)):or(this.node(),r).ease}function Kp(t,r){return function(){var a=r.apply(this,arguments);if(typeof a!="function")throw new Error;yr(this,t).ease=a}}function Hp(t){if(typeof t!="function")throw new Error;return this.each(Kp(this._id,t))}function Gp(t){typeof t!="function"&&(t=Zc(t));for(var r=this._groups,a=r.length,s=new Array(a),n=0;n<a;++n)for(var i=r[n],l=i.length,c=s[n]=[],h,g=0;g<l;++g)(h=i[g])&&t.call(h,h.__data__,g,i)&&c.push(h);return new Ar(s,this._parents,this._name,this._id)}function Zp(t){if(t._id!==this._id)throw new Error;for(var r=this._groups,a=t._groups,s=r.length,n=a.length,i=Math.min(s,n),l=new Array(s),c=0;c<i;++c)for(var h=r[c],g=a[c],o=h.length,x=l[c]=new Array(o),u,d=0;d<o;++d)(u=h[d]||g[d])&&(x[d]=u);for(;c<s;++c)l[c]=r[c];return new Ar(l,this._parents,this._name,this._id)}function Jp(t){return(t+"").trim().split(/^|\s+/).every(function(r){var a=r.indexOf(".");return a>=0&&(r=r.slice(0,a)),!r||r==="start"})}function qp(t,r,a){var s,n,i=Jp(r)?Ll:yr;return function(){var l=i(this,t),c=l.on;c!==s&&(n=(s=c).copy()).on(r,a),l.on=n}}function Up(t,r){var a=this._id;return arguments.length<2?or(this.node(),a).on.on(t):this.each(qp(a,t,r))}function Yp(t){return function(){var r=this.parentNode;for(var a in this.__transition)if(+a!==t)return;r&&r.removeChild(this)}}function Xp(){return this.on("end.remove",Yp(this._id))}function Qp(t){var r=this._name,a=this._id;typeof t!="function"&&(t=Cl(t));for(var s=this._groups,n=s.length,i=new Array(n),l=0;l<n;++l)for(var c=s[l],h=c.length,g=i[l]=new Array(h),o,x,u=0;u<h;++u)(o=c[u])&&(x=t.call(o,o.__data__,u,c))&&("__data__"in o&&(x.__data__=o.__data__),g[u]=x,On(g[u],r,a,u,g,or(o,a)));return new Ar(i,this._parents,r,a)}function e5(t){var r=this._name,a=this._id;typeof t!="function"&&(t=Gc(t));for(var s=this._groups,n=s.length,i=[],l=[],c=0;c<n;++c)for(var h=s[c],g=h.length,o,x=0;x<g;++x)if(o=h[x]){for(var u=t.call(o,o.__data__,x,h),d,p=or(o,a),b=0,j=u.length;b<j;++b)(d=u[b])&&On(d,r,a,b,u,p);i.push(u),l.push(o)}return new Ar(i,l,r,a)}var t5=ws.prototype.constructor;function r5(){return new t5(this._groups,this._parents)}function a5(t,r){var a,s,n;return function(){var i=_a(this,t),l=(this.style.removeProperty(t),_a(this,t));return i===l?null:i===a&&l===s?n:n=r(a=i,s=l)}}function ud(t){return function(){this.style.removeProperty(t)}}function s5(t,r,a){var s,n=a+"",i;return function(){var l=_a(this,t);return l===n?null:l===s?i:i=r(s=l,a)}}function n5(t,r,a){var s,n,i;return function(){var l=_a(this,t),c=a(this),h=c+"";return c==null&&(h=c=(this.style.removeProperty(t),_a(this,t))),l===h?null:l===s&&h===n?i:(n=h,i=r(s=l,c))}}function i5(t,r){var a,s,n,i="style."+r,l="end."+i,c;return function(){var h=yr(this,t),g=h.on,o=h.value[i]==null?c||(c=ud(r)):void 0;(g!==a||n!==o)&&(s=(a=g).copy()).on(l,n=o),h.on=s}}function l5(t,r,a){var s=(t+="")=="transform"?yp:xd;return r==null?this.styleTween(t,a5(t,s)).on("end.style."+t,ud(t)):typeof r=="function"?this.styleTween(t,n5(t,s,Vl(this,"style."+t,r))).each(i5(this._id,t)):this.styleTween(t,s5(t,s,r),a).on("end.style."+t,null)}function o5(t,r,a){return function(s){this.style.setProperty(t,r.call(this,s),a)}}function c5(t,r,a){var s,n;function i(){var l=r.apply(this,arguments);return l!==n&&(s=(n=l)&&o5(t,l,a)),s}return i._value=r,i}function d5(t,r,a){var s="style."+(t+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(r==null)return this.tween(s,null);if(typeof r!="function")throw new Error;return this.tween(s,c5(t,r,a??""))}function h5(t){return function(){this.textContent=t}}function g5(t){return function(){var r=t(this);this.textContent=r??""}}function x5(t){return this.tween("text",typeof t=="function"?g5(Vl(this,"text",t)):h5(t==null?"":t+""))}function u5(t){return function(r){this.textContent=t.call(this,r)}}function m5(t){var r,a;function s(){var n=t.apply(this,arguments);return n!==a&&(r=(a=n)&&u5(n)),r}return s._value=t,s}function p5(t){var r="text";if(arguments.length<1)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,m5(t))}function b5(){for(var t=this._name,r=this._id,a=md(),s=this._groups,n=s.length,i=0;i<n;++i)for(var l=s[i],c=l.length,h,g=0;g<c;++g)if(h=l[g]){var o=or(h,r);On(h,t,a,g,l,{time:o.time+o.delay+o.duration,delay:0,duration:o.duration,ease:o.ease})}return new Ar(s,this._parents,t,a)}function f5(){var t,r,a=this,s=a._id,n=a.size();return new Promise(function(i,l){var c={value:l},h={value:function(){--n===0&&i()}};a.each(function(){var g=yr(this,s),o=g.on;o!==t&&(r=(t=o).copy(),r._.cancel.push(c),r._.interrupt.push(c),r._.end.push(h)),g.on=r}),n===0&&i()})}var y5=0;function Ar(t,r,a,s){this._groups=t,this._parents=r,this._name=a,this._id=s}function md(){return++y5}var Jr=ws.prototype;Ar.prototype={constructor:Ar,select:Qp,selectAll:e5,filter:Gp,merge:Zp,selection:r5,transition:b5,call:Jr.call,nodes:Jr.nodes,node:Jr.node,size:Jr.size,empty:Jr.empty,each:Jr.each,on:Up,attr:Wp,attrTween:Pp,style:l5,styleTween:d5,text:x5,textTween:p5,remove:Xp,tween:wp,delay:Ip,duration:Op,ease:Tp,easeVarying:Hp,end:f5,[Symbol.iterator]:Jr[Symbol.iterator]};function j5(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var k5={time:null,delay:0,duration:250,ease:j5};function v5(t,r){for(var a;!(a=t.__transition)||!(a=a[r]);)if(!(t=t.parentNode))throw new Error(`transition ${r} not found`);return a}function w5(t){var r,a;t instanceof Ar?(r=t._id,t=t._name):(r=md(),(a=k5).time=Dl(),t=t==null?null:t+"");for(var s=this._groups,n=s.length,i=0;i<n;++i)for(var l=s[i],c=l.length,h,g=0;g<c;++g)(h=l[g])&&On(h,t,r,g,l,a||v5(h,r));return new Ar(s,this._parents,t,r)}ws.prototype.interrupt=ep;ws.prototype.transition=w5;const Ks=t=>()=>t;function N5(t,{sourceEvent:r,target:a,transform:s,dispatch:n}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:r,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:n}})}function Sr(t,r,a){this.k=t,this.x=r,this.y=a}Sr.prototype={constructor:Sr,scale:function(t){return t===1?this:new Sr(this.k*t,this.x,this.y)},translate:function(t,r){return t===0&r===0?this:new Sr(this.k,this.x+this.k*t,this.y+this.k*r)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Bl=new Sr(1,0,0);Sr.prototype;function ii(t){t.stopImmediatePropagation()}function La(t){t.preventDefault(),t.stopImmediatePropagation()}function _5(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function z5(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function jo(){return this.__zoom||Bl}function S5(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function E5(){return navigator.maxTouchPoints||"ontouchstart"in this}function M5(t,r,a){var s=t.invertX(r[0][0])-a[0][0],n=t.invertX(r[1][0])-a[1][0],i=t.invertY(r[0][1])-a[0][1],l=t.invertY(r[1][1])-a[1][1];return t.translate(n>s?(s+n)/2:Math.min(0,s)||Math.max(0,n),l>i?(i+l)/2:Math.min(0,i)||Math.max(0,l))}function W5(){var t=_5,r=z5,a=M5,s=S5,n=E5,i=[0,1/0],l=[[-1/0,-1/0],[1/0,1/0]],c=250,h=G1,g=$l("start","zoom","end"),o,x,u,d=500,p=150,b=0,j=10;function f(N){N.property("__zoom",jo).on("wheel.zoom",F).on("mousedown.zoom",C).on("dblclick.zoom",D).filter(n).on("touchstart.zoom",A).on("touchmove.zoom",S).on("touchend.zoom touchcancel.zoom",W).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}f.transform=function(N,z,$,T){var I=N.selection?N.selection():N;I.property("__zoom",jo),N!==I?w(N,z,$,T):I.interrupt().each(function(){v(this,arguments).event(T).start().zoom(null,typeof z=="function"?z.apply(this,arguments):z).end()})},f.scaleBy=function(N,z,$,T){f.scaleTo(N,function(){var I=this.__zoom.k,V=typeof z=="function"?z.apply(this,arguments):z;return I*V},$,T)},f.scaleTo=function(N,z,$,T){f.transform(N,function(){var I=r.apply(this,arguments),V=this.__zoom,G=$==null?_(I):typeof $=="function"?$.apply(this,arguments):$,Z=V.invert(G),R=typeof z=="function"?z.apply(this,arguments):z;return a(k(y(V,R),G,Z),I,l)},$,T)},f.translateBy=function(N,z,$,T){f.transform(N,function(){return a(this.__zoom.translate(typeof z=="function"?z.apply(this,arguments):z,typeof $=="function"?$.apply(this,arguments):$),r.apply(this,arguments),l)},null,T)},f.translateTo=function(N,z,$,T,I){f.transform(N,function(){var V=r.apply(this,arguments),G=this.__zoom,Z=T==null?_(V):typeof T=="function"?T.apply(this,arguments):T;return a(Bl.translate(Z[0],Z[1]).scale(G.k).translate(typeof z=="function"?-z.apply(this,arguments):-z,typeof $=="function"?-$.apply(this,arguments):-$),V,l)},T,I)};function y(N,z){return z=Math.max(i[0],Math.min(i[1],z)),z===N.k?N:new Sr(z,N.x,N.y)}function k(N,z,$){var T=z[0]-$[0]*N.k,I=z[1]-$[1]*N.k;return T===N.x&&I===N.y?N:new Sr(N.k,T,I)}function _(N){return[(+N[0][0]+ +N[1][0])/2,(+N[0][1]+ +N[1][1])/2]}function w(N,z,$,T){N.on("start.zoom",function(){v(this,arguments).event(T).start()}).on("interrupt.zoom end.zoom",function(){v(this,arguments).event(T).end()}).tween("zoom",function(){var I=this,V=arguments,G=v(I,V).event(T),Z=r.apply(I,V),R=$==null?_(Z):typeof $=="function"?$.apply(I,V):$,M=Math.max(Z[1][0]-Z[0][0],Z[1][1]-Z[0][1]),H=I.__zoom,K=typeof z=="function"?z.apply(I,V):z,O=h(H.invert(R).concat(M/H.k),K.invert(R).concat(M/K.k));return function(ee){if(ee===1)ee=K;else{var de=O(ee),ue=M/de[2];ee=new Sr(ue,R[0]-de[0]*ue,R[1]-de[1]*ue)}G.zoom(null,ee)}})}function v(N,z,$){return!$&&N.__zooming||new E(N,z)}function E(N,z){this.that=N,this.args=z,this.active=0,this.sourceEvent=null,this.extent=r.apply(N,z),this.taps=0}E.prototype={event:function(N){return N&&(this.sourceEvent=N),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(N,z){return this.mouse&&N!=="mouse"&&(this.mouse[1]=z.invert(this.mouse[0])),this.touch0&&N!=="touch"&&(this.touch0[1]=z.invert(this.touch0[0])),this.touch1&&N!=="touch"&&(this.touch1[1]=z.invert(this.touch1[0])),this.that.__zoom=z,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(N){var z=wr(this.that).datum();g.call(N,this.that,new N5(N,{sourceEvent:this.sourceEvent,target:f,transform:this.that.__zoom,dispatch:g}),z)}};function F(N,...z){if(!t.apply(this,arguments))return;var $=v(this,z).event(N),T=this.__zoom,I=Math.max(i[0],Math.min(i[1],T.k*Math.pow(2,s.apply(this,arguments)))),V=Zr(N);if($.wheel)($.mouse[0][0]!==V[0]||$.mouse[0][1]!==V[1])&&($.mouse[1]=T.invert($.mouse[0]=V)),clearTimeout($.wheel);else{if(T.k===I)return;$.mouse=[V,T.invert(V)],tn(this),$.start()}La(N),$.wheel=setTimeout(G,p),$.zoom("mouse",a(k(y(T,I),$.mouse[0],$.mouse[1]),$.extent,l));function G(){$.wheel=null,$.end()}}function C(N,...z){if(u||!t.apply(this,arguments))return;var $=v(this,z,!0).event(N),T=wr(N.view).on("mousemove.zoom",R,!0).on("mouseup.zoom",M,!0),I=Zr(N,V),V=N.currentTarget,G=N.clientX,Z=N.clientY;O1(N.view),ii(N),$.mouse=[I,this.__zoom.invert(I)],tn(this),$.start();function R(H){if(La(H),!$.moved){var K=H.clientX-G,O=H.clientY-Z;$.moved=K*K+O*O>b}$.event(H).zoom("mouse",a(k($.that.__zoom,$.mouse[0]=Zr(H,V),$.mouse[1]),$.extent,l))}function M(H){T.on("mousemove.zoom mouseup.zoom",null),R1(H.view,$.moved),La(H),$.event(H).end()}}function D(N,...z){if(t.apply(this,arguments)){var $=this.__zoom,T=Zr(N.changedTouches?N.changedTouches[0]:N,this),I=$.invert(T),V=$.k*(N.shiftKey?.5:2),G=a(k(y($,V),T,I),r.apply(this,z),l);La(N),c>0?wr(this).transition().duration(c).call(w,G,T,N):wr(this).call(f.transform,G,T,N)}}function A(N,...z){if(t.apply(this,arguments)){var $=N.touches,T=$.length,I=v(this,z,N.changedTouches.length===T).event(N),V,G,Z,R;for(ii(N),G=0;G<T;++G)Z=$[G],R=Zr(Z,this),R=[R,this.__zoom.invert(R),Z.identifier],I.touch0?!I.touch1&&I.touch0[2]!==R[2]&&(I.touch1=R,I.taps=0):(I.touch0=R,V=!0,I.taps=1+!!o);o&&(o=clearTimeout(o)),V&&(I.taps<2&&(x=R[0],o=setTimeout(function(){o=null},d)),tn(this),I.start())}}function S(N,...z){if(this.__zooming){var $=v(this,z).event(N),T=N.changedTouches,I=T.length,V,G,Z,R;for(La(N),V=0;V<I;++V)G=T[V],Z=Zr(G,this),$.touch0&&$.touch0[2]===G.identifier?$.touch0[0]=Z:$.touch1&&$.touch1[2]===G.identifier&&($.touch1[0]=Z);if(G=$.that.__zoom,$.touch1){var M=$.touch0[0],H=$.touch0[1],K=$.touch1[0],O=$.touch1[1],ee=(ee=K[0]-M[0])*ee+(ee=K[1]-M[1])*ee,de=(de=O[0]-H[0])*de+(de=O[1]-H[1])*de;G=y(G,Math.sqrt(ee/de)),Z=[(M[0]+K[0])/2,(M[1]+K[1])/2],R=[(H[0]+O[0])/2,(H[1]+O[1])/2]}else if($.touch0)Z=$.touch0[0],R=$.touch0[1];else return;$.zoom("touch",a(k(G,Z,R),$.extent,l))}}function W(N,...z){if(this.__zooming){var $=v(this,z).event(N),T=N.changedTouches,I=T.length,V,G;for(ii(N),u&&clearTimeout(u),u=setTimeout(function(){u=null},d),V=0;V<I;++V)G=T[V],$.touch0&&$.touch0[2]===G.identifier?delete $.touch0:$.touch1&&$.touch1[2]===G.identifier&&delete $.touch1;if($.touch1&&!$.touch0&&($.touch0=$.touch1,delete $.touch1),$.touch0)$.touch0[1]=this.__zoom.invert($.touch0[0]);else if($.end(),$.taps===2&&(G=Zr(G,this),Math.hypot(x[0]-G[0],x[1]-G[1])<j)){var Z=wr(this).on("dblclick.zoom");Z&&Z.apply(this,arguments)}}}return f.wheelDelta=function(N){return arguments.length?(s=typeof N=="function"?N:Ks(+N),f):s},f.filter=function(N){return arguments.length?(t=typeof N=="function"?N:Ks(!!N),f):t},f.touchable=function(N){return arguments.length?(n=typeof N=="function"?N:Ks(!!N),f):n},f.extent=function(N){return arguments.length?(r=typeof N=="function"?N:Ks([[+N[0][0],+N[0][1]],[+N[1][0],+N[1][1]]]),f):r},f.scaleExtent=function(N){return arguments.length?(i[0]=+N[0],i[1]=+N[1],f):[i[0],i[1]]},f.translateExtent=function(N){return arguments.length?(l[0][0]=+N[0][0],l[1][0]=+N[1][0],l[0][1]=+N[0][1],l[1][1]=+N[1][1],f):[[l[0][0],l[0][1]],[l[1][0],l[1][1]]]},f.constrain=function(N){return arguments.length?(a=N,f):a},f.duration=function(N){return arguments.length?(c=+N,f):c},f.interpolate=function(N){return arguments.length?(h=N,f):h},f.on=function(){var N=g.on.apply(g,arguments);return N===g?f:N},f.clickDistance=function(N){return arguments.length?(b=(N=+N)*N,f):Math.sqrt(b)},f.tapDistance=function(N){return arguments.length?(j=+N,f):j},f}function ko(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);r&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),a.push.apply(a,s)}return a}function pa(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?ko(Object(a),!0).forEach(function(s){F5(t,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ko(Object(a)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(a,s))})}return t}function Xi(t){"@babel/helpers - typeof";return Xi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Xi(t)}function F5(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function Bt(){return Bt=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(t[s]=a[s])}return t},Bt.apply(this,arguments)}function A5(t,r){if(t==null)return{};var a={},s=Object.keys(t),n,i;for(i=0;i<s.length;i++)n=s[i],!(r.indexOf(n)>=0)&&(a[n]=t[n]);return a}function er(t,r){if(t==null)return{};var a=A5(t,r),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)s=i[n],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(a[s]=t[s])}return a}function ut(t,r){return $5(t)||C5(t,r)||P5(t,r)||D5()}function $5(t){if(Array.isArray(t))return t}function C5(t,r){var a=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(a!=null){var s=[],n=!0,i=!1,l,c;try{for(a=a.call(t);!(n=(l=a.next()).done)&&(s.push(l.value),!(r&&s.length===r));n=!0);}catch(h){i=!0,c=h}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw c}}return s}}function P5(t,r){if(t){if(typeof t=="string")return vo(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vo(t,r)}}function vo(t,r){(r==null||r>t.length)&&(r=t.length);for(var a=0,s=new Array(r);a<r;a++)s[a]=t[a];return s}function D5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L5=["width","height","projection","projectionConfig"],I5=Dc,V5=er(Qu,["geoPath"]),jr=m.createContext(),B5=function(r){var a=r.projectionConfig,s=a===void 0?{}:a,n=r.projection,i=n===void 0?"geoEqualEarth":n,l=r.width,c=l===void 0?800:l,h=r.height,g=h===void 0?600:h,o=typeof i=="function";if(o)return i;var x=V5[i]().translate([c/2,g/2]),u=[x.center?"center":null,x.rotate?"rotate":null,x.scale?"scale":null,x.parallels?"parallels":null];return u.forEach(function(d){d&&(x=x[d](s[d]||x[d]()))}),x},pd=function(r){var a=r.width,s=r.height,n=r.projection,i=r.projectionConfig,l=er(r,L5),c=i.center||[],h=ut(c,2),g=h[0],o=h[1],x=i.rotate||[],u=ut(x,3),d=u[0],p=u[1],b=u[2],j=i.parallels||[],f=ut(j,2),y=f[0],k=f[1],_=i.scale||null,w=m.useMemo(function(){return B5({projectionConfig:{center:g||g===0||o||o===0?[g,o]:null,rotate:d||d===0||p||p===0?[d,p,b]:null,parallels:y||y===0||k||k===0?[y,k]:null,scale:_},projection:n,width:a,height:s})},[a,s,n,g,o,d,p,b,y,k,_]),v=m.useCallback(w,[w]),E=m.useMemo(function(){return{width:a,height:s,projection:v,path:I5().projection(v)}},[a,s,v]);return st.createElement(jr.Provider,Bt({value:E},l))};pd.propTypes={width:ae.number,height:ae.number,projection:ae.oneOfType([ae.string,ae.func]),projectionConfig:ae.object};var O5=["width","height","projection","projectionConfig","className"],Ol=m.forwardRef(function(t,r){var a=t.width,s=a===void 0?800:a,n=t.height,i=n===void 0?600:n,l=t.projection,c=l===void 0?"geoEqualEarth":l,h=t.projectionConfig,g=h===void 0?{}:h,o=t.className,x=o===void 0?"":o,u=er(t,O5);return st.createElement(pd,{width:s,height:i,projection:c,projectionConfig:g},st.createElement("svg",Bt({ref:r,viewBox:"0 0 ".concat(s," ").concat(i),className:"rsm-svg ".concat(x)},u)))});Ol.displayName="ComposableMap";Ol.propTypes={width:ae.number,height:ae.number,projection:ae.oneOfType([ae.string,ae.func]),projectionConfig:ae.object,className:ae.string};function wo(t,r,a){var s=(t*a.k-t)/2,n=(r*a.k-r)/2;return[t/2-(s+a.x)/a.k,r/2-(n+a.y)/a.k]}function R5(t){return fetch(t).then(function(r){if(!r.ok)throw Error(r.statusText);return r.json()}).catch(function(r){console.log("There was a problem when fetching the data: ",r)})}function No(t,r){var a=t.type==="Topology";if(!a)return r?r(t.features||t):t.features||t;var s=am(t,t.objects[Object.keys(t.objects)[0]]).features;return r?r(s):s}function _o(t){var r=t.type==="Topology";if(!r)return null;var a=ro(t,t.objects[Object.keys(t.objects)[0]],function(n,i){return n===i}),s=ro(t,t.objects[Object.keys(t.objects)[0]],function(n,i){return n!==i});return{outline:a,borders:s}}function T5(t,r,a){return t&&r?{outline:pa(pa({},t),{},{rsmKey:"outline",svgPath:a(t)}),borders:pa(pa({},r),{},{rsmKey:"borders",svgPath:a(r)})}:{}}function K5(t,r){return t?t.map(function(a,s){return pa(pa({},a),{},{rsmKey:"geo-".concat(s),svgPath:r(a)})}):[]}function H5(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:30,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:30,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.5,s=Array.isArray(a)?a:[a,a],n=t/2*s[0],i=r/2*s[1];return"M".concat(0,",",0," Q",-t/2-n,",").concat(-r/2+i," ").concat(-t,",").concat(-r)}function G5(t){return typeof t=="string"}function Z5(t){var r=t.geography,a=t.parseGeographies,s=m.useContext(jr),n=s.path,i=m.useState({}),l=ut(i,2),c=l[0],h=l[1];m.useEffect(function(){(typeof window>"u"?"undefined":Xi(window))!=="undefined"&&r&&(G5(r)?R5(r).then(function(d){d&&h({geographies:No(d,a),mesh:_o(d)})}):h({geographies:No(r,a),mesh:_o(r)}))},[r,a]);var g=m.useMemo(function(){var d=c.mesh||{},p=T5(d.outline,d.borders,n);return{geographies:K5(c.geographies,n),outline:p.outline,borders:p.borders}},[c,n]),o=g.geographies,x=g.outline,u=g.borders;return{geographies:o,outline:x,borders:u}}var J5=["geography","children","parseGeographies","className"],Rl=m.forwardRef(function(t,r){var a=t.geography,s=t.children,n=t.parseGeographies,i=t.className,l=i===void 0?"":i,c=er(t,J5),h=m.useContext(jr),g=h.path,o=h.projection,x=Z5({geography:a,parseGeographies:n}),u=x.geographies,d=x.outline,p=x.borders;return st.createElement("g",Bt({ref:r,className:"rsm-geographies ".concat(l)},c),u&&u.length>0&&s({geographies:u,outline:d,borders:p,path:g,projection:o}))});Rl.displayName="Geographies";Rl.propTypes={geography:ae.oneOfType([ae.string,ae.object,ae.array]),children:ae.func,parseGeographies:ae.func,className:ae.string};var q5=["geography","onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onFocus","onBlur","style","className"],Tl=m.forwardRef(function(t,r){var a=t.geography,s=t.onMouseEnter,n=t.onMouseLeave,i=t.onMouseDown,l=t.onMouseUp,c=t.onFocus,h=t.onBlur,g=t.style,o=g===void 0?{}:g,x=t.className,u=x===void 0?"":x,d=er(t,q5),p=m.useState(!1),b=ut(p,2),j=b[0],f=b[1],y=m.useState(!1),k=ut(y,2),_=k[0],w=k[1];function v(S){w(!0),s&&s(S)}function E(S){w(!1),j&&f(!1),n&&n(S)}function F(S){w(!0),c&&c(S)}function C(S){w(!1),j&&f(!1),h&&h(S)}function D(S){f(!0),i&&i(S)}function A(S){f(!1),l&&l(S)}return st.createElement("path",Bt({ref:r,tabIndex:"0",className:"rsm-geography ".concat(u),d:a.svgPath,onMouseEnter:v,onMouseLeave:E,onFocus:F,onBlur:C,onMouseDown:D,onMouseUp:A,style:o[j||_?j?"pressed":"hover":"default"]},d))});Tl.displayName="Geography";Tl.propTypes={geography:ae.object,onMouseEnter:ae.func,onMouseLeave:ae.func,onMouseDown:ae.func,onMouseUp:ae.func,onFocus:ae.func,onBlur:ae.func,style:ae.object,className:ae.string};var U5=m.memo(Tl),Y5=["fill","stroke","step","className"],Kl=m.forwardRef(function(t,r){var a=t.fill,s=a===void 0?"transparent":a,n=t.stroke,i=n===void 0?"currentcolor":n,l=t.step,c=l===void 0?[10,10]:l,h=t.className,g=h===void 0?"":h,o=er(t,Y5),x=m.useContext(jr),u=x.path;return st.createElement("path",Bt({ref:r,d:u(fl().step(c)()),fill:s,stroke:i,className:"rsm-graticule ".concat(g)},o))});Kl.displayName="Graticule";Kl.propTypes={fill:ae.string,stroke:ae.string,step:ae.array,className:ae.string};m.memo(Kl);var X5=["value"],Q5=m.createContext(),e2={x:0,y:0,k:1,transformString:"translate(0 0) scale(1)"},bd=function(r){var a=r.value,s=a===void 0?e2:a,n=er(r,X5);return st.createElement(Q5.Provider,Bt({value:s},n))};bd.propTypes={x:ae.number,y:ae.number,k:ae.number,transformString:ae.string};function t2(t){var r=t.center,a=t.filterZoomEvent,s=t.onMoveStart,n=t.onMoveEnd,i=t.onMove,l=t.translateExtent,c=l===void 0?[[-1/0,-1/0],[1/0,1/0]]:l,h=t.scaleExtent,g=h===void 0?[1,8]:h,o=t.zoom,x=o===void 0?1:o,u=m.useContext(jr),d=u.width,p=u.height,b=u.projection,j=ut(r,2),f=j[0],y=j[1],k=m.useState({x:0,y:0,k:1}),_=ut(k,2),w=_[0],v=_[1],E=m.useRef({x:0,y:0,k:1}),F=m.useRef(),C=m.useRef(),D=m.useRef(!1),A=ut(c,2),S=A[0],W=A[1],N=ut(S,2),z=N[0],$=N[1],T=ut(W,2),I=T[0],V=T[1],G=ut(g,2),Z=G[0],R=G[1];return m.useEffect(function(){var M=wr(F.current);function H(ue){!s||D.current||s({coordinates:b.invert(wo(d,p,ue.transform)),zoom:ue.transform.k},ue)}function K(ue){if(!D.current){var Me=ue.transform,Ae=ue.sourceEvent;v({x:Me.x,y:Me.y,k:Me.k,dragging:Ae}),i&&i({x:Me.x,y:Me.y,zoom:Me.k,dragging:Ae},ue)}}function O(ue){if(D.current){D.current=!1;return}var Me=b.invert(wo(d,p,ue.transform)),Ae=ut(Me,2),Be=Ae[0],ne=Ae[1];E.current={x:Be,y:ne,k:ue.transform.k},n&&n({coordinates:[Be,ne],zoom:ue.transform.k},ue)}function ee(ue){return a?a(ue):ue?!ue.ctrlKey&&!ue.button:!1}var de=W5().filter(ee).scaleExtent([Z,R]).translateExtent([[z,$],[I,V]]).on("start",H).on("zoom",K).on("end",O);C.current=de,M.call(de)},[d,p,z,$,I,V,Z,R,b,s,i,n,a]),m.useEffect(function(){if(!(f===E.current.x&&y===E.current.y&&x===E.current.k)){var M=b([f,y]),H=M[0]*x,K=M[1]*x,O=wr(F.current);D.current=!0,O.call(C.current.transform,Bl.translate(d/2-H,p/2-K).scale(x)),v({x:d/2-H,y:p/2-K,k:x}),E.current={x:f,y,k:x}}},[f,y,x,d,p,b]),{mapRef:F,position:w,transformString:"translate(".concat(w.x," ").concat(w.y,") scale(").concat(w.k,")")}}var r2=["center","zoom","minZoom","maxZoom","translateExtent","filterZoomEvent","onMoveStart","onMove","onMoveEnd","className"],fd=m.forwardRef(function(t,r){var a=t.center,s=a===void 0?[0,0]:a,n=t.zoom,i=n===void 0?1:n,l=t.minZoom,c=l===void 0?1:l,h=t.maxZoom,g=h===void 0?8:h,o=t.translateExtent,x=t.filterZoomEvent,u=t.onMoveStart,d=t.onMove,p=t.onMoveEnd,b=t.className,j=er(t,r2),f=m.useContext(jr),y=f.width,k=f.height,_=t2({center:s,filterZoomEvent:x,onMoveStart:u,onMove:d,onMoveEnd:p,scaleExtent:[c,g],translateExtent:o,zoom:i}),w=_.mapRef,v=_.transformString,E=_.position;return st.createElement(bd,{value:{x:E.x,y:E.y,k:E.k,transformString:v}},st.createElement("g",{ref:w},st.createElement("rect",{width:y,height:k,fill:"transparent"}),st.createElement("g",Bt({ref:r,transform:v,className:"rsm-zoomable-group ".concat(b)},j))))});fd.displayName="ZoomableGroup";fd.propTypes={center:ae.array,zoom:ae.number,minZoom:ae.number,maxZoom:ae.number,translateExtent:ae.arrayOf(ae.array),onMoveStart:ae.func,onMove:ae.func,onMoveEnd:ae.func,className:ae.string};var a2=["id","fill","stroke","strokeWidth","className"],Hl=m.forwardRef(function(t,r){var a=t.id,s=a===void 0?"rsm-sphere":a,n=t.fill,i=n===void 0?"transparent":n,l=t.stroke,c=l===void 0?"currentcolor":l,h=t.strokeWidth,g=h===void 0?.5:h,o=t.className,x=o===void 0?"":o,u=er(t,a2),d=m.useContext(jr),p=d.path,b=m.useMemo(function(){return p({type:"Sphere"})},[p]);return st.createElement(m.Fragment,null,st.createElement("defs",null,st.createElement("clipPath",{id:s},st.createElement("path",{d:b}))),st.createElement("path",Bt({ref:r,d:b,fill:i,stroke:c,strokeWidth:g,style:{pointerEvents:"none"},className:"rsm-sphere ".concat(x)},u)))});Hl.displayName="Sphere";Hl.propTypes={id:ae.string,fill:ae.string,stroke:ae.string,strokeWidth:ae.number,className:ae.string};m.memo(Hl);var s2=["coordinates","children","onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onFocus","onBlur","style","className"],yd=m.forwardRef(function(t,r){var a=t.coordinates,s=t.children,n=t.onMouseEnter,i=t.onMouseLeave,l=t.onMouseDown,c=t.onMouseUp,h=t.onFocus,g=t.onBlur,o=t.style,x=o===void 0?{}:o,u=t.className,d=u===void 0?"":u,p=er(t,s2),b=m.useContext(jr),j=b.projection,f=m.useState(!1),y=ut(f,2),k=y[0],_=y[1],w=m.useState(!1),v=ut(w,2),E=v[0],F=v[1],C=j(a),D=ut(C,2),A=D[0],S=D[1];function W(V){F(!0),n&&n(V)}function N(V){F(!1),k&&_(!1),i&&i(V)}function z(V){F(!0),h&&h(V)}function $(V){F(!1),k&&_(!1),g&&g(V)}function T(V){_(!0),l&&l(V)}function I(V){_(!1),c&&c(V)}return st.createElement("g",Bt({ref:r,transform:"translate(".concat(A,", ").concat(S,")"),className:"rsm-marker ".concat(d),onMouseEnter:W,onMouseLeave:N,onFocus:z,onBlur:$,onMouseDown:T,onMouseUp:I,style:x[k||E?k?"pressed":"hover":"default"]},p),s)});yd.displayName="Marker";yd.propTypes={coordinates:ae.array,children:ae.oneOfType([ae.node,ae.arrayOf(ae.node)]),onMouseEnter:ae.func,onMouseLeave:ae.func,onMouseDown:ae.func,onMouseUp:ae.func,onFocus:ae.func,onBlur:ae.func,style:ae.object,className:ae.string};var n2=["from","to","coordinates","stroke","strokeWidth","fill","className"],jd=m.forwardRef(function(t,r){var a=t.from,s=a===void 0?[0,0]:a,n=t.to,i=n===void 0?[0,0]:n,l=t.coordinates,c=t.stroke,h=c===void 0?"currentcolor":c,g=t.strokeWidth,o=g===void 0?3:g,x=t.fill,u=x===void 0?"transparent":x,d=t.className,p=d===void 0?"":d,b=er(t,n2),j=m.useContext(jr),f=j.path,y={type:"LineString",coordinates:l||[s,i]};return st.createElement("path",Bt({ref:r,d:f(y),className:"rsm-line ".concat(p),stroke:h,strokeWidth:o,fill:u},b))});jd.displayName="Line";jd.propTypes={from:ae.array,to:ae.array,coordinates:ae.array,stroke:ae.string,strokeWidth:ae.number,fill:ae.string,className:ae.string};var i2=["subject","children","connectorProps","dx","dy","curve","className"],kd=m.forwardRef(function(t,r){var a=t.subject,s=t.children,n=t.connectorProps,i=t.dx,l=i===void 0?30:i,c=t.dy,h=c===void 0?30:c,g=t.curve,o=g===void 0?0:g,x=t.className,u=x===void 0?"":x,d=er(t,i2),p=m.useContext(jr),b=p.projection,j=b(a),f=ut(j,2),y=f[0],k=f[1],_=H5(l,h,o);return st.createElement("g",Bt({ref:r,transform:"translate(".concat(y+l,", ").concat(k+h,")"),className:"rsm-annotation ".concat(u)},d),st.createElement("path",Bt({d:_,fill:"transparent",stroke:"#000"},n)),s)});kd.displayName="Annotation";kd.propTypes={subject:ae.array,children:ae.oneOfType([ae.node,ae.arrayOf(ae.node)]),dx:ae.number,dy:ae.number,curve:ae.number,connectorProps:ae.object,className:ae.string};const l2="FeatureCollection",o2=[{type:"Feature",id:0,properties:{id:"DE-BW",name:"Baden-Wrttemberg",type:"State"},geometry:{type:"MultiPolygon",coordinates:[[[[9.650460243225211,49.7763404846192],[9.637469291687069,49.69042205810558],[9.671889305114973,49.683181762695426],[9.715788841247615,49.724449157714844],[9.73471069335966,49.683601379394645],[9.795839309692326,49.72497940063482],[9.836868286132812,49.69924926757807],[9.83308029174799,49.65090179443382],[9.880538940429688,49.60306167602539],[9.825579643249796,49.550659179687614],[9.865819931030273,49.53993988037121],[9.921249389648722,49.58118057250982],[9.90511894226097,49.5551109313966],[9.933589935302848,49.55537033081055],[9.94201946258545,49.47780990600609],[10.021670341491813,49.47856903076166],[10.070828437805176,49.54175186157238],[10.089150428772086,49.504989624023665],[10.129039764404354,49.50531005859375],[10.102548599243107,49.442440032958984],[10.17243862152128,49.39152908325195],[10.115939140319995,49.376281738281364],[10.133849143982161,49.34701156616222],[10.111349105835018,49.33576202392595],[10.151530265808162,49.325119018554744],[10.162669181823901,49.27928924560547],[10.119018554687557,49.25495147705101],[10.141930580139217,49.251510620117415],[10.131599426269588,49.19997024536144],[10.264269828796671,49.14262008666992],[10.213559150695858,49.09807205200218],[10.259538650512866,49.091209411621094],[10.260379791259766,49.03989028930687],[10.363980293273926,49.029991149902344],[10.46698093414335,48.9382896423341],[10.43877029418951,48.90898895263683],[10.466718673706339,48.89397048950218],[10.438398361206055,48.8498992919923],[10.460650444030762,48.81275939941406],[10.421119689941634,48.77619171142601],[10.505069732666186,48.6903915405274],[10.420589447021484,48.66535186767584],[10.448868751525993,48.69832992553722],[10.415119171142635,48.70236206054693],[10.358600616455078,48.65859222412121],[10.347478866577205,48.69562149047874],[10.279189109802473,48.71039962768555],[10.262008666992188,48.6699485778808],[10.33017826080328,48.61455917358421],[10.301910400390852,48.61114883422863],[10.318519592285213,48.529701232910156],[10.23357009887701,48.519458770751896],[10.244940757751579,48.50088882446295],[10.178018569946346,48.4662704467774],[10.037790298462141,48.463359832763786],[10.043800354003906,48.433830261230696],[9.971670150756836,48.38422012329113],[10.0683403015139,48.285560607910156],[10.086348533630598,48.18515014648449],[10.142750740051497,48.10358047485374],[10.137919425964355,48.02132034301758],[10.083058357238997,47.96100997924805],[10.110899925232104,47.9388694763183],[10.105770111084041,47.88275909423828],[10.078228950500659,47.87129211425781],[10.133698463440169,47.819438934326286],[10.067669868469522,47.788909912109375],[10.117288589477539,47.76311111450218],[10.128538131714151,47.67704010009777],[10.084130287170467,47.67631912231468],[10.073051452636776,47.63850021362305],[10.024051666259766,47.691162109375114],[9.964490890502987,47.65380859374994],[9.84401988983177,47.67903137207031],[9.746689796447981,47.60747909545921],[9.56746578216547,47.5864715576173],[9.499274253845442,47.6525230407716],[9.315168380737305,47.676967620849894],[9.044014930725098,47.82368850708008],[9.177002906799373,47.737754821777514],[9.221139907837028,47.66815185546875],[9.164094924927042,47.65358352661133],[8.99164009094244,47.747985839844034],[9.010104179382324,47.73016357421875],[8.941365242004451,47.731822967529524],[9.006369590759277,47.69509124755882],[8.891834259033544,47.65522384643583],[8.853852272033691,47.68376922607439],[8.874106407165812,47.7076416015625],[8.808216094971158,47.74168014526367],[8.771158218383846,47.71976852416992],[8.79814815521246,47.67990875244152],[8.727890014648779,47.696842193603686],[8.730445861816634,47.766109466552905],[8.69027328491211,47.76291275024437],[8.65626907348667,47.805786132812614],[8.629762649536133,47.7659721374514],[8.619837760925293,47.80404281616211],[8.56867599487316,47.814399719238395],[8.576228141784725,47.78907775878906],[8.47270584106451,47.77009963989258],[8.404480934143066,47.679393768310604],[8.471726417541618,47.64346313476574],[8.601484298706112,47.6770133972168],[8.62895870208746,47.65135192871094],[8.596846580505542,47.647193908691406],[8.584686279296875,47.6003112792971],[8.520914077758846,47.63809585571289],[8.45824337005638,47.60531997680681],[8.495615959167594,47.585163116455305],[8.437403678894327,47.57140731811529],[8.32952022552496,47.574924468994425],[8.2908353805542,47.613906860351676],[8.20481967926031,47.626274108886776],[8.087834358215616,47.56288528442394],[7.944071769714355,47.549701690673885],[7.890720844268913,47.59363555908226],[7.820772171020621,47.59469985961937],[7.66949319839506,47.53711700439453],[7.632383823394946,47.5624237060548],[7.679849147796688,47.57091140747082],[7.670560836792106,47.59326171875023],[7.607770919799862,47.58095932006859],[7.524673938751221,47.66019439697271],[7.557729244232291,47.88094711303711],[7.62215709686302,47.973659515380916],[7.568590164184855,48.03633880615257],[7.577859401702995,48.121391296386776],[7.666151046753214,48.221099853515625],[7.693936824798527,48.30212020874046],[7.745231628418139,48.32982635498064],[7.733546733856315,48.39868545532238],[7.805161952972469,48.51350021362316],[7.805009365081901,48.59319305419922],[7.970248699188346,48.756229400634766],[8.087015151977823,48.802013397216854],[8.197396278381404,48.957103729248274],[8.295299530029354,49.00415039062506],[8.362239837646541,49.09968948364275],[8.38765907287592,49.23448181152361],[8.491369247436523,49.30128860473627],[8.450428962707804,49.33285140991234],[8.49458980560297,49.36024856567383],[8.498978614807413,49.393428802490234],[8.464948654175089,49.39220046997076],[8.508589744568098,49.44147872924799],[8.445588111877555,49.450260162353516],[8.467529296874943,49.473041534424055],[8.418828964233342,49.55218887329107],[8.429039001464844,49.58562088012707],[8.591519355774153,49.52497100830095],[8.625108718872013,49.55171203613287],[8.600359916687182,49.613231658935774],[8.69777870178217,49.62720108032238],[8.681758880615519,49.57913970947283],[8.729120254516602,49.522029876708984],[8.90207862854021,49.5113410949707],[8.879650115966797,49.4744987487793],[8.827729225158919,49.47713088989269],[8.83992004394554,49.44095993041992],[8.800168991088867,49.41823196411133],[8.85784053802496,49.404911041259766],[8.955150604248217,49.46086883544922],[8.954179763793945,49.51205062866205],[9.133290290832633,49.52040100097656],[9.092338562011832,49.54613876342785],[9.10894870758085,49.583000183105696],[9.258749961853255,49.58644866943382],[9.314629554748706,49.65655899047857],[9.418059349060115,49.64522933959978],[9.427619934082088,49.711959838867244],[9.398599624633789,49.73049163818371],[9.365010261535929,49.70458221435558],[9.387288093566951,49.726791381835994],[9.307028770446834,49.7379608154298],[9.335540771484489,49.74163055419922],[9.323519706726131,49.76753997802729],[9.5102796554566,49.78639984130888],[9.573779106140194,49.74209976196289],[9.57227897644043,49.77935028076183],[9.650460243225211,49.7763404846192]]],[[[8.708373069763297,47.71555709838867],[8.72245121002237,47.69652938842779],[8.661308288574162,47.695213317871264],[8.708373069763297,47.71555709838867]]]]}},{type:"Feature",id:1,properties:{id:"DE-BY",name:"Bayern",type:"State"},geometry:{type:"Polygon",coordinates:[[[10.133859634399585,50.54999923706066],[10.204319953918457,50.55379867553722],[10.234009742736816,50.512699127197266],[10.333989143371525,50.49404907226557],[10.405019760131836,50.4232292175293],[10.39352035522461,50.39334106445307],[10.458058357238826,50.40090942382824],[10.493670463562239,50.35243988037132],[10.605488777160872,50.330242156982536],[10.612021446228255,50.22555160522472],[10.723018646240519,50.199798583984375],[10.734558105469034,50.248352050781364],[10.855380058288688,50.24898910522472],[10.717250823974666,50.32294082641607],[10.722298622131575,50.36009216308605],[10.831330299377385,50.38996124267578],[10.940460205078125,50.39025115966808],[10.99833011627203,50.342250823974666],[10.9981107711792,50.36447906494152],[11.04424953460699,50.34238052368164],[11.113239288330135,50.36489868164091],[11.159410476684513,50.32794189453125],[11.14237976074213,50.287109375],[11.251668930053711,50.26519012451172],[11.281947135925293,50.365509033203125],[11.248118400573674,50.476890563964844],[11.324259757995776,50.48833084106468],[11.348060607910156,50.521869659423885],[11.430090904235897,50.51472091674833],[11.41750812530546,50.45145034790039],[11.446418762206974,50.421760559081974],[11.481788635254134,50.433021545410156],[11.522049903869856,50.37353897094738],[11.592958450317326,50.40353012084972],[11.787029266357422,50.42264175415039],[11.82710075378435,50.39291000366228],[11.93927097320568,50.426879882812614],[11.983886718750114,50.393493652343864],[11.981323242187727,50.352478027343864],[12.125018119812239,50.313156127929744],[12.137169837951888,50.282112121582145],[12.085860252380428,50.25535202026367],[12.198919296264705,50.1956214904788],[12.19906044006376,50.11182022094749],[12.261237144470385,50.09212112426775],[12.256030082702637,50.062278747558594],[12.4891490936281,49.986381530761776],[12.475679397582951,49.94009399414074],[12.547736167907715,49.92714309692383],[12.501510620117472,49.83884048461914],[12.472599983215389,49.83581924438499],[12.472072601318473,49.79027175903332],[12.402890205383244,49.75516128540045],[12.443773269653605,49.706947326660156],[12.527859687805176,49.687759399414176],[12.525370597839583,49.63235092163097],[12.564818382263468,49.62448883056635],[12.588051795959473,49.54399871826166],[12.645830154419116,49.53105926513672],[12.632806777954215,49.48001480102539],[12.661074638366813,49.43216705322277],[12.759730339050463,49.40029907226568],[12.78410530090349,49.35190582275419],[12.952889442444018,49.348270416259766],[13.033589363098429,49.30863952636719],[13.037929534912166,49.26773071289085],[13.180460929870549,49.17430877685558],[13.180210113525447,49.144439697265625],[13.295909881591967,49.12018203735374],[13.403729438781738,49.05178070068365],[13.423837661743335,48.97175216674805],[13.496587753295842,48.940162658691406],[13.510198593139876,48.96820068359375],[13.588505744934253,48.968601226806754],[13.671330451965332,48.88309097290045],[13.751342773437727,48.87451553344749],[13.835860252380428,48.77146148681652],[13.78705883026123,48.721511840820426],[13.82571983337408,48.64122009277355],[13.809944152832088,48.590904235839844],[13.740022659301871,48.528968811035156],[13.503158569335938,48.59651184082037],[13.435749053955078,48.564682006836165],[13.45454025268566,48.51630020141607],[13.410618782043684,48.377738952636776],[13.285719871520996,48.30517196655296],[13.090594291687125,48.28144454956055],[12.868214607238826,48.20366668701183],[12.753028869629134,48.11729049682623],[13.00114727020275,47.8522300720216],[12.91126728057884,47.73124313354498],[13.015259742736987,47.729679107666186],[13.081555366516113,47.69136810302763],[13.105588912964038,47.639202117920206],[13.047879219055233,47.584789276123104],[13.053750038147086,47.4948616027832],[13.013463973999194,47.46576690673828],[12.969863891601562,47.477085113525504],[12.799818038940373,47.561462402343864],[12.78131294250511,47.58154678344732],[12.826677322387695,47.61626052856451],[12.771088600158635,47.645050048828125],[12.782772064209098,47.675922393798885],[12.605334281921444,47.67924880981457],[12.577346801757812,47.63447570800787],[12.506064414978312,47.62885284423828],[12.43596267700201,47.70073318481468],[12.258779525756836,47.67621994018549],[12.254279136657772,47.739990234375114],[12.17435169219982,47.698875427246264],[12.2092800140382,47.60120010375982],[12.016809463500977,47.62178039550781],[11.856868743896712,47.579051971435774],[11.636343955993766,47.598270416259766],[11.58102035522461,47.51182174682617],[11.437379837036133,47.51325988769531],[11.388031959533976,47.47192382812506],[11.424080848694132,47.44562149047846],[11.341606140136946,47.45182418823265],[11.27390003204357,47.391010284423885],[11.224139213562012,47.391269683837834],[11.246058464050463,47.43478012084961],[10.977520942687931,47.39611053466825],[10.926508903503702,47.478080749511776],[10.862998962402344,47.47803115844755],[10.91859436035162,47.51609420776373],[10.883132934570597,47.53810501098644],[10.772025108337402,47.516143798828125],[10.600060462951717,47.57365036010742],[10.561381340027083,47.53593063354498],[10.432245254516658,47.58555984497076],[10.433234214783056,47.497653961181754],[10.46283054351801,47.487220764160384],[10.471569061279524,47.43306350708008],[10.433580398559627,47.378719329833984],[10.389999389648438,47.37543869018549],[10.323238372803019,47.302589416504134],[10.170168876648347,47.26990127563505],[10.226869583130167,47.3929176330567],[10.095960617065373,47.3548698425293],[10.068832397461165,47.411659240722884],[10.094819068908748,47.418479919433594],[10.090755462646598,47.45659255981468],[9.997338294982967,47.48622512817394],[9.971186637878588,47.55048370361345],[9.87366962432867,47.53071975708008],[9.813129425048828,47.55074691772461],[9.801539421081998,47.59716033935541],[9.735632896423397,47.541358947754134],[9.61636924743658,47.574558258056584],[9.65905857086176,47.61347198486351],[9.757570266723633,47.61133193969738],[9.84401988983194,47.67903137207031],[9.964490890502987,47.65380859374994],[10.024051666259766,47.691162109375114],[10.073051452636776,47.63850021362305],[10.084130287170467,47.67631912231468],[10.128538131714322,47.67704010009777],[10.117288589477539,47.76311111450218],[10.067669868469693,47.788909912109375],[10.13369846344034,47.819438934326286],[10.078228950500659,47.87129211425781],[10.105770111084041,47.88275909423828],[10.110899925232104,47.9388694763183],[10.083058357238997,47.96100997924805],[10.137919425964355,48.02132034301758],[10.142750740051497,48.10358047485374],[10.086348533630598,48.18515014648449],[10.0683403015139,48.285560607910156],[9.971670150756836,48.38422012329113],[10.043800354003906,48.433830261230696],[10.037790298462141,48.463359832763786],[10.178018569946346,48.4662704467774],[10.244940757751579,48.50088882446295],[10.23357009887701,48.519458770751896],[10.318519592285213,48.529701232910156],[10.301910400390852,48.61114883422863],[10.33017826080328,48.61455917358421],[10.262008666992188,48.6699485778808],[10.279189109802473,48.71039962768555],[10.347478866577205,48.69562149047874],[10.358600616455078,48.65859222412121],[10.415119171142635,48.70236206054693],[10.448868751525993,48.69832992553722],[10.420589447021484,48.66535186767584],[10.505069732666186,48.6903915405274],[10.421119689941634,48.77619171142601],[10.460650444030762,48.81275939941406],[10.438398361206055,48.8498992919923],[10.466718673706339,48.89397048950218],[10.43877029418951,48.90898895263683],[10.46698093414335,48.9382896423341],[10.363980293273926,49.029991149902344],[10.260379791259766,49.03989028930687],[10.259538650512866,49.091209411621094],[10.213559150695858,49.09807205200218],[10.264269828796671,49.14262008666992],[10.131599426269588,49.19997024536144],[10.141930580139217,49.251510620117415],[10.119018554687557,49.25495147705101],[10.162669181823901,49.27928924560547],[10.151530265808162,49.325119018554744],[10.111349105835018,49.33576202392595],[10.133849143982161,49.34701156616222],[10.115939140319995,49.376281738281364],[10.17243862152128,49.39152908325195],[10.102548599243107,49.442440032958984],[10.129039764404354,49.50531005859375],[10.089150428772086,49.504989624023665],[10.070828437805176,49.54175186157238],[10.021670341491813,49.47856903076166],[9.959210395813159,49.474281311035384],[9.924578666687296,49.48871994018566],[9.921249389648722,49.58118057250982],[9.865819931030273,49.53993988037121],[9.825579643249796,49.550659179687614],[9.880399703979776,49.606769561767635],[9.807269096374796,49.725078582763956],[9.740410804748763,49.683631896972656],[9.715788841247615,49.724449157714844],[9.66048812866228,49.68310928344738],[9.631500244140682,49.69784164428711],[9.655658721924112,49.78755950927729],[9.57227897644043,49.77935028076183],[9.573779106140194,49.74209976196289],[9.5102796554566,49.78639984130888],[9.380258560180835,49.77864074707031],[9.307028770446834,49.7379608154298],[9.387288093566951,49.726791381835994],[9.353199005126896,49.71940994262695],[9.37654018402094,49.70087051391596],[9.410099983215332,49.726779937744254],[9.433828353882063,49.69342041015631],[9.418059349060115,49.64522933959978],[9.314629554748706,49.65655899047857],[9.235880851745549,49.57915115356457],[9.126408576965446,49.57569122314453],[9.073870658874569,49.60485076904297],[9.113509178161564,49.6455917358399],[9.095290184021223,49.69327926635742],[9.163489341735783,49.74538040161133],[9.11713981628435,49.75975036621094],[9.145290374755803,49.79685974121105],[9.10502910614008,49.79275131225597],[9.104130744934025,49.84429931640631],[9.046279907226562,49.847160339355526],[9.031888961792163,49.99053955078125],[9.066729545593262,49.99483871459961],[9.048080444336222,50.04241180419922],[8.995120048523233,50.05247116088873],[9.033840179443416,50.11211013793945],[9.138387680053768,50.12517166137718],[9.173168182373217,50.118499755859375],[9.169540405273494,50.08877182006847],[9.237930297851733,50.14928054809582],[9.377340316772461,50.132209777832145],[9.419237136841048,50.08029174804699],[9.519418716430948,50.09251022338867],[9.532540321350154,50.16738891601568],[9.503918647766284,50.174598693847656],[9.500089645385856,50.24187850952154],[9.660399436950684,50.23199081420921],[9.636690139770565,50.246768951416016],[9.652839660644759,50.26930999755871],[9.744089126586971,50.31105041503929],[9.746289253235147,50.4164199829101],[9.882708549499512,50.39855194091797],[9.958759307861442,50.42156219482416],[10.074960708618164,50.54230117797874],[10.133859634399585,50.54999923706066]]]}},{type:"Feature",id:2,properties:{id:"DE-BE",name:"Berlin",type:"State"},geometry:{type:"Polygon",coordinates:[[[13.161809921264762,52.59442138671869],[13.216209411621207,52.58251953125006],[13.230238914489803,52.62681198120117],[13.272738456726188,52.62248992919922],[13.28633975982666,52.655658721923885],[13.370199203491268,52.62105941772461],[13.474988937378043,52.649169921875],[13.45722961425787,52.66054916381836],[13.482250213623047,52.67502212524414],[13.529389381408748,52.640949249267635],[13.514860153198356,52.5892715454101],[13.663810729980526,52.5277099609375],[13.618619918823356,52.4690895080567],[13.768408775329533,52.437110900878906],[13.660959243774414,52.33872222900396],[13.65060997009283,52.37594223022461],[13.48781967163086,52.39324188232422],[13.476848602295036,52.419349670410156],[13.427828788757438,52.40896224975586],[13.432428359985352,52.375541687011776],[13.252047538757324,52.41891098022461],[13.141288757324162,52.38713073730469],[13.093818664550781,52.417438507080135],[13.176479339599553,52.505241394043026],[13.122269630432129,52.52083206176769],[13.161809921264762,52.59442138671869]]]}},{type:"Feature",id:3,properties:{id:"DE-BB",name:"Brandenburg",type:"State"},geometry:{type:"Polygon",coordinates:[[[13.87950801849371,53.50106811523443],[13.917368888855037,53.4205398559572],[14.24040889739996,53.42845153808605],[14.235617637634334,53.36948013305664],[14.100090026855582,53.261421203613224],[14.258330345153865,53.25825119018583],[14.319879531860295,53.31262207031256],[14.420248985290584,53.32563018798834],[14.448929786682186,53.26163864135748],[14.367140769958667,53.18033218383795],[14.388121604919604,53.13629150390619],[14.366089820861816,53.07647705078131],[14.142452239990462,52.961112976074446],[14.155890464782772,52.87955856323248],[14.12127017974882,52.84027099609369],[14.341383934021167,52.75926971435547],[14.466204643249455,52.65725708007818],[14.639061927795467,52.58003234863304],[14.600604057312069,52.53302383422857],[14.631249427795467,52.499130249023494],[14.528908729553166,52.39641189575201],[14.584350585937784,52.31105804443365],[14.570899963378906,52.2895622253418],[14.699570655823038,52.24108886718773],[14.669348716735897,52.12155151367199],[14.741278648376522,52.07339096069347],[14.680540084838867,51.905200958251896],[14.58503341674816,51.837066650390625],[14.738728523254451,51.66687011718744],[14.739829063415698,51.60350036621105],[14.685029983520735,51.5994300842288],[14.665378570556811,51.55078887939459],[14.570050239562988,51.57242202758789],[14.341999053955135,51.500820159912394],[14.15363979339628,51.54505157470703],[14.091679573059253,51.49647903442383],[14.107279777526855,51.48025131225586],[14.049810409545955,51.48036193847656],[14.080458641052417,51.44773864746094],[14.015210151672363,51.37430191040062],[13.97159862518322,51.39891052246094],[13.779280662536564,51.36178207397472],[13.56014919281023,51.369880676269815],[13.42150878906267,51.45396041870117],[13.39611911773693,51.42473983764643],[13.337078094482365,51.44050979614269],[13.286639213562069,51.38579177856457],[13.233359336853141,51.39775848388672],[13.222880363464583,51.431190490722656],[13.19277858734148,51.427951812744254],[13.22608852386503,51.505062103271484],[13.204320907593058,51.55712890625006],[13.063730239868335,51.64789962768549],[13.198930740356388,51.71620941162115],[13.137908935546875,51.84654998779291],[13.163080215454045,51.87210083007807],[13.048269271850643,51.870010375976506],[13.055450439453068,51.89950942993164],[12.982969284057617,51.900531768799055],[12.972139358520621,51.93397140502941],[12.863180160522631,51.931758880615405],[12.858329772949446,51.96512985229492],[12.797579765319881,51.95854187011719],[12.68417930603033,52.00812149047857],[12.549958229064998,51.980232238769815],[12.478808403015137,52.03289031982416],[12.435828208923567,52.01491165161133],[12.221308708190918,52.16529846191406],[12.301870346069336,52.21995162963867],[12.25396919250494,52.25008010864258],[12.317408561706713,52.341960906982706],[12.29343032836914,52.357040405273494],[12.312949180603027,52.401279449463175],[12.28273010253912,52.41271972656256],[12.33942985534668,52.47510147094738],[12.242839813232365,52.5206108093264],[12.205368995666447,52.49135208129883],[12.175079345703125,52.50278091430664],[12.194099426269474,52.52854156494146],[12.151088714599553,52.521560668945256],[12.189039230346964,52.56937026977539],[12.178129196167049,52.62139892578131],[12.245609283447322,52.62440872192394],[12.24106884002697,52.68381118774414],[12.204960823059082,52.710159301757926],[12.218799591064396,52.769401550293026],[12.26237869262718,52.79122161865246],[12.239520072937296,52.854591369628906],[11.846659660339299,52.90298080444353],[11.82853889465349,52.921730041503906],[11.853730201721191,52.94752883911144],[11.693689346313647,52.97496032714844],[11.688010215759562,53.00477981567377],[11.63239002227806,53.00897216796881],[11.639038085937614,53.03868865966814],[11.521370887756461,53.04336929321289],[11.459699630737418,53.07736206054682],[11.34766864776617,53.05216217041044],[11.273380279541016,53.101150512695426],[11.397848129272518,53.10763168334961],[11.39811038970953,53.13743209838873],[11.540950775146655,53.12139129638683],[11.578739166259766,53.16205215454124],[11.566919326782283,53.21057128906256],[11.635769844055346,53.239810943603516],[11.834399223327921,53.223121643066406],[11.803829193115234,53.24948883056646],[12.028409957885799,53.29949951171881],[12.05480003356945,53.366352081298885],[12.171999931335733,53.33528137207048],[12.2345104217531,53.35324859619146],[12.2645902633667,53.31935882568371],[12.400289535522461,53.299160003662166],[12.448179244995117,53.246440887451115],[12.6708602905274,53.25107192993181],[12.676119804382608,53.22494888305664],[12.762390136718977,53.22008132934582],[12.742948532104776,53.194301605224666],[12.767208099365234,53.182811737060604],[12.977380752563704,53.19474029541021],[12.945539474487248,53.169181823730526],[12.982050895691202,53.157501220703125],[13.121039390563908,53.237201690674055],[13.1831893920899,53.24739074707037],[13.23102092742937,53.21321105957048],[13.301878929138354,53.275329589843864],[13.405271530151367,53.243896484375],[13.438720703125227,53.29528808593773],[13.526306152343807,53.316101074218864],[13.54931640625,53.39727783203125],[13.624085426330737,53.407287597656364],[13.709418296814249,53.47985076904297],[13.829074859619368,53.49626159667986],[13.78027439117426,53.5120849609375],[13.789619445800952,53.556289672851506],[13.818076133728255,53.51507186889654],[13.87950801849371,53.50106811523443]],[[13.482250213623217,52.67502212524414],[13.45722961425804,52.66054916381836],[13.474988937378214,52.649169921875],[13.370199203491438,52.62105941772461],[13.28633975982666,52.655658721924055],[13.272738456726358,52.62248992919922],[13.230238914489973,52.62681198120117],[13.216209411621378,52.58251953125006],[13.13699054718029,52.58364868164085],[13.160609245300407,52.5647811889649],[13.1222696304323,52.52083206176769],[13.176479339599553,52.505241394043026],[13.099459648132324,52.40625],[13.141288757324162,52.38713073730469],[13.30657005310087,52.41442108154297],[13.432428359985522,52.375541687011776],[13.427828788757438,52.40896224975586],[13.476848602295206,52.419349670410156],[13.48781967163086,52.39324188232439],[13.65060997009283,52.37594223022461],[13.660959243774414,52.33872222900396],[13.74246978759777,52.40044021606468],[13.762909889221135,52.448318481445256],[13.618619918823356,52.4690895080567],[13.663810729980526,52.52770996093767],[13.514860153198356,52.5892715454101],[13.529389381408748,52.640949249267635],[13.482250213623217,52.67502212524414]]]}},{type:"Feature",id:4,properties:{id:"DE-HB",name:"Bremen",type:"State"},geometry:{type:"Polygon",coordinates:[[[8.98544883728033,53.128219604492244],[8.948739051818961,53.12380218505865],[8.992988586425724,53.09848022460949],[8.962628364562988,53.090450286865234],[8.982990264892521,53.0497398376466],[8.935469627380428,53.015239715576286],[8.866428375244254,53.043762207031364],[8.818189620971793,53.024120330810604],[8.773430824279899,53.05675888061529],[8.731298446655273,53.03720855712896],[8.625838279724121,53.165290832519474],[8.486890792846793,53.22864151000982],[8.598338127136287,53.21680068969732],[8.593818664550781,53.186859130859375],[8.829590797424316,53.166198730468864],[8.861869812011776,53.1370086669923],[8.947138786315918,53.15737915039068],[8.98544883728033,53.128219604492244]]]}},{type:"Feature",id:5,properties:{id:"DE-HH",name:"Hamburg",type:"State"},geometry:{type:"Polygon",coordinates:[[[10.071617126464844,53.71823120117182],[10.198549270629883,53.74079132080078],[10.143050193786735,53.688961029052734],[10.228058815002441,53.63389205932617],[10.154500007629338,53.55617904663097],[10.331219673156795,53.44622039794933],[10.248090744018612,53.4047203063966],[10.177260398864746,53.40795135498047],[10.053689002990666,53.47415924072271],[9.996049880981502,53.429100036621094],[9.905927658081112,53.424720764160156],[9.918270111084041,53.4584197998048],[9.860950469970703,53.43928909301758],[9.76345062255865,53.51694107055664],[9.768639564514217,53.565540313720646],[9.7236585617066,53.56900024414068],[9.760189056396598,53.639122009277344],[9.825568199157715,53.595352172851676],[9.906899452209473,53.662181854248104],[10.07267856597906,53.68870925903332],[10.071617126464844,53.71823120117182]]]}},{type:"Feature",id:6,properties:{id:"DE-HE",name:"Hessen",type:"State"},geometry:{type:"Polygon",coordinates:[[[9.498769760131779,51.63151931762695],[9.62797927856451,51.637340545654354],[9.689008712768555,51.58312225341825],[9.590420722961483,51.52280044555664],[9.644719123840332,51.472278594970874],[9.64620971679716,51.42076873779308],[9.571659088134766,51.3931617736817],[9.561838150024585,51.34835052490229],[9.731150627136287,51.30081939697277],[9.77073860168457,51.34252929687523],[9.7361488342288,51.323299407958984],[9.705880165100325,51.37052154541033],[9.819369316101074,51.4156112670899],[9.869279861450138,51.375450134277344],[9.85617923736595,51.41577911376976],[9.9112300872805,51.41975021362316],[9.97350883483881,51.28619003295904],[10.05734062194847,51.278251647949446],[10.075889587402571,51.226181030273665],[10.236989021301497,51.188148498535156],[10.214177131652946,51.11780929565441],[10.172169685363826,51.151420593261946],[10.12471866607666,51.14057159423834],[10.178549766540641,51.11801147460943],[10.149688720703352,51.055130004882926],[10.221340179443416,51.02507019042969],[10.156480789184855,50.99575042724615],[10.04291820526123,51.01494216918968],[10.019538879394474,50.9816589355471],[10.06787014007574,50.948028564453125],[9.94838905334501,50.9484214782716],[9.948748588562069,50.92615890502924],[9.99036979675293,50.937240600585994],[9.97887897491455,50.90760040283203],[10.014529228210677,50.92232131958036],[10.062939643859806,50.88500213623058],[10.021409988403377,50.86668014526367],[10.021959304809798,50.833309173583984],[9.950229644775561,50.82239913940424],[9.956660270690861,50.781711578369254],[9.920918464660645,50.76319885253906],[9.938960075378418,50.73741912841791],[9.873108863830566,50.64184188842779],[9.946098327636662,50.630100250244254],[9.951470375060978,50.670921325683594],[10.048980712890852,50.67726135253929],[10.086059570312784,50.6323814392091],[10.038170814514217,50.613960266113395],[10.063029289245662,50.557312011718864],[10.040019035339299,50.49333190917986],[9.964568138122502,50.425350189208984],[9.847309112548885,50.3982887268067],[9.757839202881087,50.42409133911144],[9.738649368286303,50.299800872802734],[9.652839660644759,50.26930999755871],[9.636690139770565,50.246768951416016],[9.660399436950684,50.23199081420921],[9.500089645385856,50.24187850952154],[9.503918647766284,50.174598693847656],[9.532540321350154,50.16738891601568],[9.519418716430948,50.09251022338867],[9.419237136841048,50.08029174804699],[9.377340316772461,50.132209777832145],[9.237930297851733,50.14928054809582],[9.169540405273494,50.08877182006847],[9.173168182373217,50.118499755859375],[9.138387680053768,50.12517166137718],[9.01706981658947,50.09336853027344],[8.995349884033317,50.0451011657716],[9.048080444336222,50.04241180419922],[9.066729545593262,49.99483871459961],[9.031888961792163,49.99053955078125],[9.046279907226562,49.847160339355526],[9.104130744934025,49.84429931640631],[9.10502910614008,49.79275131225597],[9.145290374755803,49.79685974121105],[9.11713981628435,49.75975036621094],[9.163489341735783,49.74538040161133],[9.095290184021223,49.69327926635742],[9.113509178161564,49.6455917358399],[9.073519706726358,49.62322998046881],[9.10894870758085,49.583000183105696],[9.092338562011832,49.54613876342785],[9.133290290832633,49.52040100097656],[8.954179763793945,49.51205062866205],[8.955150604248388,49.46086883544922],[8.817639350891056,49.404090881347884],[8.82772922515909,49.47713088989269],[8.879650115966797,49.4744987487793],[8.90207862854021,49.5113410949707],[8.729120254516602,49.522029876708984],[8.68175888061569,49.57913970947283],[8.69777870178217,49.62720108032255],[8.600359916687353,49.613231658935774],[8.625108718872013,49.55171203613287],[8.557209014893033,49.52381134033203],[8.39341926574707,49.617549896240234],[8.36192989349371,49.690170288086165],[8.486090660095442,49.76776885986328],[8.428420066833667,49.765998840332145],[8.386138916015625,49.820030212402344],[8.396700859069824,49.84989166259777],[8.34934043884283,49.881698608398665],[8.346780776977823,49.95928955078125],[8.275419235229663,50.0164604187014],[8.187968254089299,50.03245925903326],[7.887711048126278,49.97066879272484],[7.78512001037592,50.05311203002941],[7.869957923889274,50.12857055664074],[7.941120147705135,50.102508544921875],[7.945549964904785,50.14015197753929],[7.897570133209172,50.16987991333019],[7.919559001922778,50.20370864868164],[8.006259918213061,50.234550476074446],[8.047920227050952,50.21253967285156],[8.076358795166072,50.23173141479492],[8.051680564880485,50.268829345703125],[8.138910293579215,50.2740592956543],[8.082799911499023,50.37416076660162],[7.984179973602238,50.41360092163097],[8.030008316040153,50.44818115234398],[7.996560096740779,50.4847412109375],[8.01100921630865,50.52611923217779],[8.056481361389274,50.55717849731468],[8.16199970245367,50.551280975342024],[8.173588752746582,50.60026168823248],[8.118748664856241,50.67570877075207],[8.179908752441577,50.735759735107536],[8.131909370422647,50.791851043701286],[8.275670051574764,50.881240844726506],[8.380510330200252,50.85895156860357],[8.471490859985408,50.91152191162121],[8.467968940735147,50.96326065063499],[8.554678916931323,51.01322937011713],[8.51747035980219,51.03866195678722],[8.5381507873538,51.09511947631847],[8.734568595886515,51.10649108886713],[8.70979022979742,51.13212966918974],[8.784381866455362,51.20458221435564],[8.752208709716967,51.25997924804699],[8.601678848266772,51.2458114624024],[8.574358940124796,51.28638076782232],[8.703760147094727,51.374889373779354],[8.957579612732161,51.38727188110374],[8.968549728393725,51.42853927612316],[8.938670158386515,51.42792892456066],[8.912460327148722,51.47972106933605],[8.990538597106934,51.50728988647472],[9.10620021820074,51.498218536377124],[9.113858222961369,51.4426002502442],[9.228690147400016,51.459732055664006],[9.378959655761776,51.59236145019531],[9.343469619750977,51.613761901855696],[9.486080169677791,51.65705108642601],[9.498769760131779,51.63151931762695]]]}},{type:"Feature",id:7,properties:{id:"DE-MV",name:"Mecklenburg-Vorpommern",type:"State"},geometry:{type:"MultiPolygon",coordinates:[[[[12.519721031188965,54.484306335449446],[12.655277252197664,54.442638397217024],[12.962499618530387,54.437637329101676],[12.802499771118221,54.408195495605696],[12.636943817138672,54.424861907958984],[12.576943397522314,54.40347290039068],[12.59305667877203,54.38347244262695],[12.435832977295036,54.37874984741234],[12.360277175903263,54.30625152587902],[12.38305473327648,54.27930450439459],[12.363612174987793,54.26597213745117],[12.460276603698901,54.24847412109369],[12.409167289733887,54.27986145019554],[12.535278320312955,54.33874893188488],[12.553055763244743,54.37958145141613],[12.59194469451927,54.357360839843864],[12.669721603393668,54.39069366455084],[12.657499313354776,54.408195495605696],[12.715277671814022,54.404304504394474],[12.704795850456309,54.39468392669172],[12.734723091125772,54.37069320678711],[12.786945343018033,54.3962516784668],[12.810278892517147,54.3451385498048],[13.019721984863338,54.43902587890642],[13.025279045105378,54.39652633667038],[13.093609809875886,54.366806030273665],[13.07583236694336,54.34541702270519],[13.105833053588867,54.281806945800895],[13.286388397216797,54.235137939453466],[13.346388816833894,54.18041610717802],[13.318054199219205,54.15986251831066],[13.415834426880053,54.1751403808596],[13.382498741150357,54.14236068725586],[13.41139030456543,54.15652847290062],[13.456945419311523,54.090694427490234],[13.500834465026912,54.085140228271484],[13.489167213440396,54.123748779297216],[13.696389198303223,54.17180633544939],[13.806944847107275,54.10319519042969],[13.74416637420694,54.029304504394645],[13.914167404174805,53.92235946655319],[13.824722290039233,53.86624908447283],[13.937500953674316,53.90847396850597],[13.90583419799816,53.98986053466797],[13.965278625488622,53.9901390075687],[13.959721565246582,53.93402862548851],[13.983612060546875,53.962638854980696],[14.042499542236726,53.942081451416016],[14.046944618225439,53.99652862548862],[13.974166870117244,54.06375122070335],[13.910832405090275,54.064304351806754],[13.924167633056584,54.035415649414006],[13.862501144409407,53.99930572509771],[13.87916564941412,54.04013824462936],[13.858055114746207,54.04847335815441],[13.769165992737271,54.01902770996111],[13.812499046325684,54.09902954101585],[13.749167442321948,54.159027099609546],[13.803610801696834,54.17847061157249],[13.870834350586051,54.10152816772495],[14.014165878295955,54.05430603027338],[14.221389770507926,53.93013763427729],[14.186329841614167,53.915580749512],[14.2173366546632,53.865417480469034],[14.038612365722713,53.873474121093864],[13.89861202239996,53.83958435058611],[13.806388854980412,53.85819625854492],[14.038612365722713,53.75513839721674],[14.282500267028809,53.739582061767635],[14.215276718139592,53.70264053344738],[14.273162841796875,53.69930648803711],[14.289348602294979,53.63378143310564],[14.324908256530762,53.61864852905296],[14.302708625793514,53.5426101684572],[14.375618934631348,53.45944976806658],[14.415765762329158,53.32979583740257],[14.319879531860295,53.31262207031256],[14.258330345153865,53.25825119018583],[14.100090026855582,53.261421203613224],[14.235617637634334,53.36948013305681],[14.24040889739996,53.42845153808622],[13.917368888855037,53.4205398559572],[13.879629135131836,53.50273132324219],[13.818076133728425,53.51507186889671],[13.789619445801122,53.556289672851506],[13.78027439117426,53.5120849609375],[13.829074859619368,53.49626159667986],[13.709418296814249,53.47985076904297],[13.624085426330737,53.407287597656364],[13.54931640625,53.39727783203125],[13.526306152343807,53.316101074218864],[13.438720703125227,53.29528808593773],[13.405271530151367,53.243896484375],[13.301878929138354,53.275329589843864],[13.23102092742937,53.21321105957048],[13.1831893920899,53.24739074707037],[13.121039390563908,53.237201690674055],[12.982050895691202,53.157501220703125],[12.945539474487248,53.169181823730526],[12.977380752563704,53.19474029541021],[12.767208099365234,53.182811737060604],[12.742948532104776,53.194301605224666],[12.762390136718977,53.22008132934582],[12.676119804382608,53.22494888305664],[12.6708602905274,53.25107192993181],[12.448179244995117,53.246440887451115],[12.400289535522461,53.299160003662166],[12.2645902633667,53.31935882568371],[12.2345104217531,53.35324859619146],[12.171999931335733,53.33528137207048],[12.05480003356945,53.366352081298885],[12.028409957885799,53.29949951171881],[11.953209877014274,53.26670074462902],[11.8974990844726,53.27468872070335],[11.872070312500057,53.245121002197266],[11.803829193115234,53.24948883056646],[11.834399223327921,53.223121643066406],[11.747279167175236,53.21274948120117],[11.635769844055346,53.239810943603516],[11.554379463196028,53.20323181152355],[11.578739166259766,53.16205215454124],[11.540950775146655,53.12139129638683],[11.39811038970953,53.13743209838873],[11.385419845581282,53.10773086547863],[11.186309814453125,53.135421752929744],[11.198998451232967,53.18004226684582],[11.068689346313477,53.22988891601574],[10.994039535522688,53.334770202636946],[10.919249534606934,53.351211547851676],[10.838748931884822,53.30918121337896],[10.708258628845158,53.379310607910156],[10.597419738769815,53.373649597168026],[10.639378547668628,53.465099334716854],[10.824370384216593,53.51728057861334],[10.823429107666016,53.58028030395525],[10.923410415649471,53.58530044555687],[10.946919441223201,53.67757034301758],[10.757729530334643,53.75157928466808],[10.744208335876522,53.840560913086165],[10.767909049987793,53.88106918334961],[10.87527942657465,53.92784118652338],[10.901128768920898,53.90127944946289],[10.963709831237907,53.9109992980957],[10.887760162353572,53.92387008666998],[10.894718170165959,53.955970764160384],[11.179167747497502,54.01569366455101],[11.258610725403287,53.98485946655296],[11.258610725403287,53.93402862548851],[11.335276603698844,53.958473205566634],[11.454722404480151,53.90041732788097],[11.483610153198242,53.96847152709984],[11.443611145019531,53.96041488647461],[11.444721221923885,53.997081756592024],[11.428055763244686,53.96097183227539],[11.388054847717399,53.96541595458979],[11.378055572510107,53.997360229492415],[11.492501258850325,54.02291488647472],[11.467498779296932,53.974029541015625],[11.490279197693212,53.968193054199446],[11.519166946411303,54.032081604004134],[11.572501182556323,54.032638549804915],[11.62583255767828,54.08958435058588],[11.603609085083121,54.102638244629134],[11.532500267029206,54.04902648925781],[11.525277137756348,54.07180404663086],[11.682498931884766,54.15319442749018],[11.853609085083065,54.14513778686569],[12.087498664856184,54.18319320678711],[12.091944694518986,54.152084350585994],[12.124721527100064,54.150138854980696],[12.142498970031852,54.17235946655296],[12.09527778625494,54.18097305297857],[12.339165687561433,54.29791641235397],[12.519721031188965,54.484306335449446]]],[[[13.429166793823299,54.68458175659174],[13.37583255767828,54.63513946533203],[13.420833587646825,54.577915191650845],[13.679720878601131,54.56263732910156],[13.668609619140682,54.52069473266647],[13.569721221924283,54.46180725097679],[13.60972213745157,54.404861450195426],[13.673610687256257,54.40069580078159],[13.76694393157959,54.34152603149437],[13.71694374084484,54.31013870239269],[13.72527885437006,54.27347183227562],[13.646389007568416,54.296527862549055],[13.70416736602806,54.326248168945426],[13.610832214355923,54.31624984741222],[13.68305587768566,54.34930419921881],[13.61361026763916,54.33069610595737],[13.58083438873291,54.35291671752964],[13.454723358154581,54.335693359375],[13.394721984863736,54.27125167846691],[13.352499008178768,54.269584655762],[13.41805553436285,54.254859924316634],[13.393610000610408,54.22097396850586],[13.290279388427791,54.25125122070335],[13.321389198303564,54.24514007568382],[13.335277557373104,54.278194427490234],[13.269722938537598,54.25374984741211],[13.199722290039062,54.270137786865575],[13.19416522979742,54.296806335449446],[13.139166831970158,54.2823600769043],[13.18472290039108,54.30097198486328],[13.114721298217717,54.331806182861555],[13.127499580383642,54.37125015258789],[13.261943817139013,54.3829154968264],[13.211388587952058,54.42986297607416],[13.149722099304313,54.42902755737305],[13.26805686950695,54.47930526733444],[13.227499961853368,54.48597335815458],[13.230278015136776,54.51097106933594],[13.158611297607422,54.504028320312614],[13.143611907959041,54.54680633544922],[13.255277633667106,54.55208206176758],[13.305277824402253,54.51402664184582],[13.29749870300293,54.55236053466797],[13.368612289429052,54.57930374145502],[13.338055610656681,54.54875183105469],[13.377498626709098,54.55902862548828],[13.413056373596646,54.49375152587885],[13.506387710571403,54.480972290039006],[13.501943588257177,54.548473358154524],[13.395832061767521,54.57291793823265],[13.37027835845987,54.61458206176752],[13.243055343628214,54.55875015258789],[13.28305625915533,54.64625167846674],[13.160833358765103,54.55902862548828],[13.249724388122615,54.659862518310774],[13.429166793823299,54.68458175659174]]],[[[13.184166908264217,54.49430465698265],[13.226943969726904,54.468750000000114],[13.120834350586392,54.442359924316634],[13.184166908264217,54.49430465698265]]],[[[13.13638877868658,54.6051406860351],[13.158054351807039,54.57930374145502],[13.110833168029785,54.5837516784668],[13.116943359375,54.53763961792015],[13.06360912322998,54.457637786865234],[13.097499847412223,54.59041595458996],[13.13638877868658,54.6051406860351]]]]}},{type:"Feature",id:8,properties:{id:"DE-NI",name:"Niedersachsen",type:"State"},geometry:{type:"MultiPolygon",coordinates:[[[[8.680833816528661,53.892082214355696],[8.75694561004633,53.84263992309582],[8.883610725402946,53.82791519165062],[9.016388893127498,53.835971832275504],[9.096388816833496,53.883983612060774],[9.28820991516119,53.86941146850586],[9.50700855255127,53.70085144042997],[9.547169685363883,53.62430953979492],[9.768639564514388,53.565540313720646],[9.763450622558821,53.51694107055664],[9.860950469970874,53.43928909301758],[9.898807525634822,53.469478607177734],[9.924840927124308,53.44726943969755],[9.905927658081112,53.424720764160156],[9.983139038085938,53.42528152465826],[10.053689002990666,53.47415924072271],[10.177260398864917,53.40795135498064],[10.331270217895678,53.44253158569336],[10.579379081726188,53.369850158691634],[10.708258628845158,53.379310607910156],[10.838748931884822,53.30918121337896],[10.931690216064567,53.350830078125114],[10.994039535522688,53.334770202636946],[11.068689346313477,53.22988891601574],[11.198998451232967,53.18004226684582],[11.186309814453125,53.135421752929744],[11.26729869842535,53.12728118896496],[11.329089164734114,53.059749603271484],[11.459699630737418,53.07736206054682],[11.60176944732666,53.031551361083984],[11.56410026550293,52.99465179443365],[11.514609336853084,52.99877166748041],[11.507689476013184,52.939300537109375],[11.321439743041935,52.873699188232536],[11.041929244995174,52.913089752197436],[10.992259979248274,52.90634918212896],[10.942508697509822,52.85137939453125],[10.766200065612793,52.851242065429915],[10.795768737793253,52.72050857543968],[10.832089424133358,52.723411560058594],[10.921110153198413,52.60668182373047],[10.978019714355469,52.621829986572266],[10.934068679809627,52.565818786621094],[11.010089874267692,52.49187088012707],[10.94782829284668,52.49203109741222],[10.936208724975586,52.45901107788109],[11.078740119934139,52.373451232910384],[10.987579345703125,52.337001800537394],[11.091680526733626,52.22570037841808],[11.019989967346362,52.19678878784191],[11.068088531494084,52.16691970825195],[11.05053997039812,52.13394165039074],[10.949279785156307,52.10540008544922],[10.974808692932129,52.057250976562614],[10.691758155822754,52.052768707275675],[10.563369750976562,52.00992965698259],[10.655550003051758,51.960559844970874],[10.612678527832315,51.94221878051758],[10.655679702758732,51.90460968017584],[10.576871871948242,51.851169586181754],[10.577550888061637,51.78271102905285],[10.632180213928336,51.75741958618164],[10.70512962341337,51.643550872802734],[10.639940261841048,51.61925888061535],[10.664789199829386,51.55786895751976],[10.605010032654093,51.57635879516613],[10.522129058837947,51.55052185058588],[10.37830924987793,51.58518981933605],[10.349979400634709,51.52178955078125],[10.238059997558878,51.47042083740229],[10.19617938995367,51.48188018798828],[10.143619537353686,51.44128036499035],[10.161690711975098,51.42998886108421],[10.054610252380314,51.4380989074707],[9.943228721618823,51.37916946411133],[9.9112300872805,51.41975021362316],[9.85617923736595,51.41577911376976],[9.869279861450138,51.375450134277344],[9.819369316101074,51.4156112670899],[9.705880165100325,51.37052154541033],[9.7361488342288,51.323299407958984],[9.77073860168457,51.34252929687523],[9.731150627136287,51.30081939697277],[9.561838150024585,51.34835052490229],[9.571659088134766,51.3931617736817],[9.64620971679716,51.42076873779308],[9.644719123840332,51.472278594970874],[9.590420722961483,51.52280044555664],[9.689008712768555,51.58312225341825],[9.62797927856451,51.637340545654354],[9.382368087768612,51.647689819335994],[9.408979415893555,51.699748992920036],[9.388999938964844,51.75823974609369],[9.451158523559684,51.79259109497076],[9.437099456787223,51.8402214050293],[9.465918540954647,51.855468750000114],[9.341150283813647,51.85374069213867],[9.35097885131836,51.894889831543026],[9.27766036987299,51.92739105224621],[9.281768798828068,51.96847152709972],[9.179109573364315,51.97811889648449],[9.202249526977653,51.99710845947271],[9.176400184631575,52.034011840820426],[9.192729949951229,52.07155990600586],[9.137360572815226,52.093070983886946],[9.160108566284407,52.12327194213867],[9.020539283752441,52.13224029541027],[8.987109184265421,52.19509887695318],[9.048390388489054,52.18117141723661],[9.040340423584269,52.22206878662121],[9.076330184936694,52.230110168456974],[8.964668273926009,52.28050994873047],[9.12292861938505,52.40250015258789],[9.096728324890364,52.443119049072436],[9.137780189514103,52.477390289306754],[9.094149589538517,52.49906921386719],[9.05136871337885,52.502090454101676],[8.940418243408317,52.40320968627924],[8.855890274047965,52.39060211181646],[8.709649085998535,52.39556884765631],[8.704008102417163,52.503601074218864],[8.653689384460506,52.53250885009771],[8.50821876525896,52.51488876342796],[8.432649612426871,52.45019912719732],[8.304120063781795,52.46253967285179],[8.313388824463118,52.407039642333984],[8.443698883056697,52.36478042602562],[8.470759391784725,52.316841125488395],[8.446478843689249,52.212089538574446],[8.520669937134016,52.18727874755865],[8.404229164123478,52.11082077026367],[8.269809722900504,52.13460922241222],[8.196008682250977,52.07390975952171],[8.032528877258585,52.068290710449446],[7.974060058593864,52.03638076782238],[7.885759830475024,52.08618164062506],[8.009200096130371,52.1151695251466],[8.017779350280819,52.172870635986385],[7.900389194488525,52.1991920471192],[7.954770088195971,52.276519775390625],[7.928679943084944,52.305610656738395],[7.988409996032715,52.31166076660179],[7.937768936157227,52.368728637695426],[7.719359874725285,52.401988983154354],[7.693008899689005,52.45629119873058],[7.613338947296199,52.47603988647472],[7.578148841857853,52.431190490722656],[7.60909986495966,52.42097091674805],[7.586558818817139,52.376251220703125],[7.298637866974047,52.26420211791992],[7.070188999176082,52.24346160888666],[7.029718875884953,52.29431915283209],[7.07911586761486,52.38272476196295],[7.006279945373819,52.469501495361555],[6.950539112091235,52.43696975708002],[6.713626861572209,52.48441314697283],[6.683791160583496,52.55606460571295],[6.768260955810774,52.56516647338867],[6.724298000335978,52.59061050415062],[6.743810176849422,52.64709091186529],[7.051859855652083,52.63584899902344],[7.094276905059871,52.84645080566412],[7.2614879608156,52.997539520263615],[7.256578922271729,53.09841156005865],[7.226968765258846,53.124462127685604],[7.292709827423039,53.16294097900402],[7.284560203552189,53.19956970214855],[7.272350788116739,53.233783721923885],[7.205277919769344,53.23880767822271],[7.249166965484562,53.32986068725586],[7.02694511413597,53.33625030517578],[6.998610973358154,53.361251831054915],[7.049722194671574,53.507637023926065],[7.034166812896729,53.53319549560575],[7.13361120223999,53.53236007690424],[7.09027719497675,53.57652664184593],[7.158053874969539,53.627918243408146],[7.316944122314624,53.683471679687614],[7.530278205871639,53.671527862548885],[8.015831947327115,53.71069335937523],[8.044721603393612,53.64180374145519],[8.110277175903605,53.64236068725597],[8.172499656677246,53.554584503174055],[8.155276298523006,53.513748168945426],[8.06472206115734,53.50597381591797],[8.073611259460847,53.46486282348633],[8.252499580383244,53.399028778076115],[8.316389083862418,53.46625137329124],[8.316389083862418,53.5220832824707],[8.230832099914949,53.52041625976591],[8.271943092346419,53.609859466552734],[8.516389846801701,53.55625152587902],[8.556944847106877,53.52569580078148],[8.519721984863338,53.50097274780279],[8.570834159851074,53.5181961059572],[8.483611106872786,53.6943054199221],[8.558056831359806,53.83402633666998],[8.680833816528661,53.892082214355696]],[[8.519479751587085,53.19604110717802],[8.625838279724292,53.165290832519474],[8.731298446655273,53.037208557129134],[8.77343082428007,53.05675888061546],[8.818189620971964,53.024120330810604],[8.866428375244254,53.043762207031364],[8.935469627380428,53.015239715576286],[8.982990264892521,53.0497398376466],[8.962628364563159,53.090450286865234],[8.992988586425724,53.09848022460949],[8.948739051818961,53.12380218505882],[8.98544883728033,53.128219604492244],[8.947138786315918,53.15737915039085],[8.861869812011776,53.1370086669923],[8.829590797424487,53.166198730468864],[8.593818664550952,53.186859130859375],[8.598338127136458,53.21680068969749],[8.486890792846964,53.22864151000982],[8.519479751587085,53.19604110717802]]],[[[8.498612403869743,53.93125152587902],[8.515276908874455,53.9170837402346],[8.487499237060547,53.91402816772478],[8.498612403869743,53.93125152587902]]],[[[8.009165763855037,53.78569412231445],[8.02249908447294,53.7448616027832],[7.98750019073492,53.77013778686529],[8.009165763855037,53.78569412231445]]],[[[7.895833015442236,53.79402923584007],[7.968054771423567,53.774860382080305],[7.846387863159634,53.78680419921898],[7.895833015442236,53.79402923584007]]],[[[7.706388950348071,53.77958297729492],[7.805832862854459,53.774581909179744],[7.666944026947249,53.7587509155274],[7.706388950348071,53.77958297729492]]],[[[7.573610782623348,53.757362365722656],[7.627499103546427,53.74847412109398],[7.467502117157323,53.727085113525504],[7.484723091125545,53.75485992431658],[7.573610782623348,53.757362365722656]]],[[[7.394165992737214,53.73458480834978],[7.429722785949707,53.725139617920206],[7.360278129577864,53.72680664062494],[7.394165992737214,53.73458480834978]]],[[[7.316390037536735,53.72347259521507],[7.342500209808293,53.72069549560558],[7.138054847717342,53.70513916015648],[7.316390037536735,53.72347259521507]]],[[[7.058610916137638,53.68458175659197],[7.095833778381348,53.680694580078125],[6.854722023010424,53.66125106811535],[7.058610916137638,53.68458175659197]]],[[[6.901390075683537,53.65375137329107],[6.897499084472713,53.62625122070324],[6.864723205566861,53.639026641845874],[6.901390075683537,53.65375137329107]]],[[[6.761944770812988,53.61875152587896],[6.811388969421841,53.60263824462885],[6.721387863159407,53.583751678466854],[6.749722003937222,53.55680465698242],[6.630833148956697,53.59791564941406],[6.761944770812988,53.61875152587896]]]]}},{type:"Feature",id:9,properties:{id:"DE-NW",name:"Nordrhein-Westfalen",type:"State"},geometry:{type:"Polygon",coordinates:[[[8.666278839111385,52.52527999877924],[8.704008102417163,52.503601074218864],[8.709649085998535,52.39556884765631],[8.740420341491927,52.388641357421875],[8.940418243408317,52.40320968627924],[9.05136871337885,52.502090454101676],[9.13135147094738,52.484748840331974],[9.08855056762718,52.3571586608889],[9.028349876404036,52.34498214721691],[8.964668273926009,52.28050994873047],[9.076330184936694,52.230110168456974],[9.040340423584269,52.22206878662121],[9.048390388489054,52.18117141723661],[8.987109184265421,52.19509887695318],[9.020539283752441,52.13224029541027],[9.160108566284407,52.12327194213867],[9.137360572815226,52.093070983886946],[9.192729949951229,52.07155990600586],[9.176400184631575,52.034011840820426],[9.202249526977653,51.99710845947271],[9.179109573364315,51.97811889648449],[9.281768798828068,51.96847152709972],[9.27766036987299,51.92739105224621],[9.35097885131836,51.894889831543026],[9.341150283813647,51.85374069213867],[9.465918540954647,51.855468750000114],[9.437099456787223,51.8402214050293],[9.451158523559684,51.79259109497076],[9.383939743042106,51.74341964721691],[9.408979415893555,51.699748992920036],[9.382368087768612,51.647689819335994],[9.451740264892635,51.64538192749035],[9.343469619750977,51.613761901855696],[9.378959655761776,51.59236145019531],[9.228690147400016,51.459732055664006],[9.113858222961369,51.4426002502442],[9.112098693847884,51.49462127685575],[9.041880607605094,51.51929855346691],[8.912460327148722,51.47972106933605],[8.938670158386515,51.42792892456066],[8.968549728393725,51.42853927612316],[8.957579612732161,51.38727188110374],[8.703760147094727,51.374889373779354],[8.63252067565918,51.336120605469034],[8.56899929046648,51.2750701904298],[8.601678848266772,51.2458114624024],[8.739699363708667,51.27093887329107],[8.784381866455362,51.20458221435564],[8.70979022979742,51.13212966918974],[8.734568595886515,51.10649108886713],[8.5381507873538,51.09511947631847],[8.51747035980219,51.03866195678722],[8.554678916931323,51.01322937011713],[8.467968940735147,50.96326065063499],[8.471490859985408,50.91152191162121],[8.380510330200252,50.85895156860357],[8.275670051574764,50.881240844726506],[8.131909370422647,50.791851043701286],[8.179418563843058,50.739521026611555],[8.153118133545092,50.69478988647455],[8.052820205688533,50.699131011963004],[7.974319934845028,50.77466964721691],[7.973968982696817,50.845249176025504],[7.834569931030558,50.881149291992415],[7.854489803314493,50.9263610839846],[7.799629211425781,50.943019866943416],[7.736380100250472,50.91852188110346],[7.76646089553833,50.84527969360346],[7.66198921203636,50.81917953491211],[7.688279151916731,50.790409088134766],[7.660749912262077,50.76705932617193],[7.381401062011776,50.71549987792969],[7.341228008270207,50.63579177856451],[7.219069004058838,50.61973190307623],[7.210938930511475,50.6454811096192],[7.150808811187744,50.59461975097656],[7.056681156158447,50.59838104248041],[6.932001113891602,50.552749633789176],[6.934369087219238,50.526611328125114],[6.888179779052734,50.521331787109375],[6.905250072479532,50.46194076538086],[6.866010189056396,50.44554901123058],[6.803999900818098,50.48480224609398],[6.75292015075712,50.46820068359398],[6.80925989151018,50.34981155395508],[6.70684909820568,50.329780578613395],[6.674900054931584,50.36391067504883],[6.641438007354679,50.3373718261721],[6.607089042663631,50.38161849975586],[6.450109004974649,50.33393096923851],[6.459670066833496,50.360019683838004],[6.391717910766658,50.384429931640625],[6.403338909149454,50.32192993164068],[6.33975791931158,50.37989425659174],[6.374671936035384,50.44594955444336],[6.330028057098616,50.49364471435575],[6.223847866058293,50.502281188964844],[6.172194004058895,50.550514221191406],[6.278378963470686,50.61639785766596],[6.173087120056209,50.6214332580567],[6.173787117004451,50.65840530395508],[6.118731975555477,50.708736419677734],[6.028616905212402,50.72521591186546],[6.011878967285156,50.775249481201286],[5.963199138641357,50.79505157470703],[6.027101993560791,50.81476593017601],[6.019684791565112,50.84523391723644],[6.0738401412965,50.846858978271655],[6.082940101623819,50.921798706054744],[6.015170097351074,50.93315887451172],[6.030001163482723,50.98336410522472],[5.903690814972094,50.978271484375114],[5.87161922454851,51.05083084106451],[5.969543933868522,51.034469604492244],[6.015267848968733,51.094051361084155],[6.171799182891846,51.15293121337896],[6.144780158996639,51.17371749877941],[6.193139076232967,51.19166183471674],[6.091834068298397,51.175292968750114],[6.078186035156193,51.2447128295899],[6.231968879699764,51.36598205566412],[6.233500003814925,51.402919769287166],[6.215528964996622,51.51697158813499],[6.090958118438948,51.605220794677905],[6.118769168853703,51.6604576110841],[6.039014816284293,51.677734375000114],[6.050580978393612,51.71677398681646],[5.964007854461897,51.74161148071289],[6.004777908325309,51.7681694030764],[5.972117900848332,51.831855773925724],[6.068249225616569,51.864902496338004],[6.168982028961466,51.84503173828125],[6.107149124145565,51.88898849487299],[6.158889770507983,51.905384063720646],[6.417467117309627,51.82563400268566],[6.402299880981388,51.87480163574219],[6.480340003967285,51.85462188720703],[6.692440986633414,51.92016220092779],[6.742709159851131,51.89905166625988],[6.838380813598633,51.965599060058594],[6.835361003875846,51.99552917480469],[6.698178768157959,52.040119171142635],[6.700688838958797,52.07379150390631],[6.742818832397575,52.075119018554744],[6.7684521675111,52.12076568603527],[6.876288890838737,52.12800216674805],[6.995787143707332,52.228771209716854],[7.159201145172119,52.268169403076115],[7.298637866974047,52.26420211791992],[7.586558818817139,52.376251220703125],[7.60909986495966,52.42097091674805],[7.578148841857853,52.431190490722656],[7.613338947296199,52.47603988647472],[7.693008899689005,52.45629119873058],[7.719359874725285,52.401988983154354],[7.937768936157227,52.368728637695426],[7.988409996032715,52.31166076660179],[7.928679943084944,52.305610656738395],[7.954770088195971,52.276519775390625],[7.900389194488525,52.1991920471192],[8.025090217590616,52.16201019287121],[7.999969005584717,52.1565513610841],[8.009200096130371,52.1151695251466],[7.885759830475024,52.08618164062506],[7.918758869171256,52.049720764160156],[8.196008682250977,52.07390975952171],[8.269809722900504,52.13460922241222],[8.404229164123478,52.11082077026367],[8.520669937134016,52.18727874755865],[8.446478843689249,52.212089538574446],[8.470759391784725,52.316841125488395],[8.443698883056697,52.36478042602562],[8.313388824463118,52.407039642333984],[8.298259735107592,52.4587097167971],[8.432649612426871,52.45019912719732],[8.50821876525896,52.51488876342796],[8.666278839111385,52.52527999877924]]]}},{type:"Feature",id:10,properties:{id:"DE-RP",name:"Rheinland-Pfalz",type:"State"},geometry:{type:"Polygon",coordinates:[[[7.799629211425781,50.943019866943416],[7.854489803314493,50.9263610839846],[7.834569931030558,50.881149291992415],[7.973968982696817,50.845249176025504],[7.974319934845028,50.77466964721691],[8.052820205688533,50.699131011963004],[8.121088981628418,50.70222854614252],[8.140788078308162,50.611721038818416],[8.174539566040096,50.592750549316634],[8.140970230102596,50.535850524902344],[8.056481361389274,50.55717849731468],[8.01100921630865,50.52611923217779],[7.996560096740779,50.4847412109375],[8.030008316040153,50.44818115234398],[7.984179973602238,50.41360092163097],[8.082799911499023,50.37416076660162],[8.138910293579215,50.2740592956543],[8.051680564880485,50.268829345703125],[8.076358795166072,50.23173141479492],[8.047920227050952,50.21253967285156],[8.006259918213061,50.234550476074446],[7.919559001922778,50.20370864868164],[7.897570133209172,50.16987991333019],[7.945549964904785,50.14015197753929],[7.941120147705135,50.102508544921875],[7.869957923889274,50.12857055664074],[7.78512001037592,50.05311203002941],[7.887711048126278,49.97066879272484],[8.257689476013127,50.02706909179699],[8.346780776977823,49.95928955078125],[8.34934043884283,49.881698608398665],[8.396700859069824,49.84989166259777],[8.386138916015625,49.820030212402344],[8.428420066833667,49.765998840332145],[8.486090660095442,49.76776885986328],[8.36192989349371,49.690170288085994],[8.429039001464844,49.58562088012707],[8.418828964233342,49.55218887329107],[8.467529296874943,49.473041534424055],[8.445588111877555,49.450260162353516],[8.508589744568098,49.44147872924799],[8.464948654175089,49.39220046997076],[8.498978614807413,49.393428802490234],[8.49458980560297,49.36024856567383],[8.450428962707804,49.33285140991234],[8.491369247436523,49.30128860473627],[8.392860412597713,49.242092132568416],[8.362239837646541,49.09968948364258],[8.241430282592887,48.9688415527346],[8.091376304626408,48.98925781250023],[7.937040328979435,49.05623245239258],[7.867407798767374,49.033493041992415],[7.7999339103701,49.06416320800781],[7.671083927154598,49.045970916748104],[7.531178951263485,49.097133636474666],[7.491343021392822,49.168510437011776],[7.353888988494987,49.17060852050787],[7.292399883270207,49.24573135375988],[7.38636922836298,49.29275131225603],[7.409649848938159,49.37794876098644],[7.293569087982291,49.397098541259766],[7.256089210510481,49.440269470214844],[7.310669898986873,49.47896957397484],[7.28526878356945,49.5115509033206],[7.311830043792895,49.54196929931646],[7.282810211181641,49.54483032226568],[7.273407936096191,49.592769622802734],[7.21724987030035,49.572399139404354],[7.031869888305948,49.646820068359375],[6.608709812164477,49.52021026611328],[6.378159046173266,49.54800033569359],[6.363647937774829,49.57404708862305],[6.417419910430851,49.6174888610841],[6.424099922180119,49.66633224487333],[6.516485214233398,49.724178314208984],[6.528252124786547,49.808570861816406],[6.405219078064249,49.819972991943416],[6.362998008728027,49.8540306091308],[6.312281131744442,49.83549880981457],[6.309239864349365,49.86516952514654],[6.236907005310059,49.892372131347884],[6.219171047210921,49.951641082763786],[6.163208961486873,49.95397949218773],[6.098370075226114,50.0599098205567],[6.146426200866927,50.17389297485346],[6.189638137817553,50.189464569091854],[6.170382022857723,50.23625564575207],[6.275639057159594,50.26544189453131],[6.301178932189885,50.31853103637695],[6.421248912811279,50.32228088378912],[6.380168914795206,50.38045120239269],[6.459670066833496,50.360019683838004],[6.450109004974649,50.33393096923851],[6.607089042663631,50.38161849975586],[6.641438007354679,50.3373718261721],[6.674900054931584,50.36391067504883],[6.70684909820568,50.329780578613395],[6.80925989151018,50.34981155395508],[6.75292015075712,50.46820068359398],[6.803999900818098,50.48480224609398],[6.866010189056396,50.44554901123058],[6.905250072479532,50.46194076538086],[6.888179779052734,50.521331787109375],[6.934369087219238,50.526611328125114],[6.932001113891602,50.552749633789176],[7.056681156158447,50.59838104248041],[7.150808811187744,50.59461975097656],[7.210938930511475,50.6454811096192],[7.219069004058838,50.61973190307623],[7.341228008270207,50.63579177856451],[7.381401062011776,50.71549987792969],[7.660749912262077,50.76705932617193],[7.688279151916731,50.790409088134766],[7.66198921203636,50.81917953491211],[7.76646089553833,50.84527969360346],[7.736380100250472,50.91852188110346],[7.799629211425781,50.943019866943416]]]}},{type:"Feature",id:11,properties:{id:"DE-SL",name:"Saarland",type:"State"},geometry:{type:"Polygon",coordinates:[[[7.037960052490462,49.64337921142578],[7.21724987030035,49.572399139404354],[7.273407936096191,49.592769622802734],[7.282810211181641,49.54483032226568],[7.311830043792895,49.54196929931646],[7.28526878356945,49.5115509033206],[7.310669898986873,49.47896957397484],[7.256089210510481,49.440269470214844],[7.293569087982291,49.397098541259766],[7.409649848938159,49.37794876098644],[7.38636922836298,49.29275131225603],[7.292399883270207,49.24573135375988],[7.362774372100944,49.14517593383812],[7.198331832885685,49.115177154541186],[7.098150730133057,49.15433120727562],[7.05802440643339,49.112586975097656],[7.033706188201904,49.18826293945324],[6.924295425415323,49.223075866699276],[6.840444087982178,49.21423339843767],[6.860935211181641,49.178627014160384],[6.834462642669791,49.15137863159197],[6.737987518311002,49.16456985473633],[6.66784572601324,49.280437469482536],[6.565380573272705,49.34928894042969],[6.599329471588362,49.36661911010765],[6.53541898727417,49.434162139892635],[6.431842803955135,49.474460601806754],[6.35482120513916,49.464984893799],[6.371419906616268,49.548011779785156],[6.608709812164477,49.52021026611328],[6.939819812774772,49.63912200927746],[7.037960052490462,49.64337921142578]]]}},{type:"Feature",id:12,properties:{id:"DE-ST",name:"Sachsen-Anhalt",type:"State"},geometry:{type:"Polygon",coordinates:[[[11.632508277893123,53.016410827636776],[11.688010215759562,53.00477981567377],[11.693689346313647,52.97496032714844],[11.853730201721191,52.94752883911144],[11.82853889465349,52.921730041503906],[11.846659660339299,52.90298080444353],[12.239520072937296,52.854591369628906],[12.26237869262718,52.79122161865246],[12.218799591064396,52.769401550293026],[12.204960823059082,52.710159301757926],[12.24106884002697,52.68381118774414],[12.245609283447322,52.62440872192394],[12.178129196167049,52.62139892578131],[12.189039230346964,52.56937026977539],[12.151088714599553,52.521560668945256],[12.194099426269474,52.52854156494146],[12.175079345703125,52.50278091430664],[12.205368995666447,52.49135208129883],[12.242839813232365,52.5206108093264],[12.33942985534668,52.47510147094738],[12.28273010253912,52.41271972656256],[12.312949180603027,52.401279449463175],[12.29343032836914,52.357040405273494],[12.317408561706713,52.341960906982706],[12.25396919250494,52.25008010864258],[12.301870346069336,52.21995162963867],[12.221308708190918,52.16529846191406],[12.280429840088061,52.101768493652344],[12.435828208923567,52.01491165161133],[12.490827560424748,52.0290412902832],[12.549958229064998,51.980232238769815],[12.68417930603033,52.00812149047857],[12.797579765319881,51.95854187011719],[12.858329772949446,51.96512985229492],[12.863180160522631,51.931758880615405],[12.972139358520621,51.93397140502941],[12.982969284057617,51.900531768799055],[13.055450439453068,51.89950942993164],[13.048269271850643,51.870010375976506],[13.163080215454045,51.87210083007807],[13.137908935546875,51.84654998779291],[13.198930740356388,51.71620941162115],[13.039240837097225,51.63716125488281],[13.016320228576717,51.667060852050724],[12.955019950866642,51.638359069824446],[12.842118263244629,51.68059158325201],[12.786640167236499,51.6444091796875],[12.696819305419922,51.660419464111385],[12.647199630737589,51.61677169799816],[12.248349189758585,51.566440582275504],[12.205350875854492,51.5300407409668],[12.210309982299805,51.485752105713175],[12.155740737915096,51.464221954345646],[12.202850341796989,51.423191070556925],[12.200760841369913,51.33118057250999],[12.158598899841252,51.320590972900334],[12.21623992919939,51.21699905395519],[12.185659408569279,51.18424224853521],[12.221497535705623,51.18386077880865],[12.208699226379508,51.14356994628912],[12.250238418579272,51.13209915161144],[12.231939315795955,51.1139297485351],[12.29712009429926,51.09484100341825],[12.260259628296069,51.04384994506836],[12.30772876739519,51.03596878051769],[12.234389305114746,50.94504928588867],[12.19341945648199,50.98212051391607],[12.019789695739746,50.97230148315441],[11.978389739990291,50.99827194213867],[11.990778923034725,51.01663208007824],[11.883781433105412,51.06132888793957],[11.763569831848315,51.04325103759771],[11.669088363647518,51.11370086669933],[11.471959114074707,51.109951019287166],[11.472960472106934,51.19165039062506],[11.365938186645792,51.22121047973644],[11.480478286743164,51.29914855957031],[11.4032497406007,51.343761444091854],[11.397780418396167,51.3845405578615],[11.326239585876408,51.41061019897472],[10.992289543151912,51.4169807434082],[11.010198593139648,51.4282608032226],[10.968518257141397,51.43177032470709],[10.9746608734132,51.480289459228686],[10.938948631286678,51.498771667480526],[10.951048851013127,51.5361785888673],[10.885531425476017,51.58076095581049],[10.93943023681652,51.59592056274437],[10.927610397338867,51.618339538574446],[10.70512962341337,51.643550872802734],[10.632180213928336,51.75741958618164],[10.577550888061637,51.78271102905285],[10.576871871948242,51.851169586181754],[10.655679702758732,51.90460968017584],[10.612678527832315,51.94221878051758],[10.655550003051758,51.960559844970874],[10.588009834289664,51.979869842529524],[10.569430351257381,52.01726150512718],[10.630780220031909,52.01285934448248],[10.691758155822754,52.052768707275504],[10.974808692932129,52.057250976562614],[10.949279785156307,52.10540008544922],[11.05053997039812,52.13394165039074],[11.068088531494084,52.16691970825195],[11.019989967346362,52.19678878784191],[11.091680526733626,52.22570037841808],[10.987579345703125,52.337001800537394],[11.078740119934139,52.373451232910384],[10.936208724975586,52.45901107788109],[10.94782829284668,52.49203109741222],[11.010089874267692,52.49187088012707],[10.934068679809627,52.565818786621094],[10.978019714355469,52.621829986572266],[10.921110153198413,52.60668182373047],[10.832089424133358,52.723411560058594],[10.795768737793253,52.72050857543968],[10.766200065612793,52.851242065429915],[10.942508697509822,52.85137939453125],[10.992259979248274,52.90634918212896],[11.041929244995174,52.913089752197436],[11.321439743041935,52.873699188232536],[11.507689476013184,52.939300537109375],[11.520859718322924,53.00244140625],[11.651300430297965,53.0311393737793],[11.632508277893123,53.016410827636776]]]}},{type:"Feature",id:13,properties:{id:"DE-SN",name:"Sachsen",type:"State"},geometry:{type:"Polygon",coordinates:[[[12.877999305725325,51.6726989746096],[12.955019950866642,51.638359069824446],[13.016320228576717,51.667060852050724],[13.098188400268555,51.60673904418945],[13.169989585876522,51.598300933837834],[13.162450790405273,51.561439514160156],[13.226888656616154,51.52352905273443],[13.19277858734148,51.427951812744254],[13.222880363464583,51.431190490722656],[13.233359336853141,51.39775848388672],[13.286639213562069,51.38579177856457],[13.337078094482365,51.44050979614269],[13.39611911773693,51.42473983764643],[13.42150878906267,51.45396041870117],[13.56014919281023,51.369880676269815],[13.779280662536564,51.36178207397472],[13.97159862518322,51.39891052246094],[14.015210151672363,51.37430191040062],[14.080458641052417,51.44773864746094],[14.049810409545955,51.48036193847656],[14.107279777526855,51.48025131225586],[14.091679573059253,51.49647903442383],[14.15363979339628,51.54505157470703],[14.341999053955135,51.500820159912394],[14.570050239562988,51.57242202758789],[14.665378570556811,51.55078887939459],[14.69039916992216,51.599472045898494],[14.739066123962573,51.524082183838004],[14.910359382629622,51.493190765381144],[14.963753700256461,51.453544616699446],[14.967818260193098,51.3544158935548],[15.028479576111067,51.30979919433622],[15.03811264038086,51.24029922485346],[14.930111885070744,50.99140548706055],[14.820368766784782,50.89197158813488],[14.8050794601441,50.828918457031364],[14.611928939819393,50.85478210449219],[14.651672363281534,50.93264007568382],[14.560112953186092,50.92348480224632],[14.595055580139444,50.988510131835994],[14.502429962158487,51.01681900024414],[14.501680374145678,51.05150604248058],[14.490660667419718,51.020359039306925],[14.39741039276123,51.0082817077639],[14.29401683807373,51.05416488647461],[14.246868133545036,50.97320175170904],[14.400946617126465,50.942348480224894],[14.372268676757926,50.88858032226585],[14.25451946258562,50.886379241943416],[14.058549880981559,50.800472259521484],[13.954609870910701,50.80371093750023],[13.895468711853027,50.78346633911161],[13.89871883392334,50.74296188354515],[13.850809097290096,50.71820068359375],[13.548975944519213,50.713214874267805],[13.525968551635913,50.63554000854492],[13.465190887451229,50.59648895263672],[13.374910354614315,50.643661499023494],[13.326787948608683,50.581813812255916],[13.248618125915641,50.59226989746088],[13.195990562439079,50.500591278076286],[13.0332670211792,50.50854873657249],[13.02818679809576,50.44935989379883],[12.977046012878475,50.41427230834978],[12.828769683837834,50.45862197875988],[12.705128669738826,50.39775848388672],[12.615059852600211,50.41923141479509],[12.51611328125,50.40008544921881],[12.493091583252124,50.34915924072271],[12.364088058471907,50.27642440795921],[12.32758998870844,50.17972946167015],[12.282715797424544,50.18267822265648],[12.28441429138212,50.22743225097656],[12.234164237976131,50.2532844543457],[12.252929687500227,50.27569580078125],[12.19488525390642,50.27911376953125],[12.194091796874943,50.32287597656273],[12.119680404663256,50.31275177001976],[11.97589206695568,50.35607910156256],[11.983886718750114,50.393493652343864],[11.893327713012809,50.44530105590832],[11.9581308364871,50.45672607421875],[11.971313476562443,50.49029541015625],[11.878723144531307,50.545829772949446],[12.017918586731014,50.639160156250114],[12.038880348205737,50.55749511718756],[12.164672851562784,50.580078125],[12.155091285705566,50.632080078125114],[12.281126976013411,50.639709472656364],[12.337478637695597,50.688091278076286],[12.242568969726733,50.74710845947277],[12.302859306335563,50.7832603454591],[12.261869430542049,50.82387924194347],[12.451549530029297,50.84682846069336],[12.49414920806879,50.89741897583008],[12.66631031036394,50.9273300170899],[12.621550559997559,51.001781463623274],[12.538580894470215,51.003211975097884],[12.551210403442326,51.02873992919922],[12.521319389343262,51.02188873291021],[12.516628265381087,51.06608200073248],[12.469669342041016,51.0888786315918],[12.231939315795955,51.1139297485351],[12.250238418579272,51.13209915161144],[12.208699226379508,51.14356994628912],[12.221497535705623,51.18386077880865],[12.185659408569279,51.18424224853521],[12.21623992919939,51.21699905395519],[12.158598899841252,51.320590972900334],[12.200760841369913,51.33118057250999],[12.202850341796989,51.423191070556925],[12.155740737915096,51.464221954345646],[12.210309982299805,51.485752105713175],[12.19916057586687,51.52273178100597],[12.248349189758585,51.566440582275504],[12.877999305725325,51.6726989746096]]]}},{type:"Feature",id:14,properties:{id:"DE-SH",name:"Schleswig-Holstein",type:"State"},geometry:{type:"MultiPolygon",coordinates:[[[[11.069721221923885,54.53470230102539],[11.23416805267334,54.5068054199221],[11.31360912322998,54.402084350586165],[11.11861133575485,54.40263748168957],[11.094720840454215,54.445693969726506],[11.00916671752924,54.44124984741211],[11.017498970031795,54.49458312988281],[11.069721221923885,54.53470230102539]]],[[[8.407297932191142,55.043952286536616],[8.442500114441316,55.0159721374514],[8.353609085083065,54.96736145019548],[8.366944313049373,54.90236282348644],[8.429720878601472,54.87763977050787],[8.812039375305233,54.9167366027832],[9.224779129028263,54.85595321655296],[9.282591819763581,54.80223464965832],[9.408679962158317,54.841171264648665],[9.435277938842944,54.788471221923885],[9.613611221313533,54.87597274780296],[9.603055953979947,54.83152770996105],[9.791943550110034,54.797359466552734],[9.843055725098111,54.756248474121094],[9.905833244323787,54.76374816894554],[9.907501220703182,54.797359466552734],[9.955279350281216,54.780139923095646],[10.034722328186092,54.67235946655285],[9.983054161071891,54.701248168945426],[9.93805503845249,54.67291641235363],[9.933056831359806,54.627639770507926],[9.770278930664062,54.580696105957145],[9.720659987660682,54.528215634104676],[9.74861145019537,54.54652786254883],[9.93805503845249,54.62347412109409],[9.948056221008358,54.67375183105497],[10.034166336059798,54.66986083984375],[10.02750015258789,54.55041503906267],[9.840277671813965,54.46736145019537],[9.868612289428654,54.44736099243164],[10.127498626709041,54.48513793945324],[10.199167251586971,54.45597076416027],[10.168613433838061,54.434028625488395],[10.19194412231468,54.389862060546875],[10.148056983948038,54.369304656982365],[10.13194561004633,54.311248779296875],[10.18416786193859,54.327915191650334],[10.178054809570483,54.3609733581543],[10.228056907654036,54.413471221924055],[10.318612098693961,54.43569564819336],[10.603610992431925,54.3626403808596],[10.704722404479924,54.304862976074276],[10.788610458374421,54.31152725219761],[10.928610801696777,54.381805419922046],[11.128055572509766,54.39069366455084],[11.058609962463436,54.35430526733421],[11.093610763549862,54.19791793823265],[10.879166603088493,54.088470458984375],[10.804721832275561,54.0959739685058],[10.75083446502731,54.0487518310548],[10.786944389343603,53.99652862548862],[10.878054618835733,53.9859733581543],[10.887760162353572,53.92387008666998],[10.963709831237907,53.9109992980957],[10.901128768920898,53.90127944946289],[10.87527942657465,53.92784118652338],[10.767909049987793,53.88106918334961],[10.744208335876522,53.840560913085994],[10.757729530334643,53.75157928466808],[10.946919441223201,53.67757034301758],[10.923410415649471,53.58530044555687],[10.823429107666016,53.58028030395525],[10.824370384216593,53.51728057861334],[10.639378547668628,53.465099334716854],[10.621770858764933,53.39173889160173],[10.579379081726188,53.369850158691634],[10.31917858123785,53.44248962402344],[10.336769104003906,53.460979461670036],[10.168158531188965,53.53409194946289],[10.159619331359977,53.589401245117415],[10.21062183380127,53.593261718750114],[10.196688652038802,53.62273025512707],[10.228058815002612,53.63389205932617],[10.143050193786905,53.688961029052734],[10.198959350586222,53.72972106933611],[10.179168701171818,53.74811935424805],[10.084019660949934,53.729351043701286],[10.07267856597906,53.68870925903332],[10.002109527588061,53.69211959838873],[9.990429878235147,53.6588592529298],[9.906899452209473,53.662181854248104],[9.825568199157715,53.595352172851676],[9.760189056396769,53.639122009277514],[9.72365856170694,53.56900024414068],[9.67358016967819,53.57526016235363],[9.547169685363883,53.62430953979509],[9.50700855255127,53.70085144042997],[9.28820991516119,53.86941146850586],[8.950278282165698,53.90236282348644],[8.819722175598258,54.02430725097702],[8.964166641235408,54.035137176513615],[8.985832214355867,54.0612487792971],[8.927499771118164,54.131805419921875],[8.85916709899908,54.12263870239269],[8.807498931884709,54.1751403808596],[8.83583259582565,54.251804351806584],[8.903054237365723,54.26013946533203],[8.951944351196346,54.31289291381836],[8.861945152282658,54.26874923706066],[8.843609809875659,54.28847122192383],[8.846387863159237,54.26291656494186],[8.823056221008699,54.29152679443405],[8.64527702331543,54.272640228271484],[8.579722404480094,54.30958175659191],[8.604722023010254,54.358196258545036],[8.685832023620605,54.35708236694347],[8.60916614532465,54.38652801513683],[8.86639022827194,54.404304504394474],[9.02361106872604,54.4734725952149],[8.981388092041072,54.52097320556669],[8.908611297607763,54.4620819091798],[8.806388854980526,54.47041702270508],[8.805276870727596,54.49791717529308],[8.871944427490348,54.528194427490405],[8.890276908874853,54.59263992309582],[8.81305599212692,54.59736251831083],[8.84194374084501,54.61486053466808],[8.822500228881836,54.64597320556658],[8.687498092651424,54.72986221313499],[8.693055152893066,54.76985931396507],[8.590276718139762,54.885139465331974],[8.416387557983569,54.847084045410384],[8.310277938842887,54.874305725097656],[8.332500457763729,54.86319351196312],[8.300276756286621,54.850692749023665],[8.298610687255973,54.742084503174055],[8.279722213745174,54.75180435180687],[8.298054695129508,54.909305572509766],[8.407297932191142,55.043952286536616]],[[9.706966594730142,54.5192444921042],[9.545277595520133,54.5093040466308],[9.574166297912711,54.475139617920036],[9.624165534973201,54.51152801513672],[9.7147226333621,54.49124908447277],[9.700277328491609,54.51486206054693],[9.706966594730142,54.5192444921042]]],[[[8.411785232872612,55.04948306636209],[8.417499542236328,55.05652618408226],[8.463055610656681,55.04569625854492],[8.411785232872612,55.04948306636209]]],[[[8.691945075988713,54.557083129882756],[8.671944618225154,54.49458312988281],[8.589166641235408,54.51180648803711],[8.691945075988713,54.557083129882756]]],[[[8.539723396301383,54.75569534301769],[8.595276832580623,54.71958160400385],[8.56694316864025,54.67986297607467],[8.396944999694881,54.70569610595703],[8.42138767242426,54.74319458007824],[8.539723396301383,54.75569534301769]]],[[[8.551387786865234,54.57958221435541],[8.573056221008358,54.55875015258789],[8.50916671752941,54.57402801513683],[8.551387786865234,54.57958221435541]]],[[[8.476387977600098,54.47652816772461],[8.52583217620861,54.433471679687614],[8.470277786254883,54.42180633544933],[8.449723243713436,54.45264053344738],[8.476387977600098,54.47652816772461]]],[[[8.477500915527344,54.54624938964844],[8.504722595214787,54.530971527099666],[8.471943855285701,54.49597167968756],[8.477500915527344,54.54624938964844]]],[[[8.483055114746492,54.58458328247099],[8.501387596130428,54.55819320678711],[8.455277442932186,54.55875015258789],[8.483055114746492,54.58458328247099]]],[[[8.356944084167594,54.71152877807617],[8.339165687561149,54.689304351807095],[8.395278930664062,54.61208343505882],[8.292498588561955,54.66708374023483],[8.356944084167594,54.71152877807617]]]]}},{type:"Feature",id:15,properties:{id:"DE-TH",name:"Thringen",type:"State"},geometry:{type:"Polygon",coordinates:[[[10.771890640258789,51.6449089050293],[10.939500808715763,51.60713958740246],[10.885531425476017,51.58076095581049],[10.951048851013127,51.5361785888673],[10.938948631286678,51.498771667480526],[10.9746608734132,51.480289459228686],[10.968518257141397,51.43177032470709],[11.010198593139648,51.4282608032226],[10.992289543151912,51.4169807434082],[11.326239585876408,51.41061019897472],[11.397780418396167,51.3845405578615],[11.4032497406007,51.343761444091854],[11.480478286743164,51.29914855957031],[11.365938186645792,51.22121047973644],[11.472960472106934,51.19165039062506],[11.49051952362072,51.165691375732536],[11.454468727111987,51.143348693847656],[11.489728927612305,51.10256195068365],[11.669088363647518,51.11370086669933],[11.763569831848315,51.04325103759771],[11.883781433105412,51.06132888793957],[11.990778923034725,51.01663208007824],[11.978389739990291,50.99827194213867],[12.019789695739746,50.97230148315441],[12.19341945648199,50.98212051391607],[12.228428840637207,50.94509887695324],[12.307490348816088,51.02495956420893],[12.260259628296069,51.04384994506836],[12.29712009429926,51.09484100341825],[12.469669342041016,51.0888786315918],[12.516628265381087,51.06608200073248],[12.521319389343262,51.02188873291021],[12.551210403442326,51.02873992919922],[12.538580894470215,51.003211975097884],[12.621550559997559,51.001781463623274],[12.666169166565055,50.92364883422863],[12.49414920806879,50.89741897583008],[12.451549530029297,50.84682846069336],[12.261869430542049,50.82387924194347],[12.302859306335563,50.7832603454591],[12.242568969726733,50.74710845947277],[12.278558731079158,50.74695205688482],[12.27758979797386,50.702899932861555],[12.330454826355037,50.673278808593864],[12.281126976013411,50.639709472656364],[12.209620475768986,50.646999359130916],[12.202428817749137,50.620948791503906],[12.161071777343864,50.63568115234398],[12.147343635559082,50.58736038208019],[12.170899391174316,50.583679199218864],[12.06268405914318,50.55749511718756],[12.027527809143123,50.56848144531267],[12.029620170593262,50.6317520141601],[11.987914085388354,50.627929687500114],[11.932495117187727,50.56091308593773],[11.878723144531307,50.545829772949446],[11.97113132476818,50.48651123046898],[11.94750976562517,50.48272705078131],[11.9581308364871,50.45672607421875],[11.893327713012809,50.44530105590832],[11.933539390563908,50.43050003051758],[11.868338584899902,50.40420913696312],[11.821249961853027,50.392898559570426],[11.781168937683162,50.42263031005882],[11.522049903869856,50.37353897094738],[11.481788635254134,50.433021545410156],[11.446418762206974,50.421760559081974],[11.41750812530546,50.45145034790039],[11.430090904235897,50.51472091674833],[11.348060607910156,50.521869659423885],[11.324259757995776,50.48833084106468],[11.248118400573674,50.476890563964844],[11.281947135925293,50.365509033203125],[11.251668930053711,50.26519012451172],[11.14237976074213,50.287109375],[11.159410476684513,50.32794189453125],[11.113239288330135,50.36489868164091],[11.04424953460699,50.34238052368164],[10.9981107711792,50.36447906494152],[10.99833011627203,50.342250823974666],[10.940460205078125,50.39025115966808],[10.877280235290527,50.393779754638786],[10.71665954589838,50.352661132812614],[10.728790283203182,50.315509796142635],[10.84955883026123,50.27127075195307],[10.84965038299572,50.24151992797874],[10.734558105469034,50.248352050781364],[10.728810310363713,50.19984054565424],[10.617910385132063,50.221820831299],[10.605488777160872,50.330242156982536],[10.493670463562239,50.35243988037132],[10.458058357238826,50.40090942382824],[10.39352035522461,50.39334106445307],[10.405019760131836,50.4232292175293],[10.333989143371525,50.49404907226557],[10.127880096435604,50.56501007080078],[10.03975868225126,50.51588058471674],[10.063029289245662,50.557312011718864],[10.038170814514217,50.613960266113395],[10.086329460144157,50.621219635009936],[10.048980712890852,50.67726135253929],[9.951470375060978,50.670921325683594],[9.946098327636662,50.630100250244254],[9.873108863830566,50.64184188842779],[9.938960075378418,50.73741912841791],[9.920918464660645,50.76319885253906],[9.956660270690861,50.781711578369254],[9.950229644775561,50.82239913940424],[10.021959304809798,50.833309173583984],[10.021409988403377,50.86668014526367],[10.062939643859806,50.88500213623058],[10.014529228210677,50.92232131958036],[9.97887897491455,50.90760040283203],[9.99036979675293,50.937240600585994],[9.948748588562069,50.92615890502924],[9.94838905334501,50.9484214782716],[10.06787014007574,50.948028564453125],[10.019538879394474,50.9816589355471],[10.04291820526123,51.01494216918968],[10.203859329223803,51.00291061401373],[10.20329856872587,51.043708801269645],[10.149688720703352,51.055130004882926],[10.178549766540641,51.11801147460943],[10.12471866607666,51.14057159423834],[10.172169685363826,51.151420593261946],[10.214177131652946,51.11780929565441],[10.237089157104606,51.18072891235363],[10.075889587402571,51.226181030273665],[10.05734062194847,51.278251647949446],[9.97350883483881,51.28619003295904],[9.924859046936092,51.37184143066406],[10.054610252380314,51.4380989074707],[10.161690711975098,51.42998886108421],[10.143619537353686,51.44128036499035],[10.19617938995367,51.48188018798828],[10.302998542785701,51.49230194091808],[10.36752033233654,51.53662109375],[10.37830924987793,51.58518981933605],[10.659000396728686,51.55340194702171],[10.639940261841048,51.61925888061535],[10.771890640258789,51.6449089050293]]]}}],c2={type:l2,features:o2},li={BW:{name:"Baden-Wrttemberg",kurzname:"BaW"},BY:{name:"Bayern",kurzname:"Bayern"},BE:{name:"Berlin",kurzname:"Berlin"},BB:{name:"Brandenburg",kurzname:"Brandenb."},HB:{name:"Bremen",kurzname:"Bremen"},HH:{name:"Hamburg",kurzname:"Hamburg"},HE:{name:"Hessen",kurzname:"Hessen"},MV:{name:"Mecklenburg-Vorpommern",kurzname:"MeckPom"},NI:{name:"Niedersachsen",kurzname:"Nieders."},NW:{name:"Nordrhein-Westfalen",kurzname:"NRW"},RP:{name:"Rheinland-Pfalz",kurzname:"RhPf"},SL:{name:"Saarland",kurzname:"Saarland"},SN:{name:"Sachsen",kurzname:"Sachsen"},ST:{name:"Sachsen-Anhalt",kurzname:"SaAnh"},SH:{name:"Schleswig-Holstein",kurzname:"SchlHol"},TH:{name:"Thringen",kurzname:"Thring."},AT:{name:"sterreich",kurzname:"sterr."},CH:{name:"Schweiz",kurzname:"Schweiz"}};function oi(t,r,a){if(a===r)return"#fbbf24";const s=Math.max(0,Math.min(1,(t-r)/(a-r))),n=Math.round(219+32*s),i=Math.round(234+-43*s),l=Math.round(254+-218*s);return`rgb(${n},${i},${l})`}function d2({allRegions:t,eigeneRegion:r}){var h;const[a,s]=m.useState(null),n=m.useMemo(()=>{const g={};return t.forEach(o=>{g[o.region]=o.durchschnitt_spez_ertrag}),g},[t]),i=m.useMemo(()=>{const g={};return t.forEach(o=>{g[o.region]=o}),g},[t]),{min:l,max:c}=m.useMemo(()=>{const g=t.map(o=>o.durchschnitt_spez_ertrag);return{min:Math.min(...g),max:Math.max(...g)}},[t]);return e.jsxs("div",{className:"relative",children:[e.jsx(Ol,{projection:"geoMercator",projectionConfig:{center:[10.4515,51.2],scale:2800},width:500,height:560,style:{width:"100%",height:"auto"},children:e.jsx(Rl,{geography:c2,children:({geographies:g})=>g.map(o=>{const x=o.properties.id.replace("DE-",""),u=n[x],d=x===r;return e.jsx(U5,{geography:o,fill:u!==void 0?oi(u,l,c):"#e5e7eb",stroke:d?"#1d4ed8":"#fff",strokeWidth:d?2.5:.8,style:{default:{outline:"none"},hover:{outline:"none",opacity:.85,cursor:"pointer"},pressed:{outline:"none"}},onMouseEnter:p=>{u!==void 0&&s({name:o.properties.name,region:i[x]??null,wert:u,x:p.clientX,y:p.clientY})},onMouseMove:p=>{a&&s(b=>b?{...b,x:p.clientX,y:p.clientY}:null)},onMouseLeave:()=>s(null)},o.rsmKey)})})}),a&&e.jsxs("div",{className:"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-2 shadow-lg pointer-events-none text-sm",style:{left:a.x+12,top:a.y-40},children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-blue-600 dark:text-blue-400 font-medium",children:[a.wert.toFixed(0)," kWh/kWp"]}),a.region&&e.jsxs("div",{className:"mt-1 pt-1 border-t border-gray-100 dark:border-gray-700 space-y-0.5 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("p",{children:[a.region.anzahl_anlagen," Anlage",a.region.anzahl_anlagen!==1?"n":"","   ",a.region.durchschnitt_kwp.toFixed(1)," kWp"]}),a.region.avg_speicher_ladung_kwh!=null&&e.jsxs("p",{children:[" ",a.region.avg_speicher_ladung_kwh.toFixed(0),"  / ",((h=a.region.avg_speicher_entladung_kwh)==null?void 0:h.toFixed(0))??"","  kWh/Mon"]}),a.region.avg_wp_jaz!=null&&e.jsxs("p",{children:[" JAZ ",a.region.avg_wp_jaz.toFixed(1)]}),a.region.avg_eauto_km!=null&&e.jsxs("p",{children:[" ",a.region.avg_eauto_km.toFixed(0)," km/Mon  ",a.region.avg_eauto_ladung_kwh!=null?`${a.region.avg_eauto_ladung_kwh.toFixed(0)} kWh zuhause`:""]}),a.region.avg_wallbox_kwh!=null&&e.jsxs("p",{children:[" ",a.region.avg_wallbox_kwh.toFixed(0)," kWh/Mon",a.region.avg_wallbox_pv_anteil!=null?`  ${a.region.avg_wallbox_pv_anteil.toFixed(0)}% PV`:""]}),a.region.avg_bkw_kwh!=null&&e.jsxs("p",{children:[" ",a.region.avg_bkw_kwh.toFixed(0)," kWh/Mon"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 justify-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:l.toFixed(0)}),e.jsx("div",{className:"h-3 w-32 rounded",style:{background:`linear-gradient(to right, ${oi(l,l,c)}, ${oi(c,l,c)})`}}),e.jsxs("span",{className:"text-xs text-gray-500",children:[c.toFixed(0)," kWh/kWp"]})]}),r&&e.jsx("p",{className:"text-xs text-center text-blue-600 dark:text-blue-400 mt-1",children:"Dein Bundesland: blauer Rahmen"})]})}function h2({anlageId:t,zeitraum:r}){var u;const[a,s]=m.useState(null),[n,i]=m.useState([]),[l,c]=m.useState(!1),[h,g]=m.useState(null);m.useEffect(()=>{(async()=>{c(!0),g(null);try{const[p,b]=await Promise.all([rt.getBenchmark(t,r),rt.getRegionalStatistics().catch(()=>[])]);s(p),i(b)}catch(p){g(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[t,r]);const o=m.useMemo(()=>{var k;if(!a)return null;const{spez_ertrag_anlage:d,spez_ertrag_region:p,spez_ertrag_durchschnitt:b,rang_region:j,anzahl_anlagen_region:f}=a.benchmark,y=a.anlage.region;return{region:y,regionName:((k=li[y])==null?void 0:k.name)||y,spezErtrag:d,regionDurchschnitt:p,communityDurchschnitt:b,rang:j,anzahlAnlagen:f,abweichungRegion:(d-p)/p*100,abweichungCommunity:(p-b)/b*100,perzentilRegion:Math.round((1-j/f)*100)}},[a]),x=m.useMemo(()=>o?[{name:"Du",wert:o.spezErtrag,fill:"var(--color-primary-500, #3b82f6)"},{name:o.regionName,wert:o.regionDurchschnitt,fill:"#60a5fa"},{name:"Community",wert:o.communityDurchschnitt,fill:"#9ca3af"}]:[],[o]);return l?e.jsx(Se,{text:"Lade regionale Daten..."}):h?e.jsx(te,{type:"error",children:h}):!a||!o?null:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Betrachtungszeitraum: ",a.zeitraum_label]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30",children:e.jsx(ht,{className:"h-5 w-5 text-blue-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Dein Standort"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.regionName})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[o.anzahlAnlagen," Anlagen in der Region"]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900/30",children:e.jsx(Xr,{className:"h-5 w-5 text-yellow-500"})}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Rang in ",((u=li[o.region])==null?void 0:u.kurzname)||o.region]})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["#",o.rang]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["von ",o.anzahlAnlagen]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Besser als ",o.perzentilRegion,"% in deiner Region"]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${o.abweichungRegion>=0?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:o.abweichungRegion>=0?e.jsx(Fe,{className:"h-5 w-5 text-green-500"}):e.jsx(Gt,{className:"h-5 w-5 text-red-500"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"vs. Region"})]}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsxs("span",{className:`text-3xl font-bold ${o.abweichungRegion>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[o.abweichungRegion>=0?"+":"",o.abweichungRegion.toFixed(1),"%"]})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[" Region: ",o.regionDurchschnitt.toFixed(0)," kWh/kWp"]})]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ce,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Spezifischer Ertrag im Vergleich"})]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Je,{data:x,layout:"vertical",children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb",horizontal:!0,vertical:!1}),e.jsx(ke,{type:"number",tick:{fill:"#6b7280",fontSize:12},domain:[0,"auto"],label:{value:"kWh/kWp",position:"bottom",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(be,{type:"category",dataKey:"name",tick:{fill:"#6b7280",fontSize:12},width:100}),e.jsx(ge,{formatter:d=>[`${d.toFixed(0)} kWh/kWp`,"Spez. Ertrag"],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(oe,{dataKey:"wert",radius:[0,4,4,0],children:x.map((d,p)=>e.jsx(Ze,{fill:d.fill},`cell-${p}`))})]})})})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Er,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Regionale Einordnung"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:[o.regionName," vs. Community"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`text-lg font-semibold ${o.abweichungCommunity>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[o.abweichungCommunity>=0?"+":"",o.abweichungCommunity.toFixed(1),"%"]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[o.abweichungCommunity>=0?"ber":"unter"," dem Durchschnitt"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Deine Region liegt ",o.abweichungCommunity>=0?"ber":"unter"," dem bundesweiten Community-Durchschnitt von ",o.communityDurchschnitt.toFixed(0)," kWh/kWp."]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Deine Anlage"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Ausrichtung:"}),e.jsx("span",{className:"text-gray-900 dark:text-white capitalize",children:a.anlage.ausrichtung})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Neigung:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[a.anlage.neigung_grad,""]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Leistung:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[a.anlage.kwp," kWp"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Installation:"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:a.anlage.installation_jahr})]})]})]})]})]}),n.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Spezifischer Ertrag nach Bundesland"})]}),e.jsx(d2,{allRegions:n,eigeneRegion:(a==null?void 0:a.anlage.region)??null})]}),n.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Alle Regionen im Vergleich"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Region"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"Anlagen"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:" kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:" kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:" Ladung  / Entladung  pro Monat (kWh)",children:" Ladung/Entl."}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:" Jahresarbeitszahl ( Wrme   Strom)",children:" JAZ"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:" km/Mon   kWh zuhause geladen",children:" km / kWh"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:" kWh geladen/Mon  davon PV-Anteil (wo messbar)",children:" kWh / PV%"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",title:" BKW-Ertrag pro Monat (kWh)",children:" kWh/Mon"})]})}),e.jsx("tbody",{children:n.sort((d,p)=>p.durchschnitt_spez_ertrag-d.durchschnitt_spez_ertrag).map((d,p)=>{var j,f;const b=d.region===(a==null?void 0:a.anlage.region);return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${b?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-medium w-5 text-center ${p<3?"text-yellow-600":"text-gray-400"}`,children:p+1}),e.jsx("span",{className:`font-medium ${b?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white"}`,children:((j=li[d.region])==null?void 0:j.name)||d.region}),b&&e.jsx("span",{className:"text-xs text-primary-500",children:"(Du)"})]})}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.anzahl_anlagen}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.durchschnitt_kwp.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900 dark:text-white",children:d.durchschnitt_spez_ertrag.toFixed(0)}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400 leading-tight",children:d.avg_speicher_ladung_kwh!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.avg_speicher_ladung_kwh.toFixed(0)," "]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[((f=d.avg_speicher_entladung_kwh)==null?void 0:f.toFixed(0))??"","  kWh"]})]}):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.avg_wp_jaz!=null?d.avg_wp_jaz.toFixed(1):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400 leading-tight",children:d.avg_eauto_km!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.avg_eauto_km.toFixed(0)," km"]}),e.jsx("div",{className:"text-xs text-gray-400",children:d.avg_eauto_ladung_kwh!=null?`${d.avg_eauto_ladung_kwh.toFixed(0)} kWh`:""})]}):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400 leading-tight",children:d.avg_wallbox_kwh!=null?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[d.avg_wallbox_kwh.toFixed(0)," kWh"]}),e.jsx("div",{className:"text-xs text-gray-400",children:d.avg_wallbox_pv_anteil!=null?`${d.avg_wallbox_pv_anteil.toFixed(0)}% PV`:""})]}):"-"}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:d.avg_bkw_kwh!=null?`${d.avg_bkw_kwh.toFixed(0)} kWh`:"-"})]},d.region)})})]})})]})]})}const ci=["Jan","Feb","Mr","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],g2=["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],zo={fruehling:{name:"Frhling",monate:[3,4,5],icon:kt,color:"green"},sommer:{name:"Sommer",monate:[6,7,8],icon:ce,color:"yellow"},herbst:{name:"Herbst",monate:[9,10,11],icon:Ir,color:"orange"},winter:{name:"Winter",monate:[12,1,2],icon:xh,color:"blue"}};function x2({anlageId:t,zeitraum:r}){const[a,s]=m.useState(null),[n,i]=m.useState(null),[l,c]=m.useState(null),[h,g]=m.useState(!1),[o,x]=m.useState(null);m.useEffect(()=>{(async()=>{g(!0),x(null);try{const[f,y,k]=await Promise.all([rt.getBenchmark(t,r),rt.getTrends("12_monate").catch(()=>null),rt.getDegradation().catch(()=>null)]);s(f),i(y),c(k)}catch(f){x(f instanceof Error?f.message:"Fehler beim Laden")}finally{g(!1)}})()},[t,r]);const u=m.useMemo(()=>a!=null&&a.anlage.monatswerte?[...a.anlage.monatswerte].sort((f,y)=>f.jahr-y.jahr||f.monat-y.monat).map(f=>({name:`${ci[f.monat-1]} ${f.jahr%100}`,monat:f.monat,jahr:f.jahr,ertrag:f.spez_ertrag_kwh_kwp||0,autarkie:f.autarkie_prozent||null,eigenverbrauch:f.eigenverbrauch_prozent||null})):[],[a]),d=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return null;const j=a.anlage.monatswerte,f=[...new Set(j.map(D=>D.jahr))].sort();if(f.length<2)return null;const y={};j.forEach(D=>{y[D.jahr]||(y[D.jahr]={summe:0,anzahl:0}),y[D.jahr].summe+=D.spez_ertrag_kwh_kwp||0,y[D.jahr].anzahl+=1});const k=f.filter(D=>y[D].anzahl===12);if(k.length<2)return null;const _=k[k.length-1],w=k[k.length-2],v=y[_].summe,E=y[w].summe,F=v-E,C=F/E*100;return{letztesJahr:_,vorletztesJahr:w,ertragLetzt:v,ertragVorletzt:E,differenz:F,differenzProzent:C}},[a]),p=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return null;const j=a.anlage.monatswerte,f={};return Object.entries(zo).forEach(([y,k])=>{f[y]={summe:0,anzahl:0},j.forEach(_=>{k.monate.includes(_.monat)&&(f[y].summe+=_.spez_ertrag_kwh_kwp||0,f[y].anzahl+=1)})}),Object.entries(zo).map(([y,k])=>{const _=f[y],w=_.anzahl>0?_.summe/_.anzahl:0;return{key:y,name:k.name,icon:k.icon,color:k.color,durchschnittMonat:w,anzahlMonate:_.anzahl}})},[a]),b=m.useMemo(()=>{if(!(a!=null&&a.anlage.monatswerte))return[];const j=a.anlage.monatswerte,f={};for(let y=1;y<=12;y++)f[y]={summe:0,anzahl:0};return j.forEach(y=>{f[y.monat].summe+=y.spez_ertrag_kwh_kwp||0,f[y.monat].anzahl+=1}),Object.entries(f).map(([y,k])=>({monat:parseInt(y),name:ci[parseInt(y)-1],durchschnitt:k.anzahl>0?k.summe/k.anzahl:0,anzahl:k.anzahl}))},[a]);return h?e.jsx(Se,{text:"Lade Trend-Daten..."}):o?e.jsx(te,{type:"error",children:o}):a?e.jsxs("div",{className:"space-y-6",children:[u.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ertragsverlauf"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Tr,{data:u,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorErtrag",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-primary-500, #3b82f6)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-primary-500, #3b82f6)",stopOpacity:0})]})}),e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ke,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11},interval:Math.floor(u.length/12)}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280",fontSize:12}}}),e.jsx(ge,{formatter:j=>[`${j.toFixed(1)} kWh/kWp`,"Spez. Ertrag"],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(It,{type:"monotone",dataKey:"ertrag",stroke:"var(--color-primary-500, #3b82f6)",strokeWidth:2,fill:"url(#colorErtrag)"})]})})})]}),p&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($t,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Saisonale Performance"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:p.map(j=>{const f=j.icon,k={green:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",icon:"text-green-500"},yellow:{bg:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-700 dark:text-yellow-300",icon:"text-yellow-500"},orange:{bg:"bg-orange-50 dark:bg-orange-900/20",text:"text-orange-700 dark:text-orange-300",icon:"text-orange-500"},blue:{bg:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-300",icon:"text-blue-500"}}[j.color];return e.jsxs("div",{className:`rounded-xl p-4 ${k.bg}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(f,{className:`h-5 w-5 ${k.icon}`}),e.jsx("span",{className:`font-medium ${k.text}`,children:j.name})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:j.durchschnittMonat.toFixed(0)}),e.jsx("span",{className:"text-sm text-gray-500",children:"kWh/kWp"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[" pro Monat (",j.anzahlMonate," Monate)"]})]},j.key)})})]}),d&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Kt,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:d.vorletztesJahr}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.ertragVorletzt.toFixed(0)}),e.jsx("span",{className:"text-sm text-gray-500",children:"kWh/kWp"})]})]}),e.jsxs("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-primary-600 dark:text-primary-400 mb-1",children:d.letztesJahr}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",children:d.ertragLetzt.toFixed(0)}),e.jsx("span",{className:"text-sm text-primary-500",children:"kWh/kWp"})]})]}),e.jsxs("div",{className:`rounded-xl p-4 ${d.differenzProzent>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Vernderung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d.differenzProzent>=0?e.jsx(Gd,{className:"h-6 w-6 text-green-500"}):d.differenzProzent<=-.5?e.jsx(Kd,{className:"h-6 w-6 text-red-500"}):e.jsx(ts,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("span",{className:`text-2xl font-bold ${d.differenzProzent>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[d.differenzProzent>=0?"+":"",d.differenzProzent.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[d.differenz>=0?"+":"",d.differenz.toFixed(0)," kWh/kWp"]})]})]})]})]})]}),b.some(j=>j.anzahl>1)&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ce,{className:"h-5 w-5 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Typischer Monatsverlauf"})]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:b,children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ke,{dataKey:"name",tick:{fill:"#6b7280",fontSize:11}}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},domain:[0,"auto"]}),e.jsx(ge,{formatter:(j,f)=>f==="durchschnitt"?[`${j.toFixed(1)} kWh/kWp`," Ertrag"]:[j,f],labelFormatter:j=>g2[ci.indexOf(j)],contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(De,{formatter:()=>"Durchschnittlicher Ertrag"}),e.jsx(qe,{type:"monotone",dataKey:"durchschnitt",stroke:"var(--color-primary-500, #3b82f6)",strokeWidth:3,dot:{fill:"var(--color-primary-500, #3b82f6)",strokeWidth:2},activeDot:{r:6}})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 text-center mt-2",children:["Basierend auf ",u.length," Monaten Daten"]})]}),n&&n.trends.speicher_quote.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Fe,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Community-Entwicklung"})]}),e.jsx("div",{className:"h-72",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:n.trends.speicher_quote.map((j,f)=>{var y,k;return{monat:j.monat,speicher:j.wert,waermepumpe:((y=n.trends.waermepumpe_quote[f])==null?void 0:y.wert)||0,eauto:((k=n.trends.eauto_quote[f])==null?void 0:k.wert)||0}}),children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ke,{dataKey:"monat",tick:{fill:"#6b7280",fontSize:10},interval:1}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},domain:[0,100],unit:"%"}),e.jsx(ge,{formatter:(j,f)=>{const y={speicher:"Speicher",waermepumpe:"Wrmepumpe",eauto:"E-Auto"};return[`${j.toFixed(1)}%`,y[f]||f]},contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(De,{formatter:j=>({speicher:"Speicher-Quote",waermepumpe:"Wrmepumpen-Quote",eauto:"E-Auto-Quote"})[j]||j}),e.jsx(qe,{type:"monotone",dataKey:"speicher",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(qe,{type:"monotone",dataKey:"waermepumpe",stroke:"#3b82f6",strokeWidth:2,dot:!1}),e.jsx(qe,{type:"monotone",dataKey:"eauto",stroke:"#a855f7",strokeWidth:2,dot:!1})]})})}),e.jsx("p",{className:"text-sm text-gray-500 text-center mt-2",children:"Anteil der Community-Anlagen mit jeweiliger Ausstattung"})]}),l&&l.nach_alter.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Kt,{className:"h-5 w-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Degradation nach Anlagenalter"})]}),e.jsx("div",{className:"h-64",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(Lr,{data:l.nach_alter,children:[e.jsx(je,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(ke,{dataKey:"alter_jahre",tick:{fill:"#6b7280",fontSize:12},label:{value:"Anlagenalter (Jahre)",position:"bottom",offset:-5,fill:"#6b7280"}}),e.jsx(be,{tick:{fill:"#6b7280",fontSize:12},domain:["dataMin - 50","dataMax + 50"],label:{value:"kWh/kWp",angle:-90,position:"insideLeft",style:{fill:"#6b7280"}}}),e.jsx(ge,{formatter:(j,f)=>f==="durchschnitt_spez_ertrag"?[`${j.toFixed(0)} kWh/kWp`," Ertrag"]:f==="anzahl"?[j,"Anlagen"]:[j,f],labelFormatter:j=>`${j} Jahre alt`,contentStyle:{background:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(De,{formatter:()=>"Durchschnittlicher spez. Ertrag"}),e.jsx(qe,{type:"monotone",dataKey:"durchschnitt_spez_ertrag",stroke:"#f97316",strokeWidth:3,dot:{fill:"#f97316",strokeWidth:2},activeDot:{r:6}})]})})}),e.jsxs("div",{className:"mt-4 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nt,{className:"h-5 w-5 text-orange-500"}),e.jsxs("span",{className:"font-medium text-orange-900 dark:text-orange-100",children:["Durchschnittliche Degradation: ",l.durchschnittliche_degradation_prozent_jahr.toFixed(2),"% / Jahr"]})]}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300 mt-1",children:["Basierend auf ",l.nach_alter.reduce((j,f)=>j+f.anzahl,0)," Anlagen unterschiedlichen Alters"]})]})]})]}):null}const So={BW:"Baden-Wrttemberg",BY:"Bayern",BE:"Berlin",BB:"Brandenburg",HB:"Bremen",HH:"Hamburg",HE:"Hessen",MV:"Mecklenburg-Vorpommern",NI:"Niedersachsen",NW:"Nordrhein-Westfalen",RP:"Rheinland-Pfalz",SL:"Saarland",SN:"Sachsen",ST:"Sachsen-Anhalt",SH:"Schleswig-Holstein",TH:"Thringen",AT:"sterreich",CH:"Schweiz"};function u2({anlageId:t,zeitraum:r}){var b;const[a,s]=m.useState(null),[n,i]=m.useState(null),[l,c]=m.useState(null),[h,g]=m.useState(!1),[o,x]=m.useState(null);m.useEffect(()=>{(async()=>{g(!0),x(null);try{const[f,y,k]=await Promise.all([rt.getBenchmark(t,r),rt.getGlobalStatistics().catch(()=>null),rt.getRanking("spez_ertrag",10).catch(()=>null)]);s(f),i(y),c(k)}catch(f){x(f instanceof Error?f.message:"Fehler beim Laden")}finally{g(!1)}})()},[t,r]);const u=m.useMemo(()=>a?{anzahlAnlagen:a.benchmark.anzahl_anlagen_gesamt,anzahlRegion:a.benchmark.anzahl_anlagen_region,durchschnittErtrag:a.benchmark.spez_ertrag_durchschnitt,regionErtrag:a.benchmark.spez_ertrag_region,region:a.anlage.region,regionName:So[a.anlage.region]||a.anlage.region}:null,[a]),d=m.useMemo(()=>a?[{name:"Speicher",icon:e.jsx(Ce,{className:"h-5 w-5"}),vorhanden:!!a.anlage.speicher_kwh,details:a.anlage.speicher_kwh?`${a.anlage.speicher_kwh} kWh`:null,color:"green"},{name:"Wrmepumpe",icon:e.jsx(dt,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_waermepumpe,details:null,color:"blue"},{name:"E-Auto",icon:e.jsx(Te,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_eauto,details:null,color:"purple"},{name:"Wallbox",icon:e.jsx(Ht,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_wallbox,details:a.anlage.wallbox_kw?`${a.anlage.wallbox_kw} kW`:null,color:"cyan"},{name:"Balkonkraftwerk",icon:e.jsx(ce,{className:"h-5 w-5"}),vorhanden:a.anlage.hat_balkonkraftwerk,details:a.anlage.bkw_wp?`${a.anlage.bkw_wp} Wp`:null,color:"amber"}]:[],[a]),p=m.useMemo(()=>{if(!a)return null;const{rang_gesamt:j,anzahl_anlagen_gesamt:f,rang_region:y,anzahl_anlagen_region:k}=a.benchmark,_=Math.round((1-j/f)*100),w=Math.round((1-y/k)*100);return{rangGesamt:j,vonGesamt:f,perzentilGesamt:_,rangRegion:y,vonRegion:k,perzentilRegion:w}},[a]);return h?e.jsx(Se,{text:"Lade Community-Statistiken..."}):o?e.jsx(te,{type:"error",children:o}):!a||!u?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Er,{className:"h-6 w-6 text-primary-500"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Community-bersicht"}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:a.zeitraum_label})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Hs,{label:"Anlagen gesamt",value:u.anzahlAnlagen,icon:e.jsx(Er,{className:"h-5 w-5 text-primary-500"})}),e.jsx(Hs,{label:" Spez. Ertrag",value:u.durchschnittErtrag,suffix:"kWh/kWp",icon:e.jsx(ce,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(Hs,{label:`In ${u.regionName}`,value:u.anzahlRegion,suffix:"Anlagen",icon:e.jsx(ht,{className:"h-5 w-5 text-blue-500"})}),e.jsx(Hs,{label:" Region",value:u.regionErtrag,suffix:"kWh/kWp",icon:e.jsx(Kt,{className:"h-5 w-5 text-green-500"})})]})]}),p&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ya,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Deine Position in der Community"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100 dark:from-primary-900/20 dark:to-primary-800/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Er,{className:"h-5 w-5 text-primary-500"}),e.jsx("span",{className:"text-primary-700 dark:text-primary-300 font-medium",children:"Community-weit"})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-4xl font-bold text-primary-600 dark:text-primary-400",children:["#",p.rangGesamt]}),e.jsxs("span",{className:"text-primary-500 dark:text-primary-400",children:["von ",p.vonGesamt]})]}),e.jsx(Eo,{value:p.perzentilGesamt,color:"primary"}),e.jsxs("p",{className:"text-sm text-primary-600 dark:text-primary-400 mt-2",children:["Besser als ",p.perzentilGesamt,"% der Community"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"h-5 w-5 text-blue-500"}),e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-medium",children:["In ",u.regionName]})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsxs("span",{className:"text-4xl font-bold text-blue-600 dark:text-blue-400",children:["#",p.rangRegion]}),e.jsxs("span",{className:"text-blue-500 dark:text-blue-400",children:["von ",p.vonRegion]})]}),e.jsx(Eo,{value:p.perzentilRegion,color:"blue"}),e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Besser als ",p.perzentilRegion,"% in deiner Region"]})]})]})]}),e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ne,{className:"h-6 w-6 text-primary-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Deine Anlage"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(Gs,{label:"Leistung",value:`${a.anlage.kwp} kWp`,icon:e.jsx(ce,{className:"h-5 w-5 text-yellow-500"})}),e.jsx(Gs,{label:"Ausrichtung",value:a.anlage.ausrichtung,icon:e.jsx(Fe,{className:"h-5 w-5 text-blue-500"}),capitalize:!0}),e.jsx(Gs,{label:"Neigung",value:`${a.anlage.neigung_grad}`,icon:e.jsx(Kt,{className:"h-5 w-5 text-green-500"})}),e.jsx(Gs,{label:"Installation",value:String(a.anlage.installation_jahr),icon:e.jsx($t,{className:"h-5 w-5 text-gray-500"})})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Ausstattung"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:d.map(j=>e.jsxs("div",{className:`flex items-center gap-2 p-3 rounded-lg ${j.vorhanden?`bg-${j.color}-50 dark:bg-${j.color}-900/20 border border-${j.color}-200 dark:border-${j.color}-800`:"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:j.vorhanden?`text-${j.color}-500`:"text-gray-400",children:j.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${j.vorhanden?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-500"}`,children:j.name}),j.details&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:j.details})]}),j.vorhanden?e.jsx(Nr,{className:`h-4 w-4 text-${j.color}-500`}):e.jsx(xs,{className:"h-4 w-4 text-gray-300 dark:text-gray-600"})]},j.name))})]}),n&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Kt,{className:"h-6 w-6 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ausstattungsquoten der Community"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(Ia,{label:"Speicher",value:n.ausstattungsquoten.speicher,color:"green"}),e.jsx(Ia,{label:"Wrmepumpe",value:n.ausstattungsquoten.waermepumpe,color:"blue"}),e.jsx(Ia,{label:"E-Auto",value:n.ausstattungsquoten.eauto,color:"purple"}),e.jsx(Ia,{label:"Wallbox",value:n.ausstattungsquoten.wallbox,color:"cyan"}),e.jsx(Ia,{label:"Balkonkraftwerk",value:n.ausstattungsquoten.balkonkraftwerk,color:"amber"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Die typische Community-Anlage"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Leistung:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.typische_anlage.kwp," kWp"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Ausrichtung:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:n.typische_anlage.ausrichtung})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Neigung:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.typische_anlage.neigung_grad,""]})]}),n.typische_anlage.speicher_kwh&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Speicher:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.typische_anlage.speicher_kwh," kWh"]})]})]})]})]}),l&&l.ranking.length>0&&e.jsxs(P,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ya,{className:"h-6 w-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Top 10 - Spezifischer Ertrag"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Rang"}),e.jsx("th",{className:"text-left py-2 px-3 text-gray-500 font-medium",children:"Region"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-3 text-gray-500 font-medium",children:"kWh/kWp"})]})}),e.jsx("tbody",{children:l.ranking.map(j=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${j.rang===1?"bg-yellow-100 text-yellow-700":j.rang===2?"bg-gray-200 text-gray-700":j.rang===3?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-600"}`,children:j.rang})}),e.jsx("td",{className:"py-2 px-3 text-gray-900 dark:text-white",children:So[j.region]||j.region}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-600 dark:text-gray-400",children:j.kwp.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900 dark:text-white",children:j.wert.toFixed(0)})]},j.rang))})]})}),l.eigener_rang&&e.jsx("div",{className:"mt-4 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-center",children:e.jsxs("span",{className:"text-primary-700 dark:text-primary-300",children:["Dein Rang: ",e.jsxs("strong",{children:["#",l.eigener_rang]})," mit ",e.jsxs("strong",{children:[(b=l.eigener_wert)==null?void 0:b.toFixed(0)," kWh/kWp"]})]})})]})]})}function Ia({label:t,value:r,color:a}){return e.jsxs("div",{className:`p-4 rounded-lg bg-${a}-50 dark:bg-${a}-900/20`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t}),e.jsxs("p",{className:`text-2xl font-bold text-${a}-600 dark:text-${a}-400`,children:[r.toFixed(1),"%"]})]})}function Hs({label:t,value:r,suffix:a,icon:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s,e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:t})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:typeof r=="number"&&r>=1e3?r.toLocaleString("de-DE"):r.toFixed(r<10?1:0)}),a&&e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]})]})}function Gs({label:t,value:r,icon:a,capitalize:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a,e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t})]}),e.jsx("span",{className:`text-lg font-semibold text-gray-900 dark:text-white ${s?"capitalize":""}`,children:r})]})}function Eo({value:t,color:r}){const a={primary:"bg-primary-500",blue:"bg-blue-500"};return e.jsx("div",{className:"w-full bg-white/50 dark:bg-gray-700/50 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${a[r]} transition-all duration-500`,style:{width:`${Math.min(100,Math.max(0,t))}%`}})})}const Mo=[{value:"letzter_monat",label:"Letzter Monat",tooltip:"Daten des letzten vollstndigen Monats"},{value:"letzte_12_monate",label:"Letzte 12 Monate",tooltip:"Rollierender 12-Monats-Zeitraum bis heute"},{value:"letztes_vollstaendiges_jahr",label:"Letztes Jahr",tooltip:"Das letzte vollstndige Kalenderjahr"},{value:"seit_installation",label:"Seit Installation",tooltip:"Alle Daten seit Inbetriebnahme der Anlage"}];function m2(){var j,f,y;const t=lr(),[r,a]=m.useState("uebersicht"),[s,n]=m.useState("letzte_12_monate"),{anlagen:i,loading:l}=it(),[c,h]=m.useState(null),[g,o]=m.useState(null),[x,u]=m.useState(!0),d=c??((j=i[0])==null?void 0:j.id);if(m.useEffect(()=>{if(!d){u(!1);return}(async()=>{u(!0);try{const _=await Lt.get(d);o(_.community_hash||null)}catch{o(null)}finally{u(!1)}})()},[d]),l||x)return e.jsx(Se,{text:"Lade Community..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"}),e.jsx(te,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(!g)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Er,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"})]}),e.jsx(P,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ct,{className:"h-16 w-16 text-primary-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-3",children:"Teile erst deine Daten"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Um den Community-Vergleich nutzen zu knnen, musst du zuerst deine anonymisierten Anlagendaten mit der Community teilen. So knnen wir dir zeigen, wie deine Anlage im Vergleich zu anderen abschneidet."}),e.jsxs("button",{onClick:()=>t("/einstellungen/community"),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 font-medium",children:[e.jsx(Qr,{className:"h-5 w-5"}),"Jetzt teilen"]})]})})]});const p=[{key:"uebersicht",label:"bersicht",icon:Xr,hatZeitraum:!0},{key:"pv-ertrag",label:"PV-Ertrag",icon:ce,hatZeitraum:!0},{key:"komponenten",label:"Komponenten",icon:Ce,hatZeitraum:!0},{key:"regional",label:"Regional",icon:ht,hatZeitraum:!0},{key:"trends",label:"Trends",icon:Fe,hatZeitraum:!1},{key:"statistiken",label:"Statistiken",icon:Kt,hatZeitraum:!1}],b=((f=p.find(k=>k.key===r))==null?void 0:f.hatZeitraum)??!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Er,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Community"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i.length>1&&e.jsx("select",{value:d??"",onChange:k=>h(Number(k.target.value)),className:"input w-auto",children:i.map(k=>e.jsx("option",{value:k.id,children:k.anlagenname},k.id))}),b&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:s,onChange:k=>n(k.target.value),className:"input w-auto",children:Mo.map(k=>e.jsx("option",{value:k.value,children:k.label},k.value))}),e.jsx(Pn,{text:((y=Mo.find(k=>k.value===s))==null?void 0:y.tooltip)||"Betrachtungszeitraum whlen",children:e.jsx(tl,{className:"h-4 w-4 text-gray-400 cursor-help"})})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4 overflow-x-auto",children:p.map(k=>{const _=k.icon;return e.jsxs("button",{onClick:()=>a(k.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 whitespace-nowrap ${r===k.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(_,{className:"h-4 w-4"}),k.label]},k.key)})})})]}),d&&e.jsxs(e.Fragment,{children:[r==="uebersicht"&&e.jsx(Wx,{anlageId:d,zeitraum:s}),r==="pv-ertrag"&&e.jsx(Cx,{anlageId:d,zeitraum:s}),r==="komponenten"&&e.jsx(Px,{anlageId:d,zeitraum:s}),r==="regional"&&e.jsx(h2,{anlageId:d,zeitraum:s}),r==="trends"&&e.jsx(x2,{anlageId:d,zeitraum:s}),r==="statistiken"&&e.jsx(u2,{anlageId:d,zeitraum:s})]})]})}function p2(){return e.jsx(Ed,{children:e.jsx(Md,{children:e.jsxs(_e,{path:"/",element:e.jsx(Wh,{}),children:[e.jsx(_e,{index:!0,element:e.jsx(lt,{to:"/cockpit",replace:!0})}),e.jsx(_e,{path:"cockpit",element:e.jsx(Bh,{})}),e.jsx(_e,{path:"cockpit/pv-anlage",element:e.jsx(Uh,{})}),e.jsx(_e,{path:"cockpit/e-auto",element:e.jsx(Yh,{})}),e.jsx(_e,{path:"cockpit/waermepumpe",element:e.jsx(Qh,{})}),e.jsx(_e,{path:"cockpit/speicher",element:e.jsx(rg,{})}),e.jsx(_e,{path:"cockpit/wallbox",element:e.jsx(sg,{})}),e.jsx(_e,{path:"cockpit/balkonkraftwerk",element:e.jsx(lg,{})}),e.jsx(_e,{path:"cockpit/sonstiges",element:e.jsx(cg,{})}),e.jsx(_e,{path:"auswertungen",element:e.jsx(h0,{})}),e.jsx(_e,{path:"auswertungen/roi",element:e.jsx(wg,{})}),e.jsx(_e,{path:"auswertungen/prognose",element:e.jsx(_g,{})}),e.jsx(_e,{path:"auswertungen/export",element:e.jsx(h0,{})})," ",e.jsx(_e,{path:"aussichten",element:e.jsx(Ag,{})}),e.jsx(_e,{path:"community",element:e.jsx(m2,{})}),e.jsx(_e,{path:"einstellungen/anlage",element:e.jsx(Dg,{})}),e.jsx(_e,{path:"einstellungen/strompreise",element:e.jsx(Lg,{})}),e.jsx(_e,{path:"einstellungen/investitionen",element:e.jsx(Gg,{})}),e.jsx(_e,{path:"einstellungen/monatsdaten",element:e.jsx(Qg,{})}),e.jsx(_e,{path:"einstellungen/monatsabschluss",element:e.jsx(Un,{})}),e.jsx(_e,{path:"monatsabschluss/:anlageId",element:e.jsx(Un,{})}),e.jsx(_e,{path:"monatsabschluss/:anlageId/:jahr/:monat",element:e.jsx(Un,{})}),e.jsx(_e,{path:"einstellungen/import",element:e.jsx(k0,{})}),e.jsx(_e,{path:"einstellungen/demo",element:e.jsx(k0,{})})," ",e.jsx(_e,{path:"einstellungen/backup",element:e.jsx(rx,{})}),e.jsx(_e,{path:"einstellungen/solarprognose",element:e.jsx(sx,{})}),e.jsx(_e,{path:"einstellungen/pvgis",element:e.jsx(lt,{to:"/einstellungen/solarprognose",replace:!0})}),e.jsx(_e,{path:"einstellungen/datenerfassung",element:e.jsx(nx,{})}),e.jsx(_e,{path:"einstellungen/ha-import",element:e.jsx(lt,{to:"/einstellungen/datenerfassung",replace:!0})}),e.jsx(_e,{path:"einstellungen/ha-export",element:e.jsx(ix,{})}),e.jsx(_e,{path:"einstellungen/sensor-mapping",element:e.jsx(fx,{})}),e.jsx(_e,{path:"einstellungen/ha-statistik-import",element:e.jsx(_x,{})}),e.jsx(_e,{path:"einstellungen/allgemein",element:e.jsx(ax,{})}),e.jsx(_e,{path:"einstellungen/community",element:e.jsx(Ex,{})}),e.jsx(_e,{path:"auswertungen/community",element:e.jsx(lt,{to:"/community",replace:!0})}),e.jsx(_e,{path:"dashboard",element:e.jsx(lt,{to:"/cockpit",replace:!0})}),e.jsx(_e,{path:"anlagen",element:e.jsx(lt,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(_e,{path:"monatsdaten",element:e.jsx(lt,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(_e,{path:"strompreise",element:e.jsx(lt,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(_e,{path:"investitionen",element:e.jsx(lt,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(_e,{path:"auswertung",element:e.jsx(lt,{to:"/auswertungen",replace:!0})}),e.jsx(_e,{path:"roi",element:e.jsx(lt,{to:"/auswertungen/roi",replace:!0})}),e.jsx(_e,{path:"e-auto",element:e.jsx(lt,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(_e,{path:"waermepumpe",element:e.jsx(lt,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(_e,{path:"speicher",element:e.jsx(lt,{to:"/cockpit/speicher",replace:!0})}),e.jsx(_e,{path:"wallbox",element:e.jsx(lt,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(_e,{path:"balkonkraftwerk",element:e.jsx(lt,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(_e,{path:"sonstiges",element:e.jsx(lt,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(_e,{path:"import",element:e.jsx(lt,{to:"/einstellungen/import",replace:!0})}),e.jsx(_e,{path:"settings",element:e.jsx(lt,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function b2({onNext:t,onLoadDemo:r,onImportComplete:a}){const[s,n]=m.useState(!1),[i,l]=m.useState(null),[c,h]=m.useState(!1),[g,o]=m.useState(null),[x,u]=m.useState(null),d=m.useRef(null),p=async()=>{if(r){n(!0),l(null);try{await r()}catch(f){l(f instanceof Error?f.message:"Fehler beim Laden der Demo-Daten"),n(!1)}}},b=async f=>{var k;const y=(k=f.target.files)==null?void 0:k[0];if(y){h(!0),o(null),u(null);try{const _=await Jt.importJSON(y,!1);u(`Anlage "${_.anlage_name}" erfolgreich importiert!`),setTimeout(()=>{a==null||a()},1500)}catch(_){o(_ instanceof Error?_.message:"Fehler beim Importieren")}finally{h(!1),d.current&&(d.current.value="")}}},j=()=>{var f;(f=d.current)==null||f.click()};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(ce,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persnliches Energie Effizienz Data Center fr die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(di,{icon:e.jsx(Kt,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(di,{icon:e.jsx(ta,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen fr alle Ihre Energie-Investitionen"}),e.jsx(di,{icon:e.jsx(Fe,{className:"w-6 h-6"}),title:"Prognosen",description:"Wetterbasierte Vorhersagen und PVGIS-Vergleiche"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(Zs,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(Zs,{number:2,text:"Stromtarif konfigurieren (mit Vorschlgen)"}),e.jsx(Zs,{number:3,text:"Wechselrichter und PV-Module erfassen"}),e.jsx(Zs,{number:4,text:"Optional: Speicher, Wrmepumpe, E-Auto hinzufgen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(ot,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Haben Sie eine JSON-Sicherung? Stellen Sie Ihre Daten wieder her:"}),e.jsx("input",{ref:d,type:"file",accept:".json",onChange:b,className:"hidden"}),e.jsx("button",{onClick:j,disabled:c,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium rounded-xl hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all disabled:opacity-50",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-5 h-5 animate-spin"}),"Importiere..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"w-5 h-5"}),"JSON-Backup importieren"]})}),g&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:g}),x&&e.jsx("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:x}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Importiert Anlage, Strompreise, Investitionen, Monatsdaten und Sensor-Mapping"})]}),r&&e.jsxs("div",{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:p,disabled:s,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oh,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),i&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:i}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enthlt 24 Monate Beispieldaten, Wechselrichter, PV-Module, Speicher, Wrmepumpe u.v.m."})]})]})]})}function di({icon:t,title:r,description:a}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a})]})}function Zs({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}function f2({isLoading:t,error:r,onSubmit:a,onGeocode:s,onBack:n}){const[i,l]=m.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:""}),[c,h]=m.useState(null),[g,o]=m.useState(!1),[x,u]=m.useState(!1),d=f=>{const{name:y,value:k}=f.target;l(_=>({..._,[y]:k})),h(null),(y==="standort_plz"||y==="standort_ort")&&u(!1)},p=async()=>{if(!i.standort_plz){h("Bitte geben Sie eine PLZ ein");return}o(!0),h(null),u(!1);try{const f=await s(i.standort_plz,i.standort_ort||void 0);f?(l(y=>({...y,latitude:f.latitude.toFixed(6),longitude:f.longitude.toFixed(6)})),u(!0)):h("Koordinaten konnten nicht ermittelt werden. Bitte prfen Sie PLZ/Ort.")}catch{h("Fehler beim Ermitteln der Koordinaten")}finally{o(!1)}},b=async f=>{if(f.preventDefault(),h(null),!i.anlagenname.trim()){h("Bitte geben Sie einen Namen fr Ihre Anlage ein");return}if(!i.leistung_kwp||parseFloat(i.leistung_kwp)<=0){h("Bitte geben Sie die Anlagenleistung in kWp ein");return}await a({anlagenname:i.anlagenname.trim(),leistung_kwp:parseFloat(i.leistung_kwp),installationsdatum:i.installationsdatum||void 0,standort_plz:i.standort_plz||void 0,standort_ort:i.standort_ort||void 0,latitude:i.latitude?parseFloat(i.latitude):void 0,longitude:i.longitude?parseFloat(i.longitude):void 0})},j=c||r;return e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),j&&e.jsx(te,{type:"error",className:"mb-6",children:j}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:i.anlagenname,onChange:d,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:i.leistung_kwp,onChange:d,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx($t,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:i.installationsdatum,onChange:d,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Fr korrekten Start der Stromtarif-Gltigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(ht,{className:"w-4 h-4 text-gray-500"}),"Standort (fr PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:i.standort_plz,onChange:d,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:i.standort_ort,onChange:d,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:p,disabled:g||!i.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):x?e.jsxs(e.Fragment,{children:[e.jsx(Nr,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ho,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:i.latitude,onChange:d,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Lngengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:i.longitude,onChange:d,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden fr die PVGIS-Ertragsprognose bentigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]}),e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-300 flex items-start gap-2",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:["Steuerliche Einstellungen (Regelbesteuerung/Kleinunternehmer) knnen unter ",e.jsx("strong",{children:"Einstellungen  Anlage bearbeiten"})," konfiguriert werden."]})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(es,{className:"w-4 h-4"}),"Zurck"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(ot,{className:"w-4 h-4"})]})})]})]})}function y2({anlage:t,isLoading:r,error:a,onSubmit:s,onUseDefaults:n,onBack:i}){const l=t?Qo(t.leistung_kwp):Ur.einspeiseverguetung_cent_kwh,[c,h]=m.useState({netzbezug_arbeitspreis_cent_kwh:Ur.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:l.toString(),grundpreis_euro_monat:Ur.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[g,o]=m.useState(null),x=p=>{const{name:b,value:j}=p.target;h(f=>({...f,[b]:j})),o(null)},u=async p=>{if(p.preventDefault(),o(null),!c.netzbezug_arbeitspreis_cent_kwh||parseFloat(c.netzbezug_arbeitspreis_cent_kwh)<0){o("Bitte geben Sie einen gltigen Netzbezugspreis ein");return}if(!c.gueltig_ab){o("Bitte geben Sie ein Gltigkeitsdatum ein");return}await s({netzbezug_arbeitspreis_cent_kwh:parseFloat(c.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(c.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:c.grundpreis_euro_monat?parseFloat(c.grundpreis_euro_monat):void 0,gueltig_ab:c.gueltig_ab,tarifname:c.tarifname||void 0,anbieter:c.anbieter||void 0})},d=g||a;return e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Fr korrekte Wirtschaftlichkeitsberechnungen"})]})]}),d&&e.jsx(te,{type:"error",className:"mb-6",children:d}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:n,disabled:r,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(ga,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[Ur.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",l," ct Einspeisung |"," ",Ur.grundpreis_euro_monat,"  Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:c.netzbezug_arbeitspreis_cent_kwh,onChange:x,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergtung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:c.einspeiseverguetung_cent_kwh,onChange:x,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:c.grundpreis_euro_monat,onChange:x,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gltig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:c.gueltig_ab,onChange:x,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:c.tarifname,onChange:x,placeholder:"z.B. kostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:c.anbieter,onChange:x,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie knnen spter weitere Stromtarife mit unterschiedlichen Gltigkeitszeitrumen hinzufgen, z.B. bei Tarifwechsel oder Preisnderungen. Spezialtarife fr Warmepumpe oder Wallbox knnen ebenfalls unter Strompreise angelegt werden."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(es,{className:"w-4 h-4"}),"Zurck"]}),e.jsx("button",{type:"submit",disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(ot,{className:"w-4 h-4"})]})})]})]})}function Qa(t){switch(t){case"e-auto":return e.jsx(Te,{className:"w-5 h-5"});case"speicher":return e.jsx(Ce,{className:"w-5 h-5"});case"wallbox":return e.jsx(Ht,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(An,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(et,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(ce,{className:"w-5 h-5"});default:return e.jsx(To,{className:"w-5 h-5"})}}function j2({investition:t,allInvestitionen:r,anlage:a,onUpdate:s,onDelete:n,isNew:i=!1}){const[l,c]=m.useState(!0);m.useEffect(()=>{i&&c(!0)},[i]);const[h,g]=m.useState(!1),o=Lh[t.typ],x=o?r.filter(b=>b.typ===o&&b.id!==t.id):[],u=b=>{var j;return(j=t.parameter)==null?void 0:j[b]},d=b=>{var j;return((j=t.parameter)==null?void 0:j[b])===!0},p=(b,j)=>{s({parameter:{...t.parameter,[b]:j}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>c(!l),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:Qa(t.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung||rr[t.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[rr[t.typ],t.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:[" ",t.anschaffungskosten_gesamt.toLocaleString("de-DE")," "]}):null]})]}),l?e.jsx(Mr,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(Yt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),l&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:t.bezeichnung,onChange:b=>s({bezeichnung:b.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:t.anschaffungsdatum||"",onChange:b=>s({anschaffungsdatum:b.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis () *"}),e.jsx("input",{type:"number",value:t.anschaffungskosten_gesamt??"",onChange:b=>s({anschaffungskosten_gesamt:parseFloat(b.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),o&&e.jsx("div",{children:(()=>{const b=Ih.includes(t.typ),j=x.length>0,f=b&&!t.parent_investition_id&&j;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehrt zu (",rr[o],")",b?" *":" (optional)"]}),j?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.parent_investition_id||"",onChange:y=>s({parent_investition_id:y.target.value?parseInt(y.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${f?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:b?"-- Bitte whlen --":"-- Keine Zuordnung --"}),x.map(y=>e.jsx("option",{value:y.id,children:y.bezeichnung},y.id))]}),f&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(ct,{className:"w-4 h-4"}),"PV-Module mssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 flex-shrink-0"}),b?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen knnen."]}):e.jsxs("span",{children:["Kein ",rr[o]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),t.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW) *"}),e.jsx("input",{type:"number",value:u("leistung_kw")??"",onChange:b=>p("leistung_kw",parseFloat(b.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:t.leistung_kwp??"",onChange:b=>s({leistung_kwp:parseFloat(b.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.01",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:t.ausrichtung||(a==null?void 0:a.ausrichtung)||"",onChange:b=>s({ausrichtung:b.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Whlen --"}),e.jsx("option",{value:"Sd",children:"Sd (0)"}),e.jsx("option",{value:"Sdost",children:"Sdost (-45)"}),e.jsx("option",{value:"Ost",children:"Ost (-90)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135)"}),e.jsx("option",{value:"Nord",children:"Nord (180)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135)"}),e.jsx("option",{value:"West",children:"West (90)"}),e.jsx("option",{value:"Sdwest",children:"Sdwest (45)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:t.neigung_grad??(a==null?void 0:a.neigung_grad)??"",onChange:b=>s({neigung_grad:parseFloat(b.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="speicher"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazitt (kWh) *"}),e.jsx("input",{type:"number",value:u("kapazitaet_kwh")??"",onChange:b=>p("kapazitaet_kwh",parseFloat(b.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("arbitrage"),onChange:b=>p("arbitrage",b.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Arbitrage"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Netzstrom gnstig laden, teuer einspeisen"})]})]})})]}),t.typ==="wallbox"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW) *"}),e.jsx("input",{type:"number",value:u("leistung_kw")??"",onChange:b=>p("leistung_kw",parseFloat(b.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("v2h"),onChange:b=>p("v2h",b.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-fhig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Bidirektionales Laden (Vehicle-to-Home)"})]})]})})]}),t.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazitt (kWh) *"}),e.jsx("input",{type:"number",value:u("batterie_kwh")??"",onChange:b=>p("batterie_kwh",parseFloat(b.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km) *"}),e.jsx("input",{type:"number",value:u("verbrauch_kwh_100km")??"",onChange:b=>p("verbrauch_kwh_100km",parseFloat(b.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("div",{className:"md:col-span-2 flex items-center",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("v2h"),onChange:b=>p("v2h",b.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"V2H-fhig"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Fahrzeug kann Strom ans Haus abgeben (Vehicle-to-Home)"})]})]})})]}),t.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW) *"}),e.jsx("input",{type:"number",value:u("leistung_kw")??"",onChange:b=>p("leistung_kw",parseFloat(b.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl) *"}),e.jsx("input",{type:"number",value:u("cop")??"3.5",onChange:b=>p("cop",parseFloat(b.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung pro Modul (Wp) *"}),e.jsx("input",{type:"number",value:u("leistung_wp")??"",onChange:b=>p("leistung_wp",parseFloat(b.target.value)||void 0),placeholder:"z.B. 400",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module *"}),e.jsx("input",{type:"number",value:u("anzahl")??"",onChange:b=>p("anzahl",parseInt(b.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung *"}),e.jsxs("select",{value:u("ausrichtung")||"",onChange:b=>p("ausrichtung",b.target.value||void 0),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Whlen --"}),e.jsx("option",{value:"Sd",children:"Sd (0)"}),e.jsx("option",{value:"Sdost",children:"Sdost (-45)"}),e.jsx("option",{value:"Ost",children:"Ost (-90)"}),e.jsx("option",{value:"West",children:"West (90)"}),e.jsx("option",{value:"Sdwest",children:"Sdwest (45)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad) *"}),e.jsx("input",{type:"number",value:u("neigung_grad")??"",onChange:b=>p("neigung_grad",parseFloat(b.target.value)||void 0),placeholder:"z.B. 30",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"0 = flach, 90 = senkrecht (Balkon)"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d("hat_speicher"),onChange:b=>p("hat_speicher",b.target.checked),className:"w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-amber-500 focus:ring-amber-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mit Speicher"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"z.B. Anker SOLIX, Zendure, EcoFlow"})]})]}),d("hat_speicher")&&e.jsxs("div",{className:"mt-3 ml-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Speicher-Kapazitt (Wh) *"}),e.jsx("input",{type:"number",value:u("speicher_kapazitaet_wh")??"",onChange:b=>p("speicher_kapazitaet_wh",parseFloat(b.target.value)||void 0),placeholder:"z.B. 1600",min:"0",step:"100",className:"w-full max-w-xs px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"z.B. 1600 Wh fr Anker SOLIX"})]})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:h?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich lschen?"}),e.jsx("button",{type:"button",onClick:()=>{n(),g(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, lschen"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>g(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(Mt,{className:"w-4 h-4"}),"Investition lschen"]})})]})]})}function Wo({onAdd:t}){const[r,a]=m.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>a(!r),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Wr,{className:"w-5 h-5"}),"Investition hinzufgen"]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:ec.map(s=>e.jsxs("button",{type:"button",onClick:()=>{t(s),a(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Qa(s)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:rr[s]})]},s))})]})]})}function k2({investitionen:t,anlage:r,isLoading:a,error:s,onUpdateInvestition:n,onDeleteInvestition:i,onAddInvestition:l,onCreateDefaultPVSystem:c,onNext:h,onBack:g}){const[o,x]=m.useState(null),[u,d]=m.useState(null),p=m.useRef(null);m.useEffect(()=>{if(u&&p.current){p.current.scrollIntoView({behavior:"smooth",block:"center"});const f=setTimeout(()=>d(null),2e3);return()=>clearTimeout(f)}},[u]);const b=ec.reduce((f,y)=>{const k=t.filter(_=>_.typ===y);return k.length>0&&f.push({typ:y,items:k}),f},[]),j=async f=>{x(f);try{const y=await l(f);y!=null&&y.id&&d(y.id)}finally{x(null)}};return t.length===0&&!a?e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(ce,{className:"w-8 h-8 text-amber-600 dark:text-amber-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"PV-System einrichten"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:"Erfassen Sie Ihre PV-Komponenten fr die Ertragsanalyse und ROI-Berechnung."})]}),c&&e.jsx("div",{className:"mb-8",children:e.jsx("button",{type:"button",onClick:c,disabled:a,className:"w-full p-6 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-amber-200 dark:border-amber-800 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-all group",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-amber-500 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform",children:e.jsx(ce,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg",children:"PV-System anlegen (empfohlen)"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Erstellt automatisch Wechselrichter + PV-Module mit ",(r==null?void 0:r.leistung_kwp)||0," kWp"]})]}),e.jsx(ot,{className:"w-5 h-5 text-amber-500 group-hover:translate-x-1 transition-transform"})]})})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder einzeln hinzufgen"})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-6",children:["balkonkraftwerk","speicher","wallbox","waermepumpe","e-auto"].map(f=>e.jsxs("button",{type:"button",onClick:()=>j(f),disabled:o!==null,className:"p-4 border border-gray-200 dark:border-gray-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10 transition-all text-center",children:[e.jsx("div",{className:"w-10 h-10 mx-auto mb-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center text-gray-600 dark:text-gray-400",children:Qa(f)}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:rr[f]})]},f))}),e.jsx("div",{className:"text-center",children:e.jsx(Wo,{onAdd:j})}),o&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400 text-center",children:["Fge ",rr[o]," hinzu..."]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(es,{className:"w-4 h-4"}),"Zurck"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 px-6 py-2.5 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:["berspringen",e.jsx(ot,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollstndigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergnzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden fr die ROI-Berechnung bentigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length," Investition",t.length!==1?"en":""]})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(ct,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:s})]}),a&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!a&&e.jsxs("div",{className:"space-y-6",children:[b.map(({typ:f,items:y})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Qa(f)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[rr[f]," (",y.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:y.map(k=>e.jsx("div",{ref:k.id===u?p:void 0,className:`transition-all duration-500 ${k.id===u?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(j2,{investition:k,allInvestitionen:t,anlage:r,onUpdate:_=>n(k.id,_),onDelete:()=>i(k.id),isNew:k.id===u})},k.id))})]},f)),e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Wr,{className:"w-4 h-4 text-amber-500"}),"Weitere Komponenten hinzufgen"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-4",children:["speicher","wallbox","waermepumpe","e-auto","balkonkraftwerk"].map(f=>{const y=t.some(k=>k.typ===f);return e.jsxs("button",{type:"button",onClick:()=>j(f),disabled:o!==null,className:`p-3 border rounded-xl transition-all text-center ${y?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-amber-400 dark:hover:border-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/10"}`,children:[e.jsx("div",{className:`w-8 h-8 mx-auto mb-1 rounded-lg flex items-center justify-center ${y?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:Qa(f)}),e.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[rr[f],y&&" "]})]},f)})}),e.jsx(Wo,{onAdd:j}),o&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["Fge ",rr[o]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(nt,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig fr die Amortisationsberechnung. Sie knnen alle Angaben spter jederzeit unter Einstellungen  Investitionen ndern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(es,{className:"w-4 h-4"}),"Zurck"]}),e.jsxs("button",{type:"button",onClick:h,disabled:a,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(ot,{className:"w-4 h-4"})]})]})]})}function v2(t){switch(t){case"e-auto":return e.jsx(Te,{className:"w-4 h-4"});case"speicher":return e.jsx(Ce,{className:"w-4 h-4"});case"wallbox":return e.jsx(Ht,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(An,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(et,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(ce,{className:"w-4 h-4"});default:return e.jsx(To,{className:"w-4 h-4"})}}function w2({anlage:t,strompreis:r,investitionen:a,pvgisPrognose:s,pvgisError:n,canFetchPvgis:i,isLoading:l,onFetchPvgis:c,onComplete:h,onBack:g}){const[o,x]=m.useState(!1),u=!!t,d=!!r,p=a.length>0,b=!!s,j=a.reduce((y,k)=>y+(k.anschaffungskosten_gesamt||0),0),f=async()=>{x(!0);try{await c()}finally{x(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(Nr,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschlieen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"berprfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Js,{icon:e.jsx(ce,{className:"w-5 h-5"}),title:"PV-Anlage",status:u?"success":"warning",children:u?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&`  ${t.standort_ort}`,t.latitude&&t.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(Js,{icon:e.jsx(Ne,{className:"w-5 h-5"}),title:"Stromtarif",status:d?"success":"warning",children:d?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:r.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:r.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),r.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.tarifname,r.anbieter&&` (${r.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollstndig"})}),e.jsx(Js,{icon:e.jsx(An,{className:"w-5 h-5"}),title:"Investitionen",status:p?"success":"neutral",children:p?e.jsxs("div",{className:"space-y-2",children:[a.slice(0,5).map(y=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:v2(y.typ)}),e.jsx("span",{className:"truncate",children:y.bezeichnung}),y.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[y.anschaffungskosten_gesamt.toLocaleString("de-DE")," "]}):null]},y.id)),a.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",a.length-5," weitere"]}),j>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",j.toLocaleString("de-DE")," "]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - knnen spter hinzugefgt werden"})}),e.jsx(Js,{icon:e.jsx(Yl,{className:"w-5 h-5"}),title:"PVGIS Ertragsprognose",status:b?"success":i?"neutral":"warning",children:b?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[Math.round(s.jahresertrag_kwh).toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp",e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(PVGIS-Daten gespeichert)"})]})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ertragsprognose von PVGIS abrufen fr SOLL-IST Vergleiche"}),n&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm",children:n}),e.jsx("button",{type:"button",onClick:f,disabled:o||l,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50",children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4 animate-spin"}),"Rufe PVGIS ab..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Yl,{className:"w-4 h-4"}),"PVGIS-Prognose abrufen"]})})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400 text-sm",children:!(t!=null&&t.latitude)||!(t!=null&&t.longitude)?"Koordinaten fehlen - bitte Standort mit PLZ ermitteln":"PV-Module fehlen - bitte unter Komponenten anlegen"})})]}),e.jsx(N2,{hasPvgis:b,investitionen:a})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(es,{className:"w-4 h-4"}),"Zurck"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:[e.jsx(ea,{className:"w-5 h-5"}),"Weiter zur Datenerfassung"]})]})]})}function Js({icon:t,title:r,status:a,children:s}){const n={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${n[a]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[a]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r}),a==="success"&&e.jsx(Nr,{className:"w-4 h-4 text-green-500"}),a==="warning"&&e.jsx(ct,{className:"w-4 h-4 text-amber-500"})]}),s]})]})})}function N2({hasPvgis:t,investitionen:r}){const a=r.some(n=>n.typ==="wechselrichter"),s=r.some(n=>n.typ==="pv-module");return e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(nt,{className:"w-4 h-4 text-blue-500"}),"Wie geht es weiter?"]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ea,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white mb-1",children:"Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Zhlerstnde (Einspeisung, Netzbezug) und Verbrauchsdaten der Komponenten. Sie knnen die Daten manuell eingeben oder eine CSV-Datei importieren."})]})]})}),(!s||!a)&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," ",!s&&!a?"Wechselrichter und PV-Module fehlen noch.":s?"Wechselrichter fehlt noch.":"PV-Module fehlen noch."," Diese knnen Sie jederzeit unter Einstellungen  Investitionen ergnzen."]})}),!t&&s&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Tipp:"})," Rufen Sie oben die PVGIS-Prognose ab, um spter SOLL-IST Vergleiche Ihrer PV-Ertrge zu sehen."]})})]})}function _2({anlage:t,onGoToDashboard:r}){const a=()=>{r(),setTimeout(()=>{window.location.href="/einstellungen/monatsdaten"},100)};return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(ce,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(ih,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6 mb-8 max-w-md mx-auto text-left border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ea,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"Nchster Schritt: Monatsdaten erfassen"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Erfassen Sie Ihre monatlichen Zhlerstnde (Einspeisung, Netzbezug) und Verbrauchsdaten. Die Daten knnen manuell eingegeben oder per CSV importiert werden."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:[e.jsx(ea,{className:"w-5 h-5"}),"Monatsdaten erfassen"]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center justify-center gap-3 px-6 py-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(rl,{className:"w-5 h-5"}),"Zum Cockpit"]})]})]})}const da=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"investitionen",label:"Komponenten",shortLabel:"Komp."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function z2({onComplete:t}){var l;const r=Vh(),a=async()=>{await Jt.createDemoData(),t()},s=()=>{t()};m.useEffect(()=>{if(r.step==="complete"){const c=setTimeout(t,100);return()=>clearTimeout(c)}},[r.step,t]);const n=da.findIndex(c=>c.key===r.step),i=r.step!=="welcome"&&r.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:Yo,alt:"eedc",className:"w-10 h-10"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),i&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",n+1," von ",da.length]})]})})}),i&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:da.map((c,h)=>{const g=h<n,o=h===n;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${g?"bg-green-500 text-white":o?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:g?e.jsx(Nr,{className:"w-5 h-5"}):h+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${o?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:c.label})]}),h<da.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${g?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},c.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(l=da[n])==null?void 0:l.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n+1,"/",da.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${r.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[r.step==="welcome"&&e.jsx(b2,{onNext:r.nextStep,onLoadDemo:a,onImportComplete:s}),r.step==="anlage"&&e.jsx(f2,{isLoading:r.isLoading,error:r.error,onSubmit:r.createAnlage,onGeocode:r.geocodeAddress,onBack:r.prevStep}),r.step==="strompreise"&&e.jsx(y2,{anlage:r.anlage,isLoading:r.isLoading,error:r.error,onSubmit:r.createStrompreis,onUseDefaults:r.useDefaultStrompreise,onBack:r.prevStep}),r.step==="investitionen"&&e.jsx(k2,{investitionen:r.investitionen,anlage:r.anlage,isLoading:r.isLoading,error:r.error,onUpdateInvestition:r.updateInvestition,onDeleteInvestition:r.deleteInvestition,onAddInvestition:r.addInvestition,onCreateDefaultPVSystem:r.createDefaultPVSystem,onNext:r.nextStep,onBack:r.prevStep}),r.step==="summary"&&e.jsx(w2,{anlage:r.anlage,strompreis:r.strompreis,investitionen:r.investitionen,pvgisPrognose:r.pvgisPrognose,pvgisError:r.pvgisError,canFetchPvgis:r.canFetchPvgis,isLoading:r.isLoading,onFetchPvgis:r.fetchPvgisPrognose,onComplete:r.completeWizard,onBack:r.prevStep}),r.step==="complete"&&e.jsx(_2,{anlage:r.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc  Energie Effizienz Data Center"})]})}const hi="eedc_setup_wizard_completed";function S2({children:t}){const[r,a]=m.useState(!0),[s,n]=m.useState(!1);m.useEffect(()=>{i()},[]);const i=async()=>{try{(await Lt.list()).length===0?(localStorage.removeItem(hi),localStorage.removeItem("eedc_setup_wizard_state"),n(!0)):(localStorage.setItem(hi,"true"),n(!1))}catch(c){console.error("Fehler beim Prfen des Setup-Status:",c),n(!1)}finally{a(!1)}},l=()=>{localStorage.setItem(hi,"true"),n(!1)};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):s?e.jsx(z2,{onComplete:l}):e.jsx(e.Fragment,{children:t})}xi.createRoot(document.getElementById("root")).render(e.jsx(st.StrictMode,{children:e.jsx(fh,{children:e.jsx(S2,{children:e.jsx(p2,{})})})}));
