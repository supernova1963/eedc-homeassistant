var Ma=Object.defineProperty;var $a=(t,a,r)=>a in t?Ma(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;var Or=(t,a,r)=>$a(t,typeof a!="symbol"?a+"":a,r);import{r as d,a as Aa,u as ca,N as mr,O as La,b as Ut,H as Da,d as Ia,e as de,f as $e,R as Pa}from"./vendor-DpDmk0XN.js";import{R as ee,B as Fe,C as ce,X as oe,Y as ne,T as te,a as Y,b as Ce,A as gt,L as we,c as Ve,P as nt,d as it,e as fr,f as Qe,g as lt,h as Va}from"./charts-CRPigxjo.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&s(x)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var oa={exports:{}},Zt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ka=d,Ba=Symbol.for("react.element"),Oa=Symbol.for("react.fragment"),Ta=Object.prototype.hasOwnProperty,Ha=Ka.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ra={key:!0,ref:!0,__self:!0,__source:!0};function ga(t,a,r){var s,n={},i=null,x=null;r!==void 0&&(i=""+r),a.key!==void 0&&(i=""+a.key),a.ref!==void 0&&(x=a.ref);for(s in a)Ta.call(a,s)&&!Ra.hasOwnProperty(s)&&(n[s]=a[s]);if(t&&t.defaultProps)for(s in a=t.defaultProps,a)n[s]===void 0&&(n[s]=a[s]);return{$$typeof:Ba,type:t,key:i,ref:x,props:n,_owner:Ha.current}}Zt.Fragment=Oa;Zt.jsx=ga;Zt.jsxs=ga;oa.exports=Zt;var e=oa.exports,ur={},Tr=Aa;ur.createRoot=Tr.createRoot,ur.hydrateRoot=Tr.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ga={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),P=(t,a)=>{const r=d.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:x,className:c="",children:l,...o},g)=>d.createElement("svg",{ref:g,...Ga,width:n,height:n,stroke:s,strokeWidth:x?Number(i)*24/Number(n):i,className:["lucide",`lucide-${qa(t)}`,c].join(" "),...o},[...a.map(([p,y])=>d.createElement(p,y)),...Array.isArray(l)?l:[l]]));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=P("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=P("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=P("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=P("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=P("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=P("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=P("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=P("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=P("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=P("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=P("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=P("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=P("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=P("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=P("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=P("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=P("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=P("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=P("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=P("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=P("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=P("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ua=P("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=P("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=P("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=P("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=P("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=P("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=P("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=P("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=P("FileCode",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=P("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=P("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=P("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=P("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=P("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=P("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=P("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=P("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=P("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=P("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=P("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=P("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=P("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=P("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=P("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=P("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=P("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=P("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=P("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=P("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=P("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=P("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=P("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=P("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=P("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=P("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=P("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=P("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=P("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=P("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=P("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=P("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=P("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=P("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=P("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=P("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=P("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=P("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=P("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=P("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=P("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=P("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=P("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=P("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=P("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=P("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=P("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=P("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=P("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),wa=d.createContext(void 0);function xs({children:t}){const[a,r]=d.useState(()=>localStorage.getItem("eedc-theme")||"system"),[s,n]=d.useState(!1);return d.useEffect(()=>{localStorage.setItem("eedc-theme",a);const i=window.document.documentElement;if(a==="system"){const x=window.matchMedia("(prefers-color-scheme: dark)").matches;n(x),i.classList.toggle("dark",x)}else n(a==="dark"),i.classList.toggle("dark",a==="dark")},[a]),d.useEffect(()=>{if(a!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),x=c=>{n(c.matches),document.documentElement.classList.toggle("dark",c.matches)};return i.addEventListener("change",x),()=>i.removeEventListener("change",x)},[a]),e.jsx(wa.Provider,{value:{theme:a,setTheme:r,isDark:s},children:t})}function Na(){const t=d.useContext(wa);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const hs=[{name:"Cockpit",basePath:"/cockpit"},{name:"Auswertungen",basePath:"/auswertungen"}],ms=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Import",href:"/einstellungen/import"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"PVGIS",href:"/einstellungen/pvgis"},{name:"HA Integration",href:"/einstellungen/ha-integration"},{name:"HA Export",href:"/einstellungen/ha-export"},{name:"Allgemein",href:"/einstellungen/allgemein"}]}];function us(){const{theme:t,setTheme:a}=Na(),r=ca(),[s,n]=d.useState(!1),i=d.useRef(null),c=r.pathname.startsWith("/cockpit")?"Cockpit":r.pathname.startsWith("/auswertungen")?"Auswertungen":r.pathname.startsWith("/einstellungen")?null:"Cockpit";d.useEffect(()=>{const g=p=>{i.current&&!i.current.contains(p.target)&&n(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const l=()=>{a(t==="light"?"dark":t==="dark"?"system":"light")},o=g=>r.pathname===g;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"h-8 w-8 text-yellow-500",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"})]}),e.jsx("nav",{className:"ml-10 flex space-x-1",children:hs.map(g=>e.jsx(mr,{to:g.basePath,className:()=>`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===g.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:g.name},g.name))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(X,{className:"h-5 w-5"}),t==="dark"&&e.jsx(ya,{className:"h-5 w-5"}),t==="system"&&e.jsx(ba,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>n(!s),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${r.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(Jt,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(Yt,{className:`h-4 w-4 transition-transform ${s?"rotate-180":""}`})]}),s&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:ms.map((g,p)=>e.jsxs("div",{children:[p>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:g.category})}),g.items.map(y=>e.jsx(mr,{to:y.href,onClick:()=>n(!1),className:`block px-4 py-2 text-sm transition-colors ${o(y.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:y.name},y.href))]},g.category))})]})]})]})})})}const ps=[{name:"Übersicht",href:"/cockpit",icon:ts,exact:!0},{name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:X},{name:"E-Auto",href:"/cockpit/e-auto",icon:ve},{name:"Wärmepumpe",href:"/cockpit/waermepumpe",icon:_e},{name:"Speicher",href:"/cockpit/speicher",icon:ke},{name:"Wallbox",href:"/cockpit/wallbox",icon:rt},{name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:X},{name:"Sonstiges",href:"/cockpit/sonstiges",icon:jr}],bs=[],ys=[{name:"Anlage",href:"/einstellungen/anlage",icon:Ue},{name:"Strompreise",href:"/einstellungen/strompreise",icon:ge},{name:"Investitionen",href:"/einstellungen/investitionen",icon:_t},{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:ua},{name:"Import/Export",href:"/einstellungen/import",icon:va},{name:"PVGIS",href:"/einstellungen/pvgis",icon:X},{name:"HA-Import",href:"/einstellungen/ha-import",icon:tt},{name:"HA-Export",href:"/einstellungen/ha-export",icon:ka},{name:"Allgemein",href:"/einstellungen/allgemein",icon:Jt}];function ks(){const t=ca(),r=t.pathname.startsWith("/cockpit")?ps:t.pathname.startsWith("/auswertungen")?bs:t.pathname.startsWith("/einstellungen")?ys:null;return r?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:r.map(s=>e.jsxs(mr,{to:s.href,end:s.exact,className:({isActive:n})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${n?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(s.icon,{className:"h-4 w-4"}),s.name]},s.href))})})}):null}const js="0.9.8",fs="eedc",vs="Energie Effizienz Data Center",ws=`${fs} v${js} – ${vs}`;function Ns(){return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[e.jsx(us,{}),e.jsx(ks,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(La,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:ws})})]})}const Z=d.forwardRef(({className:t="",variant:a="primary",size:r="md",loading:s,disabled:n,children:i,...x},c)=>{const l="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",o={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},g={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:c,className:`${l} ${o[a]} ${g[r]} ${t}`,disabled:n||s,...x,children:[s&&e.jsx(Re,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});Z.displayName="Button";const G=d.forwardRef(({className:t="",label:a,error:r,hint:s,id:n,...i},x)=>{const c=n||i.name;return e.jsxs("div",{className:"w-full",children:[a&&e.jsxs("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:x,id:c,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${r?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...i}),s&&!r&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:s}),r&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r})]})});G.displayName="Input";const He=d.forwardRef(({className:t="",label:a,error:r,options:s,placeholder:n,id:i,...x},c)=>{const l=i||x.name;return e.jsxs("div",{className:"w-full",children:[a&&e.jsxs("label",{htmlFor:l,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[a,x.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:c,id:l,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${r?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...x,children:[n&&e.jsx("option",{value:"",children:n}),s.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),r&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r})]})});He.displayName="Select";function qe({isOpen:t,onClose:a,title:r,children:s,size:n="md"}){if(d.useEffect(()=>{const x=c=>{c.key==="Escape"&&a()};return t&&(document.addEventListener("keydown",x),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",x),document.body.style.overflow=""}},[t,a]),!t)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:a}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[n]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r}),e.jsx("button",{onClick:a,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(zr,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:s})]})})]})}function A({children:t,className:a="",padding:r="md"}){const s={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${s[r]}
        ${a}
      `,children:t})}function le({type:t,title:a,children:r,onClose:s,className:n=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:Be},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:et},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:We},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:Xt}},{bg:x,border:c,text:l,icon:o}=i[t];return e.jsx("div",{className:`${x} ${c} border rounded-lg p-4 relative ${n}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{className:`w-5 h-5 ${l} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[a&&e.jsx("h4",{className:`text-sm font-medium ${l}`,children:a}),e.jsx("div",{className:`text-sm ${l} ${a?"mt-1":""}`,children:r})]}),s&&e.jsx("button",{onClick:s,className:`ml-3 ${l} hover:opacity-70 transition-opacity`,children:e.jsx(zr,{className:"w-4 h-4"})})]})})}function Sr({children:t,className:a=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${a}`,children:t})})}function Er({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function Fr({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function St({children:t,onClick:a,className:r=""}){return e.jsx("tr",{className:`${a?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${r}`,onClick:a,children:t})}function Ae({children:t,className:a=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${a}`,children:t})}function Le({children:t,className:a=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${a}`,children:t})}function Et({icon:t,title:a,description:r,action:s}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:a}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:r}),s&&e.jsx("div",{children:s})]})}function ye({size:t="md",text:a}){const r={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Re,{className:`${r[t]} text-primary-600 animate-spin`}),a&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:a})]})}function ot({children:t,formel:a,berechnung:r,ergebnis:s,className:n="",showIcon:i=!0}){const[x,c]=d.useState(!1),[l,o]=d.useState("top"),g=d.useRef(null);return d.useEffect(()=>{if(x&&g.current){const p=g.current.getBoundingClientRect();o(p.top<120?"bottom":"top")}},[x]),e.jsxs("span",{ref:g,className:`relative inline-block cursor-help ${n}`,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[t,i&&e.jsx(Be,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),x&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${l==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${l==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:a}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:r})]}),s&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:s})]})]})]})}function v(t,a=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:a,maximumFractionDigits:a})}const _s={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function xe({title:t,value:a,unit:r,subtitle:s,icon:n,color:i="blue",trend:x,formel:c,berechnung:l,ergebnis:o}){const g=_s[i],p=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof a=="number"?a.toLocaleString("de-DE"):a,r&&e.jsx("span",{className:"text-sm font-normal ml-1",children:r}),x==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"↑"}),x==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"↓"})]});return e.jsx(A,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:c?e.jsx(ot,{formel:c,berechnung:l,ergebnis:o,children:p}):p}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl ${g.bg} ml-3 flex-shrink-0`,children:e.jsx(n,{className:`h-6 w-6 ${g.icon}`})})]})})}const zs="./api";class Ss{constructor(a=zs){Or(this,"baseUrl");this.baseUrl=a}async request(a,r={}){const s=`${this.baseUrl}${a}`,n={headers:{"Content-Type":"application/json",...r.headers},...r},i=await fetch(s,n);if(!i.ok){const x={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const c=await i.json();x.detail=c.detail||x.detail}catch{}throw x}if(i.status!==204)return i.json()}async get(a){return this.request(a,{method:"GET"})}async post(a,r){return this.request(a,{method:"POST",body:r?JSON.stringify(r):void 0})}async put(a,r){return this.request(a,{method:"PUT",body:JSON.stringify(r)})}async delete(a){return this.request(a,{method:"DELETE"})}async patch(a,r){return this.request(a,{method:"PATCH",body:JSON.stringify(r)})}async upload(a,r,s="file"){const n=new FormData;return n.append(s,r),this.request(a,{method:"POST",headers:{},body:n})}}const K=new Ss,Ye={async list(){return K.get("/anlagen/")},async get(t){return K.get(`/anlagen/${t}`)},async create(t){return K.post("/anlagen/",t)},async update(t,a){return K.put(`/anlagen/${t}`,a)},async delete(t){return K.delete(`/anlagen/${t}`)},async getSensorConfig(t){return K.get(`/anlagen/${t}/sensors`)},async updateSensorConfig(t,a){return K.patch(`/anlagen/${t}/sensors`,a)},async geocode(t,a){const r=new URLSearchParams({plz:t});return a&&r.append("ort",a),K.get(`/anlagen/geocode/lookup?${r}`)}},$t={async list(t,a){const r=new URLSearchParams;t&&r.append("anlage_id",t.toString()),a&&r.append("jahr",a.toString());const s=r.toString();return K.get(`/monatsdaten/${s?"?"+s:""}`)},async get(t){return K.get(`/monatsdaten/${t}`)},async create(t){return K.post("/monatsdaten/",t)},async update(t,a){return K.put(`/monatsdaten/${t}`,a)},async delete(t){return K.delete(`/monatsdaten/${t}`)}},ze={async getTypen(){return K.get("/investitionen/typen")},async list(t,a,r){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),a&&s.append("typ",a),r!==void 0&&s.append("aktiv",r.toString());const n=s.toString();return K.get(`/investitionen/${n?"?"+n:""}`)},async get(t){return K.get(`/investitionen/${t}`)},async create(t){return K.post("/investitionen/",t)},async update(t,a){return K.put(`/investitionen/${t}`,a)},async delete(t){return K.delete(`/investitionen/${t}`)},async getROIDashboard(t,a,r,s,n){const i=new URLSearchParams;a&&i.append("strompreis_cent",a.toString()),r&&i.append("einspeiseverguetung_cent",r.toString()),s&&i.append("benzinpreis_euro",s.toString()),n&&n!=="all"&&i.append("jahr",n.toString());const x=i.toString();return K.get(`/investitionen/roi/${t}${x?"?"+x:""}`)},async getEAutoDashboard(t,a,r){const s=new URLSearchParams;a&&s.append("strompreis_cent",a.toString()),r&&s.append("benzinpreis_euro",r.toString());const n=s.toString();return K.get(`/investitionen/dashboard/e-auto/${t}${n?"?"+n:""}`)},async getWaermepumpeDashboard(t,a){const r=new URLSearchParams;a&&r.append("strompreis_cent",a.toString());const s=r.toString();return K.get(`/investitionen/dashboard/waermepumpe/${t}${s?"?"+s:""}`)},async getSpeicherDashboard(t,a,r){const s=new URLSearchParams;a&&s.append("strompreis_cent",a.toString()),r&&s.append("einspeiseverguetung_cent",r.toString());const n=s.toString();return K.get(`/investitionen/dashboard/speicher/${t}${n?"?"+n:""}`)},async getWallboxDashboard(t){return K.get(`/investitionen/dashboard/wallbox/${t}`)},async getBalkonkraftwerkDashboard(t,a,r){const s=new URLSearchParams;a&&s.append("strompreis_cent",a.toString()),r&&s.append("einspeiseverguetung_cent",r.toString());const n=s.toString();return K.get(`/investitionen/dashboard/balkonkraftwerk/${t}${n?"?"+n:""}`)},async getSonstigesDashboard(t,a,r){const s=new URLSearchParams;a&&s.append("strompreis_cent",a.toString()),r&&s.append("einspeiseverguetung_cent",r.toString());const n=s.toString();return K.get(`/investitionen/dashboard/sonstiges/${t}${n?"?"+n:""}`)},async getMonatsdatenByMonth(t,a,r){return K.get(`/investitionen/monatsdaten/${t}/${a}/${r}`)}},Nt={async list(t,a){const r=new URLSearchParams;t&&r.append("anlage_id",t.toString()),a&&r.append("aktuell","true");const s=r.toString();return K.get(`/strompreise/${s?"?"+s:""}`)},async getAktuell(t){return K.get(`/strompreise/aktuell/${t}`)},async get(t){return K.get(`/strompreise/${t}`)},async create(t){return K.post("/strompreise/",t)},async update(t,a){return K.put(`/strompreise/${t}`,a)},async delete(t){return K.delete(`/strompreise/${t}`)}},jt="./api",wt={async getTemplateInfo(t){const a=await fetch(`${jt}/import/template/${t}`);if(!a.ok)throw new Error("Fehler beim Laden des Templates");return a.json()},getTemplateDownloadUrl(t){return`${jt}/import/template/${t}/download`},async importCSV(t,a,r=!1){const s=new FormData;s.append("file",a);const n=new URLSearchParams;r&&n.append("ueberschreiben","true");const i=await fetch(`${jt}/import/csv/${t}?${n.toString()}`,{method:"POST",body:s});if(!i.ok){const x=await i.json();throw new Error(x.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(t,a){const r=new URLSearchParams;a&&r.append("jahr",a.toString());const s=r.toString();return`${jt}/import/export/${t}${s?"?"+s:""}`},async createDemoData(){const t=await fetch(`${jt}/import/demo`,{method:"POST"});if(!t.ok){const a=await t.json();throw new Error(a.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${jt}/import/demo`,{method:"DELETE"});if(!t.ok){const a=await t.json();throw new Error(a.detail||"Demo-Daten konnten nicht gelöscht werden")}return t.json()}},qr={async health(){return K.get("/health")},async getSettings(){return K.get("/settings")},async getStats(){return K.get("/stats")}},Xe={async getPrognose(t,a={}){const r=new URLSearchParams;a.system_losses!==void 0&&r.set("system_losses",a.system_losses.toString());const s=r.toString();return K.get(`/pvgis/prognose/${t}${s?`?${s}`:""}`)},async getModulPrognose(t,a={}){const r=new URLSearchParams;a.system_losses!==void 0&&r.set("system_losses",a.system_losses.toString());const s=r.toString();return K.get(`/pvgis/modul/${t}${s?`?${s}`:""}`)},async speicherePrognose(t,a={}){const r=new URLSearchParams;a.system_losses!==void 0&&r.set("system_losses",a.system_losses.toString());const s=r.toString();return K.post(`/pvgis/prognose/${t}/speichern${s?`?${s}`:""}`)},async listeGespeichertePrognosen(t){return K.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return K.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return K.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return K.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return K.get(`/pvgis/optimum/${t}`)}},Oe={async getStatus(){return K.get("/ha/status")},async getSensors(){return K.get("/ha/sensors")},async getStringSensors(){return K.get("/ha/string-sensors")},async getStringMonatsdaten(t,a){const r=a?`?jahr=${a}`:"";return K.get(`/ha/string-monatsdaten/${t}${r}`)},async createStringMonatsdaten(t){return K.post("/ha/string-monatsdaten",t)},async deleteStringMonatsdaten(t){return K.delete(`/ha/string-monatsdaten/${t}`)},async getImportPreview(t,a){return K.get(`/ha/import/preview/${t}?jahr=${a}`)},async importMonatsdaten(t,a,r,s=!1){return K.post("/ha/import/monatsdaten",{anlage_id:t,jahr:a,monat:r||null,ueberschreiben:s})},async getMonthlyStatistics(t,a,r=1,s,n){return K.post("/ha/statistics/monthly",{statistic_id:t,start_jahr:a,start_monat:r,end_jahr:s,end_monat:n})},async discover(t,a){const r=new URLSearchParams;t&&r.append("anlage_id",t.toString()),a&&r.append("manufacturer",a);const s=r.toString();return K.get(`/ha/discover${s?"?"+s:""}`)},async getMqttConfig(){return K.get("/ha/export/mqtt/config")},async getExportSensors(){return K.get("/ha/export/sensors")},async getAnlageSensors(t){return K.get(`/ha/export/sensors/${t}`)},async getYamlSnippet(t){return K.get(`/ha/export/yaml/${t}`)},async getSensorDefinitions(){return K.get("/ha/export/definitions")},async testMqtt(t){return K.post("/ha/export/mqtt/test",t||{})},async publishMqtt(t,a){return K.post(`/ha/export/mqtt/publish/${t}`,a||{})},async removeMqtt(t,a){return K.delete(`/ha/export/mqtt/remove/${t}`)}},_a={async getUebersicht(t,a){const r=a?`?jahr=${a}`:"";return K.get(`/cockpit/uebersicht/${t}${r}`)},async getPrognoseVsIst(t,a){return K.get(`/cockpit/prognose-vs-ist/${t}?jahr=${a}`)},async getNachhaltigkeit(t){return K.get(`/cockpit/nachhaltigkeit/${t}`)},async getKomponentenZeitreihe(t){return K.get(`/cockpit/komponenten-zeitreihe/${t}`)}},Es={async getMonatsdaten(t,a,r){return K.get(`/wetter/monat/${t}/${a}/${r}`)},async getMonatsdatenByCoords(t,a,r,s){return K.get(`/wetter/monat/koordinaten/${t}/${a}/${r}/${s}`)}},ft={async getInvestitionenMitFeldern(t){return K.get(`/ha-import/investitionen/${t}`)},async saveSensorMapping(t,a){return K.post(`/ha-import/sensor-mapping/${t}`,a)},async generateYaml(t,a){const r=new URLSearchParams;a!=null&&a.einspeisung&&r.append("einspeisung_sensor",a.einspeisung),a!=null&&a.netzbezug&&r.append("netzbezug_sensor",a.netzbezug),a!=null&&a.pv_erzeugung&&r.append("pv_sensor",a.pv_erzeugung);const s=r.toString(),n=`/ha-import/yaml/${t}${s?`?${s}`:""}`;return K.get(n)},async importFromHa(t,a){return K.post(`/ha-import/from-ha/${t}`,a)},async getHASensors(t=!0,a=!0,r=!1,s=!1){const n=new URLSearchParams;return n.append("filter_total_increasing",String(t)),n.append("filter_energy",String(a)),n.append("include_percentage",String(r)),n.append("include_counter",String(s)),K.get(`/ha-import/ha-sensors?${n}`)},async getAllHASensors(){return K.get("/ha-import/ha-sensors/all")},async getBerechnungsFormeln(){return K.get("/ha-import/berechnungs-formeln")},async getSensorSuggestions(t){return K.get(`/ha-import/ha-sensors/suggestions/${t}`)},async saveCompleteSensorMapping(t,a){return K.post(`/ha-import/sensor-mapping-complete/${t}`,a)}};function Me(){const[t,a]=d.useState([]),[r,s]=d.useState(!0),[n,i]=d.useState(null),x=d.useCallback(async()=>{try{s(!0),i(null);const g=await Ye.list();a(g)}catch(g){i(g instanceof Error?g.message:"Fehler beim Laden der Anlagen")}finally{s(!1)}},[]);d.useEffect(()=>{x()},[x]);const c=d.useCallback(async g=>{const p=await Ye.create(g);return a(y=>[...y,p]),p},[]),l=d.useCallback(async(g,p)=>{const y=await Ye.update(g,p);return a(k=>k.map(f=>f.id===g?y:f)),y},[]),o=d.useCallback(async g=>{await Ye.delete(g),a(p=>p.filter(y=>y.id!==g))},[]);return{anlagen:t,loading:r,error:n,refresh:x,createAnlage:c,updateAnlage:l,deleteAnlage:o}}function Cr(t,a){const[r,s]=d.useState([]),[n,i]=d.useState(!0),[x,c]=d.useState(null),l=d.useCallback(async()=>{try{i(!0),c(null);const y=await $t.list(t,a);s(y)}catch(y){c(y instanceof Error?y.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[t,a]);d.useEffect(()=>{l()},[l]);const o=d.useCallback(async y=>{const k=await $t.create(y);return s(f=>[k,...f]),k},[]),g=d.useCallback(async(y,k)=>{const f=await $t.update(y,k);return s(F=>F.map(_=>_.id===y?f:_)),f},[]),p=d.useCallback(async y=>{await $t.delete(y),s(k=>k.filter(f=>f.id!==y))},[]);return{monatsdaten:r,loading:n,error:x,refresh:l,createMonatsdaten:o,updateMonatsdaten:g,deleteMonatsdaten:p}}function za(t){return{gesamtErzeugung:t.reduce((a,r)=>a+(r.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((a,r)=>a+r.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((a,r)=>a+r.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((a,r)=>a+(r.eigenverbrauch_kwh||0),0),durchschnittAutarkie:t.length>0?t.reduce((a,r)=>{const s=r.eigenverbrauch_kwh||0,n=(r.eigenverbrauch_kwh||0)+r.netzbezug_kwh;return a+(n>0?s/n*100:0)},0)/t.length:0,anzahlMonate:t.length}}function It(t,a){const[r,s]=d.useState([]),[n,i]=d.useState(!0),[x,c]=d.useState(null),l=d.useCallback(async()=>{try{i(!0),c(null);const y=await ze.list(t,a);s(y)}catch(y){c(y instanceof Error?y.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[t,a]);d.useEffect(()=>{l()},[l]);const o=d.useCallback(async y=>{const k=await ze.create(y);return s(f=>[...f,k]),k},[]),g=d.useCallback(async(y,k)=>{const f=await ze.update(y,k);return s(F=>F.map(_=>_.id===y?f:_)),f},[]),p=d.useCallback(async y=>{await ze.delete(y),s(k=>k.filter(f=>f.id!==y))},[]);return{investitionen:r,loading:n,error:x,refresh:l,createInvestition:o,updateInvestition:g,deleteInvestition:p}}function Fs(t){return t.reduce((r,s)=>(r[s.typ]||(r[s.typ]=[]),r[s.typ].push(s),r),{})}function Cs(t){const[a,r]=d.useState([]),[s,n]=d.useState(!0),[i,x]=d.useState(null),c=d.useCallback(async()=>{try{n(!0),x(null);const p=await Nt.list(t);r(p)}catch(p){x(p instanceof Error?p.message:"Fehler beim Laden der Strompreise")}finally{n(!1)}},[t]);d.useEffect(()=>{c()},[c]);const l=d.useCallback(async p=>{const y=await Nt.create(p);return r(k=>[y,...k]),y},[]),o=d.useCallback(async(p,y)=>{const k=await Nt.update(p,y);return r(f=>f.map(F=>F.id===p?k:F)),k},[]),g=d.useCallback(async p=>{await Nt.delete(p),r(y=>y.filter(k=>k.id!==p))},[]);return{strompreise:a,loading:s,error:i,refresh:c,createStrompreis:l,updateStrompreis:o,deleteStrompreis:g}}function Sa(t){const[a,r]=d.useState(null),[s,n]=d.useState(!1),[i,x]=d.useState(null);return d.useEffect(()=>{if(t===null){r(null);return}(async()=>{try{n(!0),x(null);const l=await Nt.getAktuell(t);r(l)}catch{r(null)}finally{n(!1)}})()},[t]),{strompreis:a,loading:s,error:i}}const rr={pv_erzeugung:null,einspeisung:null,netzbezug:null,batterie_ladung:null,batterie_entladung:null};function Ws(){const[t,a]=d.useState("idle"),[r,s]=d.useState(null),[n,i]=d.useState(new Set),[x,c]=d.useState(rr),[l,o]=d.useState(null),g=d.useCallback(async h=>{a("scanning"),o(null);try{const u=await Oe.discover(h);if(s(u),!u.ha_connected){o("Keine Verbindung zu Home Assistant"),a("error");return}const b=new Set;for(const z of u.devices)!z.already_configured&&z.suggested_investition_typ&&b.add(z.id);i(b),c({pv_erzeugung:u.current_mappings.pv_erzeugung,einspeisung:u.current_mappings.einspeisung,netzbezug:u.current_mappings.netzbezug,batterie_ladung:u.current_mappings.batterie_ladung,batterie_entladung:u.current_mappings.batterie_entladung}),a("results")}catch(u){o(u instanceof Error?u.message:"Discovery fehlgeschlagen"),a("error")}},[]),p=d.useCallback(h=>{i(u=>{const b=new Set(u);return b.has(h)?b.delete(h):b.add(h),b})},[]),y=d.useCallback(()=>{if(!r)return;const h=new Set(r.devices.filter(u=>!u.already_configured&&u.suggested_investition_typ).map(u=>u.id));i(h)},[r]),k=d.useCallback(()=>{i(new Set)},[]),f=d.useCallback((h,u)=>{c(b=>({...b,[h]:u}))},[]),F=d.useCallback(()=>{if(!r)return;const h={...rr},{sensor_mappings:u}=r;u.pv_erzeugung.length>0&&(h.pv_erzeugung=u.pv_erzeugung[0].entity_id),u.einspeisung.length>0&&(h.einspeisung=u.einspeisung[0].entity_id),u.netzbezug.length>0&&(h.netzbezug=u.netzbezug[0].entity_id),u.batterie_ladung.length>0&&(h.batterie_ladung=u.batterie_ladung[0].entity_id),u.batterie_entladung.length>0&&(h.batterie_entladung=u.batterie_entladung[0].entity_id),c(h)},[r]),_=d.useCallback(h=>{a(h)},[]),j=d.useCallback(()=>{a("idle"),s(null),i(new Set),c(rr),o(null)},[]),M=(r==null?void 0:r.devices.filter(h=>n.has(h.id)&&!h.already_configured&&h.suggested_investition_typ))??[],m=n.size>0||Object.values(x).some((h,u)=>{const b=r!=null&&r.current_mappings?[r.current_mappings.pv_erzeugung,r.current_mappings.einspeisung,r.current_mappings.netzbezug,r.current_mappings.batterie_ladung,r.current_mappings.batterie_entladung]:[null,null,null,null,null];return h!==b[u]});return{step:t,discoveryResult:r,selectedDevices:n,selectedMappings:x,error:l,startDiscovery:g,toggleDevice:p,selectAllDevices:y,deselectAllDevices:k,setMapping:f,applyBestMappings:F,goToStep:_,reset:j,devicesToCreate:M,hasChanges:m}}const ut={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function Ea(t){return t<=10?8.2:t<=40?7.1:5.8}const ar="eedc_setup_wizard_state",Jr={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},ht=["welcome","anlage","ha-connection","strompreise","discovery","investitionen","summary","complete"],Fa=["wechselrichter","pv-module","speicher","wallbox","e-auto","waermepumpe","balkonkraftwerk","sonstiges"],st={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},Ms={"pv-module":"wechselrichter",speicher:"wechselrichter"},$s=["pv-module"];function As(){const[t,a]=d.useState(()=>{try{const O=localStorage.getItem(ar);if(O)return JSON.parse(O)}catch{}return Jr}),[r,s]=d.useState(t.currentStep),[n,i]=d.useState(!1),[x,c]=d.useState(null),[l,o]=d.useState(null),[g,p]=d.useState(null),[y,k]=d.useState(!1),[f,F]=d.useState(null),[_,j]=d.useState(null),[M,m]=d.useState([]),h=d.useRef(new Map);d.useEffect(()=>{localStorage.setItem(ar,JSON.stringify({...t,currentStep:r}))},[t,r]),d.useEffect(()=>{t.anlageId&&!l&&Ye.get(t.anlageId).then(o).catch(()=>{})},[t.anlageId,l]);const u=d.useCallback(async()=>{if(t.anlageId)try{const O=await ze.list(t.anlageId);m(O)}catch{}},[t.anlageId]);d.useEffect(()=>{u()},[u]);const b=d.useCallback(O=>{s(O),c(null)},[]),z=d.useCallback(async()=>{const O=h.current;if(O.size===0)return;const Q=[];O.forEach(({data:E,timer:q},ae)=>{clearTimeout(q),Q.push(ze.update(ae,E).catch($=>{console.error(`Fehler beim Update von Investition ${ae}:`,$)}))}),O.clear(),await Promise.all(Q),await u()},[u]),C=d.useCallback(async()=>{await z();const O=ht.indexOf(r);O<ht.length-1&&b(ht[O+1])},[r,b,z]),L=d.useCallback(()=>{const O=ht.indexOf(r);O>0&&b(ht[O-1])},[r,b]),R=d.useCallback(()=>{a(O=>({...O,skippedSteps:[...O.skippedSteps,r]})),C()},[r,C]),W=d.useCallback(async(O,Q)=>{try{const E=await Ye.geocode(O,Q);return{latitude:E.latitude,longitude:E.longitude}}catch{return null}},[]),H=d.useCallback(async O=>{i(!0),c(null);try{const Q=await Ye.create(O);o(Q),a(E=>({...E,anlageId:Q.id})),C()}catch(Q){c(Q instanceof Error?Q.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[C]),D=d.useCallback(async()=>{i(!0),c(null);try{const O=await Oe.getStatus();k(O.connected),F(O.ha_version||null),O.connected||c("Keine Verbindung zu Home Assistant. Sie können diesen Schritt überspringen und später konfigurieren.")}catch{k(!1),c("Home Assistant nicht erreichbar. Läuft EEDC als Add-on?")}finally{i(!1)}},[]),S=d.useCallback(async O=>{if(!t.anlageId){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const Q=await Nt.create({anlage_id:t.anlageId,...O});p(Q),a(E=>({...E,strompreisId:Q.id})),C()}catch(Q){c(Q instanceof Error?Q.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[t.anlageId,C]),B=d.useCallback(async()=>{if(!t.anlageId||!l){c("Keine Anlage vorhanden");return}const O=Ea(l.leistung_kwp);await S({netzbezug_arbeitspreis_cent_kwh:ut.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:O,grundpreis_euro_monat:ut.grundpreis_euro_monat,gueltig_ab:l.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,l,S]),N=d.useCallback(async()=>{if(!t.anlageId){c("Keine Anlage vorhanden");return}i(!0),c(null);try{const O=(l==null?void 0:l.wechselrichter_hersteller)||void 0,Q=await Oe.discover(t.anlageId,O);if(j(Q),!Q.ha_connected){C();return}const E=[];for(const q of Q.devices)if(!(q.already_configured||!q.suggested_investition_typ))try{const ae={anlage_id:t.anlageId,typ:q.suggested_investition_typ,bezeichnung:q.name,parameter:q.suggested_parameters||{},aktiv:!0},$=await ze.create(ae);E.push($.id)}catch{}a(q=>({...q,createdInvestitionen:[...q.createdInvestitionen,...E]})),await u(),C()}catch(O){c(O instanceof Error?O.message:"Discovery fehlgeschlagen")}finally{i(!1)}},[t.anlageId,l,C,u]),V=d.useCallback(async(O,Q)=>{m($=>$.map(T=>T.id!==O?T:{...T,...Q,parameter:Q.parameter?{...T.parameter||{},...Q.parameter}:T.parameter}));const E=h.current.get(O);E!=null&&E.timer&&clearTimeout(E.timer);const q=E!=null&&E.data?{...E.data,...Q,parameter:Q.parameter?{...E.data.parameter||{},...Q.parameter}:E.data.parameter}:Q,ae=setTimeout(async()=>{h.current.delete(O);try{await ze.update(O,q)}catch($){c($ instanceof Error?$.message:"Fehler beim Aktualisieren"),await u()}},500);h.current.set(O,{data:q,timer:ae})},[u]),se=d.useCallback(async O=>{try{await ze.delete(O),await u()}catch(Q){c(Q instanceof Error?Q.message:"Fehler beim Löschen")}},[u]),he=d.useCallback(async O=>{if(!t.anlageId)throw new Error("Keine Anlage vorhanden");c(null);try{const Q=await ze.create({anlage_id:t.anlageId,typ:O,bezeichnung:`Neue ${st[O]}`,aktiv:!0});return await u(),Q}catch(Q){const E=Q instanceof Error?Q.message:"Fehler beim Hinzufügen";throw c(E),Q}},[t.anlageId,u]),ie=d.useCallback(()=>{a(O=>({...O,completed:!0,currentStep:"complete"})),s("complete")},[]),me=d.useCallback(()=>{localStorage.removeItem(ar),a(Jr),s("welcome"),o(null),p(null),j(null),m([]),c(null)},[]),je=(()=>{switch(r){case"welcome":return!0;case"anlage":return!!t.anlageId;case"ha-connection":return!0;case"strompreise":return!!t.strompreisId;case"discovery":return!0;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),fe=Math.round(ht.indexOf(r)/(ht.length-1)*100);return{step:r,wizardState:t,isLoading:n,error:x,anlage:l,strompreis:g,haConnected:y,haVersion:f,discoveryResult:_,investitionen:M,refreshInvestitionen:u,goToStep:b,nextStep:C,prevStep:L,skipStep:R,createAnlage:H,geocodeAddress:W,checkHAConnection:D,createStrompreis:S,useDefaultStrompreise:B,runDiscoveryAndCreateInvestitionen:N,updateInvestition:V,deleteInvestition:se,addInvestition:he,completeWizard:ie,resetWizard:me,canProceed:je,progress:fe}}function Ls(){var F,_,j,M,m,h,u;const t=Ut(),{anlagen:a,loading:r}=Me(),[s,n]=d.useState(null),[i,x]=d.useState(!1),[c,l]=d.useState(null),[o,g]=d.useState(void 0),[p,y]=d.useState([]),k=(F=a[0])==null?void 0:F.id;if(d.useEffect(()=>{if(!k)return;(async()=>{x(!0),l(null);try{const z=await _a.getUebersicht(k,o);if(n(z),z.zeitraum_von&&z.zeitraum_bis){const C=parseInt(z.zeitraum_von.split("-")[0]),L=parseInt(z.zeitraum_bis.split("-")[0]),R=[];for(let W=C;W<=L;W++)R.push(W);y(R)}}catch(z){l("Fehler beim Laden der Daten"),console.error(z)}finally{x(!1)}})()},[k,o]),r||i)return e.jsx(ye,{text:"Lade Dashboard..."});if(a.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsx(Ds,{})]});if(c||!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs(A,{children:[e.jsx("p",{className:"text-red-500",children:c||"Keine Daten verfügbar"}),e.jsx(Z,{onClick:()=>t("/einstellungen/monatsdaten"),className:"mt-4",children:"Monatsdaten erfassen"})]})]});const f=a[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"h-8 w-8 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[f.anlagenname," • ",s.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Dt,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:o||"",onChange:b=>g(b.target.value?parseInt(b.target.value):void 0),className:"input py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Alle Jahre"}),p.map(b=>e.jsx("option",{value:b,children:b},b))]})]})]}),s.zeitraum_von&&s.zeitraum_bis&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Zeitraum: ",s.zeitraum_von," bis ",s.zeitraum_bis," (",s.anzahl_monate," Monate)"]}),e.jsx(Kt,{title:"Energie-Bilanz",icon:ge,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"PV-Erzeugung",value:(s.pv_erzeugung_kwh/1e3).toFixed(1),unit:"MWh",icon:X,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>t("/cockpit/pv-anlage"),formel:"Σ PV-Erzeugung aller Monate",berechnung:`${v(s.pv_erzeugung_kwh,0)} kWh`,ergebnis:`= ${v(s.pv_erzeugung_kwh/1e3,1)} MWh`}),e.jsx(be,{title:"Gesamtverbrauch",value:(s.gesamtverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:Ue,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch + Netzbezug",berechnung:`${v(s.eigenverbrauch_kwh,0)} + ${v(s.netzbezug_kwh,0)} kWh`,ergebnis:`= ${v(s.gesamtverbrauch_kwh/1e3,1)} MWh`}),e.jsx(be,{title:"Netzbezug",value:(s.netzbezug_kwh/1e3).toFixed(1),unit:"MWh",icon:pr,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Netzbezug aller Monate",berechnung:`${v(s.netzbezug_kwh,0)} kWh`,ergebnis:`= ${v(s.netzbezug_kwh/1e3,1)} MWh`}),e.jsx(be,{title:"Einspeisung",value:(s.einspeisung_kwh/1e3).toFixed(1),unit:"MWh",icon:qt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einspeisung aller Monate",berechnung:`${v(s.einspeisung_kwh,0)} kWh`,ergebnis:`= ${v(s.einspeisung_kwh/1e3,1)} MWh`})]})}),e.jsx(Kt,{title:"Effizienz-Quoten",icon:is,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Autarkie",value:s.autarkie_prozent.toFixed(1),unit:"%",subtitle:"Unabhängigkeit vom Netz",icon:Vt,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:`${v(s.eigenverbrauch_kwh,0)} ÷ ${v(s.gesamtverbrauch_kwh,0)} × 100`,ergebnis:`= ${v(s.autarkie_prozent,1)} %`}),e.jsx(be,{title:"Eigenverbrauchsquote",value:s.eigenverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Selbst genutzte PV",icon:ge,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${v(s.eigenverbrauch_kwh,0)} ÷ ${v(s.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${v(s.eigenverbrauch_quote_prozent,1)} %`}),e.jsx(be,{title:"Direktverbrauchsquote",value:s.direktverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Ohne Speicher-Umweg",icon:Ne,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Direktverbrauch ÷ Erzeugung × 100",berechnung:`${v(s.direktverbrauch_kwh,0)} ÷ ${v(s.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${v(s.direktverbrauch_quote_prozent,1)} %`}),e.jsx(be,{title:"Spez. Ertrag",value:((_=s.spezifischer_ertrag_kwh_kwp)==null?void 0:_.toFixed(0))||"---",unit:"kWh/kWp",subtitle:"Anlageneffizienz",icon:X,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Erzeugung ÷ Anlagenleistung",berechnung:`${v(s.pv_erzeugung_kwh,0)} kWh ÷ ${v(s.anlagenleistung_kwp,2)} kWp`,ergebnis:`= ${v(s.spezifischer_ertrag_kwh_kwp||0,0)} kWh/kWp`})]})}),s.hat_speicher&&e.jsx(sr,{title:"Speicher",icon:ke,onClick:()=>t("/cockpit/speicher"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Ladung gesamt",value:(s.speicher_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:pr,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung",berechnung:`${v(s.speicher_ladung_kwh,0)} kWh`,ergebnis:`= ${v(s.speicher_ladung_kwh/1e3,2)} MWh`}),e.jsx(be,{title:"Entladung gesamt",value:(s.speicher_entladung_kwh/1e3).toFixed(2),unit:"MWh",icon:qt,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung",berechnung:`${v(s.speicher_entladung_kwh,0)} kWh`,ergebnis:`= ${v(s.speicher_entladung_kwh/1e3,2)} MWh`}),e.jsx(be,{title:"Ø Effizienz",value:((j=s.speicher_effizienz_prozent)==null?void 0:j.toFixed(1))||"---",unit:"%",icon:Vt,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${v(s.speicher_entladung_kwh,0)} ÷ ${v(s.speicher_ladung_kwh,0)} × 100`,ergebnis:`= ${v(s.speicher_effizienz_prozent||0,1)} %`}),e.jsx(be,{title:"Vollzyklen",value:((M=s.speicher_vollzyklen)==null?void 0:M.toFixed(0))||"---",unit:"",subtitle:`${s.speicher_kapazitaet_kwh.toFixed(1)} kWh Kapazität`,icon:ke,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Ladung ÷ Kapazität",berechnung:`${v(s.speicher_ladung_kwh,0)} kWh ÷ ${v(s.speicher_kapazitaet_kwh,1)} kWh`,ergebnis:`= ${v(s.speicher_vollzyklen||0,0)} Zyklen`})]})}),s.hat_waermepumpe&&e.jsx(sr,{title:"Wärmepumpe",icon:_e,onClick:()=>t("/cockpit/waermepumpe"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Wärme erzeugt",value:(s.wp_waerme_kwh/1e3).toFixed(2),unit:"MWh",icon:_e,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizung + Warmwasser",berechnung:`${v(s.wp_waerme_kwh,0)} kWh`,ergebnis:`= ${v(s.wp_waerme_kwh/1e3,2)} MWh`}),e.jsx(be,{title:"Strom verbraucht",value:(s.wp_strom_kwh/1e3).toFixed(2),unit:"MWh",icon:ge,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Stromverbrauch",berechnung:`${v(s.wp_strom_kwh,0)} kWh`,ergebnis:`= ${v(s.wp_strom_kwh/1e3,2)} MWh`}),e.jsx(be,{title:"Ø COP",value:((m=s.wp_cop)==null?void 0:m.toFixed(1))||"---",unit:"",icon:Vt,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${v(s.wp_waerme_kwh,0)} ÷ ${v(s.wp_strom_kwh,0)}`,ergebnis:`= ${v(s.wp_cop||0,1)}`}),e.jsx(be,{title:"Ersparnis vs. Gas",value:s.wp_ersparnis_euro.toFixed(0),unit:"€",icon:dt,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Gaskosten - Stromkosten",berechnung:`(${v(s.wp_waerme_kwh,0)} kWh ÷ 0.9 × 10ct) - (${v(s.wp_strom_kwh,0)} kWh × Strompreis)`,ergebnis:`= ${v(s.wp_ersparnis_euro,0)} €`})]})}),s.hat_emobilitaet&&e.jsx(sr,{title:"E-Mobilität",icon:ve,onClick:()=>t("/cockpit/e-auto"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Gefahrene km",value:(s.emob_km/1e3).toFixed(1),unit:"Tkm",icon:ve,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene Kilometer",berechnung:`${v(s.emob_km,0)} km`,ergebnis:`= ${v(s.emob_km/1e3,1)} Tkm`}),e.jsx(be,{title:"Ladung gesamt",value:(s.emob_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:ge,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Heim + Extern Ladung",berechnung:`${v(s.emob_ladung_kwh,0)} kWh`,ergebnis:`= ${v(s.emob_ladung_kwh/1e3,2)} MWh`}),e.jsx(be,{title:"PV-Anteil",value:((h=s.emob_pv_anteil_prozent)==null?void 0:h.toFixed(0))||"---",unit:"%",icon:X,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"PV-Ladung ÷ Heimladung × 100",berechnung:"PV-geladene kWh ÷ Gesamt-Ladung",ergebnis:`= ${v(s.emob_pv_anteil_prozent||0,0)} %`}),e.jsx(be,{title:"Ersparnis vs. Benzin",value:s.emob_ersparnis_euro.toFixed(0),unit:"€",icon:dt,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Benzinkosten - Stromkosten",berechnung:"Benzin (7L/100km × 1.80€) - Strom",ergebnis:`= ${v(s.emob_ersparnis_euro,0)} €`})]})}),e.jsx(Kt,{title:"Finanzen",icon:dt,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"Einspeiseerlös",value:s.einspeise_erloes_euro.toFixed(0),unit:"€",icon:qt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Vergütung",berechnung:`${v(s.einspeisung_kwh,0)} kWh × 8.2 ct/kWh`,ergebnis:`= ${v(s.einspeise_erloes_euro,0)} €`}),e.jsx(be,{title:"EV-Ersparnis",value:s.ev_ersparnis_euro.toFixed(0),unit:"€",icon:ge,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Strompreis",berechnung:`${v(s.eigenverbrauch_kwh,0)} kWh × Strompreis`,ergebnis:`= ${v(s.ev_ersparnis_euro,0)} €`}),e.jsx(be,{title:"Netto-Ertrag",value:s.netto_ertrag_euro.toFixed(0),unit:"€",icon:Ne,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Erlös + Ersparnis",berechnung:`${v(s.einspeise_erloes_euro,0)} + ${v(s.ev_ersparnis_euro,0)} €`,ergebnis:`= ${v(s.netto_ertrag_euro,0)} €`}),e.jsx(be,{title:"ROI-Fortschritt",value:((u=s.roi_fortschritt_prozent)==null?void 0:u.toFixed(1))||"---",unit:"%",subtitle:`von ${s.investition_gesamt_euro.toFixed(0)} € Invest`,icon:Vt,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",onClick:()=>t("/auswertungen/roi"),formel:"Kum. Ersparnis ÷ Investition × 100",berechnung:`Netto-Ertrag ÷ ${v(s.investition_gesamt_euro,0)} €`,ergebnis:`= ${v(s.roi_fortschritt_prozent||0,1)} %`})]})}),e.jsx(Kt,{title:"CO₂-Bilanz",icon:De,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(be,{title:"CO₂ PV",value:(s.co2_pv_kg/1e3).toFixed(1),unit:"t",subtitle:"Vermiedene Emissionen",icon:X,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Eigenverbrauch × CO₂-Faktor",berechnung:`${v(s.eigenverbrauch_kwh,0)} kWh × 0.38 kg/kWh`,ergebnis:`= ${v(s.co2_pv_kg,0)} kg`}),e.jsx(be,{title:"CO₂ Wärmepumpe",value:(s.co2_wp_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Gas-Heizung",icon:_e,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO₂ Gas - CO₂ Strom",berechnung:"Gasverbrauch × 0.201 - WP-Strom × 0.38",ergebnis:`= ${v(s.co2_wp_kg,0)} kg`}),e.jsx(be,{title:"CO₂ E-Mobilität",value:(s.co2_emob_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Verbrenner",icon:ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"CO₂ Benzin - CO₂ Strom",berechnung:"Benzinverbrauch × 2.37 - Stromverbrauch × 0.38",ergebnis:`= ${v(s.co2_emob_kg,0)} kg`}),e.jsx(be,{title:"CO₂ gesamt",value:(s.co2_gesamt_kg/1e3).toFixed(1),unit:"t",subtitle:"Gesamte Einsparung",icon:De,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ aller CO₂-Einsparungen",berechnung:`${v(s.co2_pv_kg,0)} + ${v(s.co2_wp_kg,0)} + ${v(s.co2_emob_kg,0)} kg`,ergebnis:`= ${v(s.co2_gesamt_kg/1e3,1)} t`})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(nr,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/einstellungen/monatsdaten")}),e.jsx(nr,{title:"Auswertungen",description:"Detaillierte Analysen und Zeitverläufe",onClick:()=>t("/auswertungen")}),e.jsx(nr,{title:"Investitionen",description:"Komponenten verwalten",onClick:()=>t("/einstellungen/investitionen")})]})]})}function Kt({title:t,icon:a,children:r}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),r]})}function sr({title:t,icon:a,onClick:r,children:s}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:[e.jsx(a,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),e.jsx(bt,{className:"h-4 w-4 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),s]})}function be({title:t,value:a,unit:r,subtitle:s,icon:n,color:i,bgColor:x,onClick:c,formel:l,berechnung:o,ergebnis:g}){const p=e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[a," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:r})]}),y=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-0.5",children:l?e.jsx(ot,{formel:l,berechnung:o,ergebnis:g,children:p}):p}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate",children:s})]}),e.jsx("div",{className:`p-2 rounded-lg ${x} ml-2 flex-shrink-0`,children:e.jsx(n,{className:`h-5 w-5 ${i}`})})]});return c?e.jsx("button",{onClick:c,className:"card p-3 text-left hover:shadow-md transition-shadow w-full",children:y}):e.jsx(A,{className:"p-3",children:y})}function nr({title:t,description:a,onClick:r}){return e.jsx("button",{onClick:r,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a})]}),e.jsx(Je,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function Ds(){const t=Ut();return e.jsxs(A,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(Z,{onClick:()=>t("/einstellungen/anlage"),children:["Jetzt starten",e.jsx(Je,{className:"h-4 w-4 ml-2"})]})]})}const Is=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],at={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"},Ur=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function Ps(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState();d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]);const{investitionen:n,loading:i}=It(r),{monatsdaten:x,loading:c}=Cr(r),l=za(x),{pvSysteme:o,orphanModule:g}=d.useMemo(()=>{const m=[],h=[],u=n.filter(C=>C.typ==="wechselrichter"),b=n.filter(C=>C.typ==="pv-module"),z=n.filter(C=>C.typ==="speicher");for(const C of u){const L=b.filter(H=>H.parent_investition_id===C.id),R=z.filter(H=>H.parent_investition_id===C.id),W=L.reduce((H,D)=>H+(D.leistung_kwp||0),0);m.push({wechselrichter:C,pvModule:L,speicher:R,gesamtKwp:W})}for(const C of b)(!C.parent_investition_id||!u.find(L=>L.id===C.parent_investition_id))&&h.push(C);return{pvSysteme:m,orphanModule:h}},[n]),p=d.useMemo(()=>o.reduce((m,h)=>m+h.gesamtKwp,0)+g.reduce((m,h)=>m+(h.leistung_kwp||0),0),[o,g]),y=p>0?l.gesamtErzeugung/p:0,k=d.useMemo(()=>[...x].sort((h,u)=>h.jahr!==u.jahr?h.jahr-u.jahr:h.monat-u.monat).slice(-12).map(h=>({name:`${Is[h.monat]} ${h.jahr.toString().slice(-2)}`,Erzeugung:h.pv_erzeugung_kwh,Eigenverbrauch:h.eigenverbrauch_kwh||0,Einspeisung:h.einspeisung_kwh})),[x]),f=d.useMemo(()=>l.gesamtErzeugung===0?[]:[{name:"Eigenverbrauch",value:l.gesamtEigenverbrauch,color:at.consumption},{name:"Einspeisung",value:l.gesamtEinspeisung,color:at.feedin}],[l]),F=d.useMemo(()=>{const m=o.flatMap(u=>u.pvModule).concat(g),h={};for(const u of m){const b=u.ausrichtung||"Unbekannt";h[b]||(h[b]={kwp:0,count:0}),h[b].kwp+=u.leistung_kwp||0,h[b].count+=1}return Object.entries(h).map(([u,b],z)=>({ausrichtung:u,kwp:b.kwp,count:b.count,color:Ur[z%Ur.length]}))},[o,g]);if(a||i||c)return e.jsx(ye,{text:"Lade PV-Anlage..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]});const j=x.length>0,M=o.length>0||g.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:m=>s(parseInt(m.target.value)),options:t.map(m=>({value:m.id.toString(),label:m.anlagenname}))})]}),g.length>0&&e.jsx(le,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsxs("span",{children:[g.length," PV-Modul(e) ohne Wechselrichter-Zuordnung. Bitte unter Einstellungen → Investitionen zuordnen."]})]})}),!M&&e.jsx(le,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen → Investitionen Wechselrichter und PV-Module anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(xe,{title:"Anlagenleistung",value:p>0?p.toFixed(1):"---",unit:"kWp",subtitle:`${o.length} Wechselrichter, ${o.reduce((m,h)=>m+h.pvModule.length,0)+g.length} Module`,icon:X,color:"yellow"}),e.jsx(xe,{title:"Gesamterzeugung",value:l.gesamtErzeugung>0?(l.gesamtErzeugung/1e3).toFixed(1):"---",unit:"MWh",subtitle:l.anzahlMonate>0?`${l.anzahlMonate} Monate`:void 0,icon:ge,color:"green"}),e.jsx(xe,{title:"Spez. Ertrag",value:y>0?y.toFixed(0):"---",unit:"kWh/kWp",subtitle:l.anzahlMonate>=12?"Jahreswert":`${l.anzahlMonate} Monate`,icon:Ne,color:"blue",formel:"Spez. Ertrag = Erzeugung ÷ Leistung",berechnung:`${v(l.gesamtErzeugung,0)} kWh ÷ ${v(p,1)} kWp`,ergebnis:`= ${v(y,0)} kWh/kWp`}),e.jsx(xe,{title:"Eigenverbrauch",value:l.gesamtErzeugung>0?(l.gesamtEigenverbrauch/l.gesamtErzeugung*100).toFixed(1):"---",unit:"%",subtitle:`${(l.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:xa,color:"purple",formel:"Eigenverbrauchsquote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${v(l.gesamtEigenverbrauch,0)} kWh ÷ ${v(l.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${v(l.gesamtErzeugung>0?l.gesamtEigenverbrauch/l.gesamtErzeugung*100:0,1)} %`})]}),M&&e.jsxs(A,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsxs("div",{className:"space-y-4",children:[o.map(m=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:m.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[m.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[m.pvModule.map(h=>{var u;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(X,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:h.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(u=h.leistung_kwp)==null?void 0:u.toFixed(1)," kWp",h.ausrichtung&&` • ${h.ausrichtung}`,h.neigung_grad&&` • ${h.neigung_grad}°`]})]},h.id)}),m.speicher.map(h=>{var u,b;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(ge,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:h.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(b=(u=h.parameter)==null?void 0:u.kapazitaet_kwh)==null?void 0:b.toFixed(1)," kWh"]})]},h.id)}),m.pvModule.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PV-Module zugeordnet"})]})]})]},m.wechselrichter.id)),g.length>0&&e.jsxs("div",{className:"border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-amber-800 dark:text-amber-200 mb-2 flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),"Nicht zugeordnete PV-Module"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:g.map(m=>{var h;return e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-300",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:m.bezeichnung}),e.jsxs("span",{className:"text-amber-500",children:[(h=m.leistung_kwp)==null?void 0:h.toFixed(1)," kWp",m.ausrichtung&&` • ${m.ausrichtung}`]})]},m.id)})})]})]})]}),F.length>1&&e.jsxs(A,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Leistung nach Ausrichtung"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:F,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{type:"number",unit:" kWp"}),e.jsx(ne,{type:"category",dataKey:"ausrichtung",width:100}),e.jsx(te,{formatter:m=>[`${m.toFixed(1)} kWp`,"Leistung"]}),e.jsx(Y,{dataKey:"kwp",fill:at.solar,radius:[0,4,4,0],children:F.map((m,h)=>e.jsx(Ce,{fill:m.color},`cell-${h}`))})]})})})]}),j&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(A,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:k,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",className:"text-xs"}),e.jsx(ne,{unit:" kWh",className:"text-xs"}),e.jsx(te,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:m=>[`${m.toFixed(0)} kWh`,""]}),e.jsx(we,{}),e.jsx(Ve,{type:"monotone",dataKey:"Erzeugung",stroke:at.solar,fill:at.solar,fillOpacity:.3}),e.jsx(Ve,{type:"monotone",dataKey:"Eigenverbrauch",stroke:at.consumption,fill:at.consumption,fillOpacity:.3}),e.jsx(Ve,{type:"monotone",dataKey:"Einspeisung",stroke:at.feedin,fill:at.feedin,fillOpacity:.3})]})})})]}),e.jsxs(A,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsx(it,{data:f,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:m,percent:h})=>`${m}: ${(h*100).toFixed(0)}%`,labelLine:!1,children:f.map((m,h)=>e.jsx(Ce,{fill:m.color},`cell-${h}`))}),e.jsx(te,{formatter:m=>[`${m.toFixed(0)} kWh`,""]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(l.gesamtEigenverbrauch/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(l.gesamtEinspeisung/1e3).toFixed(1)," MWh"]})]})]})]})]}),!j&&M&&e.jsxs(A,{className:"text-center py-12",children:[e.jsx(ha,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]})]})}const Zr=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Vs(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState([]),[x,c]=d.useState(!1),[l,o]=d.useState(null);return d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{if(!r)return;(async()=>{c(!0),o(null);try{const p=await ze.getEAutoDashboard(r);i(p)}catch(p){o(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[r]),a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:g=>s(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(le,{type:"error",children:l}),x?e.jsx(ye,{text:"Lade E-Auto Daten..."}):n.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein E-Auto unter "Investitionen" hinzu.'})]})}):n.map(g=>e.jsx(Ks,{dashboard:g},g.investition.id))]})}function Ks({dashboard:t}){var l;const{investition:a,monatsdaten:r,zusammenfassung:s}=t,n=s,i=r.map(o=>({name:`${Zr[o.monat]} ${o.jahr.toString().slice(2)}`,km:o.verbrauch_daten.km_gefahren||0,verbrauch:o.verbrauch_daten.verbrauch_kwh||0,pv:o.verbrauch_daten.ladung_pv_kwh||0,netz:o.verbrauch_daten.ladung_netz_kwh||0,extern:o.verbrauch_daten.ladung_extern_kwh||0,v2h:o.verbrauch_daten.v2h_entladung_kwh||0})),x=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.ladung_extern_kwh||0}].filter(o=>o.value>0),c=[{name:"E-Auto (Strom)",value:n.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:n.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.anzahl_monate," Monate Daten"]})]}),e.jsx(ve,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Gefahren",value:((l=n.gesamt_km)==null?void 0:l.toLocaleString("de-DE"))||"0",unit:"km",icon:ve,color:"blue",formel:"Σ km gefahren",berechnung:`${n.anzahl_monate} Monate`,ergebnis:`= ${(n.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(xe,{title:"Verbrauch",value:(n.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:ge,color:"yellow",formel:"Verbrauch = kWh ÷ km × 100",berechnung:`${(n.gesamt_verbrauch_kwh||0).toFixed(0)} kWh ÷ ${n.gesamt_km||0} km × 100`,ergebnis:`= ${(n.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(xe,{title:"PV-Anteil (Heim)",value:(n.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(n.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:De,color:"green",formel:"PV-Anteil = PV-Ladung ÷ Heimladung × 100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(n.ladung_heim_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(n.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(xe,{title:"Ersparnis vs. Benzin",value:(n.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",subtitle:`+ Wallbox: ${(n.wallbox_ersparnis_euro||0).toFixed(0)} €`,icon:Ne,color:"green",trend:(n.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten − Stromkosten",berechnung:`${(n.benzin_kosten_alternativ_euro||0).toFixed(0)} € − ${(n.strom_kosten_gesamt_euro||0).toFixed(0)} €`,ergebnis:`= ${(n.ersparnis_vs_benzin_euro||0).toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsxs(it,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:o,percent:g})=>`${o}: ${(g*100).toFixed(0)}%`,children:[e.jsx(Ce,{fill:"#22c55e"})," ",e.jsx(Ce,{fill:"#f97316"})," ",e.jsx(Ce,{fill:"#ef4444"})," "]}),e.jsx(te,{formatter:o=>`${o.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(n.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(n.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(n.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(n.ladung_extern_kwh||0).toFixed(0)," kWh (",(n.ladung_extern_euro||0).toFixed(2)," €)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:c,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{type:"number",tickFormatter:o=>`${o}€`}),e.jsx(ne,{type:"category",dataKey:"name",width:120}),e.jsx(te,{formatter:o=>`${o.toFixed(2)} €`}),e.jsx(Y,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(n.ersparnis_vs_benzin_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(Y,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Y,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(Y,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(Y,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(n.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(n.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(n.v2h_ersparnis_euro||0).toFixed(2)," €"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(n.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:r.map(o=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Zr[o.monat]," ",o.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:o.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(o.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(o.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(o.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(o.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},o.id))})]})})]})]})}const Yr=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Bs(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState([]),[x,c]=d.useState(!1),[l,o]=d.useState(null);return d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{if(!r)return;(async()=>{c(!0),o(null);try{const p=await ze.getWaermepumpeDashboard(r);i(p)}catch(p){o(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[r]),a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:g=>s(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(le,{type:"error",children:l}),x?e.jsx(ye,{text:"Lade Wärmepumpe Daten..."}):n.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(_e,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wärmepumpe für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wärmepumpe unter "Investitionen" hinzu.'})]})}):n.map(g=>e.jsx(Os,{dashboard:g},g.investition.id))]})}function Os({dashboard:t}){const{investition:a,monatsdaten:r,zusammenfassung:s}=t,n=s,i=r.map(l=>({name:`${Yr[l.monat]} ${l.jahr.toString().slice(2)}`,strom:l.verbrauch_daten.stromverbrauch_kwh||0,heizung:l.verbrauch_daten.heizenergie_kwh||0,warmwasser:l.verbrauch_daten.warmwasser_kwh||0,cop:((l.verbrauch_daten.heizenergie_kwh||0)+(l.verbrauch_daten.warmwasser_kwh||0))/(l.verbrauch_daten.stromverbrauch_kwh||1)})),x=[{name:"Heizung",value:n.gesamt_heizenergie_kwh},{name:"Warmwasser",value:n.gesamt_warmwasser_kwh}],c=[{name:"Wärmepumpe",value:n.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/Öl",value:n.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.anzahl_monate," Monate Daten"]})]}),e.jsx(_e,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Ø COP",value:n.durchschnitt_cop.toFixed(2),icon:os,color:"orange",formel:"COP = Wärme ÷ Strom",berechnung:`${n.gesamt_waerme_kwh.toFixed(0)} kWh ÷ ${n.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${n.durchschnitt_cop.toFixed(2)}`}),e.jsx(xe,{title:"Wärme erzeugt",value:(n.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:_e,color:"red",formel:"Wärme = Heizung + Warmwasser",berechnung:`${n.gesamt_heizenergie_kwh.toFixed(0)} + ${n.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${n.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(xe,{title:"Strom verbraucht",value:(n.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:ge,color:"yellow",formel:"Σ Stromverbrauch WP",berechnung:`${n.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(xe,{title:"Ersparnis",value:n.ersparnis_euro.toFixed(0),unit:"€",icon:Ne,color:"green",trend:n.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/Öl-Kosten − WP-Kosten",berechnung:`${n.alte_heizung_kosten_euro.toFixed(0)} € − ${n.wp_kosten_euro.toFixed(0)} €`,ergebnis:`= ${n.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsxs(it,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:o})=>`${l}: ${(o*100).toFixed(0)}%`,children:[e.jsx(Ce,{fill:"#ef4444"}),e.jsx(Ce,{fill:"#3b82f6"})]}),e.jsx(te,{formatter:l=>`${l.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",n.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",n.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/Öl"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:c,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{type:"number",tickFormatter:l=>`${l}€`}),e.jsx(ne,{type:"category",dataKey:"name",width:100}),e.jsx(te,{formatter:l=>`${l.toFixed(2)} €`}),e.jsx(Y,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",n.ersparnis_euro.toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Ve,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(Ve,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{domain:[0,6]}),e.jsx(te,{formatter:l=>l.toFixed(2)}),e.jsx(Y,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(De,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis gegenüber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:r.map(l=>{const o=l.verbrauch_daten.stromverbrauch_kwh||0,g=l.verbrauch_daten.heizenergie_kwh||0,p=l.verbrauch_daten.warmwasser_kwh||0,y=o>0?(g+p)/o:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Yr[l.monat]," ",l.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:o.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:g.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:p.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:y.toFixed(2)})]},l.id)})})]})})]})]})}const Ts=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Hs(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState([]),[x,c]=d.useState(!1),[l,o]=d.useState(null);return d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{if(!r)return;(async()=>{c(!0),o(null);try{const p=await ze.getSpeicherDashboard(r);i(p)}catch(p){o(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[r]),a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:g=>s(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(le,{type:"error",children:l}),x?e.jsx(ye,{text:"Lade Speicher Daten..."}):n.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ke,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge einen Speicher unter "Investitionen" hinzu.'})]})}):n.map(g=>e.jsx(Rs,{dashboard:g},g.investition.id))]})}function Rs({dashboard:t}){var x;const{investition:a,monatsdaten:r,zusammenfassung:s}=t,n=s,i=r.map(c=>{const l=c.verbrauch_daten.ladung_kwh||0,o=c.verbrauch_daten.entladung_kwh||0,g=c.verbrauch_daten.speicher_ladung_netz_kwh||0;return{name:`${Ts[c.monat]} ${c.jahr.toString().slice(2)}`,ladung:l,entladung:o,arbitrage:g,pvLadung:l-g,zyklen:n.kapazitaet_kwh>0?l/n.kapazitaet_kwh:0,effizienz:l>0?o/l*100:0}});return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.kapazitaet_kwh," kWh Kapazität • ",n.anzahl_monate," Monate Daten"]})]}),e.jsx(ke,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Vollzyklen",value:n.vollzyklen.toFixed(0),icon:ds,color:"blue",formel:"Vollzyklen = Ladung ÷ Kapazität",berechnung:`${n.gesamt_ladung_kwh.toFixed(0)} kWh ÷ ${n.kapazitaet_kwh} kWh`,ergebnis:`= ${n.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(xe,{title:"Effizienz",value:n.effizienz_prozent.toFixed(1),unit:"%",icon:xa,color:"green",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh ÷ ${n.gesamt_ladung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${n.effizienz_prozent.toFixed(1)} %`}),e.jsx(xe,{title:"Durchsatz",value:(n.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:ge,color:"yellow",formel:"Durchsatz = Σ Entladung",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(xe,{title:"Ersparnis",value:n.ersparnis_euro.toFixed(0),unit:"€",icon:Ne,color:"green",trend:n.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${n.gesamt_entladung_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${n.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:n.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(n.gesamt_ladung_kwh-n.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),n.arbitrage_faehig&&n.arbitrage_kwh>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ya,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h3",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Arbitrage (Netzladung)"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Netzladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[n.arbitrage_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Ø Ladepreis"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[((x=n.arbitrage_avg_preis_cent)==null?void 0:x.toFixed(1))||"-"," ct/kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Anteil an Ladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(n.arbitrage_kwh/n.gesamt_ladung_kwh*100).toFixed(0)," %"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Arbitrage-Gewinn"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:["+",n.arbitrage_gewinn_euro.toFixed(0)," €"]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),n.arbitrage_faehig&&n.arbitrage_kwh>0?e.jsxs(e.Fragment,{children:[e.jsx(Y,{dataKey:"pvLadung",stackId:"ladung",fill:"#3b82f6",name:"PV-Ladung"}),e.jsx(Y,{dataKey:"arbitrage",stackId:"ladung",fill:"#f59e0b",name:"Netz-Ladung"})]}):e.jsx(Y,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(Y,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{formatter:c=>c.toFixed(1)}),e.jsx(Ve,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(fr,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{domain:[80,100]}),e.jsx(te,{formatter:c=>`${c.toFixed(1)}%`}),e.jsx(Qe,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((c,l)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:c.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:c.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:c.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:c.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[c.effizienz.toFixed(1),"%"]})]},l))})]})})]})]})}function Gs(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState([]),[x,c]=d.useState(!1),[l,o]=d.useState(null);return d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{if(!r)return;(async()=>{c(!0),o(null);try{const p=await ze.getWallboxDashboard(r);i(p)}catch(p){o(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[r]),a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rt,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:g=>s(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(le,{type:"error",children:l}),x?e.jsx(ye,{text:"Lade Wallbox Daten..."}):n.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(rt,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wallbox unter "Einstellungen → Investitionen" hinzu.'})]})}):n.map(g=>e.jsx(qs,{dashboard:g},g.investition.id))]})}function qs({dashboard:t}){const{investition:a,zusammenfassung:r}=t,s=r,n=[{name:"Heim: PV",value:s.ladung_pv_kwh||0},{name:"Heim: Netz",value:s.ladung_netz_kwh||0},{name:"Extern",value:s.extern_ladung_kwh||0}].filter(l=>l.value>0),i=[{name:"Heimladung (tatsächlich)",value:s.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:s.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],x=s.leistung_kw||11,c=(s.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[x," kW Ladeleistung • ",s.anzahl_monate||0," Monate Daten"]})]}),e.jsx(rt,{className:"h-10 w-10 text-purple-500"})]}),c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Heimladung",value:((s.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:Ue,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} + ${(s.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(s.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(xe,{title:"PV-Anteil",value:(s.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:De,color:"green",formel:"PV-Anteil = PV ÷ Heimladung × 100",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(s.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(s.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(xe,{title:"Ersparnis vs. Extern",value:(s.ersparnis_vs_extern_euro||0).toFixed(0),unit:"€",subtitle:"Wallbox-ROI",icon:Ne,color:"green",trend:(s.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten − Heim-Kosten",berechnung:`${(s.heim_als_extern_kosten_euro||0).toFixed(0)} € − ${(s.heim_kosten_euro||0).toFixed(0)} €`,ergebnis:`= ${(s.ersparnis_vs_extern_euro||0).toFixed(2)} €`}),e.jsx(xe,{title:"Ladevorgänge",value:(s.gesamt_ladevorgaenge||0).toString(),subtitle:`Ø ${(s.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:ge,color:"blue",formel:"Σ Ladevorgänge",berechnung:`${s.anzahl_monate||0} Monate`,ergebnis:`= ${s.gesamt_ladevorgaenge||0} Vorgänge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsxs(it,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:o})=>`${l}: ${(o*100).toFixed(0)}%`,children:[e.jsx(Ce,{fill:"#22c55e"})," ",e.jsx(Ce,{fill:"#f97316"})," ",e.jsx(Ce,{fill:"#ef4444"})," "]}),e.jsx(te,{formatter:l=>`${l.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(s.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(s.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-red-500"}),"Extern: ",(s.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{type:"number",tickFormatter:l=>`${l}€`}),e.jsx(ne,{type:"category",dataKey:"name",width:150}),e.jsx(te,{formatter:l=>`${l.toFixed(2)} €`}),e.jsx(we,{}),e.jsx(Y,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(s.ersparnis_vs_extern_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklärt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(s.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(s.ladung_netz_kwh||0).toFixed(0)," kWh = ",(s.heim_kosten_euro||0).toFixed(2)," €)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(s.extern_preis_kwh_euro||.5).toFixed(2)," €/kWh"]})]}),(s.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatsächliche externe Ladung: ",(s.extern_ladung_kwh||0).toFixed(0)," kWh für ",(s.extern_kosten_euro||0).toFixed(2)," €"]})]}),a.anschaffungskosten_gesamt&&a.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[s.anzahl_monate&&s.anzahl_monate>0?((s.ersparnis_vs_extern_euro||0)/s.anzahl_monate*12).toFixed(0):0," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const l=s.anzahl_monate&&s.anzahl_monate>0?(s.ersparnis_vs_extern_euro||0)/s.anzahl_monate*12:0;return l<=0?"∞":`${(a.anschaffungskosten_gesamt/l).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen → Monatsdaten".'})})]})}const Js=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function Us(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState([]),[x,c]=d.useState(!1),[l,o]=d.useState(null);return d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{if(!r)return;(async()=>{c(!0),o(null);try{const p=await ze.getBalkonkraftwerkDashboard(r);i(p)}catch(p){o(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[r]),a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:g=>s(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(le,{type:"error",children:l}),x?e.jsx(ye,{text:"Lade Balkonkraftwerk Daten..."}):n.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):n.map(g=>e.jsx(Zs,{dashboard:g},g.investition.id))]})}function Zs({dashboard:t}){const{investition:a,monatsdaten:r,zusammenfassung:s}=t,n=s,i=r.map(l=>({name:`${Js[l.monat]} ${l.jahr.toString().slice(2)}`,erzeugung:l.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:l.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:l.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:l.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:l.verbrauch_daten.speicher_entladung_kwh||0})),x=[{name:"Eigenverbrauch",value:n.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:n.gesamt_einspeisung_kwh}],c=["#22c55e","#f59e0b"];return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.leistung_wp," Wp • ",n.anzahl_module," Module • ",n.anzahl_monate," Monate Daten",n.hat_speicher&&` • ${n.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(X,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Erzeugung",value:n.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:ge,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${n.anzahl_monate} Monate`,ergebnis:`= ${n.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(xe,{title:"Eigenverbrauch",value:n.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:Ue,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh ÷ ${n.gesamt_erzeugung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${n.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(xe,{title:"Ersparnis",value:n.gesamt_ersparnis_euro.toFixed(0),unit:"€",icon:Ne,color:"green",trend:n.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${n.gesamt_ersparnis_euro.toFixed(2)} €`}),e.jsx(xe,{title:"CO₂ gespart",value:n.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:De,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${n.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × 0.4`,ergebnis:`= ${n.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Einspeisung"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[n.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Erlös Einspeisung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.erloes_einspeisung_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsx(it,{data:x,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:o})=>`${l}: ${(o*100).toFixed(0)}%`,children:x.map((l,o)=>e.jsx(Ce,{fill:c[o%c.length]},`cell-${o}`))}),e.jsx(te,{formatter:l=>`${l.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",n.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",n.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Ve,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Ve,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),n.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ke,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",n.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[n.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Y,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(Y,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(De,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[n.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),n.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:i.map((l,o)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:l.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:l.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:l.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:l.einspeisung.toFixed(1)}),n.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:l.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:l.speicher_entladung.toFixed(1)})]})]},o))})]})})]})]})}const Wr=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Mr={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function Ys(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState([]),[x,c]=d.useState(!1),[l,o]=d.useState(null);return d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{if(!r)return;(async()=>{c(!0),o(null);try{const p=await ze.getSonstigesDashboard(r);i(p)}catch(p){o(p instanceof Error?p.message:"Fehler beim Laden")}finally{c(!1)}})()},[r]),a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(jr,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:g=>s(parseInt(g.target.value)),options:t.map(g=>({value:g.id.toString(),label:g.anlagenname}))})]}),l&&e.jsx(le,{type:"error",children:l}),x?e.jsx(ye,{text:"Lade Daten..."}):n.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(jr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):n.map(g=>e.jsx(Qs,{dashboard:g},g.investition.id))]})}function Qs({dashboard:t}){const{investition:a,monatsdaten:r,zusammenfassung:s}=t,n=s,i=n.kategorie;return i==="erzeuger"?e.jsx(Xs,{investition:a,monatsdaten:r,zusammenfassung:n}):i==="verbraucher"?e.jsx(en,{investition:a,monatsdaten:r,zusammenfassung:n}):e.jsx(tn,{investition:a,monatsdaten:r,zusammenfassung:n})}function Xs({investition:t,monatsdaten:a,zusammenfassung:r}){const s=a.map(i=>({name:`${Wr[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0})),n=[{name:"Eigenverbrauch",value:r.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:r.gesamt_einspeisung_kwh||0}];return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:Mr[r.kategorie]})]}),r.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.anzahl_monate," Monate Daten"]})]}),e.jsx(ge,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Erzeugung",value:(r.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:ge,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${r.anzahl_monate} Monate`,ergebnis:`= ${(r.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(xe,{title:"Eigenverbrauch",value:(r.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:Ue,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${(r.gesamt_eigenverbrauch_kwh||0).toFixed(0)} ÷ ${(r.gesamt_erzeugung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(r.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(xe,{title:"Ersparnis",value:(r.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",icon:Ne,color:"green",trend:(r.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${(r.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(r.gesamt_ersparnis_euro||0).toFixed(2)} €`}),e.jsx(xe,{title:"CO₂ gespart",value:(r.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:De,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${(r.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × 0.4`,ergebnis:`= ${(r.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),r.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(We,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[r.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsxs(it,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:x})=>`${i}: ${(x*100).toFixed(0)}%`,children:[e.jsx(Ce,{fill:"#22c55e"}),e.jsx(Ce,{fill:"#f59e0b"})]}),e.jsx(te,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:s,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Ve,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Ve,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:s.map((i,x)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)})]},x))})]})})]})]})}function en({investition:t,monatsdaten:a,zusammenfassung:r}){const s=a.map(i=>({name:`${Wr[i.monat]} ${i.jahr.toString().slice(2)}`,verbrauch:i.verbrauch_daten.verbrauch_kwh||0,bezug_pv:i.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:i.verbrauch_daten.bezug_netz_kwh||0})),n=[{name:"PV-Strom",value:r.bezug_pv_kwh||0},{name:"Netzstrom",value:r.bezug_netz_kwh||0}];return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:Mr[r.kategorie]})]}),r.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.anzahl_monate," Monate Daten"]})]}),e.jsx(ge,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Verbrauch",value:(r.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:ge,color:"blue",formel:"Σ Verbrauch alle Monate",berechnung:`${r.anzahl_monate} Monate`,ergebnis:`= ${(r.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(xe,{title:"PV-Anteil",value:(r.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:Ue,color:"green",formel:"PV-Anteil = PV-Bezug ÷ Verbrauch × 100",berechnung:`${(r.bezug_pv_kwh||0).toFixed(0)} ÷ ${(r.gesamt_verbrauch_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(r.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(xe,{title:"Netzkosten",value:(r.kosten_netz_euro||0).toFixed(0),unit:"€",icon:Ne,color:"red",formel:"Netzkosten = Netzbezug × Strompreis",berechnung:`${(r.bezug_netz_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(r.kosten_netz_euro||0).toFixed(2)} €`}),e.jsx(xe,{title:"PV-Ersparnis",value:(r.ersparnis_pv_euro||0).toFixed(0),unit:"€",icon:De,color:"green",trend:(r.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug × Strompreis",berechnung:`${(r.bezug_pv_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(r.ersparnis_pv_euro||0).toFixed(2)} €`})]}),r.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(We,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[r.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsxs(it,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:x})=>`${i}: ${(x*100).toFixed(0)}%`,children:[e.jsx(Ce,{fill:"#22c55e"}),e.jsx(Ce,{fill:"#ef4444"})]}),e.jsx(te,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:s,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Y,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(Y,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:s.map((i,x)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:i.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:i.bezug_netz.toFixed(1)})]},x))})]})})]})]})}function tn({investition:t,monatsdaten:a,zusammenfassung:r}){const s=a.map(n=>({name:`${Wr[n.monat]} ${n.jahr.toString().slice(2)}`,ladung:n.verbrauch_daten.ladung_kwh||0,entladung:n.verbrauch_daten.entladung_kwh||0}));return e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:Mr[r.kategorie]})]}),r.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:r.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.anzahl_monate," Monate Daten"]})]}),e.jsx(ke,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xe,{title:"Ladung",value:(r.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:ke,color:"purple",formel:"Σ Ladung alle Monate",berechnung:`${r.anzahl_monate} Monate`,ergebnis:`= ${(r.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(xe,{title:"Entladung",value:(r.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:ge,color:"green",formel:"Σ Entladung alle Monate",berechnung:`${r.anzahl_monate} Monate`,ergebnis:`= ${(r.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(xe,{title:"Effizienz",value:(r.effizienz_prozent||0).toFixed(1),unit:"%",icon:Ne,color:"blue",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${(r.gesamt_entladung_kwh||0).toFixed(0)} ÷ ${(r.gesamt_ladung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(r.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(xe,{title:"Ersparnis",value:(r.ersparnis_euro||0).toFixed(0),unit:"€",icon:Ne,color:"green",trend:(r.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${(r.gesamt_entladung_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(r.ersparnis_euro||0).toFixed(2)} €`})]}),r.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(We,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[r.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:s,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{}),e.jsx(te,{}),e.jsx(we,{}),e.jsx(Y,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(Y,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:s.map((n,i)=>{const x=n.ladung>0?n.entladung/n.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:n.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:n.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:n.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[x.toFixed(1),"%"]})]},i)})})]})})]})]})}function rn(t,a){const r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}function er(t,a,r){const s=t.join(";"),n=a.map(c=>c.map(l=>l==null||l===""?"":typeof l=="number"?l.toString().replace(".",","):typeof l=="string"&&(l.includes(";")||l.includes('"'))?`"${l.replace(/"/g,'""')}"`:String(l)).join(";")),i=[s,...n].join(`
`),x=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8"});rn(x,r)}function re({title:t,value:a,unit:r,subtitle:s,icon:n,color:i,bgColor:x,formel:c,berechnung:l,ergebnis:o}){const g=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a," ",e.jsx("span",{className:"text-sm font-normal",children:r})]});return e.jsx(A,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:c?e.jsx(ot,{formel:c,berechnung:l,ergebnis:o,children:g}):g}),s&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:s})]}),e.jsx("div",{className:`p-3 rounded-xl ${x}`,children:e.jsx(n,{className:`h-6 w-6 ${i}`})})]})})}const Ca=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Ze={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},Pe={erzeugung:"#f59e0b",eigenverbrauch:"#8b5cf6",einspeisung:"#10b981",netzbezug:"#ef4444",autarkie:"#3b82f6",evQuote:"#a855f7",spezErtrag:"#eab308",speicherLadung:"#22c55e",speicherEntladung:"#3b82f6",speicherEffizienz:"#06b6d4",wpWaerme:"#ef4444",wpStrom:"#8b5cf6",wpCop:"#f97316",emobPvAnteil:"#10b981"},mt={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},Ft={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function $r(t,a,r){return[...t].sort((n,i)=>n.jahr!==i.jahr?n.jahr-i.jahr:n.monat-i.monat).map(n=>{const i=n.pv_erzeugung_kwh||n.einspeisung_kwh+(n.eigenverbrauch_kwh||0),x=n.eigenverbrauch_kwh||0,c=n.gesamtverbrauch_kwh||x+n.netzbezug_kwh,l=n.direktverbrauch_kwh||0,o=c>0?x/c*100:0,g=i>0?x/i*100:0,p=a!=null&&a.leistung_kwp?i/a.leistung_kwp:0,y=n.batterie_ladung_kwh||0,k=n.batterie_entladung_kwh||0,f=y>0?k/y*100:null,F=0,_=0,j=null,M=0,m=0,h=null,u=r?n.einspeisung_kwh*r.einspeiseverguetung_cent_kwh/100:0,b=r?x*r.netzbezug_arbeitspreis_cent_kwh/100:0,z=r?n.netzbezug_kwh*r.netzbezug_arbeitspreis_cent_kwh/100:0,C=u+b,R=i*.38;return{name:`${Ca[n.monat]} ${n.jahr.toString().slice(-2)}`,jahr:n.jahr,monat:n.monat,erzeugung:i,eigenverbrauch:x,einspeisung:n.einspeisung_kwh,netzbezug:n.netzbezug_kwh,gesamtverbrauch:c,direktverbrauch:l,autarkie:o,evQuote:g,spezErtrag:p,speicher_ladung:y,speicher_entladung:k,speicher_effizienz:f,wp_waerme:F,wp_strom:_,wp_cop:j,eauto_km:M,eauto_ladung:m,eauto_pv_anteil:h,einspeise_erloes:u,ev_ersparnis:b,netzbezug_kosten:z,netto_ertrag:C,co2_einsparung:R}})}function an({data:t,stats:a,anlage:r,strompreis:s}){const n=d.useMemo(()=>$r(t,r,s),[t,r,s]),i=()=>{const c=["Monat","Erzeugung (kWh)","Eigenverbrauch (kWh)","Einspeisung (kWh)","Netzbezug (kWh)","Autarkie (%)","EV-Quote (%)","Spez. Ertrag (kWh/kWp)"],l=n.map(o=>[o.name,o.erzeugung,o.eigenverbrauch,o.einspeisung,o.netzbezug,o.autarkie,o.evQuote,o.spezErtrag]);er(c,l,`energie_${(r==null?void 0:r.anlagenname)||"export"}.csv`)},x=d.useMemo(()=>{if(!s)return null;const c=a.gesamtEinspeisung*s.einspeiseverguetung_cent_kwh/100,l=a.gesamtEigenverbrauch*s.netzbezug_arbeitspreis_cent_kwh/100;return c+l},[a,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahlMonate," Monate Daten"]}),e.jsxs(Z,{variant:"secondary",size:"sm",onClick:i,children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"PV-Erzeugung",value:(a.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:X,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${v(a.gesamtErzeugung,0)} kWh`,ergebnis:`= ${v(a.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(re,{title:"Eigenverbrauch",value:a.gesamtErzeugung>0?(a.gesamtEigenverbrauch/a.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(a.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:ge,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${v(a.gesamtEigenverbrauch,0)} kWh ÷ ${v(a.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${v(a.gesamtEigenverbrauch/a.gesamtErzeugung*100,1)} %`}),e.jsx(re,{title:"Autarkie",value:a.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:Ne,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${v(a.durchschnittAutarkie,1)} %`}),e.jsx(re,{title:"Spez. Ertrag",value:r!=null&&r.leistung_kwp?(a.gesamtErzeugung/r.leistung_kwp).toFixed(0):"---",unit:"kWh/kWp",subtitle:r!=null&&r.leistung_kwp?`${r.leistung_kwp} kWp`:void 0,icon:X,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"PV-Erzeugung ÷ Anlagenleistung",berechnung:r!=null&&r.leistung_kwp?`${v(a.gesamtErzeugung,0)} kWh ÷ ${r.leistung_kwp} kWp`:void 0,ergebnis:r!=null&&r.leistung_kwp?`= ${v(a.gesamtErzeugung/r.leistung_kwp,0)} kWh/kWp`:void 0})]}),e.jsxs(A,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-blue-500"}),"Energie-Bilanz pro Monat"]}),e.jsx("div",{className:"h-80",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{tickFormatter:c=>`${c.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(te,{formatter:(c,l)=>[`${c.toFixed(0)} kWh`,l],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),e.jsx(Y,{dataKey:"eigenverbrauch",name:"Eigenverbrauch",fill:Pe.eigenverbrauch,stackId:"pv"}),e.jsx(Y,{dataKey:"einspeisung",name:"Einspeisung",fill:Pe.einspeisung,stackId:"pv"}),e.jsx(Y,{dataKey:"netzbezug",name:"Netzbezug",fill:Pe.netzbezug})]})})})]}),e.jsxs(A,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-green-500"}),"Effizienz-Trends"]}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{yAxisId:"left",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(ne,{yAxisId:"right",orientation:"right",tickFormatter:c=>`${c.toFixed(0)}`,unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(te,{formatter:(c,l)=>l.includes("kWh/kWp")?[`${c.toFixed(0)} kWh/kWp`,l]:[`${c.toFixed(1)}%`,l],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),e.jsx(Qe,{yAxisId:"left",type:"monotone",dataKey:"autarkie",name:"Autarkie (%)",stroke:Pe.autarkie,strokeWidth:2,dot:!1}),e.jsx(Qe,{yAxisId:"left",type:"monotone",dataKey:"evQuote",name:"EV-Quote (%)",stroke:Pe.evQuote,strokeWidth:2,dot:!1}),e.jsx(Y,{yAxisId:"right",dataKey:"spezErtrag",name:"Spez. Ertrag (kWh/kWp)",fill:Pe.spezErtrag,opacity:.7})]})})})]}),e.jsxs(A,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-yellow-500"}),"PV-Erzeugung Verlauf"]}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(fr,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" kWh",tick:{fontSize:11}}),e.jsx(te,{formatter:c=>[`${c.toFixed(0)} kWh`,"Erzeugung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Qe,{type:"monotone",dataKey:"erzeugung",name:"PV-Erzeugung",stroke:Pe.erzeugung,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[a.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(r==null?void 0:r.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Netto-Ertrag"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:x?`${x.toFixed(0)} €`:"---"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(a.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function sn({anlage:t,strompreis:a}){var _,j,M;const[r,s]=d.useState(null),[n,i]=d.useState(!0),[x,c]=d.useState(null);d.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{i(!0),c(null);try{const h=await _a.getKomponentenZeitreihe(t.id);s(h)}catch(h){c("Fehler beim Laden der Komponentendaten"),console.error(h)}finally{i(!1)}})()},[t==null?void 0:t.id]);const l=d.useMemo(()=>r!=null&&r.monatswerte?r.monatswerte.map(m=>({...m,name:`${Ca[m.monat]} ${m.jahr.toString().slice(-2)}`})):[],[r]),o=d.useMemo(()=>{if(!l.length)return{ladung:0,entladung:0,effizienz:null,arbitrage:0};const m=l.reduce((b,z)=>b+z.speicher_ladung_kwh,0),h=l.reduce((b,z)=>b+z.speicher_entladung_kwh,0),u=l.reduce((b,z)=>b+z.speicher_arbitrage_kwh,0);return{ladung:m,entladung:h,effizienz:m>0?h/m*100:null,arbitrage:u}},[l]),g=d.useMemo(()=>{if(!l.length)return{waerme:0,strom:0,cop:null,heizung:0,warmwasser:0};const m=l.reduce((z,C)=>z+C.wp_waerme_kwh,0),h=l.reduce((z,C)=>z+C.wp_strom_kwh,0),u=l.reduce((z,C)=>z+C.wp_heizung_kwh,0),b=l.reduce((z,C)=>z+C.wp_warmwasser_kwh,0);return{waerme:m,strom:h,cop:h>0?m/h:null,heizung:u,warmwasser:b}},[l]),p=d.useMemo(()=>{if(!l.length)return{km:0,ladung:0,pvAnteil:null,pvLadung:0,netzLadung:0,externLadung:0,externEuro:0,v2h:0};const m=l.reduce((W,H)=>W+H.emob_km,0),h=l.reduce((W,H)=>W+H.emob_ladung_kwh,0),u=l.reduce((W,H)=>W+H.emob_ladung_pv_kwh,0),b=l.reduce((W,H)=>W+H.emob_ladung_netz_kwh,0),z=l.reduce((W,H)=>W+H.emob_ladung_extern_kwh,0),C=l.reduce((W,H)=>W+H.emob_ladung_extern_euro,0),L=l.reduce((W,H)=>W+H.emob_v2h_kwh,0),R=h>0?u/h*100:null;return{km:m,ladung:h,pvAnteil:R,pvLadung:u,netzLadung:b,externLadung:z,externEuro:C,v2h:L}},[l]),y=d.useMemo(()=>l.length?{erzeugung:l.reduce((m,h)=>m+h.bkw_erzeugung_kwh,0),eigenverbrauch:l.reduce((m,h)=>m+h.bkw_eigenverbrauch_kwh,0),speicherLadung:l.reduce((m,h)=>m+h.bkw_speicher_ladung_kwh,0),speicherEntladung:l.reduce((m,h)=>m+h.bkw_speicher_entladung_kwh,0)}:{erzeugung:0,eigenverbrauch:0,speicherLadung:0,speicherEntladung:0},[l]),k=d.useMemo(()=>l.length?{erzeugung:l.reduce((m,h)=>m+h.sonstiges_erzeugung_kwh,0),verbrauch:l.reduce((m,h)=>m+h.sonstiges_verbrauch_kwh,0)}:{erzeugung:0,verbrauch:0},[l]);d.useMemo(()=>l.length?l.reduce((m,h)=>m+h.sonderkosten_euro,0):0,[l]);const f=()=>{if(!l.length)return;const m=["Monat"];r!=null&&r.hat_speicher&&m.push("Speicher Ladung (kWh)","Speicher Entladung (kWh)","Speicher Effizienz (%)"),r!=null&&r.hat_waermepumpe&&m.push("WP Wärme (kWh)","WP Strom (kWh)","WP COP"),r!=null&&r.hat_emobilitaet&&m.push("E-Auto km","E-Auto Ladung (kWh)","E-Auto PV-Anteil (%)"),r!=null&&r.hat_balkonkraftwerk&&m.push("BKW Erzeugung (kWh)","BKW Eigenverbrauch (kWh)"),r!=null&&r.hat_sonstiges&&m.push("Sonstiges Erzeugung (kWh)","Sonstiges Verbrauch (kWh)");const h=l.map(u=>{const b=[u.name];return r!=null&&r.hat_speicher&&b.push(u.speicher_ladung_kwh,u.speicher_entladung_kwh,u.speicher_effizienz_prozent??""),r!=null&&r.hat_waermepumpe&&b.push(u.wp_waerme_kwh,u.wp_strom_kwh,u.wp_cop??""),r!=null&&r.hat_emobilitaet&&b.push(u.emob_km,u.emob_ladung_kwh,u.emob_pv_anteil_prozent??""),r!=null&&r.hat_balkonkraftwerk&&b.push(u.bkw_erzeugung_kwh,u.bkw_eigenverbrauch_kwh),r!=null&&r.hat_sonstiges&&b.push(u.sonstiges_erzeugung_kwh,u.sonstiges_verbrauch_kwh),b});er(m,h,`komponenten_${(t==null?void 0:t.anlagenname)||"export"}.csv`)};return n?e.jsxs(A,{className:"text-center py-12",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto text-gray-400 mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Komponentendaten..."})]}):x?e.jsxs(A,{className:"text-center py-12",children:[e.jsx(We,{className:"h-12 w-12 mx-auto text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:x})]}):r&&(r.hat_speicher||r.hat_waermepumpe||r.hat_emobilitaet||r.hat_balkonkraftwerk||r.hat_sonstiges)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(r==null?void 0:r.anzahl_monate)||0," Monate Daten"]}),e.jsxs(Z,{variant:"secondary",size:"sm",onClick:f,children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),(r==null?void 0:r.hat_speicher)&&o.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ke,{className:"h-6 w-6 text-green-500"}),"Speicher",r.hat_arbitrage&&e.jsx("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded",children:"Arbitrage"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Ladung gesamt",value:(o.ladung/1e3).toFixed(2),unit:"MWh",icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung aller Monate",berechnung:`${v(o.ladung,0)} kWh`,ergebnis:`= ${v(o.ladung/1e3,2)} MWh`}),e.jsx(re,{title:"Entladung gesamt",value:(o.entladung/1e3).toFixed(2),unit:"MWh",icon:ke,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung aller Monate",berechnung:`${v(o.entladung,0)} kWh`,ergebnis:`= ${v(o.entladung/1e3,2)} MWh`}),e.jsx(re,{title:"Ø Effizienz",value:((_=o.effizienz)==null?void 0:_.toFixed(1))||"---",unit:"%",icon:ke,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${v(o.entladung,0)} kWh ÷ ${v(o.ladung,0)} kWh × 100`,ergebnis:o.effizienz?`= ${v(o.effizienz,1)}%`:"---"}),r.hat_arbitrage&&o.arbitrage>0?e.jsx(re,{title:"Arbitrage",value:o.arbitrage.toFixed(0),unit:"kWh",subtitle:"Netzladung",icon:ke,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ Netzladung für Arbitrage"}):e.jsx(re,{title:"Verlust",value:(o.ladung-o.entladung).toFixed(0),unit:"kWh",subtitle:o.effizienz?`${(100-o.effizienz).toFixed(1)}%`:void 0,icon:ke,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Speicher pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:l.filter(m=>m.speicher_ladung_kwh>0||m.speicher_entladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{yAxisId:"left",tickFormatter:m=>`${m.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ne,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(te,{formatter:(m,h)=>h.includes("Effizienz")?[`${(m==null?void 0:m.toFixed(1))||"---"}%`,h]:[`${m.toFixed(0)} kWh`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),e.jsx(Y,{yAxisId:"left",dataKey:"speicher_ladung_kwh",name:"Ladung",fill:Pe.speicherLadung}),e.jsx(Y,{yAxisId:"left",dataKey:"speicher_entladung_kwh",name:"Entladung",fill:Pe.speicherEntladung}),r.hat_arbitrage&&e.jsx(Y,{yAxisId:"left",dataKey:"speicher_arbitrage_kwh",name:"Arbitrage (Netz)",fill:"#8b5cf6"}),e.jsx(Qe,{yAxisId:"right",type:"monotone",dataKey:"speicher_effizienz_prozent",name:"Effizienz (%)",stroke:Pe.speicherEffizienz,strokeWidth:2,dot:!1})]})})})]})]}),(r==null?void 0:r.hat_waermepumpe)&&g.strom>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(_e,{className:"h-6 w-6 text-red-500"}),"Wärmepumpe"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Wärme erzeugt",value:(g.waerme/1e3).toFixed(2),unit:"MWh",icon:_e,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Wärme aller Monate",berechnung:`${v(g.waerme,0)} kWh`,ergebnis:`= ${v(g.waerme/1e3,2)} MWh`}),e.jsx(re,{title:"Strom verbraucht",value:(g.strom/1e3).toFixed(2),unit:"MWh",icon:_e,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Strom aller Monate",berechnung:`${v(g.strom,0)} kWh`,ergebnis:`= ${v(g.strom/1e3,2)} MWh`}),e.jsx(re,{title:"Ø COP",value:((j=g.cop)==null?void 0:j.toFixed(2))||"---",unit:"",subtitle:"Jahresarbeitszahl",icon:_e,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${v(g.waerme,0)} kWh ÷ ${v(g.strom,0)} kWh`,ergebnis:g.cop?`= ${v(g.cop,2)} COP`:"---"}),e.jsx(re,{title:"Ersparnis vs. Gas",value:a?(g.waerme*.08-g.strom*a.netzbezug_arbeitspreis_cent_kwh/100).toFixed(0):"---",unit:"€",subtitle:"ca. 8 ct/kWh Gas",icon:_e,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]}),(g.heizung>0||g.warmwasser>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Heizung",value:(g.heizung/1e3).toFixed(2),unit:"MWh",subtitle:g.waerme>0?`${(g.heizung/g.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:_e,color:"text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizenergie aller Monate"}),e.jsx(re,{title:"Warmwasser",value:(g.warmwasser/1e3).toFixed(2),unit:"MWh",subtitle:g.waerme>0?`${(g.warmwasser/g.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:_e,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Warmwasser-Energie aller Monate"})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Wärmepumpe pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:l.filter(m=>m.wp_waerme_kwh>0||m.wp_strom_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{yAxisId:"left",tickFormatter:m=>`${m.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(ne,{yAxisId:"right",orientation:"right",domain:[0,"auto"],tick:{fontSize:11}}),e.jsx(te,{formatter:(m,h)=>h==="COP"?[`${(m==null?void 0:m.toFixed(2))||"---"}`,h]:[`${m.toFixed(0)} kWh`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),g.heizung>0||g.warmwasser>0?e.jsxs(e.Fragment,{children:[e.jsx(Y,{yAxisId:"left",dataKey:"wp_heizung_kwh",name:"Heizung",stackId:"waerme",fill:"#f87171"}),e.jsx(Y,{yAxisId:"left",dataKey:"wp_warmwasser_kwh",name:"Warmwasser",stackId:"waerme",fill:"#60a5fa"})]}):e.jsx(Y,{yAxisId:"left",dataKey:"wp_waerme_kwh",name:"Wärme",fill:Pe.wpWaerme}),e.jsx(Y,{yAxisId:"left",dataKey:"wp_strom_kwh",name:"Strom",fill:Pe.wpStrom}),e.jsx(Qe,{yAxisId:"right",type:"monotone",dataKey:"wp_cop",name:"COP",stroke:Pe.wpCop,strokeWidth:2,dot:!1})]})})})]})]}),(r==null?void 0:r.hat_emobilitaet)&&p.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ve,{className:"h-6 w-6 text-purple-500"}),"E-Mobilität",r.hat_v2h&&e.jsx("span",{className:"text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 px-2 py-0.5 rounded",children:"V2H"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Gefahrene km",value:(p.km/1e3).toFixed(1),unit:"Tkm",icon:ve,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene km aller Monate",berechnung:`${v(p.km,0)} km`,ergebnis:`= ${v(p.km/1e3,1)} Tausend km`}),e.jsx(re,{title:"Ladung gesamt",value:(p.ladung/1e3).toFixed(2),unit:"MWh",icon:ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ E-Auto-Ladung aller Monate",berechnung:`${v(p.ladung,0)} kWh`,ergebnis:`= ${v(p.ladung/1e3,2)} MWh`}),e.jsx(re,{title:"Ø PV-Anteil",value:((M=p.pvAnteil)==null?void 0:M.toFixed(0))||"---",unit:"%",icon:ve,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Ladung ÷ Gesamtladung × 100",berechnung:`${v(p.pvLadung,0)} kWh ÷ ${v(p.ladung,0)} kWh × 100`,ergebnis:p.pvAnteil?`= ${v(p.pvAnteil,0)}%`:"---"}),e.jsx(re,{title:"Verbrauch",value:p.km>0?(p.ladung/p.km*100).toFixed(1):"---",unit:"kWh/100km",icon:ve,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Ladung ÷ km × 100",berechnung:`${v(p.ladung,0)} kWh ÷ ${v(p.km,0)} km × 100`,ergebnis:p.km>0?`= ${v(p.ladung/p.km*100,1)} kWh/100km`:"---"})]}),(p.pvLadung>0||p.netzLadung>0||p.externLadung>0||p.v2h>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"PV-Ladung",value:p.pvLadung.toFixed(0),unit:"kWh",subtitle:p.ladung>0?`${(p.pvLadung/p.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:X,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ Ladung aus eigener PV"}),e.jsx(re,{title:"Netz-Ladung",value:p.netzLadung.toFixed(0),unit:"kWh",subtitle:p.ladung>0?`${(p.netzLadung/p.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:ge,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Ladung aus Netzstrom"}),p.externLadung>0&&e.jsx(re,{title:"Extern geladen",value:p.externLadung.toFixed(0),unit:"kWh",subtitle:p.externEuro>0?`${v(p.externEuro,2)} €`:void 0,icon:ve,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Σ Ladung an öffentlichen Säulen"}),r.hat_v2h&&p.v2h>0&&e.jsx(re,{title:"V2H Entladung",value:p.v2h.toFixed(0),unit:"kWh",subtitle:a?`≈ ${v(p.v2h*a.netzbezug_arbeitspreis_cent_kwh/100,0)} € Ersparnis`:void 0,icon:ke,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Σ Rückspeisung ins Haus (Vehicle-to-Home)"})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"E-Mobilität pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:l.filter(m=>m.emob_km>0||m.emob_ladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{yAxisId:"left",tick:{fontSize:11}}),e.jsx(ne,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(te,{formatter:(m,h)=>h.includes("PV-Anteil")?[`${(m==null?void 0:m.toFixed(0))||"---"}%`,h]:h.includes("km")?[`${m.toFixed(0)} km`,h]:h.includes("€")?[`${m.toFixed(2)} €`,h]:[`${m.toFixed(0)} kWh`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),e.jsx(Y,{yAxisId:"left",dataKey:"emob_ladung_pv_kwh",name:"PV-Ladung",stackId:"ladung",fill:"#f59e0b"}),e.jsx(Y,{yAxisId:"left",dataKey:"emob_ladung_netz_kwh",name:"Netz-Ladung",stackId:"ladung",fill:"#ef4444"}),p.externLadung>0&&e.jsx(Y,{yAxisId:"left",dataKey:"emob_ladung_extern_kwh",name:"Extern",stackId:"ladung",fill:"#f97316"}),r.hat_v2h&&e.jsx(Y,{yAxisId:"left",dataKey:"emob_v2h_kwh",name:"V2H",fill:"#06b6d4"}),e.jsx(Qe,{yAxisId:"right",type:"monotone",dataKey:"emob_pv_anteil_prozent",name:"PV-Anteil (%)",stroke:Pe.emobPvAnteil,strokeWidth:2,dot:!1})]})})})]})]}),(r==null?void 0:r.hat_balkonkraftwerk)&&y.erzeugung>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(X,{className:"h-6 w-6 text-yellow-500"}),"Balkonkraftwerk",y.speicherLadung>0&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded",children:"mit Speicher"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Die BKW-Erzeugung ist in der PV-Gesamterzeugung enthalten, wird hier aber separat ausgewiesen."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Erzeugung gesamt",value:y.erzeugung.toFixed(0),unit:"kWh",icon:X,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ BKW-Erzeugung aller Monate",berechnung:`${v(y.erzeugung,0)} kWh`,ergebnis:`= ${v(y.erzeugung,0)} kWh`}),e.jsx(re,{title:"Eigenverbrauch",value:y.eigenverbrauch.toFixed(0),unit:"kWh",icon:X,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Eigenverbrauch aller Monate",berechnung:`${v(y.eigenverbrauch,0)} kWh`,ergebnis:`= ${v(y.eigenverbrauch,0)} kWh`}),e.jsx(re,{title:"EV-Quote",value:y.erzeugung>0?(y.eigenverbrauch/y.erzeugung*100).toFixed(0):"---",unit:"%",icon:X,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${v(y.eigenverbrauch,0)} kWh ÷ ${v(y.erzeugung,0)} kWh × 100`,ergebnis:y.erzeugung>0?`= ${v(y.eigenverbrauch/y.erzeugung*100,0)}%`:"---"}),e.jsx(re,{title:"Einspeisung",value:(y.erzeugung-y.eigenverbrauch).toFixed(0),unit:"kWh",subtitle:"geschätzt",icon:X,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"})]}),y.speicherLadung>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Speicher Ladung",value:y.speicherLadung.toFixed(0),unit:"kWh",icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Speicher Ladung"}),e.jsx(re,{title:"Speicher Entladung",value:y.speicherEntladung.toFixed(0),unit:"kWh",icon:ke,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ BKW-Speicher Entladung"}),e.jsx(re,{title:"Speicher Effizienz",value:y.speicherLadung>0?(y.speicherEntladung/y.speicherLadung*100).toFixed(0):"---",unit:"%",icon:ke,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100"})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Balkonkraftwerk pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:l.filter(m=>m.bkw_erzeugung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" kWh",tick:{fontSize:11}}),e.jsx(te,{formatter:(m,h)=>[`${m.toFixed(0)} kWh`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),e.jsx(Y,{dataKey:"bkw_erzeugung_kwh",name:"Erzeugung",fill:"#f59e0b"}),e.jsx(Y,{dataKey:"bkw_eigenverbrauch_kwh",name:"Eigenverbrauch",fill:"#10b981"}),y.speicherLadung>0&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{dataKey:"bkw_speicher_ladung_kwh",name:"Speicher Ladung",fill:"#22c55e"}),e.jsx(Y,{dataKey:"bkw_speicher_entladung_kwh",name:"Speicher Entladung",fill:"#3b82f6"})]})]})})})]})]}),(r==null?void 0:r.hat_sonstiges)&&(k.erzeugung>0||k.verbrauch>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ge,{className:"h-6 w-6 text-gray-500"}),"Sonstige Komponenten"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:'Aggregiert alle Investitionen vom Typ "Sonstiges" (z.B. Mini-BHKW, Pool-Pumpe).'})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[k.erzeugung>0&&e.jsx(re,{title:"Erzeugung gesamt",value:k.erzeugung.toFixed(0),unit:"kWh",icon:ge,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"}),k.verbrauch>0&&e.jsx(re,{title:"Verbrauch gesamt",value:k.verbrauch.toFixed(0),unit:"kWh",icon:ge,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20"}),k.erzeugung>0&&k.verbrauch>0&&e.jsx(re,{title:"Netto",value:(k.erzeugung-k.verbrauch).toFixed(0),unit:"kWh",icon:ge,color:k.erzeugung-k.verbrauch>=0?"text-green-500":"text-red-500",bgColor:k.erzeugung-k.verbrauch>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Sonstige Komponenten pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:l.filter(m=>m.sonstiges_erzeugung_kwh>0||m.sonstiges_verbrauch_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" kWh",tick:{fontSize:11}}),e.jsx(te,{formatter:(m,h)=>[`${m.toFixed(0)} kWh`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),k.erzeugung>0&&e.jsx(Y,{dataKey:"sonstiges_erzeugung_kwh",name:"Erzeugung",fill:"#10b981"}),k.verbrauch>0&&e.jsx(Y,{dataKey:"sonstiges_verbrauch_kwh",name:"Verbrauch",fill:"#ef4444"})]})})})]})]}),r&&(r.hat_waermepumpe&&g.strom===0||r.hat_emobilitaet&&p.ladung===0||r.hat_balkonkraftwerk&&y.erzeugung===0||r.hat_sonstiges&&k.erzeugung===0&&k.verbrauch===0)&&e.jsx(A,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(We,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Komponenten ohne Monatsdaten"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Einige Investitionen sind angelegt, haben aber noch keine Monatsdaten. Erfasse monatliche Verbrauchsdaten unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"}),"."]})]})]})})]}):e.jsxs(A,{className:"text-center py-12",children:[e.jsx(We,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Komponentendaten vorhanden"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:["Erfasse Daten für Speicher, Wärmepumpe, E-Auto, Balkonkraftwerk oder Sonstiges unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," und füge Monatsdaten hinzu."]})]})}function nn({data:t,stats:a,strompreis:r}){if(!r)return e.jsxs(A,{className:"text-center py-8",children:[e.jsx(dt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const s=d.useMemo(()=>$r(t,void 0,r),[t,r]),n=d.useMemo(()=>{let c=0;return s.map(l=>(c+=l.netto_ertrag,{...l,kumuliert_ertrag:c}))},[s]),i=d.useMemo(()=>{const c=a.gesamtEinspeisung*r.einspeiseverguetung_cent_kwh/100,l=a.gesamtNetzbezug*r.netzbezug_arbeitspreis_cent_kwh/100,o=a.gesamtEigenverbrauch*r.netzbezug_arbeitspreis_cent_kwh/100,g=c+o;return{einspeiseErloes:c,netzbezugKosten:l,eigenverbrauchErsparnis:o,nettoErtrag:g}},[a,r]),x=()=>{const c=["Monat","Einspeiseerlös (€)","EV-Ersparnis (€)","Netzbezug-Kosten (€)","Netto-Ertrag (€)","Kumulierter Ertrag (€)"],l=n.map(o=>[o.name,o.einspeise_erloes,o.ev_ersparnis,o.netzbezug_kosten,o.netto_ertrag,o.kumuliert_ertrag]);er(c,l,"finanzen_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahlMonate," Monate Daten"]}),e.jsxs(Z,{variant:"secondary",size:"sm",onClick:x,children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Einspeiseerlös",value:i.einspeiseErloes.toFixed(0),unit:"€",subtitle:`${r.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:Ne,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Einspeisevergütung",berechnung:`${v(a.gesamtEinspeisung,0)} kWh × ${v(r.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${v(i.einspeiseErloes,2)} €`}),e.jsx(re,{title:"EV-Ersparnis",value:i.eigenverbrauchErsparnis.toFixed(0),unit:"€",subtitle:"vermiedener Netzbezug",icon:dt,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Netzbezugspreis",berechnung:`${v(a.gesamtEigenverbrauch,0)} kWh × ${v(r.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${v(i.eigenverbrauchErsparnis,2)} €`}),e.jsx(re,{title:"Netzbezug-Kosten",value:i.netzbezugKosten.toFixed(0),unit:"€",subtitle:`${r.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:dt,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug × Netzbezugspreis",berechnung:`${v(a.gesamtNetzbezug,0)} kWh × ${v(r.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${v(i.netzbezugKosten,2)} €`}),e.jsx(re,{title:"Netto-Ertrag",value:i.nettoErtrag.toFixed(0),unit:"€",subtitle:"Gesamt",icon:dt,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Einspeiseerlös + EV-Ersparnis",berechnung:`${v(i.einspeiseErloes,2)} € + ${v(i.eigenverbrauchErsparnis,2)} €`,ergebnis:`= ${v(i.nettoErtrag,2)} €`})]}),e.jsxs(A,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(dt,{className:"h-5 w-5 text-green-500"}),"Finanzielle Bilanz pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:s,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" €",tick:{fontSize:11}}),e.jsx(te,{formatter:(c,l)=>[`${c.toFixed(2)} €`,l],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(we,{}),e.jsx(Y,{dataKey:"einspeise_erloes",name:"Einspeiseerlös",fill:Ze.feedin,stackId:"pos"}),e.jsx(Y,{dataKey:"ev_ersparnis",name:"EV-Ersparnis",fill:Ze.consumption,stackId:"pos"}),e.jsx(Y,{dataKey:"netzbezug_kosten",name:"Netzbezug (negativ)",fill:Ze.grid})]})})})]}),e.jsxs(A,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-500"}),"Kumulierter Netto-Ertrag"]}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" €",tick:{fontSize:11}}),e.jsx(te,{formatter:c=>[`${c.toFixed(0)} €`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ve,{type:"monotone",dataKey:"kumuliert_ertrag",name:"Kumulierter Ertrag",stroke:Ze.feedin,fill:Ze.feedin,fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",a.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[i.nettoErtrag.toFixed(0)," €"]})]})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Netto-Ertrag pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:s,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" €",tick:{fontSize:11}}),e.jsx(te,{formatter:c=>[`${c.toFixed(2)} €`,"Netto-Ertrag"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Y,{dataKey:"netto_ertrag",name:"Netto-Ertrag",fill:Ze.feedin,opacity:.7}),e.jsx(Qe,{type:"monotone",dataKey:"netto_ertrag",name:"Trend",stroke:Ze.solar,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Durchschnittswerte"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Einspeiseerlös/Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i.einspeiseErloes/a.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø EV-Ersparnis/Monat"}),e.jsxs("p",{className:"font-medium text-purple-600",children:[(i.eigenverbrauchErsparnis/a.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netzbezug-Kosten/Monat"}),e.jsxs("p",{className:"font-medium text-red-600",children:[(i.netzbezugKosten/a.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netto-Ertrag/Monat"}),e.jsxs("p",{className:"font-medium text-blue-600",children:[(i.nettoErtrag/a.anzahlMonate).toFixed(0)," €"]})]})]})]})]})}const Bt=.38;function ln({data:t,stats:a}){const r=d.useMemo(()=>$r(t),[t]),s=d.useMemo(()=>{let o=0;return r.map(g=>(o+=g.co2_einsparung,{...g,kumuliert_co2:o}))},[r]),n=a.gesamtErzeugung*Bt,i=n/12.5,x=n/.12,c=n/230,l=()=>{const o=["Monat","CO2-Einsparung (kg)","Kumuliert (kg)","Kumuliert (t)"],g=s.map(p=>[p.name,p.co2_einsparung,p.kumuliert_co2,p.kumuliert_co2/1e3]);er(o,g,"co2_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahlMonate," Monate Daten"]}),e.jsxs(Z,{variant:"secondary",size:"sm",onClick:l,children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"CO2 eingespart",value:(n/1e3).toFixed(2),unit:"t",subtitle:`${a.anzahlMonate} Monate`,icon:De,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung × CO2-Faktor",berechnung:`${v(a.gesamtErzeugung,0)} kWh × ${Bt*1e3} g/kWh`,ergebnis:`= ${v(n,0)} kg = ${v(n/1e3,2)} t`}),e.jsx(re,{title:"Bäume äquivalent",value:i.toFixed(0),unit:"Bäume/Jahr",subtitle:"Bindungsleistung",icon:De,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung ÷ 12,5 kg/Baum/Jahr",berechnung:`${v(n,0)} kg ÷ 12,5 kg/Baum`,ergebnis:`= ${v(i,0)} Bäume`}),e.jsx(re,{title:"Auto-km vermieden",value:(x/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:De,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung ÷ 120 g/km",berechnung:`${v(n*1e3,0)} g ÷ 120 g/km`,ergebnis:`= ${v(x,0)} km`}),e.jsx(re,{title:"Kurzstreckenflüge",value:c.toFixed(1),unit:"Flüge",subtitle:"à 1000 km",icon:De,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"CO2-Einsparung ÷ 230 kg/Flug",berechnung:`${v(n,0)} kg ÷ 230 kg/Flug`,ergebnis:`= ${v(c,1)} Flüge vermieden`})]}),e.jsxs(A,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-green-500"}),"CO2-Einsparung pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:r,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{unit:" kg",tick:{fontSize:11}}),e.jsx(te,{formatter:o=>[`${o.toFixed(0)} kg CO2`,"Einsparung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Y,{dataKey:"co2_einsparung",name:"CO2 eingespart",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kumulierte CO2-Einsparung"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:s,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(ne,{tickFormatter:o=>`${(o/1e3).toFixed(1)}`,unit:" t",tick:{fontSize:11}}),e.jsx(te,{formatter:o=>[`${(o/1e3).toFixed(2)} t CO2`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ve,{type:"monotone",dataKey:"kumuliert_co2",name:"Kumulierte Einsparung",stroke:"#10b981",fill:"#10b981",fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",a.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[(n/1e3).toFixed(2)," t CO2"]})]})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",e.jsxs("strong",{children:[Bt*1e3," g CO2/kWh"]})," berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(n/a.anzahlMonate).toFixed(0)," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro kWh"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(Bt*1e3).toFixed(0)," g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Jahr"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(n/a.anzahlMonate*12/1e3).toFixed(2)," t"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Hochgerechnet 20 Jahre"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(n/a.anzahlMonate*12*20/1e3).toFixed(1)," t"]})]})]})]})]})}function dn({anlageId:t,strompreis:a,selectedYear:r="all"}){var _,j,M;const{investitionen:s,loading:n}=It(t),[i,x]=d.useState(null),[c,l]=d.useState(!0),[o,g]=d.useState(new Set);d.useEffect(()=>{(async()=>{try{l(!0);const h=await ze.getROIDashboard(t,a==null?void 0:a.netzbezug_arbeitspreis_cent_kwh,a==null?void 0:a.einspeiseverguetung_cent_kwh,void 0,r);x(h)}catch(h){console.error("ROI-Dashboard Fehler:",h)}finally{l(!1)}})()},[t,a,r]);const p=d.useMemo(()=>{const m={};return s.forEach(h=>{m[h.typ]||(m[h.typ]=[]),m[h.typ].push(h)}),m},[s]),y=d.useMemo(()=>Object.entries(p).map(([m,h])=>({typ:m,label:Ft[m]||m,kosten:h.reduce((u,b)=>u+(b.anschaffungskosten_gesamt||0),0),color:mt[m]||"#6b7280"})).filter(m=>m.kosten>0).sort((m,h)=>h.kosten-m.kosten),[p]),k=d.useMemo(()=>{if(!i||!i.gesamt_jahres_einsparung)return[];const m=i.gesamt_relevante_kosten,h=i.gesamt_jahres_einsparung,u=[];for(let b=0;b<=25;b++){const z=b*h;u.push({jahr:b,investition:m,ersparnis:z,bilanz:z-m})}return u},[i]);if(n||c)return e.jsx(ye,{text:"Lade Investitionsdaten..."});if(s.length===0)return e.jsxs(A,{className:"text-center py-8",children:[e.jsx(_t,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const f=(_=i==null?void 0:i.berechnungen.find(m=>m.investition_typ==="pv-module"))==null?void 0:_.detail_berechnung,F=f==null?void 0:f.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(re,{title:"Gesamtinvestition",value:((i==null?void 0:i.gesamt_relevante_kosten)||0).toFixed(0),unit:"€",subtitle:`${s.length} Komponenten`,icon:gs,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten − Alternativkosten",berechnung:i?`${v(i.gesamt_investition,0)} € − ${v(i.gesamt_investition-i.gesamt_relevante_kosten,0)} € Alternativ`:void 0,ergebnis:i?`= ${v(i.gesamt_relevante_kosten,0)} € relevante Kosten`:void 0}),e.jsx(re,{title:"Jahresersparnis",value:((i==null?void 0:i.gesamt_jahres_einsparung)||0).toFixed(0),unit:"€/Jahr",icon:Ne,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + Eigenverbrauch-Ersparnis",berechnung:f?`${v(f.einspeise_erloes_euro,2)} € + ${v(f.ev_ersparnis_euro,2)} €`:"Σ aller Investitions-Einsparungen",ergebnis:F||(i?`= ${v(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0)}),e.jsx(re,{title:"ROI",value:((j=i==null?void 0:i.gesamt_roi_prozent)==null?void 0:j.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:Ne,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis ÷ Relevante Kosten × 100",berechnung:i&&i.gesamt_relevante_kosten>0?`${v(i.gesamt_jahres_einsparung,0)} € ÷ ${v(i.gesamt_relevante_kosten,0)} € × 100`:void 0,ergebnis:i!=null&&i.gesamt_roi_prozent?`= ${i.gesamt_roi_prozent.toFixed(1)}% ROI p.a.`:void 0}),e.jsx(re,{title:"Amortisation",value:((M=i==null?void 0:i.gesamt_amortisation_jahre)==null?void 0:M.toFixed(1))||"---",unit:"Jahre",icon:Dt,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten ÷ Jahresersparnis",berechnung:i&&i.gesamt_jahres_einsparung>0?`${v(i.gesamt_relevante_kosten,0)} € ÷ ${v(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:i!=null&&i.gesamt_amortisation_jahre?`= ${i.gesamt_amortisation_jahre.toFixed(1)} Jahre bis zur Kostendeckung`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsx(it,{data:y,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:m,percent:h})=>`${m}: ${(h*100).toFixed(0)}%`,labelLine:!1,children:y.map((m,h)=>e.jsx(Ce,{fill:m.color},`cell-${h}`))}),e.jsx(te,{formatter:m=>[`${m.toFixed(0)} €`,""]})]})})})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:y,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{type:"number",unit:" €",tick:{fontSize:11}}),e.jsx(ne,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(te,{formatter:m=>[`${m.toFixed(0)} €`,""]}),e.jsx(Y,{dataKey:"kosten",name:"Kosten",children:y.map((m,h)=>e.jsx(Ce,{fill:m.color},`cell-${h}`))})]})})})]})]}),k.length>0&&e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(gt,{data:k,children:[e.jsx(ce,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(oe,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(ne,{unit:" €",tick:{fontSize:11}}),e.jsx(te,{formatter:m=>[`${m.toFixed(0)} €`,""]}),e.jsx(we,{}),e.jsx(Ve,{type:"monotone",dataKey:"investition",name:"Investition",stroke:Ze.grid,fill:Ze.grid,fillOpacity:.3}),e.jsx(Ve,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:Ze.feedin,fill:Ze.feedin,fillOpacity:.3})]})})}),(i==null?void 0:i.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",i.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(i==null?void 0:i.berechnungen)&&i.berechnungen.length>0&&(()=>{const m=i.berechnungen.filter(b=>{var z;return b.investition_typ==="pv-module"&&typeof((z=b.detail_berechnung)==null?void 0:z.hinweis)=="string"&&b.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),h=i.berechnungen.filter(b=>{var z;return b.investition_typ==="wechselrichter"&&typeof((z=b.detail_berechnung)==null?void 0:z.hinweis)=="string"&&b.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),u=m.length>0||h.length>0;return e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),u&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollständig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[m.length>0&&e.jsxs("li",{children:[m.length," PV-Modul",m.length>1?"e":""," ohne Wechselrichter-Zuordnung → Bitte unter Einstellungen → Investitionen zuordnen"]}),h.length>0&&e.jsxs("li",{children:[h.length," Wechselrichter ohne PV-Module → Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.berechnungen.map(b=>{var se,he;const z=b.anschaffungskosten_alternativ>0,C=z?"Anschaffung − Alternativkosten":"Anschaffungskosten (keine Alternative)",L=z?`${v(b.anschaffungskosten,0)} € − ${v(b.anschaffungskosten_alternativ,0)} €`:`${v(b.anschaffungskosten,0)} €`,R=`= ${v(b.relevante_kosten,0)} € Mehrkosten`,H=(b.detail_berechnung||{}).hinweis,D=b.investition_typ==="pv-system"&&b.komponenten&&b.komponenten.length>0,S=o.has(b.investition_id),B=b.investition_typ==="pv-module"&&typeof H=="string"&&H.includes("ohne Wechselrichter"),N=b.investition_typ==="wechselrichter"&&typeof H=="string"&&H.includes("ohne zugeordnete PV-Module"),V=()=>{g(ie=>{const me=new Set(ie);return me.has(b.investition_id)?me.delete(b.investition_id):me.add(b.investition_id),me})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${D?"cursor-pointer":""}`,onClick:D?V:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[D&&(S?e.jsx(Yt,{className:"h-4 w-4 text-gray-400"}):e.jsx(bt,{className:"h-4 w-4 text-gray-400"})),(B||N)&&e.jsx("span",{title:B?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(Ke,{className:"h-4 w-4 text-amber-500"})}),b.investition_bezeichnung,D&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",b.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${mt[b.investition_typ]||"#6b7280"}20`,color:mt[b.investition_typ]||"#6b7280"},children:Ft[b.investition_typ]||b.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(ot,{formel:C,berechnung:L,ergebnis:R,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[b.relevante_kosten.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(ot,{formel:`Jahresersparnis ${Ft[b.investition_typ]||b.investition_typ}`,berechnung:H||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${v(b.jahres_einsparung,0)} €/Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[b.jahres_einsparung.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(ot,{formel:"Ersparnis ÷ Mehrkosten × 100",berechnung:`${v(b.jahres_einsparung,0)} € ÷ ${v(b.relevante_kosten,0)} € × 100`,ergebnis:b.roi_prozent?`= ${b.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((se=b.roi_prozent)==null?void 0:se.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(ot,{formel:"Mehrkosten ÷ Ersparnis",berechnung:`${v(b.relevante_kosten,0)} € ÷ ${v(b.jahres_einsparung,0)} €/Jahr`,ergebnis:b.amortisation_jahre?`= ${b.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((he=b.amortisation_jahre)==null?void 0:he.toFixed(1))||"---"," J."]})})})]},b.investition_id),D&&S&&b.komponenten.map(ie=>{var me,je;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:mt[ie.typ]||"#6b7280"}}),ie.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${mt[ie.typ]||"#6b7280"}15`,color:mt[ie.typ]||"#6b7280"},children:Ft[ie.typ]||ie.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[ie.relevante_kosten.toFixed(0)," €"]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:ie.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[ie.einsparung.toFixed(0)," €"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((me=ie.detail)==null?void 0:me.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[ie.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((je=ie.detail)==null?void 0:je.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:ie.detail.hinweis})]})]},`komp-${ie.investition_id}`)})]})})})]})})]})})(),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(p).map(([m,h])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:mt[m]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Ft[m]||m}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",h.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:h.map(u=>{var b;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:u.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((b=u.anschaffungskosten_gesamt)==null?void 0:b.toFixed(0))||"0"," €"]})]},u.id)})})]},m))})]})]})}function Qr(){var m;const t=Ut(),[a,r]=d.useState("energie"),[s,n]=d.useState("all"),{anlagen:i,loading:x}=Me(),[c,l]=d.useState(null),o=c??((m=i[0])==null?void 0:m.id),g=i.find(h=>h.id===o),{monatsdaten:p,loading:y}=Cr(o),{strompreis:k}=Sa(o??null),f=d.useMemo(()=>[...new Set(p.map(u=>u.jahr))].sort((u,b)=>b-u),[p]),F=d.useMemo(()=>s==="all"?p:p.filter(h=>h.jahr===s),[p,s]),_=za(F);if(x||y)return e.jsx(ye,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(le,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(p.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(A,{className:"text-center py-12",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(Z,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(Je,{className:"h-4 w-4 ml-2"})]})]})]});const M=[{key:"energie",label:"Energie"},{key:"komponenten",label:"Komponenten"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"},{key:"investitionen",label:"Investitionen"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:s,onChange:h=>n(h.target.value==="all"?"all":Number(h.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),f.map(h=>e.jsx("option",{value:h,children:h},h))]}),i.length>1&&e.jsx("select",{value:o??"",onChange:h=>l(Number(h.target.value)),className:"input w-auto",children:i.map(h=>e.jsx("option",{value:h.id,children:h.anlagenname},h.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:M.map(h=>e.jsx("button",{onClick:()=>r(h.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${a===h.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:h.label},h.key))})}),a==="energie"&&e.jsx(an,{data:F,stats:_,anlage:g,strompreis:k}),a==="komponenten"&&e.jsx(sn,{anlage:g,strompreis:k}),a==="finanzen"&&e.jsx(nn,{data:F,stats:_,strompreis:k}),a==="co2"&&e.jsx(ln,{data:F,stats:_}),a==="investitionen"&&o&&e.jsx(dn,{anlageId:o,strompreis:k,selectedYear:s})]})}const cn={"e-auto":ve,waermepumpe:_e,speicher:ke,wallbox:rt,wechselrichter:zt,"pv-module":X,balkonkraftwerk:pa,sonstiges:zt},ir={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},Xr={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function on(){var u;const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(null),[n,i]=d.useState(null),[x,c]=d.useState(!1),[l,o]=d.useState(null),[g,p]=d.useState(30),[y,k]=d.useState(8.2),[f,F]=d.useState(1.85),_=r??((u=t[0])==null?void 0:u.id),{strompreis:j}=Sa(_??null);d.useEffect(()=>{j&&(p(j.netzbezug_arbeitspreis_cent_kwh),k(j.einspeiseverguetung_cent_kwh))},[j]),d.useEffect(()=>{if(!_)return;(async()=>{try{c(!0),o(null);const z=await ze.getROIDashboard(_,g,y,f);i(z)}catch(z){o(z instanceof Error?z.message:"Fehler beim Laden der ROI-Daten")}finally{c(!1)}})()},[_,g,y,f]);const M=d.useMemo(()=>{if(!n||n.gesamt_relevante_kosten<=0)return[];const b=[];let z=0;const C=Math.min(Math.ceil((n.gesamt_amortisation_jahre??20)*1.5),30);for(let L=0;L<=C;L++)b.push({jahr:L,kumulierte_einsparung:Math.round(z),investition:n.gesamt_relevante_kosten}),z+=n.gesamt_jahres_einsparung;return b},[n]),m=d.useMemo(()=>{if(!n)return[];const b={};return n.berechnungen.forEach(z=>{const C=z.investition_typ;b[C]=(b[C]||0)+z.jahres_einsparung}),Object.entries(b).map(([z,C])=>({name:Xr[z]||z,value:Math.round(C),color:ir[z]||"#6b7280"})).filter(z=>z.value>0)},[n]),h=d.useMemo(()=>n?n.berechnungen.map(b=>({name:b.investition_bezeichnung.length>15?b.investition_bezeichnung.substring(0,15)+"...":b.investition_bezeichnung,fullName:b.investition_bezeichnung,kosten:b.relevante_kosten,einsparung:b.jahres_einsparung,amortisation:b.amortisation_jahre??0,typ:b.investition_typ,color:ir[b.investition_typ]||"#6b7280"})):[],[n]);return a?e.jsx(ye,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(le,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:_??"",onChange:b=>s(Number(b.target.value)),className:"input w-auto",children:t.map(b=>e.jsx("option",{value:b.id,children:b.anlagenname},b.id))})})]}),l&&e.jsx(le,{type:"error",onClose:()=>o(null),children:l}),e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(zt,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:g,onChange:b=>p(Number(b.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergütung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:y,onChange:b=>k(Number(b.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:f,onChange:b=>F(Number(b.target.value)),className:"input"})]})]})]}),x&&e.jsx(ye,{text:"Berechne ROI..."}),!x&&n&&n.berechnungen.length===0&&e.jsx(Et,{icon:_t,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!x&&n&&n.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ot,{icon:_t,title:"Gesamtinvestition",value:`${n.gesamt_investition.toLocaleString("de-DE")} €`,subtitle:`Relevant: ${n.gesamt_relevante_kosten.toLocaleString("de-DE")} €`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt − Alternativkosten",ergebnis:`= ${v(n.gesamt_relevante_kosten,0)} €`}),e.jsx(Ot,{icon:Ne,title:"Jährliche Einsparung",value:`${n.gesamt_jahres_einsparung.toLocaleString("de-DE")} €`,subtitle:n.gesamt_roi_prozent?`ROI: ${n.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einsparungen aller Investitionen",berechnung:n.gesamt_relevante_kosten>0?"ROI = Einsparung ÷ Kosten × 100":void 0,ergebnis:n.gesamt_roi_prozent?`= ${n.gesamt_roi_prozent}% ROI`:void 0}),e.jsx(Ot,{icon:Ja,title:"Amortisation",value:n.gesamt_amortisation_jahre?`${n.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten ÷ Jährliche Einsparung",berechnung:n.gesamt_jahres_einsparung>0?`${v(n.gesamt_relevante_kosten,0)} € ÷ ${v(n.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:n.gesamt_amortisation_jahre?`= ${n.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx(Ot,{icon:De,title:"CO2-Einsparung",value:`${n.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${v(n.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(fr,{data:M,children:[e.jsx(ce,{strokeDasharray:"3 3",opacity:.3}),e.jsx(oe,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(ne,{tickFormatter:b=>`${(b/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(te,{formatter:(b,z)=>[`${b.toLocaleString("de-DE")} €`,z==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:b=>`Jahr ${b}`}),e.jsx(we,{formatter:b=>b==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(Qe,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(Qe,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),n.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",n.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(nt,{children:[e.jsx(it,{data:m,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:b,percent:z})=>`${b}: ${(z*100).toFixed(0)}%`,labelLine:!0,children:m.map((b,z)=>e.jsx(Ce,{fill:b.color},`cell-${z}`))}),e.jsx(te,{formatter:b=>[`${b.toLocaleString("de-DE")} €/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:h,layout:"vertical",children:[e.jsx(ce,{strokeDasharray:"3 3",opacity:.3}),e.jsx(oe,{type:"number",tickFormatter:b=>`${b.toLocaleString("de-DE")}`}),e.jsx(ne,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(te,{formatter:(b,z)=>[z==="kosten"?`${b.toLocaleString("de-DE")} €`:`${b.toLocaleString("de-DE")} €/Jahr`,z==="kosten"?"Relevante Kosten":"Jährliche Einsparung"]}),e.jsx(we,{formatter:b=>b==="kosten"?"Relevante Kosten (€)":"Jährliche Einsparung (€)"}),e.jsx(Y,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(Y,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:n.berechnungen.map(b=>{const z=cn[b.investition_typ]||zt;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4",style:{color:ir[b.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:b.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Xr[b.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[b.relevante_kosten.toLocaleString("de-DE")," €"]}),b.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",b.anschaffungskosten.toLocaleString("de-DE")," € gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[b.jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:b.roi_prozent?e.jsxs("span",{className:b.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[b.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:b.amortisation_jahre?e.jsxs("span",{className:b.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[b.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:b.co2_einsparung_kg?`${b.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},b.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[n.gesamt_relevante_kosten.toLocaleString("de-DE")," €"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[n.gesamt_jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:n.gesamt_roi_prozent?`${n.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:n.gesamt_amortisation_jahre?`${n.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[n.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(le,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatsächlichen Einsparungen können je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function Ot({icon:t,title:a,value:r,subtitle:s,color:n,bgColor:i,formel:x,berechnung:c,ergebnis:l}){const o=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r});return e.jsx(A,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:`h-6 w-6 ${n}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a}),x?e.jsx(ot,{formel:x,berechnung:c,ergebnis:l,children:o}):o,s&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s})]})]})})}const gn=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],ea=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#ef4444","#06b6d4"];function xn(){var D;const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState(new Date().getFullYear()),[x,c]=d.useState(null),[l,o]=d.useState([]),[g,p]=d.useState([]),[y,k]=d.useState(!1),[f,F]=d.useState(!1),[_,j]=d.useState(null);d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{r&&M()},[r,n]);const M=async()=>{if(r){k(!0),j(null);try{const S=await $t.list(r);o(S);try{const N=await Oe.getStringMonatsdaten(r,n);p(N)}catch{p([])}const B=await Xe.getAktivePrognose(r);if(B)c({jahresertrag_kwh:B.jahresertrag_kwh,monatswerte:B.monatswerte,isLive:!1});else try{const N=await Xe.getPrognose(r);c({jahresertrag_kwh:N.jahresertrag_kwh,monatswerte:N.monatsdaten.map(V=>({monat:V.monat,e_m:V.e_m})),isLive:!0,module:N.module})}catch(N){c(null),N instanceof Error&&N.message.includes("PV-Module")&&j("Keine PV-Module für diese Anlage definiert. Bitte unter Einstellungen → Investitionen anlegen.")}}catch(S){j(S instanceof Error?S.message:"Fehler beim Laden")}finally{k(!1)}}},m=async()=>{if(r){F(!0);try{await Xe.speicherePrognose(r);const S=x==null?void 0:x.module;await M(),S&&S.length>0&&c(B=>B?{...B,module:S}:null)}catch(S){j(S instanceof Error?S.message:"Fehler beim Speichern")}finally{F(!1)}}},h=[...new Set(l.map(S=>S.jahr))].sort((S,B)=>B-S);d.useEffect(()=>{h.length>0&&!h.includes(n)&&i(h[0])},[h,n]);const u=[];if(x!=null&&x.monatswerte)for(let S=1;S<=12;S++){const B=((D=x.monatswerte.find(he=>he.monat===S))==null?void 0:D.e_m)||0,N=l.filter(he=>he.jahr===n&&he.monat===S).reduce((he,ie)=>he+(ie.pv_erzeugung_kwh||0),0),V=N-B,se=B>0?V/B*100:0;u.push({monat:S,monatName:gn[S],prognose:B,ist:N,abweichung:V,abweichungProzent:se})}const b=u.reduce((S,B)=>S+B.prognose,0),z=u.reduce((S,B)=>S+B.ist,0),C=z-b,L=b>0?C/b*100:0,W=12-u.filter(S=>S.ist===0).length,H=W>0?z/W*12:0;return a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(cs,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:S=>s(parseInt(S.target.value)),options:t.map(S=>({value:S.id.toString(),label:S.anlagenname}))}),h.length>0&&e.jsx(He,{value:n.toString(),onChange:S=>i(parseInt(S.target.value)),options:h.map(S=>({value:S.toString(),label:S.toString()}))}),e.jsx("button",{onClick:M,disabled:y,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Te,{className:`h-5 w-5 ${y?"animate-spin":""}`})})]})]}),_&&e.jsx(le,{type:"error",children:_}),y?e.jsx(ye,{text:"Lade Vergleichsdaten..."}):x?l.length===0?e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(We,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten für diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen → Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[x.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(Z,{size:"sm",onClick:m,disabled:f,children:[e.jsx(tt,{className:"h-4 w-4 mr-1"}),f?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(A,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[b.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",n]})]}),e.jsxs(A,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[z.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[W," von 12 Monaten"]})]}),e.jsxs(A,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[C>=0?e.jsx(Ne,{className:"h-6 w-6 text-green-500"}):e.jsx(Gr,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${C>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[C>=0?"+":"",C.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${C>=0?"text-green-500":"text-red-500"}`,children:[C>=0?"+":"",L.toFixed(1),"%"]})]}),W<12&&W>0&&e.jsxs(A,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[H.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((H/b-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",n]}),e.jsx("div",{className:"h-80",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(lt,{data:u,children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"monatName"}),e.jsx(ne,{yAxisId:"left",tickFormatter:S=>`${S} kWh`}),e.jsx(ne,{yAxisId:"right",orientation:"right",tickFormatter:S=>`${S}%`}),e.jsx(te,{formatter:(S,B)=>B==="Abweichung %"?`${S.toFixed(1)}%`:`${S.toFixed(0)} kWh`}),e.jsx(we,{}),e.jsx(Va,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(Y,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(Y,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(Qe,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),x.module&&x.module.length>1&&e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"SOLL-IST Vergleich nach PV-Modul"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Vergleich der PVGIS-Prognose mit tatsächlichen Erträgen pro PV-Modul.",g.length===0&&e.jsx("span",{className:"text-yellow-600 ml-1",children:"(Keine String-Daten vorhanden - zeige nur Prognose)"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"PV-Modul"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ausrichtung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"SOLL (PVGIS)"}),e.jsxs("th",{className:"text-right py-2 px-2",children:["IST ",n]}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"})]})}),e.jsx("tbody",{children:x.module.map((S,B)=>{const N=g.filter(me=>me.investition_id===S.investition_id).reduce((me,je)=>me+je.pv_erzeugung_kwh,0),V=S.monatsdaten.reduce((me,je)=>me+je.e_m,0),se=N-V,he=V>0?se/V*100:0,ie=N>0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ea[B%ea.length]}}),e.jsx("span",{className:"font-medium",children:S.bezeichnung})]})}),e.jsx("td",{className:"text-right py-2 px-2",children:S.leistung_kwp.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:S.ausrichtung}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[V.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:ie?e.jsxs("span",{className:"text-green-600",children:[N.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${se>=0?"text-green-600":"text-red-600"}`,children:ie?`${se>=0?"+":""}${he.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:ie?he>=-5?e.jsx(et,{className:"h-5 w-5 text-green-500 mx-auto"}):he>=-15?e.jsx("span",{className:"text-yellow-500",children:"⚠"}):e.jsx(Xt,{className:"h-5 w-5 text-red-500 mx-auto"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Keine Daten"})})]},S.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsx("td",{className:"text-right py-2 px-2",children:x.module.reduce((S,B)=>S+B.leistung_kwp,0).toFixed(1)}),e.jsx("td",{}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[b.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:g.length>0?g.reduce((S,B)=>S+B.pv_erzeugung_kwh,0).toLocaleString("de-DE",{maximumFractionDigits:0})+" kWh":"-"}),e.jsx("td",{colSpan:2})]})})]})}),g.length===0&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Tipp:"}),' Um IST-Daten pro PV-Modul zu sehen, weise jedem PV-Modul unter "Einstellungen → Investitionen" einen Home Assistant String-Sensor zu.']})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"})," Module mit deutlicher Unterperformance (<-15%) sollten auf Verschattung, Verschmutzung oder technische Probleme geprüft werden."]})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:u.map(S=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:S.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[S.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:S.ist>0?e.jsxs("span",{className:"text-green-600",children:[S.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${S.abweichung>=0?"text-green-600":"text-red-600"}`,children:S.ist>0?`${S.abweichung>=0?"+":""}${S.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${S.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:S.ist>0?`${S.abweichungProzent>=0?"+":""}${S.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:S.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):S.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Übertroffen"]}):S.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):S.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(Gr,{className:"h-4 w-4"}),"Unter Plan"]})})]},S.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[b.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[z.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${C>=0?"text-green-600":"text-red-600"}`,children:[C>=0?"+":"",C.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${L>=0?"text-green-600":"text-red-600"}`,children:[L>=0?"+":"",L.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Übertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prüfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjährigen Mittelwerten. Einzelne Monate können stark abweichen."})]})]}):e.jsx(A,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfügbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen → Investitionen".'})]})})]})}function ta({anlage:t,onSubmit:a,onCancel:r}){var p,y,k;const[s,n]=d.useState(!1),[i,x]=d.useState(null),[c,l]=d.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((p=t==null?void 0:t.leistung_kwp)==null?void 0:p.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((y=t==null?void 0:t.latitude)==null?void 0:y.toString())||"",longitude:((k=t==null?void 0:t.longitude)==null?void 0:k.toString())||""}),o=f=>{const{name:F,value:_}=f.target;l(j=>({...j,[F]:_}))},g=async f=>{if(f.preventDefault(),x(null),!c.anlagenname.trim()){x("Bitte einen Namen eingeben");return}if(!c.leistung_kwp||parseFloat(c.leistung_kwp)<=0){x("Bitte eine gültige Leistung eingeben");return}try{n(!0),await a({anlagenname:c.anlagenname.trim(),leistung_kwp:parseFloat(c.leistung_kwp),installationsdatum:c.installationsdatum||void 0,standort_plz:c.standort_plz||void 0,standort_ort:c.standort_ort||void 0,standort_strasse:c.standort_strasse||void 0,latitude:c.latitude?parseFloat(c.latitude):void 0,longitude:c.longitude?parseFloat(c.longitude):void 0})}catch(F){x(F instanceof Error?F.message:"Fehler beim Speichern")}finally{n(!1)}};return e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[i&&e.jsx(le,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Anlagenname",name:"anlagenname",value:c.anlagenname,onChange:o,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(G,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:c.leistung_kwp,onChange:o,placeholder:"z.B. 10.5",required:!0}),e.jsx(G,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:c.installationsdatum,onChange:o})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," gepflegt. So können auch Anlagen mit mehreren Dachflächen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(G,{label:"PLZ",name:"standort_plz",value:c.standort_plz,onChange:o,placeholder:"z.B. 12345"}),e.jsx(G,{label:"Ort",name:"standort_ort",value:c.standort_ort,onChange:o,placeholder:"z.B. Berlin"}),e.jsx(G,{label:"Straße",name:"standort_strasse",value:c.standort_strasse,onChange:o,placeholder:"z.B. Musterstraße 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(für PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:c.latitude,onChange:o,placeholder:"z.B. 52.520008",hint:"Nördliche Breite (positiv)"}),e.jsx(G,{label:"Längengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:c.longitude,onChange:o,placeholder:"z.B. 13.404954",hint:"Östliche Länge (positiv)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Z,{type:"button",variant:"secondary",onClick:r,children:"Abbrechen"}),e.jsx(Z,{type:"submit",loading:s,children:t?"Speichern":"Anlage erstellen"})]})]})}const hn={ev:ve,wallbox:vr,battery:ge,inverter:X},mn={evcc:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",sma:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",smart:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",wallbox:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"};function un({device:t,selected:a,onToggle:r}){const s=hn[t.device_type]||ja,n=mn[t.integration]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",i=!t.already_configured&&t.suggested_investition_typ;return e.jsxs("div",{className:`
        relative p-4 rounded-lg border-2 transition-all cursor-pointer
        ${a?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}
        ${t.already_configured?"opacity-60":""}
        ${i?"":"cursor-not-allowed"}
      `,onClick:()=>i&&r(),children:[i&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`
              w-5 h-5 rounded border-2 flex items-center justify-center
              ${a?"bg-amber-500 border-amber-500":"border-gray-300 dark:border-gray-600"}
            `,children:a&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),t.already_configured&&e.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Konfiguriert"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
          p-2 rounded-lg
          ${a?"bg-amber-100 dark:bg-amber-800/30":"bg-gray-100 dark:bg-gray-700"}
        `,children:e.jsx(s,{className:`w-6 h-6 ${a?"text-amber-600":"text-gray-600 dark:text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${n}`,children:t.integration.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.device_type==="ev"?"E-Auto":t.device_type==="wallbox"?"Wallbox":t.device_type==="battery"?"Speicher":t.device_type==="inverter"?"Wechselrichter":t.device_type}),t.confidence>=80&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[t.confidence,"% Konfidenz"]})]}),(t.manufacturer||t.model)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.manufacturer,t.model].filter(Boolean).join(" ")}),t.sensors.length>0&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:[t.sensors.length," Sensor",t.sensors.length!==1?"en":""," gefunden"]})]})]}),i&&Object.keys(t.suggested_parameters).length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Wird erstellt als:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.suggested_parameters.bezeichnung||t.name})]})]})}function Ct({label:t,icon:a,suggestions:r,allSensors:s,showAll:n,value:i,onChange:x}){const c=n?s:r,l=c.length>0,o=r.length>0&&r[0].confidence>=70;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"p-2 rounded-lg bg-white dark:bg-gray-700 shadow-sm",children:e.jsx(a,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),e.jsxs("select",{value:i||"",onChange:g=>x(g.target.value||null),className:`
            w-full px-3 py-2 text-sm rounded-lg border
            bg-white dark:bg-gray-800
            border-gray-300 dark:border-gray-600
            text-gray-900 dark:text-white
            focus:ring-2 focus:ring-amber-500 focus:border-amber-500
            ${l?"":"opacity-50"}
          `,disabled:!l,children:[e.jsx("option",{value:"",children:l?"-- Nicht zugeordnet --":"-- Kein Sensor gefunden --"}),c.map(g=>e.jsxs("option",{value:g.entity_id,children:[g.friendly_name||g.entity_id,g.confidence>=80&&" ★"]},g.entity_id))]}),!n&&o&&!i&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["Empfehlung: ",r[0].friendly_name||r[0].entity_id]}),i&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:i})]})]})}function pn({suggestions:t,allEnergySensors:a,selectedMappings:r,onMappingChange:s,onApplyBest:n}){const[i,x]=d.useState(!1),c=t.pv_erzeugung.length+t.einspeisung.length+t.netzbezug.length+t.batterie_ladung.length+t.batterie_entladung.length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Sensor-Zuordnungen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Für Monatsdaten-Import aus Home Assistant"})]}),e.jsx("div",{className:"flex items-center gap-2",children:c>0&&!i&&e.jsx("button",{onClick:n,className:"text-xs px-3 py-1.5 rounded-lg bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:hover:bg-amber-900/50 transition-colors",children:"Beste übernehmen"})})]}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsxs("button",{onClick:()=>x(!1),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${i?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm"}`,children:["Empfohlen (",c,")"]}),e.jsxs("button",{onClick:()=>x(!0),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${i?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Alle (",a.length,")"]})]}),i&&e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg",children:"Zeigt alle Energy-Sensoren (kWh, total_increasing) für manuelle Zuordnung."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ct,{label:"PV-Erzeugung",icon:X,field:"pv_erzeugung",suggestions:t.pv_erzeugung,allSensors:a,showAll:i,value:r.pv_erzeugung,onChange:l=>s("pv_erzeugung",l)}),e.jsx(Ct,{label:"Einspeisung",icon:qt,field:"einspeisung",suggestions:t.einspeisung,allSensors:a,showAll:i,value:r.einspeisung,onChange:l=>s("einspeisung",l)}),e.jsx(Ct,{label:"Netzbezug",icon:pr,field:"netzbezug",suggestions:t.netzbezug,allSensors:a,showAll:i,value:r.netzbezug,onChange:l=>s("netzbezug",l)}),e.jsx(Ct,{label:"Batterie Ladung",icon:vr,field:"batterie_ladung",suggestions:t.batterie_ladung,allSensors:a,showAll:i,value:r.batterie_ladung,onChange:l=>s("batterie_ladung",l)}),e.jsx(Ct,{label:"Batterie Entladung",icon:ke,field:"batterie_entladung",suggestions:t.batterie_entladung,allSensors:a,showAll:i,value:r.batterie_entladung,onChange:l=>s("batterie_entladung",l)})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic",children:"Hinweis: Sensor-Zuordnungen werden in der Add-on-Konfiguration gespeichert. Änderungen hier dienen nur zur Vorschau."})]})}const bn={ev:ve,wallbox:vr,battery:ge,inverter:X},yn={"e-auto":"E-Auto",wallbox:"Wallbox",speicher:"Speicher",wechselrichter:"Wechselrichter"};function kn({devicesToCreate:t,onConfirm:a,onBack:r,loading:s=!1}){return t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(We,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Geräte ausgewählt"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Bitte wähle mindestens ein Gerät aus, das als Investition angelegt werden soll."}),e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Zurück zur Auswahl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Zusammenfassung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Folgende ",t.length," Investition",t.length!==1?"en":""," werden erstellt:"]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:t.map(n=>{const i=bn[n.device_type]||ja,x=n.suggested_investition_typ?yn[n.suggested_investition_typ]||n.suggested_investition_typ:"Unbekannt";return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(i,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:n.suggested_parameters.bezeichnung||n.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:x}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700",children:n.integration.toUpperCase()})]})]})]},n.id)})}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(We,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{children:"Die Investitionen werden mit Standardwerten erstellt."}),e.jsx("p",{className:"mt-1",children:'Du kannst die Details später unter "Investitionen" anpassen.'})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:r,disabled:s,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Zurück"}),e.jsx("button",{onClick:a,disabled:s,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Erstelle..."})]}):e.jsx("span",{children:"Investitionen erstellen"})})]})]})}function Wa({isOpen:t,onClose:a,anlageId:r,onInvestitionenCreated:s}){const{step:n,discoveryResult:i,selectedDevices:x,selectedMappings:c,error:l,startDiscovery:o,toggleDevice:g,selectAllDevices:p,deselectAllDevices:y,setMapping:k,applyBestMappings:f,goToStep:F,reset:_,devicesToCreate:j}=Ws();d.useEffect(()=>{t&&n==="idle"&&o(r)},[t,n,r,o]);const M=()=>{_(),a()},m=async()=>{F("creating");try{for(const u of j){const b={anlage_id:r,typ:u.suggested_investition_typ,bezeichnung:u.suggested_parameters.bezeichnung||u.name,hersteller:u.suggested_parameters.hersteller||u.manufacturer||void 0,kaufdatum:new Date().toISOString().split("T")[0],kaufpreis:0,aktiv:!0};u.suggested_investition_typ==="e-auto"&&(b.batterie_kwh=u.suggested_parameters.batterie_kwh||void 0),await ze.create(b)}F("done"),s==null||s()}catch{F("error")}},h=()=>{switch(n){case"scanning":return"Home Assistant durchsuchen...";case"results":return"Gefundene Geräte";case"confirmation":return"Bestätigung";case"creating":return"Erstelle Investitionen...";case"done":return"Fertig!";case"error":return"Fehler";default:return"Auto-Discovery"}};return e.jsxs(qe,{isOpen:t,onClose:M,title:h(),size:"lg",children:[n==="scanning"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(ct,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten..."})]}),n==="error"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Lt,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Verbindung fehlgeschlagen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:l||"Keine Verbindung zu Home Assistant möglich."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:M,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Schließen"}),e.jsx("button",{onClick:()=>o(r),className:"px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Erneut versuchen"})]})]}),n==="results"&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:i.ha_connected?e.jsxs(e.Fragment,{children:[e.jsx(_r,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Nicht verbunden"})]})}),i.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:i.warnings.map((u,b)=>e.jsx("p",{children:u},b))})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["Gefundene Geräte (",i.devices.length,")"]}),i.devices.filter(u=>!u.already_configured&&u.suggested_investition_typ).length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Keine"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:p,className:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"Alle"})]})]}),i.devices.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Unterstützt: SMA, evcc, Smart, Wallbox"})]}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:i.devices.map(u=>e.jsx(un,{device:u,selected:x.has(u.id),onToggle:()=>g(u.id)},u.id))})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsx(pn,{suggestions:i.sensor_mappings,allEnergySensors:i.all_energy_sensors,selectedMappings:c,onMappingChange:k,onApplyBest:f})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:M,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Abbrechen"}),e.jsxs("button",{onClick:()=>F("confirmation"),disabled:x.size===0,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter (",x.size," ausgewählt)"]})]})]}),n==="confirmation"&&e.jsx(kn,{devicesToCreate:j,onConfirm:m,onBack:()=>F("results")}),n==="creating"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 mb-6",children:e.jsxs("svg",{className:"animate-spin w-16 h-16 text-amber-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Erstelle ",j.length," Investition",j.length!==1?"en":"","..."]})]}),n==="done"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Ge,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Erfolgreich erstellt!"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:[j.length," Investition",j.length!==1?"en wurden":" wurde"," angelegt."]}),e.jsx("button",{onClick:M,className:"px-6 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Fertig"})]})]})}function jn(){const{anlagen:t,loading:a,error:r,createAnlage:s,updateAnlage:n,deleteAnlage:i}=Me(),[x,c]=d.useState(!1),[l,o]=d.useState(null),[g,p]=d.useState(null),[y,k]=d.useState(null),f=async j=>{const M=await s(j);c(!1),k(M.id)},F=async j=>{l&&(await n(l.id,j),o(null))},_=async()=>{g&&(await i(g.id),p(null))};return a?e.jsx(ye,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(Z,{onClick:()=>c(!0),children:[e.jsx(kt,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),r&&e.jsx(le,{type:"error",children:r}),t.length===0?e.jsx(A,{children:e.jsx(Et,{icon:X,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(Z,{onClick:()=>c(!0),children:"Erste Anlage anlegen"})})}):e.jsx(A,{padding:"none",children:e.jsxs(Sr,{children:[e.jsx(Er,{children:e.jsxs(St,{children:[e.jsx(Ae,{children:"Name"}),e.jsx(Ae,{children:"Leistung"}),e.jsx(Ae,{children:"Standort"}),e.jsx(Ae,{children:"Ausrichtung"}),e.jsx(Ae,{children:"Installation"}),e.jsx(Ae,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Fr,{children:t.map(j=>e.jsxs(St,{children:[e.jsx(Le,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:j.anlagenname})]})}),e.jsxs(Le,{children:[e.jsx("span",{className:"font-mono",children:j.leistung_kwp})," kWp"]}),e.jsx(Le,{children:j.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Qt,{className:"h-4 w-4"}),j.standort_plz," ",j.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(Le,{children:[j.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),j.neigung_grad&&` / ${j.neigung_grad}°`]}),e.jsx(Le,{children:j.installationsdatum?new Date(j.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(Le,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>k(j.id),title:"HA-Geräte erkennen",children:e.jsx(ct,{className:"h-4 w-4 text-amber-500"})}),e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>o(j),children:e.jsx(Nr,{className:"h-4 w-4"})}),e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>p(j),children:e.jsx(xt,{className:"h-4 w-4 text-red-500"})})]})})]},j.id))})]})}),e.jsx(qe,{isOpen:x,onClose:()=>c(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(ta,{onSubmit:f,onCancel:()=>c(!1)})}),e.jsx(qe,{isOpen:!!l,onClose:()=>o(null),title:"Anlage bearbeiten",size:"lg",children:l&&e.jsx(ta,{anlage:l,onSubmit:F,onCancel:()=>o(null)})}),e.jsx(qe,{isOpen:!!g,onClose:()=>p(null),title:"Anlage löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Anlage ",e.jsxs("strong",{children:['"',g==null?void 0:g.anlagenname,'"']})," wirklich löschen?"]}),e.jsx(le,{type:"warning",children:"Alle zugehörigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelöscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Z,{variant:"secondary",onClick:()=>p(null),children:"Abbrechen"}),e.jsx(Z,{variant:"danger",onClick:_,children:"Löschen"})]})]})}),y&&e.jsx(Wa,{isOpen:!0,onClose:()=>k(null),anlageId:y})]})}function fn(){var C;const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(null),n=r??((C=t[0])==null?void 0:C.id),{strompreise:i,loading:x,error:c,createStrompreis:l,updateStrompreis:o,deleteStrompreis:g}=Cs(n),[p,y]=d.useState(!1),[k,f]=d.useState(null),[F,_]=d.useState(null),[j,M]=d.useState(null),m=async L=>{try{M(null),await l(L),y(!1)}catch(R){M(R instanceof Error?R.message:"Fehler beim Erstellen")}},h=async L=>{if(k)try{M(null),await o(k.id,L),f(null)}catch(R){M(R instanceof Error?R.message:"Fehler beim Aktualisieren")}},u=async()=>{if(F)try{await g(F.id),_(null)}catch(L){M(L instanceof Error?L.message:"Fehler beim Löschen")}},b=L=>{const R=new Date().toISOString().split("T")[0],W=L.gueltig_ab<=R,H=!L.gueltig_bis||L.gueltig_bis>=R;return W&&H};if(a||x)return e.jsx(ye,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(le,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const z=[...i].sort((L,R)=>{const W=b(L),H=b(R);return W!==H?W?-1:1:R.gueltig_ab.localeCompare(L.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:n??"",onChange:L=>s(Number(L.target.value)),className:"input w-auto",children:t.map(L=>e.jsx("option",{value:L.id,children:L.anlagenname},L.id))}),e.jsxs(Z,{onClick:()=>y(!0),children:[e.jsx(kt,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),c&&e.jsx(le,{type:"error",children:c}),z.length>0&&b(z[0])&&e.jsx(A,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(pt,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",z[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[z[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," · ","Einspeisung: ",e.jsxs("strong",{children:[z[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),z[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" · Grundpreis: ",e.jsxs("strong",{children:[z[0].grundpreis_euro_monat.toFixed(2)," €/Monat"]})]})]})]})]})}),i.length===0?e.jsx(A,{children:e.jsx(Et,{icon:ge,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(Z,{onClick:()=>y(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(A,{padding:"none",children:e.jsxs(Sr,{children:[e.jsx(Er,{children:e.jsxs(St,{children:[e.jsx(Ae,{children:"Tarif"}),e.jsx(Ae,{children:"Netzbezug"}),e.jsx(Ae,{children:"Einspeisung"}),e.jsx(Ae,{children:"Grundpreis"}),e.jsx(Ae,{children:"Gültigkeit"}),e.jsx(Ae,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Fr,{children:z.map(L=>{const R=b(L);return e.jsxs(St,{className:R?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(Le,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:`h-5 w-5 ${R?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:L.tarifname||"Standard"}),R&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),L.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:L.anbieter})]})]})}),e.jsxs(Le,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:L.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(Le,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:L.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(Le,{children:L.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:L.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" €/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(Le,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Dt,{className:"h-4 w-4"}),new Date(L.gueltig_ab).toLocaleDateString("de-DE"),L.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(L.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(Le,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>f(L),children:e.jsx(Nr,{className:"h-4 w-4"})}),e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>_(L),children:e.jsx(xt,{className:"h-4 w-4 text-red-500"})})]})})]},L.id)})})]})}),e.jsxs(A,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gültige Tarif wird automatisch für Berechnungen verwendet"}),e.jsx("li",{children:"Für historische Auswertungen werden die zum jeweiligen Zeitpunkt gültigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gültigkeitszeitraum korrekt setzen"})]})]}),e.jsx(qe,{isOpen:p,onClose:()=>{y(!1),M(null)},title:"Neuen Tarif anlegen",size:"lg",children:n&&e.jsx(ra,{anlageId:n,onCreate:m,onCancel:()=>{y(!1),M(null)},error:j})}),e.jsx(qe,{isOpen:!!k,onClose:()=>{f(null),M(null)},title:"Tarif bearbeiten",size:"lg",children:k&&e.jsx(ra,{strompreis:k,anlageId:k.anlage_id,onUpdate:h,onCancel:()=>{f(null),M(null)},error:j})}),e.jsx(qe,{isOpen:!!F,onClose:()=>_(null),title:"Tarif löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du den Tarif ",e.jsxs("strong",{children:['"',(F==null?void 0:F.tarifname)||"Standard",'"']})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Z,{variant:"secondary",onClick:()=>_(null),children:"Abbrechen"}),e.jsx(Z,{variant:"danger",onClick:u,children:"Löschen"})]})]})})]})}function ra({strompreis:t,anlageId:a,onCreate:r,onUpdate:s,onCancel:n,error:i}){var y,k,f;const[x,c]=d.useState(!1),[l,o]=d.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((y=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:y.toString())||"30",einspeiseverguetung_cent_kwh:((k=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:k.toString())||"8.2",grundpreis_euro_monat:((f=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:f.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||""}),g=F=>{const{name:_,value:j}=F.target;o(M=>({...M,[_]:j}))},p=async F=>{F.preventDefault(),c(!0);try{const _={netzbezug_arbeitspreis_cent_kwh:parseFloat(l.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(l.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:l.grundpreis_euro_monat?parseFloat(l.grundpreis_euro_monat):void 0,gueltig_ab:l.gueltig_ab,gueltig_bis:l.gueltig_bis||void 0,tarifname:l.tarifname||void 0,anbieter:l.anbieter||void 0,vertragsart:l.vertragsart||void 0};t&&s?await s(_):r&&await r({..._,anlage_id:a})}finally{c(!1)}};return e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[i&&e.jsx(le,{type:"error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Tarifname",name:"tarifname",value:l.tarifname,onChange:g,placeholder:"z.B. Grundversorgung, Öko-Strom"}),e.jsx(G,{label:"Anbieter",name:"anbieter",value:l.anbieter,onChange:g,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(G,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:l.netzbezug_arbeitspreis_cent_kwh,onChange:g,required:!0,hint:"Arbeitspreis für Strombezug"}),e.jsx(G,{label:"Einspeisevergütung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:l.einspeiseverguetung_cent_kwh,onChange:g,required:!0,hint:"EEG-Vergütung oder PPA-Preis"}),e.jsx(G,{label:"Grundpreis (€/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:l.grundpreis_euro_monat,onChange:g,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gültigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Gültig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:l.gueltig_ab,onChange:g,required:!0}),e.jsx(G,{label:"Gültig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:l.gueltig_bis,onChange:g,hint:"Leer lassen für unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:l.vertragsart,onChange:g,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte wählen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"Ökostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Z,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(Z,{type:"submit",loading:x,children:t?"Speichern":"Anlegen"})]})]})}const vn={"pv-module":"wechselrichter",speicher:"wechselrichter"},wn=["pv-module"],Tt={wechselrichter:"Wechselrichter"},lr={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},Nn={"e-auto":"Kosten eines vergleichbaren Verbrenners (für ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/Ölheizung (für ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function _n({investition:t,anlageId:a,typ:r,onSubmit:s,onCancel:n}){var W,H,D,S,B,N;const[i,x]=d.useState(!1),[c,l]=d.useState(null),[o,g]=d.useState([]),[p,y]=d.useState(!1),[k,f]=d.useState([]),[F,_]=d.useState(!1),[j,M]=d.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${lr[r]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((W=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:W.toString())||"",anschaffungskosten_alternativ:((H=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:H.toString())||"",betriebskosten_jahr:((D=t==null?void 0:t.betriebskosten_jahr)==null?void 0:D.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,parent_investition_id:((S=t==null?void 0:t.parent_investition_id)==null?void 0:S.toString())||"",leistung_kwp:((B=t==null?void 0:t.leistung_kwp)==null?void 0:B.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"Süd",neigung_grad:((N=t==null?void 0:t.neigung_grad)==null?void 0:N.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""}),m=vn[r],h=wn.includes(r);d.useEffect(()=>{m&&(_(!0),ze.list(a,m,!0).then(V=>f(V.filter(se=>se.id!==(t==null?void 0:t.id)))).catch(()=>f([])).finally(()=>_(!1)))},[m,a,t==null?void 0:t.id]),d.useEffect(()=>{r==="pv-module"&&(y(!0),Oe.getStringSensors().then(g).catch(()=>g([])).finally(()=>y(!1)))},[r]);const u=(t==null?void 0:t.parameter)||{},b=()=>{var V,se,he,ie,me,je,fe,O,Q,E,q,ae,$,T,U,ue,Se,pe,w,I,J,Ie,Ee,Lr,Dr,Ir,Pr,Vr,Kr,Br;switch(r){case"e-auto":return{batteriekapazitaet_kwh:((V=u.batteriekapazitaet_kwh)==null?void 0:V.toString())||"",verbrauch_kwh_100km:((se=u.verbrauch_kwh_100km)==null?void 0:se.toString())||"18",jahresfahrleistung_km:((he=u.jahresfahrleistung_km)==null?void 0:he.toString())||"15000",pv_ladeanteil_prozent:((ie=u.pv_ladeanteil_prozent)==null?void 0:ie.toString())||"60",vergleich_verbrauch_l_100km:((me=u.vergleich_verbrauch_l_100km)==null?void 0:me.toString())||"7.5",benzinpreis_euro:((je=u.benzinpreis_euro)==null?void 0:je.toString())||"1.65",v2h_faehig:u.v2h_faehig??!1,v2h_entladeleistung_kw:((fe=u.v2h_entladeleistung_kw)==null?void 0:fe.toString())||""};case"speicher":return{kapazitaet_kwh:((O=u.kapazitaet_kwh)==null?void 0:O.toString())||"",nutzbare_kapazitaet_kwh:((Q=u.nutzbare_kapazitaet_kwh)==null?void 0:Q.toString())||"",max_ladeleistung_kw:((E=u.max_ladeleistung_kw)==null?void 0:E.toString())||"",max_entladeleistung_kw:((q=u.max_entladeleistung_kw)==null?void 0:q.toString())||"",wirkungsgrad_prozent:((ae=u.wirkungsgrad_prozent)==null?void 0:ae.toString())||"95",arbitrage_faehig:u.arbitrage_faehig??!1};case"waermepumpe":return{leistung_kw:(($=u.leistung_kw)==null?void 0:$.toString())||"",cop:((T=u.cop)==null?void 0:T.toString())||"3.5",jahresarbeitszahl:((U=u.jahresarbeitszahl)==null?void 0:U.toString())||"3.0",heizwaermebedarf_kwh:((ue=u.heizwaermebedarf_kwh)==null?void 0:ue.toString())||"",warmwasserbedarf_kwh:((Se=u.warmwasserbedarf_kwh)==null?void 0:Se.toString())||"",sg_ready:u.sg_ready??!1};case"wallbox":return{max_ladeleistung_kw:((pe=u.max_ladeleistung_kw)==null?void 0:pe.toString())||"11",bidirektional:u.bidirektional??!1,pv_optimiert:u.pv_optimiert??!0};case"wechselrichter":return{max_leistung_kw:((w=u.max_leistung_kw)==null?void 0:w.toString())||"",wirkungsgrad_prozent:((I=u.wirkungsgrad_prozent)==null?void 0:I.toString())||"97",hybrid:u.hybrid??!1};case"pv-module":return{anzahl_module:((J=u.anzahl_module)==null?void 0:J.toString())||"",modul_leistung_wp:((Ie=u.modul_leistung_wp)==null?void 0:Ie.toString())||"",modul_typ:((Ee=u.modul_typ)==null?void 0:Ee.toString())||""};case"balkonkraftwerk":return{leistung_wp:((Lr=u.leistung_wp)==null?void 0:Lr.toString())||"",anzahl:((Dr=u.anzahl)==null?void 0:Dr.toString())||"2",ausrichtung:((Ir=u.ausrichtung)==null?void 0:Ir.toString())||"Süd",neigung_grad:((Pr=u.neigung_grad)==null?void 0:Pr.toString())||"30",hat_speicher:u.hat_speicher??!1,speicher_kapazitaet_wh:((Vr=u.speicher_kapazitaet_wh)==null?void 0:Vr.toString())||""};case"sonstiges":return{kategorie:((Kr=u.kategorie)==null?void 0:Kr.toString())||"erzeuger",beschreibung:((Br=u.beschreibung)==null?void 0:Br.toString())||""};default:return{}}},[z,C]=d.useState(b),L=V=>{const{name:se,value:he,type:ie,checked:me}=V.target;if(se.startsWith("param_")){const je=se.replace("param_","");C(fe=>({...fe,[je]:ie==="checkbox"?me:he}))}else M(je=>({...je,[se]:ie==="checkbox"?me:he}))},R=async V=>{if(V.preventDefault(),l(null),!j.bezeichnung.trim()){l("Bitte eine Bezeichnung eingeben");return}try{x(!0);const se={};if(Object.entries(z).forEach(([fe,O])=>{if(typeof O=="boolean")se[fe]=O;else if(O!==""){const Q=parseFloat(O);se[fe]=isNaN(Q)?O:Q}}),h&&k.length>0&&!j.parent_investition_id){l(`${lr[r]} müssen einem ${Tt[m]||m} zugeordnet werden`);return}let he,ie,me;if(r==="balkonkraftwerk"){const fe=parseInt(z.anzahl)||0,O=parseInt(z.leistung_wp)||0;fe>0&&O>0&&(he=fe*O/1e3),ie=z.ausrichtung||void 0,me=z.neigung_grad?parseFloat(z.neigung_grad):void 0}const je={...t?{}:{anlage_id:a,typ:r},bezeichnung:j.bezeichnung.trim(),anschaffungsdatum:j.anschaffungsdatum||void 0,anschaffungskosten_gesamt:j.anschaffungskosten_gesamt?parseFloat(j.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:j.anschaffungskosten_alternativ?parseFloat(j.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:j.betriebskosten_jahr?parseFloat(j.betriebskosten_jahr):void 0,aktiv:j.aktiv,parameter:Object.keys(se).length>0?se:void 0,parent_investition_id:j.parent_investition_id?parseInt(j.parent_investition_id):void 0,...r==="pv-module"&&{leistung_kwp:j.leistung_kwp?parseFloat(j.leistung_kwp):void 0,ausrichtung:j.ausrichtung||void 0,neigung_grad:j.neigung_grad?parseFloat(j.neigung_grad):void 0,ha_entity_id:j.ha_entity_id||void 0},...r==="balkonkraftwerk"&&{leistung_kwp:he,ausrichtung:ie,neigung_grad:me}};await s(je)}catch(se){l(se instanceof Error?se.message:"Fehler beim Speichern")}finally{x(!1)}};return e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[c&&e.jsx(le,{type:"error",children:c}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Bezeichnung",name:"bezeichnung",value:j.bezeichnung,onChange:L,required:!0}),e.jsx(G,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:j.anschaffungsdatum,onChange:L}),e.jsx(G,{label:"Anschaffungskosten (€)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:j.anschaffungskosten_gesamt,onChange:L,hint:"Gesamtkosten inkl. Installation"}),e.jsx(G,{label:"Alternative Kosten (€)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:j.anschaffungskosten_alternativ,onChange:L,hint:Nn[r]}),e.jsx(G,{label:"Betriebskosten/Jahr (€)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:j.betriebskosten_jahr,onChange:L,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:j.aktiv,onChange:L,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen berücksichtigen)"})]})]}),m&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",Tt[m]||m,")",h?" *":" (optional)",F&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),k.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:j.parent_investition_id,onChange:V=>M(se=>({...se,parent_investition_id:V.target.value})),className:`input w-full ${h&&!j.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:h,children:[e.jsx("option",{value:"",children:h?"-- Bitte wählen --":"-- Keine Zuordnung --"}),k.map(V=>e.jsx("option",{value:V.id,children:V.bezeichnung},V.id))]}),h&&!j.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(We,{className:"w-4 h-4"}),r==="pv-module"?"PV-Module müssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):F?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 flex-shrink-0"}),h?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:Tt[m]||m})," an, bevor Sie ",lr[r]," erstellen können."]}):e.jsxs("span",{children:["Kein ",Tt[m]||m," vorhanden. Zuordnung ist optional."]})]})})]})]}),r==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:j.leistung_kwp,onChange:L,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:j.ausrichtung,onChange:V=>M(se=>({...se,ausrichtung:V.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(G,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:j.neigung_grad,onChange:L,hint:"0° = flach, 90° = senkrecht"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Home Assistant Sensor",p&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),e.jsxs("select",{name:"ha_entity_id",value:j.ha_entity_id,onChange:V=>M(se=>({...se,ha_entity_id:V.target.value})),className:"input w-full",children:[e.jsx("option",{value:"",children:"Kein Sensor (manuell)"}),o.map(V=>e.jsxs("option",{value:V.entity_id,children:[V.friendly_name||V.entity_id,V.state&&` (${V.state} ${V.unit_of_measurement||""})`]},V.entity_id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Verknüpfe dieses PV-Modul mit einem String-Sensor für automatische IST-Daten"})]})]})]}),e.jsx(zn,{typ:r,paramData:z,onChange:L}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Z,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(Z,{type:"submit",loading:i,children:t?"Speichern":"Erstellen"})]})]})}function zn({typ:t,paramData:a,onChange:r}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Batteriekapazität (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:a.batteriekapazitaet_kwh,onChange:r}),e.jsx(G,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:a.verbrauch_kwh_100km,onChange:r}),e.jsx(G,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:a.jahresfahrleistung_km,onChange:r}),e.jsx(G,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:a.pv_ladeanteil_prozent,onChange:r,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:a.vergleich_verbrauch_l_100km,onChange:r,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(G,{label:"Benzinpreis (€/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:a.benzinpreis_euro,onChange:r,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:a.v2h_faehig,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fähig (Vehicle-to-Home)"})]}),a.v2h_faehig&&e.jsx(G,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.v2h_entladeleistung_kw,onChange:r})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Kapazität (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:a.kapazitaet_kwh,onChange:r}),e.jsx(G,{label:"Nutzbare Kapazität (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:a.nutzbare_kapazitaet_kwh,onChange:r,hint:"Typisch 90-95% der Gesamtkapazität"}),e.jsx(G,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.max_ladeleistung_kw,onChange:r}),e.jsx(G,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.max_entladeleistung_kw,onChange:r}),e.jsx(G,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:a.wirkungsgrad_prozent,onChange:r})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:a.arbitrage_faehig,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fähig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wärmepumpe Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:a.leistung_kw,onChange:r}),e.jsx(G,{label:"COP (Leistungszahl)",name:"param_cop",type:"number",step:"0.1",min:"1",max:"10",value:a.cop,onChange:r,hint:"Typisch 3-5 bei Luft-WP"}),e.jsx(G,{label:"Jahresarbeitszahl",name:"param_jahresarbeitszahl",type:"number",step:"0.1",min:"1",max:"10",value:a.jahresarbeitszahl,onChange:r}),e.jsx(G,{label:"Heizwärmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:a.heizwaermebedarf_kwh,onChange:r}),e.jsx(G,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:a.warmwasserbedarf_kwh,onChange:r})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:a.sg_ready,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fähig)"})]})]});case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(G,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:a.max_ladeleistung_kw,onChange:r,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:a.bidirektional,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:a.pv_optimiert,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-Überschussladen möglich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:a.max_leistung_kw,onChange:r}),e.jsx(G,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:a.wirkungsgrad_prozent,onChange:r})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:a.hybrid,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:a.anzahl_module,onChange:r,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(G,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:a.modul_leistung_wp,onChange:r,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(G,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:a.modul_typ,onChange:r,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),a.anzahl_module&&a.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(a.anzahl_module)||0)*(parseInt(a.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const s=(parseInt(a.anzahl)||0)*(parseInt(a.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:a.anzahl,onChange:r}),e.jsx(G,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:a.leistung_wp,onChange:r,hint:s>0?`= ${s.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:a.ausrichtung,onChange:n=>r({target:{name:"param_ausrichtung",value:n.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(G,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:a.neigung_grad,onChange:r,hint:"0° = flach, 90° = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:a.hat_speicher,onChange:r,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),a.hat_speicher&&e.jsx(G,{label:"Speicher-Kapazität (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:a.speicher_kapazitaet_wh,onChange:r,hint:"z.B. 1600 Wh für Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:a.kategorie,onChange:n=>r({target:{name:"param_kategorie",value:n.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(G,{label:"Beschreibung",name:"param_beschreibung",value:a.beschreibung,onChange:r,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const dr=[{typ:"e-auto",label:"E-Auto",icon:ve,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wärmepumpe",icon:_e,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:rt,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:zt,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:X,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:pa,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:zt,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function Sn(){var R;const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(null),[n,i]=d.useState(!1),[x,c]=d.useState(null),[l,o]=d.useState(null),[g,p]=d.useState(null),[y,k]=d.useState(null),f=r??((R=t[0])==null?void 0:R.id),{investitionen:F,loading:_,createInvestition:j,updateInvestition:M,deleteInvestition:m}=It(f),h=Fs(F),u=d.useMemo(()=>{const W={};return dr.forEach(H=>{var D;W[H.typ]=((D=h[H.typ])==null?void 0:D.length)||0}),W},[h]),b=W=>{o(W),c(null),i(!0)},z=W=>{c(W),o(W.typ),i(!0)},C=async W=>{try{x?await M(x.id,W):await j(W),i(!1),c(null),o(null)}catch(H){k(H instanceof Error?H.message:"Fehler beim Speichern")}},L=async()=>{if(g)try{await m(g.id),p(null)}catch(W){k(W instanceof Error?W.message:"Fehler beim Löschen")}};return a||_?e.jsx(ye,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(le,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:f??"",onChange:W=>s(Number(W.target.value)),className:"input w-auto",children:t.map(W=>e.jsx("option",{value:W.id,children:W.anlagenname},W.id))})})]}),y&&e.jsx(le,{type:"error",onClose:()=>k(null),children:y}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:dr.map(W=>e.jsxs("button",{onClick:()=>b(W.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${W.bgColor}`,children:[e.jsx(W.icon,{className:`h-8 w-8 mx-auto ${W.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:W.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[u[W.typ]," vorhanden"]})]},W.typ))}),F.length===0?e.jsx(Et,{icon:_t,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wärmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(Z,{onClick:()=>b("speicher"),children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:dr.map(W=>{const H=h[W.typ];return!H||H.length===0?null:e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${W.bgColor}`,children:e.jsx(W.icon,{className:`h-5 w-5 ${W.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:W.label})]}),e.jsx(Z,{variant:"secondary",size:"sm",onClick:()=>b(W.typ),children:e.jsx(kt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:H.map(D=>e.jsx(En,{investition:D,onEdit:()=>z(D),onDelete:()=>p(D)},D.id))})]},W.typ)})}),e.jsx(qe,{isOpen:n,onClose:()=>{i(!1),c(null),o(null)},title:x?"Investition bearbeiten":"Neue Investition",size:"lg",children:l&&f&&e.jsx(_n,{investition:x,anlageId:f,typ:l,onSubmit:C,onCancel:()=>{i(!1),c(null),o(null)}})}),e.jsxs(qe,{isOpen:!!g,onClose:()=>p(null),title:"Investition löschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Möchtest du die Investition "',g==null?void 0:g.bezeichnung,'" wirklich löschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Z,{variant:"secondary",onClick:()=>p(null),children:"Abbrechen"}),e.jsx(Z,{variant:"danger",onClick:L,children:"Löschen"})]})]})]})}function En({investition:t,onEdit:a,onDelete:r}){const s=t.parameter||{},i=(()=>{const c=[];switch(t.typ){case"e-auto":s.batteriekapazitaet_kwh&&c.push(`${s.batteriekapazitaet_kwh} kWh Batterie`),s.verbrauch_kwh_100km&&c.push(`${s.verbrauch_kwh_100km} kWh/100km`),s.v2h_faehig&&c.push("V2H fähig");break;case"speicher":s.kapazitaet_kwh&&c.push(`${s.kapazitaet_kwh} kWh`),s.nutzbare_kapazitaet_kwh&&c.push(`${s.nutzbare_kapazitaet_kwh} kWh nutzbar`),s.arbitrage_faehig&&c.push("Arbitrage");break;case"waermepumpe":s.leistung_kw&&c.push(`${s.leistung_kw} kW`),s.cop&&c.push(`COP ${s.cop}`);break;case"wallbox":s.max_ladeleistung_kw&&c.push(`${s.max_ladeleistung_kw} kW`),s.bidirektional&&c.push("Bidirektional");break;case"wechselrichter":s.max_leistung_kw&&c.push(`${s.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":s.leistung_wp&&c.push(`${s.leistung_wp} Wp`),s.anzahl&&c.push(`${s.anzahl} Module`);break}return c})(),x=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join(" • ")}),x&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[x.toLocaleString("de-DE")," €"]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(ns,{className:"h-4 w-4"})}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Löschen",children:e.jsx(xt,{className:"h-4 w-4"})})]})]})}const Fn=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"März"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function aa({monatsdaten:t,anlageId:a,onSubmit:r,onCancel:s}){var ie,me,je,fe,O,Q,E,q,ae;const n=new Date().getFullYear(),i=new Date().getMonth()+1,[x,c]=d.useState(!1),[l,o]=d.useState(null),{investitionen:g,loading:p}=It(a),y=d.useMemo(()=>g.filter($=>$.aktiv),[g]),k=y.some($=>$.typ==="speicher"),f=y.some($=>$.typ==="e-auto"),F=y.some($=>$.typ==="wallbox"),_=y.some($=>$.typ==="waermepumpe"),j=y.some($=>$.typ==="wechselrichter"),M=y.some($=>$.typ==="pv-module"),m=y.some($=>$.typ==="balkonkraftwerk"),h=y.some($=>$.typ==="sonstiges"),[u,b]=d.useState({jahr:((ie=t==null?void 0:t.jahr)==null?void 0:ie.toString())||n.toString(),monat:((me=t==null?void 0:t.monat)==null?void 0:me.toString())||i.toString(),einspeisung_kwh:((je=t==null?void 0:t.einspeisung_kwh)==null?void 0:je.toString())||"",netzbezug_kwh:((fe=t==null?void 0:t.netzbezug_kwh)==null?void 0:fe.toString())||"",pv_erzeugung_kwh:((O=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:O.toString())||"",batterie_ladung_kwh:((Q=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:Q.toString())||"",batterie_entladung_kwh:((E=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:E.toString())||"",globalstrahlung_kwh_m2:((q=t==null?void 0:t.globalstrahlung_kwh_m2)==null?void 0:q.toString())||"",sonnenstunden:((ae=t==null?void 0:t.sonnenstunden)==null?void 0:ae.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[z,C]=d.useState(!1),[L,R]=d.useState(null),[W,H]=d.useState({}),[D,S]=d.useState(!1);d.useEffect(()=>{if(y.length===0)return;(async()=>{const T={};if(y.forEach(U=>{var ue,Se;if(U.typ==="e-auto")T[U.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(U.typ==="speicher")T[U.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(U.typ==="wallbox")T[U.id]={ladung_kwh:"",ladevorgaenge:""};else if(U.typ==="waermepumpe")T[U.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(U.typ==="wechselrichter")T[U.id]={pv_erzeugung_kwh:""};else if(U.typ==="pv-module")T[U.id]={pv_erzeugung_kwh:""};else if(U.typ==="balkonkraftwerk"){const pe=(ue=U.parameter)==null?void 0:ue.hat_speicher,w={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};pe?T[U.id]={...w,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:T[U.id]=w}else if(U.typ==="sonstiges"){const pe=((Se=U.parameter)==null?void 0:Se.kategorie)||"erzeuger";pe==="erzeuger"?T[U.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:pe==="verbraucher"?T[U.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:pe==="speicher"&&(T[U.id]={ladung_kwh:"",entladung_kwh:""})}T[U.id]&&(T[U.id].sonderkosten_euro="",T[U.id].sonderkosten_notiz="")}),t!=null&&t.jahr&&(t!=null&&t.monat)){S(!0);try{const U=await ze.getMonatsdatenByMonth(a,t.jahr,t.monat);U.forEach(I=>{const J=String(I.investition_id);T[J]&&I.verbrauch_daten&&Object.entries(I.verbrauch_daten).forEach(([Ie,Ee])=>{T[J][Ie]!==void 0&&(T[J][Ie]=(Ee==null?void 0:Ee.toString())||""),Ie==="v2h_entladung_kwh"&&T[J].entladung_v2h_kwh!==void 0&&(T[J].entladung_v2h_kwh=(Ee==null?void 0:Ee.toString())||""),Ie==="erzeugung_kwh"&&T[J].pv_erzeugung_kwh!==void 0&&(T[J].pv_erzeugung_kwh=(Ee==null?void 0:Ee.toString())||""),Ie==="verbrauch_kwh"&&T[J].verbrauch_sonstig_kwh!==void 0&&(T[J].verbrauch_sonstig_kwh=(Ee==null?void 0:Ee.toString())||"")})});const ue=y.filter(I=>I.typ==="speicher"),Se=new Set(U.filter(I=>ue.some(J=>J.id===I.investition_id)).map(I=>I.investition_id)),pe=(t==null?void 0:t.batterie_ladung_kwh)||0,w=(t==null?void 0:t.batterie_entladung_kwh)||0;if(ue.length>0&&(pe>0||w>0)){const I=ue.filter(J=>!Se.has(J.id));if(I.length>0){const J=1/I.length;I.forEach(Ie=>{const Ee=String(Ie.id);T[Ee]&&(T[Ee].ladung_kwh=(pe*J).toFixed(1),T[Ee].entladung_kwh=(w*J).toFixed(1))}),console.info(`Migration: Legacy-Speicherdaten (${pe}/${w} kWh) auf ${I.length} Speicher übertragen`)}}}catch(U){console.error("Fehler beim Laden der InvestitionMonatsdaten:",U)}finally{S(!1)}}H(T)})()},[y,t==null?void 0:t.jahr,t==null?void 0:t.monat,a]);const B=$=>{const{name:T,value:U}=$.target;b(ue=>({...ue,[T]:U}))},N=($,T,U)=>{H(ue=>({...ue,[$]:{...ue[$],[T]:U}}))},V=d.useMemo(()=>{let $=0,T=0,U=0;return y.forEach(ue=>{var pe,w;const Se=W[ue.id];Se&&(ue.typ==="speicher"?($+=parseFloat(Se.ladung_kwh)||0,T+=parseFloat(Se.entladung_kwh)||0):ue.typ==="pv-module"||ue.typ==="wechselrichter"||ue.typ==="balkonkraftwerk"?(U+=parseFloat(Se.pv_erzeugung_kwh)||0,ue.typ==="balkonkraftwerk"&&((pe=ue.parameter)!=null&&pe.hat_speicher)&&($+=parseFloat(Se.speicher_ladung_kwh)||0,T+=parseFloat(Se.speicher_entladung_kwh)||0)):ue.typ==="sonstiges"&&((w=ue.parameter)==null?void 0:w.kategorie)==="erzeuger"&&(U+=parseFloat(Se.erzeugung_kwh)||0))}),{batterieLadung:$,batterieEntladung:T,pvErzeugung:U}},[y,W]),se=async()=>{if(!u.jahr||!u.monat){o("Bitte zuerst Jahr und Monat auswählen");return}C(!0),R(null),o(null);try{const $=await Es.getMonatsdaten(a,parseInt(u.jahr),parseInt(u.monat));b(U=>({...U,globalstrahlung_kwh_m2:$.globalstrahlung_kwh_m2.toString(),sonnenstunden:$.sonnenstunden.toString()}));const T=$.datenquelle==="open-meteo"?`Historische Daten von Open-Meteo${$.abdeckung_prozent?` (${$.abdeckung_prozent}% Abdeckung)`:""}`:$.datenquelle==="pvgis-tmy"?"Durchschnittswerte von PVGIS (TMY)":"Geschätzte Durchschnittswerte";R(T)}catch($){o($ instanceof Error?$.message:"Wetterdaten konnten nicht abgerufen werden")}finally{C(!1)}},he=async $=>{if($.preventDefault(),o(null),!u.einspeisung_kwh||!u.netzbezug_kwh){o("Bitte Einspeisung und Netzbezug eingeben");return}try{c(!0);const T={};y.forEach(pe=>{const w=W[pe.id];if(!w)return;const I={};pe.typ==="e-auto"?(w.km_gefahren&&(I.km_gefahren=parseFloat(w.km_gefahren)),w.verbrauch_kwh&&(I.verbrauch_kwh=parseFloat(w.verbrauch_kwh)),w.ladung_pv_kwh&&(I.ladung_pv_kwh=parseFloat(w.ladung_pv_kwh)),w.ladung_netz_kwh&&(I.ladung_netz_kwh=parseFloat(w.ladung_netz_kwh)),w.ladung_extern_kwh&&(I.ladung_extern_kwh=parseFloat(w.ladung_extern_kwh)),w.ladung_extern_euro&&(I.ladung_extern_euro=parseFloat(w.ladung_extern_euro)),w.entladung_v2h_kwh&&(I.v2h_entladung_kwh=parseFloat(w.entladung_v2h_kwh))):pe.typ==="speicher"?(w.ladung_kwh&&(I.ladung_kwh=parseFloat(w.ladung_kwh)),w.entladung_kwh&&(I.entladung_kwh=parseFloat(w.entladung_kwh)),w.speicher_ladung_netz_kwh&&(I.speicher_ladung_netz_kwh=parseFloat(w.speicher_ladung_netz_kwh)),w.speicher_ladepreis_cent&&(I.speicher_ladepreis_cent=parseFloat(w.speicher_ladepreis_cent))):pe.typ==="wallbox"?(w.ladung_kwh&&(I.ladung_kwh=parseFloat(w.ladung_kwh)),w.ladevorgaenge&&(I.ladevorgaenge=parseInt(w.ladevorgaenge))):pe.typ==="waermepumpe"?(w.stromverbrauch_kwh&&(I.stromverbrauch_kwh=parseFloat(w.stromverbrauch_kwh)),w.heizenergie_kwh&&(I.heizenergie_kwh=parseFloat(w.heizenergie_kwh)),w.warmwasser_kwh&&(I.warmwasser_kwh=parseFloat(w.warmwasser_kwh))):pe.typ==="wechselrichter"||pe.typ==="pv-module"?w.pv_erzeugung_kwh&&(I.pv_erzeugung_kwh=parseFloat(w.pv_erzeugung_kwh)):pe.typ==="balkonkraftwerk"?(w.pv_erzeugung_kwh&&(I.erzeugung_kwh=parseFloat(w.pv_erzeugung_kwh)),w.eigenverbrauch_kwh&&(I.eigenverbrauch_kwh=parseFloat(w.eigenverbrauch_kwh)),w.einspeisung_kwh&&(I.einspeisung_kwh=parseFloat(w.einspeisung_kwh)),w.speicher_ladung_kwh&&(I.speicher_ladung_kwh=parseFloat(w.speicher_ladung_kwh)),w.speicher_entladung_kwh&&(I.speicher_entladung_kwh=parseFloat(w.speicher_entladung_kwh))):pe.typ==="sonstiges"&&(w.erzeugung_kwh&&(I.erzeugung_kwh=parseFloat(w.erzeugung_kwh)),w.eigenverbrauch_kwh&&(I.eigenverbrauch_kwh=parseFloat(w.eigenverbrauch_kwh)),w.einspeisung_kwh&&(I.einspeisung_kwh=parseFloat(w.einspeisung_kwh)),w.verbrauch_sonstig_kwh&&(I.verbrauch_kwh=parseFloat(w.verbrauch_sonstig_kwh)),w.bezug_pv_kwh&&(I.bezug_pv_kwh=parseFloat(w.bezug_pv_kwh)),w.bezug_netz_kwh&&(I.bezug_netz_kwh=parseFloat(w.bezug_netz_kwh)),w.ladung_kwh&&(I.ladung_kwh=parseFloat(w.ladung_kwh)),w.entladung_kwh&&(I.entladung_kwh=parseFloat(w.entladung_kwh))),w.sonderkosten_euro&&(I.sonderkosten_euro=parseFloat(w.sonderkosten_euro)),w.sonderkosten_notiz&&(I.sonderkosten_notiz=w.sonderkosten_notiz),Object.keys(I).length>0&&(T[pe.id]=I)});const U=u.batterie_ladung_kwh?parseFloat(u.batterie_ladung_kwh):V.batterieLadung||void 0,ue=u.batterie_entladung_kwh?parseFloat(u.batterie_entladung_kwh):V.batterieEntladung||void 0,Se=u.pv_erzeugung_kwh?parseFloat(u.pv_erzeugung_kwh):V.pvErzeugung||void 0;await r({anlage_id:a,jahr:parseInt(u.jahr),monat:parseInt(u.monat),einspeisung_kwh:parseFloat(u.einspeisung_kwh),netzbezug_kwh:parseFloat(u.netzbezug_kwh),pv_erzeugung_kwh:Se,batterie_ladung_kwh:U,batterie_entladung_kwh:ue,globalstrahlung_kwh_m2:u.globalstrahlung_kwh_m2?parseFloat(u.globalstrahlung_kwh_m2):void 0,sonnenstunden:u.sonnenstunden?parseFloat(u.sonnenstunden):void 0,notizen:u.notizen||void 0,investitionen_daten:Object.keys(T).length>0?T:void 0})}catch(T){o(T instanceof Error?T.message:"Fehler beim Speichern")}finally{c(!1)}};return p||D?e.jsx("div",{className:"text-center py-4 text-gray-500",children:D?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:he,className:"space-y-6",children:[l&&e.jsx(le,{type:"error",children:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(G,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:u.jahr,onChange:B,required:!0,disabled:!!t}),e.jsx(He,{label:"Monat",name:"monat",value:u.monat,onChange:B,options:Fn,required:!0,disabled:!!t})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:u.einspeisung_kwh,onChange:B,placeholder:"z.B. 450",required:!0}),e.jsx(G,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:u.netzbezug_kwh,onChange:B,placeholder:"z.B. 120",required:!0}),e.jsx(G,{label:M||j?"PV-Erzeugung (Summe oder manuell)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:u.pv_erzeugung_kwh,onChange:B,placeholder:V.pvErzeugung>0?`Summe: ${V.pvErzeugung.toFixed(1)}`:"z.B. 800",hint:V.pvErzeugung>0?`Aus ${M?"PV-Modulen":"Wechselrichtern"}: ${V.pvErzeugung.toFixed(1)} kWh`:"Wird berechnet wenn leer"})]})]}),M&&e.jsx(Ht,{title:"PV-Module",icon:X,iconColor:"text-yellow-500",investitionen:y.filter($=>$.typ==="pv-module"),investitionsDaten:W,onInvChange:N,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),j&&!M&&e.jsx(Ht,{title:"Wechselrichter",icon:X,iconColor:"text-yellow-500",investitionen:y.filter($=>$.typ==="wechselrichter"),investitionsDaten:W,onInvChange:N,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),k&&e.jsxs(e.Fragment,{children:[e.jsx(Cn,{investitionen:y.filter($=>$.typ==="speicher"),investitionsDaten:W,onInvChange:N}),(V.batterieLadung>0||V.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",V.batterieLadung.toFixed(1)," kWh | Entladung ",V.batterieEntladung.toFixed(1)," kWh"]})]}),f&&e.jsx(Wn,{investitionen:y.filter($=>$.typ==="e-auto"),investitionsDaten:W,onInvChange:N}),F&&e.jsx(Ht,{title:"Wallbox",icon:rt,iconColor:"text-purple-500",investitionen:y.filter($=>$.typ==="wallbox"),investitionsDaten:W,onInvChange:N,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgänge",unit:"",placeholder:"z.B. 12"}]}),_&&e.jsx(Ht,{title:"Wärmepumpe",icon:_e,iconColor:"text-orange-500",investitionen:y.filter($=>$.typ==="waermepumpe"),investitionsDaten:W,onInvChange:N,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),m&&e.jsx(Mn,{investitionen:y.filter($=>$.typ==="balkonkraftwerk"),investitionsDaten:W,onInvChange:N}),h&&e.jsx($n,{investitionen:y.filter($=>$.typ==="sonstiges"),investitionsDaten:W,onInvChange:N}),!k&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:u.batterie_ladung_kwh,onChange:B,placeholder:"z.B. 150"}),e.jsx(G,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:u.batterie_entladung_kwh,onChange:B,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Rr,{className:"w-4 h-4"}),"Wetterdaten (optional)"]}),e.jsx(Z,{type:"button",variant:"secondary",size:"sm",onClick:se,disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 animate-spin mr-1"})," Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Rr,{className:"w-4 h-4 mr-1"})," Auto-Fill"]})})]}),L&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-3 py-2 rounded",children:L}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(G,{label:"Globalstrahlung",name:"globalstrahlung_kwh_m2",type:"number",step:"0.1",min:"0",value:u.globalstrahlung_kwh_m2,onChange:B,placeholder:"z.B. 152",hint:"kWh/m²"}),e.jsx(G,{label:"Sonnenstunden",name:"sonnenstunden",type:"number",step:"1",min:"0",value:u.sonnenstunden,onChange:B,placeholder:"z.B. 245",hint:"Stunden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:u.notizen,onChange:B,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Z,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(Z,{type:"submit",loading:x,children:t?"Speichern":"Monat erfassen"})]})]})}function Cn({investitionen:t,investitionsDaten:a,onInvChange:r}){if(t.length===0)return null;const s=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],n=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:"Ø Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),t.map(i=>{var l;const c=((l=i.parameter)==null?void 0:l.arbitrage_faehig)?[...s,...n]:s;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:c.map(o=>{var g;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[o.label," ",o.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",o.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=a[i.id])==null?void 0:g[o.key])||"",onChange:p=>r(i.id,o.key,p.target.value),placeholder:o.placeholder,className:"input text-sm py-1.5",title:o.hint}),o.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:o.hint,children:o.hint})]},o.key)})}),e.jsx(Pt,{invId:i.id,investitionsDaten:a,onInvChange:r})]},i.id)})]})}function Wn({investitionen:t,investitionsDaten:a,onInvChange:r}){if(t.length===0)return null;const s=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"€",placeholder:"z.B. 18.00"}],n={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),t.map(i=>{var l,o;const c=((l=i.parameter)==null?void 0:l.v2h_faehig)||((o=i.parameter)==null?void 0:o.nutzt_v2h)?[...s,n]:s;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:c.map(g=>{var p;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[g.label," ",g.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",g.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=a[i.id])==null?void 0:p[g.key])||"",onChange:y=>r(i.id,g.key,y.target.value),placeholder:g.placeholder,className:"input text-sm py-1.5",title:g.hint}),g.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:g.hint,children:g.hint})]},g.key)})}),e.jsx(Pt,{invId:i.id,investitionsDaten:a,onInvChange:r})]},i.id)})]})}function Ht({title:t,icon:a,iconColor:r,investitionen:s,investitionsDaten:n,onInvChange:i,felder:x}){return s.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:`h-5 w-5 ${r}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),s.map(c=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:c.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:x.map(l=>{var o;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[l.label," ",l.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",l.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=n[c.id])==null?void 0:o[l.key])||"",onChange:g=>i(c.id,l.key,g.target.value),placeholder:l.placeholder,className:"input text-sm py-1.5",title:l.hint}),l.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:l.hint,children:l.hint})]},l.key)})}),e.jsx(Pt,{invId:c.id,investitionsDaten:n,onInvChange:i})]},c.id))]})}function Mn({investitionen:t,investitionsDaten:a,onInvChange:r}){return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),t.map(s=>{var i,x,c,l,o,g;const n=!!((i=s.parameter)!=null&&i.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[s.bezeichnung,s.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",s.leistung_kwp," kWp)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=a[s.id])==null?void 0:x.pv_erzeugung_kwh)||"",onChange:p=>r(s.id,"pv_erzeugung_kwh",p.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((c=a[s.id])==null?void 0:c.eigenverbrauch_kwh)||"",onChange:p=>r(s.id,"eigenverbrauch_kwh",p.target.value),placeholder:"z.B. 35",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=a[s.id])==null?void 0:l.einspeisung_kwh)||"",onChange:p=>r(s.id,"einspeisung_kwh",p.target.value),placeholder:"z.B. 10",className:"input text-sm py-1.5"})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=a[s.id])==null?void 0:o.speicher_ladung_kwh)||"",onChange:p=>r(s.id,"speicher_ladung_kwh",p.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=a[s.id])==null?void 0:g.speicher_entladung_kwh)||"",onChange:p=>r(s.id,"speicher_entladung_kwh",p.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(Pt,{invId:s.id,investitionsDaten:a,onInvChange:r})]},s.id)})]})}function $n({investitionen:t,investitionsDaten:a,onInvChange:r}){if(t.length===0)return null;const s={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),t.map(n=>{var x,c,l,o,g,p,y,k,f,F;const i=((x=n.parameter)==null?void 0:x.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[s[i]||i,(c=n.parameter)!=null&&c.beschreibung?` - ${String(n.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[i==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=a[n.id])==null?void 0:l.erzeugung_kwh)||"",onChange:_=>r(n.id,"erzeugung_kwh",_.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=a[n.id])==null?void 0:o.eigenverbrauch_kwh)||"",onChange:_=>r(n.id,"eigenverbrauch_kwh",_.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=a[n.id])==null?void 0:g.einspeisung_kwh)||"",onChange:_=>r(n.id,"einspeisung_kwh",_.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),i==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=a[n.id])==null?void 0:p.verbrauch_sonstig_kwh)||"",onChange:_=>r(n.id,"verbrauch_sonstig_kwh",_.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((y=a[n.id])==null?void 0:y.bezug_pv_kwh)||"",onChange:_=>r(n.id,"bezug_pv_kwh",_.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((k=a[n.id])==null?void 0:k.bezug_netz_kwh)||"",onChange:_=>r(n.id,"bezug_netz_kwh",_.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),i==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((f=a[n.id])==null?void 0:f.ladung_kwh)||"",onChange:_=>r(n.id,"ladung_kwh",_.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((F=a[n.id])==null?void 0:F.entladung_kwh)||"",onChange:_=>r(n.id,"entladung_kwh",_.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(Pt,{invId:n.id,investitionsDaten:a,onInvChange:r})]},n.id)})]})}function Pt({invId:t,investitionsDaten:a,onInvChange:r}){var x,c,l,o;const s=((x=a[t])==null?void 0:x.sonderkosten_euro)||((c=a[t])==null?void 0:c.sonderkosten_notiz),[n,i]=d.useState(!!s);return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:n?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Sonderkosten ",e.jsx("span",{className:"text-gray-400",children:"(€)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=a[t])==null?void 0:l.sonderkosten_euro)||"",onChange:g=>r(t,"sonderkosten_euro",g.target.value),placeholder:"z.B. 150",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Beschreibung"}),e.jsx("input",{type:"text",value:((o=a[t])==null?void 0:o.sonderkosten_notiz)||"",onChange:g=>r(t,"sonderkosten_notiz",g.target.value),placeholder:"z.B. Wechselrichter-Reparatur",className:"input text-sm py-1.5"})]})]}):e.jsx("button",{type:"button",onClick:()=>i(!0),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonderkosten erfassen (Reparatur, Wartung, etc.)"})})}const sa=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Rt=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",getValue:t=>t.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",getValue:t=>t.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",getValue:t=>t.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",getValue:t=>t.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",getValue:t=>t.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",getValue:t=>t.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"batterie_ladung",label:"Batt. Ladung",shortLabel:"B.Lad",getValue:t=>t.batterie_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"batterie_entladung",label:"Batt. Entladung",shortLabel:"B.Entl",getValue:t=>t.batterie_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",getValue:t=>{const a=t.eigenverbrauch_kwh||0,r=a+t.netzbezug_kwh;return r>0?a/r*100:0},format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",getValue:t=>{const a=t.eigenverbrauch_kwh||0,r=t.pv_erzeugung_kwh||0;return r>0?a/r*100:0},format:"percent",defaultVisible:!1}],na="eedc-monatsdaten-columns";function An(){const t=Ut(),{anlagen:a,loading:r}=Me(),[s,n]=d.useState(void 0),{monatsdaten:i,loading:x,error:c,createMonatsdaten:l,updateMonatsdaten:o,deleteMonatsdaten:g}=Cr(s),{investitionen:p}=It(s),[y,k]=d.useState(!1),[f,F]=d.useState(null),[_,j]=d.useState(null),[M,m]=d.useState(!1),[h,u]=d.useState(()=>{try{const D=localStorage.getItem(na);if(D)return new Set(JSON.parse(D))}catch{}return new Set(Rt.filter(D=>D.defaultVisible).map(D=>D.key))});d.useEffect(()=>{localStorage.setItem(na,JSON.stringify([...h]))},[h]);const b=D=>{u(S=>{const B=new Set(S);return B.has(D)?B.delete(D):B.add(D),B})},z=Rt.filter(D=>h.has(D.key));!s&&a.length>0&&!r&&n(a[0].id);const C=d.useMemo(()=>{if(!p.some(B=>B.typ==="speicher"&&B.aktiv))return{needed:!1,count:0};const S=i.filter(B=>B.batterie_ladung_kwh&&B.batterie_ladung_kwh>0||B.batterie_entladung_kwh&&B.batterie_entladung_kwh>0);return{needed:S.length>0,count:S.length}},[i,p]),L=async D=>{await l(D),k(!1)},R=async D=>{f&&(await o(f.id,D),F(null))},W=async()=>{_&&(await g(_.id),j(null))},H=(D,S)=>{if(D==null)return"-";const B=typeof D=="string"?parseFloat(D):D;if(isNaN(B))return"-";switch(S){case"kwh":return B.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${B.toFixed(1)}%`;case"euro":return`${B.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})} €`;default:return B.toLocaleString("de-DE",{maximumFractionDigits:1})}};return r||x?e.jsx(ye,{text:"Lade Daten..."}):a.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(A,{children:e.jsx(Et,{icon:We,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(Z,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(He,{value:(s==null?void 0:s.toString())||"",onChange:D=>n(parseInt(D.target.value)),options:a.map(D=>({value:D.id.toString(),label:D.anlagenname}))}),e.jsxs(Z,{onClick:()=>k(!0),children:[e.jsx(kt,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),c&&e.jsx(le,{type:"error",children:c}),C.needed&&e.jsxs(le,{type:"warning",className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Speicher-Daten Migration erforderlich"}),e.jsxs("p",{className:"text-sm mt-1",children:[C.count," Monat",C.count>1?"e":""," enthält",C.count>1?"en":""," Speicher-Daten im alten Format. Bitte jeden betroffenen Monat einmal öffnen und speichern, um die Daten zu migrieren."]})]})]}),i.length===0?e.jsx(A,{children:e.jsx(Et,{icon:Dt,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Z,{onClick:()=>k(!0),children:"Manuell erfassen"}),e.jsx(Z,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Z,{variant:"secondary",size:"sm",onClick:()=>m(!M),children:[e.jsx(Ua,{className:"h-4 w-4 mr-2"}),"Spalten (",z.length,"/",Rt.length,")"]})}),M&&e.jsxs(A,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:Rt.map(D=>e.jsx("button",{onClick:()=>b(D.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${h.has(D.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:D.label},D.key))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Klicke auf eine Spalte um sie ein-/auszublenden. Die Auswahl wird gespeichert."})]}),e.jsx(A,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Sr,{children:[e.jsx(Er,{children:e.jsxs(St,{children:[e.jsx(Ae,{children:"Monat"}),z.map(D=>e.jsxs(Ae,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:D.label}),e.jsx("span",{className:"sm:hidden",children:D.shortLabel||D.label})]},D.key)),e.jsx(Ae,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Fr,{children:i.map(D=>e.jsxs(St,{children:[e.jsx(Le,{children:e.jsxs("span",{className:"font-medium",children:[sa[D.monat]," ",D.jahr]})}),z.map(S=>{const B=S.getValue(D);return e.jsx(Le,{className:`text-right font-mono ${S.className||""}`,children:H(B,S.format)},S.key)}),e.jsx(Le,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>F(D),children:e.jsx(Nr,{className:"h-4 w-4"})}),e.jsx(Z,{variant:"ghost",size:"sm",onClick:()=>j(D),children:e.jsx(xt,{className:"h-4 w-4 text-red-500"})})]})})]},D.id))})]})})})]}),e.jsx(qe,{isOpen:y,onClose:()=>k(!1),title:"Monatsdaten erfassen",size:"lg",children:s&&e.jsx(aa,{anlageId:s,onSubmit:L,onCancel:()=>k(!1)})}),e.jsx(qe,{isOpen:!!f,onClose:()=>F(null),title:"Monatsdaten bearbeiten",size:"lg",children:f&&s&&e.jsx(aa,{monatsdaten:f,anlageId:s,onSubmit:R,onCancel:()=>F(null)})}),e.jsx(qe,{isOpen:!!_,onClose:()=>j(null),title:"Monatsdaten löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Daten für ",e.jsxs("strong",{children:[sa[(_==null?void 0:_.monat)||0]," ",_==null?void 0:_.jahr]})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Z,{variant:"secondary",onClick:()=>j(null),children:"Abbrechen"}),e.jsx(Z,{variant:"danger",onClick:W,children:"Löschen"})]})]})})]})}function ia(){var B;const{anlagen:t,loading:a,refresh:r}=Me(),[s,n]=d.useState(null),[i,x]=d.useState(!1),[c,l]=d.useState(!1),[o,g]=d.useState(null),[p,y]=d.useState(null),[k,f]=d.useState(!1),[F,_]=d.useState(!1),[j,M]=d.useState(null),m=d.useRef(null),h=t.some(N=>N.anlagenname==="Demo-Anlage"),u=s??((B=t[0])==null?void 0:B.id),b=N=>{N.preventDefault(),x(!0)},z=N=>{N.preventDefault(),x(!1)},C=async N=>{N.preventDefault(),x(!1);const V=N.dataTransfer.files;V.length>0&&await R(V[0])},L=async N=>{const V=N.target.files;V&&V.length>0&&await R(V[0]),m.current&&(m.current.value="")},R=async N=>{if(!u){y("Bitte zuerst eine Anlage auswählen");return}if(!N.name.endsWith(".csv")){y("Bitte eine CSV-Datei auswählen");return}y(null),g(null),l(!0);try{const V=await wt.importCSV(u,N,k);g(V)}catch(V){y(V instanceof Error?V.message:"Import fehlgeschlagen")}finally{l(!1)}},W=()=>{if(!u){y("Bitte zuerst eine Anlage auswählen");return}window.location.href=wt.getTemplateDownloadUrl(u)},H=()=>{if(!u){y("Bitte zuerst eine Anlage auswählen");return}window.location.href=wt.getExportUrl(u)},D=async()=>{y(null),M(null),_(!0);try{const N=await wt.createDemoData();M(N),r()}catch(N){y(N instanceof Error?N.message:"Fehler beim Erstellen der Demo-Daten")}finally{_(!1)}},S=async()=>{y(null),M(null),_(!0);try{await wt.deleteDemoData(),r()}catch(N){y(N instanceof Error?N.message:"Fehler beim Löschen der Demo-Daten")}finally{_(!1)}};return a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(le,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(Mt,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wärmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(Z,{onClick:D,loading:F,className:"w-full",children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pt,{className:"inline h-4 w-4 mr-1"}),j.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),t.length>1&&e.jsx("select",{value:u??"",onChange:N=>n(Number(N.target.value)),className:"input w-auto",children:t.map(N=>e.jsx("option",{value:N.id,children:N.anlagenname},N.id))})]}),p&&e.jsx(le,{type:"error",onClose:()=>y(null),children:p}),o&&e.jsx(Ln,{result:o,onClose:()=>g(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(Xa,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthält alle verfügbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Z,{variant:"secondary",className:"w-full",onClick:W,children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:b,onDragLeave:z,onDrop:C,onClick:()=>{var N;return(N=m.current)==null?void 0:N.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${c?"opacity-50 pointer-events-none":""}
              `,children:c?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ye,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(va,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:m,type:"file",accept:".csv",onChange:L,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:N=>f(N.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten überschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(Z,{variant:"secondary",size:"sm",onClick:H,children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-50 dark:bg-cyan-900/20",children:e.jsx(Ue,{className:"h-6 w-6 text-cyan-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Daten direkt aus deinem Home Assistant Energy Dashboard."}),e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:[e.jsx("strong",{children:"Phase 2:"})," Diese Funktion wird in einer zukünftigen Version verfügbar sein. Konfiguriere zuerst die Sensor-Zuordnung in den Einstellungen."]}),e.jsx(Z,{variant:"secondary",className:"w-full",disabled:!0,children:"Aus Home Assistant importieren"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(Mt,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:h?"Demo-Anlage ist bereits vorhanden. Du kannst sie löschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),h?e.jsxs(Z,{variant:"danger",onClick:S,loading:F,className:"w-full",children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Demo-Anlage löschen"]}):e.jsxs(Z,{onClick:D,loading:F,className:"w-full",children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(pt,{className:"inline h-4 w-4 mr-1"}),j.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthält:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, Wärmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs(A,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[e.jsx("p",{children:"Das CSV muss folgende Pflichtspalten enthalten:"}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{className:"mt-2",children:"Optionale Spalten für erweiterte Auswertungen:"}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," - Gesamte PV-Erzeugung"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Direktverbrauch_kWh"})," - Direkter Eigenverbrauch"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Batterie_Ladung_kWh"})," - Batterieladung"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Batterie_Entladung_kWh"})," - Batterieentladung"]})]})]})]})]})}function Ln({result:t,onClose:a}){const r=t.erfolg&&t.fehler.length===0;return e.jsxs("div",{className:`
      relative p-4 rounded-lg border
      ${r?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}
    `,children:[e.jsx("button",{onClick:a,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(zr,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[r?e.jsx(pt,{className:"h-5 w-5 text-green-500 mt-0.5"}):e.jsx(Ke,{className:"h-5 w-5 text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${r?"text-green-800 dark:text-green-200":"text-yellow-800 dark:text-yellow-200"}`,children:r?"Import erfolgreich":"Import mit Warnungen"}),e.jsxs("div",{className:"text-sm mt-1 space-y-1",children:[e.jsxs("p",{className:r?"text-green-700 dark:text-green-300":"text-yellow-700 dark:text-yellow-300",children:[t.importiert," Datensätze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} übersprungen`]}),t.fehler.length>0&&e.jsxs("ul",{className:"list-disc list-inside text-yellow-700 dark:text-yellow-300",children:[t.fehler.slice(0,5).map((s,n)=>e.jsx("li",{children:s},n)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]})]})]})]})}function Dn(){const{theme:t,setTheme:a}=Na(),[r,s]=d.useState(null),[n,i]=d.useState(null),[x,c]=d.useState([]),[l,o]=d.useState([]),[g,p]=d.useState(!0),[y,k]=d.useState(null),[f,F]=d.useState(!1),[_,j]=d.useState(null),M=async()=>{try{p(!0),k(null);const[m,h,u]=await Promise.all([qr.getStats(),qr.getSettings(),Ye.list()]);if(s(m),i(h),o(u),u.length>0&&!_&&j(u[0].id),h.ha_integration_enabled)try{const b=await Oe.getSensors();c(b)}catch{}}catch(m){k(m instanceof Error?m.message:"Fehler beim Laden der Einstellungen")}finally{p(!1)}};return d.useEffect(()=>{M()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:M,disabled:g,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Te,{className:`h-5 w-5 ${g?"animate-spin":""}`})})]}),y&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:y})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:X},{value:"dark",label:"Dunkel",icon:ya},{value:"system",label:"System",icon:ba}].map(m=>e.jsxs("button",{onClick:()=>a(m.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===m.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(m.icon,{className:"h-5 w-5"}),m.label]},m.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ue,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:n!=null&&n.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),x.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",x.length," Energy-Sensoren verfügbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt über ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen → Import/Export"})," um deine Daten zu importieren."]})]})]}),(n==null?void 0:n.ha_integration_enabled)&&l.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Auto-Discovery"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten (SMA, evcc, Smart, Wallbox) und erstelle Investitionen."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>1&&e.jsx("select",{value:_||"",onChange:m=>j(Number(m.target.value)),className:"text-sm px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:l.map(m=>e.jsx("option",{value:m.id,children:m.anlagenname},m.id))}),e.jsxs("button",{onClick:()=>F(!0),disabled:!_,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ct,{className:"w-4 h-4"}),"Geräte erkennen"]})]})]})}),x.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfügbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:x.map(m=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:m.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:m.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:m.unit_of_measurement||"-"})]},m.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ua,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),g?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Re,{className:"h-6 w-6 animate-spin text-gray-400"})}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),r.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(r.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",r.daten_zeitraum&&e.jsxs("span",{children:[" (",r.daten_zeitraum.von," - ",r.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",r.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(n==null?void 0:n.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfügbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"/api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]}),f&&_&&e.jsx(Wa,{isOpen:!0,onClose:()=>F(!1),anlageId:_,onInvestitionenCreated:M})]})}const la=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function In(){const{anlagen:t,loading:a}=Me(),[r,s]=d.useState(),[n,i]=d.useState(null),[x,c]=d.useState([]),[l,o]=d.useState(null),[g,p]=d.useState(null),[y,k]=d.useState(!1),[f,F]=d.useState(!1),[_,j]=d.useState(!1),[M,m]=d.useState(null),[h,u]=d.useState(null),[b,z]=d.useState(14);d.useEffect(()=>{t.length>0&&!r&&s(t[0].id)},[t,r]),d.useEffect(()=>{r&&C()},[r]);const C=async()=>{if(r){k(!0),m(null),u(null);try{const[N,V]=await Promise.all([Xe.getAktivePrognose(r),Xe.listeGespeichertePrognosen(r)]);i(N),c(V)}catch(N){m(N instanceof Error?N.message:"Fehler beim Laden")}finally{k(!1)}}},L=async()=>{if(r){F(!0),m(null);try{const N=await Xe.getPrognose(r,{system_losses:b});o(N)}catch(N){m(N instanceof Error?N.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{F(!1)}}},R=async()=>{if(r){j(!0),m(null);try{const N=await Xe.getOptimum(r);p(N)}catch(N){m(N instanceof Error?N.message:"Fehler beim Ermitteln des Optimums")}finally{j(!1)}}},W=async()=>{if(r){k(!0),m(null);try{await Xe.speicherePrognose(r,{system_losses:b}),u("Prognose erfolgreich gespeichert"),o(null),await C()}catch(N){m(N instanceof Error?N.message:"Fehler beim Speichern")}finally{k(!1)}}},H=async N=>{try{await Xe.aktivierePrognose(N),u("Prognose aktiviert"),await C()}catch(V){m(V instanceof Error?V.message:"Fehler beim Aktivieren")}},D=async N=>{if(confirm("Prognose wirklich löschen?"))try{await Xe.loeschePrognose(N),u("Prognose gelöscht"),await C()}catch(V){m(V instanceof Error?V.message:"Fehler beim Löschen")}},S=t.find(N=>N.id===r),B=(S==null?void 0:S.latitude)&&(S==null?void 0:S.longitude);return a?e.jsx(ye,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"}),e.jsx(le,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(He,{value:(r==null?void 0:r.toString())||"",onChange:N=>s(parseInt(N.target.value)),options:t.map(N=>({value:N.id.toString(),label:N.anlagenname}))}),e.jsx("button",{onClick:C,disabled:y,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Te,{className:`h-5 w-5 ${y?"animate-spin":""}`})})]})]}),M&&e.jsx(le,{type:"error",children:M}),h&&e.jsx(le,{type:"success",children:h}),!B&&e.jsx(le,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Qt,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergänze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu können."})]})]})}),B&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),y?e.jsx(ye,{}):n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[n.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[n.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[n.neigung_grad,"°"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:n.ausrichtung_richtung})]})]}),n.monatswerte&&n.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:n.monatswerte.map(N=>({name:la[N.monat],prognose:N.e_m})),children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name"}),e.jsx(ne,{tickFormatter:N=>`${N} kWh`}),e.jsx(te,{formatter:N=>`${N.toFixed(0)} kWh`}),e.jsx(Y,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(n.abgerufen_am).toLocaleDateString("de-DE")," • ","Koordinaten: ",n.latitude.toFixed(4),"°N, ",n.longitude.toFixed(4),"°E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:b,onChange:N=>z(parseFloat(N.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(Z,{onClick:L,disabled:f,className:"w-full",children:[f?e.jsx(Te,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),l&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(Z,{onClick:W,disabled:y,children:[e.jsx(pt,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:l.module.length})]})]}),l.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:l.module.map(N=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:N.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[N.leistung_kwp," kWp • ",N.ausrichtung," • ",N.neigung_grad,"° • ",N.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},N.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(ee,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:l.monatsdaten.map(N=>({name:la[N.monat],ertrag:N.e_m})),children:[e.jsx(ce,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name",fontSize:10}),e.jsx(ne,{tickFormatter:N=>`${N}`}),e.jsx(te,{formatter:N=>`${N.toFixed(0)} kWh`}),e.jsx(Y,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Za,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(Z,{onClick:R,disabled:_,variant:"secondary",children:[_?e.jsx(Te,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter für Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[g.optimal.neigung_grad,"°"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:g.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[g.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),g.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:g.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung für deinen Standort zu ermitteln.'})]}),x.length>0&&e.jsxs(A,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:x.map(N=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(N.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[N.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:N.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[N.neigung_grad,"°"]}),e.jsx("td",{className:"text-center py-2 px-2",children:N.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(pt,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!N.ist_aktiv&&e.jsx("button",{onClick:()=>H(N.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(pt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>D(N.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Löschen",children:e.jsx(xt,{className:"h-4 w-4"})})]})})]},N.id))})]})})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(We,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Über PVGIS"}),e.jsx("p",{children:"PVGIS (Photovoltaic Geographical Information System) ist ein Tool der EU-Kommission, das PV-Ertragsprognosen basierend auf Satellitendaten und Klimamodellen berechnet. Die Prognosen berücksichtigen Standort, Modulneigung, Ausrichtung und Systemverluste."}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"Mehr erfahren →"})]})]})})]})]})}const Gt={evcc_solar_pv:{label:"EVCC: Ladung PV",description:"Gesamt-Ladung × Solar-Anteil%",quellFelder:["evcc_total_charged","evcc_solar_percentage"]},evcc_solar_netz:{label:"EVCC: Ladung Netz",description:"Gesamt-Ladung × (100 - Solar%)",quellFelder:["evcc_total_charged","evcc_solar_percentage"]},verbrauch_aus_ladung_km:{label:"Verbrauch aus Ladung/km",description:"(PV + Netz + Extern) / km × 100",quellFelder:["ladung_pv","ladung_netz","km_gefahren"]}};function Pn({feld:t,value:a,onChange:r,sensoren:s,alleSensoren:n,suggestion:i}){const[x,c]=d.useState(""),[l,o]=d.useState(!1),g=typeof a=="object"?a.typ:"sensor",p=typeof a=="object"?a.sensor:a,y=typeof a=="object"?a.formel:void 0,k=typeof a=="object"?a.quell_sensoren:void 0,f=d.useMemo(()=>{if(!x)return s;const h=x.toLowerCase();return s.filter(u=>u.entity_id.toLowerCase().includes(h)||(u.friendly_name||"").toLowerCase().includes(h))},[s,x]),F=s.find(h=>h.entity_id===p),_=h=>{r(h==="sensor"?p||"":h==="berechnet"?{typ:"berechnet",formel:t.berechnung_formel||"",quell_sensoren:{}}:{typ:h})},j=h=>{r(h)},M=(h,u)=>{r({typ:"berechnet",formel:y||t.berechnung_formel||"",quell_sensoren:{...k,[h]:u}})},m=[{typ:"sensor",label:"Sensor",icon:e.jsx(yr,{className:"w-3 h-3"})}];return t.berechenbar&&t.berechnung_formel&&m.push({typ:"berechnet",label:"Berechnen",icon:e.jsx(br,{className:"w-3 h-3"})}),t.optional&&m.push({typ:"nicht_erfassen",label:"Nicht erfassen",icon:e.jsx(Hr,{className:"w-3 h-3"})}),t.manuell_only&&(m.length=0,m.push({typ:"manuell",label:"Nur manuell",icon:e.jsx(kr,{className:"w-3 h-3"})})),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.label," (",t.unit,")",t.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.hint&&e.jsx("span",{className:"text-xs text-gray-400",title:t.hint,children:e.jsx(Be,{className:"w-3 h-3 inline"})})]}),m.length>1&&e.jsx("div",{className:"flex gap-1 mb-2",children:m.map(({typ:h,label:u,icon:b})=>e.jsxs("button",{type:"button",onClick:()=>_(h),className:`flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors ${g===h?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[b,u]},h))}),t.manuell_only&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(kr,{className:"w-3 h-3"}),"Nur manuelle Eingabe möglich (in Monatsdaten)"]}),g==="sensor"&&!t.manuell_only&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l?x:p||"",onChange:h=>{c(h.target.value),o(!0)},onFocus:()=>o(!0),onBlur:()=>setTimeout(()=>o(!1),200),placeholder:"Sensor auswählen...",className:"input w-full pr-20 text-sm"}),i&&!p&&e.jsx("button",{type:"button",onClick:()=>j(i),className:"absolute right-8 top-1/2 -translate-y-1/2 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-2 py-0.5 rounded hover:bg-blue-200 dark:hover:bg-blue-800",children:"Vorschlag"}),p&&e.jsx("button",{type:"button",onClick:()=>j(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"×"}),l&&f.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-48 overflow-auto",children:[i&&e.jsx("div",{className:"px-3 py-2 bg-blue-50 dark:bg-blue-900/30 border-b cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/50",onClick:()=>{j(i),o(!1)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-3 h-3 text-blue-500"}),e.jsxs("span",{className:"text-xs font-medium text-blue-700 dark:text-blue-300",children:["Vorschlag: ",i]})]})}),f.slice(0,20).map(h=>e.jsxs("div",{className:`px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${h.entity_id===p?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>{j(h.entity_id),o(!1),c("")},children:[e.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white truncate",children:h.entity_id}),h.friendly_name&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:h.friendly_name})]},h.entity_id))]}),F&&F.friendly_name&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400 truncate",children:[F.friendly_name," (",F.unit_of_measurement||"N/A",")"]})]}),g==="berechnet"&&t.berechnung_formel&&Gt[t.berechnung_formel]&&e.jsxs("div",{className:"space-y-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-700 dark:text-purple-300 font-medium",children:[e.jsx(br,{className:"w-3 h-3"}),Gt[t.berechnung_formel].label]}),e.jsx("div",{className:"text-purple-600 dark:text-purple-400",children:Gt[t.berechnung_formel].description}),e.jsx("div",{className:"space-y-1",children:Gt[t.berechnung_formel].quellFelder.map(h=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 w-32 truncate",children:[h,":"]}),e.jsx("input",{type:"text",value:(k==null?void 0:k[h])||"",onChange:u=>M(h,u.target.value),placeholder:"sensor.evcc_*",className:"input flex-1 text-xs py-1"})]},h))})]}),g==="nicht_erfassen"&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/50 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(Hr,{className:"w-3 h-3"}),"Wird nicht erfasst (kein Utility Meter)"]})]})}function cr({value:t,onChange:a,sensoren:r,suggestion:s,label:n,placeholder:i}){const[x,c]=d.useState(""),[l,o]=d.useState(!1),g=d.useMemo(()=>{if(!x)return r;const y=x.toLowerCase();return r.filter(k=>k.entity_id.toLowerCase().includes(y)||(k.friendly_name||"").toLowerCase().includes(y))},[r,x]),p=r.find(y=>y.entity_id===t);return e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:n}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l?x:t||"",onChange:y=>{c(y.target.value),o(!0)},onFocus:()=>o(!0),onBlur:()=>setTimeout(()=>o(!1),200),placeholder:i||"Sensor auswählen...",className:"input w-full pr-20"}),s&&!t&&e.jsx("button",{type:"button",onClick:()=>a(s),className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-2 py-1 rounded hover:bg-blue-200 dark:hover:bg-blue-800",children:"Vorschlag"}),t&&e.jsx("button",{type:"button",onClick:()=>a(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:"×"})]}),l&&g.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-auto",children:[s&&e.jsx("div",{className:"px-3 py-2 bg-blue-50 dark:bg-blue-900/30 border-b border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/50",onClick:()=>{a(s),o(!1)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:["Vorschlag: ",s]})]})}),g.map(y=>e.jsxs("div",{className:`px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${y.entity_id===t?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>{a(y.entity_id),o(!1),c("")},children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:y.entity_id}),y.friendly_name&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:y.friendly_name})]},y.entity_id))]}),p&&p.friendly_name&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[p.friendly_name," (",p.unit_of_measurement||"N/A",")"]})]})}function Vn(){var fe,O,Q;const[t,a]=d.useState([]),[r,s]=d.useState(null),[n,i]=d.useState([]),[x,c]=d.useState(null),[l,o]=d.useState(!0),[g,p]=d.useState(null),[y,k]=d.useState("investitionen"),[f,F]=d.useState(!1),[_,j]=d.useState([]),[M,m]=d.useState([]),[h,u]=d.useState(!1),[b,z]=d.useState(null),[C,L]=d.useState(null),[R,W]=d.useState({}),[H,D]=d.useState({}),S=async()=>{try{o(!0),p(null);const E=await Ye.list();a(E),E.length>0&&!r&&s(E[0].id)}catch(E){p(E instanceof Error?E.message:"Fehler beim Laden")}finally{o(!1)}},B=async()=>{if(r)try{o(!0);const E=await ft.getInvestitionenMitFeldern(r);i(E);const q={};E.forEach(ae=>{var $;($=ae.parameter)!=null&&$.ha_sensors&&(q[ae.id]=ae.parameter.ha_sensors)}),D(q)}catch(E){p(E instanceof Error?E.message:"Fehler beim Laden der Investitionen")}finally{o(!1)}},N=async()=>{var E,q,ae;try{const $=await ft.getHASensors();j($.sensoren),u($.connected),z($.fehler||null);try{const T=await ft.getHASensors(!1,!1,!0,!0);m(T.sensoren)}catch{m($.sensoren)}if($.connected&&r){const T=await ft.getSensorSuggestions(r);if(L(T),Object.keys(R).length===0){const U={};(E=T.basis.einspeisung)!=null&&E.vorschlag&&(U.einspeisung=T.basis.einspeisung.vorschlag),(q=T.basis.netzbezug)!=null&&q.vorschlag&&(U.netzbezug=T.basis.netzbezug.vorschlag),(ae=T.basis.pv_erzeugung)!=null&&ae.vorschlag&&(U.pv_erzeugung=T.basis.pv_erzeugung.vorschlag),W(U)}}}catch($){z($ instanceof Error?$.message:"Fehler beim Laden der HA-Sensoren")}},V=async()=>{if(r)try{o(!0);const E=Object.entries(H).map(([ae,$])=>({investition_id:parseInt(ae),mappings:$}));await ft.saveCompleteSensorMapping(r,{basis:R,investitionen:E});const q=await ft.generateYaml(r,R);c(q),k("yaml")}catch(E){p(E instanceof Error?E.message:"Fehler beim Generieren der YAML")}finally{o(!1)}};d.useEffect(()=>{S()},[]),d.useEffect(()=>{r&&(B(),c(null),k("investitionen"),L(null),W({}),D({}))},[r]);const se=async E=>{try{await navigator.clipboard.writeText(E),F(!0),setTimeout(()=>F(!1),2e3)}catch{const q=document.createElement("textarea");q.value=E,document.body.appendChild(q),q.select(),document.execCommand("copy"),document.body.removeChild(q),F(!0),setTimeout(()=>F(!1),2e3)}},he=E=>({"e-auto":{label:"E-Auto",color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},speicher:{label:"Speicher",color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"},wallbox:{label:"Wallbox",color:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"},waermepumpe:{label:"Wärmepumpe",color:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"},"pv-module":{label:"PV-Module",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"},balkonkraftwerk:{label:"Balkonkraftwerk",color:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200"},sonstiges:{label:"Sonstiges",color:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}})[E]||{label:E,color:"bg-gray-100 text-gray-800"},ie=(E,q,ae)=>{D($=>({...$,[E]:{...$[E],[q]:ae}}))},me=d.useMemo(()=>{let E=0;return R.einspeisung&&E++,R.netzbezug&&E++,R.pv_erzeugung&&E++,Object.values(H).forEach(q=>{Object.values(q).forEach(ae=>{typeof ae=="string"&&ae&&E++,typeof ae=="object"&&ae.typ&&E++})}),E},[R,H]),je=d.useMemo(()=>{let E=3;return n.forEach(q=>{E+=q.felder.length}),E},[n]);return l&&t.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Re,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ue,{className:"w-6 h-6"}),"HA Daten-Import"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Automatisierter Import von Monatsdaten aus Home Assistant"})]}),e.jsx("button",{onClick:S,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Neu laden",children:e.jsx(Te,{className:"w-5 h-5"})})]}),g&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700 dark:text-red-300",children:g})]}),t.length>1&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswählen"}),e.jsx("select",{value:r||"",onChange:E=>s(Number(E.target.value)),className:"input max-w-md",children:t.map(E=>e.jsx("option",{value:E.id,children:E.anlagenname},E.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto",children:[{key:"investitionen",label:"Investitionen",icon:Jt},{key:"sensoren",label:"Sensoren zuordnen",icon:yr},{key:"yaml",label:"YAML",icon:Qa},{key:"anleitung",label:"Anleitung",icon:Be}].map((E,q)=>e.jsxs("button",{onClick:()=>{E.key==="sensoren"&&!h&&N(),k(E.key)},disabled:E.key==="yaml"&&!x,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors whitespace-nowrap ${y===E.key?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-200":E.key==="yaml"&&!x?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 text-sm font-medium",children:q+1}),e.jsx(E.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:E.label})]},E.key))})}),e.jsxs("div",{className:"p-6",children:[y==="investitionen"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Investitionen"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[n.length," Investitionen"]})]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Jt,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Keine aktiven Investitionen gefunden."}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte legen Sie zuerst Investitionen unter Einstellungen → Investitionen an."})]}):e.jsx("div",{className:"space-y-4",children:n.map(E=>{const q=he(E.typ);return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${q.color}`,children:q.label}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:E.bezeichnung})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:E.felder.map(ae=>e.jsxs("div",{className:`text-sm rounded px-3 py-2 ${ae.manuell_only?"bg-amber-50 dark:bg-amber-900/20":ae.berechenbar?"bg-purple-50 dark:bg-purple-900/20":"bg-gray-50 dark:bg-gray-900"}`,children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:ae.label}),e.jsxs("span",{className:"text-gray-400 dark:text-gray-500 ml-1",children:["(",ae.unit,")"]}),ae.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"}),ae.optional&&e.jsx("span",{className:"text-gray-400 ml-1 text-xs",children:"(optional)"}),ae.berechenbar&&e.jsx("span",{className:"ml-1",title:"Berechenbar",children:e.jsx(br,{className:"w-3 h-3 inline text-purple-500"})}),ae.manuell_only&&e.jsx("span",{className:"ml-1",title:"Nur manuelle Eingabe",children:e.jsx(kr,{className:"w-3 h-3 inline text-amber-500"})})]},ae.key))})]},E.id)})}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:()=>{N(),k("sensoren")},disabled:l||n.length===0,className:"btn btn-primary flex items-center gap-2",children:[l?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(bt,{className:"w-4 h-4"}),"Sensoren zuordnen"]})})]}),y==="sensoren"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"HA-Sensoren zuordnen"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[me," / ",je," zugeordnet"]}),h?e.jsxs("span",{className:"flex items-center gap-1 text-sm text-green-600 dark:text-green-400",children:[e.jsx(yr,{className:"w-4 h-4"}),"HA verbunden"]}):e.jsxs("span",{className:"flex items-center gap-1 text-sm text-red-600 dark:text-red-400",children:[e.jsx(rs,{className:"w-4 h-4"}),"Nicht verbunden"]})]})]}),b&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300",children:b}),e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-1",children:"Sie können die Sensor-IDs auch manuell eingeben."})]})]})}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-yellow-500"}),"Basis-Energiedaten"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(cr,{label:"Einspeisung (kWh)",value:R.einspeisung||"",onChange:E=>W(q=>({...q,einspeisung:E})),sensoren:_,suggestion:(fe=C==null?void 0:C.basis.einspeisung)==null?void 0:fe.vorschlag,placeholder:"sensor.grid_export_energy"}),e.jsx(cr,{label:"Netzbezug (kWh)",value:R.netzbezug||"",onChange:E=>W(q=>({...q,netzbezug:E})),sensoren:_,suggestion:(O=C==null?void 0:C.basis.netzbezug)==null?void 0:O.vorschlag,placeholder:"sensor.grid_import_energy"}),e.jsx(cr,{label:"PV-Erzeugung (kWh)",value:R.pv_erzeugung||"",onChange:E=>W(q=>({...q,pv_erzeugung:E})),sensoren:_,suggestion:(Q=C==null?void 0:C.basis.pv_erzeugung)==null?void 0:Q.vorschlag,placeholder:"sensor.pv_energy_total"})]})]}),n.map(E=>{const q=he(E.typ),ae=C==null?void 0:C.investitionen[String(E.id)];return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${q.color}`,children:q.label}),E.bezeichnung]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.felder.map($=>{var T,U;return e.jsx(Pn,{feld:$,value:(T=H[E.id])==null?void 0:T[$.key],onChange:ue=>ie(E.id,$.key,ue),sensoren:_,alleSensoren:M,suggestion:(U=ae==null?void 0:ae.felder[$.key])==null?void 0:U.vorschlag},$.key)})})]},E.id)}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>k("investitionen"),className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(tr,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{onClick:V,disabled:l,className:"btn btn-primary flex items-center gap-2",children:[l?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(bt,{className:"w-4 h-4"}),"YAML generieren"]})]})]}),y==="yaml"&&x&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["YAML-Konfiguration für ",x.anlage_name]}),x.has_placeholders&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-1",children:"⚠️ Enthält noch Platzhalter - bitte in Schritt 2 zuordnen"})]}),e.jsxs("button",{onClick:()=>se(x.yaml),className:"btn btn-secondary flex items-center gap-2",children:[f?e.jsx(et,{className:"w-4 h-4 text-green-500"}):e.jsx(ma,{className:"w-4 h-4"}),f?"Kopiert!":"Kopieren"]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:e.jsx("pre",{className:"p-4 text-sm text-gray-100 overflow-x-auto max-h-[500px]",children:e.jsx("code",{children:x.yaml})})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-800 dark:text-blue-200 flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Hinweise"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 dark:text-blue-300 space-y-1",children:x.hinweise.map((E,q)=>e.jsx("li",{children:E},q))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>k("sensoren"),className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(tr,{className:"w-4 h-4"}),"Sensoren bearbeiten"]}),e.jsxs("button",{onClick:()=>k("anleitung"),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(bt,{className:"w-4 h-4"}),"Weiter zur Anleitung"]})]})]}),y==="anleitung"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Einrichtung in Home Assistant"}),e.jsx("div",{className:"space-y-4",children:[{step:1,title:"YAML kopieren",description:"Kopiere die generierte YAML-Konfiguration aus dem vorherigen Schritt."},{step:2,title:"In configuration.yaml einfügen",description:"Füge die Konfiguration am Ende deiner configuration.yaml Datei ein. Falls du noch Platzhalter hast, ersetze diese mit deinen Sensor-IDs."},{step:3,title:"Home Assistant neu starten",description:"Starte Home Assistant neu, damit die neuen Sensoren und die Automation aktiv werden."},{step:4,title:"Utility Meter prüfen",description:"Prüfe unter Entwicklerwerkzeuge → Zustände, ob die neuen eedc_* Sensoren existieren."},{step:5,title:"Automation testen (optional)",description:"Du kannst die Automation manuell auslösen oder auf den 1. des Monats warten."}].map(E=>e.jsxs("div",{className:"flex gap-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-700 dark:text-blue-300",children:E.step})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:E.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:E.description})]})]},E.step))}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200 flex items-center gap-2 mb-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Wichtig"]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 dark:text-yellow-300 space-y-1",children:[e.jsx("li",{children:"Die Quell-Sensoren müssen Gesamtzähler sein (state_class: total_increasing)"}),e.jsx("li",{children:"Die Automation wird am 1. jeden Monats um 00:05 ausgeführt"}),e.jsx("li",{children:"Falls der Import fehlschlägt, prüfe das Home Assistant Log"}),e.jsx("li",{children:"EEDC muss unter der konfigurierten URL erreichbar sein"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>k("yaml"),className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(tr,{className:"w-4 h-4"}),"Zurück zur YAML"]}),e.jsxs("button",{onClick:()=>k("investitionen"),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Fertig"]})]})]})]})]})]})}function Kn(){const[t,a]=d.useState([]),[r,s]=d.useState(null),[n,i]=d.useState(null),[x,c]=d.useState(null),[l,o]=d.useState(null),[g,p]=d.useState(!0),[y,k]=d.useState(null),[f,F]=d.useState(null),[_,j]=d.useState("core-mosquitto"),[M,m]=d.useState(1883),[h,u]=d.useState(""),[b,z]=d.useState(""),[C,L]=d.useState(null),[R,W]=d.useState(null),[H,D]=d.useState(!1),[S,B]=d.useState(!1),[N,V]=d.useState(!1),[se,he]=d.useState("mqtt"),[ie,me]=d.useState(new Set(["energie","finanzen"])),[je,fe]=d.useState(!1),O=async()=>{try{p(!0),k(null);const[w,I,J]=await Promise.all([Ye.list(),Oe.getExportSensors(),Oe.getMqttConfig().catch(()=>null)]);a(w),i(I),J&&(F(J),j(J.host),m(J.port),u(J.username)),w.length>0&&!r&&s(w[0].id)}catch(w){k(w instanceof Error?w.message:"Fehler beim Laden")}finally{p(!1)}},Q=async w=>{try{const[I,J]=await Promise.all([Oe.getAnlageSensors(w),Oe.getYamlSnippet(w)]);c(I),o(J)}catch(I){console.error("Fehler beim Laden der Anlage-Daten:",I)}};d.useEffect(()=>{O()},[]),d.useEffect(()=>{r&&Q(r)},[r]);const E=async()=>{D(!0),L(null);try{const w=await Oe.testMqtt({host:_,port:M,username:h||void 0,password:b||void 0});L(w)}catch(w){L({connected:!1,error:w instanceof Error?w.message:"Verbindungsfehler"})}finally{D(!1)}},q=async()=>{if(r){B(!0),W(null);try{const w=await Oe.publishMqtt(r,{host:_,port:M,username:h||void 0,password:b||void 0});W(w)}catch(w){W({message:w instanceof Error?w.message:"Fehler beim Publizieren",anlage_id:r,total:0,success:0,failed:0})}finally{B(!1)}}},ae=async()=>{if(r&&confirm("Alle EEDC-Sensoren für diese Anlage aus Home Assistant entfernen?")){V(!0);try{await Oe.removeMqtt(r,{host:_,port:M,username:h||void 0,password:b||void 0}),W(null)}catch(w){k(w instanceof Error?w.message:"Fehler beim Entfernen")}finally{V(!1)}}},$=async()=>{if(l)try{await navigator.clipboard.writeText(l.yaml),fe(!0),setTimeout(()=>fe(!1),2e3)}catch{const w=document.createElement("textarea");w.value=l.yaml,document.body.appendChild(w),w.select(),document.execCommand("copy"),document.body.removeChild(w),fe(!0),setTimeout(()=>fe(!1),2e3)}},T=()=>{if(!l||!x)return;const w=new Blob([l.yaml],{type:"text/yaml"}),I=URL.createObjectURL(w),J=document.createElement("a");J.href=I,J.download=`eedc_sensors_${x.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(J),J.click(),document.body.removeChild(J),URL.revokeObjectURL(I)},U=w=>{me(I=>{const J=new Set(I);return J.has(w)?J.delete(w):J.add(w),J})},ue=w=>{const I={};return w.forEach(J=>{const Ie=J.category||"sonstige";I[Ie]||(I[Ie]=[]),I[Ie].push(J)}),I},Se={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},pe={energie:"⚡",finanzen:"💰",autarkie:"🏠",umwelt:"🌱",performance:"📊",sonstige:"📌"};return g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Re,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:O,disabled:g,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Te,{className:`h-5 w-5 ${g?"animate-spin":""}`})})]}),y&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:y})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO₂, ROI) als Sensoren an Home Assistant zurückgeben. Wähle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entitäten)."})]})]}),t.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswählen"}),e.jsx("select",{value:r||"",onChange:w=>s(Number(w.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:t.map(w=>e.jsx("option",{value:w.id,children:w.anlagenname},w.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>he("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${se==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>he("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${se==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),se==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),f&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:_,onChange:w=>j(w.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:M,onChange:w=>m(Number(w.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:h,onChange:w=>u(w.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:b,onChange:w=>z(w.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),C&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${C.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:C.connected?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",C.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:C.error})]})}),C.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:C.hint})]}),R&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${R.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[R.success," von ",R.total," Sensoren publiziert"]})]}),R.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[R.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:E,disabled:H,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[H?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(Te,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:q,disabled:S||!r,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[S?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(ka,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:ae,disabled:N||!r,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[N?e.jsx(Re,{className:"w-4 h-4 animate-spin"}):e.jsx(xt,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${f!=null&&f.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[f!=null&&f.auto_publish?e.jsx(et,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(Ke,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${f!=null&&f.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen → Geräte & Dienste → MQTT"}),".",f!=null&&f.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",f.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelmäßig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen für automatische Updates."]})]})]})]})]}),se==="rest"&&l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML für configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:$,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:je?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ma,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:T,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(tt,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:l.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:l.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["Füge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",l.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach Änderungen muss Home Assistant neu gestartet werden."]})]})]})]}),x&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verfügbare Sensoren (",x.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(ue(x.sensors)).map(([w,I])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>U(w),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:pe[w]||"📌"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:Se[w]||w}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",I.length,")"]})]}),ie.has(w)?e.jsx(Yt,{className:"w-5 h-5 text-gray-400"}):e.jsx(bt,{className:"w-5 h-5 text-gray-400"})]}),ie.has(w)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:I.map(J=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:J.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:J.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:J.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:J.value!==null?typeof J.value=="number"?J.value.toLocaleString("de-DE",{maximumFractionDigits:2}):J.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:J.unit})]})]}),J.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",J.formel,J.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",J.berechnung]})]})]},J.key))})]},w))})]}),n&&n.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:n.investitionen.map(w=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:w.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",w.typ," - ",w.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:w.sensors.map(I=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:I.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:I.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:I.value!==null?typeof I.value=="number"?I.value.toLocaleString("de-DE",{maximumFractionDigits:2}):I.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:I.unit})]})]},I.key))})]},w.investition_id))})]})]})}function Bn(){return e.jsx(Da,{children:e.jsx(Ia,{children:e.jsxs(de,{path:"/",element:e.jsx(Ns,{}),children:[e.jsx(de,{index:!0,element:e.jsx($e,{to:"/cockpit",replace:!0})}),e.jsx(de,{path:"cockpit",element:e.jsx(Ls,{})}),e.jsx(de,{path:"cockpit/pv-anlage",element:e.jsx(Ps,{})}),e.jsx(de,{path:"cockpit/e-auto",element:e.jsx(Vs,{})}),e.jsx(de,{path:"cockpit/waermepumpe",element:e.jsx(Bs,{})}),e.jsx(de,{path:"cockpit/speicher",element:e.jsx(Hs,{})}),e.jsx(de,{path:"cockpit/wallbox",element:e.jsx(Gs,{})}),e.jsx(de,{path:"cockpit/balkonkraftwerk",element:e.jsx(Us,{})}),e.jsx(de,{path:"cockpit/sonstiges",element:e.jsx(Ys,{})}),e.jsx(de,{path:"auswertungen",element:e.jsx(Qr,{})}),e.jsx(de,{path:"auswertungen/roi",element:e.jsx(on,{})}),e.jsx(de,{path:"auswertungen/prognose",element:e.jsx(xn,{})}),e.jsx(de,{path:"auswertungen/export",element:e.jsx(Qr,{})})," ",e.jsx(de,{path:"einstellungen/anlage",element:e.jsx(jn,{})}),e.jsx(de,{path:"einstellungen/strompreise",element:e.jsx(fn,{})}),e.jsx(de,{path:"einstellungen/investitionen",element:e.jsx(Sn,{})}),e.jsx(de,{path:"einstellungen/monatsdaten",element:e.jsx(An,{})}),e.jsx(de,{path:"einstellungen/import",element:e.jsx(ia,{})}),e.jsx(de,{path:"einstellungen/demo",element:e.jsx(ia,{})})," ",e.jsx(de,{path:"einstellungen/pvgis",element:e.jsx(In,{})}),e.jsx(de,{path:"einstellungen/ha-import",element:e.jsx(Vn,{})}),e.jsx(de,{path:"einstellungen/ha-export",element:e.jsx(Kn,{})}),e.jsx(de,{path:"einstellungen/allgemein",element:e.jsx(Dn,{})}),e.jsx(de,{path:"dashboard",element:e.jsx($e,{to:"/cockpit",replace:!0})}),e.jsx(de,{path:"anlagen",element:e.jsx($e,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(de,{path:"monatsdaten",element:e.jsx($e,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(de,{path:"strompreise",element:e.jsx($e,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(de,{path:"investitionen",element:e.jsx($e,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(de,{path:"auswertung",element:e.jsx($e,{to:"/auswertungen",replace:!0})}),e.jsx(de,{path:"roi",element:e.jsx($e,{to:"/auswertungen/roi",replace:!0})}),e.jsx(de,{path:"e-auto",element:e.jsx($e,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(de,{path:"waermepumpe",element:e.jsx($e,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(de,{path:"speicher",element:e.jsx($e,{to:"/cockpit/speicher",replace:!0})}),e.jsx(de,{path:"wallbox",element:e.jsx($e,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(de,{path:"balkonkraftwerk",element:e.jsx($e,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(de,{path:"sonstiges",element:e.jsx($e,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(de,{path:"import",element:e.jsx($e,{to:"/einstellungen/import",replace:!0})}),e.jsx(de,{path:"settings",element:e.jsx($e,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function On({onNext:t,onLoadDemo:a}){const[r,s]=d.useState(!1),[n,i]=d.useState(null),x=async()=>{if(a){s(!0),i(null);try{await a()}catch(c){i(c instanceof Error?c.message:"Fehler beim Laden der Demo-Daten"),s(!1)}}};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(X,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persönliches Energie Effizienz Data Center für die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(or,{icon:e.jsx(ha,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(or,{icon:e.jsx(_t,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen für alle Ihre Energie-Investitionen"}),e.jsx(or,{icon:e.jsx(ge,{className:"w-6 h-6"}),title:"Home Assistant",description:"Automatischer Datenimport direkt aus Ihrem Smart Home"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(Wt,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(Wt,{number:2,text:"Home Assistant Verbindung prüfen"}),e.jsx(Wt,{number:3,text:"Stromtarif konfigurieren (mit Vorschlägen)"}),e.jsx(Wt,{number:4,text:"Geräte automatisch aus HA erkennen"}),e.jsx(Wt,{number:5,text:"Investitionen vervollständigen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(Je,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),a&&e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:x,disabled:r,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:r?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),n&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:n}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enthält 31 Monate Beispieldaten, 9 Investitionen inkl. E-Auto, Speicher, Wärmepumpe u.v.m."})]})]})]})}function or({icon:t,title:a,description:r}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:a}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r})]})}function Wt({number:t,text:a}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a})]})}const Tn=[{value:"",label:"-- Auswählen --"},{value:"Süd",label:"Süd (optimal)"},{value:"Südost",label:"Südost"},{value:"Südwest",label:"Südwest"},{value:"Ost",label:"Ost"},{value:"West",label:"West"},{value:"Ost-West",label:"Ost-West"}],Hn=[{value:"",label:"-- Unbekannt / Andere --"},{value:"sma",label:"SMA"},{value:"fronius",label:"Fronius"},{value:"kostal",label:"Kostal"},{value:"huawei",label:"Huawei / FusionSolar"},{value:"growatt",label:"Growatt"},{value:"solax",label:"SolaX"},{value:"sungrow",label:"Sungrow"},{value:"goodwe",label:"GoodWe"},{value:"enphase",label:"Enphase"}];function Rn({isLoading:t,error:a,onSubmit:r,onGeocode:s,onBack:n}){const[i,x]=d.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:"",ausrichtung:"",neigung_grad:"",wechselrichter_hersteller:""}),[c,l]=d.useState(null),[o,g]=d.useState(!1),[p,y]=d.useState(!1),k=j=>{const{name:M,value:m}=j.target;x(h=>({...h,[M]:m})),l(null),(M==="standort_plz"||M==="standort_ort")&&y(!1)},f=async()=>{if(!i.standort_plz){l("Bitte geben Sie eine PLZ ein");return}g(!0),l(null),y(!1);try{const j=await s(i.standort_plz,i.standort_ort||void 0);j?(x(M=>({...M,latitude:j.latitude.toFixed(6),longitude:j.longitude.toFixed(6)})),y(!0)):l("Koordinaten konnten nicht ermittelt werden. Bitte prüfen Sie PLZ/Ort.")}catch{l("Fehler beim Ermitteln der Koordinaten")}finally{g(!1)}},F=async j=>{if(j.preventDefault(),l(null),!i.anlagenname.trim()){l("Bitte geben Sie einen Namen für Ihre Anlage ein");return}if(!i.leistung_kwp||parseFloat(i.leistung_kwp)<=0){l("Bitte geben Sie die Anlagenleistung in kWp ein");return}await r({anlagenname:i.anlagenname.trim(),leistung_kwp:parseFloat(i.leistung_kwp),installationsdatum:i.installationsdatum||void 0,standort_plz:i.standort_plz||void 0,standort_ort:i.standort_ort||void 0,latitude:i.latitude?parseFloat(i.latitude):void 0,longitude:i.longitude?parseFloat(i.longitude):void 0,ausrichtung:i.ausrichtung||void 0,neigung_grad:i.neigung_grad?parseFloat(i.neigung_grad):void 0,wechselrichter_hersteller:i.wechselrichter_hersteller||void 0})},_=c||a;return e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),_&&e.jsx(le,{type:"error",className:"mb-6",children:_}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:i.anlagenname,onChange:k,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:i.leistung_kwp,onChange:k,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Dt,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:i.installationsdatum,onChange:k,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für korrekten Start der Stromtarif-Gültigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(Qt,{className:"w-4 h-4 text-gray-500"}),"Standort (für PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:i.standort_plz,onChange:k,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:i.standort_ort,onChange:k,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:f,disabled:o||!i.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):p?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:i.latitude,onChange:k,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Längengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:i.longitude,onChange:k,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Be,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden für die PVGIS-Ertragsprognose benötigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Technische Daten (optional)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsx("select",{name:"ausrichtung",value:i.ausrichtung,onChange:k,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:Tn.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",name:"neigung_grad",value:i.neigung_grad,onChange:k,placeholder:"z.B. 30",min:"0",max:"90",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Typisch: 30-35° (Süd), 10-15° (Ost-West)"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Wechselrichter-Hersteller (optional)"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hersteller"}),e.jsx("select",{name:"wechselrichter_hersteller",value:i.wechselrichter_hersteller,onChange:k,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:Hn.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Hilft bei der automatischen Erkennung von Home Assistant Sensoren"})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Je,{className:"w-4 h-4"})]})})]})]})}function Gn({isLoading:t,error:a,haConnected:r,haVersion:s,onRetry:n,onNext:i,onSkip:x,onBack:c}){return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${r?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:r?e.jsx(_r,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(Lt,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Home Assistant Verbindung"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatischer Datenimport aus Ihrem Smart Home"})]})]}),e.jsxs("div",{className:"space-y-6",children:[t?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx(Te,{className:"w-8 h-8 text-amber-500 animate-spin"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Verbindung wird geprüft..."})]}):r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(Ge,{className:"w-10 h-10 text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Verbindung erfolgreich!"}),s&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Home Assistant Version: ",s]}),e.jsxs("div",{className:"max-w-md mx-auto bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-medium text-green-800 dark:text-green-300 mb-2",children:"Folgende Funktionen sind verfügbar:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-green-700 dark:text-green-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Automatische Geräte-Erkennung"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Sensor-Zuordnung für Energy-Daten"]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(Lt,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Keine Verbindung zu Home Assistant"}),a&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:a}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 text-left mb-6",children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-300 mb-2 flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Mögliche Ursachen:"]}),e.jsxs("ul",{className:"space-y-1 text-sm text-amber-700 dark:text-amber-400",children:[e.jsx("li",{children:"• EEDC läuft nicht als Home Assistant Add-on"}),e.jsx("li",{children:"• Home Assistant API nicht erreichbar"}),e.jsx("li",{children:"• Supervisor Token fehlt"})]})]}),e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Te,{className:"w-4 h-4"}),"Erneut prüfen"]})]})]}),!t&&!r&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Sie können EEDC auch ohne Home Assistant nutzen. Investitionen und Daten können manuell oder per CSV-Import erfasst werden. Die HA-Integration kann jederzeit später aktiviert werden."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!r&&e.jsxs("button",{type:"button",onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(fa,{className:"w-4 h-4"}),"Überspringen"]}),e.jsxs("button",{type:"button",onClick:i,disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(Je,{className:"w-4 h-4"})]})]})]})]})}function qn({anlage:t,isLoading:a,error:r,onSubmit:s,onUseDefaults:n,onBack:i}){const x=t?Ea(t.leistung_kwp):ut.einspeiseverguetung_cent_kwh,[c,l]=d.useState({netzbezug_arbeitspreis_cent_kwh:ut.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:x.toString(),grundpreis_euro_monat:ut.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[o,g]=d.useState(null),p=f=>{const{name:F,value:_}=f.target;l(j=>({...j,[F]:_})),g(null)},y=async f=>{if(f.preventDefault(),g(null),!c.netzbezug_arbeitspreis_cent_kwh||parseFloat(c.netzbezug_arbeitspreis_cent_kwh)<0){g("Bitte geben Sie einen gültigen Netzbezugspreis ein");return}if(!c.gueltig_ab){g("Bitte geben Sie ein Gültigkeitsdatum ein");return}await s({netzbezug_arbeitspreis_cent_kwh:parseFloat(c.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(c.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:c.grundpreis_euro_monat?parseFloat(c.grundpreis_euro_monat):void 0,gueltig_ab:c.gueltig_ab,tarifname:c.tarifname||void 0,anbieter:c.anbieter||void 0})},k=o||r;return e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ge,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Für korrekte Wirtschaftlichkeitsberechnungen"})]})]}),k&&e.jsx(le,{type:"error",className:"mb-6",children:k}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:n,disabled:a,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(Mt,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[ut.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",x," ct Einspeisung |"," ",ut.grundpreis_euro_monat," € Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:c.netzbezug_arbeitspreis_cent_kwh,onChange:p,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergütung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:c.einspeiseverguetung_cent_kwh,onChange:p,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"≤10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (€/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:c.grundpreis_euro_monat,onChange:p,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gültig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:c.gueltig_ab,onChange:p,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:c.tarifname,onChange:p,placeholder:"z.B. Ökostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:c.anbieter,onChange:p,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Be,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können später weitere Stromtarife mit unterschiedlichen Gültigkeitszeiträumen hinzufügen, z.B. bei Tarifwechsel oder Preisänderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:a,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Je,{className:"w-4 h-4"})]})})]})]})}function Jn(t){switch(t.suggested_investition_typ){case"e-auto":return e.jsx(ve,{className:"w-5 h-5"});case"speicher":return e.jsx(ke,{className:"w-5 h-5"});case"wallbox":return e.jsx(rt,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(At,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(_e,{className:"w-5 h-5"});case"balkonkraftwerk":return e.jsx(X,{className:"w-5 h-5"});default:return e.jsx(At,{className:"w-5 h-5"})}}function Un(t){switch(t){case"e-auto":return"E-Auto";case"speicher":return"Speicher";case"wallbox":return"Wallbox";case"wechselrichter":return"Wechselrichter";case"pv-module":return"PV-Module";case"waermepumpe":return"Wärmepumpe";case"balkonkraftwerk":return"Balkonkraftwerk";default:return"Unbekannt"}}function Zn({isLoading:t,error:a,haConnected:r,discoveryResult:s,onRunDiscovery:n,onSkip:i,onBack:x}){const c=(s==null?void 0:s.devices.filter(o=>!o.already_configured&&o.suggested_investition_typ))??[],l=(s==null?void 0:s.devices.filter(o=>o.already_configured))??[];return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Geräte erkennen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatische Erkennung aus Home Assistant"})]})]}),!t&&!s&&!a&&r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-6",children:e.jsx(ct,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Geräte automatisch erkennen?"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"EEDC durchsucht Home Assistant nach Wechselrichtern, Speichern, Wallboxen, E-Autos, Wärmepumpen und Balkonkraftwerken."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-8",children:"Erkannte Geräte werden als Investitionen angelegt und können im nächsten Schritt vervollständigt werden."}),e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-500 text-white font-medium rounded-xl hover:bg-amber-600 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(ct,{className:"w-5 h-5"}),"Discovery starten"]})]}),t&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(ct,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Durchsuche Home Assistant nach Geräten..."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Erkannte Geräte werden automatisch als Investitionen angelegt."})]}),!t&&!r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(Lt,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Home Assistant Verbindung"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Die automatische Geräteerkennung ist ohne HA-Verbindung nicht möglich."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-6",children:"Sie können Investitionen im nächsten Schritt manuell anlegen."}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg text-sm",children:[e.jsx(kt,{className:"w-4 h-4"}),"Manuelles Anlegen möglich im nächsten Schritt"]})]}),!t&&a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:e.jsx(Ke,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler bei der Erkennung"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-6",children:a}),e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Te,{className:"w-4 h-4"}),"Erneut versuchen"]})]}),!t&&s&&!a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(_r,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"}),s.devices.length>0&&e.jsxs("span",{className:"text-gray-400 dark:text-gray-500",children:["• ",s.devices.length," Gerät(e) gefunden"]})]}),s.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:s.warnings.map((o,g)=>e.jsx("p",{children:o},g))})]})}),s.devices.length===0&&e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-xl",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Keine unterstützten Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-4",children:"Unterstützt: SMA, evcc, Smart, Wallbox, Wärmepumpen-Integrationen"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:n,className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-amber-600 dark:text-amber-400 hover:text-amber-700 dark:hover:text-amber-300",children:[e.jsx(Te,{className:"w-4 h-4"}),"Erneut suchen"]}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manuelles Anlegen im nächsten Schritt möglich"})]})]}),c.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-green-500"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[c.length," Investition",c.length!==1?"en":""," angelegt"]})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:c.map(o=>e.jsx("div",{className:"p-4 rounded-xl border-2 border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",children:Jn(o)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:o.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o.manufacturer&&`${o.manufacturer} • `,Un(o.suggested_investition_typ)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:o.integration})]}),e.jsx(Ge,{className:"w-5 h-5 text-green-500 flex-shrink-0"})]})},o.id))}),e.jsx("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Diese Investitionen können im nächsten Schritt vervollständigt werden (Kaufdatum, Kaufpreis, etc.)."})]}),l.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-400"}),l.length," Gerät(e) bereits konfiguriert (übersprungen)"]}),s.devices.length>0&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Im nächsten Schritt können Sie weitere Investitionen manuell hinzufügen (z.B. PV-Module) und alle Details vervollständigen."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:x,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!s&&!t&&e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(fa,{className:"w-4 h-4"}),"Überspringen"]}),s&&!t&&e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter",e.jsx(Je,{className:"w-4 h-4"})]})]})]})]})}function Ar(t){switch(t){case"e-auto":return e.jsx(ve,{className:"w-5 h-5"});case"speicher":return e.jsx(ke,{className:"w-5 h-5"});case"wallbox":return e.jsx(rt,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(At,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(_e,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(X,{className:"w-5 h-5"});default:return e.jsx(wr,{className:"w-5 h-5"})}}function Yn({investition:t,allInvestitionen:a,anlage:r,onUpdate:s,onDelete:n,isNew:i=!1}){const[x,c]=d.useState(!0);d.useEffect(()=>{i&&c(!0)},[i]);const[l,o]=d.useState(!1),g=Ms[t.typ],p=g?a.filter(f=>f.typ===g&&f.id!==t.id):[],y=f=>{var F;return(F=t.parameter)==null?void 0:F[f]},k=(f,F)=>{s({parameter:{...t.parameter,[f]:F}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>c(!x),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:Ar(t.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung||st[t.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[st[t.typ],t.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:["• ",t.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]})]}),x?e.jsx(Yt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(bt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),x&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:t.bezeichnung,onChange:f=>s({bezeichnung:f.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:t.anschaffungsdatum||"",onChange:f=>s({anschaffungsdatum:f.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (€) *"}),e.jsx("input",{type:"number",value:t.anschaffungskosten_gesamt??"",onChange:f=>s({anschaffungskosten_gesamt:parseFloat(f.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),g&&e.jsx("div",{children:(()=>{const f=$s.includes(t.typ),F=p.length>0,_=f&&!t.parent_investition_id&&F;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",st[g],")",f?" *":" (optional)"]}),F?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.parent_investition_id||"",onChange:j=>s({parent_investition_id:j.target.value?parseInt(j.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${_?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:f?"-- Bitte wählen --":"-- Keine Zuordnung --"}),p.map(j=>e.jsx("option",{value:j.id,children:j.bezeichnung},j.id))]}),_&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(We,{className:"w-4 h-4"}),"PV-Module müssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 flex-shrink-0"}),f?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen können."]}):e.jsxs("span",{children:["Kein ",st[g]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),t.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW)"}),e.jsx("input",{type:"number",value:y("leistung_kw")??"",onChange:f=>k("leistung_kw",parseFloat(f.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:t.leistung_kwp??"",onChange:f=>s({leistung_kwp:parseFloat(f.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{value:t.ausrichtung||(r==null?void 0:r.ausrichtung)||"",onChange:f=>s({ausrichtung:f.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",value:t.neigung_grad??(r==null?void 0:r.neigung_grad)??"",onChange:f=>s({neigung_grad:parseFloat(f.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="speicher"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazität (kWh)"}),e.jsx("input",{type:"number",value:y("kapazitaet_kwh")??"",onChange:f=>k("kapazitaet_kwh",parseFloat(f.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="wallbox"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW)"}),e.jsx("input",{type:"number",value:y("leistung_kw")??"",onChange:f=>k("leistung_kw",parseFloat(f.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazität (kWh)"}),e.jsx("input",{type:"number",value:y("batterie_kwh")??"",onChange:f=>k("batterie_kwh",parseFloat(f.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km)"}),e.jsx("input",{type:"number",value:y("verbrauch_kwh_100km")??"",onChange:f=>k("verbrauch_kwh_100km",parseFloat(f.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW)"}),e.jsx("input",{type:"number",value:y("leistung_kw")??"",onChange:f=>k("leistung_kw",parseFloat(f.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl)"}),e.jsx("input",{type:"number",value:y("cop")??"3.5",onChange:f=>k("cop",parseFloat(f.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (Wp)"}),e.jsx("input",{type:"number",value:y("leistung_wp")??"",onChange:f=>k("leistung_wp",parseFloat(f.target.value)||void 0),placeholder:"z.B. 800",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module"}),e.jsx("input",{type:"number",value:y("anzahl")??"",onChange:f=>k("anzahl",parseInt(f.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:l?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich löschen?"}),e.jsx("button",{type:"button",onClick:()=>{n(),o(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, löschen"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>o(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(xt,{className:"w-4 h-4"}),"Investition löschen"]})})]})]})}function da({onAdd:t}){const[a,r]=d.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>r(!a),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(kt,{className:"w-5 h-5"}),"Investition hinzufügen"]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>r(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:Fa.map(s=>e.jsxs("button",{type:"button",onClick:()=>{t(s),r(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Ar(s)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:st[s]})]},s))})]})]})}function Qn({investitionen:t,anlage:a,isLoading:r,error:s,onUpdateInvestition:n,onDeleteInvestition:i,onAddInvestition:x,onNext:c,onBack:l}){const[o,g]=d.useState(null),[p,y]=d.useState(null),k=d.useRef(null);d.useEffect(()=>{if(p&&k.current){k.current.scrollIntoView({behavior:"smooth",block:"center"});const _=setTimeout(()=>y(null),2e3);return()=>clearTimeout(_)}},[p]);const f=Fa.reduce((_,j)=>{const M=t.filter(m=>m.typ===j);return M.length>0&&_.push({typ:j,items:M}),_},[]),F=async _=>{g(_);try{const j=await x(_);j!=null&&j.id&&y(j.id)}finally{g(null)}};return t.length===0&&!r?e.jsxs("div",{children:[e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(wr,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Keine Investitionen vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Sie können jetzt manuell Investitionen anlegen oder diesen Schritt überspringen und später unter Einstellungen → Investitionen ergänzen."}),e.jsx(da,{onAdd:F}),o&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",st[o]," hinzu..."]})]})}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter ohne Investitionen",e.jsx(Je,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollständigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergänzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden für die ROI-Berechnung benötigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length," Investition",t.length!==1?"en":""]})]}),s&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(We,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:s})]}),r&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!r&&e.jsxs("div",{className:"space-y-6",children:[f.map(({typ:_,items:j})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Ar(_)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[st[_]," (",j.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:j.map(M=>e.jsx("div",{ref:M.id===p?k:void 0,className:`transition-all duration-500 ${M.id===p?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(Yn,{investition:M,allInvestitionen:t,anlage:a,onUpdate:m=>n(M.id,m),onDelete:()=>i(M.id),isNew:M.id===p})},M.id))})]},_)),e.jsxs("div",{className:"pt-4",children:[e.jsx(da,{onAdd:F}),o&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",st[o]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Be,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig für die Amortisationsberechnung. Sie können alle Angaben später jederzeit unter Einstellungen → Investitionen ändern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:c,disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(Je,{className:"w-4 h-4"})]})]})]})}function Xn(t){switch(t){case"e-auto":return e.jsx(ve,{className:"w-4 h-4"});case"speicher":return e.jsx(ke,{className:"w-4 h-4"});case"wallbox":return e.jsx(rt,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(At,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(_e,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(X,{className:"w-4 h-4"});default:return e.jsx(wr,{className:"w-4 h-4"})}}function ei({anlage:t,strompreis:a,investitionen:r,onComplete:s,onBack:n}){const i=!!t,x=!!a,c=r.length>0,l=r.reduce((o,g)=>o+(g.anschaffungskosten_gesamt||0),0);return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(Ge,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschließen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Überprüfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(gr,{icon:e.jsx(X,{className:"w-5 h-5"}),title:"PV-Anlage",status:i?"success":"warning",children:i?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&` • ${t.standort_ort}`,t.latitude&&t.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(gr,{icon:e.jsx(ge,{className:"w-5 h-5"}),title:"Stromtarif",status:x?"success":"warning",children:x?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:a.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:a.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),a.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.tarifname,a.anbieter&&` (${a.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollständig"})}),e.jsx(gr,{icon:e.jsx(At,{className:"w-5 h-5"}),title:"Investitionen",status:c?"success":"neutral",children:c?e.jsxs("div",{className:"space-y-2",children:[r.slice(0,5).map(o=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:Xn(o.typ)}),e.jsx("span",{className:"truncate",children:o.bezeichnung}),o.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[o.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]},o.id)),r.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",r.length-5," weitere"]}),l>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",l.toLocaleString("de-DE")," €"]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - können später hinzugefügt werden"})})]}),e.jsx(ti,{hasAnlage:i,investitionen:r})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:["Einrichtung abschließen",e.jsx(Ge,{className:"w-5 h-5"})]})]})]})}function gr({icon:t,title:a,status:r,children:s}){const n={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${n[r]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[r]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:a}),r==="success"&&e.jsx(Ge,{className:"w-4 h-4 text-green-500"}),r==="warning"&&e.jsx(We,{className:"w-4 h-4 text-amber-500"})]}),s]})]})})}function ti({hasAnlage:t,investitionen:a}){const r=a.some(x=>x.typ==="wechselrichter"),s=a.some(x=>x.typ==="pv-module"),n=[];s||n.push({text:"PV-Module unter Einstellungen → Investitionen anlegen (wichtig für PVGIS-Prognose)",priority:"high"}),!r&&t&&n.push({text:"Wechselrichter unter Einstellungen → Investitionen ergänzen",priority:"high"}),n.push({text:"Monatsdaten unter Einstellungen → Monatsdaten erfassen oder CSV importieren",priority:"medium"}),s&&n.push({text:"PVGIS-Prognose unter Auswertungen → Prognose abrufen",priority:"medium"}),n.push({text:"Dashboard und Auswertungen erkunden",priority:"low"});const i=n.sort((x,c)=>{const l={high:0,medium:1,low:2};return l[x.priority]-l[c.priority]});return e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-amber-500"}),"Empfohlene nächste Schritte:"]}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.map((x,c)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Je,{className:`w-4 h-4 flex-shrink-0 mt-0.5 ${x.priority==="high"?"text-amber-500":x.priority==="medium"?"text-blue-500":"text-green-500"}`}),e.jsx("span",{className:`${x.priority==="high"?"text-gray-900 dark:text-white font-medium":"text-gray-600 dark:text-gray-400"}`,children:x.text})]},c))}),(!s||!r)&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," PV-Module werden nicht automatisch erkannt und müssen manuell angelegt werden. Die Angaben zu Ausrichtung und Neigung sind wichtig für die PVGIS-Ertragsprognose."]})})]})}function ri({anlage:t,onGoToDashboard:a}){return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(X,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(ss,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8 max-w-md mx-auto text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Erste Schritte:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(xr,{number:1,text:"Fehlende Investitionen unter Einstellungen ergänzen"}),e.jsx(xr,{number:2,text:"Monatsdaten erfassen oder CSV importieren"}),e.jsx(xr,{number:3,text:"Dashboard und ROI-Berechnungen erkunden"})]})]}),e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Zum Dashboard",e.jsx(Je,{className:"w-5 h-5"})]})]})}function xr({number:t,text:a}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:a})]})}const vt=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"ha-connection",label:"Home Assistant",shortLabel:"HA"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"discovery",label:"Geräte erkennen",shortLabel:"Geräte"},{key:"investitionen",label:"Investitionen",shortLabel:"Invest."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function ai({onComplete:t}){var i;const a=As(),r=async()=>{await wt.createDemoData(),t()};d.useEffect(()=>{a.step==="ha-connection"&&!a.haConnected&&a.checkHAConnection()},[a.step]),d.useEffect(()=>{if(a.step==="complete"){const x=setTimeout(t,100);return()=>clearTimeout(x)}},[a.step,t]);const s=vt.findIndex(x=>x.key===a.step),n=a.step!=="welcome"&&a.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(X,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),n&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",s+1," von ",vt.length]})]})})}),n&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:vt.map((x,c)=>{const l=c<s,o=c===s;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${l?"bg-green-500 text-white":o?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:l?e.jsx(Ge,{className:"w-5 h-5"}):c+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${o?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:x.label})]}),c<vt.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${l?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},x.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(i=vt[s])==null?void 0:i.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[s+1,"/",vt.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${a.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[a.step==="welcome"&&e.jsx(On,{onNext:a.nextStep,onLoadDemo:r}),a.step==="anlage"&&e.jsx(Rn,{isLoading:a.isLoading,error:a.error,onSubmit:a.createAnlage,onGeocode:a.geocodeAddress,onBack:a.prevStep}),a.step==="ha-connection"&&e.jsx(Gn,{isLoading:a.isLoading,error:a.error,haConnected:a.haConnected,haVersion:a.haVersion,onRetry:a.checkHAConnection,onNext:a.nextStep,onSkip:a.skipStep,onBack:a.prevStep}),a.step==="strompreise"&&e.jsx(qn,{anlage:a.anlage,isLoading:a.isLoading,error:a.error,onSubmit:a.createStrompreis,onUseDefaults:a.useDefaultStrompreise,onBack:a.prevStep}),a.step==="discovery"&&e.jsx(Zn,{isLoading:a.isLoading,error:a.error,haConnected:a.haConnected,discoveryResult:a.discoveryResult,onRunDiscovery:a.runDiscoveryAndCreateInvestitionen,onSkip:a.nextStep,onBack:a.prevStep}),a.step==="investitionen"&&e.jsx(Qn,{investitionen:a.investitionen,anlage:a.anlage,isLoading:a.isLoading,error:a.error,onUpdateInvestition:a.updateInvestition,onDeleteInvestition:a.deleteInvestition,onAddInvestition:a.addInvestition,onNext:a.nextStep,onBack:a.prevStep}),a.step==="summary"&&e.jsx(ei,{anlage:a.anlage,strompreis:a.strompreis,investitionen:a.investitionen,onComplete:a.completeWizard,onBack:a.prevStep}),a.step==="complete"&&e.jsx(ri,{anlage:a.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc – Energie Effizienz Data Center"})]})}const hr="eedc_setup_wizard_completed";function si({children:t}){const[a,r]=d.useState(!0),[s,n]=d.useState(!1);d.useEffect(()=>{i()},[]);const i=async()=>{try{(await Ye.list()).length===0?(localStorage.removeItem(hr),localStorage.removeItem("eedc_setup_wizard_state"),n(!0)):(localStorage.setItem(hr,"true"),n(!1))}catch(c){console.error("Fehler beim Prüfen des Setup-Status:",c),n(!1)}finally{r(!1)}},x=()=>{localStorage.setItem(hr,"true"),n(!1)};return a?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):s?e.jsx(ai,{onComplete:x}):e.jsx(e.Fragment,{children:t})}ur.createRoot(document.getElementById("root")).render(e.jsx(Pa.StrictMode,{children:e.jsx(xs,{children:e.jsx(si,{children:e.jsx(Bn,{})})})}));
