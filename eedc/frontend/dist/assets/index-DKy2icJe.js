var xr=Object.defineProperty;var hr=(t,r,a)=>r in t?xr(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var Ea=(t,r,a)=>hr(t,typeof r!="symbol"?r+"":r,a);import{r as c,a as mr,u as qa,N as ra,O as ur,b as Vt,H as pr,d as br,e as re,f as we,R as yr}from"./vendor-DpDmk0XN.js";import{R as Y,B as pe,C as de,X as ce,Y as le,T as Q,L as be,a as ne,b as fe,A as pt,c as Me,P as He,d as Ge,e as Bt,f as gt,g as kr,h as jr}from"./charts-CRPigxjo.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&n(g)}).observe(document,{childList:!0,subtree:!0});function a(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=a(s);fetch(s.href,l)}})();var Ja={exports:{}},Kt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fr=c,vr=Symbol.for("react.element"),wr=Symbol.for("react.fragment"),Nr=Object.prototype.hasOwnProperty,_r=fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zr={key:!0,ref:!0,__self:!0,__source:!0};function Ua(t,r,a){var n,s={},l=null,g=null;a!==void 0&&(l=""+a),r.key!==void 0&&(l=""+r.key),r.ref!==void 0&&(g=r.ref);for(n in r)Nr.call(r,n)&&!zr.hasOwnProperty(n)&&(s[n]=r[n]);if(t&&t.defaultProps)for(n in r=t.defaultProps,r)s[n]===void 0&&(s[n]=r[n]);return{$$typeof:vr,type:t,key:l,ref:g,props:s,_owner:_r.current}}Kt.Fragment=wr;Kt.jsx=Ua;Kt.jsxs=Ua;Ja.exports=Kt;var e=Ja.exports,sa={},Fa=mr;sa.createRoot=Fa.createRoot,sa.hydrateRoot=Fa.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Sr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),$=(t,r)=>{const a=c.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:g,className:d="",children:i,...o},x)=>c.createElement("svg",{ref:x,...Sr,width:s,height:s,stroke:n,strokeWidth:g?Number(l)*24/Number(s):l,className:["lucide",`lucide-${Er(t)}`,d].join(" "),...o},[...r.map(([u,p])=>c.createElement(u,p)),...Array.isArray(i)?i:[i]]));return a.displayName=`${t}`,a};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=$("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=$("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=$("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=$("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=$("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=$("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=$("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=$("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=$("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=$("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=$("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=$("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=$("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=$("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=$("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=$("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=$("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=$("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=$("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=$("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=$("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=$("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=$("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=$("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=$("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=$("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=$("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=$("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=$("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=$("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=$("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=$("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=$("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=$("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=$("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=$("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=$("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=$("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=$("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=$("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=$("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=$("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=$("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=$("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=$("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=$("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=$("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=$("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=$("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=$("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=$("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=$("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=$("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=$("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=$("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=$("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=$("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=$("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=$("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=$("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aa=$("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=$("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=$("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=$("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=$("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=$("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=$("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=$("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=$("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=$("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),ir=c.createContext(void 0);function qr({children:t}){const[r,a]=c.useState(()=>localStorage.getItem("eedc-theme")||"system"),[n,s]=c.useState(!1);return c.useEffect(()=>{localStorage.setItem("eedc-theme",r);const l=window.document.documentElement;if(r==="system"){const g=window.matchMedia("(prefers-color-scheme: dark)").matches;s(g),l.classList.toggle("dark",g)}else s(r==="dark"),l.classList.toggle("dark",r==="dark")},[r]),c.useEffect(()=>{if(r!=="system")return;const l=window.matchMedia("(prefers-color-scheme: dark)"),g=d=>{s(d.matches),document.documentElement.classList.toggle("dark",d.matches)};return l.addEventListener("change",g),()=>l.removeEventListener("change",g)},[r]),e.jsx(ir.Provider,{value:{theme:r,setTheme:a,isDark:n},children:t})}function lr(){const t=c.useContext(ir);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const Jr=[{name:"Cockpit",basePath:"/cockpit"},{name:"Auswertungen",basePath:"/auswertungen"}],Ur=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Import",href:"/einstellungen/import"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"PVGIS",href:"/einstellungen/pvgis"},{name:"HA Integration",href:"/einstellungen/ha-integration"},{name:"HA Export",href:"/einstellungen/ha-export"},{name:"Allgemein",href:"/einstellungen/allgemein"}]}];function Zr(){const{theme:t,setTheme:r}=lr(),a=qa(),[n,s]=c.useState(!1),l=c.useRef(null),d=a.pathname.startsWith("/cockpit")?"Cockpit":a.pathname.startsWith("/auswertungen")?"Auswertungen":a.pathname.startsWith("/einstellungen")?null:"Cockpit";c.useEffect(()=>{const x=u=>{l.current&&!l.current.contains(u.target)&&s(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const i=()=>{r(t==="light"?"dark":t==="dark"?"system":"light")},o=x=>a.pathname===x;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"h-8 w-8 text-yellow-500",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"})]}),e.jsx("nav",{className:"ml-10 flex space-x-1",children:Jr.map(x=>e.jsx(ra,{to:x.basePath,className:()=>`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${d===x.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:x.name},x.name))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:i,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(se,{className:"h-5 w-5"}),t==="dark"&&e.jsx(er,{className:"h-5 w-5"}),t==="system"&&e.jsx(Xa,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:l,children:[e.jsxs("button",{onClick:()=>s(!n),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${a.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(rr,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(Ot,{className:`h-4 w-4 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:Ur.map((x,u)=>e.jsxs("div",{children:[u>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:x.category})}),x.items.map(p=>e.jsx(ra,{to:p.href,onClick:()=>s(!1),className:`block px-4 py-2 text-sm transition-colors ${o(p.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:p.name},p.href))]},x.category))})]})]})]})})})}const Yr=[{name:"Übersicht",href:"/cockpit",icon:Pr,exact:!0},{name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:se},{name:"E-Auto",href:"/cockpit/e-auto",icon:Fe},{name:"Wärmepumpe",href:"/cockpit/waermepumpe",icon:De},{name:"Speicher",href:"/cockpit/speicher",icon:ye},{name:"Wallbox",href:"/cockpit/wallbox",icon:Re},{name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:se},{name:"Sonstiges",href:"/cockpit/sonstiges",icon:na}],Qr=[{name:"Jahresvergleich",href:"/auswertungen",icon:ia,exact:!0},{name:"ROI-Analyse",href:"/auswertungen/roi",icon:ke},{name:"Prognose vs. IST",href:"/auswertungen/prognose",icon:ke},{name:"PDF-Export",href:"/auswertungen/export",icon:Lr}],Xr=[{name:"Anlage",href:"/einstellungen/anlage",icon:Oe},{name:"Strompreise",href:"/einstellungen/strompreise",icon:ue},{name:"Investitionen",href:"/einstellungen/investitionen",icon:xt},{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:Ya},{name:"Import/Export",href:"/einstellungen/import",icon:nr},{name:"PVGIS",href:"/einstellungen/pvgis",icon:se},{name:"HA-Export",href:"/einstellungen/ha-export",icon:tr},{name:"Allgemein",href:"/einstellungen/allgemein",icon:rr}];function es(){const t=qa(),a=t.pathname.startsWith("/cockpit")?Yr:t.pathname.startsWith("/auswertungen")?Qr:t.pathname.startsWith("/einstellungen")?Xr:null;return a?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:a.map(n=>e.jsxs(ra,{to:n.href,end:n.exact,className:({isActive:s})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${s?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(n.icon,{className:"h-4 w-4"}),n.name]},n.href))})})}):null}const ts="0.9.6",as="eedc",rs="Energie Effizienz Data Center",ss=`${as} v${ts} – ${rs}`;function ns(){return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col",children:[e.jsx(Zr,{}),e.jsx(es,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(ur,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:ss})})]})}const J=c.forwardRef(({className:t="",variant:r="primary",size:a="md",loading:n,disabled:s,children:l,...g},d)=>{const i="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",o={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},x={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:d,className:`${i} ${o[r]} ${x[a]} ${t}`,disabled:s||n,...g,children:[n&&e.jsx(Ze,{className:"w-4 h-4 mr-2 animate-spin"}),l]})});J.displayName="Button";const R=c.forwardRef(({className:t="",label:r,error:a,hint:n,id:s,...l},g)=>{const d=s||l.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,l.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:g,id:d,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${a?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...l}),n&&!a&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n}),a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a})]})});R.displayName="Input";const Ce=c.forwardRef(({className:t="",label:r,error:a,options:n,placeholder:s,id:l,...g},d)=>{const i=l||g.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:i,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,g.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:d,id:i,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${a?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...g,children:[s&&e.jsx("option",{value:"",children:s}),n.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]}),a&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:a})]})});Ce.displayName="Select";function $e({isOpen:t,onClose:r,title:a,children:n,size:s="md"}){if(c.useEffect(()=>{const g=d=>{d.key==="Escape"&&r()};return t&&(document.addEventListener("keydown",g),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",g),document.body.style.overflow=""}},[t,r]),!t)return null;const l={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:r}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${l[s]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),e.jsx("button",{onClick:r,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(xa,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:n})]})})]})}function W({children:t,className:r="",padding:a="md"}){const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${n[a]}
        ${r}
      `,children:t})}function ee({type:t,title:r,children:a,onClose:n,className:s=""}){const l={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:Ie},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:Je},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:ze},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:Rt}},{bg:g,border:d,text:i,icon:o}=l[t];return e.jsx("div",{className:`${g} ${d} border rounded-lg p-4 relative ${s}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{className:`w-5 h-5 ${i} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[r&&e.jsx("h4",{className:`text-sm font-medium ${i}`,children:r}),e.jsx("div",{className:`text-sm ${i} ${r?"mt-1":""}`,children:a})]}),n&&e.jsx("button",{onClick:n,className:`ml-3 ${i} hover:opacity-70 transition-opacity`,children:e.jsx(xa,{className:"w-4 h-4"})})]})})}function ha({children:t,className:r=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${r}`,children:t})})}function ma({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function ua({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function mt({children:t,onClick:r,className:a=""}){return e.jsx("tr",{className:`${r?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${a}`,onClick:r,children:t})}function Ne({children:t,className:r=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${r}`,children:t})}function _e({children:t,className:r=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${r}`,children:t})}function ut({icon:t,title:r,description:a,action:n}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:a}),n&&e.jsx("div",{children:n})]})}function he({size:t="md",text:r}){const a={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Ze,{className:`${a[t]} text-primary-600 animate-spin`}),r&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:r})]})}function Qe({children:t,formel:r,berechnung:a,ergebnis:n,className:s="",showIcon:l=!0}){const[g,d]=c.useState(!1),[i,o]=c.useState("top"),x=c.useRef(null);return c.useEffect(()=>{if(g&&x.current){const u=x.current.getBoundingClientRect();o(u.top<120?"bottom":"top")}},[g]),e.jsxs("span",{ref:x,className:`relative inline-block cursor-help ${s}`,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[t,l&&e.jsx(Ie,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),g&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${i==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${i==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:r}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:a})]}),n&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:n})]})]})]})}function V(t,r=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r})}const is={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function ie({title:t,value:r,unit:a,subtitle:n,icon:s,color:l="blue",trend:g,formel:d,berechnung:i,ergebnis:o}){const x=is[l],u=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof r=="number"?r.toLocaleString("de-DE"):r,a&&e.jsx("span",{className:"text-sm font-normal ml-1",children:a}),g==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"↑"}),g==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"↓"})]});return e.jsx(W,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:d?e.jsx(Qe,{formel:d,berechnung:i,ergebnis:o,children:u}):u}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${x.bg} ml-3 flex-shrink-0`,children:e.jsx(s,{className:`h-6 w-6 ${x.icon}`})})]})})}const ls="./api";class ds{constructor(r=ls){Ea(this,"baseUrl");this.baseUrl=r}async request(r,a={}){const n=`${this.baseUrl}${r}`,s={headers:{"Content-Type":"application/json",...a.headers},...a},l=await fetch(n,s);if(!l.ok){const g={detail:"Ein Fehler ist aufgetreten",status:l.status};try{const d=await l.json();g.detail=d.detail||g.detail}catch{}throw g}if(l.status!==204)return l.json()}async get(r){return this.request(r,{method:"GET"})}async post(r,a){return this.request(r,{method:"POST",body:a?JSON.stringify(a):void 0})}async put(r,a){return this.request(r,{method:"PUT",body:JSON.stringify(a)})}async delete(r){return this.request(r,{method:"DELETE"})}async patch(r,a){return this.request(r,{method:"PATCH",body:JSON.stringify(a)})}async upload(r,a,n="file"){const s=new FormData;return s.append(n,a),this.request(r,{method:"POST",headers:{},body:s})}}const B=new ds,Be={async list(){return B.get("/anlagen/")},async get(t){return B.get(`/anlagen/${t}`)},async create(t){return B.post("/anlagen/",t)},async update(t,r){return B.put(`/anlagen/${t}`,r)},async delete(t){return B.delete(`/anlagen/${t}`)},async getSensorConfig(t){return B.get(`/anlagen/${t}/sensors`)},async updateSensorConfig(t,r){return B.patch(`/anlagen/${t}/sensors`,r)},async geocode(t,r){const a=new URLSearchParams({plz:t});return r&&a.append("ort",r),B.get(`/anlagen/geocode/lookup?${a}`)}},vt={async list(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("jahr",r.toString());const n=a.toString();return B.get(`/monatsdaten/${n?"?"+n:""}`)},async get(t){return B.get(`/monatsdaten/${t}`)},async create(t){return B.post("/monatsdaten/",t)},async update(t,r){return B.put(`/monatsdaten/${t}`,r)},async delete(t){return B.delete(`/monatsdaten/${t}`)}},me={async getTypen(){return B.get("/investitionen/typen")},async list(t,r,a){const n=new URLSearchParams;t&&n.append("anlage_id",t.toString()),r&&n.append("typ",r),a!==void 0&&n.append("aktiv",a.toString());const s=n.toString();return B.get(`/investitionen/${s?"?"+s:""}`)},async get(t){return B.get(`/investitionen/${t}`)},async create(t){return B.post("/investitionen/",t)},async update(t,r){return B.put(`/investitionen/${t}`,r)},async delete(t){return B.delete(`/investitionen/${t}`)},async getROIDashboard(t,r,a,n,s){const l=new URLSearchParams;r&&l.append("strompreis_cent",r.toString()),a&&l.append("einspeiseverguetung_cent",a.toString()),n&&l.append("benzinpreis_euro",n.toString()),s&&s!=="all"&&l.append("jahr",s.toString());const g=l.toString();return B.get(`/investitionen/roi/${t}${g?"?"+g:""}`)},async getEAutoDashboard(t,r,a){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),a&&n.append("benzinpreis_euro",a.toString());const s=n.toString();return B.get(`/investitionen/dashboard/e-auto/${t}${s?"?"+s:""}`)},async getWaermepumpeDashboard(t,r){const a=new URLSearchParams;r&&a.append("strompreis_cent",r.toString());const n=a.toString();return B.get(`/investitionen/dashboard/waermepumpe/${t}${n?"?"+n:""}`)},async getSpeicherDashboard(t,r,a){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),a&&n.append("einspeiseverguetung_cent",a.toString());const s=n.toString();return B.get(`/investitionen/dashboard/speicher/${t}${s?"?"+s:""}`)},async getWallboxDashboard(t){return B.get(`/investitionen/dashboard/wallbox/${t}`)},async getBalkonkraftwerkDashboard(t,r,a){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),a&&n.append("einspeiseverguetung_cent",a.toString());const s=n.toString();return B.get(`/investitionen/dashboard/balkonkraftwerk/${t}${s?"?"+s:""}`)},async getSonstigesDashboard(t,r,a){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),a&&n.append("einspeiseverguetung_cent",a.toString());const s=n.toString();return B.get(`/investitionen/dashboard/sonstiges/${t}${s?"?"+s:""}`)},async getMonatsdatenByMonth(t,r,a){return B.get(`/investitionen/monatsdaten/${t}/${r}/${a}`)}},ot={async list(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("aktuell","true");const n=a.toString();return B.get(`/strompreise/${n?"?"+n:""}`)},async getAktuell(t){return B.get(`/strompreise/aktuell/${t}`)},async get(t){return B.get(`/strompreise/${t}`)},async create(t){return B.post("/strompreise/",t)},async update(t,r){return B.put(`/strompreise/${t}`,r)},async delete(t){return B.delete(`/strompreise/${t}`)}},lt="./api",ct={async getTemplateInfo(t){const r=await fetch(`${lt}/import/template/${t}`);if(!r.ok)throw new Error("Fehler beim Laden des Templates");return r.json()},getTemplateDownloadUrl(t){return`${lt}/import/template/${t}/download`},async importCSV(t,r,a=!1){const n=new FormData;n.append("file",r);const s=new URLSearchParams;a&&s.append("ueberschreiben","true");const l=await fetch(`${lt}/import/csv/${t}?${s.toString()}`,{method:"POST",body:n});if(!l.ok){const g=await l.json();throw new Error(g.detail||"Import fehlgeschlagen")}return l.json()},getExportUrl(t,r){const a=new URLSearchParams;r&&a.append("jahr",r.toString());const n=a.toString();return`${lt}/import/export/${t}${n?"?"+n:""}`},async createDemoData(){const t=await fetch(`${lt}/import/demo`,{method:"POST"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${lt}/import/demo`,{method:"DELETE"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht gelöscht werden")}return t.json()}},Ca={async health(){return B.get("/health")},async getSettings(){return B.get("/settings")},async getStats(){return B.get("/stats")}},Ve={async getPrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const n=a.toString();return B.get(`/pvgis/prognose/${t}${n?`?${n}`:""}`)},async getModulPrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const n=a.toString();return B.get(`/pvgis/modul/${t}${n?`?${n}`:""}`)},async speicherePrognose(t,r={}){const a=new URLSearchParams;r.system_losses!==void 0&&a.set("system_losses",r.system_losses.toString());const n=a.toString();return B.post(`/pvgis/prognose/${t}/speichern${n?`?${n}`:""}`)},async listeGespeichertePrognosen(t){return B.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return B.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return B.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return B.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return B.get(`/pvgis/optimum/${t}`)}},Ae={async getStatus(){return B.get("/ha/status")},async getSensors(){return B.get("/ha/sensors")},async getStringSensors(){return B.get("/ha/string-sensors")},async getStringMonatsdaten(t,r){const a=r?`?jahr=${r}`:"";return B.get(`/ha/string-monatsdaten/${t}${a}`)},async createStringMonatsdaten(t){return B.post("/ha/string-monatsdaten",t)},async deleteStringMonatsdaten(t){return B.delete(`/ha/string-monatsdaten/${t}`)},async getImportPreview(t,r){return B.get(`/ha/import/preview/${t}?jahr=${r}`)},async importMonatsdaten(t,r,a,n=!1){return B.post("/ha/import/monatsdaten",{anlage_id:t,jahr:r,monat:a||null,ueberschreiben:n})},async getMonthlyStatistics(t,r,a=1,n,s){return B.post("/ha/statistics/monthly",{statistic_id:t,start_jahr:r,start_monat:a,end_jahr:n,end_monat:s})},async discover(t,r){const a=new URLSearchParams;t&&a.append("anlage_id",t.toString()),r&&a.append("manufacturer",r);const n=a.toString();return B.get(`/ha/discover${n?"?"+n:""}`)},async getMqttConfig(){return B.get("/ha/export/mqtt/config")},async getExportSensors(){return B.get("/ha/export/sensors")},async getAnlageSensors(t){return B.get(`/ha/export/sensors/${t}`)},async getYamlSnippet(t){return B.get(`/ha/export/yaml/${t}`)},async getSensorDefinitions(){return B.get("/ha/export/definitions")},async testMqtt(t){return B.post("/ha/export/mqtt/test",t||{})},async publishMqtt(t,r){return B.post(`/ha/export/mqtt/publish/${t}`,r||{})},async removeMqtt(t,r){return B.delete(`/ha/export/mqtt/remove/${t}`)}};function ve(){const[t,r]=c.useState([]),[a,n]=c.useState(!0),[s,l]=c.useState(null),g=c.useCallback(async()=>{try{n(!0),l(null);const x=await Be.list();r(x)}catch(x){l(x instanceof Error?x.message:"Fehler beim Laden der Anlagen")}finally{n(!1)}},[]);c.useEffect(()=>{g()},[g]);const d=c.useCallback(async x=>{const u=await Be.create(x);return r(p=>[...p,u]),u},[]),i=c.useCallback(async(x,u)=>{const p=await Be.update(x,u);return r(f=>f.map(k=>k.id===x?p:k)),p},[]),o=c.useCallback(async x=>{await Be.delete(x),r(u=>u.filter(p=>p.id!==x))},[]);return{anlagen:t,loading:a,error:s,refresh:g,createAnlage:d,updateAnlage:i,deleteAnlage:o}}function Ht(t,r){const[a,n]=c.useState([]),[s,l]=c.useState(!0),[g,d]=c.useState(null),i=c.useCallback(async()=>{try{l(!0),d(null);const p=await vt.list(t,r);n(p)}catch(p){d(p instanceof Error?p.message:"Fehler beim Laden der Monatsdaten")}finally{l(!1)}},[t,r]);c.useEffect(()=>{i()},[i]);const o=c.useCallback(async p=>{const f=await vt.create(p);return n(k=>[f,...k]),f},[]),x=c.useCallback(async(p,f)=>{const k=await vt.update(p,f);return n(S=>S.map(_=>_.id===p?k:_)),k},[]),u=c.useCallback(async p=>{await vt.delete(p),n(f=>f.filter(k=>k.id!==p))},[]);return{monatsdaten:a,loading:s,error:g,refresh:i,createMonatsdaten:o,updateMonatsdaten:x,deleteMonatsdaten:u}}function pa(t){return{gesamtErzeugung:t.reduce((r,a)=>r+(a.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((r,a)=>r+a.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((r,a)=>r+a.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((r,a)=>r+(a.eigenverbrauch_kwh||0),0),durchschnittAutarkie:t.length>0?t.reduce((r,a)=>{const n=a.eigenverbrauch_kwh||0,s=(a.eigenverbrauch_kwh||0)+a.netzbezug_kwh;return r+(s>0?n/s*100:0)},0)/t.length:0,anzahlMonate:t.length}}function zt(t,r){const[a,n]=c.useState([]),[s,l]=c.useState(!0),[g,d]=c.useState(null),i=c.useCallback(async()=>{try{l(!0),d(null);const p=await me.list(t,r);n(p)}catch(p){d(p instanceof Error?p.message:"Fehler beim Laden der Investitionen")}finally{l(!1)}},[t,r]);c.useEffect(()=>{i()},[i]);const o=c.useCallback(async p=>{const f=await me.create(p);return n(k=>[...k,f]),f},[]),x=c.useCallback(async(p,f)=>{const k=await me.update(p,f);return n(S=>S.map(_=>_.id===p?k:_)),k},[]),u=c.useCallback(async p=>{await me.delete(p),n(f=>f.filter(k=>k.id!==p))},[]);return{investitionen:a,loading:s,error:g,refresh:i,createInvestition:o,updateInvestition:x,deleteInvestition:u}}function cs(t){return t.reduce((a,n)=>(a[n.typ]||(a[n.typ]=[]),a[n.typ].push(n),a),{})}function os(t){const[r,a]=c.useState([]),[n,s]=c.useState(!0),[l,g]=c.useState(null),d=c.useCallback(async()=>{try{s(!0),g(null);const u=await ot.list(t);a(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden der Strompreise")}finally{s(!1)}},[t]);c.useEffect(()=>{d()},[d]);const i=c.useCallback(async u=>{const p=await ot.create(u);return a(f=>[p,...f]),p},[]),o=c.useCallback(async(u,p)=>{const f=await ot.update(u,p);return a(k=>k.map(S=>S.id===u?f:S)),f},[]),x=c.useCallback(async u=>{await ot.delete(u),a(p=>p.filter(f=>f.id!==u))},[]);return{strompreise:r,loading:n,error:l,refresh:d,createStrompreis:i,updateStrompreis:o,deleteStrompreis:x}}function dr(t){const[r,a]=c.useState(null),[n,s]=c.useState(!1),[l,g]=c.useState(null);return c.useEffect(()=>{if(t===null){a(null);return}(async()=>{try{s(!0),g(null);const i=await ot.getAktuell(t);a(i)}catch{a(null)}finally{s(!1)}})()},[t]),{strompreis:r,loading:n,error:l}}const qt={pv_erzeugung:null,einspeisung:null,netzbezug:null,batterie_ladung:null,batterie_entladung:null};function gs(){const[t,r]=c.useState("idle"),[a,n]=c.useState(null),[s,l]=c.useState(new Set),[g,d]=c.useState(qt),[i,o]=c.useState(null),x=c.useCallback(async b=>{r("scanning"),o(null);try{const m=await Ae.discover(b);if(n(m),!m.ha_connected){o("Keine Verbindung zu Home Assistant"),r("error");return}const h=new Set;for(const N of m.devices)!N.already_configured&&N.suggested_investition_typ&&h.add(N.id);l(h),d({pv_erzeugung:m.current_mappings.pv_erzeugung,einspeisung:m.current_mappings.einspeisung,netzbezug:m.current_mappings.netzbezug,batterie_ladung:m.current_mappings.batterie_ladung,batterie_entladung:m.current_mappings.batterie_entladung}),r("results")}catch(m){o(m instanceof Error?m.message:"Discovery fehlgeschlagen"),r("error")}},[]),u=c.useCallback(b=>{l(m=>{const h=new Set(m);return h.has(b)?h.delete(b):h.add(b),h})},[]),p=c.useCallback(()=>{if(!a)return;const b=new Set(a.devices.filter(m=>!m.already_configured&&m.suggested_investition_typ).map(m=>m.id));l(b)},[a]),f=c.useCallback(()=>{l(new Set)},[]),k=c.useCallback((b,m)=>{d(h=>({...h,[b]:m}))},[]),S=c.useCallback(()=>{if(!a)return;const b={...qt},{sensor_mappings:m}=a;m.pv_erzeugung.length>0&&(b.pv_erzeugung=m.pv_erzeugung[0].entity_id),m.einspeisung.length>0&&(b.einspeisung=m.einspeisung[0].entity_id),m.netzbezug.length>0&&(b.netzbezug=m.netzbezug[0].entity_id),m.batterie_ladung.length>0&&(b.batterie_ladung=m.batterie_ladung[0].entity_id),m.batterie_entladung.length>0&&(b.batterie_entladung=m.batterie_entladung[0].entity_id),d(b)},[a]),_=c.useCallback(b=>{r(b)},[]),j=c.useCallback(()=>{r("idle"),n(null),l(new Set),d(qt),o(null)},[]),C=(a==null?void 0:a.devices.filter(b=>s.has(b.id)&&!b.already_configured&&b.suggested_investition_typ))??[],y=s.size>0||Object.values(g).some((b,m)=>{const h=a!=null&&a.current_mappings?[a.current_mappings.pv_erzeugung,a.current_mappings.einspeisung,a.current_mappings.netzbezug,a.current_mappings.batterie_ladung,a.current_mappings.batterie_entladung]:[null,null,null,null,null];return b!==h[m]});return{step:t,discoveryResult:a,selectedDevices:s,selectedMappings:g,error:i,startDiscovery:x,toggleDevice:u,selectAllDevices:p,deselectAllDevices:f,setMapping:k,applyBestMappings:S,goToStep:_,reset:j,devicesToCreate:C,hasChanges:y}}const at={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function cr(t){return t<=10?8.2:t<=40?7.1:5.8}const Jt="eedc_setup_wizard_state",Ma={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},et=["welcome","anlage","ha-connection","strompreise","discovery","investitionen","summary","complete"],or=["wechselrichter","pv-module","speicher","wallbox","e-auto","waermepumpe","balkonkraftwerk","sonstiges"],Ue={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},xs={"pv-module":"wechselrichter",speicher:"wechselrichter"},hs=["pv-module"];function ms(){const[t,r]=c.useState(()=>{try{const z=localStorage.getItem(Jt);if(z)return JSON.parse(z)}catch{}return Ma}),[a,n]=c.useState(t.currentStep),[s,l]=c.useState(!1),[g,d]=c.useState(null),[i,o]=c.useState(null),[x,u]=c.useState(null),[p,f]=c.useState(!1),[k,S]=c.useState(null),[_,j]=c.useState(null),[C,y]=c.useState([]),b=c.useRef(new Map);c.useEffect(()=>{localStorage.setItem(Jt,JSON.stringify({...t,currentStep:a}))},[t,a]),c.useEffect(()=>{t.anlageId&&!i&&Be.get(t.anlageId).then(o).catch(()=>{})},[t.anlageId,i]);const m=c.useCallback(async()=>{if(t.anlageId)try{const z=await me.list(t.anlageId);y(z)}catch{}},[t.anlageId]);c.useEffect(()=>{m()},[m]);const h=c.useCallback(z=>{n(z),d(null)},[]),N=c.useCallback(async()=>{const z=b.current;if(z.size===0)return;const D=[];z.forEach(({data:G,timer:Z},F)=>{clearTimeout(Z),D.push(me.update(F,G).catch(q=>{console.error(`Fehler beim Update von Investition ${F}:`,q)}))}),z.clear(),await Promise.all(D),await m()},[m]),M=c.useCallback(async()=>{await N();const z=et.indexOf(a);z<et.length-1&&h(et[z+1])},[a,h,N]),A=c.useCallback(()=>{const z=et.indexOf(a);z>0&&h(et[z-1])},[a,h]),K=c.useCallback(()=>{r(z=>({...z,skippedSteps:[...z.skippedSteps,a]})),M()},[a,M]),w=c.useCallback(async(z,D)=>{try{const G=await Be.geocode(z,D);return{latitude:G.latitude,longitude:G.longitude}}catch{return null}},[]),O=c.useCallback(async z=>{l(!0),d(null);try{const D=await Be.create(z);o(D),r(G=>({...G,anlageId:D.id})),M()}catch(D){d(D instanceof Error?D.message:"Fehler beim Erstellen der Anlage")}finally{l(!1)}},[M]),H=c.useCallback(async()=>{l(!0),d(null);try{const z=await Ae.getStatus();f(z.connected),S(z.ha_version||null),z.connected||d("Keine Verbindung zu Home Assistant. Sie können diesen Schritt überspringen und später konfigurieren.")}catch{f(!1),d("Home Assistant nicht erreichbar. Läuft EEDC als Add-on?")}finally{l(!1)}},[]),E=c.useCallback(async z=>{if(!t.anlageId){d("Keine Anlage vorhanden");return}l(!0),d(null);try{const D=await ot.create({anlage_id:t.anlageId,...z});u(D),r(G=>({...G,strompreisId:D.id})),M()}catch(D){d(D instanceof Error?D.message:"Fehler beim Erstellen des Stromtarifs")}finally{l(!1)}},[t.anlageId,M]),U=c.useCallback(async()=>{if(!t.anlageId||!i){d("Keine Anlage vorhanden");return}const z=cr(i.leistung_kwp);await E({netzbezug_arbeitspreis_cent_kwh:at.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:z,grundpreis_euro_monat:at.grundpreis_euro_monat,gueltig_ab:i.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,i,E]),v=c.useCallback(async()=>{if(!t.anlageId){d("Keine Anlage vorhanden");return}l(!0),d(null);try{const z=(i==null?void 0:i.wechselrichter_hersteller)||void 0,D=await Ae.discover(t.anlageId,z);if(j(D),!D.ha_connected){M();return}const G=[];for(const Z of D.devices)if(!(Z.already_configured||!Z.suggested_investition_typ))try{const F={anlage_id:t.anlageId,typ:Z.suggested_investition_typ,bezeichnung:Z.name,parameter:Z.suggested_parameters||{},aktiv:!0},q=await me.create(F);G.push(q.id)}catch{}r(Z=>({...Z,createdInvestitionen:[...Z.createdInvestitionen,...G]})),await m(),M()}catch(z){d(z instanceof Error?z.message:"Discovery fehlgeschlagen")}finally{l(!1)}},[t.anlageId,i,M,m]),L=c.useCallback(async(z,D)=>{y(q=>q.map(Pe=>Pe.id!==z?Pe:{...Pe,...D,parameter:D.parameter?{...Pe.parameter||{},...D.parameter}:Pe.parameter}));const G=b.current.get(z);G!=null&&G.timer&&clearTimeout(G.timer);const Z=G!=null&&G.data?{...G.data,...D,parameter:D.parameter?{...G.data.parameter||{},...D.parameter}:G.data.parameter}:D,F=setTimeout(async()=>{b.current.delete(z);try{await me.update(z,Z)}catch(q){d(q instanceof Error?q.message:"Fehler beim Aktualisieren"),await m()}},500);b.current.set(z,{data:Z,timer:F})},[m]),X=c.useCallback(async z=>{try{await me.delete(z),await m()}catch(D){d(D instanceof Error?D.message:"Fehler beim Löschen")}},[m]),oe=c.useCallback(async z=>{if(!t.anlageId)throw new Error("Keine Anlage vorhanden");d(null);try{const D=await me.create({anlage_id:t.anlageId,typ:z,bezeichnung:`Neue ${Ue[z]}`,aktiv:!0});return await m(),D}catch(D){const G=D instanceof Error?D.message:"Fehler beim Hinzufügen";throw d(G),D}},[t.anlageId,m]),te=c.useCallback(()=>{r(z=>({...z,completed:!0,currentStep:"complete"})),n("complete")},[]),xe=c.useCallback(()=>{localStorage.removeItem(Jt),r(Ma),n("welcome"),o(null),u(null),j(null),y([]),d(null)},[]),P=(()=>{switch(a){case"welcome":return!0;case"anlage":return!!t.anlageId;case"ha-connection":return!0;case"strompreise":return!!t.strompreisId;case"discovery":return!0;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),T=Math.round(et.indexOf(a)/(et.length-1)*100);return{step:a,wizardState:t,isLoading:s,error:g,anlage:i,strompreis:x,haConnected:p,haVersion:k,discoveryResult:_,investitionen:C,refreshInvestitionen:m,goToStep:h,nextStep:M,prevStep:A,skipStep:K,createAnlage:O,geocodeAddress:w,checkHAConnection:H,createStrompreis:E,useDefaultStrompreise:U,runDiscoveryAndCreateInvestitionen:v,updateInvestition:L,deleteInvestition:X,addInvestition:oe,completeWizard:te,resetWizard:xe,canProceed:P,progress:T}}const us=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function ps(){var m;const t=Vt(),{anlagen:r,loading:a}=ve(),n=(m=r[0])==null?void 0:m.id,{monatsdaten:s,loading:l}=Ht(n),{loading:g}=zt(n),d=pa(s),[i,o]=c.useState([]),[x,u]=c.useState([]),[p,f]=c.useState([]),[k,S]=c.useState([]),[,_]=c.useState(!1);c.useEffect(()=>{if(!n)return;(async()=>{_(!0);try{const[N,M,A,K]=await Promise.all([me.getWaermepumpeDashboard(n).catch(()=>[]),me.getSpeicherDashboard(n).catch(()=>[]),me.getEAutoDashboard(n).catch(()=>[]),me.getBalkonkraftwerkDashboard(n).catch(()=>[])]);o(N),u(M),f(A),S(K)}finally{_(!1)}})()},[n]);const j=c.useMemo(()=>[...s].sort((N,M)=>N.jahr!==M.jahr?N.jahr-M.jahr:N.monat-M.monat).slice(-12).map(N=>({name:`${us[N.monat]} ${N.jahr.toString().slice(-2)}`,Einspeisung:N.einspeisung_kwh,Eigenverbrauch:N.eigenverbrauch_kwh||0,Netzbezug:N.netzbezug_kwh})),[s]),C=c.useMemo(()=>{const h=[];if(i.length>0){const N=i.reduce((A,K)=>A+K.zusammenfassung.gesamt_stromverbrauch_kwh,0),M=i.reduce((A,K)=>A+(K.zusammenfassung.durchschnitt_cop||0),0)/i.length;h.push({name:"Wärmepumpe",icon:De,color:"text-red-500",value:(N/1e3).toFixed(1),unit:"MWh",subtitle:M>0?`COP Ø ${M.toFixed(1)}`:"Stromverbrauch",href:"/cockpit/waermepumpe"})}if(x.length>0){const N=x.reduce((A,K)=>A+K.zusammenfassung.vollzyklen,0),M=x.reduce((A,K)=>A+K.zusammenfassung.gesamt_ladung_kwh,0);h.push({name:"Speicher",icon:ye,color:"text-green-500",value:(M/1e3).toFixed(1),unit:"MWh",subtitle:`${N.toFixed(0)} Zyklen`,href:"/cockpit/speicher"})}if(p.length>0){const N=p.reduce((A,K)=>A+K.zusammenfassung.gesamt_km,0),M=p.reduce((A,K)=>A+K.zusammenfassung.pv_anteil_gesamt_prozent,0)/p.length;h.push({name:"E-Auto",icon:Fe,color:"text-purple-500",value:(N/1e3).toFixed(1),unit:"Tkm",subtitle:`${M.toFixed(0)}% PV-Anteil`,href:"/cockpit/e-auto"})}if(k.length>0){const N=k.reduce((M,A)=>M+A.zusammenfassung.gesamt_erzeugung_kwh,0);h.push({name:"Balkonkraftwerk",icon:se,color:"text-orange-500",value:N.toFixed(0),unit:"kWh",subtitle:"Erzeugung",href:"/cockpit/balkonkraftwerk"})}return h},[i,x,p,k]);if(a||l||g)return e.jsx(he,{text:"Lade Dashboard..."});if(r.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsx(bs,{})]});const b=r[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"h-8 w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Anlage: ",e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:b.anlagenname})," (",b.leistung_kwp," kWp)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(Mt,{title:"PV-Erzeugung",value:d.gesamtErzeugung>0?(d.gesamtErzeugung/1e3).toFixed(1):"---",unit:"MWh",subtitle:d.anzahlMonate>0?`${d.anzahlMonate} Monate`:void 0,icon:se,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>t("/cockpit/pv-anlage"),formel:"Σ PV-Erzeugung aller Monate",berechnung:`${V(d.gesamtErzeugung,0)} kWh`,ergebnis:`= ${V(d.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(Mt,{title:"Eigenverbrauch",value:d.gesamtErzeugung>0?(d.gesamtEigenverbrauch/d.gesamtErzeugung*100).toFixed(1):"---",unit:"%",subtitle:`${(d.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:ue,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${V(d.gesamtEigenverbrauch,0)} kWh ÷ ${V(d.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${V(d.gesamtEigenverbrauch/d.gesamtErzeugung*100,1)} %`}),e.jsx(Mt,{title:"Autarkie",value:d.durchschnittAutarkie>0?d.durchschnittAutarkie.toFixed(1):"---",unit:"%",subtitle:"Durchschnitt",icon:ye,color:"text-energy-battery",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${V(d.durchschnittAutarkie,1)} %`}),e.jsx(Mt,{title:"Netzbezug",value:d.gesamtNetzbezug>0?(d.gesamtNetzbezug/1e3).toFixed(1):"---",unit:"MWh",subtitle:`${d.gesamtEinspeisung.toFixed(0)} kWh eingespeist`,icon:ke,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Netzbezug aller Monate",berechnung:`${V(d.gesamtNetzbezug,0)} kWh`,ergebnis:`= ${V(d.gesamtNetzbezug/1e3,1)} MWh`})]}),C.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:C.map(h=>e.jsx("button",{onClick:()=>t(h.href),className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800",children:e.jsx(h.icon,{className:`h-5 w-5 ${h.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.name}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[h.value," ",e.jsx("span",{className:"text-sm font-normal",children:h.unit})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:h.subtitle})]})]}),e.jsx(Ee,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})},h.name))}),j.length>0?e.jsxs(W,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:j,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",className:"text-xs"}),e.jsx(le,{unit:" kWh",className:"text-xs"}),e.jsx(Q,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:h=>[`${h.toFixed(0)} kWh`,""]}),e.jsx(be,{}),e.jsx(ne,{dataKey:"Eigenverbrauch",fill:"#8b5cf6",stackId:"a"}),e.jsx(ne,{dataKey:"Einspeisung",fill:"#10b981",stackId:"a"}),e.jsx(ne,{dataKey:"Netzbezug",fill:"#ef4444"})]})})})]}):e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Noch keine Monatsdaten vorhanden. Erfasse deine ersten Daten!"}),e.jsxs(J,{onClick:()=>t("/einstellungen/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(Ee,{className:"h-4 w-4 ml-2"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Ut,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/einstellungen/monatsdaten")}),e.jsx(Ut,{title:"Auswertungen",description:"Detaillierte Analysen und Kennzahlen",onClick:()=>t("/auswertungen")}),e.jsx(Ut,{title:"Investitionen",description:"E-Auto, Speicher, Wärmepumpe verwalten",onClick:()=>t("/einstellungen/investitionen")})]})]})}function Mt({title:t,value:r,unit:a,subtitle:n,icon:s,color:l,bgColor:g,onClick:d,formel:i,berechnung:o,ergebnis:x}){const u=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal",children:a})]}),p=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:i?e.jsx(Qe,{formel:i,berechnung:o,ergebnis:x,children:u}):u}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${g}`,children:e.jsx(s,{className:`h-6 w-6 ${l}`})})]});return d?e.jsx("button",{onClick:d,className:"card p-4 text-left hover:shadow-md transition-shadow",children:p}):e.jsx(W,{children:p})}function Ut({title:t,description:r,onClick:a}){return e.jsx("button",{onClick:a,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsx(Ee,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function bs(){const t=Vt();return e.jsxs(W,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(J,{onClick:()=>t("/einstellungen/anlage"),children:["Jetzt starten",e.jsx(Ee,{className:"h-4 w-4 ml-2"})]})]})}const ys=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],qe={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"},Wa=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function ks(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState();c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]);const{investitionen:s,loading:l}=zt(a),{monatsdaten:g,loading:d}=Ht(a),i=pa(g),{pvSysteme:o,orphanModule:x}=c.useMemo(()=>{const y=[],b=[],m=s.filter(M=>M.typ==="wechselrichter"),h=s.filter(M=>M.typ==="pv-module"),N=s.filter(M=>M.typ==="speicher");for(const M of m){const A=h.filter(O=>O.parent_investition_id===M.id),K=N.filter(O=>O.parent_investition_id===M.id),w=A.reduce((O,H)=>O+(H.leistung_kwp||0),0);y.push({wechselrichter:M,pvModule:A,speicher:K,gesamtKwp:w})}for(const M of h)(!M.parent_investition_id||!m.find(A=>A.id===M.parent_investition_id))&&b.push(M);return{pvSysteme:y,orphanModule:b}},[s]),u=c.useMemo(()=>o.reduce((y,b)=>y+b.gesamtKwp,0)+x.reduce((y,b)=>y+(b.leistung_kwp||0),0),[o,x]),p=u>0?i.gesamtErzeugung/u:0,f=c.useMemo(()=>[...g].sort((b,m)=>b.jahr!==m.jahr?b.jahr-m.jahr:b.monat-m.monat).slice(-12).map(b=>({name:`${ys[b.monat]} ${b.jahr.toString().slice(-2)}`,Erzeugung:b.pv_erzeugung_kwh,Eigenverbrauch:b.eigenverbrauch_kwh||0,Einspeisung:b.einspeisung_kwh})),[g]),k=c.useMemo(()=>i.gesamtErzeugung===0?[]:[{name:"Eigenverbrauch",value:i.gesamtEigenverbrauch,color:qe.consumption},{name:"Einspeisung",value:i.gesamtEinspeisung,color:qe.feedin}],[i]),S=c.useMemo(()=>{const y=o.flatMap(m=>m.pvModule).concat(x),b={};for(const m of y){const h=m.ausrichtung||"Unbekannt";b[h]||(b[h]={kwp:0,count:0}),b[h].kwp+=m.leistung_kwp||0,b[h].count+=1}return Object.entries(b).map(([m,h],N)=>({ausrichtung:m,kwp:h.kwp,count:h.count,color:Wa[N%Wa.length]}))},[o,x]);if(r||l||d)return e.jsx(he,{text:"Lade PV-Anlage..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]});const j=g.length>0,C=o.length>0||x.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:y=>n(parseInt(y.target.value)),options:t.map(y=>({value:y.id.toString(),label:y.anlagenname}))})]}),x.length>0&&e.jsx(ee,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsxs("span",{children:[x.length," PV-Modul(e) ohne Wechselrichter-Zuordnung. Bitte unter Einstellungen → Investitionen zuordnen."]})]})}),!C&&e.jsx(ee,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen → Investitionen Wechselrichter und PV-Module anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ie,{title:"Anlagenleistung",value:u>0?u.toFixed(1):"---",unit:"kWp",subtitle:`${o.length} Wechselrichter, ${o.reduce((y,b)=>y+b.pvModule.length,0)+x.length} Module`,icon:se,color:"yellow"}),e.jsx(ie,{title:"Gesamterzeugung",value:i.gesamtErzeugung>0?(i.gesamtErzeugung/1e3).toFixed(1):"---",unit:"MWh",subtitle:i.anzahlMonate>0?`${i.anzahlMonate} Monate`:void 0,icon:ue,color:"green"}),e.jsx(ie,{title:"Spez. Ertrag",value:p>0?p.toFixed(0):"---",unit:"kWh/kWp",subtitle:i.anzahlMonate>=12?"Jahreswert":`${i.anzahlMonate} Monate`,icon:ke,color:"blue",formel:"Spez. Ertrag = Erzeugung ÷ Leistung",berechnung:`${V(i.gesamtErzeugung,0)} kWh ÷ ${V(u,1)} kWp`,ergebnis:`= ${V(p,0)} kWh/kWp`}),e.jsx(ie,{title:"Eigenverbrauch",value:i.gesamtErzeugung>0?(i.gesamtEigenverbrauch/i.gesamtErzeugung*100).toFixed(1):"---",unit:"%",subtitle:`${(i.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:Za,color:"purple",formel:"Eigenverbrauchsquote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${V(i.gesamtEigenverbrauch,0)} kWh ÷ ${V(i.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${V(i.gesamtErzeugung>0?i.gesamtEigenverbrauch/i.gesamtErzeugung*100:0,1)} %`})]}),C&&e.jsxs(W,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsxs("div",{className:"space-y-4",children:[o.map(y=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:y.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[y.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[y.pvModule.map(b=>{var m;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(se,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:b.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(m=b.leistung_kwp)==null?void 0:m.toFixed(1)," kWp",b.ausrichtung&&` • ${b.ausrichtung}`,b.neigung_grad&&` • ${b.neigung_grad}°`]})]},b.id)}),y.speicher.map(b=>{var m,h;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(ue,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:b.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(h=(m=b.parameter)==null?void 0:m.kapazitaet_kwh)==null?void 0:h.toFixed(1)," kWh"]})]},b.id)}),y.pvModule.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PV-Module zugeordnet"})]})]})]},y.wechselrichter.id)),x.length>0&&e.jsxs("div",{className:"border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-amber-800 dark:text-amber-200 mb-2 flex items-center gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),"Nicht zugeordnete PV-Module"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:x.map(y=>{var b;return e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-300",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:y.bezeichnung}),e.jsxs("span",{className:"text-amber-500",children:[(b=y.leistung_kwp)==null?void 0:b.toFixed(1)," kWp",y.ausrichtung&&` • ${y.ausrichtung}`]})]},y.id)})})]})]})]}),S.length>1&&e.jsxs(W,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Leistung nach Ausrichtung"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:S,layout:"vertical",children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{type:"number",unit:" kWp"}),e.jsx(le,{type:"category",dataKey:"ausrichtung",width:100}),e.jsx(Q,{formatter:y=>[`${y.toFixed(1)} kWp`,"Leistung"]}),e.jsx(ne,{dataKey:"kwp",fill:qe.solar,radius:[0,4,4,0],children:S.map((y,b)=>e.jsx(fe,{fill:y.color},`cell-${b}`))})]})})})]}),j&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pt,{data:f,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",className:"text-xs"}),e.jsx(le,{unit:" kWh",className:"text-xs"}),e.jsx(Q,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:y=>[`${y.toFixed(0)} kWh`,""]}),e.jsx(be,{}),e.jsx(Me,{type:"monotone",dataKey:"Erzeugung",stroke:qe.solar,fill:qe.solar,fillOpacity:.3}),e.jsx(Me,{type:"monotone",dataKey:"Eigenverbrauch",stroke:qe.consumption,fill:qe.consumption,fillOpacity:.3}),e.jsx(Me,{type:"monotone",dataKey:"Einspeisung",stroke:qe.feedin,fill:qe.feedin,fillOpacity:.3})]})})})]}),e.jsxs(W,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsx(Ge,{data:k,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:y,percent:b})=>`${y}: ${(b*100).toFixed(0)}%`,labelLine:!1,children:k.map((y,b)=>e.jsx(fe,{fill:y.color},`cell-${b}`))}),e.jsx(Q,{formatter:y=>[`${y.toFixed(0)} kWh`,""]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(i.gesamtEigenverbrauch/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(i.gesamtEinspeisung/1e3).toFixed(1)," MWh"]})]})]})]})]}),!j&&C&&e.jsxs(W,{className:"text-center py-12",children:[e.jsx(ia,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]})]})}const $a=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function js(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState([]),[g,d]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{if(!a)return;(async()=>{d(!0),o(null);try{const u=await me.getEAutoDashboard(a);l(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden")}finally{d(!1)}})()},[a]),r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:x=>n(parseInt(x.target.value)),options:t.map(x=>({value:x.id.toString(),label:x.anlagenname}))})]}),i&&e.jsx(ee,{type:"error",children:i}),g?e.jsx(he,{text:"Lade E-Auto Daten..."}):s.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Fe,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein E-Auto unter "Investitionen" hinzu.'})]})}):s.map(x=>e.jsx(fs,{dashboard:x},x.investition.id))]})}function fs({dashboard:t}){var i;const{investition:r,monatsdaten:a,zusammenfassung:n}=t,s=n,l=a.map(o=>({name:`${$a[o.monat]} ${o.jahr.toString().slice(2)}`,km:o.verbrauch_daten.km_gefahren||0,verbrauch:o.verbrauch_daten.verbrauch_kwh||0,pv:o.verbrauch_daten.ladung_pv_kwh||0,netz:o.verbrauch_daten.ladung_netz_kwh||0,extern:o.verbrauch_daten.ladung_extern_kwh||0,v2h:o.verbrauch_daten.v2h_entladung_kwh||0})),g=[{name:"Heim: PV",value:s.ladung_pv_kwh||0},{name:"Heim: Netz",value:s.ladung_netz_kwh||0},{name:"Extern",value:s.ladung_extern_kwh||0}].filter(o=>o.value>0),d=[{name:"E-Auto (Strom)",value:s.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:s.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(Fe,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Gefahren",value:((i=s.gesamt_km)==null?void 0:i.toLocaleString("de-DE"))||"0",unit:"km",icon:Fe,color:"blue",formel:"Σ km gefahren",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(ie,{title:"Verbrauch",value:(s.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:ue,color:"yellow",formel:"Verbrauch = kWh ÷ km × 100",berechnung:`${(s.gesamt_verbrauch_kwh||0).toFixed(0)} kWh ÷ ${s.gesamt_km||0} km × 100`,ergebnis:`= ${(s.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(ie,{title:"PV-Anteil (Heim)",value:(s.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(s.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:Te,color:"green",formel:"PV-Anteil = PV-Ladung ÷ Heimladung × 100",berechnung:`${(s.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(s.ladung_heim_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(s.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(ie,{title:"Ersparnis vs. Benzin",value:(s.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",subtitle:`+ Wallbox: ${(s.wallbox_ersparnis_euro||0).toFixed(0)} €`,icon:ke,color:"green",trend:(s.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten − Stromkosten",berechnung:`${(s.benzin_kosten_alternativ_euro||0).toFixed(0)} € − ${(s.strom_kosten_gesamt_euro||0).toFixed(0)} €`,ergebnis:`= ${(s.ersparnis_vs_benzin_euro||0).toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsxs(Ge,{data:g,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:o,percent:x})=>`${o}: ${(x*100).toFixed(0)}%`,children:[e.jsx(fe,{fill:"#22c55e"})," ",e.jsx(fe,{fill:"#f97316"})," ",e.jsx(fe,{fill:"#ef4444"})," "]}),e.jsx(Q,{formatter:o=>`${o.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(s.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(s.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(s.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(s.ladung_extern_kwh||0).toFixed(0)," kWh (",(s.ladung_extern_euro||0).toFixed(2)," €)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:d,layout:"vertical",children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{type:"number",tickFormatter:o=>`${o}€`}),e.jsx(le,{type:"category",dataKey:"name",width:120}),e.jsx(Q,{formatter:o=>`${o.toFixed(2)} €`}),e.jsx(ne,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(s.ersparnis_vs_benzin_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(ne,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(ne,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(ne,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(ne,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(s.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(s.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(s.v2h_ersparnis_euro||0).toFixed(2)," €"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(s.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:a.map(o=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[$a[o.monat]," ",o.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:o.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(o.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(o.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(o.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(o.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},o.id))})]})})]})]})}const Da=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function vs(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState([]),[g,d]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{if(!a)return;(async()=>{d(!0),o(null);try{const u=await me.getWaermepumpeDashboard(a);l(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden")}finally{d(!1)}})()},[a]),r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(De,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:x=>n(parseInt(x.target.value)),options:t.map(x=>({value:x.id.toString(),label:x.anlagenname}))})]}),i&&e.jsx(ee,{type:"error",children:i}),g?e.jsx(he,{text:"Lade Wärmepumpe Daten..."}):s.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wärmepumpe für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wärmepumpe unter "Investitionen" hinzu.'})]})}):s.map(x=>e.jsx(ws,{dashboard:x},x.investition.id))]})}function ws({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:n}=t,s=n,l=a.map(i=>({name:`${Da[i.monat]} ${i.jahr.toString().slice(2)}`,strom:i.verbrauch_daten.stromverbrauch_kwh||0,heizung:i.verbrauch_daten.heizenergie_kwh||0,warmwasser:i.verbrauch_daten.warmwasser_kwh||0,cop:((i.verbrauch_daten.heizenergie_kwh||0)+(i.verbrauch_daten.warmwasser_kwh||0))/(i.verbrauch_daten.stromverbrauch_kwh||1)})),g=[{name:"Heizung",value:s.gesamt_heizenergie_kwh},{name:"Warmwasser",value:s.gesamt_warmwasser_kwh}],d=[{name:"Wärmepumpe",value:s.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/Öl",value:s.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(De,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Ø COP",value:s.durchschnitt_cop.toFixed(2),icon:Hr,color:"orange",formel:"COP = Wärme ÷ Strom",berechnung:`${s.gesamt_waerme_kwh.toFixed(0)} kWh ÷ ${s.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${s.durchschnitt_cop.toFixed(2)}`}),e.jsx(ie,{title:"Wärme erzeugt",value:(s.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:De,color:"red",formel:"Wärme = Heizung + Warmwasser",berechnung:`${s.gesamt_heizenergie_kwh.toFixed(0)} + ${s.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${s.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(ie,{title:"Strom verbraucht",value:(s.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:ue,color:"yellow",formel:"Σ Stromverbrauch WP",berechnung:`${s.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(s.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(ie,{title:"Ersparnis",value:s.ersparnis_euro.toFixed(0),unit:"€",icon:ke,color:"green",trend:s.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/Öl-Kosten − WP-Kosten",berechnung:`${s.alte_heizung_kosten_euro.toFixed(0)} € − ${s.wp_kosten_euro.toFixed(0)} €`,ergebnis:`= ${s.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsxs(Ge,{data:g,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:o})=>`${i}: ${(o*100).toFixed(0)}%`,children:[e.jsx(fe,{fill:"#ef4444"}),e.jsx(fe,{fill:"#3b82f6"})]}),e.jsx(Q,{formatter:i=>`${i.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",s.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",s.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/Öl"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:d,layout:"vertical",children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{type:"number",tickFormatter:i=>`${i}€`}),e.jsx(le,{type:"category",dataKey:"name",width:100}),e.jsx(Q,{formatter:i=>`${i.toFixed(2)} €`}),e.jsx(ne,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",s.ersparnis_euro.toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pt,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(Me,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(Me,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{domain:[0,6]}),e.jsx(Q,{formatter:i=>i.toFixed(2)}),e.jsx(ne,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Te,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis gegenüber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:a.map(i=>{const o=i.verbrauch_daten.stromverbrauch_kwh||0,x=i.verbrauch_daten.heizenergie_kwh||0,u=i.verbrauch_daten.warmwasser_kwh||0,p=o>0?(x+u)/o:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[Da[i.monat]," ",i.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:o.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:x.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:u.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:p.toFixed(2)})]},i.id)})})]})})]})]})}const Ns=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function _s(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState([]),[g,d]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{if(!a)return;(async()=>{d(!0),o(null);try{const u=await me.getSpeicherDashboard(a);l(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden")}finally{d(!1)}})()},[a]),r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:x=>n(parseInt(x.target.value)),options:t.map(x=>({value:x.id.toString(),label:x.anlagenname}))})]}),i&&e.jsx(ee,{type:"error",children:i}),g?e.jsx(he,{text:"Lade Speicher Daten..."}):s.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ye,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge einen Speicher unter "Investitionen" hinzu.'})]})}):s.map(x=>e.jsx(zs,{dashboard:x},x.investition.id))]})}function zs({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:n}=t,s=n,l=a.map(g=>{const d=g.verbrauch_daten.ladung_kwh||0,i=g.verbrauch_daten.entladung_kwh||0;return{name:`${Ns[g.monat]} ${g.jahr.toString().slice(2)}`,ladung:d,entladung:i,zyklen:s.kapazitaet_kwh>0?d/s.kapazitaet_kwh:0,effizienz:d>0?i/d*100:0}});return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.kapazitaet_kwh," kWh Kapazität • ",s.anzahl_monate," Monate Daten"]})]}),e.jsx(ye,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Vollzyklen",value:s.vollzyklen.toFixed(0),icon:Tr,color:"blue",formel:"Vollzyklen = Ladung ÷ Kapazität",berechnung:`${s.gesamt_ladung_kwh.toFixed(0)} kWh ÷ ${s.kapazitaet_kwh} kWh`,ergebnis:`= ${s.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(ie,{title:"Effizienz",value:s.effizienz_prozent.toFixed(1),unit:"%",icon:Za,color:"green",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${s.gesamt_entladung_kwh.toFixed(0)} kWh ÷ ${s.gesamt_ladung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${s.effizienz_prozent.toFixed(1)} %`}),e.jsx(ie,{title:"Durchsatz",value:(s.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:ue,color:"yellow",formel:"Durchsatz = Σ Entladung",berechnung:`${s.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(s.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(ie,{title:"Ersparnis",value:s.ersparnis_euro.toFixed(0),unit:"€",icon:ke,color:"green",trend:s.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${s.gesamt_entladung_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${s.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[s.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:s.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(s.gesamt_ladung_kwh-s.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(ne,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(ne,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pt,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{formatter:g=>g.toFixed(1)}),e.jsx(Me,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{domain:[80,100]}),e.jsx(Q,{formatter:g=>`${g.toFixed(1)}%`}),e.jsx(gt,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:l.map((g,d)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:g.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:g.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:g.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:g.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[g.effizienz.toFixed(1),"%"]})]},d))})]})})]})]})}function Ss(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState([]),[g,d]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{if(!a)return;(async()=>{d(!0),o(null);try{const u=await me.getWallboxDashboard(a);l(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden")}finally{d(!1)}})()},[a]),r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Re,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:x=>n(parseInt(x.target.value)),options:t.map(x=>({value:x.id.toString(),label:x.anlagenname}))})]}),i&&e.jsx(ee,{type:"error",children:i}),g?e.jsx(he,{text:"Lade Wallbox Daten..."}):s.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Re,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wallbox unter "Einstellungen → Investitionen" hinzu.'})]})}):s.map(x=>e.jsx(Es,{dashboard:x},x.investition.id))]})}function Es({dashboard:t}){const{investition:r,zusammenfassung:a}=t,n=a,s=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.extern_ladung_kwh||0}].filter(i=>i.value>0),l=[{name:"Heimladung (tatsächlich)",value:n.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:n.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],g=n.leistung_kw||11,d=(n.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g," kW Ladeleistung • ",n.anzahl_monate||0," Monate Daten"]})]}),e.jsx(Re,{className:"h-10 w-10 text-purple-500"})]}),d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Heimladung",value:((n.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:Oe,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} + ${(n.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(ie,{title:"PV-Anteil",value:(n.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:Te,color:"green",formel:"PV-Anteil = PV ÷ Heimladung × 100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(n.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(ie,{title:"Ersparnis vs. Extern",value:(n.ersparnis_vs_extern_euro||0).toFixed(0),unit:"€",subtitle:"Wallbox-ROI",icon:ke,color:"green",trend:(n.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten − Heim-Kosten",berechnung:`${(n.heim_als_extern_kosten_euro||0).toFixed(0)} € − ${(n.heim_kosten_euro||0).toFixed(0)} €`,ergebnis:`= ${(n.ersparnis_vs_extern_euro||0).toFixed(2)} €`}),e.jsx(ie,{title:"Ladevorgänge",value:(n.gesamt_ladevorgaenge||0).toString(),subtitle:`Ø ${(n.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:ue,color:"blue",formel:"Σ Ladevorgänge",berechnung:`${n.anzahl_monate||0} Monate`,ergebnis:`= ${n.gesamt_ladevorgaenge||0} Vorgänge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsxs(Ge,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:o})=>`${i}: ${(o*100).toFixed(0)}%`,children:[e.jsx(fe,{fill:"#22c55e"})," ",e.jsx(fe,{fill:"#f97316"})," ",e.jsx(fe,{fill:"#ef4444"})," "]}),e.jsx(Q,{formatter:i=>`${i.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(n.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Tt,{className:"h-4 w-4 text-red-500"}),"Extern: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,layout:"vertical",children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{type:"number",tickFormatter:i=>`${i}€`}),e.jsx(le,{type:"category",dataKey:"name",width:150}),e.jsx(Q,{formatter:i=>`${i.toFixed(2)} €`}),e.jsx(be,{}),e.jsx(ne,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(n.ersparnis_vs_extern_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklärt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(n.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(n.ladung_netz_kwh||0).toFixed(0)," kWh = ",(n.heim_kosten_euro||0).toFixed(2)," €)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(n.extern_preis_kwh_euro||.5).toFixed(2)," €/kWh"]})]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatsächliche externe Ladung: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh für ",(n.extern_kosten_euro||0).toFixed(2)," €"]})]}),r.anschaffungskosten_gesamt&&r.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.anzahl_monate&&n.anzahl_monate>0?((n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12).toFixed(0):0," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const i=n.anzahl_monate&&n.anzahl_monate>0?(n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12:0;return i<=0?"∞":`${(r.anschaffungskosten_gesamt/i).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen → Monatsdaten".'})})]})}const Fs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function As(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState([]),[g,d]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{if(!a)return;(async()=>{d(!0),o(null);try{const u=await me.getBalkonkraftwerkDashboard(a);l(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden")}finally{d(!1)}})()},[a]),r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:x=>n(parseInt(x.target.value)),options:t.map(x=>({value:x.id.toString(),label:x.anlagenname}))})]}),i&&e.jsx(ee,{type:"error",children:i}),g?e.jsx(he,{text:"Lade Balkonkraftwerk Daten..."}):s.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(se,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):s.map(x=>e.jsx(Cs,{dashboard:x},x.investition.id))]})}function Cs({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:n}=t,s=n,l=a.map(i=>({name:`${Fs[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:i.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:i.verbrauch_daten.speicher_entladung_kwh||0})),g=[{name:"Eigenverbrauch",value:s.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:s.gesamt_einspeisung_kwh}],d=["#22c55e","#f59e0b"];return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.leistung_wp," Wp • ",s.anzahl_module," Module • ",s.anzahl_monate," Monate Daten",s.hat_speicher&&` • ${s.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(se,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Erzeugung",value:s.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:ue,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${s.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(ie,{title:"Eigenverbrauch",value:s.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:Oe,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${s.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh ÷ ${s.gesamt_erzeugung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${s.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(ie,{title:"Ersparnis",value:s.gesamt_ersparnis_euro.toFixed(0),unit:"€",icon:ke,color:"green",trend:s.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${s.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${s.gesamt_ersparnis_euro.toFixed(2)} €`}),e.jsx(ie,{title:"CO₂ gespart",value:s.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:Te,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${s.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × 0.4`,ergebnis:`= ${s.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[s.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Einspeisung"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[s.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Erlös Einspeisung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[s.erloes_einspeisung_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsx(Ge,{data:g,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:o})=>`${i}: ${(o*100).toFixed(0)}%`,children:g.map((i,o)=>e.jsx(fe,{fill:d[o%d.length]},`cell-${o}`))}),e.jsx(Q,{formatter:i=>`${i.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",s.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",s.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pt,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(Me,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Me,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),s.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ye,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",s.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[s.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[s.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[s.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(ne,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(ne,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Te,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[s.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),s.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:l.map((i,o)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)}),s.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:i.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:i.speicher_entladung.toFixed(1)})]})]},o))})]})})]})]})}const ba=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],ya={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function Ms(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState([]),[g,d]=c.useState(!1),[i,o]=c.useState(null);return c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{if(!a)return;(async()=>{d(!0),o(null);try{const u=await me.getSonstigesDashboard(a);l(u)}catch(u){o(u instanceof Error?u.message:"Fehler beim Laden")}finally{d(!1)}})()},[a]),r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(na,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:x=>n(parseInt(x.target.value)),options:t.map(x=>({value:x.id.toString(),label:x.anlagenname}))})]}),i&&e.jsx(ee,{type:"error",children:i}),g?e.jsx(he,{text:"Lade Daten..."}):s.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(na,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):s.map(x=>e.jsx(Ws,{dashboard:x},x.investition.id))]})}function Ws({dashboard:t}){const{investition:r,monatsdaten:a,zusammenfassung:n}=t,s=n,l=s.kategorie;return l==="erzeuger"?e.jsx($s,{investition:r,monatsdaten:a,zusammenfassung:s}):l==="verbraucher"?e.jsx(Ds,{investition:r,monatsdaten:a,zusammenfassung:s}):e.jsx(Ls,{investition:r,monatsdaten:a,zusammenfassung:s})}function $s({investition:t,monatsdaten:r,zusammenfassung:a}){const n=r.map(l=>({name:`${ba[l.monat]} ${l.jahr.toString().slice(2)}`,erzeugung:l.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:l.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:l.verbrauch_daten.einspeisung_kwh||0})),s=[{name:"Eigenverbrauch",value:a.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:a.gesamt_einspeisung_kwh||0}];return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:ya[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(ue,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Erzeugung",value:(a.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:ue,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(ie,{title:"Eigenverbrauch",value:(a.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:Oe,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} ÷ ${(a.gesamt_erzeugung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(a.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(ie,{title:"Ersparnis",value:(a.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",icon:ke,color:"green",trend:(a.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.gesamt_ersparnis_euro||0).toFixed(2)} €`}),e.jsx(ie,{title:"CO₂ gespart",value:(a.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:Te,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${(a.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × 0.4`,ergebnis:`= ${(a.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(ze,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsxs(Ge,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:g})=>`${l}: ${(g*100).toFixed(0)}%`,children:[e.jsx(fe,{fill:"#22c55e"}),e.jsx(fe,{fill:"#f59e0b"})]}),e.jsx(Q,{formatter:l=>`${l.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pt,{data:n,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(Me,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Me,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:n.map((l,g)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:l.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:l.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:l.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:l.einspeisung.toFixed(1)})]},g))})]})})]})]})}function Ds({investition:t,monatsdaten:r,zusammenfassung:a}){const n=r.map(l=>({name:`${ba[l.monat]} ${l.jahr.toString().slice(2)}`,verbrauch:l.verbrauch_daten.verbrauch_kwh||0,bezug_pv:l.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:l.verbrauch_daten.bezug_netz_kwh||0})),s=[{name:"PV-Strom",value:a.bezug_pv_kwh||0},{name:"Netzstrom",value:a.bezug_netz_kwh||0}];return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:ya[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(ue,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Verbrauch",value:(a.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:ue,color:"blue",formel:"Σ Verbrauch alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(ie,{title:"PV-Anteil",value:(a.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:Oe,color:"green",formel:"PV-Anteil = PV-Bezug ÷ Verbrauch × 100",berechnung:`${(a.bezug_pv_kwh||0).toFixed(0)} ÷ ${(a.gesamt_verbrauch_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(a.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(ie,{title:"Netzkosten",value:(a.kosten_netz_euro||0).toFixed(0),unit:"€",icon:ke,color:"red",formel:"Netzkosten = Netzbezug × Strompreis",berechnung:`${(a.bezug_netz_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.kosten_netz_euro||0).toFixed(2)} €`}),e.jsx(ie,{title:"PV-Ersparnis",value:(a.ersparnis_pv_euro||0).toFixed(0),unit:"€",icon:Te,color:"green",trend:(a.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug × Strompreis",berechnung:`${(a.bezug_pv_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.ersparnis_pv_euro||0).toFixed(2)} €`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(ze,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsxs(Ge,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:g})=>`${l}: ${(g*100).toFixed(0)}%`,children:[e.jsx(fe,{fill:"#22c55e"}),e.jsx(fe,{fill:"#ef4444"})]}),e.jsx(Q,{formatter:l=>`${l.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:n,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(ne,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(ne,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:n.map((l,g)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:l.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:l.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:l.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:l.bezug_netz.toFixed(1)})]},g))})]})})]})]})}function Ls({investition:t,monatsdaten:r,zusammenfassung:a}){const n=r.map(s=>({name:`${ba[s.monat]} ${s.jahr.toString().slice(2)}`,ladung:s.verbrauch_daten.ladung_kwh||0,entladung:s.verbrauch_daten.entladung_kwh||0}));return e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:ya[a.kategorie]})]}),a.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:a.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(ye,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Ladung",value:(a.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:ye,color:"purple",formel:"Σ Ladung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(ie,{title:"Entladung",value:(a.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:ue,color:"green",formel:"Σ Entladung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(ie,{title:"Effizienz",value:(a.effizienz_prozent||0).toFixed(1),unit:"%",icon:ke,color:"blue",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${(a.gesamt_entladung_kwh||0).toFixed(0)} ÷ ${(a.gesamt_ladung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(a.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(ie,{title:"Ersparnis",value:(a.ersparnis_euro||0).toFixed(0),unit:"€",icon:ke,color:"green",trend:(a.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${(a.gesamt_entladung_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(a.ersparnis_euro||0).toFixed(2)} €`})]}),a.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(ze,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[a.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:n,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{}),e.jsx(Q,{}),e.jsx(be,{}),e.jsx(ne,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(ne,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:n.map((s,l)=>{const g=s.ladung>0?s.entladung/s.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:s.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:s.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:s.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[g.toFixed(1),"%"]})]},l)})})]})})]})]})}const Gt=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Se={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},Wt=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#ef4444","#06b6d4"],tt={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},yt={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function La(){var y;const t=Vt(),[r,a]=c.useState("uebersicht"),[n,s]=c.useState("all"),{anlagen:l,loading:g}=ve(),[d,i]=c.useState(null),o=d??((y=l[0])==null?void 0:y.id),x=l.find(b=>b.id===o),{monatsdaten:u,loading:p}=Ht(o),{strompreis:f}=dr(o??null),k=c.useMemo(()=>[...new Set(u.map(m=>m.jahr))].sort((m,h)=>h-m),[u]),S=c.useMemo(()=>n==="all"?u:u.filter(b=>b.jahr===n),[u,n]),_=pa(S);if(g||p)return e.jsx(he,{text:"Lade Auswertungen..."});if(l.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(ee,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(u.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(W,{className:"text-center py-12",children:[e.jsx(se,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(J,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx(Ee,{className:"h-4 w-4 ml-2"})]})]})]});const C=[{key:"uebersicht",label:"Übersicht"},{key:"pv",label:"PV-Anlage"},{key:"investitionen",label:"Investitionen"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[r!=="uebersicht"&&e.jsxs("select",{value:n,onChange:b=>s(b.target.value==="all"?"all":Number(b.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),k.map(b=>e.jsx("option",{value:b,children:b},b))]}),l.length>1&&e.jsx("select",{value:o??"",onChange:b=>i(Number(b.target.value)),className:"input w-auto",children:l.map(b=>e.jsx("option",{value:b.id,children:b.anlagenname},b.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:C.map(b=>e.jsx("button",{onClick:()=>a(b.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${r===b.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:b.label},b.key))})}),r==="uebersicht"&&e.jsx(Is,{data:u,anlage:x,strompreis:f}),r==="pv"&&e.jsx(Ps,{data:S,stats:_,anlage:x,strompreis:f}),r==="investitionen"&&o&&e.jsx(Vs,{anlageId:o,strompreis:f,selectedYear:n}),r==="finanzen"&&e.jsx(Bs,{data:S,stats:_,strompreis:f}),r==="co2"&&e.jsx(Ks,{data:S,stats:_})]})}function Is({data:t,anlage:r,strompreis:a}){const n=c.useMemo(()=>[...new Set(t.map(d=>d.jahr))].sort((d,i)=>d-i),[t]),s=c.useMemo(()=>{const d={};return t.forEach(i=>{d[i.jahr]||(d[i.jahr]={jahr:i.jahr,erzeugung:0,eigenverbrauch:0,einspeisung:0,netzbezug:0,gesamtverbrauch:0,autarkie:0,eigenverbrauchQuote:0,spezErtrag:0,monate:0,nettoErtrag:0});const o=d[i.jahr],x=i.pv_erzeugung_kwh||i.einspeisung_kwh+(i.eigenverbrauch_kwh||0);o.erzeugung+=x,o.eigenverbrauch+=i.eigenverbrauch_kwh||0,o.einspeisung+=i.einspeisung_kwh,o.netzbezug+=i.netzbezug_kwh,o.gesamtverbrauch+=i.gesamtverbrauch_kwh||0,o.monate+=1}),Object.values(d).forEach(i=>{if(i.erzeugung>0&&(i.eigenverbrauchQuote=i.eigenverbrauch/i.erzeugung*100),i.gesamtverbrauch>0&&(i.autarkie=i.eigenverbrauch/i.gesamtverbrauch*100),r!=null&&r.leistung_kwp&&(i.spezErtrag=i.erzeugung/r.leistung_kwp),a){const o=i.einspeisung*a.einspeiseverguetung_cent_kwh/100,x=i.eigenverbrauch*a.netzbezug_arbeitspreis_cent_kwh/100;i.nettoErtrag=o+x}}),Object.values(d).sort((i,o)=>i.jahr-o.jahr)},[t,r,a]),l=c.useMemo(()=>{const d=[];for(let i=1;i<=12;i++){const o={monat:Gt[i],monatNr:i};n.forEach(x=>{const u=t.find(f=>f.jahr===x&&f.monat===i),p=u?u.pv_erzeugung_kwh||u.einspeisung_kwh+(u.eigenverbrauch_kwh||0):0;o[`erzeugung_${x}`]=p,o[`autarkie_${x}`]=u&&u.gesamtverbrauch_kwh?(u.eigenverbrauch_kwh||0)/u.gesamtverbrauch_kwh*100:0}),d.push(o)}return d},[t,n]),g=(d,i)=>{if(i===void 0||i===0)return null;const o=d-i,x=o/i*100;return{value:o,percent:x}};if(n.length<2){const d=s[0];return d?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{type:"info",children:["Für einen detaillierten Jahresvergleich werden Daten aus mindestens 2 Jahren benötigt. Aktuell: ",n[0]||"Keine Daten"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(je,{title:"Erzeugung",value:(d.erzeugung/1e3).toFixed(1),unit:"MWh",icon:se,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"}),e.jsx(je,{title:"Autarkie",value:d.autarkie.toFixed(0),unit:"%",icon:ye,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"}),e.jsx(je,{title:"EV-Quote",value:d.eigenverbrauchQuote.toFixed(0),unit:"%",icon:ue,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"}),a&&e.jsx(je,{title:"Netto-Ertrag",value:d.nettoErtrag.toFixed(0),unit:"€",icon:Pt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]})]}):e.jsxs(W,{className:"text-center py-8",children:[e.jsx(bt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Daten vorhanden"})]})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:s.slice(-4).reverse().map((d,i)=>{const o=s.find(u=>u.jahr===d.jahr-1),x=g(d.erzeugung,o==null?void 0:o.erzeugung);return e.jsxs(W,{className:i===0?"ring-2 ring-primary-500":"",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:d.jahr}),i===0&&e.jsx("span",{className:"text-xs bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300 px-2 py-1 rounded",children:"Aktuell"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Erzeugung"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[(d.erzeugung/1e3).toFixed(1)," MWh",x&&e.jsxs("span",{className:`ml-2 text-xs ${x.percent>=0?"text-green-600":"text-red-600"}`,children:[x.percent>=0?"↑":"↓"," ",Math.abs(x.percent).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Autarkie"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[d.autarkie.toFixed(0),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"EV-Quote"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[d.eigenverbrauchQuote.toFixed(0),"%"]})]}),(r==null?void 0:r.leistung_kwp)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Spez. Ertrag"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[d.spezErtrag.toFixed(0)," kWh/kWp"]})]}),a&&e.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-gray-500",children:"Netto-Ertrag"}),e.jsxs("span",{className:"font-medium text-green-600",children:[d.nettoErtrag.toFixed(0)," €"]})]})]})]},d.jahr)})}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatliche Erzeugung im Jahresvergleich"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"monat",tick:{fontSize:11}}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Q,{formatter:(d,i)=>{const o=i.replace("erzeugung_","");return[`${d.toFixed(0)} kWh`,`${o}`]}}),e.jsx(be,{formatter:d=>d.replace("erzeugung_","")}),n.map((d,i)=>e.jsx(ne,{dataKey:`erzeugung_${d}`,name:`erzeugung_${d}`,fill:Wt[i%Wt.length]},d))]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Autarkie im Jahresvergleich"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:l,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"monat",tick:{fontSize:11}}),e.jsx(le,{unit:"%",domain:[0,100],tick:{fontSize:11}}),e.jsx(Q,{formatter:(d,i)=>{const o=i.replace("autarkie_","");return[`${d.toFixed(0)}%`,`${o}`]}}),e.jsx(be,{formatter:d=>d.replace("autarkie_","")}),n.map((d,i)=>e.jsx(gt,{type:"monotone",dataKey:`autarkie_${d}`,name:`autarkie_${d}`,stroke:Wt[i%Wt.length],strokeWidth:2,dot:{r:3}},d))]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Erzeugung"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Δ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Eigenverbr."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Einspeisung"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Netzbezug"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Autarkie"}),a&&e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Netto-Ertrag"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.map((d,i)=>{const o=i>0?s[i-1]:void 0,x=g(d.erzeugung,o==null?void 0:o.erzeugung);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:[d.jahr,e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:["(",d.monate," Mon.)"]})]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:[(d.erzeugung/1e3).toFixed(1)," MWh"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:x?e.jsxs("span",{className:x.percent>=0?"text-green-600":"text-red-600",children:[x.percent>=0?"+":"",x.percent.toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:[d.eigenverbrauch.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:[d.einspeisung.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:[d.netzbezug.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:[d.autarkie.toFixed(0),"%"]}),a&&e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-medium text-green-600",children:[d.nettoErtrag.toFixed(0)," €"]})]},d.jahr)})})]})})]})]})}function Ps({data:t,stats:r,anlage:a,strompreis:n}){const s=c.useMemo(()=>[...t].sort((i,o)=>i.jahr!==o.jahr?i.jahr-o.jahr:i.monat-o.monat).map(i=>({name:`${Gt[i.monat]} ${i.jahr.toString().slice(-2)}`,Erzeugung:i.pv_erzeugung_kwh||0,Eigenverbrauch:i.eigenverbrauch_kwh||0,Einspeisung:i.einspeisung_kwh,Netzbezug:i.netzbezug_kwh,SpezErtrag:a!=null&&a.leistung_kwp?(i.pv_erzeugung_kwh||i.einspeisung_kwh)/a.leistung_kwp:0})),[t,a]),l=c.useMemo(()=>[{name:"Eigenverbrauch",value:r.gesamtEigenverbrauch,color:Se.consumption},{name:"Einspeisung",value:r.gesamtEinspeisung,color:Se.feedin}],[r]),g=c.useMemo(()=>{if(!n)return null;const d=r.gesamtEinspeisung*n.einspeiseverguetung_cent_kwh/100,i=r.gesamtNetzbezug*n.netzbezug_arbeitspreis_cent_kwh/100,o=r.gesamtEigenverbrauch*n.netzbezug_arbeitspreis_cent_kwh/100,x=d+o;return{einspeiseErloes:d,netzbezugKosten:i,eigenverbrauchErsparnis:o,nettoErtrag:x}},[r,n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(je,{title:"PV-Erzeugung",value:(r.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:se,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${V(r.gesamtErzeugung,0)} kWh`,ergebnis:`= ${V(r.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(je,{title:"Eigenverbrauch",value:r.gesamtErzeugung>0?(r.gesamtEigenverbrauch/r.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(r.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:ue,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${V(r.gesamtEigenverbrauch,0)} kWh ÷ ${V(r.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${V(r.gesamtEigenverbrauch/r.gesamtErzeugung*100,1)} %`}),e.jsx(je,{title:"Autarkie",value:r.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:ye,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${V(r.durchschnittAutarkie,1)} %`}),e.jsx(je,{title:"Netto-Ertrag",value:g?g.nettoErtrag.toFixed(0):"---",unit:"€",subtitle:g?`${r.anzahlMonate} Monate`:"Strompreis fehlt",icon:Pt,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + EV-Ersparnis",berechnung:g?`${V(g.einspeiseErloes,2)} € + ${V(g.eigenverbrauchErsparnis,2)} €`:void 0,ergebnis:g?`= ${V(g.nettoErtrag,2)} €`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(W,{className:"md:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:s,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",tick:{fontSize:11}}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Q,{formatter:d=>[`${d.toFixed(0)} kWh`,""]}),e.jsx(be,{}),e.jsx(ne,{dataKey:"Eigenverbrauch",fill:Se.consumption,stackId:"a"}),e.jsx(ne,{dataKey:"Einspeisung",fill:Se.feedin,stackId:"a"}),e.jsx(ne,{dataKey:"Netzbezug",fill:Se.grid})]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Verteilung PV-Strom"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsx(Ge,{data:l,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,dataKey:"value",label:({name:d,percent:i})=>`${d}: ${(i*100).toFixed(0)}%`,labelLine:!1,children:l.map((d,i)=>e.jsx(fe,{fill:d.color},`cell-${i}`))}),e.jsx(Q,{formatter:d=>[`${(d/1e3).toFixed(1)} MWh`,""]})]})})})]})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Erzeugung Verlauf"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:s,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",tick:{fontSize:11}}),e.jsx(le,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Q,{formatter:d=>[`${d.toFixed(0)} kWh`,""]}),e.jsx(be,{}),e.jsx(gt,{type:"monotone",dataKey:"Erzeugung",stroke:Se.solar,strokeWidth:2,dot:!1})]})})})]}),(a==null?void 0:a.leistung_kwp)&&e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:s,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",tick:{fontSize:11}}),e.jsx(le,{unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(Q,{formatter:d=>[`${d.toFixed(1)} kWh/kWp`,""]}),e.jsx(ne,{dataKey:"SpezErtrag",name:"Spez. Ertrag",fill:Se.solar})]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[r.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(a==null?void 0:a.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[a!=null&&a.leistung_kwp?(r.gesamtErzeugung/a.leistung_kwp).toFixed(0):"---"," kWh/kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(r.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function Vs({anlageId:t,strompreis:r,selectedYear:a="all"}){var _,j,C;const{investitionen:n,loading:s}=zt(t),[l,g]=c.useState(null),[d,i]=c.useState(!0),[o,x]=c.useState(new Set);c.useEffect(()=>{(async()=>{try{i(!0);const b=await me.getROIDashboard(t,r==null?void 0:r.netzbezug_arbeitspreis_cent_kwh,r==null?void 0:r.einspeiseverguetung_cent_kwh,void 0,a);g(b)}catch(b){console.error("ROI-Dashboard Fehler:",b)}finally{i(!1)}})()},[t,r,a]);const u=c.useMemo(()=>{const y={};return n.forEach(b=>{y[b.typ]||(y[b.typ]=[]),y[b.typ].push(b)}),y},[n]),p=c.useMemo(()=>Object.entries(u).map(([y,b])=>({typ:y,label:yt[y]||y,kosten:b.reduce((m,h)=>m+(h.anschaffungskosten_gesamt||0),0),color:tt[y]||"#6b7280"})).filter(y=>y.kosten>0).sort((y,b)=>b.kosten-y.kosten),[u]),f=c.useMemo(()=>{if(!l||!l.gesamt_jahres_einsparung)return[];const y=l.gesamt_relevante_kosten,b=l.gesamt_jahres_einsparung,m=[];for(let h=0;h<=25;h++){const N=h*b;m.push({jahr:h,investition:y,ersparnis:N,bilanz:N-y})}return m},[l]);if(s||d)return e.jsx(he,{text:"Lade Investitionsdaten..."});if(n.length===0)return e.jsxs(W,{className:"text-center py-8",children:[e.jsx(xt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const k=(_=l==null?void 0:l.berechnungen.find(y=>y.investition_typ==="pv-module"))==null?void 0:_.detail_berechnung,S=k==null?void 0:k.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(je,{title:"Gesamtinvestition",value:((l==null?void 0:l.gesamt_relevante_kosten)||0).toFixed(0),unit:"€",subtitle:`${n.length} Komponenten`,icon:Gr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten − Alternativkosten",berechnung:l?`${V(l.gesamt_investition,0)} € − ${V(l.gesamt_investition-l.gesamt_relevante_kosten,0)} € Alternativ`:void 0,ergebnis:l?`= ${V(l.gesamt_relevante_kosten,0)} € relevante Kosten`:void 0}),e.jsx(je,{title:"Jahresersparnis",value:((l==null?void 0:l.gesamt_jahres_einsparung)||0).toFixed(0),unit:"€/Jahr",icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + Eigenverbrauch-Ersparnis",berechnung:k?`${V(k.einspeise_erloes_euro,2)} € + ${V(k.ev_ersparnis_euro,2)} €`:"Σ aller Investitions-Einsparungen",ergebnis:S||(l?`= ${V(l.gesamt_jahres_einsparung,0)} €/Jahr`:void 0)}),e.jsx(je,{title:"ROI",value:((j=l==null?void 0:l.gesamt_roi_prozent)==null?void 0:j.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:ke,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis ÷ Relevante Kosten × 100",berechnung:l&&l.gesamt_relevante_kosten>0?`${V(l.gesamt_jahres_einsparung,0)} € ÷ ${V(l.gesamt_relevante_kosten,0)} € × 100`:void 0,ergebnis:l!=null&&l.gesamt_roi_prozent?`= ${l.gesamt_roi_prozent}% ROI p.a.`:void 0}),e.jsx(je,{title:"Amortisation",value:((C=l==null?void 0:l.gesamt_amortisation_jahre)==null?void 0:C.toFixed(1))||"---",unit:"Jahre",icon:bt,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten ÷ Jahresersparnis",berechnung:l&&l.gesamt_jahres_einsparung>0?`${V(l.gesamt_relevante_kosten,0)} € ÷ ${V(l.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:l!=null&&l.gesamt_amortisation_jahre?`= ${l.gesamt_amortisation_jahre} Jahre bis zur Kostendeckung`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsx(Ge,{data:p,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:y,percent:b})=>`${y}: ${(b*100).toFixed(0)}%`,labelLine:!1,children:p.map((y,b)=>e.jsx(fe,{fill:y.color},`cell-${b}`))}),e.jsx(Q,{formatter:y=>[`${y.toFixed(0)} €`,""]})]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:p,layout:"vertical",children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{type:"number",unit:" €",tick:{fontSize:11}}),e.jsx(le,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(Q,{formatter:y=>[`${y.toFixed(0)} €`,""]}),e.jsx(ne,{dataKey:"kosten",name:"Kosten",children:p.map((y,b)=>e.jsx(fe,{fill:y.color},`cell-${b}`))})]})})})]})]}),f.length>0&&e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pt,{data:f,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(le,{unit:" €",tick:{fontSize:11}}),e.jsx(Q,{formatter:y=>[`${y.toFixed(0)} €`,""]}),e.jsx(be,{}),e.jsx(Me,{type:"monotone",dataKey:"investition",name:"Investition",stroke:Se.grid,fill:Se.grid,fillOpacity:.3}),e.jsx(Me,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:Se.feedin,fill:Se.feedin,fillOpacity:.3})]})})}),(l==null?void 0:l.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",l.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(l==null?void 0:l.berechnungen)&&l.berechnungen.length>0&&(()=>{const y=l.berechnungen.filter(h=>{var N;return h.investition_typ==="pv-module"&&typeof((N=h.detail_berechnung)==null?void 0:N.hinweis)=="string"&&h.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),b=l.berechnungen.filter(h=>{var N;return h.investition_typ==="wechselrichter"&&typeof((N=h.detail_berechnung)==null?void 0:N.hinweis)=="string"&&h.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),m=y.length>0||b.length>0;return e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),m&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollständig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[y.length>0&&e.jsxs("li",{children:[y.length," PV-Modul",y.length>1?"e":""," ohne Wechselrichter-Zuordnung → Bitte unter Einstellungen → Investitionen zuordnen"]}),b.length>0&&e.jsxs("li",{children:[b.length," Wechselrichter ohne PV-Module → Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:l.berechnungen.map(h=>{var X,oe;const N=h.anschaffungskosten_alternativ>0,M=N?"Anschaffung − Alternativkosten":"Anschaffungskosten (keine Alternative)",A=N?`${V(h.anschaffungskosten,0)} € − ${V(h.anschaffungskosten_alternativ,0)} €`:`${V(h.anschaffungskosten,0)} €`,K=`= ${V(h.relevante_kosten,0)} € Mehrkosten`,O=(h.detail_berechnung||{}).hinweis,H=h.investition_typ==="pv-system"&&h.komponenten&&h.komponenten.length>0,E=o.has(h.investition_id),U=h.investition_typ==="pv-module"&&typeof O=="string"&&O.includes("ohne Wechselrichter"),v=h.investition_typ==="wechselrichter"&&typeof O=="string"&&O.includes("ohne zugeordnete PV-Module"),L=()=>{x(te=>{const xe=new Set(te);return xe.has(h.investition_id)?xe.delete(h.investition_id):xe.add(h.investition_id),xe})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${H?"cursor-pointer":""}`,onClick:H?L:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[H&&(E?e.jsx(Ot,{className:"h-4 w-4 text-gray-400"}):e.jsx(da,{className:"h-4 w-4 text-gray-400"})),(U||v)&&e.jsx("span",{title:U?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(Ke,{className:"h-4 w-4 text-amber-500"})}),h.investition_bezeichnung,H&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",h.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${tt[h.investition_typ]||"#6b7280"}20`,color:tt[h.investition_typ]||"#6b7280"},children:yt[h.investition_typ]||h.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(Qe,{formel:M,berechnung:A,ergebnis:K,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[h.relevante_kosten.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(Qe,{formel:`Jahresersparnis ${yt[h.investition_typ]||h.investition_typ}`,berechnung:O||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${V(h.jahres_einsparung,0)} €/Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[h.jahres_einsparung.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(Qe,{formel:"Ersparnis ÷ Mehrkosten × 100",berechnung:`${V(h.jahres_einsparung,0)} € ÷ ${V(h.relevante_kosten,0)} € × 100`,ergebnis:h.roi_prozent?`= ${h.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((X=h.roi_prozent)==null?void 0:X.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(Qe,{formel:"Mehrkosten ÷ Ersparnis",berechnung:`${V(h.relevante_kosten,0)} € ÷ ${V(h.jahres_einsparung,0)} €/Jahr`,ergebnis:h.amortisation_jahre?`= ${h.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((oe=h.amortisation_jahre)==null?void 0:oe.toFixed(1))||"---"," J."]})})})]},h.investition_id),H&&E&&h.komponenten.map(te=>{var xe,P;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:tt[te.typ]||"#6b7280"}}),te.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${tt[te.typ]||"#6b7280"}15`,color:tt[te.typ]||"#6b7280"},children:yt[te.typ]||te.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[te.relevante_kosten.toFixed(0)," €"]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:te.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[te.einsparung.toFixed(0)," €"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((xe=te.detail)==null?void 0:xe.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[te.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((P=te.detail)==null?void 0:P.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:te.detail.hinweis})]})]},`komp-${te.investition_id}`)})]})})})]})})]})})(),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(u).map(([y,b])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:tt[y]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:yt[y]||y}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",b.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:b.map(m=>{var h;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:m.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((h=m.anschaffungskosten_gesamt)==null?void 0:h.toFixed(0))||"0"," €"]})]},m.id)})})]},y))})]})]})}function Bs({data:t,stats:r,strompreis:a}){if(!a)return e.jsxs(W,{className:"text-center py-8",children:[e.jsx(Pt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const n=c.useMemo(()=>[...t].sort((g,d)=>g.jahr!==d.jahr?g.jahr-d.jahr:g.monat-d.monat).map(g=>{const d=g.eigenverbrauch_kwh||0,i=g.einspeisung_kwh*a.einspeiseverguetung_cent_kwh/100,o=g.netzbezug_kwh*a.netzbezug_arbeitspreis_cent_kwh/100,x=d*a.netzbezug_arbeitspreis_cent_kwh/100;return{name:`${Gt[g.monat]} ${g.jahr.toString().slice(-2)}`,Einspeiseerlös:i,Ersparnis:x,Netzbezug:-o}}),[t,a]),s=c.useMemo(()=>{const l=r.gesamtEinspeisung*a.einspeiseverguetung_cent_kwh/100,g=r.gesamtNetzbezug*a.netzbezug_arbeitspreis_cent_kwh/100,d=r.gesamtEigenverbrauch*a.netzbezug_arbeitspreis_cent_kwh/100,i=l+d;return{einspeiseErloes:l,netzbezugKosten:g,eigenverbrauchErsparnis:d,nettoErtrag:i}},[r,a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(je,{title:"Einspeiseerlös",value:s.einspeiseErloes.toFixed(0),unit:"€",subtitle:`${a.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Einspeisevergütung",berechnung:`${V(r.gesamtEinspeisung,0)} kWh × ${V(a.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${V(s.einspeiseErloes,2)} €`}),e.jsx(je,{title:"EV-Ersparnis",value:s.eigenverbrauchErsparnis.toFixed(0),unit:"€",subtitle:"vermiedener Netzbezug",icon:ue,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Netzbezugspreis",berechnung:`${V(r.gesamtEigenverbrauch,0)} kWh × ${V(a.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${V(s.eigenverbrauchErsparnis,2)} €`}),e.jsx(je,{title:"Netzbezug",value:s.netzbezugKosten.toFixed(0),unit:"€",subtitle:`${a.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:ye,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug × Netzbezugspreis",berechnung:`${V(r.gesamtNetzbezug,0)} kWh × ${V(a.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${V(s.netzbezugKosten,2)} €`}),e.jsx(je,{title:"Netto-Ertrag",value:s.nettoErtrag.toFixed(0),unit:"€",subtitle:"Gesamt",icon:Pt,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Einspeiseerlös + EV-Ersparnis",berechnung:`${V(s.einspeiseErloes,2)} € + ${V(s.eigenverbrauchErsparnis,2)} €`,ergebnis:`= ${V(s.nettoErtrag,2)} €`})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Finanzielle Bilanz pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:n,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",tick:{fontSize:11}}),e.jsx(le,{unit:" €",tick:{fontSize:11}}),e.jsx(Q,{formatter:l=>[`${l.toFixed(2)} €`,""]}),e.jsx(be,{}),e.jsx(ne,{dataKey:"Einspeiseerlös",fill:Se.feedin,stackId:"pos"}),e.jsx(ne,{dataKey:"Ersparnis",fill:Se.consumption,stackId:"pos"}),e.jsx(ne,{dataKey:"Netzbezug",fill:Se.grid})]})})})]})]})}function Ks({data:t,stats:r}){const n=c.useMemo(()=>[...t].sort((i,o)=>i.jahr!==o.jahr?i.jahr-o.jahr:i.monat-o.monat).map(i=>{const o=i.pv_erzeugung_kwh||i.einspeisung_kwh+(i.eigenverbrauch_kwh||0);return{name:`${Gt[i.monat]} ${i.jahr.toString().slice(-2)}`,CO2:o*.38}}),[t]),s=r.gesamtErzeugung*.38,l=s/12.5,g=s/.12;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(je,{title:"CO2 eingespart",value:(s/1e3).toFixed(2),unit:"t",subtitle:`${r.anzahlMonate} Monate`,icon:Te,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung × CO2-Faktor",berechnung:`${V(r.gesamtErzeugung,0)} kWh × ${.38*1e3} g/kWh`,ergebnis:`= ${V(s,0)} kg = ${V(s/1e3,2)} t`}),e.jsx(je,{title:"Bäume äquivalent",value:l.toFixed(0),unit:"Bäume/Jahr",subtitle:"Bindungsleistung",icon:Te,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung ÷ 12,5 kg/Baum/Jahr",berechnung:`${V(s,0)} kg ÷ 12,5 kg/Baum`,ergebnis:`= ${V(l,0)} Bäume`}),e.jsx(je,{title:"Auto-km vermieden",value:(g/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:bt,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung ÷ 120 g/km",berechnung:`${V(s*1e3,0)} g ÷ 120 g/km`,ergebnis:`= ${V(g,0)} km`})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"CO2-Einsparung pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:n,children:[e.jsx(de,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(ce,{dataKey:"name",tick:{fontSize:11}}),e.jsx(le,{unit:" kg",tick:{fontSize:11}}),e.jsx(Q,{formatter:d=>[`${d.toFixed(0)} kg CO2`,""]}),e.jsx(ne,{dataKey:"CO2",name:"CO2 eingespart",fill:"#10b981"})]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",.38*1e3," g CO2/kWh berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]})]})]})}function je({title:t,value:r,unit:a,subtitle:n,icon:s,color:l,bgColor:g,formel:d,berechnung:i,ergebnis:o}){const x=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal",children:a})]});return e.jsx(W,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:d?e.jsx(Qe,{formel:d,berechnung:i,ergebnis:o,children:x}):x}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${g}`,children:e.jsx(s,{className:`h-6 w-6 ${l}`})})]})})}const Os={"e-auto":Fe,waermepumpe:De,speicher:ye,wallbox:Re,wechselrichter:ht,"pv-module":se,balkonkraftwerk:Qa,sonstiges:ht},Zt={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},Ia={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function Ts(){var m;const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(null),[s,l]=c.useState(null),[g,d]=c.useState(!1),[i,o]=c.useState(null),[x,u]=c.useState(30),[p,f]=c.useState(8.2),[k,S]=c.useState(1.85),_=a??((m=t[0])==null?void 0:m.id),{strompreis:j}=dr(_??null);c.useEffect(()=>{j&&(u(j.netzbezug_arbeitspreis_cent_kwh),f(j.einspeiseverguetung_cent_kwh))},[j]),c.useEffect(()=>{if(!_)return;(async()=>{try{d(!0),o(null);const N=await me.getROIDashboard(_,x,p,k);l(N)}catch(N){o(N instanceof Error?N.message:"Fehler beim Laden der ROI-Daten")}finally{d(!1)}})()},[_,x,p,k]);const C=c.useMemo(()=>{if(!s||s.gesamt_relevante_kosten<=0)return[];const h=[];let N=0;const M=Math.min(Math.ceil((s.gesamt_amortisation_jahre??20)*1.5),30);for(let A=0;A<=M;A++)h.push({jahr:A,kumulierte_einsparung:Math.round(N),investition:s.gesamt_relevante_kosten}),N+=s.gesamt_jahres_einsparung;return h},[s]),y=c.useMemo(()=>{if(!s)return[];const h={};return s.berechnungen.forEach(N=>{const M=N.investition_typ;h[M]=(h[M]||0)+N.jahres_einsparung}),Object.entries(h).map(([N,M])=>({name:Ia[N]||N,value:Math.round(M),color:Zt[N]||"#6b7280"})).filter(N=>N.value>0)},[s]),b=c.useMemo(()=>s?s.berechnungen.map(h=>({name:h.investition_bezeichnung.length>15?h.investition_bezeichnung.substring(0,15)+"...":h.investition_bezeichnung,fullName:h.investition_bezeichnung,kosten:h.relevante_kosten,einsparung:h.jahres_einsparung,amortisation:h.amortisation_jahre??0,typ:h.investition_typ,color:Zt[h.investition_typ]||"#6b7280"})):[],[s]);return r?e.jsx(he,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(ee,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:_??"",onChange:h=>n(Number(h.target.value)),className:"input w-auto",children:t.map(h=>e.jsx("option",{value:h.id,children:h.anlagenname},h.id))})})]}),i&&e.jsx(ee,{type:"error",onClose:()=>o(null),children:i}),e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ht,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:x,onChange:h=>u(Number(h.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergütung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:p,onChange:h=>f(Number(h.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:k,onChange:h=>S(Number(h.target.value)),className:"input"})]})]})]}),g&&e.jsx(he,{text:"Berechne ROI..."}),!g&&s&&s.berechnungen.length===0&&e.jsx(ut,{icon:xt,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!g&&s&&s.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx($t,{icon:xt,title:"Gesamtinvestition",value:`${s.gesamt_investition.toLocaleString("de-DE")} €`,subtitle:`Relevant: ${s.gesamt_relevante_kosten.toLocaleString("de-DE")} €`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt − Alternativkosten",ergebnis:`= ${V(s.gesamt_relevante_kosten,0)} €`}),e.jsx($t,{icon:ke,title:"Jährliche Einsparung",value:`${s.gesamt_jahres_einsparung.toLocaleString("de-DE")} €`,subtitle:s.gesamt_roi_prozent?`ROI: ${s.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einsparungen aller Investitionen",berechnung:s.gesamt_relevante_kosten>0?"ROI = Einsparung ÷ Kosten × 100":void 0,ergebnis:s.gesamt_roi_prozent?`= ${s.gesamt_roi_prozent}% ROI`:void 0}),e.jsx($t,{icon:Cr,title:"Amortisation",value:s.gesamt_amortisation_jahre?`${s.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten ÷ Jährliche Einsparung",berechnung:s.gesamt_jahres_einsparung>0?`${V(s.gesamt_relevante_kosten,0)} € ÷ ${V(s.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:s.gesamt_amortisation_jahre?`= ${s.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx($t,{icon:Te,title:"CO2-Einsparung",value:`${s.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${V(s.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(Bt,{data:C,children:[e.jsx(de,{strokeDasharray:"3 3",opacity:.3}),e.jsx(ce,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(le,{tickFormatter:h=>`${(h/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(Q,{formatter:(h,N)=>[`${h.toLocaleString("de-DE")} €`,N==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:h=>`Jahr ${h}`}),e.jsx(be,{formatter:h=>h==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(gt,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(gt,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),s.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",s.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(He,{children:[e.jsx(Ge,{data:y,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:h,percent:N})=>`${h}: ${(N*100).toFixed(0)}%`,labelLine:!0,children:y.map((h,N)=>e.jsx(fe,{fill:h.color},`cell-${N}`))}),e.jsx(Q,{formatter:h=>[`${h.toLocaleString("de-DE")} €/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:b,layout:"vertical",children:[e.jsx(de,{strokeDasharray:"3 3",opacity:.3}),e.jsx(ce,{type:"number",tickFormatter:h=>`${h.toLocaleString("de-DE")}`}),e.jsx(le,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(Q,{formatter:(h,N)=>[N==="kosten"?`${h.toLocaleString("de-DE")} €`:`${h.toLocaleString("de-DE")} €/Jahr`,N==="kosten"?"Relevante Kosten":"Jährliche Einsparung"]}),e.jsx(be,{formatter:h=>h==="kosten"?"Relevante Kosten (€)":"Jährliche Einsparung (€)"}),e.jsx(ne,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(ne,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.berechnungen.map(h=>{const N=Os[h.investition_typ]||ht;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4",style:{color:Zt[h.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:h.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:Ia[h.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[h.relevante_kosten.toLocaleString("de-DE")," €"]}),h.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",h.anschaffungskosten.toLocaleString("de-DE")," € gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[h.jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:h.roi_prozent?e.jsxs("span",{className:h.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[h.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:h.amortisation_jahre?e.jsxs("span",{className:h.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[h.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:h.co2_einsparung_kg?`${h.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},h.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[s.gesamt_relevante_kosten.toLocaleString("de-DE")," €"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[s.gesamt_jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:s.gesamt_roi_prozent?`${s.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:s.gesamt_amortisation_jahre?`${s.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[s.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(ee,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatsächlichen Einsparungen können je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function $t({icon:t,title:r,value:a,subtitle:n,color:s,bgColor:l,formel:g,berechnung:d,ergebnis:i}){const o=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a});return e.jsx(W,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${l}`,children:e.jsx(t,{className:`h-6 w-6 ${s}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),g?e.jsx(Qe,{formel:g,berechnung:d,ergebnis:i,children:o}):o,n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n})]})]})})}const Rs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Pa=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#ef4444","#06b6d4"];function Hs(){var H;const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState(new Date().getFullYear()),[g,d]=c.useState(null),[i,o]=c.useState([]),[x,u]=c.useState([]),[p,f]=c.useState(!1),[k,S]=c.useState(!1),[_,j]=c.useState(null);c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{a&&C()},[a,s]);const C=async()=>{if(a){f(!0),j(null);try{const E=await vt.list(a);o(E);try{const v=await Ae.getStringMonatsdaten(a,s);u(v)}catch{u([])}const U=await Ve.getAktivePrognose(a);if(U)d({jahresertrag_kwh:U.jahresertrag_kwh,monatswerte:U.monatswerte,isLive:!1});else try{const v=await Ve.getPrognose(a);d({jahresertrag_kwh:v.jahresertrag_kwh,monatswerte:v.monatsdaten.map(L=>({monat:L.monat,e_m:L.e_m})),isLive:!0,module:v.module})}catch(v){d(null),v instanceof Error&&v.message.includes("PV-Module")&&j("Keine PV-Module für diese Anlage definiert. Bitte unter Einstellungen → Investitionen anlegen.")}}catch(E){j(E instanceof Error?E.message:"Fehler beim Laden")}finally{f(!1)}}},y=async()=>{if(a){S(!0);try{await Ve.speicherePrognose(a);const E=g==null?void 0:g.module;await C(),E&&E.length>0&&d(U=>U?{...U,module:E}:null)}catch(E){j(E instanceof Error?E.message:"Fehler beim Speichern")}finally{S(!1)}}},b=[...new Set(i.map(E=>E.jahr))].sort((E,U)=>U-E);c.useEffect(()=>{b.length>0&&!b.includes(s)&&l(b[0])},[b,s]);const m=[];if(g!=null&&g.monatswerte)for(let E=1;E<=12;E++){const U=((H=g.monatswerte.find(oe=>oe.monat===E))==null?void 0:H.e_m)||0,v=i.filter(oe=>oe.jahr===s&&oe.monat===E).reduce((oe,te)=>oe+(te.pv_erzeugung_kwh||0),0),L=v-U,X=U>0?L/U*100:0;m.push({monat:E,monatName:Rs[E],prognose:U,ist:v,abweichung:L,abweichungProzent:X})}const h=m.reduce((E,U)=>E+U.prognose,0),N=m.reduce((E,U)=>E+U.ist,0),M=N-h,A=h>0?M/h*100:0,w=12-m.filter(E=>E.ist===0).length,O=w>0?N/w*12:0;return r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Rr,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:E=>n(parseInt(E.target.value)),options:t.map(E=>({value:E.id.toString(),label:E.anlagenname}))}),b.length>0&&e.jsx(Ce,{value:s.toString(),onChange:E=>l(parseInt(E.target.value)),options:b.map(E=>({value:E.toString(),label:E.toString()}))}),e.jsx("button",{onClick:C,disabled:p,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Le,{className:`h-5 w-5 ${p?"animate-spin":""}`})})]})]}),_&&e.jsx(ee,{type:"error",children:_}),p?e.jsx(he,{text:"Lade Vergleichsdaten..."}):g?i.length===0?e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ze,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten für diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen → Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[g.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(J,{size:"sm",onClick:y,disabled:k,children:[e.jsx(Nt,{className:"h-4 w-4 mr-1"}),k?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(W,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[h.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",s]})]}),e.jsxs(W,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[N.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[w," von 12 Monaten"]})]}),e.jsxs(W,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[M>=0?e.jsx(ke,{className:"h-6 w-6 text-green-500"}):e.jsx(Aa,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${M>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[M>=0?"+":"",M.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${M>=0?"text-green-500":"text-red-500"}`,children:[M>=0?"+":"",A.toFixed(1),"%"]})]}),w<12&&w>0&&e.jsxs(W,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[O.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((O/h-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",s]}),e.jsx("div",{className:"h-80",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(kr,{data:m,children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"monatName"}),e.jsx(le,{yAxisId:"left",tickFormatter:E=>`${E} kWh`}),e.jsx(le,{yAxisId:"right",orientation:"right",tickFormatter:E=>`${E}%`}),e.jsx(Q,{formatter:(E,U)=>U==="Abweichung %"?`${E.toFixed(1)}%`:`${E.toFixed(0)} kWh`}),e.jsx(be,{}),e.jsx(jr,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(ne,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(ne,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(gt,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),g.module&&g.module.length>1&&e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ir,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"SOLL-IST Vergleich nach PV-Modul"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Vergleich der PVGIS-Prognose mit tatsächlichen Erträgen pro PV-Modul.",x.length===0&&e.jsx("span",{className:"text-yellow-600 ml-1",children:"(Keine String-Daten vorhanden - zeige nur Prognose)"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"PV-Modul"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ausrichtung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"SOLL (PVGIS)"}),e.jsxs("th",{className:"text-right py-2 px-2",children:["IST ",s]}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"})]})}),e.jsx("tbody",{children:g.module.map((E,U)=>{const v=x.filter(xe=>xe.investition_id===E.investition_id).reduce((xe,P)=>xe+P.pv_erzeugung_kwh,0),L=E.monatsdaten.reduce((xe,P)=>xe+P.e_m,0),X=v-L,oe=L>0?X/L*100:0,te=v>0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Pa[U%Pa.length]}}),e.jsx("span",{className:"font-medium",children:E.bezeichnung})]})}),e.jsx("td",{className:"text-right py-2 px-2",children:E.leistung_kwp.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:E.ausrichtung}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[L.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:te?e.jsxs("span",{className:"text-green-600",children:[v.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${X>=0?"text-green-600":"text-red-600"}`,children:te?`${X>=0?"+":""}${oe.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:te?oe>=-5?e.jsx(Je,{className:"h-5 w-5 text-green-500 mx-auto"}):oe>=-15?e.jsx("span",{className:"text-yellow-500",children:"⚠"}):e.jsx(Rt,{className:"h-5 w-5 text-red-500 mx-auto"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Keine Daten"})})]},E.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsx("td",{className:"text-right py-2 px-2",children:g.module.reduce((E,U)=>E+U.leistung_kwp,0).toFixed(1)}),e.jsx("td",{}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[h.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:x.length>0?x.reduce((E,U)=>E+U.pv_erzeugung_kwh,0).toLocaleString("de-DE",{maximumFractionDigits:0})+" kWh":"-"}),e.jsx("td",{colSpan:2})]})})]})}),x.length===0&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Tipp:"}),' Um IST-Daten pro PV-Modul zu sehen, weise jedem PV-Modul unter "Einstellungen → Investitionen" einen Home Assistant String-Sensor zu.']})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"})," Module mit deutlicher Unterperformance (<-15%) sollten auf Verschattung, Verschmutzung oder technische Probleme geprüft werden."]})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:m.map(E=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:E.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[E.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:E.ist>0?e.jsxs("span",{className:"text-green-600",children:[E.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${E.abweichung>=0?"text-green-600":"text-red-600"}`,children:E.ist>0?`${E.abweichung>=0?"+":""}${E.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${E.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:E.ist>0?`${E.abweichungProzent>=0?"+":""}${E.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:E.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):E.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(ke,{className:"h-4 w-4"}),"Übertroffen"]}):E.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):E.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(Aa,{className:"h-4 w-4"}),"Unter Plan"]})})]},E.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[h.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[N.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${M>=0?"text-green-600":"text-red-600"}`,children:[M>=0?"+":"",M.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${A>=0?"text-green-600":"text-red-600"}`,children:[A>=0?"+":"",A.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Übertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prüfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjährigen Mittelwerten. Einzelne Monate können stark abweichen."})]})]}):e.jsx(W,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(se,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfügbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen → Investitionen".'})]})})]})}function Va({anlage:t,onSubmit:r,onCancel:a}){var u,p,f;const[n,s]=c.useState(!1),[l,g]=c.useState(null),[d,i]=c.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((u=t==null?void 0:t.leistung_kwp)==null?void 0:u.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((p=t==null?void 0:t.latitude)==null?void 0:p.toString())||"",longitude:((f=t==null?void 0:t.longitude)==null?void 0:f.toString())||""}),o=k=>{const{name:S,value:_}=k.target;i(j=>({...j,[S]:_}))},x=async k=>{if(k.preventDefault(),g(null),!d.anlagenname.trim()){g("Bitte einen Namen eingeben");return}if(!d.leistung_kwp||parseFloat(d.leistung_kwp)<=0){g("Bitte eine gültige Leistung eingeben");return}try{s(!0),await r({anlagenname:d.anlagenname.trim(),leistung_kwp:parseFloat(d.leistung_kwp),installationsdatum:d.installationsdatum||void 0,standort_plz:d.standort_plz||void 0,standort_ort:d.standort_ort||void 0,standort_strasse:d.standort_strasse||void 0,latitude:d.latitude?parseFloat(d.latitude):void 0,longitude:d.longitude?parseFloat(d.longitude):void 0})}catch(S){g(S instanceof Error?S.message:"Fehler beim Speichern")}finally{s(!1)}};return e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[l&&e.jsx(ee,{type:"error",children:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Anlagenname",name:"anlagenname",value:d.anlagenname,onChange:o,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(R,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:d.leistung_kwp,onChange:o,placeholder:"z.B. 10.5",required:!0}),e.jsx(R,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:d.installationsdatum,onChange:o})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," gepflegt. So können auch Anlagen mit mehreren Dachflächen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"PLZ",name:"standort_plz",value:d.standort_plz,onChange:o,placeholder:"z.B. 12345"}),e.jsx(R,{label:"Ort",name:"standort_ort",value:d.standort_ort,onChange:o,placeholder:"z.B. Berlin"}),e.jsx(R,{label:"Straße",name:"standort_strasse",value:d.standort_strasse,onChange:o,placeholder:"z.B. Musterstraße 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(für PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:d.latitude,onChange:o,placeholder:"z.B. 52.520008",hint:"Nördliche Breite (positiv)"}),e.jsx(R,{label:"Längengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:d.longitude,onChange:o,placeholder:"z.B. 13.404954",hint:"Östliche Länge (positiv)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(J,{type:"button",variant:"secondary",onClick:a,children:"Abbrechen"}),e.jsx(J,{type:"submit",loading:n,children:t?"Speichern":"Anlage erstellen"})]})]})}const Gs={ev:Fe,wallbox:la,battery:ue,inverter:se},qs={evcc:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",sma:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",smart:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",wallbox:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"};function Js({device:t,selected:r,onToggle:a}){const n=Gs[t.device_type]||ar,s=qs[t.integration]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",l=!t.already_configured&&t.suggested_investition_typ;return e.jsxs("div",{className:`
        relative p-4 rounded-lg border-2 transition-all cursor-pointer
        ${r?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}
        ${t.already_configured?"opacity-60":""}
        ${l?"":"cursor-not-allowed"}
      `,onClick:()=>l&&a(),children:[l&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`
              w-5 h-5 rounded border-2 flex items-center justify-center
              ${r?"bg-amber-500 border-amber-500":"border-gray-300 dark:border-gray-600"}
            `,children:r&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),t.already_configured&&e.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:"Konfiguriert"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
          p-2 rounded-lg
          ${r?"bg-amber-100 dark:bg-amber-800/30":"bg-gray-100 dark:bg-gray-700"}
        `,children:e.jsx(n,{className:`w-6 h-6 ${r?"text-amber-600":"text-gray-600 dark:text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${s}`,children:t.integration.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.device_type==="ev"?"E-Auto":t.device_type==="wallbox"?"Wallbox":t.device_type==="battery"?"Speicher":t.device_type==="inverter"?"Wechselrichter":t.device_type}),t.confidence>=80&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[t.confidence,"% Konfidenz"]})]}),(t.manufacturer||t.model)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.manufacturer,t.model].filter(Boolean).join(" ")}),t.sensors.length>0&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:[t.sensors.length," Sensor",t.sensors.length!==1?"en":""," gefunden"]})]})]}),l&&Object.keys(t.suggested_parameters).length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Wird erstellt als:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.suggested_parameters.bezeichnung||t.name})]})]})}function kt({label:t,icon:r,suggestions:a,allSensors:n,showAll:s,value:l,onChange:g}){const d=s?n:a,i=d.length>0,o=a.length>0&&a[0].confidence>=70;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"p-2 rounded-lg bg-white dark:bg-gray-700 shadow-sm",children:e.jsx(r,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),e.jsxs("select",{value:l||"",onChange:x=>g(x.target.value||null),className:`
            w-full px-3 py-2 text-sm rounded-lg border
            bg-white dark:bg-gray-800
            border-gray-300 dark:border-gray-600
            text-gray-900 dark:text-white
            focus:ring-2 focus:ring-amber-500 focus:border-amber-500
            ${i?"":"opacity-50"}
          `,disabled:!i,children:[e.jsx("option",{value:"",children:i?"-- Nicht zugeordnet --":"-- Kein Sensor gefunden --"}),d.map(x=>e.jsxs("option",{value:x.entity_id,children:[x.friendly_name||x.entity_id,x.confidence>=80&&" ★"]},x.entity_id))]}),!s&&o&&!l&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["Empfehlung: ",a[0].friendly_name||a[0].entity_id]}),l&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:l})]})]})}function Us({suggestions:t,allEnergySensors:r,selectedMappings:a,onMappingChange:n,onApplyBest:s}){const[l,g]=c.useState(!1),d=t.pv_erzeugung.length+t.einspeisung.length+t.netzbezug.length+t.batterie_ladung.length+t.batterie_entladung.length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Sensor-Zuordnungen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Für Monatsdaten-Import aus Home Assistant"})]}),e.jsx("div",{className:"flex items-center gap-2",children:d>0&&!l&&e.jsx("button",{onClick:s,className:"text-xs px-3 py-1.5 rounded-lg bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:hover:bg-amber-900/50 transition-colors",children:"Beste übernehmen"})})]}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsxs("button",{onClick:()=>g(!1),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${l?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm"}`,children:["Empfohlen (",d,")"]}),e.jsxs("button",{onClick:()=>g(!0),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${l?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Alle (",r.length,")"]})]}),l&&e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg",children:"Zeigt alle Energy-Sensoren (kWh, total_increasing) für manuelle Zuordnung."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(kt,{label:"PV-Erzeugung",icon:se,field:"pv_erzeugung",suggestions:t.pv_erzeugung,allSensors:r,showAll:l,value:a.pv_erzeugung,onChange:i=>n("pv_erzeugung",i)}),e.jsx(kt,{label:"Einspeisung",icon:Ar,field:"einspeisung",suggestions:t.einspeisung,allSensors:r,showAll:l,value:a.einspeisung,onChange:i=>n("einspeisung",i)}),e.jsx(kt,{label:"Netzbezug",icon:Fr,field:"netzbezug",suggestions:t.netzbezug,allSensors:r,showAll:l,value:a.netzbezug,onChange:i=>n("netzbezug",i)}),e.jsx(kt,{label:"Batterie Ladung",icon:la,field:"batterie_ladung",suggestions:t.batterie_ladung,allSensors:r,showAll:l,value:a.batterie_ladung,onChange:i=>n("batterie_ladung",i)}),e.jsx(kt,{label:"Batterie Entladung",icon:ye,field:"batterie_entladung",suggestions:t.batterie_entladung,allSensors:r,showAll:l,value:a.batterie_entladung,onChange:i=>n("batterie_entladung",i)})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic",children:"Hinweis: Sensor-Zuordnungen werden in der Add-on-Konfiguration gespeichert. Änderungen hier dienen nur zur Vorschau."})]})}const Zs={ev:Fe,wallbox:la,battery:ue,inverter:se},Ys={"e-auto":"E-Auto",wallbox:"Wallbox",speicher:"Speicher",wechselrichter:"Wechselrichter"};function Qs({devicesToCreate:t,onConfirm:r,onBack:a,loading:n=!1}){return t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ze,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Geräte ausgewählt"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Bitte wähle mindestens ein Gerät aus, das als Investition angelegt werden soll."}),e.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Zurück zur Auswahl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Je,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Zusammenfassung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Folgende ",t.length," Investition",t.length!==1?"en":""," werden erstellt:"]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:t.map(s=>{const l=Zs[s.device_type]||ar,g=s.suggested_investition_typ?Ys[s.suggested_investition_typ]||s.suggested_investition_typ:"Unbekannt";return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(l,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.suggested_parameters.bezeichnung||s.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:g}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700",children:s.integration.toUpperCase()})]})]})]},s.id)})}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(ze,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{children:"Die Investitionen werden mit Standardwerten erstellt."}),e.jsx("p",{className:"mt-1",children:'Du kannst die Details später unter "Investitionen" anpassen.'})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,disabled:n,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Zurück"}),e.jsx("button",{onClick:r,disabled:n,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Erstelle..."})]}):e.jsx("span",{children:"Investitionen erstellen"})})]})]})}function gr({isOpen:t,onClose:r,anlageId:a,onInvestitionenCreated:n}){const{step:s,discoveryResult:l,selectedDevices:g,selectedMappings:d,error:i,startDiscovery:o,toggleDevice:x,selectAllDevices:u,deselectAllDevices:p,setMapping:f,applyBestMappings:k,goToStep:S,reset:_,devicesToCreate:j}=gs();c.useEffect(()=>{t&&s==="idle"&&o(a)},[t,s,a,o]);const C=()=>{_(),r()},y=async()=>{S("creating");try{for(const m of j){const h={anlage_id:a,typ:m.suggested_investition_typ,bezeichnung:m.suggested_parameters.bezeichnung||m.name,hersteller:m.suggested_parameters.hersteller||m.manufacturer||void 0,kaufdatum:new Date().toISOString().split("T")[0],kaufpreis:0,aktiv:!0};m.suggested_investition_typ==="e-auto"&&(h.batterie_kwh=m.suggested_parameters.batterie_kwh||void 0),await me.create(h)}S("done"),n==null||n()}catch{S("error")}},b=()=>{switch(s){case"scanning":return"Home Assistant durchsuchen...";case"results":return"Gefundene Geräte";case"confirmation":return"Bestätigung";case"creating":return"Erstelle Investitionen...";case"done":return"Fertig!";case"error":return"Fehler";default:return"Auto-Discovery"}};return e.jsxs($e,{isOpen:t,onClose:C,title:b(),size:"lg",children:[s==="scanning"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(Ye,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten..."})]}),s==="error"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(_t,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Verbindung fehlgeschlagen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:i||"Keine Verbindung zu Home Assistant möglich."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:C,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Schließen"}),e.jsx("button",{onClick:()=>o(a),className:"px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Erneut versuchen"})]})]}),s==="results"&&l&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:l.ha_connected?e.jsxs(e.Fragment,{children:[e.jsx(ga,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"})]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Nicht verbunden"})]})}),l.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:l.warnings.map((m,h)=>e.jsx("p",{children:m},h))})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["Gefundene Geräte (",l.devices.length,")"]}),l.devices.filter(m=>!m.already_configured&&m.suggested_investition_typ).length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Keine"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:u,className:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"Alle"})]})]}),l.devices.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Unterstützt: SMA, evcc, Smart, Wallbox"})]}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:l.devices.map(m=>e.jsx(Js,{device:m,selected:g.has(m.id),onToggle:()=>x(m.id)},m.id))})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsx(Us,{suggestions:l.sensor_mappings,allEnergySensors:l.all_energy_sensors,selectedMappings:d,onMappingChange:f,onApplyBest:k})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:C,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Abbrechen"}),e.jsxs("button",{onClick:()=>S("confirmation"),disabled:g.size===0,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter (",g.size," ausgewählt)"]})]})]}),s==="confirmation"&&e.jsx(Qs,{devicesToCreate:j,onConfirm:y,onBack:()=>S("results")}),s==="creating"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 mb-6",children:e.jsxs("svg",{className:"animate-spin w-16 h-16 text-amber-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Erstelle ",j.length," Investition",j.length!==1?"en":"","..."]})]}),s==="done"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(We,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Erfolgreich erstellt!"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:[j.length," Investition",j.length!==1?"en wurden":" wurde"," angelegt."]}),e.jsx("button",{onClick:C,className:"px-6 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Fertig"})]})]})}function Xs(){const{anlagen:t,loading:r,error:a,createAnlage:n,updateAnlage:s,deleteAnlage:l}=ve(),[g,d]=c.useState(!1),[i,o]=c.useState(null),[x,u]=c.useState(null),[p,f]=c.useState(null),k=async j=>{const C=await n(j);d(!1),f(C.id)},S=async j=>{i&&(await s(i.id,j),o(null))},_=async()=>{x&&(await l(x.id),u(null))};return r?e.jsx(he,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(J,{onClick:()=>d(!0),children:[e.jsx(nt,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),a&&e.jsx(ee,{type:"error",children:a}),t.length===0?e.jsx(W,{children:e.jsx(ut,{icon:se,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(J,{onClick:()=>d(!0),children:"Erste Anlage anlegen"})})}):e.jsx(W,{padding:"none",children:e.jsxs(ha,{children:[e.jsx(ma,{children:e.jsxs(mt,{children:[e.jsx(Ne,{children:"Name"}),e.jsx(Ne,{children:"Leistung"}),e.jsx(Ne,{children:"Standort"}),e.jsx(Ne,{children:"Ausrichtung"}),e.jsx(Ne,{children:"Installation"}),e.jsx(Ne,{className:"text-right",children:"Aktionen"})]})}),e.jsx(ua,{children:t.map(j=>e.jsxs(mt,{children:[e.jsx(_e,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:j.anlagenname})]})}),e.jsxs(_e,{children:[e.jsx("span",{className:"font-mono",children:j.leistung_kwp})," kWp"]}),e.jsx(_e,{children:j.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Tt,{className:"h-4 w-4"}),j.standort_plz," ",j.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(_e,{children:[j.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),j.neigung_grad&&` / ${j.neigung_grad}°`]}),e.jsx(_e,{children:j.installationsdatum?new Date(j.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(_e,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>f(j.id),title:"HA-Geräte erkennen",children:e.jsx(Ye,{className:"h-4 w-4 text-amber-500"})}),e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>o(j),children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>u(j),children:e.jsx(Xe,{className:"h-4 w-4 text-red-500"})})]})})]},j.id))})]})}),e.jsx($e,{isOpen:g,onClose:()=>d(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(Va,{onSubmit:k,onCancel:()=>d(!1)})}),e.jsx($e,{isOpen:!!i,onClose:()=>o(null),title:"Anlage bearbeiten",size:"lg",children:i&&e.jsx(Va,{anlage:i,onSubmit:S,onCancel:()=>o(null)})}),e.jsx($e,{isOpen:!!x,onClose:()=>u(null),title:"Anlage löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Anlage ",e.jsxs("strong",{children:['"',x==null?void 0:x.anlagenname,'"']})," wirklich löschen?"]}),e.jsx(ee,{type:"warning",children:"Alle zugehörigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelöscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(J,{variant:"secondary",onClick:()=>u(null),children:"Abbrechen"}),e.jsx(J,{variant:"danger",onClick:_,children:"Löschen"})]})]})}),p&&e.jsx(gr,{isOpen:!0,onClose:()=>f(null),anlageId:p})]})}function en(){var M;const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(null),s=a??((M=t[0])==null?void 0:M.id),{strompreise:l,loading:g,error:d,createStrompreis:i,updateStrompreis:o,deleteStrompreis:x}=os(s),[u,p]=c.useState(!1),[f,k]=c.useState(null),[S,_]=c.useState(null),[j,C]=c.useState(null),y=async A=>{try{C(null),await i(A),p(!1)}catch(K){C(K instanceof Error?K.message:"Fehler beim Erstellen")}},b=async A=>{if(f)try{C(null),await o(f.id,A),k(null)}catch(K){C(K instanceof Error?K.message:"Fehler beim Aktualisieren")}},m=async()=>{if(S)try{await x(S.id),_(null)}catch(A){C(A instanceof Error?A.message:"Fehler beim Löschen")}},h=A=>{const K=new Date().toISOString().split("T")[0],w=A.gueltig_ab<=K,O=!A.gueltig_bis||A.gueltig_bis>=K;return w&&O};if(r||g)return e.jsx(he,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(ee,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const N=[...l].sort((A,K)=>{const w=h(A),O=h(K);return w!==O?w?-1:1:K.gueltig_ab.localeCompare(A.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:s??"",onChange:A=>n(Number(A.target.value)),className:"input w-auto",children:t.map(A=>e.jsx("option",{value:A.id,children:A.anlagenname},A.id))}),e.jsxs(J,{onClick:()=>p(!0),children:[e.jsx(nt,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),d&&e.jsx(ee,{type:"error",children:d}),N.length>0&&h(N[0])&&e.jsx(W,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(rt,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",N[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[N[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," · ","Einspeisung: ",e.jsxs("strong",{children:[N[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),N[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" · Grundpreis: ",e.jsxs("strong",{children:[N[0].grundpreis_euro_monat.toFixed(2)," €/Monat"]})]})]})]})]})}),l.length===0?e.jsx(W,{children:e.jsx(ut,{icon:ue,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(J,{onClick:()=>p(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(W,{padding:"none",children:e.jsxs(ha,{children:[e.jsx(ma,{children:e.jsxs(mt,{children:[e.jsx(Ne,{children:"Tarif"}),e.jsx(Ne,{children:"Netzbezug"}),e.jsx(Ne,{children:"Einspeisung"}),e.jsx(Ne,{children:"Grundpreis"}),e.jsx(Ne,{children:"Gültigkeit"}),e.jsx(Ne,{className:"text-right",children:"Aktionen"})]})}),e.jsx(ua,{children:N.map(A=>{const K=h(A);return e.jsxs(mt,{className:K?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(_e,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:`h-5 w-5 ${K?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:A.tarifname||"Standard"}),K&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),A.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:A.anbieter})]})]})}),e.jsxs(_e,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:A.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(_e,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:A.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(_e,{children:A.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:A.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" €/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(_e,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(bt,{className:"h-4 w-4"}),new Date(A.gueltig_ab).toLocaleDateString("de-DE"),A.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(A.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(_e,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>k(A),children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>_(A),children:e.jsx(Xe,{className:"h-4 w-4 text-red-500"})})]})})]},A.id)})})]})}),e.jsxs(W,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gültige Tarif wird automatisch für Berechnungen verwendet"}),e.jsx("li",{children:"Für historische Auswertungen werden die zum jeweiligen Zeitpunkt gültigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gültigkeitszeitraum korrekt setzen"})]})]}),e.jsx($e,{isOpen:u,onClose:()=>{p(!1),C(null)},title:"Neuen Tarif anlegen",size:"lg",children:s&&e.jsx(Ba,{anlageId:s,onCreate:y,onCancel:()=>{p(!1),C(null)},error:j})}),e.jsx($e,{isOpen:!!f,onClose:()=>{k(null),C(null)},title:"Tarif bearbeiten",size:"lg",children:f&&e.jsx(Ba,{strompreis:f,anlageId:f.anlage_id,onUpdate:b,onCancel:()=>{k(null),C(null)},error:j})}),e.jsx($e,{isOpen:!!S,onClose:()=>_(null),title:"Tarif löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du den Tarif ",e.jsxs("strong",{children:['"',(S==null?void 0:S.tarifname)||"Standard",'"']})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(J,{variant:"secondary",onClick:()=>_(null),children:"Abbrechen"}),e.jsx(J,{variant:"danger",onClick:m,children:"Löschen"})]})]})})]})}function Ba({strompreis:t,anlageId:r,onCreate:a,onUpdate:n,onCancel:s,error:l}){var p,f,k;const[g,d]=c.useState(!1),[i,o]=c.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((p=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:p.toString())||"30",einspeiseverguetung_cent_kwh:((f=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:f.toString())||"8.2",grundpreis_euro_monat:((k=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:k.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||""}),x=S=>{const{name:_,value:j}=S.target;o(C=>({...C,[_]:j}))},u=async S=>{S.preventDefault(),d(!0);try{const _={netzbezug_arbeitspreis_cent_kwh:parseFloat(i.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(i.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:i.grundpreis_euro_monat?parseFloat(i.grundpreis_euro_monat):void 0,gueltig_ab:i.gueltig_ab,gueltig_bis:i.gueltig_bis||void 0,tarifname:i.tarifname||void 0,anbieter:i.anbieter||void 0,vertragsart:i.vertragsart||void 0};t&&n?await n(_):a&&await a({..._,anlage_id:r})}finally{d(!1)}};return e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[l&&e.jsx(ee,{type:"error",children:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Tarifname",name:"tarifname",value:i.tarifname,onChange:x,placeholder:"z.B. Grundversorgung, Öko-Strom"}),e.jsx(R,{label:"Anbieter",name:"anbieter",value:i.anbieter,onChange:x,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:i.netzbezug_arbeitspreis_cent_kwh,onChange:x,required:!0,hint:"Arbeitspreis für Strombezug"}),e.jsx(R,{label:"Einspeisevergütung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:i.einspeiseverguetung_cent_kwh,onChange:x,required:!0,hint:"EEG-Vergütung oder PPA-Preis"}),e.jsx(R,{label:"Grundpreis (€/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:i.grundpreis_euro_monat,onChange:x,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gültigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Gültig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:i.gueltig_ab,onChange:x,required:!0}),e.jsx(R,{label:"Gültig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:i.gueltig_bis,onChange:x,hint:"Leer lassen für unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:i.vertragsart,onChange:x,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte wählen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"Ökostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(J,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(J,{type:"submit",loading:g,children:t?"Speichern":"Anlegen"})]})]})}const tn={"pv-module":"wechselrichter",speicher:"wechselrichter"},an=["pv-module"],Dt={wechselrichter:"Wechselrichter"},Yt={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},rn={"e-auto":"Kosten eines vergleichbaren Verbrenners (für ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/Ölheizung (für ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function sn({investition:t,anlageId:r,typ:a,onSubmit:n,onCancel:s}){var w,O,H,E,U,v;const[l,g]=c.useState(!1),[d,i]=c.useState(null),[o,x]=c.useState([]),[u,p]=c.useState(!1),[f,k]=c.useState([]),[S,_]=c.useState(!1),[j,C]=c.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${Yt[a]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((w=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:w.toString())||"",anschaffungskosten_alternativ:((O=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:O.toString())||"",betriebskosten_jahr:((H=t==null?void 0:t.betriebskosten_jahr)==null?void 0:H.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,parent_investition_id:((E=t==null?void 0:t.parent_investition_id)==null?void 0:E.toString())||"",leistung_kwp:((U=t==null?void 0:t.leistung_kwp)==null?void 0:U.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"Süd",neigung_grad:((v=t==null?void 0:t.neigung_grad)==null?void 0:v.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""}),y=tn[a],b=an.includes(a);c.useEffect(()=>{y&&(_(!0),me.list(r,y,!0).then(L=>k(L.filter(X=>X.id!==(t==null?void 0:t.id)))).catch(()=>k([])).finally(()=>_(!1)))},[y,r,t==null?void 0:t.id]),c.useEffect(()=>{a==="pv-module"&&(p(!0),Ae.getStringSensors().then(x).catch(()=>x([])).finally(()=>p(!1)))},[a]);const m=(t==null?void 0:t.parameter)||{},h=()=>{var L,X,oe,te,xe,P,T,z,D,G,Z,F,q,Pe,Et,Ft,At,Ct,I,ge,ae,it,ja,fa,va,wa,Na,_a,za,Sa;switch(a){case"e-auto":return{batteriekapazitaet_kwh:((L=m.batteriekapazitaet_kwh)==null?void 0:L.toString())||"",verbrauch_kwh_100km:((X=m.verbrauch_kwh_100km)==null?void 0:X.toString())||"18",jahresfahrleistung_km:((oe=m.jahresfahrleistung_km)==null?void 0:oe.toString())||"15000",pv_ladeanteil_prozent:((te=m.pv_ladeanteil_prozent)==null?void 0:te.toString())||"60",vergleich_verbrauch_l_100km:((xe=m.vergleich_verbrauch_l_100km)==null?void 0:xe.toString())||"7.5",benzinpreis_euro:((P=m.benzinpreis_euro)==null?void 0:P.toString())||"1.65",v2h_faehig:m.v2h_faehig??!1,v2h_entladeleistung_kw:((T=m.v2h_entladeleistung_kw)==null?void 0:T.toString())||""};case"speicher":return{kapazitaet_kwh:((z=m.kapazitaet_kwh)==null?void 0:z.toString())||"",nutzbare_kapazitaet_kwh:((D=m.nutzbare_kapazitaet_kwh)==null?void 0:D.toString())||"",max_ladeleistung_kw:((G=m.max_ladeleistung_kw)==null?void 0:G.toString())||"",max_entladeleistung_kw:((Z=m.max_entladeleistung_kw)==null?void 0:Z.toString())||"",wirkungsgrad_prozent:((F=m.wirkungsgrad_prozent)==null?void 0:F.toString())||"95",arbitrage_faehig:m.arbitrage_faehig??!1};case"waermepumpe":return{leistung_kw:((q=m.leistung_kw)==null?void 0:q.toString())||"",cop:((Pe=m.cop)==null?void 0:Pe.toString())||"3.5",jahresarbeitszahl:((Et=m.jahresarbeitszahl)==null?void 0:Et.toString())||"3.0",heizwaermebedarf_kwh:((Ft=m.heizwaermebedarf_kwh)==null?void 0:Ft.toString())||"",warmwasserbedarf_kwh:((At=m.warmwasserbedarf_kwh)==null?void 0:At.toString())||"",sg_ready:m.sg_ready??!1};case"wallbox":return{max_ladeleistung_kw:((Ct=m.max_ladeleistung_kw)==null?void 0:Ct.toString())||"11",bidirektional:m.bidirektional??!1,pv_optimiert:m.pv_optimiert??!0};case"wechselrichter":return{max_leistung_kw:((I=m.max_leistung_kw)==null?void 0:I.toString())||"",wirkungsgrad_prozent:((ge=m.wirkungsgrad_prozent)==null?void 0:ge.toString())||"97",hybrid:m.hybrid??!1};case"pv-module":return{anzahl_module:((ae=m.anzahl_module)==null?void 0:ae.toString())||"",modul_leistung_wp:((it=m.modul_leistung_wp)==null?void 0:it.toString())||"",modul_typ:((ja=m.modul_typ)==null?void 0:ja.toString())||""};case"balkonkraftwerk":return{leistung_wp:((fa=m.leistung_wp)==null?void 0:fa.toString())||"",anzahl:((va=m.anzahl)==null?void 0:va.toString())||"2",ausrichtung:((wa=m.ausrichtung)==null?void 0:wa.toString())||"Süd",neigung_grad:((Na=m.neigung_grad)==null?void 0:Na.toString())||"30",hat_speicher:m.hat_speicher??!1,speicher_kapazitaet_wh:((_a=m.speicher_kapazitaet_wh)==null?void 0:_a.toString())||""};case"sonstiges":return{kategorie:((za=m.kategorie)==null?void 0:za.toString())||"erzeuger",beschreibung:((Sa=m.beschreibung)==null?void 0:Sa.toString())||""};default:return{}}},[N,M]=c.useState(h),A=L=>{const{name:X,value:oe,type:te,checked:xe}=L.target;if(X.startsWith("param_")){const P=X.replace("param_","");M(T=>({...T,[P]:te==="checkbox"?xe:oe}))}else C(P=>({...P,[X]:te==="checkbox"?xe:oe}))},K=async L=>{if(L.preventDefault(),i(null),!j.bezeichnung.trim()){i("Bitte eine Bezeichnung eingeben");return}try{g(!0);const X={};if(Object.entries(N).forEach(([T,z])=>{if(typeof z=="boolean")X[T]=z;else if(z!==""){const D=parseFloat(z);X[T]=isNaN(D)?z:D}}),b&&f.length>0&&!j.parent_investition_id){i(`${Yt[a]} müssen einem ${Dt[y]||y} zugeordnet werden`);return}let oe,te,xe;if(a==="balkonkraftwerk"){const T=parseInt(N.anzahl)||0,z=parseInt(N.leistung_wp)||0;T>0&&z>0&&(oe=T*z/1e3),te=N.ausrichtung||void 0,xe=N.neigung_grad?parseFloat(N.neigung_grad):void 0}const P={...t?{}:{anlage_id:r,typ:a},bezeichnung:j.bezeichnung.trim(),anschaffungsdatum:j.anschaffungsdatum||void 0,anschaffungskosten_gesamt:j.anschaffungskosten_gesamt?parseFloat(j.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:j.anschaffungskosten_alternativ?parseFloat(j.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:j.betriebskosten_jahr?parseFloat(j.betriebskosten_jahr):void 0,aktiv:j.aktiv,parameter:Object.keys(X).length>0?X:void 0,parent_investition_id:j.parent_investition_id?parseInt(j.parent_investition_id):void 0,...a==="pv-module"&&{leistung_kwp:j.leistung_kwp?parseFloat(j.leistung_kwp):void 0,ausrichtung:j.ausrichtung||void 0,neigung_grad:j.neigung_grad?parseFloat(j.neigung_grad):void 0,ha_entity_id:j.ha_entity_id||void 0},...a==="balkonkraftwerk"&&{leistung_kwp:oe,ausrichtung:te,neigung_grad:xe}};await n(P)}catch(X){i(X instanceof Error?X.message:"Fehler beim Speichern")}finally{g(!1)}};return e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[d&&e.jsx(ee,{type:"error",children:d}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Bezeichnung",name:"bezeichnung",value:j.bezeichnung,onChange:A,required:!0}),e.jsx(R,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:j.anschaffungsdatum,onChange:A}),e.jsx(R,{label:"Anschaffungskosten (€)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:j.anschaffungskosten_gesamt,onChange:A,hint:"Gesamtkosten inkl. Installation"}),e.jsx(R,{label:"Alternative Kosten (€)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:j.anschaffungskosten_alternativ,onChange:A,hint:rn[a]}),e.jsx(R,{label:"Betriebskosten/Jahr (€)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:j.betriebskosten_jahr,onChange:A,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:j.aktiv,onChange:A,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen berücksichtigen)"})]})]}),y&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",Dt[y]||y,")",b?" *":" (optional)",S&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),f.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:j.parent_investition_id,onChange:L=>C(X=>({...X,parent_investition_id:L.target.value})),className:`input w-full ${b&&!j.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:b,children:[e.jsx("option",{value:"",children:b?"-- Bitte wählen --":"-- Keine Zuordnung --"}),f.map(L=>e.jsx("option",{value:L.id,children:L.bezeichnung},L.id))]}),b&&!j.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),a==="pv-module"?"PV-Module müssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):S?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 flex-shrink-0"}),b?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:Dt[y]||y})," an, bevor Sie ",Yt[a]," erstellen können."]}):e.jsxs("span",{children:["Kein ",Dt[y]||y," vorhanden. Zuordnung ist optional."]})]})})]})]}),a==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:j.leistung_kwp,onChange:A,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:j.ausrichtung,onChange:L=>C(X=>({...X,ausrichtung:L.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(R,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:j.neigung_grad,onChange:A,hint:"0° = flach, 90° = senkrecht"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Home Assistant Sensor",u&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),e.jsxs("select",{name:"ha_entity_id",value:j.ha_entity_id,onChange:L=>C(X=>({...X,ha_entity_id:L.target.value})),className:"input w-full",children:[e.jsx("option",{value:"",children:"Kein Sensor (manuell)"}),o.map(L=>e.jsxs("option",{value:L.entity_id,children:[L.friendly_name||L.entity_id,L.state&&` (${L.state} ${L.unit_of_measurement||""})`]},L.entity_id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Verknüpfe dieses PV-Modul mit einem String-Sensor für automatische IST-Daten"})]})]})]}),e.jsx(nn,{typ:a,paramData:N,onChange:A}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(J,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(J,{type:"submit",loading:l,children:t?"Speichern":"Erstellen"})]})]})}function nn({typ:t,paramData:r,onChange:a}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Batteriekapazität (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.batteriekapazitaet_kwh,onChange:a}),e.jsx(R,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:r.verbrauch_kwh_100km,onChange:a}),e.jsx(R,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:r.jahresfahrleistung_km,onChange:a}),e.jsx(R,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_ladeanteil_prozent,onChange:a,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:r.vergleich_verbrauch_l_100km,onChange:a,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(R,{label:"Benzinpreis (€/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:r.benzinpreis_euro,onChange:a,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:r.v2h_faehig,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fähig (Vehicle-to-Home)"})]}),r.v2h_faehig&&e.jsx(R,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.v2h_entladeleistung_kw,onChange:a})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Kapazität (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.kapazitaet_kwh,onChange:a}),e.jsx(R,{label:"Nutzbare Kapazität (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.nutzbare_kapazitaet_kwh,onChange:a,hint:"Typisch 90-95% der Gesamtkapazität"}),e.jsx(R,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:a}),e.jsx(R,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_entladeleistung_kw,onChange:a}),e.jsx(R,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:r.arbitrage_faehig,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fähig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wärmepumpe Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:r.leistung_kw,onChange:a}),e.jsx(R,{label:"COP (Leistungszahl)",name:"param_cop",type:"number",step:"0.1",min:"1",max:"10",value:r.cop,onChange:a,hint:"Typisch 3-5 bei Luft-WP"}),e.jsx(R,{label:"Jahresarbeitszahl",name:"param_jahresarbeitszahl",type:"number",step:"0.1",min:"1",max:"10",value:r.jahresarbeitszahl,onChange:a}),e.jsx(R,{label:"Heizwärmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:r.heizwaermebedarf_kwh,onChange:a}),e.jsx(R,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:r.warmwasserbedarf_kwh,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:r.sg_ready,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fähig)"})]})]});case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(R,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:a,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:r.bidirektional,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:r.pv_optimiert,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-Überschussladen möglich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:r.max_leistung_kw,onChange:a}),e.jsx(R,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:a})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:r.hybrid,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:r.anzahl_module,onChange:a,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(R,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:r.modul_leistung_wp,onChange:a,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(R,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:r.modul_typ,onChange:a,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),r.anzahl_module&&r.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(r.anzahl_module)||0)*(parseInt(r.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const n=(parseInt(r.anzahl)||0)*(parseInt(r.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:r.anzahl,onChange:a}),e.jsx(R,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:r.leistung_wp,onChange:a,hint:n>0?`= ${n.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:r.ausrichtung,onChange:s=>a({target:{name:"param_ausrichtung",value:s.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(R,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:r.neigung_grad,onChange:a,hint:"0° = flach, 90° = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:r.hat_speicher,onChange:a,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),r.hat_speicher&&e.jsx(R,{label:"Speicher-Kapazität (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:r.speicher_kapazitaet_wh,onChange:a,hint:"z.B. 1600 Wh für Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:r.kategorie,onChange:s=>a({target:{name:"param_kategorie",value:s.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(R,{label:"Beschreibung",name:"param_beschreibung",value:r.beschreibung,onChange:a,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const Qt=[{typ:"e-auto",label:"E-Auto",icon:Fe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wärmepumpe",icon:De,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:ye,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:Re,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:ht,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:se,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:Qa,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:ht,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function ln(){var K;const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(null),[s,l]=c.useState(!1),[g,d]=c.useState(null),[i,o]=c.useState(null),[x,u]=c.useState(null),[p,f]=c.useState(null),k=a??((K=t[0])==null?void 0:K.id),{investitionen:S,loading:_,createInvestition:j,updateInvestition:C,deleteInvestition:y}=zt(k),b=cs(S),m=c.useMemo(()=>{const w={};return Qt.forEach(O=>{var H;w[O.typ]=((H=b[O.typ])==null?void 0:H.length)||0}),w},[b]),h=w=>{o(w),d(null),l(!0)},N=w=>{d(w),o(w.typ),l(!0)},M=async w=>{try{g?await C(g.id,w):await j(w),l(!1),d(null),o(null)}catch(O){f(O instanceof Error?O.message:"Fehler beim Speichern")}},A=async()=>{if(x)try{await y(x.id),u(null)}catch(w){f(w instanceof Error?w.message:"Fehler beim Löschen")}};return r||_?e.jsx(he,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(ee,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:k??"",onChange:w=>n(Number(w.target.value)),className:"input w-auto",children:t.map(w=>e.jsx("option",{value:w.id,children:w.anlagenname},w.id))})})]}),p&&e.jsx(ee,{type:"error",onClose:()=>f(null),children:p}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Qt.map(w=>e.jsxs("button",{onClick:()=>h(w.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${w.bgColor}`,children:[e.jsx(w.icon,{className:`h-8 w-8 mx-auto ${w.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:w.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[m[w.typ]," vorhanden"]})]},w.typ))}),S.length===0?e.jsx(ut,{icon:xt,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wärmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(J,{onClick:()=>h("speicher"),children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:Qt.map(w=>{const O=b[w.typ];return!O||O.length===0?null:e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${w.bgColor}`,children:e.jsx(w.icon,{className:`h-5 w-5 ${w.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:w.label})]}),e.jsx(J,{variant:"secondary",size:"sm",onClick:()=>h(w.typ),children:e.jsx(nt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:O.map(H=>e.jsx(dn,{investition:H,onEdit:()=>N(H),onDelete:()=>u(H)},H.id))})]},w.typ)})}),e.jsx($e,{isOpen:s,onClose:()=>{l(!1),d(null),o(null)},title:g?"Investition bearbeiten":"Neue Investition",size:"lg",children:i&&k&&e.jsx(sn,{investition:g,anlageId:k,typ:i,onSubmit:M,onCancel:()=>{l(!1),d(null),o(null)}})}),e.jsxs($e,{isOpen:!!x,onClose:()=>u(null),title:"Investition löschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Möchtest du die Investition "',x==null?void 0:x.bezeichnung,'" wirklich löschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(J,{variant:"secondary",onClick:()=>u(null),children:"Abbrechen"}),e.jsx(J,{variant:"danger",onClick:A,children:"Löschen"})]})]})]})}function dn({investition:t,onEdit:r,onDelete:a}){const n=t.parameter||{},l=(()=>{const d=[];switch(t.typ){case"e-auto":n.batteriekapazitaet_kwh&&d.push(`${n.batteriekapazitaet_kwh} kWh Batterie`),n.verbrauch_kwh_100km&&d.push(`${n.verbrauch_kwh_100km} kWh/100km`),n.v2h_faehig&&d.push("V2H fähig");break;case"speicher":n.kapazitaet_kwh&&d.push(`${n.kapazitaet_kwh} kWh`),n.nutzbare_kapazitaet_kwh&&d.push(`${n.nutzbare_kapazitaet_kwh} kWh nutzbar`),n.arbitrage_faehig&&d.push("Arbitrage");break;case"waermepumpe":n.leistung_kw&&d.push(`${n.leistung_kw} kW`),n.cop&&d.push(`COP ${n.cop}`);break;case"wallbox":n.max_ladeleistung_kw&&d.push(`${n.max_ladeleistung_kw} kW`),n.bidirektional&&d.push("Bidirektional");break;case"wechselrichter":n.max_leistung_kw&&d.push(`${n.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":n.leistung_wp&&d.push(`${n.leistung_wp} Wp`),n.anzahl&&d.push(`${n.anzahl} Module`);break}return d})(),g=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[l.length>0&&e.jsx("span",{children:l.join(" • ")}),g&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[g.toLocaleString("de-DE")," €"]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(Kr,{className:"h-4 w-4"})}),e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Löschen",children:e.jsx(Xe,{className:"h-4 w-4"})})]})]})}const cn=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"März"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function Ka({monatsdaten:t,anlageId:r,onSubmit:a,onCancel:n}){var U,v,L,X,oe,te,xe;const s=new Date().getFullYear(),l=new Date().getMonth()+1,[g,d]=c.useState(!1),[i,o]=c.useState(null),{investitionen:x,loading:u}=zt(r),p=c.useMemo(()=>x.filter(P=>P.aktiv),[x]),f=p.some(P=>P.typ==="speicher"),k=p.some(P=>P.typ==="e-auto"),S=p.some(P=>P.typ==="wallbox"),_=p.some(P=>P.typ==="waermepumpe"),j=p.some(P=>P.typ==="wechselrichter"),C=p.some(P=>P.typ==="pv-module"),y=p.some(P=>P.typ==="balkonkraftwerk"),b=p.some(P=>P.typ==="sonstiges"),[m,h]=c.useState({jahr:((U=t==null?void 0:t.jahr)==null?void 0:U.toString())||s.toString(),monat:((v=t==null?void 0:t.monat)==null?void 0:v.toString())||l.toString(),einspeisung_kwh:((L=t==null?void 0:t.einspeisung_kwh)==null?void 0:L.toString())||"",netzbezug_kwh:((X=t==null?void 0:t.netzbezug_kwh)==null?void 0:X.toString())||"",pv_erzeugung_kwh:((oe=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:oe.toString())||"",batterie_ladung_kwh:((te=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:te.toString())||"",batterie_entladung_kwh:((xe=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:xe.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[N,M]=c.useState({}),[A,K]=c.useState(!1);c.useEffect(()=>{if(p.length===0)return;(async()=>{const T={};if(p.forEach(z=>{var D,G;if(z.typ==="e-auto")T[z.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(z.typ==="speicher")T[z.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(z.typ==="wallbox")T[z.id]={ladung_kwh:"",ladevorgaenge:""};else if(z.typ==="waermepumpe")T[z.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(z.typ==="wechselrichter")T[z.id]={pv_erzeugung_kwh:""};else if(z.typ==="pv-module")T[z.id]={pv_erzeugung_kwh:""};else if(z.typ==="balkonkraftwerk"){const Z=(D=z.parameter)==null?void 0:D.hat_speicher,F={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};Z?T[z.id]={...F,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:T[z.id]=F}else if(z.typ==="sonstiges"){const Z=((G=z.parameter)==null?void 0:G.kategorie)||"erzeuger";Z==="erzeuger"?T[z.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:Z==="verbraucher"?T[z.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:Z==="speicher"&&(T[z.id]={ladung_kwh:"",entladung_kwh:""})}T[z.id]&&(T[z.id].sonderkosten_euro="",T[z.id].sonderkosten_notiz="")}),t!=null&&t.jahr&&(t!=null&&t.monat)){K(!0);try{(await me.getMonatsdatenByMonth(r,t.jahr,t.monat)).forEach(D=>{const G=String(D.investition_id);T[G]&&D.verbrauch_daten&&Object.entries(D.verbrauch_daten).forEach(([Z,F])=>{T[G][Z]!==void 0&&(T[G][Z]=(F==null?void 0:F.toString())||""),Z==="v2h_entladung_kwh"&&T[G].entladung_v2h_kwh!==void 0&&(T[G].entladung_v2h_kwh=(F==null?void 0:F.toString())||""),Z==="erzeugung_kwh"&&T[G].pv_erzeugung_kwh!==void 0&&(T[G].pv_erzeugung_kwh=(F==null?void 0:F.toString())||""),Z==="verbrauch_kwh"&&T[G].verbrauch_sonstig_kwh!==void 0&&(T[G].verbrauch_sonstig_kwh=(F==null?void 0:F.toString())||"")})})}catch(z){console.error("Fehler beim Laden der InvestitionMonatsdaten:",z)}finally{K(!1)}}M(T)})()},[p,t==null?void 0:t.jahr,t==null?void 0:t.monat,r]);const w=P=>{const{name:T,value:z}=P.target;h(D=>({...D,[T]:z}))},O=(P,T,z)=>{M(D=>({...D,[P]:{...D[P],[T]:z}}))},H=c.useMemo(()=>{let P=0,T=0,z=0;return p.forEach(D=>{var Z,F;const G=N[D.id];G&&(D.typ==="speicher"?(P+=parseFloat(G.ladung_kwh)||0,T+=parseFloat(G.entladung_kwh)||0):D.typ==="pv-module"||D.typ==="wechselrichter"||D.typ==="balkonkraftwerk"?(z+=parseFloat(G.pv_erzeugung_kwh)||0,D.typ==="balkonkraftwerk"&&((Z=D.parameter)!=null&&Z.hat_speicher)&&(P+=parseFloat(G.speicher_ladung_kwh)||0,T+=parseFloat(G.speicher_entladung_kwh)||0)):D.typ==="sonstiges"&&((F=D.parameter)==null?void 0:F.kategorie)==="erzeuger"&&(z+=parseFloat(G.erzeugung_kwh)||0))}),{batterieLadung:P,batterieEntladung:T,pvErzeugung:z}},[p,N]),E=async P=>{if(P.preventDefault(),o(null),!m.einspeisung_kwh||!m.netzbezug_kwh){o("Bitte Einspeisung und Netzbezug eingeben");return}try{d(!0);const T={};p.forEach(Z=>{const F=N[Z.id];if(!F)return;const q={};Z.typ==="e-auto"?(F.km_gefahren&&(q.km_gefahren=parseFloat(F.km_gefahren)),F.verbrauch_kwh&&(q.verbrauch_kwh=parseFloat(F.verbrauch_kwh)),F.ladung_pv_kwh&&(q.ladung_pv_kwh=parseFloat(F.ladung_pv_kwh)),F.ladung_netz_kwh&&(q.ladung_netz_kwh=parseFloat(F.ladung_netz_kwh)),F.ladung_extern_kwh&&(q.ladung_extern_kwh=parseFloat(F.ladung_extern_kwh)),F.ladung_extern_euro&&(q.ladung_extern_euro=parseFloat(F.ladung_extern_euro)),F.entladung_v2h_kwh&&(q.v2h_entladung_kwh=parseFloat(F.entladung_v2h_kwh))):Z.typ==="speicher"?(F.ladung_kwh&&(q.ladung_kwh=parseFloat(F.ladung_kwh)),F.entladung_kwh&&(q.entladung_kwh=parseFloat(F.entladung_kwh)),F.speicher_ladung_netz_kwh&&(q.speicher_ladung_netz_kwh=parseFloat(F.speicher_ladung_netz_kwh)),F.speicher_ladepreis_cent&&(q.speicher_ladepreis_cent=parseFloat(F.speicher_ladepreis_cent))):Z.typ==="wallbox"?(F.ladung_kwh&&(q.ladung_kwh=parseFloat(F.ladung_kwh)),F.ladevorgaenge&&(q.ladevorgaenge=parseInt(F.ladevorgaenge))):Z.typ==="waermepumpe"?(F.stromverbrauch_kwh&&(q.stromverbrauch_kwh=parseFloat(F.stromverbrauch_kwh)),F.heizenergie_kwh&&(q.heizenergie_kwh=parseFloat(F.heizenergie_kwh)),F.warmwasser_kwh&&(q.warmwasser_kwh=parseFloat(F.warmwasser_kwh))):Z.typ==="wechselrichter"||Z.typ==="pv-module"?F.pv_erzeugung_kwh&&(q.pv_erzeugung_kwh=parseFloat(F.pv_erzeugung_kwh)):Z.typ==="balkonkraftwerk"?(F.pv_erzeugung_kwh&&(q.erzeugung_kwh=parseFloat(F.pv_erzeugung_kwh)),F.eigenverbrauch_kwh&&(q.eigenverbrauch_kwh=parseFloat(F.eigenverbrauch_kwh)),F.einspeisung_kwh&&(q.einspeisung_kwh=parseFloat(F.einspeisung_kwh)),F.speicher_ladung_kwh&&(q.speicher_ladung_kwh=parseFloat(F.speicher_ladung_kwh)),F.speicher_entladung_kwh&&(q.speicher_entladung_kwh=parseFloat(F.speicher_entladung_kwh))):Z.typ==="sonstiges"&&(F.erzeugung_kwh&&(q.erzeugung_kwh=parseFloat(F.erzeugung_kwh)),F.eigenverbrauch_kwh&&(q.eigenverbrauch_kwh=parseFloat(F.eigenverbrauch_kwh)),F.einspeisung_kwh&&(q.einspeisung_kwh=parseFloat(F.einspeisung_kwh)),F.verbrauch_sonstig_kwh&&(q.verbrauch_kwh=parseFloat(F.verbrauch_sonstig_kwh)),F.bezug_pv_kwh&&(q.bezug_pv_kwh=parseFloat(F.bezug_pv_kwh)),F.bezug_netz_kwh&&(q.bezug_netz_kwh=parseFloat(F.bezug_netz_kwh)),F.ladung_kwh&&(q.ladung_kwh=parseFloat(F.ladung_kwh)),F.entladung_kwh&&(q.entladung_kwh=parseFloat(F.entladung_kwh))),F.sonderkosten_euro&&(q.sonderkosten_euro=parseFloat(F.sonderkosten_euro)),F.sonderkosten_notiz&&(q.sonderkosten_notiz=F.sonderkosten_notiz),Object.keys(q).length>0&&(T[Z.id]=q)});const z=m.batterie_ladung_kwh?parseFloat(m.batterie_ladung_kwh):H.batterieLadung||void 0,D=m.batterie_entladung_kwh?parseFloat(m.batterie_entladung_kwh):H.batterieEntladung||void 0,G=m.pv_erzeugung_kwh?parseFloat(m.pv_erzeugung_kwh):H.pvErzeugung||void 0;await a({anlage_id:r,jahr:parseInt(m.jahr),monat:parseInt(m.monat),einspeisung_kwh:parseFloat(m.einspeisung_kwh),netzbezug_kwh:parseFloat(m.netzbezug_kwh),pv_erzeugung_kwh:G,batterie_ladung_kwh:z,batterie_entladung_kwh:D,notizen:m.notizen||void 0,investitionen_daten:Object.keys(T).length>0?T:void 0})}catch(T){o(T instanceof Error?T.message:"Fehler beim Speichern")}finally{d(!1)}};return u||A?e.jsx("div",{className:"text-center py-4 text-gray-500",children:A?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[i&&e.jsx(ee,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(R,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:m.jahr,onChange:w,required:!0,disabled:!!t}),e.jsx(Ce,{label:"Monat",name:"monat",value:m.monat,onChange:w,options:cn,required:!0,disabled:!!t})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:m.einspeisung_kwh,onChange:w,placeholder:"z.B. 450",required:!0}),e.jsx(R,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:m.netzbezug_kwh,onChange:w,placeholder:"z.B. 120",required:!0}),e.jsx(R,{label:C||j?"PV-Erzeugung (Summe oder manuell)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:m.pv_erzeugung_kwh,onChange:w,placeholder:H.pvErzeugung>0?`Summe: ${H.pvErzeugung.toFixed(1)}`:"z.B. 800",hint:H.pvErzeugung>0?`Aus ${C?"PV-Modulen":"Wechselrichtern"}: ${H.pvErzeugung.toFixed(1)} kWh`:"Wird berechnet wenn leer"})]})]}),C&&e.jsx(Lt,{title:"PV-Module",icon:se,iconColor:"text-yellow-500",investitionen:p.filter(P=>P.typ==="pv-module"),investitionsDaten:N,onInvChange:O,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),j&&!C&&e.jsx(Lt,{title:"Wechselrichter",icon:se,iconColor:"text-yellow-500",investitionen:p.filter(P=>P.typ==="wechselrichter"),investitionsDaten:N,onInvChange:O,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),f&&e.jsxs(e.Fragment,{children:[e.jsx(on,{investitionen:p.filter(P=>P.typ==="speicher"),investitionsDaten:N,onInvChange:O}),(H.batterieLadung>0||H.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",H.batterieLadung.toFixed(1)," kWh | Entladung ",H.batterieEntladung.toFixed(1)," kWh"]})]}),k&&e.jsx(gn,{investitionen:p.filter(P=>P.typ==="e-auto"),investitionsDaten:N,onInvChange:O}),S&&e.jsx(Lt,{title:"Wallbox",icon:Re,iconColor:"text-purple-500",investitionen:p.filter(P=>P.typ==="wallbox"),investitionsDaten:N,onInvChange:O,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgänge",unit:"",placeholder:"z.B. 12"}]}),_&&e.jsx(Lt,{title:"Wärmepumpe",icon:De,iconColor:"text-orange-500",investitionen:p.filter(P=>P.typ==="waermepumpe"),investitionsDaten:N,onInvChange:O,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),y&&e.jsx(xn,{investitionen:p.filter(P=>P.typ==="balkonkraftwerk"),investitionsDaten:N,onInvChange:O}),b&&e.jsx(hn,{investitionen:p.filter(P=>P.typ==="sonstiges"),investitionsDaten:N,onInvChange:O}),!f&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:m.batterie_ladung_kwh,onChange:w,placeholder:"z.B. 150"}),e.jsx(R,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:m.batterie_entladung_kwh,onChange:w,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:m.notizen,onChange:w,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(J,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(J,{type:"submit",loading:g,children:t?"Speichern":"Monat erfassen"})]})]})}function on({investitionen:t,investitionsDaten:r,onInvChange:a}){if(t.length===0)return null;const n=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],s=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:"Ø Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),t.map(l=>{var i;const d=((i=l.parameter)==null?void 0:i.arbitrage_faehig)?[...n,...s]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:l.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:d.map(o=>{var x;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[o.label," ",o.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",o.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[l.id])==null?void 0:x[o.key])||"",onChange:u=>a(l.id,o.key,u.target.value),placeholder:o.placeholder,className:"input text-sm py-1.5",title:o.hint}),o.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:o.hint,children:o.hint})]},o.key)})}),e.jsx(St,{invId:l.id,investitionsDaten:r,onInvChange:a})]},l.id)})]})}function gn({investitionen:t,investitionsDaten:r,onInvChange:a}){if(t.length===0)return null;const n=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"€",placeholder:"z.B. 18.00"}],s={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),t.map(l=>{var i,o;const d=((i=l.parameter)==null?void 0:i.v2h_faehig)||((o=l.parameter)==null?void 0:o.nutzt_v2h)?[...n,s]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:l.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:d.map(x=>{var u;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[x.label," ",x.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",x.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[l.id])==null?void 0:u[x.key])||"",onChange:p=>a(l.id,x.key,p.target.value),placeholder:x.placeholder,className:"input text-sm py-1.5",title:x.hint}),x.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:x.hint,children:x.hint})]},x.key)})}),e.jsx(St,{invId:l.id,investitionsDaten:r,onInvChange:a})]},l.id)})]})}function Lt({title:t,icon:r,iconColor:a,investitionen:n,investitionsDaten:s,onInvChange:l,felder:g}){return n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`h-5 w-5 ${a}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),n.map(d=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:d.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:g.map(i=>{var o;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[i.label," ",i.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",i.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=s[d.id])==null?void 0:o[i.key])||"",onChange:x=>l(d.id,i.key,x.target.value),placeholder:i.placeholder,className:"input text-sm py-1.5",title:i.hint}),i.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:i.hint,children:i.hint})]},i.key)})}),e.jsx(St,{invId:d.id,investitionsDaten:s,onInvChange:l})]},d.id))]})}function xn({investitionen:t,investitionsDaten:r,onInvChange:a}){return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),t.map(n=>{var l,g,d,i,o,x;const s=!!((l=n.parameter)!=null&&l.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:[n.bezeichnung,n.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",n.leistung_kwp," kWp)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=r[n.id])==null?void 0:g.pv_erzeugung_kwh)||"",onChange:u=>a(n.id,"pv_erzeugung_kwh",u.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=r[n.id])==null?void 0:d.eigenverbrauch_kwh)||"",onChange:u=>a(n.id,"eigenverbrauch_kwh",u.target.value),placeholder:"z.B. 35",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((i=r[n.id])==null?void 0:i.einspeisung_kwh)||"",onChange:u=>a(n.id,"einspeisung_kwh",u.target.value),placeholder:"z.B. 10",className:"input text-sm py-1.5"})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=r[n.id])==null?void 0:o.speicher_ladung_kwh)||"",onChange:u=>a(n.id,"speicher_ladung_kwh",u.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[n.id])==null?void 0:x.speicher_entladung_kwh)||"",onChange:u=>a(n.id,"speicher_entladung_kwh",u.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(St,{invId:n.id,investitionsDaten:r,onInvChange:a})]},n.id)})]})}function hn({investitionen:t,investitionsDaten:r,onInvChange:a}){if(t.length===0)return null;const n={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vr,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),t.map(s=>{var g,d,i,o,x,u,p,f,k,S;const l=((g=s.parameter)==null?void 0:g.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[n[l]||l,(d=s.parameter)!=null&&d.beschreibung?` - ${String(s.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[l==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((i=r[s.id])==null?void 0:i.erzeugung_kwh)||"",onChange:_=>a(s.id,"erzeugung_kwh",_.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((o=r[s.id])==null?void 0:o.eigenverbrauch_kwh)||"",onChange:_=>a(s.id,"eigenverbrauch_kwh",_.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((x=r[s.id])==null?void 0:x.einspeisung_kwh)||"",onChange:_=>a(s.id,"einspeisung_kwh",_.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),l==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[s.id])==null?void 0:u.verbrauch_sonstig_kwh)||"",onChange:_=>a(s.id,"verbrauch_sonstig_kwh",_.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=r[s.id])==null?void 0:p.bezug_pv_kwh)||"",onChange:_=>a(s.id,"bezug_pv_kwh",_.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((f=r[s.id])==null?void 0:f.bezug_netz_kwh)||"",onChange:_=>a(s.id,"bezug_netz_kwh",_.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),l==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((k=r[s.id])==null?void 0:k.ladung_kwh)||"",onChange:_=>a(s.id,"ladung_kwh",_.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((S=r[s.id])==null?void 0:S.entladung_kwh)||"",onChange:_=>a(s.id,"entladung_kwh",_.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(St,{invId:s.id,investitionsDaten:r,onInvChange:a})]},s.id)})]})}function St({invId:t,investitionsDaten:r,onInvChange:a}){var g,d,i,o;const n=((g=r[t])==null?void 0:g.sonderkosten_euro)||((d=r[t])==null?void 0:d.sonderkosten_notiz),[s,l]=c.useState(!!n);return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:s?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Sonderkosten ",e.jsx("span",{className:"text-gray-400",children:"(€)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((i=r[t])==null?void 0:i.sonderkosten_euro)||"",onChange:x=>a(t,"sonderkosten_euro",x.target.value),placeholder:"z.B. 150",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Beschreibung"}),e.jsx("input",{type:"text",value:((o=r[t])==null?void 0:o.sonderkosten_notiz)||"",onChange:x=>a(t,"sonderkosten_notiz",x.target.value),placeholder:"z.B. Wechselrichter-Reparatur",className:"input text-sm py-1.5"})]})]}):e.jsx("button",{type:"button",onClick:()=>l(!0),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonderkosten erfassen (Reparatur, Wartung, etc.)"})})}const Oa=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],It=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",getValue:t=>t.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",getValue:t=>t.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",getValue:t=>t.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",getValue:t=>t.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",getValue:t=>t.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",getValue:t=>t.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"batterie_ladung",label:"Batt. Ladung",shortLabel:"B.Lad",getValue:t=>t.batterie_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"batterie_entladung",label:"Batt. Entladung",shortLabel:"B.Entl",getValue:t=>t.batterie_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",getValue:t=>{const r=t.eigenverbrauch_kwh||0,a=r+t.netzbezug_kwh;return a>0?r/a*100:0},format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",getValue:t=>{const r=t.eigenverbrauch_kwh||0,a=t.pv_erzeugung_kwh||0;return a>0?r/a*100:0},format:"percent",defaultVisible:!1}],Ta="eedc-monatsdaten-columns";function mn(){const t=Vt(),{anlagen:r,loading:a}=ve(),[n,s]=c.useState(void 0),{monatsdaten:l,loading:g,error:d,createMonatsdaten:i,updateMonatsdaten:o,deleteMonatsdaten:x}=Ht(n),[u,p]=c.useState(!1),[f,k]=c.useState(null),[S,_]=c.useState(null),[j,C]=c.useState(!1),[y,b]=c.useState(()=>{try{const w=localStorage.getItem(Ta);if(w)return new Set(JSON.parse(w))}catch{}return new Set(It.filter(w=>w.defaultVisible).map(w=>w.key))});c.useEffect(()=>{localStorage.setItem(Ta,JSON.stringify([...y]))},[y]);const m=w=>{b(O=>{const H=new Set(O);return H.has(w)?H.delete(w):H.add(w),H})},h=It.filter(w=>y.has(w.key));!n&&r.length>0&&!a&&s(r[0].id);const N=async w=>{await i(w),p(!1)},M=async w=>{f&&(await o(f.id,w),k(null))},A=async()=>{S&&(await x(S.id),_(null))},K=(w,O)=>{if(w==null)return"-";const H=typeof w=="string"?parseFloat(w):w;if(isNaN(H))return"-";switch(O){case"kwh":return H.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${H.toFixed(1)}%`;case"euro":return`${H.toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})} €`;default:return H.toLocaleString("de-DE",{maximumFractionDigits:1})}};return a||g?e.jsx(he,{text:"Lade Daten..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(W,{children:e.jsx(ut,{icon:ze,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(J,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ce,{value:(n==null?void 0:n.toString())||"",onChange:w=>s(parseInt(w.target.value)),options:r.map(w=>({value:w.id.toString(),label:w.anlagenname}))}),e.jsxs(J,{onClick:()=>p(!0),children:[e.jsx(nt,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),d&&e.jsx(ee,{type:"error",children:d}),l.length===0?e.jsx(W,{children:e.jsx(ut,{icon:bt,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(J,{onClick:()=>p(!0),children:"Manuell erfassen"}),e.jsx(J,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(J,{variant:"secondary",size:"sm",onClick:()=>C(!j),children:[e.jsx(Mr,{className:"h-4 w-4 mr-2"}),"Spalten (",h.length,"/",It.length,")"]})}),j&&e.jsxs(W,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:It.map(w=>e.jsx("button",{onClick:()=>m(w.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${y.has(w.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:w.label},w.key))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Klicke auf eine Spalte um sie ein-/auszublenden. Die Auswahl wird gespeichert."})]}),e.jsx(W,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ha,{children:[e.jsx(ma,{children:e.jsxs(mt,{children:[e.jsx(Ne,{children:"Monat"}),h.map(w=>e.jsxs(Ne,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:w.label}),e.jsx("span",{className:"sm:hidden",children:w.shortLabel||w.label})]},w.key)),e.jsx(Ne,{className:"text-right",children:"Aktionen"})]})}),e.jsx(ua,{children:l.map(w=>e.jsxs(mt,{children:[e.jsx(_e,{children:e.jsxs("span",{className:"font-medium",children:[Oa[w.monat]," ",w.jahr]})}),h.map(O=>{const H=O.getValue(w);return e.jsx(_e,{className:`text-right font-mono ${O.className||""}`,children:K(H,O.format)},O.key)}),e.jsx(_e,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>k(w),children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsx(J,{variant:"ghost",size:"sm",onClick:()=>_(w),children:e.jsx(Xe,{className:"h-4 w-4 text-red-500"})})]})})]},w.id))})]})})})]}),e.jsx($e,{isOpen:u,onClose:()=>p(!1),title:"Monatsdaten erfassen",size:"lg",children:n&&e.jsx(Ka,{anlageId:n,onSubmit:N,onCancel:()=>p(!1)})}),e.jsx($e,{isOpen:!!f,onClose:()=>k(null),title:"Monatsdaten bearbeiten",size:"lg",children:f&&n&&e.jsx(Ka,{monatsdaten:f,anlageId:n,onSubmit:M,onCancel:()=>k(null)})}),e.jsx($e,{isOpen:!!S,onClose:()=>_(null),title:"Monatsdaten löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Daten für ",e.jsxs("strong",{children:[Oa[(S==null?void 0:S.monat)||0]," ",S==null?void 0:S.jahr]})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(J,{variant:"secondary",onClick:()=>_(null),children:"Abbrechen"}),e.jsx(J,{variant:"danger",onClick:A,children:"Löschen"})]})]})})]})}function Ra(){var U;const{anlagen:t,loading:r,refresh:a}=ve(),[n,s]=c.useState(null),[l,g]=c.useState(!1),[d,i]=c.useState(!1),[o,x]=c.useState(null),[u,p]=c.useState(null),[f,k]=c.useState(!1),[S,_]=c.useState(!1),[j,C]=c.useState(null),y=c.useRef(null),b=t.some(v=>v.anlagenname==="Demo-Anlage"),m=n??((U=t[0])==null?void 0:U.id),h=v=>{v.preventDefault(),g(!0)},N=v=>{v.preventDefault(),g(!1)},M=async v=>{v.preventDefault(),g(!1);const L=v.dataTransfer.files;L.length>0&&await K(L[0])},A=async v=>{const L=v.target.files;L&&L.length>0&&await K(L[0]),y.current&&(y.current.value="")},K=async v=>{if(!m){p("Bitte zuerst eine Anlage auswählen");return}if(!v.name.endsWith(".csv")){p("Bitte eine CSV-Datei auswählen");return}p(null),x(null),i(!0);try{const L=await ct.importCSV(m,v,f);x(L)}catch(L){p(L instanceof Error?L.message:"Import fehlgeschlagen")}finally{i(!1)}},w=()=>{if(!m){p("Bitte zuerst eine Anlage auswählen");return}window.location.href=ct.getTemplateDownloadUrl(m)},O=()=>{if(!m){p("Bitte zuerst eine Anlage auswählen");return}window.location.href=ct.getExportUrl(m)},H=async()=>{p(null),C(null),_(!0);try{const v=await ct.createDemoData();C(v),a()}catch(v){p(v instanceof Error?v.message:"Fehler beim Erstellen der Demo-Daten")}finally{_(!1)}},E=async()=>{p(null),C(null),_(!0);try{await ct.deleteDemoData(),a()}catch(v){p(v instanceof Error?v.message:"Fehler beim Löschen der Demo-Daten")}finally{_(!1)}};return r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(ee,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(ft,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wärmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(J,{onClick:H,loading:S,className:"w-full",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(rt,{className:"inline h-4 w-4 mr-1"}),j.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),t.length>1&&e.jsx("select",{value:m??"",onChange:v=>s(Number(v.target.value)),className:"input w-auto",children:t.map(v=>e.jsx("option",{value:v.id,children:v.anlagenname},v.id))})]}),u&&e.jsx(ee,{type:"error",onClose:()=>p(null),children:u}),o&&e.jsx(un,{result:o,onClose:()=>x(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(Dr,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthält alle verfügbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(J,{variant:"secondary",className:"w-full",onClick:w,children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:h,onDragLeave:N,onDrop:M,onClick:()=>{var v;return(v=y.current)==null?void 0:v.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${l?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${d?"opacity-50 pointer-events-none":""}
              `,children:d?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(he,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(nr,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:y,type:"file",accept:".csv",onChange:A,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:v=>k(v.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten überschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(J,{variant:"secondary",size:"sm",onClick:O,children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-50 dark:bg-cyan-900/20",children:e.jsx(Oe,{className:"h-6 w-6 text-cyan-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Daten direkt aus deinem Home Assistant Energy Dashboard."}),e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg text-sm text-yellow-700 dark:text-yellow-300 mb-4",children:[e.jsx("strong",{children:"Phase 2:"})," Diese Funktion wird in einer zukünftigen Version verfügbar sein. Konfiguriere zuerst die Sensor-Zuordnung in den Einstellungen."]}),e.jsx(J,{variant:"secondary",className:"w-full",disabled:!0,children:"Aus Home Assistant importieren"})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(ft,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:b?"Demo-Anlage ist bereits vorhanden. Du kannst sie löschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),b?e.jsxs(J,{variant:"danger",onClick:E,loading:S,className:"w-full",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Demo-Anlage löschen"]}):e.jsxs(J,{onClick:H,loading:S,className:"w-full",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(rt,{className:"inline h-4 w-4 mr-1"}),j.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthält:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, Wärmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs(W,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[e.jsx("p",{children:"Das CSV muss folgende Pflichtspalten enthalten:"}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{className:"mt-2",children:"Optionale Spalten für erweiterte Auswertungen:"}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," - Gesamte PV-Erzeugung"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Direktverbrauch_kWh"})," - Direkter Eigenverbrauch"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Batterie_Ladung_kWh"})," - Batterieladung"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Batterie_Entladung_kWh"})," - Batterieentladung"]})]})]})]})]})}function un({result:t,onClose:r}){const a=t.erfolg&&t.fehler.length===0;return e.jsxs("div",{className:`
      relative p-4 rounded-lg border
      ${a?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"}
    `,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(xa,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[a?e.jsx(rt,{className:"h-5 w-5 text-green-500 mt-0.5"}):e.jsx(Ke,{className:"h-5 w-5 text-yellow-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${a?"text-green-800 dark:text-green-200":"text-yellow-800 dark:text-yellow-200"}`,children:a?"Import erfolgreich":"Import mit Warnungen"}),e.jsxs("div",{className:"text-sm mt-1 space-y-1",children:[e.jsxs("p",{className:a?"text-green-700 dark:text-green-300":"text-yellow-700 dark:text-yellow-300",children:[t.importiert," Datensätze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} übersprungen`]}),t.fehler.length>0&&e.jsxs("ul",{className:"list-disc list-inside text-yellow-700 dark:text-yellow-300",children:[t.fehler.slice(0,5).map((n,s)=>e.jsx("li",{children:n},s)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]})]})]})]})}function pn(){const{theme:t,setTheme:r}=lr(),[a,n]=c.useState(null),[s,l]=c.useState(null),[g,d]=c.useState([]),[i,o]=c.useState([]),[x,u]=c.useState(!0),[p,f]=c.useState(null),[k,S]=c.useState(!1),[_,j]=c.useState(null),C=async()=>{try{u(!0),f(null);const[y,b,m]=await Promise.all([Ca.getStats(),Ca.getSettings(),Be.list()]);if(n(y),l(b),o(m),m.length>0&&!_&&j(m[0].id),b.ha_integration_enabled)try{const h=await Ae.getSensors();d(h)}catch{}}catch(y){f(y instanceof Error?y.message:"Fehler beim Laden der Einstellungen")}finally{u(!1)}};return c.useEffect(()=>{C()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:C,disabled:x,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Le,{className:`h-5 w-5 ${x?"animate-spin":""}`})})]}),p&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:p})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:se},{value:"dark",label:"Dunkel",icon:er},{value:"system",label:"System",icon:Xa}].map(y=>e.jsxs("button",{onClick:()=>r(y.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===y.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(y.icon,{className:"h-5 w-5"}),y.label]},y.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Oe,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:s!=null&&s.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),g.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",g.length," Energy-Sensoren verfügbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Rt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt über ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen → Import/Export"})," um deine Daten zu importieren."]})]})]}),(s==null?void 0:s.ha_integration_enabled)&&i.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Auto-Discovery"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten (SMA, evcc, Smart, Wallbox) und erstelle Investitionen."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.length>1&&e.jsx("select",{value:_||"",onChange:y=>j(Number(y.target.value)),className:"text-sm px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:i.map(y=>e.jsx("option",{value:y.id,children:y.anlagenname},y.id))}),e.jsxs("button",{onClick:()=>S(!0),disabled:!_,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Geräte erkennen"]})]})]})}),g.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfügbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:g.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:y.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:y.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:y.unit_of_measurement||"-"})]},y.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ya,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),x?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Ze,{className:"h-6 w-6 animate-spin text-gray-400"})}):a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),a.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(a.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",a.daten_zeitraum&&e.jsxs("span",{children:[" (",a.daten_zeitraum.von," - ",a.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",a.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(s==null?void 0:s.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfügbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"/api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]}),k&&_&&e.jsx(gr,{isOpen:!0,onClose:()=>S(!1),anlageId:_,onInvestitionenCreated:C})]})}const Ha=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function bn(){const{anlagen:t,loading:r}=ve(),[a,n]=c.useState(),[s,l]=c.useState(null),[g,d]=c.useState([]),[i,o]=c.useState(null),[x,u]=c.useState(null),[p,f]=c.useState(!1),[k,S]=c.useState(!1),[_,j]=c.useState(!1),[C,y]=c.useState(null),[b,m]=c.useState(null),[h,N]=c.useState(14);c.useEffect(()=>{t.length>0&&!a&&n(t[0].id)},[t,a]),c.useEffect(()=>{a&&M()},[a]);const M=async()=>{if(a){f(!0),y(null),m(null);try{const[v,L]=await Promise.all([Ve.getAktivePrognose(a),Ve.listeGespeichertePrognosen(a)]);l(v),d(L)}catch(v){y(v instanceof Error?v.message:"Fehler beim Laden")}finally{f(!1)}}},A=async()=>{if(a){S(!0),y(null);try{const v=await Ve.getPrognose(a,{system_losses:h});o(v)}catch(v){y(v instanceof Error?v.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{S(!1)}}},K=async()=>{if(a){j(!0),y(null);try{const v=await Ve.getOptimum(a);u(v)}catch(v){y(v instanceof Error?v.message:"Fehler beim Ermitteln des Optimums")}finally{j(!1)}}},w=async()=>{if(a){f(!0),y(null);try{await Ve.speicherePrognose(a,{system_losses:h}),m("Prognose erfolgreich gespeichert"),o(null),await M()}catch(v){y(v instanceof Error?v.message:"Fehler beim Speichern")}finally{f(!1)}}},O=async v=>{try{await Ve.aktivierePrognose(v),m("Prognose aktiviert"),await M()}catch(L){y(L instanceof Error?L.message:"Fehler beim Aktivieren")}},H=async v=>{if(confirm("Prognose wirklich löschen?"))try{await Ve.loeschePrognose(v),m("Prognose gelöscht"),await M()}catch(L){y(L instanceof Error?L.message:"Fehler beim Löschen")}},E=t.find(v=>v.id===a),U=(E==null?void 0:E.latitude)&&(E==null?void 0:E.longitude);return r?e.jsx(he,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"}),e.jsx(ee,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Ce,{value:(a==null?void 0:a.toString())||"",onChange:v=>n(parseInt(v.target.value)),options:t.map(v=>({value:v.id.toString(),label:v.anlagenname}))}),e.jsx("button",{onClick:M,disabled:p,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Le,{className:`h-5 w-5 ${p?"animate-spin":""}`})})]})]}),C&&e.jsx(ee,{type:"error",children:C}),b&&e.jsx(ee,{type:"success",children:b}),!U&&e.jsx(ee,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Tt,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergänze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu können."})]})]})}),U&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),p?e.jsx(he,{}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[s.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[s.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[s.neigung_grad,"°"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:s.ausrichtung_richtung})]})]}),s.monatswerte&&s.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:s.monatswerte.map(v=>({name:Ha[v.monat],prognose:v.e_m})),children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name"}),e.jsx(le,{tickFormatter:v=>`${v} kWh`}),e.jsx(Q,{formatter:v=>`${v.toFixed(0)} kWh`}),e.jsx(ne,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(s.abgerufen_am).toLocaleDateString("de-DE")," • ","Koordinaten: ",s.latitude.toFixed(4),"°N, ",s.longitude.toFixed(4),"°E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(se,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:h,onChange:v=>N(parseFloat(v.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(J,{onClick:A,disabled:k,className:"w-full",children:[k?e.jsx(Le,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),i&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(J,{onClick:w,disabled:p,children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[i.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:i.module.length})]})]}),i.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:i.module.map(v=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:v.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[v.leistung_kwp," kWp • ",v.ausrichtung," • ",v.neigung_grad,"° • ",v.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},v.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(pe,{data:i.monatsdaten.map(v=>({name:Ha[v.monat],ertrag:v.e_m})),children:[e.jsx(de,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"name",fontSize:10}),e.jsx(le,{tickFormatter:v=>`${v}`}),e.jsx(Q,{formatter:v=>`${v.toFixed(0)} kWh`}),e.jsx(ne,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Wr,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(J,{onClick:K,disabled:_,variant:"secondary",children:[_?e.jsx(Le,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter für Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[x.optimal.neigung_grad,"°"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:x.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[x.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),x.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung für deinen Standort zu ermitteln.'})]}),g.length>0&&e.jsxs(W,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:g.map(v=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(v.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[v.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:v.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[v.neigung_grad,"°"]}),e.jsx("td",{className:"text-center py-2 px-2",children:v.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(rt,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!v.ist_aktiv&&e.jsx("button",{onClick:()=>O(v.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>H(v.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Löschen",children:e.jsx(Xe,{className:"h-4 w-4"})})]})})]},v.id))})]})})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Über PVGIS"}),e.jsx("p",{children:"PVGIS (Photovoltaic Geographical Information System) ist ein Tool der EU-Kommission, das PV-Ertragsprognosen basierend auf Satellitendaten und Klimamodellen berechnet. Die Prognosen berücksichtigen Standort, Modulneigung, Ausrichtung und Systemverluste."}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"Mehr erfahren →"})]})]})})]})]})}function yn(){const[t,r]=c.useState([]),[a,n]=c.useState(null),[s,l]=c.useState(null),[g,d]=c.useState(null),[i,o]=c.useState(null),[x,u]=c.useState(!0),[p,f]=c.useState(null),[k,S]=c.useState(null),[_,j]=c.useState("core-mosquitto"),[C,y]=c.useState(1883),[b,m]=c.useState(""),[h,N]=c.useState(""),[M,A]=c.useState(null),[K,w]=c.useState(null),[O,H]=c.useState(!1),[E,U]=c.useState(!1),[v,L]=c.useState(!1),[X,oe]=c.useState("mqtt"),[te,xe]=c.useState(new Set(["energie","finanzen"])),[P,T]=c.useState(!1),z=async()=>{try{u(!0),f(null);const[I,ge,ae]=await Promise.all([Be.list(),Ae.getExportSensors(),Ae.getMqttConfig().catch(()=>null)]);r(I),l(ge),ae&&(S(ae),j(ae.host),y(ae.port),m(ae.username)),I.length>0&&!a&&n(I[0].id)}catch(I){f(I instanceof Error?I.message:"Fehler beim Laden")}finally{u(!1)}},D=async I=>{try{const[ge,ae]=await Promise.all([Ae.getAnlageSensors(I),Ae.getYamlSnippet(I)]);d(ge),o(ae)}catch(ge){console.error("Fehler beim Laden der Anlage-Daten:",ge)}};c.useEffect(()=>{z()},[]),c.useEffect(()=>{a&&D(a)},[a]);const G=async()=>{H(!0),A(null);try{const I=await Ae.testMqtt({host:_,port:C,username:b||void 0,password:h||void 0});A(I)}catch(I){A({connected:!1,error:I instanceof Error?I.message:"Verbindungsfehler"})}finally{H(!1)}},Z=async()=>{if(a){U(!0),w(null);try{const I=await Ae.publishMqtt(a,{host:_,port:C,username:b||void 0,password:h||void 0});w(I)}catch(I){w({message:I instanceof Error?I.message:"Fehler beim Publizieren",anlage_id:a,total:0,success:0,failed:0})}finally{U(!1)}}},F=async()=>{if(a&&confirm("Alle EEDC-Sensoren für diese Anlage aus Home Assistant entfernen?")){L(!0);try{await Ae.removeMqtt(a,{host:_,port:C,username:b||void 0,password:h||void 0}),w(null)}catch(I){f(I instanceof Error?I.message:"Fehler beim Entfernen")}finally{L(!1)}}},q=async()=>{if(i)try{await navigator.clipboard.writeText(i.yaml),T(!0),setTimeout(()=>T(!1),2e3)}catch{const I=document.createElement("textarea");I.value=i.yaml,document.body.appendChild(I),I.select(),document.execCommand("copy"),document.body.removeChild(I),T(!0),setTimeout(()=>T(!1),2e3)}},Pe=()=>{if(!i||!g)return;const I=new Blob([i.yaml],{type:"text/yaml"}),ge=URL.createObjectURL(I),ae=document.createElement("a");ae.href=ge,ae.download=`eedc_sensors_${g.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(ge)},Et=I=>{xe(ge=>{const ae=new Set(ge);return ae.has(I)?ae.delete(I):ae.add(I),ae})},Ft=I=>{const ge={};return I.forEach(ae=>{const it=ae.category||"sonstige";ge[it]||(ge[it]=[]),ge[it].push(ae)}),ge},At={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},Ct={energie:"⚡",finanzen:"💰",autarkie:"🏠",umwelt:"🌱",performance:"📊",sonstige:"📌"};return x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Ze,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:z,disabled:x,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(Le,{className:`h-5 w-5 ${x?"animate-spin":""}`})})]}),p&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:p})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO₂, ROI) als Sensoren an Home Assistant zurückgeben. Wähle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entitäten)."})]})]}),t.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswählen"}),e.jsx("select",{value:a||"",onChange:I=>n(Number(I.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:t.map(I=>e.jsx("option",{value:I.id,children:I.anlagenname},I.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>oe("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${X==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>oe("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${X==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),X==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),k&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:_,onChange:I=>j(I.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:C,onChange:I=>y(Number(I.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:b,onChange:I=>m(I.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:h,onChange:I=>N(I.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),M&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${M.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:M.connected?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",M.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Rt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:M.error})]})}),M.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:M.hint})]}),K&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${K.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[K.success," von ",K.total," Sensoren publiziert"]})]}),K.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[K.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:G,disabled:O,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[O?e.jsx(Ze,{className:"w-4 h-4 animate-spin"}):e.jsx(Le,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:Z,disabled:E||!a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[E?e.jsx(Ze,{className:"w-4 h-4 animate-spin"}):e.jsx(tr,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:F,disabled:v||!a,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[v?e.jsx(Ze,{className:"w-4 h-4 animate-spin"}):e.jsx(Xe,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${k!=null&&k.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[k!=null&&k.auto_publish?e.jsx(Je,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(Ke,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${k!=null&&k.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen → Geräte & Dienste → MQTT"}),".",k!=null&&k.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",k.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelmäßig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen für automatische Updates."]})]})]})]})]}),X==="rest"&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML für configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:q,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:P?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx($r,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:Pe,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(Nt,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:i.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:i.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["Füge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",i.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach Änderungen muss Home Assistant neu gestartet werden."]})]})]})]}),g&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verfügbare Sensoren (",g.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(Ft(g.sensors)).map(([I,ge])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>Et(I),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:Ct[I]||"📌"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:At[I]||I}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",ge.length,")"]})]}),te.has(I)?e.jsx(Ot,{className:"w-5 h-5 text-gray-400"}):e.jsx(da,{className:"w-5 h-5 text-gray-400"})]}),te.has(I)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:ge.map(ae=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:ae.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ae.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:ae.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:ae.value!==null?typeof ae.value=="number"?ae.value.toLocaleString("de-DE",{maximumFractionDigits:2}):ae.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:ae.unit})]})]}),ae.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",ae.formel,ae.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",ae.berechnung]})]})]},ae.key))})]},I))})]}),s&&s.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:s.investitionen.map(I=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:I.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",I.typ," - ",I.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:I.sensors.map(ge=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:ge.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:ge.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:ge.value!==null?typeof ge.value=="number"?ge.value.toLocaleString("de-DE",{maximumFractionDigits:2}):ge.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:ge.unit})]})]},ge.key))})]},I.investition_id))})]})]})}function kn(){return e.jsx(pr,{children:e.jsx(br,{children:e.jsxs(re,{path:"/",element:e.jsx(ns,{}),children:[e.jsx(re,{index:!0,element:e.jsx(we,{to:"/cockpit",replace:!0})}),e.jsx(re,{path:"cockpit",element:e.jsx(ps,{})}),e.jsx(re,{path:"cockpit/pv-anlage",element:e.jsx(ks,{})}),e.jsx(re,{path:"cockpit/e-auto",element:e.jsx(js,{})}),e.jsx(re,{path:"cockpit/waermepumpe",element:e.jsx(vs,{})}),e.jsx(re,{path:"cockpit/speicher",element:e.jsx(_s,{})}),e.jsx(re,{path:"cockpit/wallbox",element:e.jsx(Ss,{})}),e.jsx(re,{path:"cockpit/balkonkraftwerk",element:e.jsx(As,{})}),e.jsx(re,{path:"cockpit/sonstiges",element:e.jsx(Ms,{})}),e.jsx(re,{path:"auswertungen",element:e.jsx(La,{})}),e.jsx(re,{path:"auswertungen/roi",element:e.jsx(Ts,{})}),e.jsx(re,{path:"auswertungen/prognose",element:e.jsx(Hs,{})}),e.jsx(re,{path:"auswertungen/export",element:e.jsx(La,{})})," ",e.jsx(re,{path:"einstellungen/anlage",element:e.jsx(Xs,{})}),e.jsx(re,{path:"einstellungen/strompreise",element:e.jsx(en,{})}),e.jsx(re,{path:"einstellungen/investitionen",element:e.jsx(ln,{})}),e.jsx(re,{path:"einstellungen/monatsdaten",element:e.jsx(mn,{})}),e.jsx(re,{path:"einstellungen/import",element:e.jsx(Ra,{})}),e.jsx(re,{path:"einstellungen/demo",element:e.jsx(Ra,{})})," ",e.jsx(re,{path:"einstellungen/pvgis",element:e.jsx(bn,{})}),e.jsx(re,{path:"einstellungen/ha-export",element:e.jsx(yn,{})}),e.jsx(re,{path:"einstellungen/allgemein",element:e.jsx(pn,{})}),e.jsx(re,{path:"dashboard",element:e.jsx(we,{to:"/cockpit",replace:!0})}),e.jsx(re,{path:"anlagen",element:e.jsx(we,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(re,{path:"monatsdaten",element:e.jsx(we,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(re,{path:"strompreise",element:e.jsx(we,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(re,{path:"investitionen",element:e.jsx(we,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(re,{path:"auswertung",element:e.jsx(we,{to:"/auswertungen",replace:!0})}),e.jsx(re,{path:"roi",element:e.jsx(we,{to:"/auswertungen/roi",replace:!0})}),e.jsx(re,{path:"e-auto",element:e.jsx(we,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(re,{path:"waermepumpe",element:e.jsx(we,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(re,{path:"speicher",element:e.jsx(we,{to:"/cockpit/speicher",replace:!0})}),e.jsx(re,{path:"wallbox",element:e.jsx(we,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(re,{path:"balkonkraftwerk",element:e.jsx(we,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(re,{path:"sonstiges",element:e.jsx(we,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(re,{path:"import",element:e.jsx(we,{to:"/einstellungen/import",replace:!0})}),e.jsx(re,{path:"settings",element:e.jsx(we,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function jn({onNext:t,onLoadDemo:r}){const[a,n]=c.useState(!1),[s,l]=c.useState(null),g=async()=>{if(r){n(!0),l(null);try{await r()}catch(d){l(d instanceof Error?d.message:"Fehler beim Laden der Demo-Daten"),n(!1)}}};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(se,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persönliches Energie Effizienz Data Center für die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(Xt,{icon:e.jsx(ia,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(Xt,{icon:e.jsx(xt,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen für alle Ihre Energie-Investitionen"}),e.jsx(Xt,{icon:e.jsx(ue,{className:"w-6 h-6"}),title:"Home Assistant",description:"Automatischer Datenimport direkt aus Ihrem Smart Home"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(jt,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(jt,{number:2,text:"Home Assistant Verbindung prüfen"}),e.jsx(jt,{number:3,text:"Stromtarif konfigurieren (mit Vorschlägen)"}),e.jsx(jt,{number:4,text:"Geräte automatisch aus HA erkennen"}),e.jsx(jt,{number:5,text:"Investitionen vervollständigen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx(Ee,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),r&&e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:g,disabled:a,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),s&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:s}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enthält 31 Monate Beispieldaten, 9 Investitionen inkl. E-Auto, Speicher, Wärmepumpe u.v.m."})]})]})]})}function Xt({icon:t,title:r,description:a}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a})]})}function jt({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}const fn=[{value:"",label:"-- Auswählen --"},{value:"Süd",label:"Süd (optimal)"},{value:"Südost",label:"Südost"},{value:"Südwest",label:"Südwest"},{value:"Ost",label:"Ost"},{value:"West",label:"West"},{value:"Ost-West",label:"Ost-West"}],vn=[{value:"",label:"-- Unbekannt / Andere --"},{value:"sma",label:"SMA"},{value:"fronius",label:"Fronius"},{value:"kostal",label:"Kostal"},{value:"huawei",label:"Huawei / FusionSolar"},{value:"growatt",label:"Growatt"},{value:"solax",label:"SolaX"},{value:"sungrow",label:"Sungrow"},{value:"goodwe",label:"GoodWe"},{value:"enphase",label:"Enphase"}];function wn({isLoading:t,error:r,onSubmit:a,onGeocode:n,onBack:s}){const[l,g]=c.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:"",ausrichtung:"",neigung_grad:"",wechselrichter_hersteller:""}),[d,i]=c.useState(null),[o,x]=c.useState(!1),[u,p]=c.useState(!1),f=j=>{const{name:C,value:y}=j.target;g(b=>({...b,[C]:y})),i(null),(C==="standort_plz"||C==="standort_ort")&&p(!1)},k=async()=>{if(!l.standort_plz){i("Bitte geben Sie eine PLZ ein");return}x(!0),i(null),p(!1);try{const j=await n(l.standort_plz,l.standort_ort||void 0);j?(g(C=>({...C,latitude:j.latitude.toFixed(6),longitude:j.longitude.toFixed(6)})),p(!0)):i("Koordinaten konnten nicht ermittelt werden. Bitte prüfen Sie PLZ/Ort.")}catch{i("Fehler beim Ermitteln der Koordinaten")}finally{x(!1)}},S=async j=>{if(j.preventDefault(),i(null),!l.anlagenname.trim()){i("Bitte geben Sie einen Namen für Ihre Anlage ein");return}if(!l.leistung_kwp||parseFloat(l.leistung_kwp)<=0){i("Bitte geben Sie die Anlagenleistung in kWp ein");return}await a({anlagenname:l.anlagenname.trim(),leistung_kwp:parseFloat(l.leistung_kwp),installationsdatum:l.installationsdatum||void 0,standort_plz:l.standort_plz||void 0,standort_ort:l.standort_ort||void 0,latitude:l.latitude?parseFloat(l.latitude):void 0,longitude:l.longitude?parseFloat(l.longitude):void 0,ausrichtung:l.ausrichtung||void 0,neigung_grad:l.neigung_grad?parseFloat(l.neigung_grad):void 0,wechselrichter_hersteller:l.wechselrichter_hersteller||void 0})},_=d||r;return e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),_&&e.jsx(ee,{type:"error",className:"mb-6",children:_}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:l.anlagenname,onChange:f,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:l.leistung_kwp,onChange:f,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(bt,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:l.installationsdatum,onChange:f,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für korrekten Start der Stromtarif-Gültigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(Tt,{className:"w-4 h-4 text-gray-500"}),"Standort (für PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:l.standort_plz,onChange:f,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:l.standort_ort,onChange:f,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:k,disabled:o||!l.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):u?e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:l.latitude,onChange:f,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Längengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:l.longitude,onChange:f,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden für die PVGIS-Ertragsprognose benötigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Technische Daten (optional)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsx("select",{name:"ausrichtung",value:l.ausrichtung,onChange:f,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:fn.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",name:"neigung_grad",value:l.neigung_grad,onChange:f,placeholder:"z.B. 30",min:"0",max:"90",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Typisch: 30-35° (Süd), 10-15° (Ost-West)"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Wechselrichter-Hersteller (optional)"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hersteller"}),e.jsx("select",{name:"wechselrichter_hersteller",value:l.wechselrichter_hersteller,onChange:f,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:vn.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Hilft bei der automatischen Erkennung von Home Assistant Sensoren"})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Ee,{className:"w-4 h-4"})]})})]})]})}function Nn({isLoading:t,error:r,haConnected:a,haVersion:n,onRetry:s,onNext:l,onSkip:g,onBack:d}){return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${a?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:a?e.jsx(ga,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(_t,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Home Assistant Verbindung"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatischer Datenimport aus Ihrem Smart Home"})]})]}),e.jsxs("div",{className:"space-y-6",children:[t?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx(Le,{className:"w-8 h-8 text-amber-500 animate-spin"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Verbindung wird geprüft..."})]}):a?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(We,{className:"w-10 h-10 text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Verbindung erfolgreich!"}),n&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Home Assistant Version: ",n]}),e.jsxs("div",{className:"max-w-md mx-auto bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-medium text-green-800 dark:text-green-300 mb-2",children:"Folgende Funktionen sind verfügbar:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-green-700 dark:text-green-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Automatische Geräte-Erkennung"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Sensor-Zuordnung für Energy-Daten"]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(_t,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Keine Verbindung zu Home Assistant"}),r&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:r}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 text-left mb-6",children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-300 mb-2 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Mögliche Ursachen:"]}),e.jsxs("ul",{className:"space-y-1 text-sm text-amber-700 dark:text-amber-400",children:[e.jsx("li",{children:"• EEDC läuft nicht als Home Assistant Add-on"}),e.jsx("li",{children:"• Home Assistant API nicht erreichbar"}),e.jsx("li",{children:"• Supervisor Token fehlt"})]})]}),e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Le,{className:"w-4 h-4"}),"Erneut prüfen"]})]})]}),!t&&!a&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Sie können EEDC auch ohne Home Assistant nutzen. Investitionen und Daten können manuell oder per CSV-Import erfasst werden. Die HA-Integration kann jederzeit später aktiviert werden."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!a&&e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(sr,{className:"w-4 h-4"}),"Überspringen"]}),e.jsxs("button",{type:"button",onClick:l,disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(Ee,{className:"w-4 h-4"})]})]})]})]})}function _n({anlage:t,isLoading:r,error:a,onSubmit:n,onUseDefaults:s,onBack:l}){const g=t?cr(t.leistung_kwp):at.einspeiseverguetung_cent_kwh,[d,i]=c.useState({netzbezug_arbeitspreis_cent_kwh:at.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:g.toString(),grundpreis_euro_monat:at.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[o,x]=c.useState(null),u=k=>{const{name:S,value:_}=k.target;i(j=>({...j,[S]:_})),x(null)},p=async k=>{if(k.preventDefault(),x(null),!d.netzbezug_arbeitspreis_cent_kwh||parseFloat(d.netzbezug_arbeitspreis_cent_kwh)<0){x("Bitte geben Sie einen gültigen Netzbezugspreis ein");return}if(!d.gueltig_ab){x("Bitte geben Sie ein Gültigkeitsdatum ein");return}await n({netzbezug_arbeitspreis_cent_kwh:parseFloat(d.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(d.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:d.grundpreis_euro_monat?parseFloat(d.grundpreis_euro_monat):void 0,gueltig_ab:d.gueltig_ab,tarifname:d.tarifname||void 0,anbieter:d.anbieter||void 0})},f=o||a;return e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Für korrekte Wirtschaftlichkeitsberechnungen"})]})]}),f&&e.jsx(ee,{type:"error",className:"mb-6",children:f}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:s,disabled:r,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(ft,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[at.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",g," ct Einspeisung |"," ",at.grundpreis_euro_monat," € Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:d.netzbezug_arbeitspreis_cent_kwh,onChange:u,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergütung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:d.einspeiseverguetung_cent_kwh,onChange:u,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"≤10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (€/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:d.grundpreis_euro_monat,onChange:u,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gültig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:d.gueltig_ab,onChange:u,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:d.tarifname,onChange:u,placeholder:"z.B. Ökostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:d.anbieter,onChange:u,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können später weitere Stromtarife mit unterschiedlichen Gültigkeitszeiträumen hinzufügen, z.B. bei Tarifwechsel oder Preisänderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx(Ee,{className:"w-4 h-4"})]})})]})]})}function zn(t){switch(t.suggested_investition_typ){case"e-auto":return e.jsx(Fe,{className:"w-5 h-5"});case"speicher":return e.jsx(ye,{className:"w-5 h-5"});case"wallbox":return e.jsx(Re,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(wt,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(De,{className:"w-5 h-5"});case"balkonkraftwerk":return e.jsx(se,{className:"w-5 h-5"});default:return e.jsx(wt,{className:"w-5 h-5"})}}function Sn(t){switch(t){case"e-auto":return"E-Auto";case"speicher":return"Speicher";case"wallbox":return"Wallbox";case"wechselrichter":return"Wechselrichter";case"pv-module":return"PV-Module";case"waermepumpe":return"Wärmepumpe";case"balkonkraftwerk":return"Balkonkraftwerk";default:return"Unbekannt"}}function En({isLoading:t,error:r,haConnected:a,discoveryResult:n,onRunDiscovery:s,onSkip:l,onBack:g}){const d=(n==null?void 0:n.devices.filter(o=>!o.already_configured&&o.suggested_investition_typ))??[],i=(n==null?void 0:n.devices.filter(o=>o.already_configured))??[];return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(Ye,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Geräte erkennen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatische Erkennung aus Home Assistant"})]})]}),!t&&!n&&!r&&a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-6",children:e.jsx(Ye,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Geräte automatisch erkennen?"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"EEDC durchsucht Home Assistant nach Wechselrichtern, Speichern, Wallboxen, E-Autos, Wärmepumpen und Balkonkraftwerken."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-8",children:"Erkannte Geräte werden als Investitionen angelegt und können im nächsten Schritt vervollständigt werden."}),e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-500 text-white font-medium rounded-xl hover:bg-amber-600 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Discovery starten"]})]}),t&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(Ye,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Durchsuche Home Assistant nach Geräten..."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Erkannte Geräte werden automatisch als Investitionen angelegt."})]}),!t&&!a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(_t,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Home Assistant Verbindung"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Die automatische Geräteerkennung ist ohne HA-Verbindung nicht möglich."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-6",children:"Sie können Investitionen im nächsten Schritt manuell anlegen."}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg text-sm",children:[e.jsx(nt,{className:"w-4 h-4"}),"Manuelles Anlegen möglich im nächsten Schritt"]})]}),!t&&r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:e.jsx(Ke,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler bei der Erkennung"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-6",children:r}),e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(Le,{className:"w-4 h-4"}),"Erneut versuchen"]})]}),!t&&n&&!r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ga,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"}),n.devices.length>0&&e.jsxs("span",{className:"text-gray-400 dark:text-gray-500",children:["• ",n.devices.length," Gerät(e) gefunden"]})]}),n.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:n.warnings.map((o,x)=>e.jsx("p",{children:o},x))})]})}),n.devices.length===0&&e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-xl",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Keine unterstützten Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-4",children:"Unterstützt: SMA, evcc, Smart, Wallbox, Wärmepumpen-Integrationen"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-amber-600 dark:text-amber-400 hover:text-amber-700 dark:hover:text-amber-300",children:[e.jsx(Le,{className:"w-4 h-4"}),"Erneut suchen"]}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manuelles Anlegen im nächsten Schritt möglich"})]})]}),d.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(We,{className:"w-5 h-5 text-green-500"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[d.length," Investition",d.length!==1?"en":""," angelegt"]})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:d.map(o=>e.jsx("div",{className:"p-4 rounded-xl border-2 border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",children:zn(o)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:o.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o.manufacturer&&`${o.manufacturer} • `,Sn(o.suggested_investition_typ)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:o.integration})]}),e.jsx(We,{className:"w-5 h-5 text-green-500 flex-shrink-0"})]})},o.id))}),e.jsx("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Diese Investitionen können im nächsten Schritt vervollständigt werden (Kaufdatum, Kaufpreis, etc.)."})]}),i.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-gray-400"}),i.length," Gerät(e) bereits konfiguriert (übersprungen)"]}),n.devices.length>0&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Im nächsten Schritt können Sie weitere Investitionen manuell hinzufügen (z.B. PV-Module) und alle Details vervollständigen."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!n&&!t&&e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(sr,{className:"w-4 h-4"}),"Überspringen"]}),n&&!t&&e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter",e.jsx(Ee,{className:"w-4 h-4"})]})]})]})]})}function ka(t){switch(t){case"e-auto":return e.jsx(Fe,{className:"w-5 h-5"});case"speicher":return e.jsx(ye,{className:"w-5 h-5"});case"wallbox":return e.jsx(Re,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(wt,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(De,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(se,{className:"w-5 h-5"});default:return e.jsx(ca,{className:"w-5 h-5"})}}function Fn({investition:t,allInvestitionen:r,anlage:a,onUpdate:n,onDelete:s,isNew:l=!1}){const[g,d]=c.useState(!0);c.useEffect(()=>{l&&d(!0)},[l]);const[i,o]=c.useState(!1),x=xs[t.typ],u=x?r.filter(k=>k.typ===x&&k.id!==t.id):[],p=k=>{var S;return(S=t.parameter)==null?void 0:S[k]},f=(k,S)=>{n({parameter:{...t.parameter,[k]:S}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>d(!g),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:ka(t.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung||Ue[t.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Ue[t.typ],t.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:["• ",t.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]})]}),g?e.jsx(Ot,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(da,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),g&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:t.bezeichnung,onChange:k=>n({bezeichnung:k.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:t.anschaffungsdatum||"",onChange:k=>n({anschaffungsdatum:k.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (€) *"}),e.jsx("input",{type:"number",value:t.anschaffungskosten_gesamt??"",onChange:k=>n({anschaffungskosten_gesamt:parseFloat(k.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),x&&e.jsx("div",{children:(()=>{const k=hs.includes(t.typ),S=u.length>0,_=k&&!t.parent_investition_id&&S;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",Ue[x],")",k?" *":" (optional)"]}),S?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.parent_investition_id||"",onChange:j=>n({parent_investition_id:j.target.value?parseInt(j.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${_?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:k?"-- Bitte wählen --":"-- Keine Zuordnung --"}),u.map(j=>e.jsx("option",{value:j.id,children:j.bezeichnung},j.id))]}),_&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),"PV-Module müssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 flex-shrink-0"}),k?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen können."]}):e.jsxs("span",{children:["Kein ",Ue[x]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),t.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW)"}),e.jsx("input",{type:"number",value:p("leistung_kw")??"",onChange:k=>f("leistung_kw",parseFloat(k.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:t.leistung_kwp??"",onChange:k=>n({leistung_kwp:parseFloat(k.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{value:t.ausrichtung||(a==null?void 0:a.ausrichtung)||"",onChange:k=>n({ausrichtung:k.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",value:t.neigung_grad??(a==null?void 0:a.neigung_grad)??"",onChange:k=>n({neigung_grad:parseFloat(k.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="speicher"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazität (kWh)"}),e.jsx("input",{type:"number",value:p("kapazitaet_kwh")??"",onChange:k=>f("kapazitaet_kwh",parseFloat(k.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="wallbox"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW)"}),e.jsx("input",{type:"number",value:p("leistung_kw")??"",onChange:k=>f("leistung_kw",parseFloat(k.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazität (kWh)"}),e.jsx("input",{type:"number",value:p("batterie_kwh")??"",onChange:k=>f("batterie_kwh",parseFloat(k.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km)"}),e.jsx("input",{type:"number",value:p("verbrauch_kwh_100km")??"",onChange:k=>f("verbrauch_kwh_100km",parseFloat(k.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW)"}),e.jsx("input",{type:"number",value:p("leistung_kw")??"",onChange:k=>f("leistung_kw",parseFloat(k.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl)"}),e.jsx("input",{type:"number",value:p("cop")??"3.5",onChange:k=>f("cop",parseFloat(k.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (Wp)"}),e.jsx("input",{type:"number",value:p("leistung_wp")??"",onChange:k=>f("leistung_wp",parseFloat(k.target.value)||void 0),placeholder:"z.B. 800",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module"}),e.jsx("input",{type:"number",value:p("anzahl")??"",onChange:k=>f("anzahl",parseInt(k.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:i?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich löschen?"}),e.jsx("button",{type:"button",onClick:()=>{s(),o(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, löschen"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>o(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Investition löschen"]})})]})]})}function Ga({onAdd:t}){const[r,a]=c.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>a(!r),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(nt,{className:"w-5 h-5"}),"Investition hinzufügen"]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:or.map(n=>e.jsxs("button",{type:"button",onClick:()=>{t(n),a(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:ka(n)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:Ue[n]})]},n))})]})]})}function An({investitionen:t,anlage:r,isLoading:a,error:n,onUpdateInvestition:s,onDeleteInvestition:l,onAddInvestition:g,onNext:d,onBack:i}){const[o,x]=c.useState(null),[u,p]=c.useState(null),f=c.useRef(null);c.useEffect(()=>{if(u&&f.current){f.current.scrollIntoView({behavior:"smooth",block:"center"});const _=setTimeout(()=>p(null),2e3);return()=>clearTimeout(_)}},[u]);const k=or.reduce((_,j)=>{const C=t.filter(y=>y.typ===j);return C.length>0&&_.push({typ:j,items:C}),_},[]),S=async _=>{x(_);try{const j=await g(_);j!=null&&j.id&&p(j.id)}finally{x(null)}};return t.length===0&&!a?e.jsxs("div",{children:[e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(ca,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Keine Investitionen vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Sie können jetzt manuell Investitionen anlegen oder diesen Schritt überspringen und später unter Einstellungen → Investitionen ergänzen."}),e.jsx(Ga,{onAdd:S}),o&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",Ue[o]," hinzu..."]})]})}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter ohne Investitionen",e.jsx(Ee,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollständigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergänzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden für die ROI-Berechnung benötigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length," Investition",t.length!==1?"en":""]})]}),n&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(ze,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:n})]}),a&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!a&&e.jsxs("div",{className:"space-y-6",children:[k.map(({typ:_,items:j})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:ka(_)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[Ue[_]," (",j.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:j.map(C=>e.jsx("div",{ref:C.id===u?f:void 0,className:`transition-all duration-500 ${C.id===u?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(Fn,{investition:C,allInvestitionen:t,anlage:r,onUpdate:y=>s(C.id,y),onDelete:()=>l(C.id),isNew:C.id===u})},C.id))})]},_)),e.jsxs("div",{className:"pt-4",children:[e.jsx(Ga,{onAdd:S}),o&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",Ue[o]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig für die Amortisationsberechnung. Sie können alle Angaben später jederzeit unter Einstellungen → Investitionen ändern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:d,disabled:a,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx(Ee,{className:"w-4 h-4"})]})]})]})}function Cn(t){switch(t){case"e-auto":return e.jsx(Fe,{className:"w-4 h-4"});case"speicher":return e.jsx(ye,{className:"w-4 h-4"});case"wallbox":return e.jsx(Re,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(wt,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(De,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(se,{className:"w-4 h-4"});default:return e.jsx(ca,{className:"w-4 h-4"})}}function Mn({anlage:t,strompreis:r,investitionen:a,onComplete:n,onBack:s}){const l=!!t,g=!!r,d=a.length>0,i=a.reduce((o,x)=>o+(x.anschaffungskosten_gesamt||0),0);return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(We,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschließen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Überprüfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ea,{icon:e.jsx(se,{className:"w-5 h-5"}),title:"PV-Anlage",status:l?"success":"warning",children:l?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&` • ${t.standort_ort}`,t.latitude&&t.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(ea,{icon:e.jsx(ue,{className:"w-5 h-5"}),title:"Stromtarif",status:g?"success":"warning",children:g?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:r.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:r.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),r.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.tarifname,r.anbieter&&` (${r.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollständig"})}),e.jsx(ea,{icon:e.jsx(wt,{className:"w-5 h-5"}),title:"Investitionen",status:d?"success":"neutral",children:d?e.jsxs("div",{className:"space-y-2",children:[a.slice(0,5).map(o=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:Cn(o.typ)}),e.jsx("span",{className:"truncate",children:o.bezeichnung}),o.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[o.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]},o.id)),a.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",a.length-5," weitere"]}),i>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",i.toLocaleString("de-DE")," €"]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - können später hinzugefügt werden"})})]}),e.jsx(Wn,{hasAnlage:l,investitionen:a})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(st,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:["Einrichtung abschließen",e.jsx(We,{className:"w-5 h-5"})]})]})]})}function ea({icon:t,title:r,status:a,children:n}){const s={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},l={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${s[a]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${l[a]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r}),a==="success"&&e.jsx(We,{className:"w-4 h-4 text-green-500"}),a==="warning"&&e.jsx(ze,{className:"w-4 h-4 text-amber-500"})]}),n]})]})})}function Wn({hasAnlage:t,investitionen:r}){const a=r.some(g=>g.typ==="wechselrichter"),n=r.some(g=>g.typ==="pv-module"),s=[];n||s.push({text:"PV-Module unter Einstellungen → Investitionen anlegen (wichtig für PVGIS-Prognose)",priority:"high"}),!a&&t&&s.push({text:"Wechselrichter unter Einstellungen → Investitionen ergänzen",priority:"high"}),s.push({text:"Monatsdaten unter Einstellungen → Monatsdaten erfassen oder CSV importieren",priority:"medium"}),n&&s.push({text:"PVGIS-Prognose unter Auswertungen → Prognose abrufen",priority:"medium"}),s.push({text:"Dashboard und Auswertungen erkunden",priority:"low"});const l=s.sort((g,d)=>{const i={high:0,medium:1,low:2};return i[g.priority]-i[d.priority]});return e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-amber-500"}),"Empfohlene nächste Schritte:"]}),e.jsx("ul",{className:"space-y-2 text-sm",children:l.map((g,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ee,{className:`w-4 h-4 flex-shrink-0 mt-0.5 ${g.priority==="high"?"text-amber-500":g.priority==="medium"?"text-blue-500":"text-green-500"}`}),e.jsx("span",{className:`${g.priority==="high"?"text-gray-900 dark:text-white font-medium":"text-gray-600 dark:text-gray-400"}`,children:g.text})]},d))}),(!n||!a)&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," PV-Module werden nicht automatisch erkannt und müssen manuell angelegt werden. Die Angaben zu Ausrichtung und Neigung sind wichtig für die PVGIS-Ertragsprognose."]})})]})}function $n({anlage:t,onGoToDashboard:r}){return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(se,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(Br,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8 max-w-md mx-auto text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Erste Schritte:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(ta,{number:1,text:"Fehlende Investitionen unter Einstellungen ergänzen"}),e.jsx(ta,{number:2,text:"Monatsdaten erfassen oder CSV importieren"}),e.jsx(ta,{number:3,text:"Dashboard und ROI-Berechnungen erkunden"})]})]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Zum Dashboard",e.jsx(Ee,{className:"w-5 h-5"})]})]})}function ta({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}const dt=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"ha-connection",label:"Home Assistant",shortLabel:"HA"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"discovery",label:"Geräte erkennen",shortLabel:"Geräte"},{key:"investitionen",label:"Investitionen",shortLabel:"Invest."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function Dn({onComplete:t}){var l;const r=ms(),a=async()=>{await ct.createDemoData(),t()};c.useEffect(()=>{r.step==="ha-connection"&&!r.haConnected&&r.checkHAConnection()},[r.step]),c.useEffect(()=>{if(r.step==="complete"){const g=setTimeout(t,100);return()=>clearTimeout(g)}},[r.step,t]);const n=dt.findIndex(g=>g.key===r.step),s=r.step!=="welcome"&&r.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),s&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",n+1," von ",dt.length]})]})})}),s&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:dt.map((g,d)=>{const i=d<n,o=d===n;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${i?"bg-green-500 text-white":o?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:i?e.jsx(We,{className:"w-5 h-5"}):d+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${o?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:g.label})]}),d<dt.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${i?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},g.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(l=dt[n])==null?void 0:l.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n+1,"/",dt.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${r.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[r.step==="welcome"&&e.jsx(jn,{onNext:r.nextStep,onLoadDemo:a}),r.step==="anlage"&&e.jsx(wn,{isLoading:r.isLoading,error:r.error,onSubmit:r.createAnlage,onGeocode:r.geocodeAddress,onBack:r.prevStep}),r.step==="ha-connection"&&e.jsx(Nn,{isLoading:r.isLoading,error:r.error,haConnected:r.haConnected,haVersion:r.haVersion,onRetry:r.checkHAConnection,onNext:r.nextStep,onSkip:r.skipStep,onBack:r.prevStep}),r.step==="strompreise"&&e.jsx(_n,{anlage:r.anlage,isLoading:r.isLoading,error:r.error,onSubmit:r.createStrompreis,onUseDefaults:r.useDefaultStrompreise,onBack:r.prevStep}),r.step==="discovery"&&e.jsx(En,{isLoading:r.isLoading,error:r.error,haConnected:r.haConnected,discoveryResult:r.discoveryResult,onRunDiscovery:r.runDiscoveryAndCreateInvestitionen,onSkip:r.nextStep,onBack:r.prevStep}),r.step==="investitionen"&&e.jsx(An,{investitionen:r.investitionen,anlage:r.anlage,isLoading:r.isLoading,error:r.error,onUpdateInvestition:r.updateInvestition,onDeleteInvestition:r.deleteInvestition,onAddInvestition:r.addInvestition,onNext:r.nextStep,onBack:r.prevStep}),r.step==="summary"&&e.jsx(Mn,{anlage:r.anlage,strompreis:r.strompreis,investitionen:r.investitionen,onComplete:r.completeWizard,onBack:r.prevStep}),r.step==="complete"&&e.jsx($n,{anlage:r.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc – Energie Effizienz Data Center"})]})}const aa="eedc_setup_wizard_completed";function Ln({children:t}){const[r,a]=c.useState(!0),[n,s]=c.useState(!1);c.useEffect(()=>{l()},[]);const l=async()=>{try{(await Be.list()).length===0?(localStorage.removeItem(aa),localStorage.removeItem("eedc_setup_wizard_state"),s(!0)):(localStorage.setItem(aa,"true"),s(!1))}catch(d){console.error("Fehler beim Prüfen des Setup-Status:",d),s(!1)}finally{a(!1)}},g=()=>{localStorage.setItem(aa,"true"),s(!1)};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):n?e.jsx(Dn,{onComplete:g}):e.jsx(e.Fragment,{children:t})}sa.createRoot(document.getElementById("root")).render(e.jsx(yr.StrictMode,{children:e.jsx(qr,{children:e.jsx(Ln,{children:e.jsx(kn,{})})})}));
