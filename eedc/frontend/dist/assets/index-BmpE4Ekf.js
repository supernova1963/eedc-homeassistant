var Us=Object.defineProperty;var Ys=(t,r,s)=>r in t?Us(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var as=(t,r,s)=>Ys(t,typeof r!="symbol"?r+"":r,s);import{r as c,a as Qs,u as Es,N as $r,O as Xs,b as er,H as ea,d as ta,e as ge,f as De,R as ra}from"./vendor-DpDmk0XN.js";import{R as U,B as Fe,C as le,X as de,Y as se,T as Y,L as pe,a as G,b as We,c as He,d as Ae,A as ft,e as Be,P as it,f as lt,g as tr,h as sa}from"./charts-CcsbBXg3.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const b of i.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&n(b)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var Fs={exports:{}},ur={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=c,na=Symbol.for("react.element"),ia=Symbol.for("react.fragment"),la=Object.prototype.hasOwnProperty,da=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ca={key:!0,ref:!0,__self:!0,__source:!0};function Ws(t,r,s){var n,a={},i=null,b=null;s!==void 0&&(i=""+s),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(b=r.ref);for(n in r)la.call(r,n)&&!ca.hasOwnProperty(n)&&(a[n]=r[n]);if(t&&t.defaultProps)for(n in r=t.defaultProps,r)a[n]===void 0&&(a[n]=r[n]);return{$$typeof:na,type:t,key:i,ref:b,props:a,_owner:da.current}}ur.Fragment=ia;ur.jsx=Ws;ur.jsxs=Ws;Fs.exports=ur;var e=Fs.exports,Ar={},ns=Qs;Ar.createRoot=ns.createRoot,Ar.hydrateRoot=ns.hydrateRoot;/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var oa={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),P=(t,r)=>{const s=c.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:b,className:g="",children:l,...h},d)=>c.createElement("svg",{ref:d,...oa,width:a,height:a,stroke:n,strokeWidth:b?Number(i)*24/Number(a):i,className:["lucide",`lucide-${ga(t)}`,g].join(" "),...h},[...r.map(([y,u])=>c.createElement(y,u)),...Array.isArray(l)?l:[l]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=P("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=P("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=P("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=P("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=P("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=P("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=P("ArrowUpFromLine",[["path",{d:"m18 9-6-6-6 6",key:"kcunyi"}],["path",{d:"M12 3v14",key:"7cf3v8"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=P("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=P("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=P("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=P("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=P("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=P("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=P("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=P("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=P("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=P("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=P("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=P("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=P("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=P("CloudLightning",[["path",{d:"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973",key:"1cez44"}],["path",{d:"m13 12-3 5h4l-3 5",key:"1t22er"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=P("CloudRain",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=P("CloudSnow",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M8 19h.01",key:"puxtts"}],["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M12 21h.01",key:"h35vbk"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M16 19h.01",key:"1vcnzz"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=P("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=P("Columns2",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=P("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=P("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=P("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=P("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=P("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=P("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=P("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=P("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=P("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=P("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=P("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=P("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=P("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=P("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=P("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=P("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=P("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=P("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=P("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=P("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=P("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=P("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=P("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=P("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=P("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=P("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=P("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"bpx1uq"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17",key:"1pd0s7"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7",key:"zq5xbz"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=P("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=P("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=P("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=P("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=P("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=P("Plug",[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=P("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=P("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const za=P("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=P("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=P("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=P("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=P("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=P("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=P("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=P("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Br=P("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=P("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ea=P("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=P("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=P("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=P("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=P("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=P("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fa=P("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=P("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=P("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=P("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=P("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=P("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=P("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Os=c.createContext(void 0);function Wa({children:t}){const[r,s]=c.useState(()=>localStorage.getItem("eedc-theme")||"system"),[n,a]=c.useState(!1);return c.useEffect(()=>{localStorage.setItem("eedc-theme",r);const i=window.document.documentElement;if(r==="system"){const b=window.matchMedia("(prefers-color-scheme: dark)").matches;a(b),i.classList.toggle("dark",b)}else a(r==="dark"),i.classList.toggle("dark",r==="dark")},[r]),c.useEffect(()=>{if(r!=="system")return;const i=window.matchMedia("(prefers-color-scheme: dark)"),b=g=>{a(g.matches),document.documentElement.classList.toggle("dark",g.matches)};return i.addEventListener("change",b),()=>i.removeEventListener("change",b)},[r]),e.jsx(Os.Provider,{value:{theme:r,setTheme:s,isDark:n},children:t})}function Ts(){const t=c.useContext(Os);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const $a=[{name:"Cockpit",basePath:"/cockpit",icon:Cs},{name:"Auswertungen",basePath:"/auswertungen",icon:Pr},{name:"Aussichten",basePath:"/aussichten",icon:be}],Aa=[{category:"Stammdaten",items:[{name:"Anlage",href:"/einstellungen/anlage"},{name:"Strompreise",href:"/einstellungen/strompreise"},{name:"Investitionen",href:"/einstellungen/investitionen"}]},{category:"Daten",items:[{name:"Monatsdaten",href:"/einstellungen/monatsdaten"},{name:"Import",href:"/einstellungen/import"},{name:"Datenerfassung (HA)",href:"/einstellungen/ha-import"},{name:"Demo-Daten",href:"/einstellungen/demo"}]},{category:"System",items:[{name:"PVGIS",href:"/einstellungen/pvgis"},{name:"Allgemein",href:"/einstellungen/allgemein"}]},{category:"Optional",items:[{name:"HA-Export (MQTT)",href:"/einstellungen/ha-export"}]}];function Ma(){const{theme:t,setTheme:r}=Ts(),s=Es(),[n,a]=c.useState(!1),i=c.useRef(null),g=s.pathname.startsWith("/cockpit")?"Cockpit":s.pathname.startsWith("/auswertungen")?"Auswertungen":s.pathname.startsWith("/aussichten")?"Aussichten":s.pathname.startsWith("/einstellungen")?null:"Cockpit";c.useEffect(()=>{const d=y=>{i.current&&!i.current.contains(y.target)&&a(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const l=()=>{r(t==="light"?"dark":t==="dark"?"system":"light")},h=d=>s.pathname===d;return e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"h-8 w-8 text-yellow-500",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),e.jsx("span",{className:"ml-2 text-xl font-bold text-gray-900 dark:text-white",children:"eedc"})]}),e.jsx("nav",{className:"ml-10 flex space-x-1",children:$a.map(d=>{const y=d.icon;return e.jsxs($r,{to:d.basePath,className:()=>`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${g===d.name?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(y,{className:"h-4 w-4"}),d.name]},d.name)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:l,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:`Theme: ${t}`,children:[t==="light"&&e.jsx(ee,{className:"h-5 w-5"}),t==="dark"&&e.jsx(Is,{className:"h-5 w-5"}),t==="system"&&e.jsx(Ds,{className:"h-5 w-5"})]}),e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>a(!n),className:`flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${s.pathname.startsWith("/einstellungen")?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:[e.jsx(Vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Einstellungen"}),e.jsx(gt,{className:`h-4 w-4 transition-transform ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50",children:Aa.map((d,y)=>e.jsxs("div",{children:[y>0&&e.jsx("div",{className:"my-2 border-t border-gray-200 dark:border-gray-700"}),e.jsx("div",{className:"px-3 py-1",children:e.jsx("p",{className:"text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider",children:d.category})}),d.items.map(u=>e.jsx($r,{to:u.href,onClick:()=>a(!1),className:`block px-4 py-2 text-sm transition-colors ${h(u.href)?"bg-primary-50 text-primary-700 dark:bg-primary-900/30 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700"}`,children:u.name},u.href))]},d.category))})]})]})]})})})}const Ca=[{name:"Übersicht",href:"/cockpit",icon:Cs,exact:!0},{name:"PV-Anlage",href:"/cockpit/pv-anlage",icon:ee},{name:"E-Auto",href:"/cockpit/e-auto",icon:Ne},{name:"Wärmepumpe",href:"/cockpit/waermepumpe",icon:Se},{name:"Speicher",href:"/cockpit/speicher",icon:je},{name:"Wallbox",href:"/cockpit/wallbox",icon:at},{name:"Balkonkraftwerk",href:"/cockpit/balkonkraftwerk",icon:ee},{name:"Sonstiges",href:"/cockpit/sonstiges",icon:mr}],La=[],Da=[{name:"Anlage",href:"/einstellungen/anlage",icon:st},{name:"Strompreise",href:"/einstellungen/strompreise",icon:me},{name:"Investitionen",href:"/einstellungen/investitionen",icon:zt},{name:"Monatsdaten",href:"/einstellungen/monatsdaten",icon:Ms},{name:"Import/Export",href:"/einstellungen/import",icon:hr},{name:"PVGIS",href:"/einstellungen/pvgis",icon:ee},{name:"Allgemein",href:"/einstellungen/allgemein",icon:Vs}];function Ia(){const t=Es(),s=t.pathname.startsWith("/cockpit")?Ca:t.pathname.startsWith("/auswertungen")?La:t.pathname.startsWith("/einstellungen")?Da:null;return s?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"px-4 sm:px-6",children:e.jsx("nav",{className:"flex space-x-1 py-2 overflow-x-auto",children:s.map(n=>e.jsxs($r,{to:n.href,end:n.exact,className:({isActive:a})=>`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-colors ${a?"bg-white dark:bg-gray-800 text-primary-700 dark:text-primary-300 shadow-sm":"text-gray-600 hover:bg-white/50 dark:text-gray-400 dark:hover:bg-gray-800/50"}`,children:[e.jsx(n.icon,{className:"h-4 w-4"}),n.name]},n.href))})})}):null}const Pa="1.0.0-beta.9",Va="eedc",Ka="Energie Effizienz Data Center",Ba=`${Va} v${Pa} – ${Ka}`;function Oa(){return e.jsxs("div",{className:"h-screen bg-gray-50 dark:bg-gray-900 flex flex-col overflow-hidden",children:[e.jsx(Ma,{}),e.jsx(Ia,{}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsx(Xs,{})}),e.jsx("footer",{className:"py-2 px-6 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:Ba})})]})}const X=c.forwardRef(({className:t="",variant:r="primary",size:s="md",loading:n,disabled:a,children:i,...b},g)=>{const l="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",h={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",ghost:"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 focus:ring-gray-500"},d={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{ref:g,className:`${l} ${h[r]} ${d[s]} ${t}`,disabled:a||n,...b,children:[n&&e.jsx(ct,{className:"w-4 h-4 mr-2 animate-spin"}),i]})});X.displayName="Button";const M=c.forwardRef(({className:t="",label:r,error:s,hint:n,id:a,...i},b)=>{const g=a||i.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:g,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("input",{ref:b,id:g,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            placeholder-gray-400 dark:placeholder-gray-500
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${s?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...i}),n&&!s&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:n}),s&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s})]})});M.displayName="Input";const Ge=c.forwardRef(({className:t="",label:r,error:s,options:n,placeholder:a,id:i,...b},g)=>{const l=i||b.name;return e.jsxs("div",{className:"w-full",children:[r&&e.jsxs("label",{htmlFor:l,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r,b.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("select",{ref:g,id:l,className:`
            w-full px-3 py-2 rounded-lg border
            bg-white dark:bg-gray-800
            text-gray-900 dark:text-gray-100
            focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent
            disabled:bg-gray-100 dark:disabled:bg-gray-700 disabled:cursor-not-allowed
            ${s?"border-red-500":"border-gray-300 dark:border-gray-600"}
            ${t}
          `,...b,children:[a&&e.jsx("option",{value:"",children:a}),n.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))]}),s&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s})]})});Ge.displayName="Select";function Ze({isOpen:t,onClose:r,title:s,children:n,size:a="md"}){if(c.useEffect(()=>{const b=g=>{g.key==="Escape"&&r()};return t&&(document.addEventListener("keydown",b),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",b),document.body.style.overflow=""}},[t,r]),!t)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:r}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:`relative w-full ${i[a]} bg-white dark:bg-gray-800 rounded-xl shadow-xl`,onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s}),e.jsx("button",{onClick:r,className:"p-1 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx(At,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4",children:n})]})})]})}function S({children:t,className:r="",padding:s="md"}){const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return e.jsx("div",{className:`
        bg-white dark:bg-gray-800 rounded-xl shadow-sm
        border border-gray-200 dark:border-gray-700
        ${n[s]}
        ${r}
      `,children:t})}function re({type:t,title:r,children:s,onClose:n,className:a=""}){const i={info:{bg:"bg-blue-50 dark:bg-blue-900/20",border:"border-blue-200 dark:border-blue-800",text:"text-blue-700 dark:text-blue-300",icon:Oe},success:{bg:"bg-green-50 dark:bg-green-900/20",border:"border-green-200 dark:border-green-800",text:"text-green-700 dark:text-green-300",icon:et},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20",border:"border-yellow-200 dark:border-yellow-800",text:"text-yellow-700 dark:text-yellow-300",icon:Me},error:{bg:"bg-red-50 dark:bg-red-900/20",border:"border-red-200 dark:border-red-800",text:"text-red-700 dark:text-red-300",icon:br}},{bg:b,border:g,text:l,icon:h}=i[t];return e.jsx("div",{className:`${b} ${g} border rounded-lg p-4 relative ${a}`,children:e.jsxs("div",{className:"flex",children:[e.jsx(h,{className:`w-5 h-5 ${l} flex-shrink-0`}),e.jsxs("div",{className:"ml-3 flex-1",children:[r&&e.jsx("h4",{className:`text-sm font-medium ${l}`,children:r}),e.jsx("div",{className:`text-sm ${l} ${r?"mt-1":""}`,children:s})]}),n&&e.jsx("button",{onClick:n,className:`ml-3 ${l} hover:opacity-70 transition-opacity`,children:e.jsx(At,{className:"w-4 h-4"})})]})})}function Tr({children:t,className:r=""}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:`min-w-full divide-y divide-gray-200 dark:divide-gray-700 ${r}`,children:t})})}function Rr({children:t}){return e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t})}function Hr({children:t}){return e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function Mt({children:t,onClick:r,className:s=""}){return e.jsx("tr",{className:`${r?"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800":""} ${s}`,onClick:r,children:t})}function Pe({children:t,className:r=""}){return e.jsx("th",{scope:"col",className:`px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider ${r}`,children:t})}function Ve({children:t,className:r=""}){return e.jsx("td",{className:`px-4 py-3 text-sm text-gray-900 dark:text-gray-100 whitespace-nowrap ${r}`,children:t})}function Ct({icon:t,title:r,description:s,action:n}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4",children:e.jsx(t,{className:"h-6 w-6 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4 max-w-md mx-auto",children:s}),n&&e.jsx("div",{children:n})]})}function xe({size:t="md",text:r}){const s={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(ct,{className:`${s[t]} text-primary-600 animate-spin`}),r&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:r})]})}function kt({children:t,formel:r,berechnung:s,ergebnis:n,className:a="",showIcon:i=!0}){const[b,g]=c.useState(!1),[l,h]=c.useState("top"),d=c.useRef(null);return c.useEffect(()=>{if(b&&d.current){const y=d.current.getBoundingClientRect();h(y.top<120?"bottom":"top")}},[b]),e.jsxs("span",{ref:d,className:`relative inline-block cursor-help ${a}`,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[t,i&&e.jsx(Oe,{className:"inline-block w-3.5 h-3.5 ml-1 text-gray-400 opacity-60"}),b&&e.jsxs("div",{className:`absolute z-50 px-3 py-2 text-sm bg-gray-900 dark:bg-gray-950 text-white rounded-lg shadow-lg
            ${l==="top"?"bottom-full mb-2":"top-full mt-2"}
            left-1/2 -translate-x-1/2
          `,style:{minWidth:"200px",maxWidth:"350px",whiteSpace:"normal"},children:[e.jsx("div",{className:`absolute left-1/2 -translate-x-1/2 w-0 h-0
              border-l-[6px] border-l-transparent
              border-r-[6px] border-r-transparent
              ${l==="top"?"top-full border-t-[6px] border-t-gray-900 dark:border-t-gray-950":"bottom-full border-b-[6px] border-b-gray-900 dark:border-b-gray-950"}
            `}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-300 text-xs uppercase tracking-wide",children:"Formel"}),e.jsx("div",{className:"text-gray-100",children:r}),s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-blue-300 text-xs uppercase tracking-wide mt-2",children:"Berechnung"}),e.jsx("div",{className:"text-gray-200 font-mono text-xs",children:s})]}),n&&e.jsx("div",{className:"text-green-300 font-semibold mt-1 border-t border-gray-700 pt-1",children:n})]})]})]})}function N(t,r=2){return t==null||isNaN(t)?"?":t.toLocaleString("de-DE",{minimumFractionDigits:r,maximumFractionDigits:r})}const Ta={blue:{icon:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},green:{icon:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},yellow:{icon:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-900/20"},red:{icon:"text-red-500",bg:"bg-red-50 dark:bg-red-900/20"},purple:{icon:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},orange:{icon:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},gray:{icon:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-800"}};function ue({title:t,value:r,unit:s,subtitle:n,icon:a,color:i="blue",trend:b,formel:g,berechnung:l,ergebnis:h}){const d=Ta[i],y=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[typeof r=="number"?r.toLocaleString("de-DE"):r,s&&e.jsx("span",{className:"text-sm font-normal ml-1",children:s}),b==="up"&&e.jsx("span",{className:"ml-2 text-green-500",children:"↑"}),b==="down"&&e.jsx("span",{className:"ml-2 text-red-500",children:"↓"})]});return e.jsx(S,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-1",children:g?e.jsx(kt,{formel:g,berechnung:l,ergebnis:h,children:y}):y}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${d.bg} ml-3 flex-shrink-0`,children:e.jsx(a,{className:`h-6 w-6 ${d.icon}`})})]})})}const Ra="./api";class Ha{constructor(r=Ra){as(this,"baseUrl");this.baseUrl=r}async request(r,s={}){const n=`${this.baseUrl}${r}`,a={headers:{"Content-Type":"application/json",...s.headers},...s},i=await fetch(n,a);if(!i.ok){const b={detail:"Ein Fehler ist aufgetreten",status:i.status};try{const g=await i.json();b.detail=g.detail||b.detail}catch{}throw b}if(i.status!==204)return i.json()}async get(r){return this.request(r,{method:"GET"})}async post(r,s){return this.request(r,{method:"POST",body:s?JSON.stringify(s):void 0})}async put(r,s){return this.request(r,{method:"PUT",body:JSON.stringify(s)})}async delete(r){return this.request(r,{method:"DELETE"})}async patch(r,s){return this.request(r,{method:"PATCH",body:JSON.stringify(s)})}async upload(r,s,n="file"){const a=new FormData;return a.append(n,s),this.request(r,{method:"POST",headers:{},body:a})}}const O=new Ha,tt={async list(){return O.get("/anlagen/")},async get(t){return O.get(`/anlagen/${t}`)},async create(t){return O.post("/anlagen/",t)},async update(t,r){return O.put(`/anlagen/${t}`,r)},async delete(t){return O.delete(`/anlagen/${t}`)},async getSensorConfig(t){return O.get(`/anlagen/${t}/sensors`)},async updateSensorConfig(t,r){return O.patch(`/anlagen/${t}/sensors`,r)},async geocode(t,r){const s=new URLSearchParams({plz:t});return r&&s.append("ort",r),O.get(`/anlagen/geocode/lookup?${s}`)}},Ft={async list(t,r){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("jahr",r.toString());const n=s.toString();return O.get(`/monatsdaten/${n?"?"+n:""}`)},async get(t){return O.get(`/monatsdaten/${t}`)},async create(t){return O.post("/monatsdaten/",t)},async update(t,r){return O.put(`/monatsdaten/${t}`,r)},async delete(t){return O.delete(`/monatsdaten/${t}`)},async listAggregiert(t,r){const s=r?`?jahr=${r}`:"";return O.get(`/monatsdaten/aggregiert/${t}${s}`)}},Ee={async getTypen(){return O.get("/investitionen/typen")},async list(t,r,s){const n=new URLSearchParams;t&&n.append("anlage_id",t.toString()),r&&n.append("typ",r),s!==void 0&&n.append("aktiv",s.toString());const a=n.toString();return O.get(`/investitionen/${a?"?"+a:""}`)},async get(t){return O.get(`/investitionen/${t}`)},async create(t){return O.post("/investitionen/",t)},async update(t,r){return O.put(`/investitionen/${t}`,r)},async delete(t){return O.delete(`/investitionen/${t}`)},async getROIDashboard(t,r,s,n,a){const i=new URLSearchParams;r&&i.append("strompreis_cent",r.toString()),s&&i.append("einspeiseverguetung_cent",s.toString()),n&&i.append("benzinpreis_euro",n.toString()),a&&a!=="all"&&i.append("jahr",a.toString());const b=i.toString();return O.get(`/investitionen/roi/${t}${b?"?"+b:""}`)},async getEAutoDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("benzinpreis_euro",s.toString());const a=n.toString();return O.get(`/investitionen/dashboard/e-auto/${t}${a?"?"+a:""}`)},async getWaermepumpeDashboard(t,r){const s=new URLSearchParams;r&&s.append("strompreis_cent",r.toString());const n=s.toString();return O.get(`/investitionen/dashboard/waermepumpe/${t}${n?"?"+n:""}`)},async getSpeicherDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("einspeiseverguetung_cent",s.toString());const a=n.toString();return O.get(`/investitionen/dashboard/speicher/${t}${a?"?"+a:""}`)},async getWallboxDashboard(t){return O.get(`/investitionen/dashboard/wallbox/${t}`)},async getBalkonkraftwerkDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("einspeiseverguetung_cent",s.toString());const a=n.toString();return O.get(`/investitionen/dashboard/balkonkraftwerk/${t}${a?"?"+a:""}`)},async getSonstigesDashboard(t,r,s){const n=new URLSearchParams;r&&n.append("strompreis_cent",r.toString()),s&&n.append("einspeiseverguetung_cent",s.toString());const a=n.toString();return O.get(`/investitionen/dashboard/sonstiges/${t}${a?"?"+a:""}`)},async getMonatsdatenByMonth(t,r,s){return O.get(`/investitionen/monatsdaten/${t}/${r}/${s}`)}},Wt={async list(t,r){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("aktuell","true");const n=s.toString();return O.get(`/strompreise/${n?"?"+n:""}`)},async getAktuell(t){return O.get(`/strompreise/aktuell/${t}`)},async get(t){return O.get(`/strompreise/${t}`)},async create(t){return O.post("/strompreise/",t)},async update(t,r){return O.put(`/strompreise/${t}`,r)},async delete(t){return O.delete(`/strompreise/${t}`)}},mt="./api",pt={async getTemplateInfo(t){const r=await fetch(`${mt}/import/template/${t}`);if(!r.ok)throw new Error("Fehler beim Laden des Templates");return r.json()},getTemplateDownloadUrl(t){return`${mt}/import/template/${t}/download`},async importCSV(t,r,s=!1){const n=new FormData;n.append("file",r);const a=new URLSearchParams;s&&a.append("ueberschreiben","true");const i=await fetch(`${mt}/import/csv/${t}?${a.toString()}`,{method:"POST",body:n});if(!i.ok){const b=await i.json();throw new Error(b.detail||"Import fehlgeschlagen")}return i.json()},getExportUrl(t,r){const s=new URLSearchParams;r&&s.append("jahr",r.toString());const n=s.toString();return`${mt}/import/export/${t}${n?"?"+n:""}`},async createDemoData(){const t=await fetch(`${mt}/import/demo`,{method:"POST"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht erstellt werden")}return t.json()},async deleteDemoData(){const t=await fetch(`${mt}/import/demo`,{method:"DELETE"});if(!t.ok){const r=await t.json();throw new Error(r.detail||"Demo-Daten konnten nicht gelöscht werden")}return t.json()},getFullExportUrl(t){return`${mt}/import/export/${t}/full`},async importJSON(t,r=!1){const s=new FormData;s.append("file",t);const n=new URLSearchParams;r&&n.append("ueberschreiben","true");const a=await fetch(`${mt}/import/json?${n.toString()}`,{method:"POST",body:s});if(!a.ok){const i=await a.json();throw new Error(i.detail||"JSON-Import fehlgeschlagen")}return a.json()}},ds={async health(){return O.get("/health")},async getSettings(){return O.get("/settings")},async getStats(){return O.get("/stats")}},Qe={async getPrognose(t,r={}){const s=new URLSearchParams;r.system_losses!==void 0&&s.set("system_losses",r.system_losses.toString());const n=s.toString();return O.get(`/pvgis/prognose/${t}${n?`?${n}`:""}`)},async getModulPrognose(t,r={}){const s=new URLSearchParams;r.system_losses!==void 0&&s.set("system_losses",r.system_losses.toString());const n=s.toString();return O.get(`/pvgis/modul/${t}${n?`?${n}`:""}`)},async speicherePrognose(t,r={}){const s=new URLSearchParams;r.system_losses!==void 0&&s.set("system_losses",r.system_losses.toString());const n=s.toString();return O.post(`/pvgis/prognose/${t}/speichern${n?`?${n}`:""}`)},async listeGespeichertePrognosen(t){return O.get(`/pvgis/prognose/${t}/gespeichert`)},async getAktivePrognose(t){return O.get(`/pvgis/prognose/${t}/aktiv`)},async aktivierePrognose(t){return O.put(`/pvgis/prognose/${t}/aktivieren`,{})},async loeschePrognose(t){return O.delete(`/pvgis/prognose/${t}`)},async getOptimum(t){return O.get(`/pvgis/optimum/${t}`)}},Re={async getStatus(){return O.get("/ha/status")},async getSensors(){return O.get("/ha/sensors")},async getStringSensors(){return O.get("/ha/string-sensors")},async getStringMonatsdaten(t,r){const s=r?`?jahr=${r}`:"";return O.get(`/ha/string-monatsdaten/${t}${s}`)},async createStringMonatsdaten(t){return O.post("/ha/string-monatsdaten",t)},async deleteStringMonatsdaten(t){return O.delete(`/ha/string-monatsdaten/${t}`)},async getImportPreview(t,r){return O.get(`/ha/import/preview/${t}?jahr=${r}`)},async importMonatsdaten(t,r,s,n=!1){return O.post("/ha/import/monatsdaten",{anlage_id:t,jahr:r,monat:s||null,ueberschreiben:n})},async getMonthlyStatistics(t,r,s=1,n,a){return O.post("/ha/statistics/monthly",{statistic_id:t,start_jahr:r,start_monat:s,end_jahr:n,end_monat:a})},async discover(t,r){const s=new URLSearchParams;t&&s.append("anlage_id",t.toString()),r&&s.append("manufacturer",r);const n=s.toString();return O.get(`/ha/discover${n?"?"+n:""}`)},async getMqttConfig(){return O.get("/ha/export/mqtt/config")},async getExportSensors(){return O.get("/ha/export/sensors")},async getAnlageSensors(t){return O.get(`/ha/export/sensors/${t}`)},async getYamlSnippet(t){return O.get(`/ha/export/yaml/${t}`)},async getSensorDefinitions(){return O.get("/ha/export/definitions")},async testMqtt(t){return O.post("/ha/export/mqtt/test",t||{})},async publishMqtt(t,r){return O.post(`/ha/export/mqtt/publish/${t}`,r||{})},async removeMqtt(t,r){return O.delete(`/ha/export/mqtt/remove/${t}`)}},Lt={async getUebersicht(t,r){const s=r?`?jahr=${r}`:"";return O.get(`/cockpit/uebersicht/${t}${s}`)},async getPrognoseVsIst(t,r){return O.get(`/cockpit/prognose-vs-ist/${t}?jahr=${r}`)},async getNachhaltigkeit(t){return O.get(`/cockpit/nachhaltigkeit/${t}`)},async getKomponentenZeitreihe(t,r){const s=r?`?jahr=${r}`:"";return O.get(`/cockpit/komponenten-zeitreihe/${t}${s}`)},async getPVStrings(t,r){const s=r?`?jahr=${r}`:"";return O.get(`/cockpit/pv-strings/${t}${s}`)}},Ga={async getMonatsdaten(t,r,s){return O.get(`/wetter/monat/${t}/${r}/${s}`)},async getMonatsdatenByCoords(t,r,s,n){return O.get(`/wetter/monat/koordinaten/${t}/${r}/${s}/${n}`)}};function Ce(){const[t,r]=c.useState([]),[s,n]=c.useState(!0),[a,i]=c.useState(null),b=c.useCallback(async()=>{try{n(!0),i(null);const d=await tt.list();r(d)}catch(d){i(d instanceof Error?d.message:"Fehler beim Laden der Anlagen")}finally{n(!1)}},[]);c.useEffect(()=>{b()},[b]);const g=c.useCallback(async d=>{const y=await tt.create(d);return r(u=>[...u,y]),y},[]),l=c.useCallback(async(d,y)=>{const u=await tt.update(d,y);return r(m=>m.map(p=>p.id===d?u:p)),u},[]),h=c.useCallback(async d=>{await tt.delete(d),r(y=>y.filter(u=>u.id!==d))},[]);return{anlagen:t,loading:s,error:a,refresh:b,createAnlage:g,updateAnlage:l,deleteAnlage:h}}function Gr(t,r){const[s,n]=c.useState([]),[a,i]=c.useState(!0),[b,g]=c.useState(null),l=c.useCallback(async()=>{try{i(!0),g(null);const u=await Ft.list(t,r);n(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden der Monatsdaten")}finally{i(!1)}},[t,r]);c.useEffect(()=>{l()},[l]);const h=c.useCallback(async u=>{const m=await Ft.create(u);return n(p=>[m,...p]),m},[]),d=c.useCallback(async(u,m)=>{const p=await Ft.update(u,m);return n(k=>k.map(v=>v.id===u?p:v)),p},[]),y=c.useCallback(async u=>{await Ft.delete(u),n(m=>m.filter(p=>p.id!==u))},[]);return{monatsdaten:s,loading:a,error:b,refresh:l,createMonatsdaten:h,updateMonatsdaten:d,deleteMonatsdaten:y}}function Rs(t){return{gesamtErzeugung:t.reduce((r,s)=>r+(s.pv_erzeugung_kwh||0),0),gesamtEinspeisung:t.reduce((r,s)=>r+s.einspeisung_kwh,0),gesamtNetzbezug:t.reduce((r,s)=>r+s.netzbezug_kwh,0),gesamtEigenverbrauch:t.reduce((r,s)=>r+(s.eigenverbrauch_kwh||0),0),durchschnittAutarkie:t.length>0?t.reduce((r,s)=>{const n=s.eigenverbrauch_kwh||0,a=(s.eigenverbrauch_kwh||0)+s.netzbezug_kwh;return r+(a>0?n/a*100:0)},0)/t.length:0,anzahlMonate:t.length}}function rr(t,r){const[s,n]=c.useState([]),[a,i]=c.useState(!0),[b,g]=c.useState(null),l=c.useCallback(async()=>{try{i(!0),g(null);const u=await Ee.list(t,r);n(u)}catch(u){g(u instanceof Error?u.message:"Fehler beim Laden der Investitionen")}finally{i(!1)}},[t,r]);c.useEffect(()=>{l()},[l]);const h=c.useCallback(async u=>{const m=await Ee.create(u);return n(p=>[...p,m]),m},[]),d=c.useCallback(async(u,m)=>{const p=await Ee.update(u,m);return n(k=>k.map(v=>v.id===u?p:v)),p},[]),y=c.useCallback(async u=>{await Ee.delete(u),n(m=>m.filter(p=>p.id!==u))},[]);return{investitionen:s,loading:a,error:b,refresh:l,createInvestition:h,updateInvestition:d,deleteInvestition:y}}function Ja(t){return t.reduce((s,n)=>(s[n.typ]||(s[n.typ]=[]),s[n.typ].push(n),s),{})}function qa(t){const[r,s]=c.useState([]),[n,a]=c.useState(!0),[i,b]=c.useState(null),g=c.useCallback(async()=>{try{a(!0),b(null);const y=await Wt.list(t);s(y)}catch(y){b(y instanceof Error?y.message:"Fehler beim Laden der Strompreise")}finally{a(!1)}},[t]);c.useEffect(()=>{g()},[g]);const l=c.useCallback(async y=>{const u=await Wt.create(y);return s(m=>[u,...m]),u},[]),h=c.useCallback(async(y,u)=>{const m=await Wt.update(y,u);return s(p=>p.map(k=>k.id===y?m:k)),m},[]),d=c.useCallback(async y=>{await Wt.delete(y),s(u=>u.filter(m=>m.id!==y))},[]);return{strompreise:r,loading:n,error:i,refresh:g,createStrompreis:l,updateStrompreis:h,deleteStrompreis:d}}function Hs(t){const[r,s]=c.useState(null),[n,a]=c.useState(!1),[i,b]=c.useState(null);return c.useEffect(()=>{if(t===null){s(null);return}(async()=>{try{a(!0),b(null);const l=await Wt.getAktuell(t);s(l)}catch{s(null)}finally{a(!1)}})()},[t]),{strompreis:r,loading:n,error:i}}const yr={pv_erzeugung:null,einspeisung:null,netzbezug:null,batterie_ladung:null,batterie_entladung:null};function Za(){const[t,r]=c.useState("idle"),[s,n]=c.useState(null),[a,i]=c.useState(new Set),[b,g]=c.useState(yr),[l,h]=c.useState(null),d=c.useCallback(async f=>{r("scanning"),h(null);try{const x=await Re.discover(f);if(n(x),!x.ha_connected){h("Keine Verbindung zu Home Assistant"),r("error");return}const o=new Set;for(const E of x.devices)!E.already_configured&&E.suggested_investition_typ&&o.add(E.id);i(o),g({pv_erzeugung:x.current_mappings.pv_erzeugung,einspeisung:x.current_mappings.einspeisung,netzbezug:x.current_mappings.netzbezug,batterie_ladung:x.current_mappings.batterie_ladung,batterie_entladung:x.current_mappings.batterie_entladung}),r("results")}catch(x){h(x instanceof Error?x.message:"Discovery fehlgeschlagen"),r("error")}},[]),y=c.useCallback(f=>{i(x=>{const o=new Set(x);return o.has(f)?o.delete(f):o.add(f),o})},[]),u=c.useCallback(()=>{if(!s)return;const f=new Set(s.devices.filter(x=>!x.already_configured&&x.suggested_investition_typ).map(x=>x.id));i(f)},[s]),m=c.useCallback(()=>{i(new Set)},[]),p=c.useCallback((f,x)=>{g(o=>({...o,[f]:x}))},[]),k=c.useCallback(()=>{if(!s)return;const f={...yr},{sensor_mappings:x}=s;x.pv_erzeugung.length>0&&(f.pv_erzeugung=x.pv_erzeugung[0].entity_id),x.einspeisung.length>0&&(f.einspeisung=x.einspeisung[0].entity_id),x.netzbezug.length>0&&(f.netzbezug=x.netzbezug[0].entity_id),x.batterie_ladung.length>0&&(f.batterie_ladung=x.batterie_ladung[0].entity_id),x.batterie_entladung.length>0&&(f.batterie_entladung=x.batterie_entladung[0].entity_id),g(f)},[s]),v=c.useCallback(f=>{r(f)},[]),j=c.useCallback(()=>{r("idle"),n(null),i(new Set),g(yr),h(null)},[]),_=(s==null?void 0:s.devices.filter(f=>a.has(f.id)&&!f.already_configured&&f.suggested_investition_typ))??[],w=a.size>0||Object.values(b).some((f,x)=>{const o=s!=null&&s.current_mappings?[s.current_mappings.pv_erzeugung,s.current_mappings.einspeisung,s.current_mappings.netzbezug,s.current_mappings.batterie_ladung,s.current_mappings.batterie_entladung]:[null,null,null,null,null];return f!==o[x]});return{step:t,discoveryResult:s,selectedDevices:a,selectedMappings:b,error:l,startDiscovery:d,toggleDevice:y,selectAllDevices:u,deselectAllDevices:m,setMapping:p,applyBestMappings:k,goToStep:v,reset:j,devicesToCreate:_,hasChanges:w}}const vt={netzbezug_arbeitspreis_cent_kwh:30,einspeiseverguetung_cent_kwh:8.2,grundpreis_euro_monat:12};function Gs(t){return t<=10?8.2:t<=40?7.1:5.8}const jr="eedc_setup_wizard_state",cs={completed:!1,currentStep:"welcome",anlageId:null,strompreisId:null,createdInvestitionen:[],skippedSteps:[]},wt=["welcome","anlage","ha-connection","strompreise","discovery","investitionen","summary","complete"],Js=["wechselrichter","pv-module","speicher","wallbox","e-auto","waermepumpe","balkonkraftwerk","sonstiges"],ot={wechselrichter:"Wechselrichter","pv-module":"PV-Module",speicher:"Speicher",wallbox:"Wallbox","e-auto":"E-Auto",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},Ua={"pv-module":"wechselrichter",speicher:"wechselrichter"},Ya=["pv-module"];function Qa(){const[t,r]=c.useState(()=>{try{const H=localStorage.getItem(jr);if(H)return JSON.parse(H)}catch{}return cs}),[s,n]=c.useState(t.currentStep),[a,i]=c.useState(!1),[b,g]=c.useState(null),[l,h]=c.useState(null),[d,y]=c.useState(null),[u,m]=c.useState(!1),[p,k]=c.useState(null),[v,j]=c.useState(null),[_,w]=c.useState([]),f=c.useRef(new Map);c.useEffect(()=>{localStorage.setItem(jr,JSON.stringify({...t,currentStep:s}))},[t,s]),c.useEffect(()=>{t.anlageId&&!l&&tt.get(t.anlageId).then(h).catch(()=>{})},[t.anlageId,l]);const x=c.useCallback(async()=>{if(t.anlageId)try{const H=await Ee.list(t.anlageId);w(H)}catch{}},[t.anlageId]);c.useEffect(()=>{x()},[x]);const o=c.useCallback(H=>{n(H),g(null)},[]),E=c.useCallback(async()=>{const H=f.current;if(H.size===0)return;const te=[];H.forEach(({data:ce,timer:he},ve)=>{clearTimeout(he),te.push(Ee.update(ve,ce).catch(B=>{console.error(`Fehler beim Update von Investition ${ve}:`,B)}))}),H.clear(),await Promise.all(te),await x()},[x]),D=c.useCallback(async()=>{await E();const H=wt.indexOf(s);H<wt.length-1&&o(wt[H+1])},[s,o,E]),W=c.useCallback(()=>{const H=wt.indexOf(s);H>0&&o(wt[H-1])},[s,o]),J=c.useCallback(()=>{r(H=>({...H,skippedSteps:[...H.skippedSteps,s]})),D()},[s,D]),K=c.useCallback(async(H,te)=>{try{const ce=await tt.geocode(H,te);return{latitude:ce.latitude,longitude:ce.longitude}}catch{return null}},[]),C=c.useCallback(async H=>{i(!0),g(null);try{const te=await tt.create(H);h(te),r(ce=>({...ce,anlageId:te.id})),D()}catch(te){g(te instanceof Error?te.message:"Fehler beim Erstellen der Anlage")}finally{i(!1)}},[D]),q=c.useCallback(async()=>{i(!0),g(null);try{const H=await Re.getStatus();m(H.connected),k(H.ha_version||null),H.connected||g("Keine Verbindung zu Home Assistant. Sie können diesen Schritt überspringen und später konfigurieren.")}catch{m(!1),g("Home Assistant nicht erreichbar. Läuft EEDC als Add-on?")}finally{i(!1)}},[]),F=c.useCallback(async H=>{if(!t.anlageId){g("Keine Anlage vorhanden");return}i(!0),g(null);try{const te=await Wt.create({anlage_id:t.anlageId,...H});y(te),r(ce=>({...ce,strompreisId:te.id})),D()}catch(te){g(te instanceof Error?te.message:"Fehler beim Erstellen des Stromtarifs")}finally{i(!1)}},[t.anlageId,D]),Q=c.useCallback(async()=>{if(!t.anlageId||!l){g("Keine Anlage vorhanden");return}const H=Gs(l.leistung_kwp);await F({netzbezug_arbeitspreis_cent_kwh:vt.netzbezug_arbeitspreis_cent_kwh,einspeiseverguetung_cent_kwh:H,grundpreis_euro_monat:vt.grundpreis_euro_monat,gueltig_ab:l.installationsdatum||new Date().toISOString().split("T")[0],tarifname:"Standard-Tarif"})},[t.anlageId,l,F]),A=c.useCallback(async()=>{if(!t.anlageId){g("Keine Anlage vorhanden");return}i(!0),g(null);try{const H=(l==null?void 0:l.wechselrichter_hersteller)||void 0,te=await Re.discover(t.anlageId,H);if(j(te),!te.ha_connected){D();return}const ce=[];for(const he of te.devices)if(!(he.already_configured||!he.suggested_investition_typ))try{const ve={anlage_id:t.anlageId,typ:he.suggested_investition_typ,bezeichnung:he.name,parameter:he.suggested_parameters||{},aktiv:!0},B=await Ee.create(ve);ce.push(B.id)}catch{}r(he=>({...he,createdInvestitionen:[...he.createdInvestitionen,...ce]})),await x(),D()}catch(H){g(H instanceof Error?H.message:"Discovery fehlgeschlagen")}finally{i(!1)}},[t.anlageId,l,D,x]),ae=c.useCallback(async(H,te)=>{w(B=>B.map($=>$.id!==H?$:{...$,...te,parameter:te.parameter?{...$.parameter||{},...te.parameter}:$.parameter}));const ce=f.current.get(H);ce!=null&&ce.timer&&clearTimeout(ce.timer);const he=ce!=null&&ce.data?{...ce.data,...te,parameter:te.parameter?{...ce.data.parameter||{},...te.parameter}:ce.data.parameter}:te,ve=setTimeout(async()=>{f.current.delete(H);try{await Ee.update(H,he)}catch(B){g(B instanceof Error?B.message:"Fehler beim Aktualisieren"),await x()}},500);f.current.set(H,{data:he,timer:ve})},[x]),V=c.useCallback(async H=>{try{await Ee.delete(H),await x()}catch(te){g(te instanceof Error?te.message:"Fehler beim Löschen")}},[x]),L=c.useCallback(async H=>{if(!t.anlageId)throw new Error("Keine Anlage vorhanden");g(null);try{const te=await Ee.create({anlage_id:t.anlageId,typ:H,bezeichnung:`Neue ${ot[H]}`,aktiv:!0});return await x(),te}catch(te){const ce=te instanceof Error?te.message:"Fehler beim Hinzufügen";throw g(ce),te}},[t.anlageId,x]),R=c.useCallback(()=>{r(H=>({...H,completed:!0,currentStep:"complete"})),n("complete")},[]),ne=c.useCallback(()=>{localStorage.removeItem(jr),r(cs),n("welcome"),h(null),y(null),j(null),w([]),g(null)},[]),oe=(()=>{switch(s){case"welcome":return!0;case"anlage":return!!t.anlageId;case"ha-connection":return!0;case"strompreise":return!!t.strompreisId;case"discovery":return!0;case"investitionen":return!0;case"summary":return!0;default:return!1}})(),we=Math.round(wt.indexOf(s)/(wt.length-1)*100);return{step:s,wizardState:t,isLoading:a,error:b,anlage:l,strompreis:d,haConnected:u,haVersion:p,discoveryResult:v,investitionen:_,refreshInvestitionen:x,goToStep:o,nextStep:D,prevStep:W,skipStep:J,createAnlage:C,geocodeAddress:K,checkHAConnection:q,createStrompreis:F,useDefaultStrompreise:Q,runDiscoveryAndCreateInvestitionen:A,updateInvestition:ae,deleteInvestition:V,addInvestition:L,completeWizard:R,resetWizard:ne,canProceed:oe,progress:we}}function Xa(){var k,v,j,_,w,f,x;const t=er(),{anlagen:r,loading:s}=Ce(),[n,a]=c.useState(null),[i,b]=c.useState(!1),[g,l]=c.useState(null),[h,d]=c.useState(void 0),[y,u]=c.useState([]),m=(k=r[0])==null?void 0:k.id;if(c.useEffect(()=>{if(!m)return;(async()=>{b(!0),l(null);try{const E=await Lt.getUebersicht(m,h);if(a(E),E.zeitraum_von&&E.zeitraum_bis){const D=parseInt(E.zeitraum_von.split("-")[0]),W=parseInt(E.zeitraum_bis.split("-")[0]),J=[];for(let K=D;K<=W;K++)J.push(K);u(J)}}catch(E){l("Fehler beim Laden der Daten"),console.error(E)}finally{b(!1)}})()},[m,h]),s||i)return e.jsx(xe,{text:"Lade Dashboard..."});if(r.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsx(en,{})]});if(g||!n)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs(S,{children:[e.jsx("p",{className:"text-red-500",children:g||"Keine Daten verfügbar"}),e.jsx(X,{onClick:()=>t("/einstellungen/monatsdaten"),className:"mt-4",children:"Monatsdaten erfassen"})]})]});const p=r[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"h-8 w-8 text-primary-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Übersicht"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[p.anlagenname," • ",n.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:h||"",onChange:o=>d(o.target.value?parseInt(o.target.value):void 0),className:"input py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Alle Jahre"}),y.map(o=>e.jsx("option",{value:o,children:o},o))]})]})]}),n.zeitraum_von&&n.zeitraum_bis&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Zeitraum: ",n.zeitraum_von," bis ",n.zeitraum_bis," (",n.anzahl_monate," Monate)"]}),e.jsx(ir,{title:"Energie-Bilanz",icon:me,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"PV-Erzeugung",value:(n.pv_erzeugung_kwh/1e3).toFixed(1),unit:"MWh",icon:ee,color:"text-energy-solar",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",onClick:()=>t("/cockpit/pv-anlage"),formel:"Σ PV-Erzeugung aller Monate",berechnung:`${N(n.pv_erzeugung_kwh,0)} kWh`,ergebnis:`= ${N(n.pv_erzeugung_kwh/1e3,1)} MWh`}),e.jsx(fe,{title:"Gesamtverbrauch",value:(n.gesamtverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:st,color:"text-energy-consumption",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch + Netzbezug",berechnung:`${N(n.eigenverbrauch_kwh,0)} + ${N(n.netzbezug_kwh,0)} kWh`,ergebnis:`= ${N(n.gesamtverbrauch_kwh/1e3,1)} MWh`}),e.jsx(fe,{title:"Netzbezug",value:(n.netzbezug_kwh/1e3).toFixed(1),unit:"MWh",icon:Mr,color:"text-energy-grid",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Netzbezug aller Monate",berechnung:`${N(n.netzbezug_kwh,0)} kWh`,ergebnis:`= ${N(n.netzbezug_kwh/1e3,1)} MWh`}),e.jsx(fe,{title:"Einspeisung",value:(n.einspeisung_kwh/1e3).toFixed(1),unit:"MWh",icon:xr,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einspeisung aller Monate",berechnung:`${N(n.einspeisung_kwh,0)} kWh`,ergebnis:`= ${N(n.einspeisung_kwh/1e3,1)} MWh`})]})}),e.jsx(ir,{title:"Effizienz-Quoten",icon:va,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Autarkie",value:n.autarkie_prozent.toFixed(1),unit:"%",subtitle:"Unabhängigkeit vom Netz",icon:nr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:`${N(n.eigenverbrauch_kwh,0)} ÷ ${N(n.gesamtverbrauch_kwh,0)} × 100`,ergebnis:`= ${N(n.autarkie_prozent,1)} %`}),e.jsx(fe,{title:"Eigenverbrauchsquote",value:n.eigenverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Selbst genutzte PV",icon:me,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${N(n.eigenverbrauch_kwh,0)} ÷ ${N(n.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${N(n.eigenverbrauch_quote_prozent,1)} %`}),e.jsx(fe,{title:"Direktverbrauchsquote",value:n.direktverbrauch_quote_prozent.toFixed(1),unit:"%",subtitle:"Ohne Speicher-Umweg",icon:be,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Direktverbrauch ÷ Erzeugung × 100",berechnung:`${N(n.direktverbrauch_kwh,0)} ÷ ${N(n.pv_erzeugung_kwh,0)} × 100`,ergebnis:`= ${N(n.direktverbrauch_quote_prozent,1)} %`}),e.jsx(fe,{title:"Spez. Ertrag",value:((v=n.spezifischer_ertrag_kwh_kwp)==null?void 0:v.toFixed(0))||"---",unit:"kWh/kWp",subtitle:"Anlageneffizienz",icon:ee,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Erzeugung ÷ Anlagenleistung",berechnung:`${N(n.pv_erzeugung_kwh,0)} kWh ÷ ${N(n.anlagenleistung_kwp,2)} kWp`,ergebnis:`= ${N(n.spezifischer_ertrag_kwh_kwp||0,0)} kWh/kWp`})]})}),n.hat_speicher&&e.jsx(fr,{title:"Speicher",icon:je,onClick:()=>t("/cockpit/speicher"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Ladung gesamt",value:(n.speicher_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:Mr,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung",berechnung:`${N(n.speicher_ladung_kwh,0)} kWh`,ergebnis:`= ${N(n.speicher_ladung_kwh/1e3,2)} MWh`}),e.jsx(fe,{title:"Entladung gesamt",value:(n.speicher_entladung_kwh/1e3).toFixed(2),unit:"MWh",icon:xr,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung",berechnung:`${N(n.speicher_entladung_kwh,0)} kWh`,ergebnis:`= ${N(n.speicher_entladung_kwh/1e3,2)} MWh`}),e.jsx(fe,{title:"Ø Effizienz",value:((j=n.speicher_effizienz_prozent)==null?void 0:j.toFixed(1))||"---",unit:"%",icon:nr,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${N(n.speicher_entladung_kwh,0)} ÷ ${N(n.speicher_ladung_kwh,0)} × 100`,ergebnis:`= ${N(n.speicher_effizienz_prozent||0,1)} %`}),e.jsx(fe,{title:"Vollzyklen",value:((_=n.speicher_vollzyklen)==null?void 0:_.toFixed(0))||"---",unit:"",subtitle:`${n.speicher_kapazitaet_kwh.toFixed(1)} kWh Kapazität`,icon:je,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Ladung ÷ Kapazität",berechnung:`${N(n.speicher_ladung_kwh,0)} kWh ÷ ${N(n.speicher_kapazitaet_kwh,1)} kWh`,ergebnis:`= ${N(n.speicher_vollzyklen||0,0)} Zyklen`})]})}),n.hat_waermepumpe&&e.jsx(fr,{title:"Wärmepumpe",icon:Se,onClick:()=>t("/cockpit/waermepumpe"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Wärme erzeugt",value:(n.wp_waerme_kwh/1e3).toFixed(2),unit:"MWh",icon:Se,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizung + Warmwasser",berechnung:`${N(n.wp_waerme_kwh,0)} kWh`,ergebnis:`= ${N(n.wp_waerme_kwh/1e3,2)} MWh`}),e.jsx(fe,{title:"Strom verbraucht",value:(n.wp_strom_kwh/1e3).toFixed(2),unit:"MWh",icon:me,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Stromverbrauch",berechnung:`${N(n.wp_strom_kwh,0)} kWh`,ergebnis:`= ${N(n.wp_strom_kwh/1e3,2)} MWh`}),e.jsx(fe,{title:"Ø COP",value:((w=n.wp_cop)==null?void 0:w.toFixed(1))||"---",unit:"",icon:nr,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${N(n.wp_waerme_kwh,0)} ÷ ${N(n.wp_strom_kwh,0)}`,ergebnis:`= ${N(n.wp_cop||0,1)}`}),e.jsx(fe,{title:"Ersparnis vs. Gas",value:n.wp_ersparnis_euro.toFixed(0),unit:"€",icon:Xe,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Gaskosten - Stromkosten",berechnung:`(${N(n.wp_waerme_kwh,0)} kWh ÷ 0.9 × 10ct) - (${N(n.wp_strom_kwh,0)} kWh × Strompreis)`,ergebnis:`= ${N(n.wp_ersparnis_euro,0)} €`})]})}),n.hat_emobilitaet&&e.jsx(fr,{title:"E-Mobilität",icon:Ne,onClick:()=>t("/cockpit/e-auto"),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Gefahrene km",value:(n.emob_km/1e3).toFixed(1),unit:"Tkm",icon:Ne,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene Kilometer",berechnung:`${N(n.emob_km,0)} km`,ergebnis:`= ${N(n.emob_km/1e3,1)} Tkm`}),e.jsx(fe,{title:"Ladung gesamt",value:(n.emob_ladung_kwh/1e3).toFixed(2),unit:"MWh",icon:me,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Heim + Extern Ladung",berechnung:`${N(n.emob_ladung_kwh,0)} kWh`,ergebnis:`= ${N(n.emob_ladung_kwh/1e3,2)} MWh`}),e.jsx(fe,{title:"PV-Anteil",value:((f=n.emob_pv_anteil_prozent)==null?void 0:f.toFixed(0))||"---",unit:"%",icon:ee,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"PV-Ladung ÷ Heimladung × 100",berechnung:"PV-geladene kWh ÷ Gesamt-Ladung",ergebnis:`= ${N(n.emob_pv_anteil_prozent||0,0)} %`}),e.jsx(fe,{title:"Ersparnis vs. Benzin",value:n.emob_ersparnis_euro.toFixed(0),unit:"€",icon:Xe,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Benzinkosten - Stromkosten",berechnung:"Benzin (7L/100km × 1.80€) - Strom",ergebnis:`= ${N(n.emob_ersparnis_euro,0)} €`})]})}),e.jsx(ir,{title:"Finanzen",icon:Xe,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"Einspeiseerlös",value:n.einspeise_erloes_euro.toFixed(0),unit:"€",icon:xr,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Vergütung",berechnung:`${N(n.einspeisung_kwh,0)} kWh × 8.2 ct/kWh`,ergebnis:`= ${N(n.einspeise_erloes_euro,0)} €`}),e.jsx(fe,{title:"EV-Ersparnis",value:n.ev_ersparnis_euro.toFixed(0),unit:"€",icon:me,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Strompreis",berechnung:`${N(n.eigenverbrauch_kwh,0)} kWh × Strompreis`,ergebnis:`= ${N(n.ev_ersparnis_euro,0)} €`}),e.jsx(fe,{title:"Netto-Ertrag",value:n.netto_ertrag_euro.toFixed(0),unit:"€",icon:be,color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Erlös + Ersparnis",berechnung:`${N(n.einspeise_erloes_euro,0)} + ${N(n.ev_ersparnis_euro,0)} €`,ergebnis:`= ${N(n.netto_ertrag_euro,0)} €`}),e.jsx(fe,{title:"Jahres-Rendite",value:((x=n.jahres_rendite_prozent)==null?void 0:x.toFixed(1))||"---",unit:"%",subtitle:`von ${n.investition_gesamt_euro.toFixed(0)} € Invest`,icon:nr,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",onClick:()=>t("/auswertungen/roi"),formel:"Jahres-Ertrag ÷ Investition × 100",berechnung:`${N(n.netto_ertrag_euro,0)} € ÷ ${N(n.investition_gesamt_euro,0)} €`,ergebnis:`= ${N(n.jahres_rendite_prozent||0,1)} % p.a.`})]})}),e.jsx(ir,{title:"CO₂-Bilanz",icon:Ke,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(fe,{title:"CO₂ PV",value:(n.co2_pv_kg/1e3).toFixed(1),unit:"t",subtitle:"Vermiedene Emissionen",icon:ee,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Eigenverbrauch × CO₂-Faktor",berechnung:`${N(n.eigenverbrauch_kwh,0)} kWh × 0.38 kg/kWh`,ergebnis:`= ${N(n.co2_pv_kg,0)} kg`}),e.jsx(fe,{title:"CO₂ Wärmepumpe",value:(n.co2_wp_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Gas-Heizung",icon:Se,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO₂ Gas - CO₂ Strom",berechnung:"Gasverbrauch × 0.201 - WP-Strom × 0.38",ergebnis:`= ${N(n.co2_wp_kg,0)} kg`}),e.jsx(fe,{title:"CO₂ E-Mobilität",value:(n.co2_emob_kg/1e3).toFixed(2),unit:"t",subtitle:"vs. Verbrenner",icon:Ne,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"CO₂ Benzin - CO₂ Strom",berechnung:"Benzinverbrauch × 2.37 - Stromverbrauch × 0.38",ergebnis:`= ${N(n.co2_emob_kg,0)} kg`}),e.jsx(fe,{title:"CO₂ gesamt",value:(n.co2_gesamt_kg/1e3).toFixed(1),unit:"t",subtitle:"Gesamte Einsparung",icon:Ke,color:"text-emerald-600",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ aller CO₂-Einsparungen",berechnung:`${N(n.co2_pv_kg,0)} + ${N(n.co2_wp_kg,0)} + ${N(n.co2_emob_kg,0)} kg`,ergebnis:`= ${N(n.co2_gesamt_kg/1e3,1)} t`})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(wr,{title:"Monatsdaten",description:"Neue Daten erfassen oder CSV importieren",onClick:()=>t("/einstellungen/monatsdaten")}),e.jsx(wr,{title:"Auswertungen",description:"Detaillierte Analysen und Zeitverläufe",onClick:()=>t("/auswertungen")}),e.jsx(wr,{title:"Investitionen",description:"Komponenten verwalten",onClick:()=>t("/einstellungen/investitionen")})]})]})}function ir({title:t,icon:r,children:s}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t})]}),s]})}function fr({title:t,icon:r,onClick:s,children:n}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 group hover:opacity-80 transition-opacity",children:[e.jsx(r,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t}),e.jsx(yt,{className:"h-4 w-4 text-gray-400 group-hover:text-primary-500 transition-colors"})]}),n]})}function fe({title:t,value:r,unit:s,subtitle:n,icon:a,color:i,bgColor:b,onClick:g,formel:l,berechnung:h,ergebnis:d}){const y=e.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal text-gray-500",children:s})]}),u=e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:t}),e.jsx("div",{className:"mt-0.5",children:l?e.jsx(kt,{formel:l,berechnung:h,ergebnis:d,children:y}):y}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate",children:n})]}),e.jsx("div",{className:`p-2 rounded-lg ${b} ml-2 flex-shrink-0`,children:e.jsx(a,{className:`h-5 w-5 ${i}`})})]});return g?e.jsx("button",{onClick:g,className:"card p-3 text-left hover:shadow-md transition-shadow w-full",children:u}):e.jsx(S,{className:"p-3",children:u})}function wr({title:t,description:r,onClick:s}){return e.jsx("button",{onClick:s,className:"card p-4 text-left hover:shadow-md transition-shadow group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),e.jsx($e,{className:"h-5 w-5 text-gray-400 group-hover:text-primary-600 transition-colors"})]})})}function en(){const t=er();return e.jsxs(S,{className:"bg-primary-50 dark:bg-primary-900/20 border-primary-200 dark:border-primary-800",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-900 dark:text-primary-100 mb-4",children:"Willkommen bei eedc!"}),e.jsx("p",{className:"text-primary-700 dark:text-primary-300 mb-4",children:"Starte mit diesen Schritten, um deine PV-Anlage zu analysieren:"}),e.jsxs("ol",{className:"list-decimal list-inside text-primary-700 dark:text-primary-300 space-y-2 mb-6",children:[e.jsx("li",{children:'Lege deine PV-Anlage unter "Anlagen" an'}),e.jsx("li",{children:"Konfiguriere deine Strompreise"}),e.jsx("li",{children:"Erfasse Monatsdaten oder importiere eine CSV"}),e.jsx("li",{children:"Analysiere deine Ergebnisse in den Auswertungen"})]}),e.jsxs(X,{onClick:()=>t("/einstellungen/anlage"),children:["Jetzt starten",e.jsx($e,{className:"h-4 w-4 ml-2"})]})]})}const ut=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function tn({anlageId:t,jahr:r}){var m;const[s,n]=c.useState(null),[a,i]=c.useState(!0),[b,g]=c.useState(null),[l,h]=c.useState(null);c.useEffect(()=>{(async()=>{i(!0),g(null);try{const k=await Lt.getPVStrings(t,r);n(k)}catch(k){g("Fehler beim Laden der String-Daten"),console.error(k)}finally{i(!1)}})()},[t,r]);const d=c.useMemo(()=>s!=null&&s.strings?s.strings.map((p,k)=>({name:p.bezeichnung.length>15?p.bezeichnung.slice(0,15)+"...":p.bezeichnung,fullName:p.bezeichnung,Prognose:p.prognose_jahr_kwh,IST:p.ist_jahr_kwh,Performance:p.performance_ratio_jahr?p.performance_ratio_jahr*100:null,color:ut[k%ut.length]})):[],[s]),y=c.useMemo(()=>{if(!(s!=null&&s.strings)||l===null)return[];const p=s.strings.find(k=>k.investition_id===l);return p?p.monatswerte.map(k=>({name:k.monat_name,Prognose:k.prognose_kwh,IST:k.ist_kwh,Abweichung:k.abweichung_kwh})):[]},[s,l]);if(a)return e.jsx(xe,{text:"Lade String-Vergleich..."});if(b)return e.jsx(re,{type:"error",children:b});if(!s||s.strings.length===0)return e.jsxs(S,{className:"text-center py-8",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen → Investitionen anlegen."})]});if(!s.hat_prognose)return e.jsx(re,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen → PVGIS eine Prognose abrufen."})]})});const u=({ratio:p})=>{if(p===null)return e.jsx("span",{className:"text-gray-400",children:"-"});const k=p*100,v=k>=95,j=k<85;return e.jsxs("span",{className:`flex items-center gap-1 ${v?"text-green-600":j?"text-red-600":"text-amber-600"}`,children:[v?e.jsx(be,{className:"h-4 w-4"}):j?e.jsx(jt,{className:"h-4 w-4"}):null,k.toFixed(0),"%"]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"SOLL (Prognose)"}),e.jsxs("p",{className:"text-xl font-bold text-blue-700 dark:text-blue-300",children:[(s.prognose_gesamt_kwh/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"IST (Erzeugt)"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(s.ist_gesamt_kwh/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${(s.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Abweichung"}),e.jsxs("p",{className:`text-xl font-bold ${(s.abweichung_gesamt_prozent||0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(s.abweichung_gesamt_prozent||0)>=0?"+":"",((m=s.abweichung_gesamt_prozent)==null?void 0:m.toFixed(1))||0,"%"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-700 dark:text-gray-300",children:[s.anlagen_leistung_kwp.toFixed(1)," kWp"]})]})]}),(s.bester_string||s.schlechtester_string)&&s.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[s.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full",children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300",children:["Beste Performance: ",e.jsx("strong",{children:s.bester_string})]})]}),s.schlechtester_string&&s.schlechtester_string!==s.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-full",children:[e.jsx(jt,{className:"h-4 w-4 text-red-600"}),e.jsxs("span",{className:"text-red-700 dark:text-red-300",children:["Schwächster: ",e.jsx("strong",{children:s.schlechtester_string})]})]})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Vergleich: SOLL vs IST"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:d,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{type:"number",unit:" kWh"}),e.jsx(se,{type:"category",dataKey:"name",width:120,tick:{fontSize:11}}),e.jsx(Y,{formatter:(p,k)=>[`${p.toFixed(0)} kWh`,k],labelFormatter:p=>{const k=d.find(v=>v.name===p);return(k==null?void 0:k.fullName)||p}}),e.jsx(pe,{}),e.jsx(G,{dataKey:"Prognose",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(G,{dataKey:"IST",name:"IST (Erzeugt)",children:d.map((p,k)=>e.jsx(We,{fill:p.color},`cell-${k}`))})]})})})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einzelne Strings / Module"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String / Modul"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abw."}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Performance"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.strings.map((p,k)=>{var v,j;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer",onClick:()=>h(l===p.investition_id?null:p.investition_id),children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l===p.investition_id?e.jsx(gt,{className:"h-4 w-4 text-gray-400"}):e.jsx(yt,{className:"h-4 w-4 text-gray-400"}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ut[k%ut.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:p.bezeichnung})]}),p.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-9",children:["→ ",p.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:p.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3 text-gray-600 dark:text-gray-400",children:[p.ausrichtung||"-",p.neigung_grad&&` / ${p.neigung_grad}°`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600 dark:text-blue-400",children:[p.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right font-medium",style:{color:ut[k%ut.length]},children:[p.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right ${(p.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(p.abweichung_jahr_prozent||0)>=0?"+":"",((v=p.abweichung_jahr_prozent)==null?void 0:v.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right",children:e.jsx(u,{ratio:p.performance_ratio_jahr})}),e.jsx("td",{className:"px-3 py-3 text-right text-gray-600 dark:text-gray-400",children:((j=p.spezifischer_ertrag_kwh_kwp)==null?void 0:j.toFixed(0))||"-"})]},p.investition_id),l===p.investition_id&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-3 py-4 bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:["Monatsverlauf: ",p.bezeichnung]}),e.jsx("div",{className:"h-48",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:y,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10}}),e.jsx(se,{unit:" kWh",tick:{fontSize:10}}),e.jsx(Y,{formatter:_=>[`${_.toFixed(0)} kWh`,""]}),e.jsx(pe,{}),e.jsx(G,{dataKey:"Prognose",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(G,{dataKey:"IST",fill:ut[k%ut.length],name:"IST"}),e.jsx(Ae,{type:"monotone",dataKey:"Abweichung",stroke:"#ef4444",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]})},`${p.investition_id}-detail`)]})})})]})})]})]})}const rn=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],dt={solar:"#f59e0b",feedin:"#10b981",consumption:"#8b5cf6"},os=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function sn(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState();c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]);const{investitionen:a,loading:i}=rr(s),{monatsdaten:b,loading:g}=Gr(s),l=Rs(b),{pvSysteme:h,orphanModule:d}=c.useMemo(()=>{const f=[],x=[],o=a.filter(W=>W.typ==="wechselrichter"),E=a.filter(W=>W.typ==="pv-module"),D=a.filter(W=>W.typ==="speicher");for(const W of o){const J=E.filter(q=>q.parent_investition_id===W.id),K=D.filter(q=>q.parent_investition_id===W.id),C=J.reduce((q,F)=>q+(F.leistung_kwp||0),0);f.push({wechselrichter:W,pvModule:J,speicher:K,gesamtKwp:C})}for(const W of E)(!W.parent_investition_id||!o.find(J=>J.id===W.parent_investition_id))&&x.push(W);return{pvSysteme:f,orphanModule:x}},[a]),y=c.useMemo(()=>h.reduce((f,x)=>f+x.gesamtKwp,0)+d.reduce((f,x)=>f+(x.leistung_kwp||0),0),[h,d]),u=y>0?l.gesamtErzeugung/y:0,m=c.useMemo(()=>b.length===0?new Date().getFullYear():Math.max(...b.map(f=>f.jahr)),[b]),p=c.useMemo(()=>[...b].sort((x,o)=>x.jahr!==o.jahr?x.jahr-o.jahr:x.monat-o.monat).slice(-12).map(x=>({name:`${rn[x.monat]} ${x.jahr.toString().slice(-2)}`,Erzeugung:x.pv_erzeugung_kwh,Eigenverbrauch:x.eigenverbrauch_kwh||0,Einspeisung:x.einspeisung_kwh})),[b]),k=c.useMemo(()=>l.gesamtErzeugung===0?[]:[{name:"Eigenverbrauch",value:l.gesamtEigenverbrauch,color:dt.consumption},{name:"Einspeisung",value:l.gesamtEinspeisung,color:dt.feedin}],[l]),v=c.useMemo(()=>{const f=h.flatMap(o=>o.pvModule).concat(d),x={};for(const o of f){const E=o.ausrichtung||"Unbekannt";x[E]||(x[E]={kwp:0,count:0}),x[E].kwp+=o.leistung_kwp||0,x[E].count+=1}return Object.entries(x).map(([o,E],D)=>({ausrichtung:o,kwp:E.kwp,count:E.count,color:os[D%os.length]}))},[h,d]);if(r||i||g)return e.jsx(xe,{text:"Lade PV-Anlage..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]});const _=b.length>0,w=h.length>0||d.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:f=>n(parseInt(f.target.value)),options:t.map(f=>({value:f.id.toString(),label:f.anlagenname}))})]}),d.length>0&&e.jsx(re,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsxs("span",{children:[d.length," PV-Modul(e) ohne Wechselrichter-Zuordnung. Bitte unter Einstellungen → Investitionen zuordnen."]})]})}),!w&&e.jsx(re,{type:"info",children:"Keine PV-Komponenten gefunden. Bitte unter Einstellungen → Investitionen Wechselrichter und PV-Module anlegen."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(ue,{title:"Anlagenleistung",value:y>0?y.toFixed(1):"---",unit:"kWp",subtitle:`${h.length} Wechselrichter, ${h.reduce((f,x)=>f+x.pvModule.length,0)+d.length} Module`,icon:ee,color:"yellow"}),e.jsx(ue,{title:"Gesamterzeugung",value:l.gesamtErzeugung>0?(l.gesamtErzeugung/1e3).toFixed(1):"---",unit:"MWh",subtitle:l.anzahlMonate>0?`${l.anzahlMonate} Monate`:void 0,icon:me,color:"green"}),e.jsx(ue,{title:"Spez. Ertrag",value:u>0?u.toFixed(0):"---",unit:"kWh/kWp",subtitle:l.anzahlMonate>=12?"Jahreswert":`${l.anzahlMonate} Monate`,icon:be,color:"blue",formel:"Spez. Ertrag = Erzeugung ÷ Leistung",berechnung:`${N(l.gesamtErzeugung,0)} kWh ÷ ${N(y,1)} kWp`,ergebnis:`= ${N(u,0)} kWh/kWp`}),e.jsx(ue,{title:"Eigenverbrauch",value:l.gesamtErzeugung>0?(l.gesamtEigenverbrauch/l.gesamtErzeugung*100).toFixed(1):"---",unit:"%",subtitle:`${(l.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:$s,color:"purple",formel:"Eigenverbrauchsquote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${N(l.gesamtEigenverbrauch,0)} kWh ÷ ${N(l.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${N(l.gesamtErzeugung>0?l.gesamtEigenverbrauch/l.gesamtErzeugung*100:0,1)} %`})]}),w&&e.jsxs(S,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Komponenten"}),e.jsxs("div",{className:"space-y-4",children:[h.map(f=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:f.wechselrichter.bezeichnung}),e.jsxs("span",{className:"text-sm text-gray-500",children:[f.gesamtKwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[f.pvModule.map(x=>{var o;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(ee,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:x.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(o=x.leistung_kwp)==null?void 0:o.toFixed(1)," kWp",x.ausrichtung&&` • ${x.ausrichtung}`,x.neigung_grad&&` • ${x.neigung_grad}°`]})]},x.id)}),f.speicher.map(x=>{var o,E;return e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(me,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{children:x.bezeichnung}),e.jsxs("span",{className:"text-gray-400",children:[(E=(o=x.parameter)==null?void 0:o.kapazitaet_kwh)==null?void 0:E.toFixed(1)," kWh"]})]},x.id)}),f.pvModule.length===0&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PV-Module zugeordnet"})]})]})]},f.wechselrichter.id)),d.length>0&&e.jsxs("div",{className:"border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-amber-800 dark:text-amber-200 mb-2 flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Nicht zugeordnete PV-Module"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:d.map(f=>{var x;return e.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-300",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:f.bezeichnung}),e.jsxs("span",{className:"text-amber-500",children:[(x=f.leistung_kwp)==null?void 0:x.toFixed(1)," kWp",f.ausrichtung&&` • ${f.ausrichtung}`]})]},f.id)})})]})]})]}),v.length>1&&e.jsxs(S,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Leistung nach Ausrichtung"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:v,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{type:"number",unit:" kWp"}),e.jsx(se,{type:"category",dataKey:"ausrichtung",width:100}),e.jsx(Y,{formatter:f=>[`${f.toFixed(1)} kWp`,"Leistung"]}),e.jsx(G,{dataKey:"kwp",fill:dt.solar,radius:[0,4,4,0],children:v.map((f,x)=>e.jsx(We,{fill:f.color},`cell-${x}`))})]})})})]}),_&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(S,{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Monatlicher Verlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:p,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",className:"text-xs"}),e.jsx(se,{unit:" kWh",className:"text-xs"}),e.jsx(Y,{contentStyle:{backgroundColor:"var(--tooltip-bg, #fff)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:f=>[`${f.toFixed(0)} kWh`,""]}),e.jsx(pe,{}),e.jsx(Be,{type:"monotone",dataKey:"Erzeugung",stroke:dt.solar,fill:dt.solar,fillOpacity:.3}),e.jsx(Be,{type:"monotone",dataKey:"Eigenverbrauch",stroke:dt.consumption,fill:dt.consumption,fillOpacity:.3}),e.jsx(Be,{type:"monotone",dataKey:"Einspeisung",stroke:dt.feedin,fill:dt.feedin,fillOpacity:.3})]})})})]}),e.jsxs(S,{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Energieverteilung"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsx(lt,{data:k,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,label:({name:f,percent:x})=>`${f}: ${(x*100).toFixed(0)}%`,labelLine:!1,children:k.map((f,x)=>e.jsx(We,{fill:f.color},`cell-${x}`))}),e.jsx(Y,{formatter:f=>[`${f.toFixed(0)} kWh`,""]})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[(l.gesamtEigenverbrauch/1e3).toFixed(1)," MWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[(l.gesamtEinspeisung/1e3).toFixed(1)," MWh"]})]})]})]})]}),!_&&w&&e.jsxs(S,{className:"text-center py-12",children:[e.jsx(Pr,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Monatsdaten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Monatsdaten, um Erzeugungsdaten zu sehen."})]}),w&&_&&s&&e.jsxs(S,{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Dr,{className:"h-5 w-5 text-blue-500"}),"SOLL-IST Vergleich pro String"]}),e.jsx(tn,{anlageId:s,jahr:m})]})]})}const gs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function an(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState([]),[b,g]=c.useState(!1),[l,h]=c.useState(null);return c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{if(!s)return;(async()=>{g(!0),h(null);try{const y=await Ee.getEAutoDashboard(s);i(y)}catch(y){h(y instanceof Error?y.message:"Fehler beim Laden")}finally{g(!1)}})()},[s]),r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"h-8 w-8 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"E-Auto Dashboard"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:t.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),l&&e.jsx(re,{type:"error",children:l}),b?e.jsx(xe,{text:"Lade E-Auto Daten..."}):a.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ne,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein E-Auto für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein E-Auto unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(nn,{dashboard:d},d.investition.id))]})}function nn({dashboard:t}){var l;const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(h=>({name:`${gs[h.monat]} ${h.jahr.toString().slice(2)}`,km:h.verbrauch_daten.km_gefahren||0,verbrauch:h.verbrauch_daten.verbrauch_kwh||0,pv:h.verbrauch_daten.ladung_pv_kwh||0,netz:h.verbrauch_daten.ladung_netz_kwh||0,extern:h.verbrauch_daten.ladung_extern_kwh||0,v2h:h.verbrauch_daten.v2h_entladung_kwh||0})),b=[{name:"Heim: PV",value:a.ladung_pv_kwh||0},{name:"Heim: Netz",value:a.ladung_netz_kwh||0},{name:"Extern",value:a.ladung_extern_kwh||0}].filter(h=>h.value>0),g=[{name:"E-Auto (Strom)",value:a.strom_kosten_gesamt_euro||0,fill:"#22c55e"},{name:"Verbrenner (Benzin)",value:a.benzin_kosten_alternativ_euro||0,fill:"#ef4444"}];return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Ne,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Gefahren",value:((l=a.gesamt_km)==null?void 0:l.toLocaleString("de-DE"))||"0",unit:"km",icon:Ne,color:"blue",formel:"Σ km gefahren",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${(a.gesamt_km||0).toLocaleString("de-DE")} km`}),e.jsx(ue,{title:"Verbrauch",value:(a.durchschnitt_verbrauch_kwh_100km||0).toFixed(1),unit:"kWh/100km",icon:me,color:"yellow",formel:"Verbrauch = kWh ÷ km × 100",berechnung:`${(a.gesamt_verbrauch_kwh||0).toFixed(0)} kWh ÷ ${a.gesamt_km||0} km × 100`,ergebnis:`= ${(a.durchschnitt_verbrauch_kwh_100km||0).toFixed(1)} kWh/100km`}),e.jsx(ue,{title:"PV-Anteil (Heim)",value:(a.pv_anteil_heim_prozent||0).toFixed(0),unit:"%",subtitle:`Gesamt: ${(a.pv_anteil_gesamt_prozent||0).toFixed(0)}%`,icon:Ke,color:"green",formel:"PV-Anteil = PV-Ladung ÷ Heimladung × 100",berechnung:`${(a.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(a.ladung_heim_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(a.pv_anteil_heim_prozent||0).toFixed(1)} %`}),e.jsx(ue,{title:"Ersparnis vs. Benzin",value:(a.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",subtitle:`+ Wallbox: ${(a.wallbox_ersparnis_euro||0).toFixed(0)} €`,icon:be,color:"green",trend:(a.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Benzinkosten − Stromkosten",berechnung:`${(a.benzin_kosten_alternativ_euro||0).toFixed(0)} € − ${(a.strom_kosten_gesamt_euro||0).toFixed(0)} €`,ergebnis:`= ${(a.ersparnis_vs_benzin_euro||0).toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsxs(lt,{data:b,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,percent:d})=>`${h}: ${(d*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"})," ",e.jsx(We,{fill:"#f97316"})," ",e.jsx(We,{fill:"#ef4444"})," "]}),e.jsx(Y,{formatter:h=>`${h.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"PV: ",(a.ladung_pv_kwh||0).toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Netz: ",(a.ladung_netz_kwh||0).toFixed(0)," kWh"]}),(a.ladung_extern_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Extern: ",(a.ladung_extern_kwh||0).toFixed(0)," kWh (",(a.ladung_extern_euro||0).toFixed(2)," €)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich E-Auto vs. Verbrenner"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:g,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{type:"number",tickFormatter:h=>`${h}€`}),e.jsx(se,{type:"category",dataKey:"name",width:120}),e.jsx(Y,{formatter:h=>`${h.toFixed(2)} €`}),e.jsx(G,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",(a.ersparnis_vs_benzin_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kilometer pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(G,{dataKey:"km",fill:"#3b82f6",name:"km"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(G,{dataKey:"pv",stackId:"a",fill:"#22c55e",name:"Heim: PV"}),e.jsx(G,{dataKey:"netz",stackId:"a",fill:"#f97316",name:"Heim: Netz"}),e.jsx(G,{dataKey:"extern",stackId:"a",fill:"#ef4444",name:"Extern"})]})})})]})]}),(a.v2h_entladung_kwh||0)>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-purple-500"}),"Vehicle-to-Home (V2H)"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Entladung"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(a.v2h_entladung_kwh||0).toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"V2H Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[(a.v2h_ersparnis_euro||0).toFixed(2)," €"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[(a.co2_ersparnis_kg||0).toFixed(0)," kg"]})]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"km"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netz"}),e.jsx("th",{className:"text-right py-2 px-2",children:"V2H"})]})}),e.jsx("tbody",{children:s.map(h=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[gs[h.monat]," ",h.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:h.verbrauch_daten.km_gefahren||0}),e.jsx("td",{className:"text-right py-2 px-2",children:(h.verbrauch_daten.verbrauch_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:(h.verbrauch_daten.ladung_pv_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:(h.verbrauch_daten.ladung_netz_kwh||0).toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:(h.verbrauch_daten.v2h_entladung_kwh||0).toFixed(1)})]},h.id))})]})})]})]})}const xs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function ln(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState([]),[b,g]=c.useState(!1),[l,h]=c.useState(null);return c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{if(!s)return;(async()=>{g(!0),h(null);try{const y=await Ee.getWaermepumpeDashboard(s);i(y)}catch(y){h(y instanceof Error?y.message:"Fehler beim Laden")}finally{g(!1)}})()},[s]),r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"h-8 w-8 text-orange-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wärmepumpe Dashboard"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:t.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),l&&e.jsx(re,{type:"error",children:l}),b?e.jsx(xe,{text:"Lade Wärmepumpe Daten..."}):a.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Se,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wärmepumpe für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wärmepumpe unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(dn,{dashboard:d},d.investition.id))]})}function dn({dashboard:t}){const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(l=>({name:`${xs[l.monat]} ${l.jahr.toString().slice(2)}`,strom:l.verbrauch_daten.stromverbrauch_kwh||0,heizung:l.verbrauch_daten.heizenergie_kwh||0,warmwasser:l.verbrauch_daten.warmwasser_kwh||0,cop:((l.verbrauch_daten.heizenergie_kwh||0)+(l.verbrauch_daten.warmwasser_kwh||0))/(l.verbrauch_daten.stromverbrauch_kwh||1)})),b=[{name:"Heizung",value:a.gesamt_heizenergie_kwh},{name:"Warmwasser",value:a.gesamt_warmwasser_kwh}],g=[{name:"Wärmepumpe",value:a.wp_kosten_euro,fill:"#22c55e"},{name:"Gas/Öl",value:a.alte_heizung_kosten_euro,fill:"#ef4444"}];return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.anzahl_monate," Monate Daten"]})]}),e.jsx(Se,{className:"h-10 w-10 text-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Ø COP",value:a.durchschnitt_cop.toFixed(2),icon:Bs,color:"orange",formel:"COP = Wärme ÷ Strom",berechnung:`${a.gesamt_waerme_kwh.toFixed(0)} kWh ÷ ${a.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${a.durchschnitt_cop.toFixed(2)}`}),e.jsx(ue,{title:"Wärme erzeugt",value:(a.gesamt_waerme_kwh/1e3).toFixed(1),unit:"MWh",icon:Se,color:"red",formel:"Wärme = Heizung + Warmwasser",berechnung:`${a.gesamt_heizenergie_kwh.toFixed(0)} + ${a.gesamt_warmwasser_kwh.toFixed(0)} kWh`,ergebnis:`= ${a.gesamt_waerme_kwh.toFixed(0)} kWh`}),e.jsx(ue,{title:"Strom verbraucht",value:(a.gesamt_stromverbrauch_kwh/1e3).toFixed(1),unit:"MWh",icon:me,color:"yellow",formel:"Σ Stromverbrauch WP",berechnung:`${a.gesamt_stromverbrauch_kwh.toFixed(0)} kWh`,ergebnis:`= ${(a.gesamt_stromverbrauch_kwh/1e3).toFixed(2)} MWh`}),e.jsx(ue,{title:"Ersparnis",value:a.ersparnis_euro.toFixed(0),unit:"€",icon:be,color:"green",trend:a.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Gas/Öl-Kosten − WP-Kosten",berechnung:`${a.alte_heizung_kosten_euro.toFixed(0)} € − ${a.wp_kosten_euro.toFixed(0)} €`,ergebnis:`= ${a.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärme-Verteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsxs(lt,{data:b,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:h})=>`${l}: ${(h*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#ef4444"}),e.jsx(We,{fill:"#3b82f6"})]}),e.jsx(Y,{formatter:l=>`${l.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),"Heizung: ",a.gesamt_heizenergie_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"}),"Warmwasser: ",a.gesamt_warmwasser_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich WP vs. Gas/Öl"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:g,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{type:"number",tickFormatter:l=>`${l}€`}),e.jsx(se,{type:"category",dataKey:"name",width:100}),e.jsx(Y,{formatter:l=>`${l.toFixed(2)} €`}),e.jsx(G,{dataKey:"value"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis: ",a.ersparnis_euro.toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Wärmeerzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(Be,{type:"monotone",dataKey:"heizung",stackId:"1",fill:"#ef4444",stroke:"#dc2626",name:"Heizung"}),e.jsx(Be,{type:"monotone",dataKey:"warmwasser",stackId:"1",fill:"#3b82f6",stroke:"#2563eb",name:"Warmwasser"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"COP pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{domain:[0,6]}),e.jsx(Y,{formatter:l=>l.toFixed(2)}),e.jsx(G,{dataKey:"cop",fill:"#f59e0b",name:"COP"})]})})})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ke,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis gegenüber fossiler Heizung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Heizung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Warmwasser"}),e.jsx("th",{className:"text-right py-2 px-2",children:"COP"})]})}),e.jsx("tbody",{children:s.map(l=>{const h=l.verbrauch_daten.stromverbrauch_kwh||0,d=l.verbrauch_daten.heizenergie_kwh||0,y=l.verbrauch_daten.warmwasser_kwh||0,u=h>0?(d+y)/h:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-2",children:[xs[l.monat]," ",l.jahr]}),e.jsx("td",{className:"text-right py-2 px-2",children:h.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:d.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:y.toFixed(0)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:u.toFixed(2)})]},l.id)})})]})})]})]})}const cn=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function on(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState([]),[b,g]=c.useState(!1),[l,h]=c.useState(null);return c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{if(!s)return;(async()=>{g(!0),h(null);try{const y=await Ee.getSpeicherDashboard(s);i(y)}catch(y){h(y instanceof Error?y.message:"Fehler beim Laden")}finally{g(!1)}})()},[s]),r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"h-8 w-8 text-green-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Speicher Dashboard"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:t.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),l&&e.jsx(re,{type:"error",children:l}),b?e.jsx(xe,{text:"Lade Speicher Daten..."}):a.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Speicher für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge einen Speicher unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(gn,{dashboard:d},d.investition.id))]})}function gn({dashboard:t}){var b;const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(g=>{const l=g.verbrauch_daten.ladung_kwh||0,h=g.verbrauch_daten.entladung_kwh||0,d=g.verbrauch_daten.speicher_ladung_netz_kwh||0;return{name:`${cn[g.monat]} ${g.jahr.toString().slice(2)}`,ladung:l,entladung:h,arbitrage:d,pvLadung:l-d,zyklen:a.kapazitaet_kwh>0?l/a.kapazitaet_kwh:0,effizienz:l>0?h/l*100:0}});return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.kapazitaet_kwh," kWh Kapazität • ",a.anzahl_monate," Monate Daten"]})]}),e.jsx(je,{className:"h-10 w-10 text-green-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Vollzyklen",value:a.vollzyklen.toFixed(0),icon:za,color:"blue",formel:"Vollzyklen = Ladung ÷ Kapazität",berechnung:`${a.gesamt_ladung_kwh.toFixed(0)} kWh ÷ ${a.kapazitaet_kwh} kWh`,ergebnis:`= ${a.vollzyklen.toFixed(1)} Zyklen`}),e.jsx(ue,{title:"Effizienz",value:a.effizienz_prozent.toFixed(1),unit:"%",icon:$s,color:"green",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh ÷ ${a.gesamt_ladung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${a.effizienz_prozent.toFixed(1)} %`}),e.jsx(ue,{title:"Durchsatz",value:(a.gesamt_entladung_kwh/1e3).toFixed(1),unit:"MWh",icon:me,color:"yellow",formel:"Durchsatz = Σ Entladung",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh`,ergebnis:`= ${(a.gesamt_entladung_kwh/1e3).toFixed(2)} MWh`}),e.jsx(ue,{title:"Ersparnis",value:a.ersparnis_euro.toFixed(0),unit:"€",icon:be,color:"green",trend:a.ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${a.gesamt_entladung_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${a.ersparnis_euro.toFixed(2)} €`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[a.gesamt_ladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.gesamt_entladung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Zyklen/Monat"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:a.zyklen_pro_monat.toFixed(1)})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Verlust"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:[(a.gesamt_ladung_kwh-a.gesamt_entladung_kwh).toFixed(0)," kWh"]})]})]}),a.arbitrage_faehig&&a.arbitrage_kwh>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 border border-amber-200 dark:border-amber-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ya,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),e.jsx("h3",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Arbitrage (Netzladung)"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Netzladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[a.arbitrage_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Ø Ladepreis"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[((b=a.arbitrage_avg_preis_cent)==null?void 0:b.toFixed(1))||"-"," ct/kWh"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Anteil an Ladung"}),e.jsxs("p",{className:"text-xl font-bold text-amber-700 dark:text-amber-300",children:[(a.arbitrage_kwh/a.gesamt_ladung_kwh*100).toFixed(0)," %"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Arbitrage-Gewinn"}),e.jsxs("p",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:["+",a.arbitrage_gewinn_euro.toFixed(0)," €"]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),a.arbitrage_faehig&&a.arbitrage_kwh>0?e.jsxs(e.Fragment,{children:[e.jsx(G,{dataKey:"pvLadung",stackId:"ladung",fill:"#3b82f6",name:"PV-Ladung"}),e.jsx(G,{dataKey:"arbitrage",stackId:"ladung",fill:"#f59e0b",name:"Netz-Ladung"})]}):e.jsx(G,{dataKey:"ladung",fill:"#3b82f6",name:"Ladung"}),e.jsx(G,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Vollzyklen pro Monat"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{formatter:g=>g.toFixed(1)}),e.jsx(Be,{type:"monotone",dataKey:"zyklen",fill:"#8b5cf6",stroke:"#7c3aed",name:"Zyklen"})]})})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Effizienz pro Monat (%)"}),e.jsx("div",{className:"h-48",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(tr,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{domain:[80,100]}),e.jsx(Y,{formatter:g=>`${g.toFixed(1)}%`}),e.jsx(Ae,{type:"monotone",dataKey:"effizienz",stroke:"#22c55e",strokeWidth:2,dot:{r:4},name:"Effizienz"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Zyklen"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:i.map((g,l)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:g.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:g.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:g.entladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:g.zyklen.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[g.effizienz.toFixed(1),"%"]})]},l))})]})})]})]})}function xn(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState([]),[b,g]=c.useState(!1),[l,h]=c.useState(null);return c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{if(!s)return;(async()=>{g(!0),h(null);try{const y=await Ee.getWallboxDashboard(s);i(y)}catch(y){h(y instanceof Error?y.message:"Fehler beim Laden")}finally{g(!1)}})()},[s]),r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(at,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Wallbox Dashboard"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:t.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),l&&e.jsx(re,{type:"error",children:l}),b?e.jsx(xe,{text:"Lade Wallbox Daten..."}):a.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(at,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Wallbox für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine Wallbox unter "Einstellungen → Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(hn,{dashboard:d},d.investition.id))]})}function hn({dashboard:t}){const{investition:r,zusammenfassung:s}=t,n=s,a=[{name:"Heim: PV",value:n.ladung_pv_kwh||0},{name:"Heim: Netz",value:n.ladung_netz_kwh||0},{name:"Extern",value:n.extern_ladung_kwh||0}].filter(l=>l.value>0),i=[{name:"Heimladung (tatsächlich)",value:n.heim_kosten_euro||0,fill:"#22c55e"},{name:"Heimladung (als extern)",value:n.heim_als_extern_kosten_euro||0,fill:"#ef4444"}],b=n.leistung_kw||11,g=(n.gesamt_heim_ladung_kwh||0)>0;return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[b," kW Ladeleistung • ",n.anzahl_monate||0," Monate Daten"]})]}),e.jsx(at,{className:"h-10 w-10 text-purple-500"})]}),g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Heimladung",value:((n.gesamt_heim_ladung_kwh||0)/1e3).toFixed(2),unit:"MWh",subtitle:"PV + Netz",icon:st,color:"purple",formel:"Heimladung = PV + Netz",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} + ${(n.ladung_netz_kwh||0).toFixed(0)} kWh`,ergebnis:`= ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(ue,{title:"PV-Anteil",value:(n.pv_anteil_prozent||0).toFixed(0),unit:"%",subtitle:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh`,icon:Ke,color:"green",formel:"PV-Anteil = PV ÷ Heimladung × 100",berechnung:`${(n.ladung_pv_kwh||0).toFixed(0)} kWh ÷ ${(n.gesamt_heim_ladung_kwh||0).toFixed(0)} kWh × 100`,ergebnis:`= ${(n.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(ue,{title:"Ersparnis vs. Extern",value:(n.ersparnis_vs_extern_euro||0).toFixed(0),unit:"€",subtitle:"Wallbox-ROI",icon:be,color:"green",trend:(n.ersparnis_vs_extern_euro||0)>0?"up":void 0,formel:"Ersparnis = Extern-Kosten − Heim-Kosten",berechnung:`${(n.heim_als_extern_kosten_euro||0).toFixed(0)} € − ${(n.heim_kosten_euro||0).toFixed(0)} €`,ergebnis:`= ${(n.ersparnis_vs_extern_euro||0).toFixed(2)} €`}),e.jsx(ue,{title:"Ladevorgänge",value:(n.gesamt_ladevorgaenge||0).toString(),subtitle:`Ø ${(n.ladevorgaenge_pro_monat||0).toFixed(1)}/Monat`,icon:me,color:"blue",formel:"Σ Ladevorgänge",berechnung:`${n.anzahl_monate||0} Monate`,ergebnis:`= ${n.gesamt_ladevorgaenge||0} Vorgänge`})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladequelle"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsxs(lt,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:h})=>`${l}: ${(h*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"})," ",e.jsx(We,{fill:"#f97316"})," ",e.jsx(We,{fill:"#ef4444"})," "]}),e.jsx(Y,{formatter:l=>`${l.toFixed(1)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-4 text-sm flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4 text-purple-500"}),"Heim: ",(n.gesamt_heim_ladung_kwh||0).toFixed(0)," kWh"]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pr,{className:"h-4 w-4 text-red-500"}),"Extern: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Kostenvergleich: Heimladung vs. Externe Preise"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{type:"number",tickFormatter:l=>`${l}€`}),e.jsx(se,{type:"category",dataKey:"name",width:150}),e.jsx(Y,{formatter:l=>`${l.toFixed(2)} €`}),e.jsx(pe,{}),e.jsx(G,{dataKey:"value",name:"Kosten"})]})})}),e.jsx("div",{className:"text-center mt-2",children:e.jsxs("span",{className:"text-lg font-semibold text-green-600 dark:text-green-400",children:["Ersparnis durch Wallbox: ",(n.ersparnis_vs_extern_euro||0).toFixed(2)," €"]})})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Wallbox-ROI erklärt"}),e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Die Ersparnis errechnet sich aus dem Unterschied zwischen Heimladen und externem Laden:"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 list-disc list-inside",children:[e.jsxs("li",{children:["PV-Ladung zuhause: kostenlos (",(n.ladung_pv_kwh||0).toFixed(0)," kWh)"]}),e.jsxs("li",{children:["Netz-Ladung zuhause: Haushaltsstrom (",(n.ladung_netz_kwh||0).toFixed(0)," kWh = ",(n.heim_kosten_euro||0).toFixed(2)," €)"]}),e.jsxs("li",{children:["Vergleichspreis extern: ",(n.extern_preis_kwh_euro||.5).toFixed(2)," €/kWh"]})]}),(n.extern_ladung_kwh||0)>0&&e.jsxs("p",{className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:["Tatsächliche externe Ladung: ",(n.extern_ladung_kwh||0).toFixed(0)," kWh für ",(n.extern_kosten_euro||0).toFixed(2)," €"]})]}),r.anschaffungskosten_gesamt&&r.anschaffungskosten_gesamt>0&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anschaffungskosten"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ersparnis/Jahr (hochgerechnet)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[n.anzahl_monate&&n.anzahl_monate>0?((n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12).toFixed(0):0," €"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation (ca.)"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:(()=>{const l=n.anzahl_monate&&n.anzahl_monate>0?(n.ersparnis_vs_extern_euro||0)/n.anzahl_monate*12:0;return l<=0?"∞":`${(r.anschaffungskosten_gesamt/l).toFixed(1)} Jahre`})()})]})]})})]}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:'Noch keine Ladedaten vorhanden. Die Wallbox-Statistik wird aus den E-Auto-Monatsdaten berechnet. Erfasse E-Auto-Daten unter "Einstellungen → Monatsdaten".'})})]})}const mn=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function un(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState([]),[b,g]=c.useState(!1),[l,h]=c.useState(null);return c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{if(!s)return;(async()=>{g(!0),h(null);try{const y=await Ee.getBalkonkraftwerkDashboard(s);i(y)}catch(y){h(y instanceof Error?y.message:"Fehler beim Laden")}finally{g(!1)}})()},[s]),r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Balkonkraftwerk Dashboard"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:t.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),l&&e.jsx(re,{type:"error",children:l}),b?e.jsx(xe,{text:"Lade Balkonkraftwerk Daten..."}):a.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Kein Balkonkraftwerk für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge ein Balkonkraftwerk unter "Investitionen" hinzu.'})]})}):a.map(d=>e.jsx(pn,{dashboard:d},d.investition.id))]})}function pn({dashboard:t}){const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=s.map(l=>({name:`${mn[l.monat]} ${l.jahr.toString().slice(2)}`,erzeugung:l.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:l.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:l.verbrauch_daten.einspeisung_kwh||0,speicher_ladung:l.verbrauch_daten.speicher_ladung_kwh||0,speicher_entladung:l.verbrauch_daten.speicher_entladung_kwh||0})),b=[{name:"Eigenverbrauch",value:a.gesamt_eigenverbrauch_kwh},{name:"Einspeisung",value:a.gesamt_einspeisung_kwh}],g=["#22c55e","#f59e0b"];return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r.bezeichnung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.leistung_wp," Wp • ",a.anzahl_module," Module • ",a.anzahl_monate," Monate Daten",a.hat_speicher&&` • ${a.speicher_kapazitaet_wh} Wh Speicher`]})]}),e.jsx(ee,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Erzeugung",value:a.gesamt_erzeugung_kwh.toFixed(0),unit:"kWh",icon:me,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${a.anzahl_monate} Monate`,ergebnis:`= ${a.gesamt_erzeugung_kwh.toFixed(0)} kWh`}),e.jsx(ue,{title:"Eigenverbrauch",value:a.eigenverbrauch_quote_prozent.toFixed(0),unit:"%",icon:st,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh ÷ ${a.gesamt_erzeugung_kwh.toFixed(0)} kWh × 100`,ergebnis:`= ${a.eigenverbrauch_quote_prozent.toFixed(1)} %`}),e.jsx(ue,{title:"Ersparnis",value:a.gesamt_ersparnis_euro.toFixed(0),unit:"€",icon:be,color:"green",trend:a.gesamt_ersparnis_euro>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × Strompreis`,ergebnis:`= ${a.gesamt_ersparnis_euro.toFixed(2)} €`}),e.jsx(ue,{title:"CO₂ gespart",value:a.co2_ersparnis_kg.toFixed(0),unit:"kg",icon:Ke,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${a.gesamt_eigenverbrauch_kwh.toFixed(0)} kWh × 0.4`,ergebnis:`= ${a.co2_ersparnis_kg.toFixed(0)} kg`})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[a.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:["Einspeisung",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(unvergütet)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[a.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Entgangener Erlös",e.jsx("span",{className:"text-xs ml-1 opacity-70",children:"(8 ct/kWh)"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-500 dark:text-gray-400",children:[(a.gesamt_einspeisung_kwh*.08).toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsx(lt,{data:b,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:l,percent:h})=>`${l}: ${(h*100).toFixed(0)}%`,children:b.map((l,h)=>e.jsx(We,{fill:g[h%g.length]},`cell-${h}`))}),e.jsx(Y,{formatter:l=>`${l.toFixed(0)} kWh`})]})})}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),"Eigenverbrauch: ",a.gesamt_eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),"Einspeisung: ",a.gesamt_einspeisung_kwh.toFixed(0)," kWh"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(Be,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Be,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),a.hat_speicher&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(je,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Speicher (",a.speicher_kapazitaet_wh," Wh)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Ladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_ladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Entladung gesamt"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_entladung_kwh.toFixed(1)," kWh"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Effizienz"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:[a.speicher_effizienz_prozent.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-48",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(G,{dataKey:"speicher_ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(G,{dataKey:"speicher_entladung",fill:"#a855f7",name:"Entladung"})]})})})})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Ke,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"CO₂ Ersparnis durch Eigenverbrauch"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:[a.co2_ersparnis_kg.toFixed(0)," kg"]})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"}),a.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Sp. Entl."})]})]})}),e.jsx("tbody",{children:i.map((l,h)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:l.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:l.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:l.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:l.einspeisung.toFixed(1)}),a.hat_speicher&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:l.speicher_ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:l.speicher_entladung.toFixed(1)})]})]},h))})]})})]})]})}const Jr=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],qr={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};function bn(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState([]),[b,g]=c.useState(!1),[l,h]=c.useState(null);return c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{if(!s)return;(async()=>{g(!0),h(null);try{const y=await Ee.getSonstigesDashboard(s);i(y)}catch(y){h(y instanceof Error?y.message:"Fehler beim Laden")}finally{g(!1)}})()},[s]),r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mr,{className:"h-8 w-8 text-gray-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sonstiges Dashboard"})]}),t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:d=>n(parseInt(d.target.value)),options:t.map(d=>({value:d.id.toString(),label:d.anlagenname}))})]}),l&&e.jsx(re,{type:"error",children:l}),b?e.jsx(xe,{text:"Lade Daten..."}):a.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(mr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine sonstigen Investitionen für diese Anlage erfasst."}),e.jsx("p",{className:"text-sm mt-2",children:'Füge eine sonstige Investition unter "Investitionen" hinzu.'}),e.jsx("p",{className:"text-xs mt-1 text-gray-400",children:"z.B. Mini-BHKW, Pelletofen, Mini-Wind, Brennstoffzelle"})]})}):a.map(d=>e.jsx(kn,{dashboard:d},d.investition.id))]})}function kn({dashboard:t}){const{investition:r,monatsdaten:s,zusammenfassung:n}=t,a=n,i=a.kategorie;return i==="erzeuger"?e.jsx(yn,{investition:r,monatsdaten:s,zusammenfassung:a}):i==="verbraucher"?e.jsx(jn,{investition:r,monatsdaten:s,zusammenfassung:a}):e.jsx(fn,{investition:r,monatsdaten:s,zusammenfassung:a})}function yn({investition:t,monatsdaten:r,zusammenfassung:s}){const n=r.map(i=>({name:`${Jr[i.monat]} ${i.jahr.toString().slice(2)}`,erzeugung:i.verbrauch_daten.erzeugung_kwh||0,eigenverbrauch:i.verbrauch_daten.eigenverbrauch_kwh||0,einspeisung:i.verbrauch_daten.einspeisung_kwh||0})),a=[{name:"Eigenverbrauch",value:s.gesamt_eigenverbrauch_kwh||0},{name:"Einspeisung",value:s.gesamt_einspeisung_kwh||0}];return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded",children:qr[s.kategorie]})]}),s.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(me,{className:"h-10 w-10 text-yellow-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Erzeugung",value:(s.gesamt_erzeugung_kwh||0).toFixed(0),unit:"kWh",icon:me,color:"yellow",formel:"Σ Erzeugung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_erzeugung_kwh||0).toFixed(0)} kWh`}),e.jsx(ue,{title:"Eigenverbrauch",value:(s.eigenverbrauch_quote_prozent||0).toFixed(0),unit:"%",icon:st,color:"green",formel:"EV-Quote = Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${(s.gesamt_eigenverbrauch_kwh||0).toFixed(0)} ÷ ${(s.gesamt_erzeugung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(s.eigenverbrauch_quote_prozent||0).toFixed(1)} %`}),e.jsx(ue,{title:"Ersparnis",value:(s.gesamt_ersparnis_euro||0).toFixed(0),unit:"€",icon:be,color:"green",trend:(s.gesamt_ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Eigenverbrauch × Strompreis",berechnung:`${(s.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(s.gesamt_ersparnis_euro||0).toFixed(2)} €`}),e.jsx(ue,{title:"CO₂ gespart",value:(s.co2_ersparnis_kg||0).toFixed(0),unit:"kg",icon:Ke,color:"green",formel:"CO₂ = Eigenverbrauch × 0.4 kg/kWh",berechnung:`${(s.gesamt_eigenverbrauch_kwh||0).toFixed(0)} kWh × 0.4`,ergebnis:`= ${(s.co2_ersparnis_kg||0).toFixed(0)} kg`})]}),s.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Me,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[s.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verwendung der Erzeugung"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsxs(lt,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:b})=>`${i}: ${(b*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"}),e.jsx(We,{fill:"#f59e0b"})]}),e.jsx(Y,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Erzeugung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:n,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(Be,{type:"monotone",dataKey:"eigenverbrauch",stackId:"1",fill:"#22c55e",stroke:"#16a34a",name:"Eigenverbrauch"}),e.jsx(Be,{type:"monotone",dataKey:"einspeisung",stackId:"1",fill:"#f59e0b",stroke:"#d97706",name:"Einspeisung"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Einspeisung"})]})}),e.jsx("tbody",{children:n.map((i,b)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-yellow-600",children:i.erzeugung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.eigenverbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-orange-600",children:i.einspeisung.toFixed(1)})]},b))})]})})]})]})}function jn({investition:t,monatsdaten:r,zusammenfassung:s}){const n=r.map(i=>({name:`${Jr[i.monat]} ${i.jahr.toString().slice(2)}`,verbrauch:i.verbrauch_daten.verbrauch_kwh||0,bezug_pv:i.verbrauch_daten.bezug_pv_kwh||0,bezug_netz:i.verbrauch_daten.bezug_netz_kwh||0})),a=[{name:"PV-Strom",value:s.bezug_pv_kwh||0},{name:"Netzstrom",value:s.bezug_netz_kwh||0}];return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 rounded",children:qr[s.kategorie]})]}),s.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(me,{className:"h-10 w-10 text-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Verbrauch",value:(s.gesamt_verbrauch_kwh||0).toFixed(0),unit:"kWh",icon:me,color:"blue",formel:"Σ Verbrauch alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_verbrauch_kwh||0).toFixed(0)} kWh`}),e.jsx(ue,{title:"PV-Anteil",value:(s.pv_anteil_prozent||0).toFixed(0),unit:"%",icon:st,color:"green",formel:"PV-Anteil = PV-Bezug ÷ Verbrauch × 100",berechnung:`${(s.bezug_pv_kwh||0).toFixed(0)} ÷ ${(s.gesamt_verbrauch_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(s.pv_anteil_prozent||0).toFixed(1)} %`}),e.jsx(ue,{title:"Netzkosten",value:(s.kosten_netz_euro||0).toFixed(0),unit:"€",icon:be,color:"red",formel:"Netzkosten = Netzbezug × Strompreis",berechnung:`${(s.bezug_netz_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(s.kosten_netz_euro||0).toFixed(2)} €`}),e.jsx(ue,{title:"PV-Ersparnis",value:(s.ersparnis_pv_euro||0).toFixed(0),unit:"€",icon:Ke,color:"green",trend:(s.ersparnis_pv_euro||0)>0?"up":void 0,formel:"PV-Ersparnis = PV-Bezug × Strompreis",berechnung:`${(s.bezug_pv_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(s.ersparnis_pv_euro||0).toFixed(2)} €`})]}),s.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Me,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[s.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Strombezug-Aufteilung"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsxs(lt,{data:a,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:i,percent:b})=>`${i}: ${(b*100).toFixed(0)}%`,children:[e.jsx(We,{fill:"#22c55e"}),e.jsx(We,{fill:"#ef4444"})]}),e.jsx(Y,{formatter:i=>`${i.toFixed(0)} kWh`})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Verbrauch pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:n,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(G,{dataKey:"bezug_pv",stackId:"1",fill:"#22c55e",name:"PV-Strom"}),e.jsx(G,{dataKey:"bezug_netz",stackId:"1",fill:"#ef4444",name:"Netzstrom"})]})})})]})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Verbrauch"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PV-Strom"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Netzstrom"})]})}),e.jsx("tbody",{children:n.map((i,b)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:i.name}),e.jsx("td",{className:"text-right py-2 px-2 text-blue-600",children:i.verbrauch.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:i.bezug_pv.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-red-600",children:i.bezug_netz.toFixed(1)})]},b))})]})})]})]})}function fn({investition:t,monatsdaten:r,zusammenfassung:s}){const n=r.map(a=>({name:`${Jr[a.monat]} ${a.jahr.toString().slice(2)}`,ladung:a.verbrauch_daten.ladung_kwh||0,entladung:a.verbrauch_daten.entladung_kwh||0}));return e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t.bezeichnung}),e.jsx("span",{className:"px-2 py-0.5 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 rounded",children:qr[s.kategorie]})]}),s.beschreibung&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s.beschreibung}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[s.anzahl_monate," Monate Daten"]})]}),e.jsx(je,{className:"h-10 w-10 text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ue,{title:"Ladung",value:(s.gesamt_ladung_kwh||0).toFixed(0),unit:"kWh",icon:je,color:"purple",formel:"Σ Ladung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_ladung_kwh||0).toFixed(0)} kWh`}),e.jsx(ue,{title:"Entladung",value:(s.gesamt_entladung_kwh||0).toFixed(0),unit:"kWh",icon:me,color:"green",formel:"Σ Entladung alle Monate",berechnung:`${s.anzahl_monate} Monate`,ergebnis:`= ${(s.gesamt_entladung_kwh||0).toFixed(0)} kWh`}),e.jsx(ue,{title:"Effizienz",value:(s.effizienz_prozent||0).toFixed(1),unit:"%",icon:be,color:"blue",formel:"Effizienz = Entladung ÷ Ladung × 100",berechnung:`${(s.gesamt_entladung_kwh||0).toFixed(0)} ÷ ${(s.gesamt_ladung_kwh||0).toFixed(0)} × 100`,ergebnis:`= ${(s.effizienz_prozent||0).toFixed(1)} %`}),e.jsx(ue,{title:"Ersparnis",value:(s.ersparnis_euro||0).toFixed(0),unit:"€",icon:be,color:"green",trend:(s.ersparnis_euro||0)>0?"up":void 0,formel:"Ersparnis = Entladung × Strompreis",berechnung:`${(s.gesamt_entladung_kwh||0).toFixed(0)} kWh × Strompreis`,ergebnis:`= ${(s.ersparnis_euro||0).toFixed(2)} €`})]}),s.sonderkosten_euro>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 flex items-center gap-4",children:[e.jsx(Me,{className:"h-6 w-6 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Sonderkosten (Reparaturen, Wartung)"}),e.jsxs("p",{className:"text-xl font-bold text-red-700 dark:text-red-300",children:[s.sonderkosten_euro.toFixed(2)," €"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Ladung & Entladung pro Monat (kWh)"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:n,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{}),e.jsx(Y,{}),e.jsx(pe,{}),e.jsx(G,{dataKey:"ladung",fill:"#8b5cf6",name:"Ladung"}),e.jsx(G,{dataKey:"entladung",fill:"#22c55e",name:"Entladung"})]})})})]}),e.jsxs("details",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:"Monatsdaten anzeigen"}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Entladung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Effizienz"})]})}),e.jsx("tbody",{children:n.map((a,i)=>{const b=a.ladung>0?a.entladung/a.ladung*100:0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:a.name}),e.jsx("td",{className:"text-right py-2 px-2 text-purple-600",children:a.ladung.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:a.entladung.toFixed(1)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[b.toFixed(1),"%"]})]},i)})})]})})]})]})}function wn(t,r){const s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}function sr(t,r,s){const n=t.join(";"),a=r.map(g=>g.map(l=>l==null||l===""?"":typeof l=="number"?l.toString().replace(".",","):typeof l=="string"&&(l.includes(";")||l.includes('"'))?`"${l.replace(/"/g,'""')}"`:String(l)).join(";")),i=[n,...a].join(`
`),b=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8"});wn(b,s)}function ie({title:t,value:r,unit:s,subtitle:n,icon:a,color:i,bgColor:b,formel:g,berechnung:l,ergebnis:h}){const d=e.jsxs("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r," ",e.jsx("span",{className:"text-sm font-normal",children:s})]});return e.jsx(S,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t}),e.jsx("div",{className:"mt-1",children:g?e.jsx(kt,{formel:g,berechnung:l,ergebnis:h,children:d}):d}),n&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:n})]}),e.jsx("div",{className:`p-3 rounded-xl ${b}`,children:e.jsx(a,{className:`h-6 w-6 ${i}`})})]})})}const qs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],Ue={solar:"#f59e0b",grid:"#ef4444",consumption:"#8b5cf6",feedin:"#10b981"},Te={erzeugung:"#f59e0b",eigenverbrauch:"#8b5cf6",einspeisung:"#10b981",netzbezug:"#ef4444",autarkie:"#3b82f6",evQuote:"#a855f7",spezErtrag:"#eab308",speicherLadung:"#22c55e",speicherEntladung:"#3b82f6",speicherEffizienz:"#06b6d4",wpWaerme:"#ef4444",wpStrom:"#8b5cf6",wpCop:"#f97316",emobPvAnteil:"#10b981"},Nt={"pv-module":"#f59e0b",wechselrichter:"#eab308",speicher:"#3b82f6","e-auto":"#8b5cf6",wallbox:"#06b6d4",waermepumpe:"#ef4444",balkonkraftwerk:"#10b981",sonstiges:"#6b7280","pv-system":"#f97316"},Rt={"pv-module":"PV-Module",wechselrichter:"Wechselrichter",speicher:"Speicher","e-auto":"E-Auto",wallbox:"Wallbox",waermepumpe:"Wärmepumpe",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges","pv-system":"PV-System"};function Zr(t,r,s){return[...t].sort((a,i)=>a.jahr!==i.jahr?a.jahr-i.jahr:a.monat-i.monat).map(a=>{const i=a.pv_erzeugung_kwh||a.einspeisung_kwh+(a.eigenverbrauch_kwh||0),b=a.eigenverbrauch_kwh||0,g=a.gesamtverbrauch_kwh||b+a.netzbezug_kwh,l=a.direktverbrauch_kwh||0,h=g>0?b/g*100:0,d=i>0?b/i*100:0,y=r!=null&&r.leistung_kwp?i/r.leistung_kwp:0,u=a.batterie_ladung_kwh||0,m=a.batterie_entladung_kwh||0,p=u>0?m/u*100:null,k=0,v=0,j=null,_=0,w=0,f=null,x=s?a.einspeisung_kwh*s.einspeiseverguetung_cent_kwh/100:0,o=s?b*s.netzbezug_arbeitspreis_cent_kwh/100:0,E=s?a.netzbezug_kwh*s.netzbezug_arbeitspreis_cent_kwh/100:0,D=x+o,J=i*.38;return{name:`${qs[a.monat]} ${a.jahr.toString().slice(-2)}`,jahr:a.jahr,monat:a.monat,erzeugung:i,eigenverbrauch:b,einspeisung:a.einspeisung_kwh,netzbezug:a.netzbezug_kwh,gesamtverbrauch:g,direktverbrauch:l,autarkie:h,evQuote:d,spezErtrag:y,speicher_ladung:u,speicher_entladung:m,speicher_effizienz:p,wp_waerme:k,wp_strom:v,wp_cop:j,eauto_km:_,eauto_ladung:w,eauto_pv_anteil:f,einspeise_erloes:x,ev_ersparnis:o,netzbezug_kosten:E,netto_ertrag:D,co2_einsparung:J}})}function Nn({data:t,stats:r,anlage:s,strompreis:n,zeitraumLabel:a}){const i=c.useMemo(()=>Zr(t,s,n),[t,s,n]),b=()=>{const l=["Monat","Erzeugung (kWh)","Eigenverbrauch (kWh)","Einspeisung (kWh)","Netzbezug (kWh)","Autarkie (%)","EV-Quote (%)","Spez. Ertrag (kWh/kWp)"],h=i.map(d=>[d.name,d.erzeugung,d.eigenverbrauch,d.einspeisung,d.netzbezug,d.autarkie,d.evQuote,d.spezErtrag]);sr(l,h,`energie_${(s==null?void 0:s.anlagenname)||"export"}.csv`)},g=c.useMemo(()=>{if(!n)return null;const l=r.gesamtEinspeisung*n.einspeiseverguetung_cent_kwh/100,h=r.gesamtEigenverbrauch*n.netzbezug_arbeitspreis_cent_kwh/100;return l+h},[r,n]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","•"," ",r.anzahlMonate," Monate"]}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:b,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"PV-Erzeugung",value:(r.gesamtErzeugung/1e3).toFixed(1),unit:"MWh",icon:ee,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ PV-Erzeugung aller Monate",berechnung:`${N(r.gesamtErzeugung,0)} kWh`,ergebnis:`= ${N(r.gesamtErzeugung/1e3,1)} MWh`}),e.jsx(ie,{title:"Eigenverbrauch",value:r.gesamtErzeugung>0?(r.gesamtEigenverbrauch/r.gesamtErzeugung*100).toFixed(0):"0",unit:"%",subtitle:`${(r.gesamtEigenverbrauch/1e3).toFixed(1)} MWh`,icon:me,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ PV-Erzeugung × 100",berechnung:`${N(r.gesamtEigenverbrauch,0)} kWh ÷ ${N(r.gesamtErzeugung,0)} kWh × 100`,ergebnis:`= ${N(r.gesamtEigenverbrauch/r.gesamtErzeugung*100,1)} %`}),e.jsx(ie,{title:"Autarkie",value:r.durchschnittAutarkie.toFixed(0),unit:"%",subtitle:"Durchschnitt",icon:be,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Eigenverbrauch ÷ Gesamtverbrauch × 100",berechnung:"Durchschnitt aller Monate",ergebnis:`= ${N(r.durchschnittAutarkie,1)} %`}),e.jsx(ie,{title:"Spez. Ertrag",value:s!=null&&s.leistung_kwp?(r.gesamtErzeugung/s.leistung_kwp).toFixed(0):"---",unit:"kWh/kWp",subtitle:s!=null&&s.leistung_kwp?`${s.leistung_kwp} kWp`:void 0,icon:ee,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"PV-Erzeugung ÷ Anlagenleistung",berechnung:s!=null&&s.leistung_kwp?`${N(r.gesamtErzeugung,0)} kWh ÷ ${s.leistung_kwp} kWp`:void 0,ergebnis:s!=null&&s.leistung_kwp?`= ${N(r.gesamtErzeugung/s.leistung_kwp,0)} kWh/kWp`:void 0})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-blue-500"}),"Energie-Bilanz pro Monat"]}),e.jsx("div",{className:"h-80",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{tickFormatter:l=>`${l.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(Y,{formatter:(l,h)=>[`${l.toFixed(0)} kWh`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),e.jsx(G,{dataKey:"eigenverbrauch",name:"Eigenverbrauch",fill:Te.eigenverbrauch,stackId:"pv"}),e.jsx(G,{dataKey:"einspeisung",name:"Einspeisung",fill:Te.einspeisung,stackId:"pv"}),e.jsx(G,{dataKey:"netzbezug",name:"Netzbezug",fill:Te.netzbezug})]})})})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-green-500"}),"Effizienz-Trends"]}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{yAxisId:"left",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(se,{yAxisId:"right",orientation:"right",tickFormatter:l=>`${l.toFixed(0)}`,unit:" kWh/kWp",tick:{fontSize:11}}),e.jsx(Y,{formatter:(l,h)=>h.includes("kWh/kWp")?[`${l.toFixed(0)} kWh/kWp`,h]:[`${l.toFixed(1)}%`,h],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),e.jsx(Ae,{yAxisId:"left",type:"monotone",dataKey:"autarkie",name:"Autarkie (%)",stroke:Te.autarkie,strokeWidth:2,dot:!1}),e.jsx(Ae,{yAxisId:"left",type:"monotone",dataKey:"evQuote",name:"EV-Quote (%)",stroke:Te.evQuote,strokeWidth:2,dot:!1}),e.jsx(G,{yAxisId:"right",dataKey:"spezErtrag",name:"Spez. Ertrag (kWh/kWp)",fill:Te.spezErtrag,opacity:.7})]})})})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-yellow-500"}),"PV-Erzeugung Verlauf"]}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(tr,{data:i,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Y,{formatter:l=>[`${l.toFixed(0)} kWh`,"Erzeugung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Ae,{type:"monotone",dataKey:"erzeugung",name:"PV-Erzeugung",stroke:Te.erzeugung,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Zusammenfassung"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[r.anzahlMonate," Monate"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[(s==null?void 0:s.leistung_kwp)||"---"," kWp"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Netto-Ertrag"}),e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:g?`${g.toFixed(0)} €`:"---"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"CO2 eingespart"}),e.jsxs("p",{className:"font-medium text-green-600 dark:text-green-400",children:[(r.gesamtErzeugung*.38/1e3).toFixed(1)," t"]})]})]})]})]})}function vn({anlage:t,strompreis:r,selectedYear:s,zeitraumLabel:n}){var _,w,f;const[a,i]=c.useState(null),[b,g]=c.useState(!0),[l,h]=c.useState(null);c.useEffect(()=>{if(!(t!=null&&t.id))return;(async()=>{g(!0),h(null);try{const o=s&&s!=="all"?s:void 0,E=await Lt.getKomponentenZeitreihe(t.id,o);i(E)}catch(o){h("Fehler beim Laden der Komponentendaten"),console.error(o)}finally{g(!1)}})()},[t==null?void 0:t.id,s]);const d=c.useMemo(()=>a!=null&&a.monatswerte?a.monatswerte.map(x=>({...x,name:`${qs[x.monat]} ${x.jahr.toString().slice(-2)}`})):[],[a]),y=c.useMemo(()=>{if(!d.length)return{ladung:0,entladung:0,effizienz:null,arbitrage:0};const x=d.reduce((D,W)=>D+W.speicher_ladung_kwh,0),o=d.reduce((D,W)=>D+W.speicher_entladung_kwh,0),E=d.reduce((D,W)=>D+W.speicher_arbitrage_kwh,0);return{ladung:x,entladung:o,effizienz:x>0?o/x*100:null,arbitrage:E}},[d]),u=c.useMemo(()=>{if(!d.length)return{waerme:0,strom:0,cop:null,heizung:0,warmwasser:0};const x=d.reduce((W,J)=>W+J.wp_waerme_kwh,0),o=d.reduce((W,J)=>W+J.wp_strom_kwh,0),E=d.reduce((W,J)=>W+J.wp_heizung_kwh,0),D=d.reduce((W,J)=>W+J.wp_warmwasser_kwh,0);return{waerme:x,strom:o,cop:o>0?x/o:null,heizung:E,warmwasser:D}},[d]),m=c.useMemo(()=>{if(!d.length)return{km:0,ladung:0,pvAnteil:null,pvLadung:0,netzLadung:0,externLadung:0,externEuro:0,v2h:0};const x=d.reduce((q,F)=>q+F.emob_km,0),o=d.reduce((q,F)=>q+F.emob_ladung_kwh,0),E=d.reduce((q,F)=>q+F.emob_ladung_pv_kwh,0),D=d.reduce((q,F)=>q+F.emob_ladung_netz_kwh,0),W=d.reduce((q,F)=>q+F.emob_ladung_extern_kwh,0),J=d.reduce((q,F)=>q+F.emob_ladung_extern_euro,0),K=d.reduce((q,F)=>q+F.emob_v2h_kwh,0),C=o>0?E/o*100:null;return{km:x,ladung:o,pvAnteil:C,pvLadung:E,netzLadung:D,externLadung:W,externEuro:J,v2h:K}},[d]),p=c.useMemo(()=>d.length?{erzeugung:d.reduce((x,o)=>x+o.bkw_erzeugung_kwh,0),eigenverbrauch:d.reduce((x,o)=>x+o.bkw_eigenverbrauch_kwh,0),speicherLadung:d.reduce((x,o)=>x+o.bkw_speicher_ladung_kwh,0),speicherEntladung:d.reduce((x,o)=>x+o.bkw_speicher_entladung_kwh,0)}:{erzeugung:0,eigenverbrauch:0,speicherLadung:0,speicherEntladung:0},[d]),k=c.useMemo(()=>d.length?{erzeugung:d.reduce((x,o)=>x+o.sonstiges_erzeugung_kwh,0),verbrauch:d.reduce((x,o)=>x+o.sonstiges_verbrauch_kwh,0)}:{erzeugung:0,verbrauch:0},[d]);c.useMemo(()=>d.length?d.reduce((x,o)=>x+o.sonderkosten_euro,0):0,[d]);const v=()=>{if(!d.length)return;const x=["Monat"];a!=null&&a.hat_speicher&&x.push("Speicher Ladung (kWh)","Speicher Entladung (kWh)","Speicher Effizienz (%)"),a!=null&&a.hat_waermepumpe&&x.push("WP Wärme (kWh)","WP Strom (kWh)","WP COP"),a!=null&&a.hat_emobilitaet&&x.push("E-Auto km","E-Auto Ladung (kWh)","E-Auto PV-Anteil (%)"),a!=null&&a.hat_balkonkraftwerk&&x.push("BKW Erzeugung (kWh)","BKW Eigenverbrauch (kWh)"),a!=null&&a.hat_sonstiges&&x.push("Sonstiges Erzeugung (kWh)","Sonstiges Verbrauch (kWh)");const o=d.map(E=>{const D=[E.name];return a!=null&&a.hat_speicher&&D.push(E.speicher_ladung_kwh,E.speicher_entladung_kwh,E.speicher_effizienz_prozent??""),a!=null&&a.hat_waermepumpe&&D.push(E.wp_waerme_kwh,E.wp_strom_kwh,E.wp_cop??""),a!=null&&a.hat_emobilitaet&&D.push(E.emob_km,E.emob_ladung_kwh,E.emob_pv_anteil_prozent??""),a!=null&&a.hat_balkonkraftwerk&&D.push(E.bkw_erzeugung_kwh,E.bkw_eigenverbrauch_kwh),a!=null&&a.hat_sonstiges&&D.push(E.sonstiges_erzeugung_kwh,E.sonstiges_verbrauch_kwh),D});sr(x,o,`komponenten_${(t==null?void 0:t.anlagenname)||"export"}.csv`)};return b?e.jsxs(S,{className:"text-center py-12",children:[e.jsx(qe,{className:"h-12 w-12 mx-auto text-gray-400 mb-4 animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Komponentendaten..."})]}):l?e.jsxs(S,{className:"text-center py-12",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto text-red-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:l})]}):a&&(a.hat_speicher||a.hat_waermepumpe||a.hat_emobilitaet||a.hat_balkonkraftwerk||a.hat_sonstiges)?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","•"," ",(a==null?void 0:a.anzahl_monate)||0," Monate"]}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:v,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),(a==null?void 0:a.hat_speicher)&&y.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"h-6 w-6 text-green-500"}),"Speicher",a.hat_arbitrage&&e.jsx("span",{className:"text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded",children:"Arbitrage"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Ladung gesamt",value:(y.ladung/1e3).toFixed(2),unit:"MWh",icon:je,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Speicher-Ladung aller Monate",berechnung:`${N(y.ladung,0)} kWh`,ergebnis:`= ${N(y.ladung/1e3,2)} MWh`}),e.jsx(ie,{title:"Entladung gesamt",value:(y.entladung/1e3).toFixed(2),unit:"MWh",icon:je,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Speicher-Entladung aller Monate",berechnung:`${N(y.entladung,0)} kWh`,ergebnis:`= ${N(y.entladung/1e3,2)} MWh`}),e.jsx(ie,{title:"Ø Effizienz",value:((_=y.effizienz)==null?void 0:_.toFixed(1))||"---",unit:"%",icon:je,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100",berechnung:`${N(y.entladung,0)} kWh ÷ ${N(y.ladung,0)} kWh × 100`,ergebnis:y.effizienz?`= ${N(y.effizienz,1)}%`:"---"}),a.hat_arbitrage&&y.arbitrage>0?e.jsx(ie,{title:"Arbitrage",value:y.arbitrage.toFixed(0),unit:"kWh",subtitle:"Netzladung",icon:je,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ Netzladung für Arbitrage"}):e.jsx(ie,{title:"Verlust",value:(y.ladung-y.entladung).toFixed(0),unit:"kWh",subtitle:y.effizienz?`${(100-y.effizienz).toFixed(1)}%`:void 0,icon:je,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Speicher pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d.filter(x=>x.speicher_ladung_kwh>0||x.speicher_entladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{yAxisId:"left",tickFormatter:x=>`${x.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(se,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(Y,{formatter:(x,o)=>o.includes("Effizienz")?[`${(x==null?void 0:x.toFixed(1))||"---"}%`,o]:[`${x.toFixed(0)} kWh`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),e.jsx(G,{yAxisId:"left",dataKey:"speicher_ladung_kwh",name:"Ladung",fill:Te.speicherLadung}),e.jsx(G,{yAxisId:"left",dataKey:"speicher_entladung_kwh",name:"Entladung",fill:Te.speicherEntladung}),a.hat_arbitrage&&e.jsx(G,{yAxisId:"left",dataKey:"speicher_arbitrage_kwh",name:"Arbitrage (Netz)",fill:"#8b5cf6"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"speicher_effizienz_prozent",name:"Effizienz (%)",stroke:Te.speicherEffizienz,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_waermepumpe)&&u.strom>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Se,{className:"h-6 w-6 text-red-500"}),"Wärmepumpe"]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Wärme erzeugt",value:(u.waerme/1e3).toFixed(2),unit:"MWh",icon:Se,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Wärme aller Monate",berechnung:`${N(u.waerme,0)} kWh`,ergebnis:`= ${N(u.waerme/1e3,2)} MWh`}),e.jsx(ie,{title:"Strom verbraucht",value:(u.strom/1e3).toFixed(2),unit:"MWh",icon:Se,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ WP-Strom aller Monate",berechnung:`${N(u.strom,0)} kWh`,ergebnis:`= ${N(u.strom/1e3,2)} MWh`}),e.jsx(ie,{title:"Ø COP",value:((w=u.cop)==null?void 0:w.toFixed(2))||"---",unit:"",subtitle:"Jahresarbeitszahl",icon:Se,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Wärme ÷ Strom",berechnung:`${N(u.waerme,0)} kWh ÷ ${N(u.strom,0)} kWh`,ergebnis:u.cop?`= ${N(u.cop,2)} COP`:"---"}),e.jsx(ie,{title:"Ersparnis vs. Gas",value:r?(u.waerme*.08-u.strom*r.netzbezug_arbeitspreis_cent_kwh/100).toFixed(0):"---",unit:"€",subtitle:"ca. 8 ct/kWh Gas",icon:Se,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"})]}),(u.heizung>0||u.warmwasser>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Heizung",value:(u.heizung/1e3).toFixed(2),unit:"MWh",subtitle:u.waerme>0?`${(u.heizung/u.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:Se,color:"text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Heizenergie aller Monate"}),e.jsx(ie,{title:"Warmwasser",value:(u.warmwasser/1e3).toFixed(2),unit:"MWh",subtitle:u.waerme>0?`${(u.warmwasser/u.waerme*100).toFixed(0)}% der Wärme`:void 0,icon:Se,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Warmwasser-Energie aller Monate"})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Wärmepumpe pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d.filter(x=>x.wp_waerme_kwh>0||x.wp_strom_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{yAxisId:"left",tickFormatter:x=>`${x.toFixed(0)}`,unit:" kWh",tick:{fontSize:11}}),e.jsx(se,{yAxisId:"right",orientation:"right",domain:[0,"auto"],tick:{fontSize:11}}),e.jsx(Y,{formatter:(x,o)=>o==="COP"?[`${(x==null?void 0:x.toFixed(2))||"---"}`,o]:[`${x.toFixed(0)} kWh`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),u.heizung>0||u.warmwasser>0?e.jsxs(e.Fragment,{children:[e.jsx(G,{yAxisId:"left",dataKey:"wp_heizung_kwh",name:"Heizung",stackId:"waerme",fill:"#f87171"}),e.jsx(G,{yAxisId:"left",dataKey:"wp_warmwasser_kwh",name:"Warmwasser",stackId:"waerme",fill:"#60a5fa"})]}):e.jsx(G,{yAxisId:"left",dataKey:"wp_waerme_kwh",name:"Wärme",fill:Te.wpWaerme}),e.jsx(G,{yAxisId:"left",dataKey:"wp_strom_kwh",name:"Strom",fill:Te.wpStrom}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"wp_cop",name:"COP",stroke:Te.wpCop,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_emobilitaet)&&m.ladung>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{className:"h-6 w-6 text-purple-500"}),"E-Mobilität",a.hat_v2h&&e.jsx("span",{className:"text-xs bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 px-2 py-0.5 rounded",children:"V2H"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Gefahrene km",value:(m.km/1e3).toFixed(1),unit:"Tkm",icon:Ne,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Σ gefahrene km aller Monate",berechnung:`${N(m.km,0)} km`,ergebnis:`= ${N(m.km/1e3,1)} Tausend km`}),e.jsx(ie,{title:"Ladung gesamt",value:(m.ladung/1e3).toFixed(2),unit:"MWh",icon:Ne,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ E-Auto-Ladung aller Monate",berechnung:`${N(m.ladung,0)} kWh`,ergebnis:`= ${N(m.ladung/1e3,2)} MWh`}),e.jsx(ie,{title:"Ø PV-Anteil",value:((f=m.pvAnteil)==null?void 0:f.toFixed(0))||"---",unit:"%",icon:Ne,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Ladung ÷ Gesamtladung × 100",berechnung:`${N(m.pvLadung,0)} kWh ÷ ${N(m.ladung,0)} kWh × 100`,ergebnis:m.pvAnteil?`= ${N(m.pvAnteil,0)}%`:"---"}),e.jsx(ie,{title:"Verbrauch",value:m.km>0?(m.ladung/m.km*100).toFixed(1):"---",unit:"kWh/100km",icon:Ne,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Ladung ÷ km × 100",berechnung:`${N(m.ladung,0)} kWh ÷ ${N(m.km,0)} km × 100`,ergebnis:m.km>0?`= ${N(m.ladung/m.km*100,1)} kWh/100km`:"---"})]}),(m.pvLadung>0||m.netzLadung>0||m.externLadung>0||m.v2h>0)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"PV-Ladung",value:m.pvLadung.toFixed(0),unit:"kWh",subtitle:m.ladung>0?`${(m.pvLadung/m.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:ee,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ Ladung aus eigener PV"}),e.jsx(ie,{title:"Netz-Ladung",value:m.netzLadung.toFixed(0),unit:"kWh",subtitle:m.ladung>0?`${(m.netzLadung/m.ladung*100).toFixed(0)}% der Ladung`:void 0,icon:me,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Σ Ladung aus Netzstrom"}),m.externLadung>0&&e.jsx(ie,{title:"Extern geladen",value:m.externLadung.toFixed(0),unit:"kWh",subtitle:m.externEuro>0?`${N(m.externEuro,2)} €`:void 0,icon:Ne,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Σ Ladung an öffentlichen Säulen"}),a.hat_v2h&&m.v2h>0&&e.jsx(ie,{title:"V2H Entladung",value:m.v2h.toFixed(0),unit:"kWh",subtitle:r?`≈ ${N(m.v2h*r.netzbezug_arbeitspreis_cent_kwh/100,0)} € Ersparnis`:void 0,icon:je,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Σ Rückspeisung ins Haus (Vehicle-to-Home)"})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"E-Mobilität pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d.filter(x=>x.emob_km>0||x.emob_ladung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{yAxisId:"left",tick:{fontSize:11}}),e.jsx(se,{yAxisId:"right",orientation:"right",domain:[0,100],unit:"%",tick:{fontSize:11}}),e.jsx(Y,{formatter:(x,o)=>o.includes("PV-Anteil")?[`${(x==null?void 0:x.toFixed(0))||"---"}%`,o]:o.includes("km")?[`${x.toFixed(0)} km`,o]:o.includes("€")?[`${x.toFixed(2)} €`,o]:[`${x.toFixed(0)} kWh`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),e.jsx(G,{yAxisId:"left",dataKey:"emob_ladung_pv_kwh",name:"PV-Ladung",stackId:"ladung",fill:"#f59e0b"}),e.jsx(G,{yAxisId:"left",dataKey:"emob_ladung_netz_kwh",name:"Netz-Ladung",stackId:"ladung",fill:"#ef4444"}),m.externLadung>0&&e.jsx(G,{yAxisId:"left",dataKey:"emob_ladung_extern_kwh",name:"Extern",stackId:"ladung",fill:"#f97316"}),a.hat_v2h&&e.jsx(G,{yAxisId:"left",dataKey:"emob_v2h_kwh",name:"V2H",fill:"#06b6d4"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"emob_pv_anteil_prozent",name:"PV-Anteil (%)",stroke:Te.emobPvAnteil,strokeWidth:2,dot:!1})]})})})]})]}),(a==null?void 0:a.hat_balkonkraftwerk)&&p.erzeugung>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ee,{className:"h-6 w-6 text-yellow-500"}),"Balkonkraftwerk",p.speicherLadung>0&&e.jsx("span",{className:"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded",children:"mit Speicher"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Die BKW-Erzeugung ist in der PV-Gesamterzeugung enthalten, wird hier aber separat ausgewiesen."})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Erzeugung gesamt",value:p.erzeugung.toFixed(0),unit:"kWh",icon:ee,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",formel:"Σ BKW-Erzeugung aller Monate",berechnung:`${N(p.erzeugung,0)} kWh`,ergebnis:`= ${N(p.erzeugung,0)} kWh`}),e.jsx(ie,{title:"Eigenverbrauch",value:p.eigenverbrauch.toFixed(0),unit:"kWh",icon:ee,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Eigenverbrauch aller Monate",berechnung:`${N(p.eigenverbrauch,0)} kWh`,ergebnis:`= ${N(p.eigenverbrauch,0)} kWh`}),e.jsx(ie,{title:"EV-Quote",value:p.erzeugung>0?(p.eigenverbrauch/p.erzeugung*100).toFixed(0):"---",unit:"%",icon:ee,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch ÷ Erzeugung × 100",berechnung:`${N(p.eigenverbrauch,0)} kWh ÷ ${N(p.erzeugung,0)} kWh × 100`,ergebnis:p.erzeugung>0?`= ${N(p.eigenverbrauch/p.erzeugung*100,0)}%`:"---"}),e.jsx(ie,{title:"Einspeisung",value:(p.erzeugung-p.eigenverbrauch).toFixed(0),unit:"kWh",subtitle:"geschätzt",icon:ee,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"})]}),p.speicherLadung>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Speicher Ladung",value:p.speicherLadung.toFixed(0),unit:"kWh",icon:je,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ BKW-Speicher Ladung"}),e.jsx(ie,{title:"Speicher Entladung",value:p.speicherEntladung.toFixed(0),unit:"kWh",icon:je,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ BKW-Speicher Entladung"}),e.jsx(ie,{title:"Speicher Effizienz",value:p.speicherLadung>0?(p.speicherEntladung/p.speicherLadung*100).toFixed(0):"---",unit:"%",icon:je,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"Entladung ÷ Ladung × 100"})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Balkonkraftwerk pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d.filter(x=>x.bkw_erzeugung_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Y,{formatter:(x,o)=>[`${x.toFixed(0)} kWh`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),e.jsx(G,{dataKey:"bkw_erzeugung_kwh",name:"Erzeugung",fill:"#f59e0b"}),e.jsx(G,{dataKey:"bkw_eigenverbrauch_kwh",name:"Eigenverbrauch",fill:"#10b981"}),p.speicherLadung>0&&e.jsxs(e.Fragment,{children:[e.jsx(G,{dataKey:"bkw_speicher_ladung_kwh",name:"Speicher Ladung",fill:"#22c55e"}),e.jsx(G,{dataKey:"bkw_speicher_entladung_kwh",name:"Speicher Entladung",fill:"#3b82f6"})]})]})})})]})]}),(a==null?void 0:a.hat_sonstiges)&&(k.erzeugung>0||k.verbrauch>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(me,{className:"h-6 w-6 text-gray-500"}),"Sonstige Komponenten"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:'Aggregiert alle Investitionen vom Typ "Sonstiges" (z.B. Mini-BHKW, Pool-Pumpe).'})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[k.erzeugung>0&&e.jsx(ie,{title:"Erzeugung gesamt",value:k.erzeugung.toFixed(0),unit:"kWh",icon:me,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"}),k.verbrauch>0&&e.jsx(ie,{title:"Verbrauch gesamt",value:k.verbrauch.toFixed(0),unit:"kWh",icon:me,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20"}),k.erzeugung>0&&k.verbrauch>0&&e.jsx(ie,{title:"Netto",value:(k.erzeugung-k.verbrauch).toFixed(0),unit:"kWh",icon:me,color:k.erzeugung-k.verbrauch>=0?"text-green-500":"text-red-500",bgColor:k.erzeugung-k.verbrauch>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Sonstige Komponenten pro Monat"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d.filter(x=>x.sonstiges_erzeugung_kwh>0||x.sonstiges_verbrauch_kwh>0),margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Y,{formatter:(x,o)=>[`${x.toFixed(0)} kWh`,o],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),k.erzeugung>0&&e.jsx(G,{dataKey:"sonstiges_erzeugung_kwh",name:"Erzeugung",fill:"#10b981"}),k.verbrauch>0&&e.jsx(G,{dataKey:"sonstiges_verbrauch_kwh",name:"Verbrauch",fill:"#ef4444"})]})})})]})]}),a&&(a.hat_waermepumpe&&u.strom===0||a.hat_emobilitaet&&m.ladung===0||a.hat_balkonkraftwerk&&p.erzeugung===0||a.hat_sonstiges&&k.erzeugung===0&&k.verbrauch===0)&&e.jsx(S,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Komponenten ohne Monatsdaten"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Einige Investitionen sind angelegt, haben aber noch keine Monatsdaten. Erfasse monatliche Verbrauchsdaten unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"}),"."]})]})]})})]}):e.jsxs(S,{className:"text-center py-12",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Komponentendaten vorhanden"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:["Erfasse Daten für Speicher, Wärmepumpe, E-Auto, Balkonkraftwerk oder Sonstiges unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," und füge Monatsdaten hinzu."]})]})}function _n({data:t,stats:r,strompreis:s,anlageId:n,zeitraumLabel:a}){const[i,b]=c.useState(null);if(c.useEffect(()=>{n&&Lt.getKomponentenZeitreihe(n).then(b).catch(console.error)},[n]),!s)return e.jsxs(S,{className:"text-center py-8",children:[e.jsx(Xe,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Strompreis erforderlich"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte konfiguriere einen Stromtarif, um Finanzauswertungen zu sehen."})]});const g=c.useMemo(()=>Zr(t,void 0,s),[t,s]),l=c.useMemo(()=>{var m;const u=new Map;return(m=i==null?void 0:i.monatswerte)==null||m.forEach(p=>{const k=`${p.jahr}-${p.monat}`;u.set(k,p.sonderkosten_euro||0)}),u},[i]),h=c.useMemo(()=>{let u=0;return g.map(m=>{const p=l.get(`${m.jahr}-${m.monat}`)||0,k=m.netto_ertrag-p;return u+=k,{...m,sonderkosten:p,netto_nach_sonderkosten:k,kumuliert_ertrag:u}})},[g,l]),d=c.useMemo(()=>{const u=r.gesamtEinspeisung*s.einspeiseverguetung_cent_kwh/100,m=r.gesamtNetzbezug*s.netzbezug_arbeitspreis_cent_kwh/100,p=r.gesamtEigenverbrauch*s.netzbezug_arbeitspreis_cent_kwh/100,k=h.reduce((_,w)=>_+(w.sonderkosten||0),0),v=u+p,j=v-k;return{einspeiseErloes:u,netzbezugKosten:m,eigenverbrauchErsparnis:p,nettoErtrag:v,sonderkosten:k,nettoNachSonderkosten:j}},[r,s,h]),y=()=>{const u=["Monat","Einspeiseerlös (€)","EV-Ersparnis (€)","Netzbezug-Kosten (€)","Netto-Ertrag (€)","Sonderkosten (€)","Netto nach Sonderkosten (€)","Kumulierter Ertrag (€)"],m=h.map(p=>[p.name,p.einspeise_erloes,p.ev_ersparnis,p.netzbezug_kosten,p.netto_ertrag,p.sonderkosten,p.netto_nach_sonderkosten,p.kumuliert_ertrag]);sr(u,m,"finanzen_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:a})," ","•"," ",r.anzahlMonate," Monate"]}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:y,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Einspeiseerlös",value:d.einspeiseErloes.toFixed(0),unit:"€",subtitle:`${s.einspeiseverguetung_cent_kwh.toFixed(1)} ct/kWh`,icon:be,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeisung × Einspeisevergütung",berechnung:`${N(r.gesamtEinspeisung,0)} kWh × ${N(s.einspeiseverguetung_cent_kwh,2)} ct/kWh`,ergebnis:`= ${N(d.einspeiseErloes,2)} €`}),e.jsx(ie,{title:"EV-Ersparnis",value:d.eigenverbrauchErsparnis.toFixed(0),unit:"€",subtitle:"vermiedener Netzbezug",icon:Xe,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Eigenverbrauch × Netzbezugspreis",berechnung:`${N(r.gesamtEigenverbrauch,0)} kWh × ${N(s.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${N(d.eigenverbrauchErsparnis,2)} €`}),e.jsx(ie,{title:"Netzbezug-Kosten",value:d.netzbezugKosten.toFixed(0),unit:"€",subtitle:`${s.netzbezug_arbeitspreis_cent_kwh.toFixed(1)} ct/kWh`,icon:Xe,color:"text-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",formel:"Netzbezug × Netzbezugspreis",berechnung:`${N(r.gesamtNetzbezug,0)} kWh × ${N(s.netzbezug_arbeitspreis_cent_kwh,2)} ct/kWh`,ergebnis:`= ${N(d.netzbezugKosten,2)} €`}),e.jsx(ie,{title:"Netto-Ertrag",value:d.nettoNachSonderkosten.toFixed(0),unit:"€",subtitle:d.sonderkosten>0?`nach ${d.sonderkosten.toFixed(0)} € Sonderkosten`:"Gesamt",icon:Xe,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:d.sonderkosten>0?"Einspeiseerlös + EV-Ersparnis − Sonderkosten":"Einspeiseerlös + EV-Ersparnis",berechnung:d.sonderkosten>0?`${N(d.einspeiseErloes,2)} € + ${N(d.eigenverbrauchErsparnis,2)} € − ${N(d.sonderkosten,2)} €`:`${N(d.einspeiseErloes,2)} € + ${N(d.eigenverbrauchErsparnis,2)} €`,ergebnis:`= ${N(d.nettoNachSonderkosten,2)} €`})]}),d.sonderkosten>0&&e.jsx(S,{className:"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(mr,{className:"h-5 w-5 text-amber-600 dark:text-amber-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-200",children:["Sonderkosten im Zeitraum: ",d.sonderkosten.toFixed(2)," €"]}),e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:"Reparaturen, Wartung und sonstige Kosten werden vom Netto-Ertrag abgezogen."})]})]})}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 text-green-500"}),"Finanzielle Bilanz pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:h,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" €",tick:{fontSize:11}}),e.jsx(Y,{formatter:(u,m)=>[`${u.toFixed(2)} €`,m],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(pe,{}),e.jsx(G,{dataKey:"einspeise_erloes",name:"Einspeiseerlös",fill:Ue.feedin,stackId:"pos"}),e.jsx(G,{dataKey:"ev_ersparnis",name:"EV-Ersparnis",fill:Ue.consumption,stackId:"pos"}),e.jsx(G,{dataKey:"netzbezug_kosten",name:"Netzbezug (negativ)",fill:Ue.grid}),d.sonderkosten>0&&e.jsx(G,{dataKey:"sonderkosten",name:"Sonderkosten",fill:"#f59e0b"})]})})})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-blue-500"}),"Kumulierter Netto-Ertrag"]}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:h,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" €",tick:{fontSize:11}}),e.jsx(Y,{formatter:u=>[`${u.toFixed(0)} €`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Be,{type:"monotone",dataKey:"kumuliert_ertrag",name:"Kumulierter Ertrag",stroke:Ue.feedin,fill:Ue.feedin,fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[d.nettoNachSonderkosten.toFixed(0)," €"]}),d.sonderkosten>0&&e.jsxs("span",{className:"text-gray-400 text-xs",children:["(nach ",d.sonderkosten.toFixed(0)," € Sonderkosten)"]})]})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Netto-Ertrag pro Monat ",d.sonderkosten>0&&"(nach Sonderkosten)"]}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:h,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" €",tick:{fontSize:11}}),e.jsx(Y,{formatter:(u,m)=>[`${u.toFixed(2)} €`,m],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(G,{dataKey:"netto_nach_sonderkosten",name:"Netto-Ertrag",fill:Ue.feedin,opacity:.7}),e.jsx(Ae,{type:"monotone",dataKey:"netto_nach_sonderkosten",name:"Trend",stroke:Ue.solar,strokeWidth:2,dot:!1})]})})})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Durchschnittswerte"}),e.jsxs("div",{className:`grid grid-cols-2 gap-4 text-sm ${d.sonderkosten>0?"md:grid-cols-5":"md:grid-cols-4"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Einspeiseerlös/Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(d.einspeiseErloes/r.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø EV-Ersparnis/Monat"}),e.jsxs("p",{className:"font-medium text-purple-600",children:[(d.eigenverbrauchErsparnis/r.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netzbezug-Kosten/Monat"}),e.jsxs("p",{className:"font-medium text-red-600",children:[(d.netzbezugKosten/r.anzahlMonate).toFixed(0)," €"]})]}),d.sonderkosten>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Sonderkosten/Monat"}),e.jsxs("p",{className:"font-medium text-amber-600",children:[(d.sonderkosten/r.anzahlMonate).toFixed(0)," €"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Ø Netto-Ertrag/Monat"}),e.jsxs("p",{className:"font-medium text-blue-600",children:[(d.nettoNachSonderkosten/r.anzahlMonate).toFixed(0)," €"]})]})]})]})]})}const lr=.38;function zn({data:t,stats:r,zeitraumLabel:s}){const n=c.useMemo(()=>Zr(t),[t]),a=c.useMemo(()=>{let d=0;return n.map(y=>(d+=y.co2_einsparung,{...y,kumuliert_co2:d}))},[n]),i=r.gesamtErzeugung*lr,b=i/12.5,g=i/.12,l=i/230,h=()=>{const d=["Monat","CO2-Einsparung (kg)","Kumuliert (kg)","Kumuliert (t)"],y=a.map(u=>[u.name,u.co2_einsparung,u.kumuliert_co2,u.kumuliert_co2/1e3]);sr(d,y,"co2_export.csv")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:s})," ","•"," ",r.anzahlMonate," Monate"]}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:h,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"CO2 eingespart",value:(i/1e3).toFixed(2),unit:"t",subtitle:`${r.anzahlMonate} Monate`,icon:Ke,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"PV-Erzeugung × CO2-Faktor",berechnung:`${N(r.gesamtErzeugung,0)} kWh × ${lr*1e3} g/kWh`,ergebnis:`= ${N(i,0)} kg = ${N(i/1e3,2)} t`}),e.jsx(ie,{title:"Bäume äquivalent",value:b.toFixed(0),unit:"Bäume/Jahr",subtitle:"Bindungsleistung",icon:Ke,color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"CO2-Einsparung ÷ 12,5 kg/Baum/Jahr",berechnung:`${N(i,0)} kg ÷ 12,5 kg/Baum`,ergebnis:`= ${N(b,0)} Bäume`}),e.jsx(ie,{title:"Auto-km vermieden",value:(g/1e3).toFixed(0),unit:"Tsd. km",subtitle:"bei 120g CO2/km",icon:Ke,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",formel:"CO2-Einsparung ÷ 120 g/km",berechnung:`${N(i*1e3,0)} g ÷ 120 g/km`,ergebnis:`= ${N(g,0)} km`}),e.jsx(ie,{title:"Kurzstreckenflüge",value:l.toFixed(1),unit:"Flüge",subtitle:"à 1000 km",icon:Ke,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",formel:"CO2-Einsparung ÷ 230 kg/Flug",berechnung:`${N(i,0)} kg ÷ 230 kg/Flug`,ergebnis:`= ${N(l,1)} Flüge vermieden`})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-green-500"}),"CO2-Einsparung pro Monat"]}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:n,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{unit:" kg",tick:{fontSize:11}}),e.jsx(Y,{formatter:d=>[`${d.toFixed(0)} kg CO2`,"Einsparung"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(G,{dataKey:"co2_einsparung",name:"CO2 eingespart",fill:"#10b981",radius:[4,4,0,0]})]})})})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kumulierte CO2-Einsparung"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:a,margin:{top:10,right:30,left:0,bottom:5},children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(se,{tickFormatter:d=>`${(d/1e3).toFixed(1)}`,unit:" t",tick:{fontSize:11}}),e.jsx(Y,{formatter:d=>[`${(d/1e3).toFixed(2)} t CO2`,"Kumuliert"],contentStyle:{backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e5e7eb"}}),e.jsx(Be,{type:"monotone",dataKey:"kumuliert_co2",name:"Kumulierte Einsparung",stroke:"#10b981",fill:"#10b981",fillOpacity:.3})]})})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Gesamt nach ",r.anzahlMonate," Monaten:"]}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:[(i/1e3).toFixed(2)," t CO2"]})]})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Berechnungsgrundlage"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Die CO2-Einsparung wird mit dem deutschen Strommix von ",e.jsxs("strong",{children:[lr*1e3," g CO2/kWh"]})," berechnet. Jede kWh selbst erzeugter Solarstrom, die fossilen Strom ersetzt, spart entsprechend CO2 ein."]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Monat"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate).toFixed(0)," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro kWh"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(lr*1e3).toFixed(0)," g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Ø pro Jahr"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12/1e3).toFixed(2)," t"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Hochgerechnet 20 Jahre"}),e.jsxs("p",{className:"font-medium text-green-600",children:[(i/r.anzahlMonate*12*20/1e3).toFixed(1)," t"]})]})]})]})]})}function Sn({anlageId:t,strompreis:r,selectedYear:s="all"}){var v,j,_;const{investitionen:n,loading:a}=rr(t),[i,b]=c.useState(null),[g,l]=c.useState(!0),[h,d]=c.useState(new Set);c.useEffect(()=>{(async()=>{try{l(!0);const f=await Ee.getROIDashboard(t,r==null?void 0:r.netzbezug_arbeitspreis_cent_kwh,r==null?void 0:r.einspeiseverguetung_cent_kwh,void 0,s);b(f)}catch(f){console.error("ROI-Dashboard Fehler:",f)}finally{l(!1)}})()},[t,r,s]);const y=c.useMemo(()=>{const w={};return n.forEach(f=>{w[f.typ]||(w[f.typ]=[]),w[f.typ].push(f)}),w},[n]),u=c.useMemo(()=>Object.entries(y).map(([w,f])=>({typ:w,label:Rt[w]||w,kosten:f.reduce((x,o)=>x+(o.anschaffungskosten_gesamt||0),0),color:Nt[w]||"#6b7280"})).filter(w=>w.kosten>0).sort((w,f)=>f.kosten-w.kosten),[y]),m=c.useMemo(()=>{if(!i||!i.gesamt_jahres_einsparung)return[];const w=i.gesamt_relevante_kosten,f=i.gesamt_jahres_einsparung,x=[];for(let o=0;o<=25;o++){const E=o*f;x.push({jahr:o,investition:w,ersparnis:E,bilanz:E-w})}return x},[i]);if(a||g)return e.jsx(xe,{text:"Lade Investitionsdaten..."});if(n.length===0)return e.jsxs(S,{className:"text-center py-8",children:[e.jsx(zt,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Investitionen erfasst"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Erfasse Investitionen in den Einstellungen, um die ROI-Auswertung zu sehen."})]});const p=(v=i==null?void 0:i.berechnungen.find(w=>w.investition_typ==="pv-module"))==null?void 0:v.detail_berechnung,k=p==null?void 0:p.hinweis;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Gesamtinvestition",value:((i==null?void 0:i.gesamt_relevante_kosten)||0).toFixed(0),unit:"€",subtitle:`${n.length} Komponenten`,icon:Fa,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten − Alternativkosten",berechnung:i?`${N(i.gesamt_investition,0)} € − ${N(i.gesamt_investition-i.gesamt_relevante_kosten,0)} € Alternativ`:void 0,ergebnis:i?`= ${N(i.gesamt_relevante_kosten,0)} € relevante Kosten`:void 0}),e.jsx(ie,{title:"Jahresersparnis",value:((i==null?void 0:i.gesamt_jahres_einsparung)||0).toFixed(0),unit:"€/Jahr",icon:be,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Einspeiseerlös + Eigenverbrauch-Ersparnis",berechnung:p?`${N(p.einspeise_erloes_euro,2)} € + ${N(p.ev_ersparnis_euro,2)} €`:"Σ aller Investitions-Einsparungen",ergebnis:k||(i?`= ${N(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0)}),e.jsx(ie,{title:"ROI",value:((j=i==null?void 0:i.gesamt_roi_prozent)==null?void 0:j.toFixed(1))||"---",unit:"%",subtitle:"pro Jahr",icon:be,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"Jahresersparnis ÷ Relevante Kosten × 100",berechnung:i&&i.gesamt_relevante_kosten>0?`${N(i.gesamt_jahres_einsparung,0)} € ÷ ${N(i.gesamt_relevante_kosten,0)} € × 100`:void 0,ergebnis:i!=null&&i.gesamt_roi_prozent?`= ${i.gesamt_roi_prozent.toFixed(1)}% ROI p.a.`:void 0}),e.jsx(ie,{title:"Amortisation",value:((_=i==null?void 0:i.gesamt_amortisation_jahre)==null?void 0:_.toFixed(1))||"---",unit:"Jahre",icon:ht,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Relevante Kosten ÷ Jahresersparnis",berechnung:i&&i.gesamt_jahres_einsparung>0?`${N(i.gesamt_relevante_kosten,0)} € ÷ ${N(i.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:i!=null&&i.gesamt_amortisation_jahre?`= ${i.gesamt_amortisation_jahre.toFixed(1)} Jahre bis zur Kostendeckung`:void 0})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsx(lt,{data:u,cx:"50%",cy:"50%",outerRadius:80,dataKey:"kosten",nameKey:"label",label:({label:w,percent:f})=>`${w}: ${(f*100).toFixed(0)}%`,labelLine:!1,children:u.map((w,f)=>e.jsx(We,{fill:w.color},`cell-${f}`))}),e.jsx(Y,{formatter:w=>[`${w.toFixed(0)} €`,""]})]})})})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Kosten nach Kategorie"}),e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:u,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{type:"number",unit:" €",tick:{fontSize:11}}),e.jsx(se,{type:"category",dataKey:"label",tick:{fontSize:11},width:100}),e.jsx(Y,{formatter:w=>[`${w.toFixed(0)} €`,""]}),e.jsx(G,{dataKey:"kosten",name:"Kosten",children:u.map((w,f)=>e.jsx(We,{fill:w.color},`cell-${f}`))})]})})})]})]}),m.length>0&&e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(ft,{data:m,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"jahr",unit:" J.",tick:{fontSize:11}}),e.jsx(se,{unit:" €",tick:{fontSize:11}}),e.jsx(Y,{formatter:w=>[`${w.toFixed(0)} €`,""]}),e.jsx(pe,{}),e.jsx(Be,{type:"monotone",dataKey:"investition",name:"Investition",stroke:Ue.grid,fill:Ue.grid,fillOpacity:.3}),e.jsx(Be,{type:"monotone",dataKey:"ersparnis",name:"Kum. Ersparnis",stroke:Ue.feedin,fill:Ue.feedin,fillOpacity:.3})]})})}),(i==null?void 0:i.gesamt_amortisation_jahre)&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Break-Even nach ca. ",i.gesamt_amortisation_jahre.toFixed(1)," Jahren"]})]}),(i==null?void 0:i.berechnungen)&&i.berechnungen.length>0&&(()=>{const w=i.berechnungen.filter(o=>{var E;return o.investition_typ==="pv-module"&&typeof((E=o.detail_berechnung)==null?void 0:E.hinweis)=="string"&&o.detail_berechnung.hinweis.includes("ohne Wechselrichter")}),f=i.berechnungen.filter(o=>{var E;return o.investition_typ==="wechselrichter"&&typeof((E=o.detail_berechnung)==null?void 0:E.hinweis)=="string"&&o.detail_berechnung.hinweis.includes("ohne zugeordnete PV-Module")}),x=w.length>0||f.length>0;return e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"ROI pro Investition"}),x&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-amber-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Konfiguration unvollständig"}),e.jsxs("ul",{className:"mt-1 text-amber-700 dark:text-amber-300 list-disc list-inside",children:[w.length>0&&e.jsxs("li",{children:[w.length," PV-Modul",w.length>1?"e":""," ohne Wechselrichter-Zuordnung → Bitte unter Einstellungen → Investitionen zuordnen"]}),f.length>0&&e.jsxs("li",{children:[f.length," Wechselrichter ohne PV-Module → Bitte PV-Module zuordnen oder Wechselrichter entfernen"]})]}),e.jsx("p",{className:"mt-2 text-amber-600 dark:text-amber-400 text-xs",children:"Ohne korrekte Zuordnung kann der ROI nicht korrekt auf Systemebene berechnet werden."})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bezeichnung"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Typ"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Mehrkosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Ersparnis/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Amortisation"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.berechnungen.map(o=>{var V,L;const E=o.anschaffungskosten_alternativ>0,D=E?"Anschaffung − Alternativkosten":"Anschaffungskosten (keine Alternative)",W=E?`${N(o.anschaffungskosten,0)} € − ${N(o.anschaffungskosten_alternativ,0)} €`:`${N(o.anschaffungskosten,0)} €`,J=`= ${N(o.relevante_kosten,0)} € Mehrkosten`,C=(o.detail_berechnung||{}).hinweis,q=o.investition_typ==="pv-system"&&o.komponenten&&o.komponenten.length>0,F=h.has(o.investition_id),Q=o.investition_typ==="pv-module"&&typeof C=="string"&&C.includes("ohne Wechselrichter"),A=o.investition_typ==="wechselrichter"&&typeof C=="string"&&C.includes("ohne zugeordnete PV-Module"),ae=()=>{d(R=>{const ne=new Set(R);return ne.has(o.investition_id)?ne.delete(o.investition_id):ne.add(o.investition_id),ne})};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-800 ${q?"cursor-pointer":""}`,onClick:q?ae:void 0,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2",children:[q&&(F?e.jsx(gt,{className:"h-4 w-4 text-gray-400"}):e.jsx(yt,{className:"h-4 w-4 text-gray-400"})),(Q||A)&&e.jsx("span",{title:Q?"PV-Modul ohne Wechselrichter-Zuordnung":"Wechselrichter ohne PV-Module",children:e.jsx(Ie,{className:"h-4 w-4 text-amber-500"})}),o.investition_bezeichnung,q&&e.jsxs("span",{className:"text-xs text-gray-400",children:["(",o.komponenten.length," Komponenten)"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Nt[o.investition_typ]||"#6b7280"}20`,color:Nt[o.investition_typ]||"#6b7280"},children:Rt[o.investition_typ]||o.investition_typ})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(kt,{formel:D,berechnung:W,ergebnis:J,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[o.relevante_kosten.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:e.jsx(kt,{formel:`Jahresersparnis ${Rt[o.investition_typ]||o.investition_typ}`,berechnung:C||"Berechnet aus Verbrauchsdaten",ergebnis:`= ${N(o.jahres_einsparung,0)} €/Jahr`,children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-green-400",children:[o.jahres_einsparung.toFixed(0)," €"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(kt,{formel:"Ersparnis ÷ Mehrkosten × 100",berechnung:`${N(o.jahres_einsparung,0)} € ÷ ${N(o.relevante_kosten,0)} € × 100`,ergebnis:o.roi_prozent?`= ${o.roi_prozent.toFixed(1)}% p.a.`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((V=o.roi_prozent)==null?void 0:V.toFixed(1))||"---","%"]})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white",children:e.jsx(kt,{formel:"Mehrkosten ÷ Ersparnis",berechnung:`${N(o.relevante_kosten,0)} € ÷ ${N(o.jahres_einsparung,0)} €/Jahr`,ergebnis:o.amortisation_jahre?`= ${o.amortisation_jahre.toFixed(1)} Jahre`:"nicht berechenbar",children:e.jsxs("span",{className:"cursor-help border-b border-dotted border-gray-400",children:[((L=o.amortisation_jahre)==null?void 0:L.toFixed(1))||"---"," J."]})})})]},o.investition_id),q&&F&&o.komponenten.map(R=>{var ne,oe;return e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 pl-10",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:Nt[R.typ]||"#6b7280"}}),R.bezeichnung]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${Nt[R.typ]||"#6b7280"}15`,color:Nt[R.typ]||"#6b7280"},children:Rt[R.typ]||R.typ})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:[R.relevante_kosten.toFixed(0)," €"]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right text-gray-500",children:R.einsparung!==null?e.jsxs("span",{className:"text-green-500",children:[R.einsparung.toFixed(0)," €"]}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"via Module"})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right text-gray-400",colSpan:2,children:[typeof((ne=R.detail)==null?void 0:ne.anteil_prozent)=="number"&&e.jsxs("span",{className:"text-xs",children:[R.detail.anteil_prozent.toFixed(0),"% Anteil"]}),typeof((oe=R.detail)==null?void 0:oe.hinweis)=="string"&&e.jsx("span",{className:"text-xs italic",children:R.detail.hinweis})]})]},`komp-${R.investition_id}`)})]})})})]})})]})})(),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alle Investitionen"}),e.jsx("div",{className:"grid gap-3",children:Object.entries(y).map(([w,f])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Nt[w]||"#6b7280"}}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:Rt[w]||w}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",f.length,")"]})]}),e.jsx("div",{className:"grid gap-2",children:f.map(x=>{var o;return e.jsxs("div",{className:"flex justify-between items-center text-sm py-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:x.bezeichnung}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[((o=x.anschaffungskosten_gesamt)==null?void 0:o.toFixed(0))||"0"," €"]})]},x.id)})})]},w))})]})]})}const St=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#06b6d4","#ec4899"];function En({anlageId:t,selectedYear:r,verfuegbareJahre:s,zeitraumLabel:n}){var k,v;const[a,i]=c.useState(null),[b,g]=c.useState(!0),[l,h]=c.useState(null),[d,y]=c.useState(new Map);c.useEffect(()=>{(async()=>{var _,w;g(!0),h(null);try{if(r==="all"){const f=new Map;for(const x of s)try{const o=await Lt.getPVStrings(t,x);f.set(x,o)}catch(o){console.error(`Fehler beim Laden Jahr ${x}:`,o)}if(y(f),f.size>0){const x=f.get(s[0]);if(x){const o=x.strings.map(K=>{let C=0,q=0;f.forEach(A=>{const ae=A.strings.find(V=>V.investition_id===K.investition_id);ae&&(C+=ae.prognose_jahr_kwh,q+=ae.ist_jahr_kwh)});const F=C>0?(q-C)/C*100:null,Q=C>0?q/C:null;return{...K,prognose_jahr_kwh:C,ist_jahr_kwh:q,abweichung_jahr_prozent:F,abweichung_jahr_kwh:q-C,performance_ratio_jahr:Q,spezifischer_ertrag_kwh_kwp:K.leistung_kwp>0?q/K.leistung_kwp:null,monatswerte:K.monatswerte.map((A,ae)=>{let V=0,L=0;return f.forEach(R=>{const ne=R.strings.find(oe=>oe.investition_id===K.investition_id);ne&&ne.monatswerte[ae]&&(V+=ne.monatswerte[ae].prognose_kwh,L+=ne.monatswerte[ae].ist_kwh)}),{...A,prognose_kwh:V,ist_kwh:L}})}}),E=o.reduce((K,C)=>K+C.prognose_jahr_kwh,0),D=o.reduce((K,C)=>K+C.ist_jahr_kwh,0),W=[...o].filter(K=>K.performance_ratio_jahr!==null).sort((K,C)=>(C.performance_ratio_jahr||0)-(K.performance_ratio_jahr||0)),J={...x,strings:o,prognose_gesamt_kwh:E,ist_gesamt_kwh:D,abweichung_gesamt_kwh:D-E,abweichung_gesamt_prozent:E>0?(D-E)/E*100:null,bester_string:((_=W[0])==null?void 0:_.bezeichnung)||null,schlechtester_string:((w=W[W.length-1])==null?void 0:w.bezeichnung)||null};i(J)}}}else{const f=await Lt.getPVStrings(t,r);i(f)}}catch(f){h("Fehler beim Laden der String-Daten"),console.error(f)}finally{g(!1)}})()},[t,r,s]);const u=c.useMemo(()=>r!=="all"||d.size===0?[]:s.map(j=>{const _=d.get(j);if(!_)return null;const w={name:j.toString(),jahr:j};return _.strings.forEach(f=>{w[f.bezeichnung]=f.performance_ratio_jahr?Math.round(f.performance_ratio_jahr*100):0}),w.Gesamt=_.abweichung_gesamt_prozent?100+_.abweichung_gesamt_prozent:100,w}).filter(Boolean).reverse(),[r,d,s]),m=()=>{if(!a)return;const j=["String","kWp","Ausrichtung","SOLL (kWh)","IST (kWh)","Abweichung (%)","Performance Ratio","kWh/kWp"],_=a.strings.map(f=>[f.bezeichnung,f.leistung_kwp,f.ausrichtung||"-",f.prognose_jahr_kwh,f.ist_jahr_kwh,f.abweichung_jahr_prozent??"-",f.performance_ratio_jahr?(f.performance_ratio_jahr*100).toFixed(1)+"%":"-",f.spezifischer_ertrag_kwh_kwp??"-"]),w=r==="all"?"alle_jahre":r.toString();sr(j,_,`pv_strings_${w}.csv`)};if(b)return e.jsx(xe,{text:"Lade PV-String Daten..."});if(l)return e.jsx(re,{type:"error",children:l});if(!a||a.strings.length===0)return e.jsxs(S,{className:"text-center py-8",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine PV-Module gefunden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Bitte PV-Module unter Einstellungen → Investitionen anlegen."})]});if(!a.hat_prognose)return e.jsx(re,{type:"warning",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Keine PVGIS-Prognose vorhanden. Bitte unter Einstellungen → PVGIS eine Prognose abrufen, um den SOLL-IST Vergleich zu nutzen."})]})});const p=[...a.strings].sort((j,_)=>(_.performance_ratio_jahr||0)-(j.performance_ratio_jahr||0));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:n})," ","•"," ",a.strings.length," Strings • ",a.anlagen_leistung_kwp.toFixed(1)," kWp"]}),e.jsxs(X,{variant:"secondary",size:"sm",onClick:m,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"CSV Export"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"SOLL (Prognose)",value:(a.prognose_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:"PVGIS Jahresprognose",icon:ee,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ PVGIS-Prognose aller Strings",berechnung:a.strings.map(j=>`${j.bezeichnung}: ${j.prognose_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${N(a.prognose_gesamt_kwh,0)} kWh`}),e.jsx(ie,{title:"IST (Erzeugt)",value:(a.ist_gesamt_kwh/1e3).toFixed(1),unit:"MWh",subtitle:n,icon:be,color:"text-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",formel:"Σ Erzeugung aller Strings",berechnung:a.strings.map(j=>`${j.bezeichnung}: ${j.ist_jahr_kwh.toFixed(0)} kWh`).join(" + "),ergebnis:`= ${N(a.ist_gesamt_kwh,0)} kWh`}),e.jsx(ie,{title:"Abweichung",value:`${(a.abweichung_gesamt_prozent||0)>=0?"+":""}${(a.abweichung_gesamt_prozent||0).toFixed(1)}`,unit:"%",subtitle:`${a.abweichung_gesamt_kwh>=0?"+":""}${a.abweichung_gesamt_kwh.toFixed(0)} kWh`,icon:(a.abweichung_gesamt_prozent||0)>=0?be:jt,color:(a.abweichung_gesamt_prozent||0)>=0?"text-green-500":"text-red-500",bgColor:(a.abweichung_gesamt_prozent||0)>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20",formel:"(IST - SOLL) ÷ SOLL × 100",berechnung:`(${N(a.ist_gesamt_kwh,0)} - ${N(a.prognose_gesamt_kwh,0)}) ÷ ${N(a.prognose_gesamt_kwh,0)} × 100`,ergebnis:`= ${N(a.abweichung_gesamt_prozent||0,1)} %`}),e.jsx(ie,{title:"Spez. Ertrag Ø",value:(a.ist_gesamt_kwh/a.anlagen_leistung_kwp).toFixed(0),unit:"kWh/kWp",subtitle:n,icon:Dr,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",formel:"IST-Erzeugung ÷ Anlagenleistung",berechnung:`${N(a.ist_gesamt_kwh,0)} kWh ÷ ${N(a.anlagen_leistung_kwp,1)} kWp`,ergebnis:`= ${N(a.ist_gesamt_kwh/a.anlagen_leistung_kwp,0)} kWh/kWp`})]}),a.strings.length>1&&e.jsxs("div",{className:"flex flex-wrap gap-3",children:[a.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-50 dark:bg-green-900/20 px-4 py-2 rounded-lg",children:[e.jsx(be,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:"Beste Performance"}),e.jsx("p",{className:"font-medium text-green-700 dark:text-green-300",children:a.bester_string})]})]}),a.schlechtester_string&&a.schlechtester_string!==a.bester_string&&e.jsxs("div",{className:"flex items-center gap-2 bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-lg",children:[e.jsx(jt,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:"Schwächste Performance"}),e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300",children:a.schlechtester_string})]})]})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Dr,{className:"h-5 w-5 text-blue-500"}),"SOLL vs IST pro String"]}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:a.strings.map((j,_)=>({name:j.bezeichnung.length>12?j.bezeichnung.slice(0,12)+"...":j.bezeichnung,SOLL:j.prognose_jahr_kwh,IST:j.ist_jahr_kwh,color:St[_%St.length]})),layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{type:"number",unit:" kWh"}),e.jsx(se,{type:"category",dataKey:"name",width:100,tick:{fontSize:11}}),e.jsx(Y,{formatter:j=>[`${j.toFixed(0)} kWh`,""]}),e.jsx(pe,{}),e.jsx(G,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL (Prognose)"}),e.jsx(G,{dataKey:"IST",fill:"#f59e0b",name:"IST (Erzeugt)"})]})})})]}),e.jsxs(S,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Monatsverlauf SOLL vs IST ",r==="all"?"(Summe aller Jahre)":""]}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:((k=a.strings[0])==null?void 0:k.monatswerte.map((j,_)=>{const w={name:j.monat_name,SOLL:a.strings.reduce((f,x)=>{var o;return f+(((o=x.monatswerte[_])==null?void 0:o.prognose_kwh)||0)},0),IST:a.strings.reduce((f,x)=>{var o;return f+(((o=x.monatswerte[_])==null?void 0:o.ist_kwh)||0)},0)};return w.Abweichung=w.IST-w.SOLL,w}))||[],children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:10}}),e.jsx(se,{unit:" kWh",tick:{fontSize:11}}),e.jsx(Y,{formatter:j=>[`${j.toFixed(0)} kWh`,""]}),e.jsx(pe,{}),e.jsx(G,{dataKey:"SOLL",fill:"#3b82f6",name:"SOLL",opacity:.6}),e.jsx(G,{dataKey:"IST",fill:"#f59e0b",name:"IST"}),e.jsx(Ae,{type:"monotone",dataKey:"Abweichung",stroke:"#10b981",strokeWidth:2,dot:{r:3},name:"Abweichung"})]})})})]}),r==="all"&&u.length>1&&e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Performance-Entwicklung über Jahre"}),e.jsx("div",{className:"h-72",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(tr,{data:u,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name"}),e.jsx(se,{unit:"%",domain:[80,120],ticks:[80,90,100,110,120]}),e.jsx(Y,{formatter:j=>[`${j}%`,""]}),e.jsx(pe,{}),a.strings.map((j,_)=>e.jsx(Ae,{type:"monotone",dataKey:j.bezeichnung,stroke:St[_%St.length],strokeWidth:2,dot:{r:4}},j.investition_id)),e.jsx(Ae,{type:"monotone",dataKey:"Gesamt",stroke:"#6b7280",strokeWidth:3,strokeDasharray:"5 5",dot:{r:4}})]})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"100% = Prognose erreicht • Werte über 100% = Überperformance"})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"String-Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"String"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWp"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-500",children:"Ausrichtung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"SOLL"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"IST"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"Abweichung"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-500",children:"kWh/kWp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:p.map(j=>{var _,w;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-3 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:St[a.strings.findIndex(f=>f.investition_id===j.investition_id)%St.length]}}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:j.bezeichnung})]}),j.wechselrichter_name&&e.jsxs("p",{className:"text-xs text-gray-500 ml-5",children:["→ ",j.wechselrichter_name]})]}),e.jsx("td",{className:"px-3 py-3 text-right",children:j.leistung_kwp.toFixed(1)}),e.jsxs("td",{className:"px-3 py-3",children:[j.ausrichtung||"-",j.neigung_grad&&` / ${j.neigung_grad}°`]}),e.jsxs("td",{className:"px-3 py-3 text-right text-blue-600",children:[j.prognose_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-3 text-right text-amber-600 font-medium",children:[j.ist_jahr_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-3 text-right font-medium ${(j.abweichung_jahr_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(j.abweichung_jahr_prozent||0)>=0?"+":"",((_=j.abweichung_jahr_prozent)==null?void 0:_.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-3 text-right text-purple-600",children:((w=j.spezifischer_ertrag_kwh_kwp)==null?void 0:w.toFixed(0))||"-"})]},j.investition_id)})}),e.jsx("tfoot",{className:"bg-gray-100 dark:bg-gray-800 font-medium",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:"Gesamt"}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.anlagen_leistung_kwp.toFixed(1)}),e.jsx("td",{className:"px-3 py-2",children:"-"}),e.jsxs("td",{className:"px-3 py-2 text-right text-blue-600",children:[a.prognose_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"px-3 py-2 text-right text-amber-600",children:[a.ist_gesamt_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:`px-3 py-2 text-right ${(a.abweichung_gesamt_prozent||0)>=0?"text-green-600":"text-red-600"}`,children:[(a.abweichung_gesamt_prozent||0)>=0?"+":"",((v=a.abweichung_gesamt_prozent)==null?void 0:v.toFixed(1))||0,"%"]}),e.jsx("td",{className:"px-3 py-2 text-right text-purple-600",children:(a.ist_gesamt_kwh/a.anlagen_leistung_kwp).toFixed(0)})]})})]})})]})]})}function Fn(t,r){if(t==="all"){if(r.length===0)return"Alle Jahre";if(r.length===1)return`${r[0]}`;const s=Math.min(...r),n=Math.max(...r);return`${s}–${n}`}return`${t}`}function hs(){var f;const t=er(),[r,s]=c.useState("energie"),[n,a]=c.useState("all"),{anlagen:i,loading:b}=Ce(),[g,l]=c.useState(null),h=g??((f=i[0])==null?void 0:f.id),d=i.find(x=>x.id===h),{monatsdaten:y,loading:u}=Gr(h),{strompreis:m}=Hs(h??null),p=c.useMemo(()=>[...new Set(y.map(o=>o.jahr))].sort((o,E)=>E-o),[y]),k=c.useMemo(()=>n==="all"?y:y.filter(x=>x.jahr===n),[y,n]),v=Rs(k);if(b||u)return e.jsx(xe,{text:"Lade Auswertungen..."});if(i.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsx(re,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});if(y.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs(S,{className:"text-center py-12",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine Daten vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Erfasse Monatsdaten, um Auswertungen zu sehen."}),e.jsxs(X,{onClick:()=>t("/monatsdaten"),children:["Monatsdaten erfassen",e.jsx($e,{className:"h-4 w-4 ml-2"})]})]})]});const _=[{key:"energie",label:"Energie"},{key:"pv",label:"PV-Anlage"},{key:"komponenten",label:"Komponenten"},{key:"finanzen",label:"Finanzen"},{key:"co2",label:"CO2"},{key:"investitionen",label:"Investitionen"}],w=Fn(n,p);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Auswertung"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4 text-gray-400"}),e.jsxs("select",{value:n,onChange:x=>a(x.target.value==="all"?"all":Number(x.target.value)),className:"input w-auto",children:[e.jsx("option",{value:"all",children:"Alle Jahre"}),p.map(x=>e.jsx("option",{value:x,children:x},x))]})]}),i.length>1&&e.jsx("select",{value:h??"",onChange:x=>l(Number(x.target.value)),className:"input w-auto",children:i.map(x=>e.jsx("option",{value:x.id,children:x.anlagenname},x.id))})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:_.map(x=>e.jsx("button",{onClick:()=>s(x.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors ${r===x.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:x.label},x.key))})})]}),e.jsxs("div",{children:[r==="energie"&&e.jsx(Nn,{data:k,stats:v,anlage:d,strompreis:m,zeitraumLabel:w}),r==="pv"&&h&&e.jsx(En,{anlageId:h,selectedYear:n,verfuegbareJahre:p,zeitraumLabel:w}),r==="komponenten"&&e.jsx(vn,{anlage:d,strompreis:m,selectedYear:n,zeitraumLabel:w}),r==="finanzen"&&e.jsx(_n,{data:k,stats:v,strompreis:m,anlageId:h,zeitraumLabel:w}),r==="co2"&&e.jsx(zn,{data:k,stats:v,zeitraumLabel:w}),r==="investitionen"&&h&&e.jsx(Sn,{anlageId:h,strompreis:m,selectedYear:n,zeitraumLabel:w})]})]})}const Wn={"e-auto":Ne,waermepumpe:Se,speicher:je,wallbox:at,wechselrichter:$t,"pv-module":ee,balkonkraftwerk:Ls,sonstiges:$t},Nr={"e-auto":"#3b82f6",waermepumpe:"#f97316",speicher:"#22c55e",wallbox:"#a855f7",wechselrichter:"#06b6d4","pv-module":"#eab308",balkonkraftwerk:"#14b8a6",sonstiges:"#6b7280"},ms={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"};function $n(){var x;const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(null),[a,i]=c.useState(null),[b,g]=c.useState(!1),[l,h]=c.useState(null),[d,y]=c.useState(30),[u,m]=c.useState(8.2),[p,k]=c.useState(1.85),v=s??((x=t[0])==null?void 0:x.id),{strompreis:j}=Hs(v??null);c.useEffect(()=>{j&&(y(j.netzbezug_arbeitspreis_cent_kwh),m(j.einspeiseverguetung_cent_kwh))},[j]),c.useEffect(()=>{if(!v)return;(async()=>{try{g(!0),h(null);const E=await Ee.getROIDashboard(v,d,u,p);i(E)}catch(E){h(E instanceof Error?E.message:"Fehler beim Laden der ROI-Daten")}finally{g(!1)}})()},[v,d,u,p]);const _=c.useMemo(()=>{if(!a||a.gesamt_relevante_kosten<=0)return[];const o=[];let E=0;const D=Math.min(Math.ceil((a.gesamt_amortisation_jahre??20)*1.5),30);for(let W=0;W<=D;W++)o.push({jahr:W,kumulierte_einsparung:Math.round(E),investition:a.gesamt_relevante_kosten}),E+=a.gesamt_jahres_einsparung;return o},[a]),w=c.useMemo(()=>{if(!a)return[];const o={};return a.berechnungen.forEach(E=>{const D=E.investition_typ;o[D]=(o[D]||0)+E.jahres_einsparung}),Object.entries(o).map(([E,D])=>({name:ms[E]||E,value:Math.round(D),color:Nr[E]||"#6b7280"})).filter(E=>E.value>0)},[a]),f=c.useMemo(()=>a?a.berechnungen.map(o=>({name:o.investition_bezeichnung.length>15?o.investition_bezeichnung.substring(0,15)+"...":o.investition_bezeichnung,fullName:o.investition_bezeichnung,kosten:o.relevante_kosten,einsparung:o.jahres_einsparung,amortisation:o.amortisation_jahre??0,typ:o.investition_typ,color:Nr[o.investition_typ]||"#6b7280"})):[],[a]);return r?e.jsx(xe,{text:"Lade Daten..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx(re,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ROI-Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Wirtschaftlichkeitsanalyse deiner Investitionen"})]}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:v??"",onChange:o=>n(Number(o.target.value)),className:"input w-auto",children:t.map(o=>e.jsx("option",{value:o.id,children:o.anlagenname},o.id))})})]}),l&&e.jsx(re,{type:"error",onClose:()=>h(null),children:l}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($t,{className:"h-5 w-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Berechnungsparameter"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Strompreis (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:d,onChange:o=>y(Number(o.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Einspeisevergütung (Cent/kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:u,onChange:o=>m(Number(o.target.value)),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benzinpreis (Euro/Liter)"}),e.jsx("input",{type:"number",step:"0.01",value:p,onChange:o=>k(Number(o.target.value)),className:"input"})]})]})]}),b&&e.jsx(xe,{text:"Berechne ROI..."}),!b&&a&&a.berechnungen.length===0&&e.jsx(Ct,{icon:zt,title:"Keine aktiven Investitionen",description:"Erfasse Investitionen auf der Investitionen-Seite, um deren Wirtschaftlichkeit zu analysieren."}),!b&&a&&a.berechnungen.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(dr,{icon:zt,title:"Gesamtinvestition",value:`${a.gesamt_investition.toLocaleString("de-DE")} €`,subtitle:`Relevant: ${a.gesamt_relevante_kosten.toLocaleString("de-DE")} €`,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",formel:"Σ Anschaffungskosten aller Investitionen",berechnung:"Relevant = Gesamt − Alternativkosten",ergebnis:`= ${N(a.gesamt_relevante_kosten,0)} €`}),e.jsx(dr,{icon:be,title:"Jährliche Einsparung",value:`${a.gesamt_jahres_einsparung.toLocaleString("de-DE")} €`,subtitle:a.gesamt_roi_prozent?`ROI: ${a.gesamt_roi_prozent}%`:"ROI: -",color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",formel:"Σ Einsparungen aller Investitionen",berechnung:a.gesamt_relevante_kosten>0?"ROI = Einsparung ÷ Kosten × 100":void 0,ergebnis:a.gesamt_roi_prozent?`= ${a.gesamt_roi_prozent}% ROI`:void 0}),e.jsx(dr,{icon:As,title:"Amortisation",value:a.gesamt_amortisation_jahre?`${a.gesamt_amortisation_jahre} Jahre`:"-",subtitle:"Bis zur Kostendeckung",color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",formel:"Relevante Kosten ÷ Jährliche Einsparung",berechnung:a.gesamt_jahres_einsparung>0?`${N(a.gesamt_relevante_kosten,0)} € ÷ ${N(a.gesamt_jahres_einsparung,0)} €/Jahr`:void 0,ergebnis:a.gesamt_amortisation_jahre?`= ${a.gesamt_amortisation_jahre} Jahre`:void 0}),e.jsx(dr,{icon:Ke,title:"CO2-Einsparung",value:`${a.gesamt_co2_einsparung_kg.toLocaleString("de-DE")} kg`,subtitle:"pro Jahr",color:"text-emerald-500",bgColor:"bg-emerald-50 dark:bg-emerald-900/20",formel:"Σ CO2-Einsparungen aller Investitionen",berechnung:"Je nach Investitionstyp unterschiedlich",ergebnis:`= ${N(a.gesamt_co2_einsparung_kg/1e3,2)} t CO2/Jahr`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Amortisationsverlauf"}),e.jsx("div",{className:"h-80",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(tr,{data:_,children:[e.jsx(le,{strokeDasharray:"3 3",opacity:.3}),e.jsx(de,{dataKey:"jahr",label:{value:"Jahre",position:"bottom"},tick:{fontSize:12}}),e.jsx(se,{tickFormatter:o=>`${(o/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(Y,{formatter:(o,E)=>[`${o.toLocaleString("de-DE")} €`,E==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"],labelFormatter:o=>`Jahr ${o}`}),e.jsx(pe,{formatter:o=>o==="kumulierte_einsparung"?"Kumulierte Einsparung":"Investition"}),e.jsx(Ae,{type:"monotone",dataKey:"kumulierte_einsparung",stroke:"#22c55e",strokeWidth:2,dot:!1}),e.jsx(Ae,{type:"monotone",dataKey:"investition",stroke:"#ef4444",strokeWidth:2,strokeDasharray:"5 5",dot:!1})]})})}),a.gesamt_amortisation_jahre&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2 text-center",children:["Break-Even nach ca. ",a.gesamt_amortisation_jahre," Jahren"]})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Einsparungen nach Typ"}),e.jsx("div",{className:"h-80",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsx(lt,{data:w,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:({name:o,percent:E})=>`${o}: ${(E*100).toFixed(0)}%`,labelLine:!0,children:w.map((o,E)=>e.jsx(We,{fill:o.color},`cell-${E}`))}),e.jsx(Y,{formatter:o=>[`${o.toLocaleString("de-DE")} €/Jahr`,"Einsparung"]})]})})})]})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitionen im Vergleich"}),e.jsx("div",{className:"h-80",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:f,layout:"vertical",children:[e.jsx(le,{strokeDasharray:"3 3",opacity:.3}),e.jsx(de,{type:"number",tickFormatter:o=>`${o.toLocaleString("de-DE")}`}),e.jsx(se,{dataKey:"name",type:"category",width:120,tick:{fontSize:11}}),e.jsx(Y,{formatter:(o,E)=>[E==="kosten"?`${o.toLocaleString("de-DE")} €`:`${o.toLocaleString("de-DE")} €/Jahr`,E==="kosten"?"Relevante Kosten":"Jährliche Einsparung"]}),e.jsx(pe,{formatter:o=>o==="kosten"?"Relevante Kosten (€)":"Jährliche Einsparung (€)"}),e.jsx(G,{dataKey:"kosten",fill:"#94a3b8",name:"kosten"}),e.jsx(G,{dataKey:"einsparung",fill:"#22c55e",name:"einsparung"})]})})})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detailübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Investition"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Kosten"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Einsparung/Jahr"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ROI"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amortisation"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"CO2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.berechnungen.map(o=>{const E=Wn[o.investition_typ]||$t;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4",style:{color:Nr[o.investition_typ]}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.investition_bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:ms[o.investition_typ]})]})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[o.relevante_kosten.toLocaleString("de-DE")," €"]}),o.anschaffungskosten_alternativ>0&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",o.anschaffungskosten.toLocaleString("de-DE")," € gesamt)"]})]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400 font-medium",children:[o.jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:o.roi_prozent?e.jsxs("span",{className:o.roi_prozent>=10?"text-green-600 dark:text-green-400":"text-gray-900 dark:text-white",children:[o.roi_prozent,"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:o.amortisation_jahre?e.jsxs("span",{className:o.amortisation_jahre<=10?"text-green-600 dark:text-green-400":"text-orange-500",children:[o.amortisation_jahre," J."]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-emerald-600 dark:text-emerald-400",children:o.co2_einsparung_kg?`${o.co2_einsparung_kg.toLocaleString("de-DE")} kg`:"-"})]},o.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:"Gesamt"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:[a.gesamt_relevante_kosten.toLocaleString("de-DE")," €"]}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-green-600 dark:text-green-400",children:[a.gesamt_jahres_einsparung.toLocaleString("de-DE")," €"]}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:a.gesamt_roi_prozent?`${a.gesamt_roi_prozent}%`:"-"}),e.jsx("td",{className:"px-4 py-3 text-right text-sm text-gray-900 dark:text-white",children:a.gesamt_amortisation_jahre?`${a.gesamt_amortisation_jahre} J.`:"-"}),e.jsxs("td",{className:"px-4 py-3 text-right text-sm text-emerald-600 dark:text-emerald-400",children:[a.gesamt_co2_einsparung_kg.toLocaleString("de-DE")," kg"]})]})})]})})]}),e.jsxs(re,{type:"info",children:[e.jsx("strong",{children:"Hinweis:"})," Die Berechnungen sind Prognosen basierend auf den eingegebenen Parametern. Die tatsächlichen Einsparungen können je nach Nutzungsverhalten und Energiepreisen abweichen."]})]})]})}function dr({icon:t,title:r,value:s,subtitle:n,color:a,bgColor:i,formel:b,berechnung:g,ergebnis:l}){const h=e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s});return e.jsx(S,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(t,{className:`h-6 w-6 ${a}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),b?e.jsx(kt,{formel:b,berechnung:g,ergebnis:l,children:h}):h,n&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n})]})]})})}const An=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],us=["#f59e0b","#3b82f6","#10b981","#8b5cf6","#ef4444","#06b6d4"];function Mn(){var q;const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState(new Date().getFullYear()),[b,g]=c.useState(null),[l,h]=c.useState([]),[d,y]=c.useState([]),[u,m]=c.useState(!1),[p,k]=c.useState(!1),[v,j]=c.useState(null);c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{s&&_()},[s,a]);const _=async()=>{if(s){m(!0),j(null);try{const F=await Ft.list(s);h(F);try{const A=await Re.getStringMonatsdaten(s,a);y(A)}catch{y([])}const Q=await Qe.getAktivePrognose(s);if(Q)g({jahresertrag_kwh:Q.jahresertrag_kwh,monatswerte:Q.monatswerte,isLive:!1});else try{const A=await Qe.getPrognose(s);g({jahresertrag_kwh:A.jahresertrag_kwh,monatswerte:A.monatsdaten.map(ae=>({monat:ae.monat,e_m:ae.e_m})),isLive:!0,module:A.module})}catch(A){g(null),A instanceof Error&&A.message.includes("PV-Module")&&j("Keine PV-Module für diese Anlage definiert. Bitte unter Einstellungen → Investitionen anlegen.")}}catch(F){j(F instanceof Error?F.message:"Fehler beim Laden")}finally{m(!1)}}},w=async()=>{if(s){k(!0);try{await Qe.speicherePrognose(s);const F=b==null?void 0:b.module;await _(),F&&F.length>0&&g(Q=>Q?{...Q,module:F}:null)}catch(F){j(F instanceof Error?F.message:"Fehler beim Speichern")}finally{k(!1)}}},f=[...new Set(l.map(F=>F.jahr))].sort((F,Q)=>Q-F);c.useEffect(()=>{f.length>0&&!f.includes(a)&&i(f[0])},[f,a]);const x=[];if(b!=null&&b.monatswerte)for(let F=1;F<=12;F++){const Q=((q=b.monatswerte.find(L=>L.monat===F))==null?void 0:q.e_m)||0,A=l.filter(L=>L.jahr===a&&L.monat===F).reduce((L,R)=>L+(R.pv_erzeugung_kwh||0),0),ae=A-Q,V=Q>0?ae/Q*100:0;x.push({monat:F,monatName:An[F],prognose:Q,ist:A,abweichung:ae,abweichungProzent:V})}const o=x.reduce((F,Q)=>F+Q.prognose,0),E=x.reduce((F,Q)=>F+Q.ist,0),D=E-o,W=o>0?D/o*100:0,K=12-x.filter(F=>F.ist===0).length,C=K>0?E/K*12:0;return r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ea,{className:"h-8 w-8 text-purple-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Prognose vs. IST"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:F=>n(parseInt(F.target.value)),options:t.map(F=>({value:F.id.toString(),label:F.anlagenname}))}),f.length>0&&e.jsx(Ge,{value:a.toString(),onChange:F=>i(parseInt(F.target.value)),options:f.map(F=>({value:F.toString(),label:F.toString()}))}),e.jsx("button",{onClick:_,disabled:u,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(qe,{className:`h-5 w-5 ${u?"animate-spin":""}`})})]})]}),v&&e.jsx(re,{type:"error",children:v}),u?e.jsx(xe,{text:"Lade Vergleichsdaten..."}):b?l.length===0?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine Monatsdaten für diese Anlage vorhanden."}),e.jsx("p",{className:"text-sm mt-2",children:'Erfasse Monatsdaten unter "Einstellungen → Monatsdaten".'})]})}):e.jsxs(e.Fragment,{children:[b.isLive&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Live-Prognose:"})," Diese Prognose wurde gerade von PVGIS abgerufen und ist noch nicht gespeichert."]}),e.jsxs(X,{size:"sm",onClick:w,disabled:p,children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),p?"Speichern...":"Speichern"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PVGIS Prognose"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:[o.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Jahr ",a]})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"IST-Erzeugung"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[E.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[K," von 12 Monaten"]})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Abweichung"}),e.jsxs("div",{className:"flex items-center gap-2",children:[D>=0?e.jsx(be,{className:"h-6 w-6 text-green-500"}):e.jsx(jt,{className:"h-6 w-6 text-red-500"}),e.jsxs("p",{className:`text-2xl font-bold ${D>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[D>=0?"+":"",D.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]})]}),e.jsxs("p",{className:`text-xs ${D>=0?"text-green-500":"text-red-500"}`,children:[D>=0?"+":"",W.toFixed(1),"%"]})]}),K<12&&K>0&&e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Hochrechnung Jahr"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[C.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["(",((C/o-1)*100).toFixed(1),"% vs. Prognose)"]})]})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Monatlicher Vergleich ",a]}),e.jsx("div",{className:"h-80",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:x,children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"monatName"}),e.jsx(se,{yAxisId:"left",tickFormatter:F=>`${F} kWh`}),e.jsx(se,{yAxisId:"right",orientation:"right",tickFormatter:F=>`${F}%`}),e.jsx(Y,{formatter:(F,Q)=>Q==="Abweichung %"?`${F.toFixed(1)}%`:`${F.toFixed(0)} kWh`}),e.jsx(pe,{}),e.jsx(sa,{yAxisId:"right",y:0,stroke:"#666",strokeDasharray:"3 3"}),e.jsx(G,{yAxisId:"left",dataKey:"prognose",fill:"#f59e0b",name:"PVGIS Prognose"}),e.jsx(G,{yAxisId:"left",dataKey:"ist",fill:"#22c55e",name:"IST-Erzeugung"}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"abweichungProzent",stroke:"#8b5cf6",strokeWidth:2,name:"Abweichung %",dot:{fill:"#8b5cf6"}})]})})})]}),b.module&&b.module.length>1&&e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"SOLL-IST Vergleich nach PV-Modul"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Vergleich der PVGIS-Prognose mit tatsächlichen Erträgen pro PV-Modul.",d.length===0&&e.jsx("span",{className:"text-yellow-600 ml-1",children:"(Keine String-Daten vorhanden - zeige nur Prognose)"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"PV-Modul"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Ausrichtung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"SOLL (PVGIS)"}),e.jsxs("th",{className:"text-right py-2 px-2",children:["IST ",a]}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"})]})}),e.jsx("tbody",{children:b.module.map((F,Q)=>{const A=d.filter(ne=>ne.investition_id===F.investition_id).reduce((ne,oe)=>ne+oe.pv_erzeugung_kwh,0),ae=F.monatsdaten.reduce((ne,oe)=>ne+oe.e_m,0),V=A-ae,L=ae>0?V/ae*100:0,R=A>0;return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:us[Q%us.length]}}),e.jsx("span",{className:"font-medium",children:F.bezeichnung})]})}),e.jsx("td",{className:"text-right py-2 px-2",children:F.leistung_kwp.toFixed(1)}),e.jsx("td",{className:"text-right py-2 px-2",children:F.ausrichtung}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[ae.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:R?e.jsxs("span",{className:"text-green-600",children:[A.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${V>=0?"text-green-600":"text-red-600"}`,children:R?`${V>=0?"+":""}${L.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:R?L>=-5?e.jsx(et,{className:"h-5 w-5 text-green-500 mx-auto"}):L>=-15?e.jsx("span",{className:"text-yellow-500",children:"⚠"}):e.jsx(br,{className:"h-5 w-5 text-red-500 mx-auto"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Keine Daten"})})]},F.investition_id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsx("td",{className:"text-right py-2 px-2",children:b.module.reduce((F,Q)=>F+Q.leistung_kwp,0).toFixed(1)}),e.jsx("td",{}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[o.toLocaleString("de-DE",{maximumFractionDigits:0})," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2 text-green-600",children:d.length>0?d.reduce((F,Q)=>F+Q.pv_erzeugung_kwh,0).toLocaleString("de-DE",{maximumFractionDigits:0})+" kWh":"-"}),e.jsx("td",{colSpan:2})]})})]})}),d.length===0&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Tipp:"}),' Um IST-Daten pro PV-Modul zu sehen, weise jedem PV-Modul unter "Einstellungen → Investitionen" einen Home Assistant String-Sensor zu.']})}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"})," Module mit deutlicher Unterperformance (<-15%) sollten auf Verschattung, Verschmutzung oder technische Probleme geprüft werden."]})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Monatliche Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-2",children:"PVGIS Prognose"}),e.jsx("th",{className:"text-right py-2 px-2",children:"IST-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Abweichung"}),e.jsx("th",{className:"text-right py-2 px-2",children:"%"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Bewertung"})]})}),e.jsx("tbody",{children:x.map(F=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:F.monatName}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[F.prognose.toFixed(0)," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:F.ist>0?e.jsxs("span",{className:"text-green-600",children:[F.ist.toFixed(0)," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`text-right py-2 px-2 ${F.abweichung>=0?"text-green-600":"text-red-600"}`,children:F.ist>0?`${F.abweichung>=0?"+":""}${F.abweichung.toFixed(0)} kWh`:"-"}),e.jsx("td",{className:`text-right py-2 px-2 ${F.abweichungProzent>=0?"text-green-600":"text-red-600"}`,children:F.ist>0?`${F.abweichungProzent>=0?"+":""}${F.abweichungProzent.toFixed(1)}%`:"-"}),e.jsx("td",{className:"text-center py-2 px-2",children:F.ist===0?e.jsx("span",{className:"text-gray-400",children:"Keine Daten"}):F.abweichungProzent>=5?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(be,{className:"h-4 w-4"}),"Übertroffen"]}):F.abweichungProzent>=-5?e.jsx("span",{className:"text-blue-600",children:"Im Plan"}):F.abweichungProzent>=-15?e.jsx("span",{className:"text-yellow-600",children:"Leicht unter Plan"}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-600",children:[e.jsx(jt,{className:"h-4 w-4"}),"Unter Plan"]})})]},F.monat))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-bold",children:[e.jsx("td",{className:"py-2 px-2",children:"Gesamt"}),e.jsxs("td",{className:"text-right py-2 px-2 text-yellow-600",children:[o.toFixed(0)," kWh"]}),e.jsxs("td",{className:"text-right py-2 px-2 text-green-600",children:[E.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${D>=0?"text-green-600":"text-red-600"}`,children:[D>=0?"+":"",D.toFixed(0)," kWh"]}),e.jsxs("td",{className:`text-right py-2 px-2 ${W>=0?"text-green-600":"text-red-600"}`,children:[W>=0?"+":"",W.toFixed(1),"%"]}),e.jsx("td",{})]})})]})})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-purple-700 dark:text-purple-300 mb-2",children:"Interpretation der Abweichungen"}),e.jsxs("ul",{className:"text-sm text-purple-600 dark:text-purple-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Übertroffen (>5%):"})," Die Anlage produziert mehr als erwartet - sehr gut!"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Im Plan (±5%):"})," Die Anlage entspricht den Erwartungen von PVGIS."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Leicht unter Plan (-5% bis -15%):"})," Kleinere Abweichungen, z.B. durch lokale Wetterbedingungen."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Unter Plan (<-15%):"})," Deutliche Minderleistung - Verschattung, Verschmutzung oder technische Probleme prüfen."]})]}),e.jsx("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-3",children:"Hinweis: PVGIS basiert auf langjährigen Mittelwerten. Einzelne Monate können stark abweichen."})]})]}):e.jsx(S,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Keine PVGIS Prognose verfügbar."}),e.jsx("p",{className:"text-sm mt-2",children:'Bitte definiere PV-Module unter "Einstellungen → Investitionen".'})]})})]})}const kr={async getKurzfristPrognose(t,r=14){return O.get(`/aussichten/kurzfristig/${t}?tage=${r}`)},async getLangfristPrognose(t,r=12){return O.get(`/aussichten/langfristig/${t}?monate=${r}`)},async getTrendAnalyse(t,r=3){return O.get(`/aussichten/trend/${t}?jahre=${r}`)},async getWetterVorhersage(t,r=7){return O.get(`/aussichten/wetter/${t}?tage=${r}`)},async getFinanzPrognose(t,r=12){return O.get(`/aussichten/finanzen/${t}?monate=${r}`)}};function cr({symbol:t,className:r="h-6 w-6"}){switch(t){case"sunny":return e.jsx(ee,{className:`${r} text-yellow-500`});case"partly_cloudy":return e.jsx(Ut,{className:`${r} text-gray-400`});case"cloudy":return e.jsx(Ut,{className:`${r} text-gray-500`});case"rainy":case"drizzle":case"showers":return e.jsx(ua,{className:`${r} text-blue-500`});case"snowy":case"snow_showers":return e.jsx(pa,{className:`${r} text-blue-300`});case"thunderstorm":return e.jsx(ma,{className:`${r} text-purple-500`});case"foggy":return e.jsx(Ut,{className:`${r} text-gray-300`});default:return e.jsx(ee,{className:`${r} text-yellow-400`})}}function vr(t){return new Date(t).toLocaleDateString("de-DE",{weekday:"short",day:"2-digit",month:"2-digit"})}function Cn(t){return new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit"})}function Ln({anlageId:t}){const[r,s]=c.useState(null),[n,a]=c.useState(!0),[i,b]=c.useState(null),[g,l]=c.useState(14);c.useEffect(()=>{h()},[t,g]);async function h(){a(!0),b(null);try{const m=await kr.getKurzfristPrognose(t,g);s(m)}catch(m){b(m.message||"Fehler beim Laden der Prognose")}finally{a(!1)}}if(n)return e.jsx(xe,{text:"Lade Kurzfrist-Prognose..."});if(i)return e.jsx(re,{type:"error",children:i});if(!r)return e.jsx(re,{type:"warning",children:"Keine Prognose verfügbar"});const d=r.tageswerte.map(m=>({datum:Cn(m.datum),datumFull:vr(m.datum),pv_kwh:m.pv_prognose_kwh,sonnenstunden:m.sonnenstunden,temperatur:m.temperatur_max_c})),y=r.tageswerte[0],u=r.tageswerte[1];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(me,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Summe ",g," Tage"]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.summe_kwh.toFixed(0)," kWh"]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ee,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Durchschnitt/Tag"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.durchschnitt_kwh_tag.toFixed(1)," kWh"]})]})]})}),y&&e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(cr,{symbol:y.wetter_symbol,className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Heute"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[y.pv_prognose_kwh.toFixed(1)," kWh"]})]})]})}),u&&e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(cr,{symbol:u.wetter_symbol,className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Morgen"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[u.pv_prognose_kwh.toFixed(1)," kWh"]})]})]})})]}),e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Wettervorhersage"}),e.jsxs("select",{value:g,onChange:m=>l(Number(m.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:7,children:"7 Tage"}),e.jsx("option",{value:14,children:"14 Tage"}),e.jsx("option",{value:16,children:"16 Tage"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex gap-2 min-w-max pb-2",children:r.tageswerte.map((m,p)=>{var k;return e.jsxs("div",{className:`flex flex-col items-center p-3 rounded-lg min-w-[80px] ${p===0?"bg-primary-50 dark:bg-primary-900/30 ring-2 ring-primary-500":"bg-gray-50 dark:bg-gray-800"}`,children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:vr(m.datum)}),e.jsx(cr,{symbol:m.wetter_symbol,className:"h-8 w-8 my-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[m.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Bs,{className:"h-3 w-3 text-gray-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[((k=m.temperatur_max_c)==null?void 0:k.toFixed(0))??"-","°C"]})]}),m.sonnenstunden!==null&&m.sonnenstunden>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(ee,{className:"h-3 w-3 text-yellow-500"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[m.sonnenstunden.toFixed(0),"h"]})]})]},m.datum)})})})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"PV-Prognose"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"datum",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(se,{yAxisId:"left",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(se,{yAxisId:"right",orientation:"right",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"°C",angle:90,position:"insideRight"}}),e.jsx(Y,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(m,p)=>p==="pv_kwh"?[`${m.toFixed(1)} kWh`,"PV-Prognose"]:p==="sonnenstunden"?[`${m.toFixed(1)} h`,"Sonnenstunden"]:p==="temperatur"?[`${m.toFixed(0)} °C`,"Temperatur"]:[m,p]}),e.jsx(pe,{}),e.jsx(G,{yAxisId:"left",dataKey:"pv_kwh",name:"PV-Prognose",fill:"#eab308",radius:[4,4,0,0]}),e.jsx(Ae,{yAxisId:"right",type:"monotone",dataKey:"temperatur",name:"Temperatur",stroke:"#ef4444",strokeWidth:2,dot:{r:3}})]})})})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Datum"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Wetter"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Prognose"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Strahlung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Sonnenstunden"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Temperatur"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Niederschlag"})]})}),e.jsx("tbody",{children:r.tageswerte.map((m,p)=>{var k,v,j;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${p===0?"bg-primary-50 dark:bg-primary-900/20":""}`,children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:vr(m.datum)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(cr,{symbol:m.wetter_symbol,className:"h-5 w-5"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[m.pv_prognose_kwh.toFixed(1)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((k=m.globalstrahlung_kwh_m2)==null?void 0:k.toFixed(1))??"-"," kWh/m²"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((v=m.sonnenstunden)==null?void 0:v.toFixed(1))??"-"," h"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[((j=m.temperatur_max_c)==null?void 0:j.toFixed(0))??"-","°C"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:m.niederschlag_mm!==null&&m.niederschlag_mm>0?e.jsxs("span",{className:"text-blue-500",children:[m.niederschlag_mm.toFixed(1)," mm"]}):"-"})]},m.datum)})})]})})]}),e.jsx(S,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]}),e.jsxs("span",{children:["Systemverluste: ",r.system_losses_prozent.toFixed(0),"%"]}),e.jsxs("span",{children:["Datenquelle: ",r.datenquelle]}),e.jsxs("span",{children:["Abgerufen: ",new Date(r.abgerufen_am).toLocaleString("de-DE")]})]})})]})}function ps({richtung:t}){switch(t){case"positiv":return e.jsx(be,{className:"h-5 w-5 text-green-500"});case"negativ":return e.jsx(jt,{className:"h-5 w-5 text-red-500"});default:return e.jsx(Ir,{className:"h-5 w-5 text-gray-400"})}}function Dn({anlageId:t}){const[r,s]=c.useState(null),[n,a]=c.useState(!0),[i,b]=c.useState(null),[g,l]=c.useState(12),[h,d]=c.useState(!0);c.useEffect(()=>{y()},[t,g]);async function y(){a(!0),b(null);try{const k=await kr.getLangfristPrognose(t,g);s(k)}catch(k){b(k.message||"Fehler beim Laden der Prognose")}finally{a(!1)}}if(n)return e.jsx(xe,{text:"Lade Langfrist-Prognose..."});if(i)return e.jsx(re,{type:"error",children:i});if(!r)return e.jsx(re,{type:"warning",children:"Keine Prognose verfügbar"});const u=r.monatswerte.map(k=>({name:`${k.monat_name.substring(0,3)} ${k.jahr}`,monat_name:k.monat_name,jahr:k.jahr,pvgis:k.pvgis_prognose_kwh,trend:k.trend_korrigiert_kwh,min:k.konfidenz_min_kwh,max:k.konfidenz_max_kwh,konfidenz:[k.konfidenz_min_kwh,k.konfidenz_max_kwh],pr:k.historische_performance_ratio})),m=r.trend_analyse,p=(m.durchschnittliche_performance_ratio*100).toFixed(0)+"%";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(me,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahresprognose"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ht,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Zeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[g," Monate"]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ps,{richtung:m.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:p})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Oe,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenbasis"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[m.datenbasis_monate," Monate"]})]})]})})]}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatsprognose"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:k=>d(k.target.checked),className:"rounded border-gray-300"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Konfidenzband"})]}),e.jsxs("select",{value:g,onChange:k=>l(Number(k.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsx("div",{className:"h-[350px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:u,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60,className:"text-gray-600 dark:text-gray-400"}),e.jsx(se,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(Y,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:(k,v)=>v==="trend"?[`${k.toFixed(0)} kWh`,"Trend-korrigiert"]:v==="pvgis"?[`${k.toFixed(0)} kWh`,"PVGIS-Prognose"]:v==="konfidenz"&&Array.isArray(k)?[`${k[0].toFixed(0)} - ${k[1].toFixed(0)} kWh`,"Konfidenzband"]:[k,v]}),e.jsx(pe,{}),h&&e.jsx(Be,{type:"monotone",dataKey:"konfidenz",name:"Konfidenzband",fill:"#3b82f6",fillOpacity:.1,stroke:"none"}),e.jsx(G,{dataKey:"pvgis",name:"PVGIS-Prognose",fill:"#9ca3af",fillOpacity:.5,radius:[4,4,0,0]}),e.jsx(G,{dataKey:"trend",name:"Trend-korrigiert",fill:"#eab308",radius:[4,4,0,0]})]})})})}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Trend-Analyse"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(ps,{richtung:m.trend_richtung}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Trend"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white capitalize",children:m.trend_richtung})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Performance-Ratio"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[p,e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(IST / SOLL)"})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Datenquellen"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.datenquellen.join(", ")})]})]})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PVGIS"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Trend-korrigiert"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Min"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Max"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Hist. PR"})]})}),e.jsx("tbody",{children:r.monatswerte.map(k=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[k.monat_name," ",k.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[k.pvgis_prognose_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[k.trend_korrigiert_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[k.konfidenz_min_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-400",children:[k.konfidenz_max_kwh.toFixed(0)," kWh"]}),e.jsx("td",{className:"py-2 px-3 text-right",children:k.historische_performance_ratio!==null?e.jsxs("span",{className:k.historische_performance_ratio>1?"text-green-600":k.historische_performance_ratio<.9?"text-red-600":"text-gray-600",children:[(k.historische_performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},`${k.jahr}-${k.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right text-gray-500",children:[r.monatswerte.reduce((k,v)=>k+v.pvgis_prognose_kwh,0).toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahresprognose_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{colSpan:3})]})})]})})]}),e.jsx(S,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]}),e.jsxs("span",{children:["Spez. Ertrag: ",(r.jahresprognose_kwh/r.anlagenleistung_kwp).toFixed(0)," kWh/kWp"]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function In({anlageId:t}){const[r,s]=c.useState(null),[n,a]=c.useState(!0),[i,b]=c.useState(null),[g,l]=c.useState(3);c.useEffect(()=>{h()},[t,g]);async function h(){a(!0),b(null);try{const k=await kr.getTrendAnalyse(t,g);s(k)}catch(k){b(k.message||"Fehler beim Laden der Trend-Analyse")}finally{a(!1)}}if(n)return e.jsx(xe,{text:"Lade Trend-Analyse..."});if(i)return e.jsx(re,{type:"error",children:i});if(!r)return e.jsx(re,{type:"warning",children:"Keine Trend-Daten verfügbar"});if(!r.jahres_vergleich.some(k=>k.gesamt_kwh>0))return e.jsx("div",{className:"space-y-6",children:e.jsxs(S,{className:"p-8 text-center",children:[e.jsx(Ie,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Noch keine historischen Daten"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Für eine Trend-Analyse werden mindestens Daten aus einem Jahr benötigt.",e.jsx("br",{}),"Erfasse Monatsdaten, um Trends zu analysieren."]})]})});const y=r.jahres_vergleich.map(k=>({jahr:k.jahr.toString(),kwh:k.gesamt_kwh,spez_ertrag:k.spezifischer_ertrag_kwh_kwp,pr:k.performance_ratio?k.performance_ratio*100:null})),u=r.jahres_vergleich.filter(k=>k.gesamt_kwh>0),m=u.length>0?u.reduce((k,v)=>v.gesamt_kwh>k.gesamt_kwh?v:k,u[0]):null,p=r.degradation.geschaetzt_prozent_jahr;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[m&&e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(xa,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bestes Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:m.jahr}),e.jsxs("p",{className:"text-sm text-green-600",children:[m.gesamt_kwh.toLocaleString("de-DE")," kWh"]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(ht,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Analysezeitraum"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.analyse_zeitraum.von," - ",r.analyse_zeitraum.bis]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p!==null?p>0?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(be,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):p<-1?e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(jt,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Ir,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}):e.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:e.jsx(Ir,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Degradation/Jahr"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:p!==null?e.jsxs("span",{className:p>0?"text-green-600":p<-1?"text-red-600":"",children:[p>0?"+":"",p.toFixed(1),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx(me,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagenleistung"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})]})})]}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Jahresvergleich"}),e.jsxs("select",{value:g,onChange:k=>l(Number(k.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:2,children:"2 Jahre"}),e.jsx("option",{value:3,children:"3 Jahre"}),e.jsx("option",{value:5,children:"5 Jahre"}),e.jsx("option",{value:10,children:"10 Jahre"})]})]})}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahreserträge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:y,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(se,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",label:{value:"kWh",angle:-90,position:"insideLeft"}}),e.jsx(Y,{contentStyle:{backgroundColor:"var(--tooltip-bg, white)",borderColor:"var(--tooltip-border, #e5e7eb)"},formatter:k=>[`${k.toLocaleString("de-DE")} kWh`,"Ertrag"]}),e.jsx(pe,{}),e.jsx(G,{dataKey:"kwh",name:"Jahresertrag",radius:[4,4,0,0],children:y.map((k,v)=>e.jsx(We,{fill:k.kwh===(m==null?void 0:m.gesamt_kwh)?"#10b981":"#eab308"},`cell-${v}`))})]})})})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Spezifischer Ertrag (kWh/kWp)"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(tr,{data:y,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"jahr",tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400"}),e.jsx(se,{tick:{fontSize:12},className:"text-gray-600 dark:text-gray-400",domain:["auto","auto"]}),e.jsx(Y,{formatter:k=>[`${k.toFixed(0)} kWh/kWp`,"Spez. Ertrag"]}),e.jsx(pe,{}),e.jsx(Ae,{type:"monotone",dataKey:"spez_ertrag",name:"Spez. Ertrag",stroke:"#3b82f6",strokeWidth:2,dot:{r:5}})]})})})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Saisonale Muster"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Beste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.beste_monate.map((k,v)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${v===0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-500"}`,children:k},k))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Schwächste Monate"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.saisonale_muster.schlechteste_monate.map((k,v)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${v===0?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400":"bg-orange-50 text-orange-700 dark:bg-orange-900/20 dark:text-orange-500"}`,children:k},k))})]})]})]}),e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Degradation"}),r.degradation.methode&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.degradation.methode==="vollstaendig"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"}`,children:r.degradation.methode==="vollstaendig"?"Vollständige Jahre":"TMY-ergänzt"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:p!==null?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:p>0?e.jsxs("span",{className:"text-green-600",children:["+",p.toFixed(2),"% pro Jahr"]}):p<-1?e.jsxs("span",{className:"text-red-600",children:[p.toFixed(2),"% pro Jahr"]}):e.jsxs("span",{className:"text-gray-600",children:[p.toFixed(2),"% pro Jahr"]})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.degradation.hinweis}),r.degradation.methode==="tmy_ergaenzt"&&e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:"Unvollständige Jahre wurden mit PVGIS TMY-Prognosewerten ergänzt."}),p<-1&&e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400 mt-2",children:"Eine Degradation von mehr als 1% pro Jahr kann auf Probleme hinweisen. Typische Modul-Degradation liegt bei 0.3-0.5% pro Jahr."})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r.degradation.hinweis})})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Jahresübersicht"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Jahr"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Monate"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Spez. Ertrag"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Performance-Ratio"})]})}),e.jsx("tbody",{children:r.jahres_vergleich.map(k=>e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${k.gesamt_kwh===(m==null?void 0:m.gesamt_kwh)&&k.ist_vollstaendig?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[k.jahr,!k.ist_vollstaendig&&k.anzahl_monate>0&&e.jsx("span",{className:"ml-1 text-xs text-orange-500",title:"Unvollständiges Jahr",children:"*"})]}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:k.ist_vollstaendig?"text-green-600":"text-orange-500",children:[k.anzahl_monate,"/12"]})}),e.jsx("td",{className:"py-2 px-3 text-right",children:k.gesamt_kwh>0?e.jsxs("span",{className:"font-semibold text-yellow-600",children:[k.gesamt_kwh.toLocaleString("de-DE")," kWh"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:k.spezifischer_ertrag_kwh_kwp>0?`${k.spezifischer_ertrag_kwh_kwp.toFixed(0)} kWh/kWp`:e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2 px-3 text-right",children:k.performance_ratio!==null?e.jsxs("span",{className:k.performance_ratio>1?"text-green-600":k.performance_ratio<.9?"text-red-600":"text-gray-600",children:[(k.performance_ratio*100).toFixed(0),"%"]}):e.jsx("span",{className:"text-gray-400",children:"-"})})]},k.jahr))})]})})]}),e.jsx(S,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Anlagenleistung: ",r.anlagenleistung_kwp.toFixed(1)," kWp"]})]})})]})}const Pn=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ec4899"],Vn={speicher:je,"e-auto-v2h":Ne,"e-auto-ladung":Ne,waermepumpe:Se};function Kn({anlageId:t}){const[r,s]=c.useState(null),[n,a]=c.useState(!0),[i,b]=c.useState(null),[g,l]=c.useState(12);c.useEffect(()=>{h()},[t,g]);async function h(){a(!0),b(null);try{const m=await kr.getFinanzPrognose(t,g);s(m)}catch(m){b(m.message||"Fehler beim Laden der Finanzprognose")}finally{a(!1)}}if(n)return e.jsx(xe,{text:"Lade Finanzprognose..."});if(i)return e.jsx(re,{type:"error",children:i});if(!r)return e.jsx(re,{type:"warning",children:"Keine Prognose verfügbar"});const d=r.monatswerte.map(m=>({name:`${m.monat_name.substring(0,3)} ${m.jahr}`,einspeise_erloes:m.einspeise_erloes_euro,ev_ersparnis:m.ev_ersparnis_euro,netto_ertrag:m.netto_ertrag_euro})),y=[{name:"EV-Ersparnis",value:r.jahres_ev_ersparnis_euro},{name:"Einspeise-Erlös",value:r.jahres_einspeise_erloes_euro}],u=Math.min(r.amortisations_fortschritt_prozent,100);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(Xe,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jahres-Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," €"]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(be,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.amortisations_fortschritt_prozent.toFixed(1),"%"]})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[r.amortisation_erreicht?e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(et,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(As,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Amortisation"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:r.amortisation_erreicht?e.jsx("span",{className:"text-green-600",children:"Erreicht"}):r.amortisation_prognose_jahr?e.jsx("span",{children:r.amortisation_prognose_jahr}):e.jsx("span",{className:"text-gray-400",children:"-"})})]})]})}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(zt,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Bisherige Erträge"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE",{minimumFractionDigits:0,maximumFractionDigits:0})," €"]})]})]})})]}),e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Amortisations-Fortschritt"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," € von ",r.investition_gesamt_euro.toLocaleString("de-DE")," €"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all ${r.amortisation_erreicht?"bg-green-500":u>75?"bg-blue-500":u>50?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${u}%`}})}),!r.amortisation_erreicht&&r.restlaufzeit_bis_amortisation_monate&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Noch ca. ",r.restlaufzeit_bis_amortisation_monate," Monate bis zur Amortisation (voraussichtlich ",r.amortisation_prognose_jahr,")"]})]}),e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Monatliche Ertrags-Prognose"}),e.jsxs("select",{value:g,onChange:m=>l(Number(m.target.value)),className:"input w-auto text-sm",children:[e.jsx("option",{value:6,children:"6 Monate"}),e.jsx("option",{value:12,children:"12 Monate"}),e.jsx("option",{value:24,children:"24 Monate"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(S,{className:"p-4 lg:col-span-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatliche Erträge"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(He,{data:d,children:[e.jsx(le,{strokeDasharray:"3 3",className:"stroke-gray-200 dark:stroke-gray-700"}),e.jsx(de,{dataKey:"name",tick:{fontSize:11},angle:-45,textAnchor:"end",height:60}),e.jsx(se,{tick:{fontSize:12},label:{value:"€",angle:-90,position:"insideLeft"}}),e.jsx(Y,{formatter:(m,p)=>{const k={einspeise_erloes:"Einspeise-Erlös",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"};return[`${m.toFixed(2)} €`,k[p]||p]}}),e.jsx(pe,{formatter:m=>({einspeise_erloes:"Einspeise-Erlös",ev_ersparnis:"EV-Ersparnis",netto_ertrag:"Netto-Ertrag"})[m]||m}),e.jsx(G,{dataKey:"einspeise_erloes",stackId:"a",fill:"#3b82f6",name:"einspeise_erloes"}),e.jsx(G,{dataKey:"ev_ersparnis",stackId:"a",fill:"#10b981",name:"ev_ersparnis"}),e.jsx(Ae,{type:"monotone",dataKey:"netto_ertrag",stroke:"#f59e0b",strokeWidth:2,dot:{r:3},name:"netto_ertrag"})]})})})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Ertrags-Zusammensetzung"}),e.jsx("div",{className:"h-[250px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(it,{children:[e.jsx(lt,{data:y,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",label:({percent:m})=>`${(m*100).toFixed(0)}%`,children:y.map((m,p)=>e.jsx(We,{fill:Pn[p]},`cell-${p}`))}),e.jsx(Y,{formatter:m=>`${m.toFixed(2)} €`}),e.jsx(pe,{})]})})}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"EV-Quote:"}),e.jsxs("span",{className:"font-medium",children:[r.eigenverbrauchsquote_prozent.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Eigenverbrauch:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Einspeisung:"}),e.jsxs("span",{className:"font-medium",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]})]})]})]})]}),r.komponenten_beitraege&&r.komponenten_beitraege.length>0&&e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Komponenten-Beiträge zur Finanzierung"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.komponenten_beitraege.map((m,p)=>{const k=Vn[m.typ]||je;return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(k,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:m.bezeichnung}),e.jsx("p",{className:"text-xs text-gray-500",children:m.beschreibung})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:[m.beitrag_kwh_jahr.toLocaleString("de-DE")," kWh/Jahr"]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["+",m.beitrag_euro_jahr.toFixed(0)," €/Jahr"]})]})]},p)})}),(r.speicher_ev_erhoehung_kwh>0||r.v2h_rueckspeisung_kwh>0||r.wp_pv_anteil_kwh>0)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.speicher_ev_erhoehung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Speicher EV+"}),e.jsxs("p",{className:"font-semibold",children:[r.speicher_ev_erhoehung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.speicher_ev_erhoehung_euro.toFixed(0)," €"]})]}),r.v2h_rueckspeisung_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"V2H-Rückspeisung"}),e.jsxs("p",{className:"font-semibold",children:[r.v2h_rueckspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.v2h_ersparnis_euro.toFixed(0)," €"]})]}),r.eauto_ladung_pv_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"E-Auto PV-Ladung"}),e.jsxs("p",{className:"font-semibold",children:[r.eauto_ladung_pv_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.eauto_ersparnis_euro.toFixed(0)," €"]})]}),r.wp_pv_anteil_kwh>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"WP PV-Direkt"}),e.jsxs("p",{className:"font-semibold",children:[r.wp_pv_anteil_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("p",{className:"text-green-600",children:["+",r.wp_pv_ersparnis_euro.toFixed(0)," €"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Strompreise"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Einspeisevergütung"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Netzbezugspreis"}),e.jsxs("span",{className:"font-semibold text-orange-600",children:[r.netzbezug_preis_cent_kwh.toFixed(2)," ct/kWh"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ersparnis durch EV"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[(r.netzbezug_preis_cent_kwh-r.einspeiseverguetung_cent_kwh).toFixed(2)," ct/kWh"]})]})]})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Investition & ROI"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Investition gesamt"}),e.jsxs("span",{className:"font-semibold",children:[r.investition_gesamt_euro.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Bisherige Erträge"}),e.jsxs("span",{className:"font-semibold text-green-600",children:[r.bisherige_ertraege_euro.toLocaleString("de-DE")," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Prognose Jahres-Ertrag"}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[r.jahres_netto_ertrag_euro.toLocaleString("de-DE")," €/Jahr"]})]})]})]})]}),e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Monatswerte"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Monat"}),e.jsx("th",{className:"text-right py-2 px-3",children:"PV-Erzeugung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Eigenverbrauch"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeisung"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Einspeise-Erlös"}),e.jsx("th",{className:"text-right py-2 px-3",children:"EV-Ersparnis"}),e.jsx("th",{className:"text-right py-2 px-3 font-semibold",children:"Netto-Ertrag"})]})}),e.jsx("tbody",{children:r.monatswerte.map(m=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 px-3 font-medium",children:[m.monat_name," ",m.jahr]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[m.pv_erzeugung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[m.eigenverbrauch_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[m.einspeisung_kwh.toFixed(0)," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[m.einspeise_erloes_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[m.ev_ersparnis_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-semibold text-yellow-600",children:[m.netto_ertrag_euro.toFixed(2)," €"]})]},`${m.jahr}-${m.monat}`))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 font-semibold",children:[e.jsx("td",{className:"py-2 px-3",children:"Gesamt"}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_erzeugung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_eigenverbrauch_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right",children:[r.jahres_einspeisung_kwh.toLocaleString("de-DE")," kWh"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-blue-600",children:[r.jahres_einspeise_erloes_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-green-600",children:[r.jahres_ev_ersparnis_euro.toFixed(2)," €"]}),e.jsxs("td",{className:"py-2 px-3 text-right text-yellow-600",children:[r.jahres_netto_ertrag_euro.toFixed(2)," €"]})]})})]})})]}),e.jsx(S,{className:"p-4 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Datenquellen: ",r.datenquellen.join(", ")]}),e.jsxs("span",{children:["Zeitraum: ",r.prognose_zeitraum.von," bis ",r.prognose_zeitraum.bis]})]})})]})}function Bn(){var y;const t=er(),[r,s]=c.useState("kurzfristig"),{anlagen:n,loading:a}=Ce(),[i,b]=c.useState(null),g=i??((y=n[0])==null?void 0:y.id);if(a)return e.jsx(xe,{text:"Lade Aussichten..."});if(n.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx(re,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an."})]});const l=n.find(u=>u.id===g);if(!((l==null?void 0:l.latitude)&&(l==null?void 0:l.longitude)))return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsxs(S,{className:"text-center py-12",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto text-yellow-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Standort nicht konfiguriert"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["Für Prognosen werden die Koordinaten der Anlage benötigt.",e.jsx("br",{}),"Bitte konfiguriere den Standort in den Anlagen-Einstellungen."]}),e.jsxs(X,{onClick:()=>t("/einstellungen/anlage"),children:["Anlage konfigurieren",e.jsx($e,{className:"h-4 w-4 ml-2"})]})]})]});const d=[{key:"kurzfristig",label:"Kurzfristig",icon:ee},{key:"langfristig",label:"Langfristig",icon:ht},{key:"trend",label:"Trend",icon:be},{key:"finanzen",label:"Finanzen",icon:Xe}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky -top-6 z-10 bg-gray-50 dark:bg-gray-900 pb-4 -mx-6 px-6 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Aussichten"}),e.jsx("div",{className:"flex items-center gap-3",children:n.length>1&&e.jsx("select",{value:g??"",onChange:u=>b(Number(u.target.value)),className:"input w-auto",children:n.map(u=>e.jsx("option",{value:u.id,children:u.anlagenname},u.id))})})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex gap-4",children:d.map(u=>{const m=u.icon;return e.jsxs("button",{onClick:()=>s(u.key),className:`py-3 px-1 border-b-2 text-sm font-medium transition-colors flex items-center gap-2 ${r===u.key?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(m,{className:"h-4 w-4"}),u.label]},u.key)})})})]}),g&&e.jsxs(e.Fragment,{children:[r==="kurzfristig"&&e.jsx(Ln,{anlageId:g}),r==="langfristig"&&e.jsx(Dn,{anlageId:g}),r==="trend"&&e.jsx(In,{anlageId:g}),r==="finanzen"&&e.jsx(Kn,{anlageId:g})]})]})}const On=[{key:"strom",label:"Strom",icon:"⚡"},{key:"gas",label:"Gas",icon:"🔥"},{key:"wasser",label:"Wasser",icon:"💧"}],Ht=()=>({name:"",kundennummer:"",portal_url:"",notizen:"",zaehler:[]}),Tn=()=>({bezeichnung:"",nummer:"",notizen:""});function Rn({value:t,onChange:r}){const[s,n]=c.useState({}),a=u=>{n(m=>({...m,[u]:!m[u]}))},i=(u,m)=>{const p={...t};m?p[u]=m:delete p[u],r(p)},b=u=>{i(u,Ht()),n(m=>({...m,[u]:!0}))},g=u=>{i(u,void 0)},l=(u,m,p)=>{const k=t[u]||Ht();i(u,{...k,[m]:p})},h=u=>{const m=t[u]||Ht();i(u,{...m,zaehler:[...m.zaehler,Tn()]})},d=(u,m,p)=>{const k=t[u]||Ht(),v=[...k.zaehler];v[m]=p,i(u,{...k,zaehler:v})},y=(u,m)=>{const p=t[u]||Ht(),k=p.zaehler.filter((v,j)=>j!==m);i(u,{...p,zaehler:k})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Versorger & Zähler"}),e.jsx("div",{className:"space-y-3",children:On.map(({key:u,label:m,icon:p})=>{const k=t[u],v=s[u];return k?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer",onClick:()=>a(u),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v?e.jsx(gt,{className:"w-4 h-4 text-gray-500"}):e.jsx(yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-lg",children:p}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:k.name||m}),k.zaehler.length>0&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",k.zaehler.length," Zähler)"]})]}),e.jsx("button",{type:"button",onClick:j=>{j.stopPropagation(),g(u)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Versorger entfernen",children:e.jsx(nt,{className:"w-4 h-4"})})]}),v&&e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Versorger-Name",value:k.name,onChange:j=>l(u,"name",j.target.value),placeholder:`z.B. Stadtwerke ${m}`}),e.jsx(M,{label:"Kundennummer",value:k.kundennummer,onChange:j=>l(u,"kundennummer",j.target.value),placeholder:"z.B. 12345678"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(M,{label:"Kundenportal-URL",value:k.portal_url||"",onChange:j=>l(u,"portal_url",j.target.value),placeholder:"https://kundenportal.beispiel.de"}),k.portal_url&&e.jsxs("a",{href:k.portal_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qt,{className:"w-3 h-3"}),"Portal öffnen"]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(M,{label:"Notizen",value:k.notizen||"",onChange:j=>l(u,"notizen",j.target.value),placeholder:"Optionale Anmerkungen..."})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Zähler"}),e.jsxs(X,{type:"button",variant:"ghost",size:"sm",onClick:()=>h(u),children:[e.jsx(xt,{className:"w-4 h-4 mr-1"}),"Zähler"]})]}),k.zaehler.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"Noch keine Zähler erfasst"}):e.jsx("div",{className:"space-y-2",children:k.zaehler.map((j,_)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(M,{label:"Bezeichnung",value:j.bezeichnung,onChange:w=>d(u,_,{...j,bezeichnung:w.target.value}),placeholder:u==="strom"?"z.B. Einspeisung":"z.B. Hauptzähler"}),e.jsx(M,{label:"Zählernummer",value:j.nummer,onChange:w=>d(u,_,{...j,nummer:w.target.value}),placeholder:"z.B. 1EMH0012345678"}),e.jsx(M,{label:"Notizen",value:j.notizen||"",onChange:w=>d(u,_,{...j,notizen:w.target.value}),placeholder:"Optional..."})]}),e.jsx("button",{type:"button",onClick:()=>y(u,_),className:"p-2 text-gray-400 hover:text-red-500 transition-colors mt-6",title:"Zähler entfernen",children:e.jsx(nt,{className:"w-4 h-4"})})]},_))})]})]})]},u):e.jsxs("button",{type:"button",onClick:()=>b(u),className:"w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-500 dark:text-gray-400 hover:border-blue-400 hover:text-blue-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4"}),e.jsxs("span",{children:[p," ",m,"-Versorger hinzufügen"]})]},u)})})]})}function bs({anlage:t,onSubmit:r,onCancel:s}){var m,p,k;const[n,a]=c.useState(!1),[i,b]=c.useState(null),[g,l]=c.useState({anlagenname:(t==null?void 0:t.anlagenname)||"",leistung_kwp:((m=t==null?void 0:t.leistung_kwp)==null?void 0:m.toString())||"",installationsdatum:(t==null?void 0:t.installationsdatum)||"",standort_plz:(t==null?void 0:t.standort_plz)||"",standort_ort:(t==null?void 0:t.standort_ort)||"",standort_strasse:(t==null?void 0:t.standort_strasse)||"",latitude:((p=t==null?void 0:t.latitude)==null?void 0:p.toString())||"",longitude:((k=t==null?void 0:t.longitude)==null?void 0:k.toString())||"",mastr_id:(t==null?void 0:t.mastr_id)||""}),[h,d]=c.useState((t==null?void 0:t.versorger_daten)||{}),y=v=>{const{name:j,value:_}=v.target;l(w=>({...w,[j]:_}))},u=async v=>{if(v.preventDefault(),b(null),!g.anlagenname.trim()){b("Bitte einen Namen eingeben");return}if(!g.leistung_kwp||parseFloat(g.leistung_kwp)<=0){b("Bitte eine gültige Leistung eingeben");return}try{a(!0),await r({anlagenname:g.anlagenname.trim(),leistung_kwp:parseFloat(g.leistung_kwp),installationsdatum:g.installationsdatum||void 0,standort_plz:g.standort_plz||void 0,standort_ort:g.standort_ort||void 0,standort_strasse:g.standort_strasse||void 0,latitude:g.latitude?parseFloat(g.latitude):void 0,longitude:g.longitude?parseFloat(g.longitude):void 0,mastr_id:g.mastr_id||void 0,versorger_daten:Object.keys(h).length>0?h:void 0})}catch(j){b(j instanceof Error?j.message:"Fehler beim Speichern")}finally{a(!1)}};return e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[i&&e.jsx(re,{type:"error",children:i}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Basis-Daten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Anlagenname",name:"anlagenname",value:g.anlagenname,onChange:y,placeholder:"z.B. Meine PV-Anlage",required:!0}),e.jsx(M,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.01",min:"0.1",value:g.leistung_kwp,onChange:y,placeholder:"z.B. 10.5",required:!0}),e.jsx(M,{label:"Installationsdatum",name:"installationsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:g.installationsdatum,onChange:y})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ausrichtung & Neigung"}),e.jsxs("p",{children:["Diese Werte werden pro ",e.jsx("strong",{children:"PV-Modul"})," unter ",e.jsx("strong",{children:"Einstellungen → Investitionen"})," gepflegt. So können auch Anlagen mit mehreren Dachflächen korrekt abgebildet werden."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(M,{label:"PLZ",name:"standort_plz",value:g.standort_plz,onChange:y,placeholder:"z.B. 12345"}),e.jsx(M,{label:"Ort",name:"standort_ort",value:g.standort_ort,onChange:y,placeholder:"z.B. Berlin"}),e.jsx(M,{label:"Straße",name:"standort_strasse",value:g.standort_strasse,onChange:y,placeholder:"z.B. Musterstraße 1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Geokoordinaten",e.jsx("span",{className:"text-xs font-normal text-gray-500 ml-2",children:"(für PVGIS-Prognose)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Breitengrad (Latitude)",name:"latitude",type:"number",step:"0.000001",value:g.latitude,onChange:y,placeholder:"z.B. 52.520008",hint:"Nördliche Breite (positiv)"}),e.jsx(M,{label:"Längengrad (Longitude)",name:"longitude",type:"number",step:"0.000001",value:g.longitude,onChange:y,placeholder:"z.B. 13.404954",hint:"Östliche Länge (positiv)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Erweiterte Stammdaten"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(M,{label:"MaStR-ID",name:"mastr_id",value:g.mastr_id,onChange:y,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID der Anlage"}),g.mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${g.mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qt,{className:"w-3 h-3"}),"Im MaStR öffnen"]})]})})]}),e.jsx(Rn,{value:h,onChange:d}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:s,children:"Abbrechen"}),e.jsx(X,{type:"submit",loading:n,children:t?"Speichern":"Anlage erstellen"})]})]})}const Hn={ev:Ne,wallbox:Vr,battery:me,inverter:ee},Gn={evcc:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",sma:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",smart:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",wallbox:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"};function Jn({device:t,selected:r,onToggle:s}){const n=Hn[t.device_type]||Ps,a=Gn[t.integration]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",i=!t.already_configured&&t.suggested_investition_typ;return e.jsxs("div",{className:`
        relative p-4 rounded-lg border-2 transition-all cursor-pointer
        ${r?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}
        ${t.already_configured?"opacity-60":""}
        ${i?"":"cursor-not-allowed"}
      `,onClick:()=>i&&s(),children:[i&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`
              w-5 h-5 rounded border-2 flex items-center justify-center
              ${r?"bg-amber-500 border-amber-500":"border-gray-300 dark:border-gray-600"}
            `,children:r&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),t.already_configured&&e.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Konfiguriert"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
          p-2 rounded-lg
          ${r?"bg-amber-100 dark:bg-amber-800/30":"bg-gray-100 dark:bg-gray-700"}
        `,children:e.jsx(n,{className:`w-6 h-6 ${r?"text-amber-600":"text-gray-600 dark:text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${a}`,children:t.integration.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.device_type==="ev"?"E-Auto":t.device_type==="wallbox"?"Wallbox":t.device_type==="battery"?"Speicher":t.device_type==="inverter"?"Wechselrichter":t.device_type}),t.confidence>=80&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:[t.confidence,"% Konfidenz"]})]}),(t.manufacturer||t.model)&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[t.manufacturer,t.model].filter(Boolean).join(" ")}),t.sensors.length>0&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:[t.sensors.length," Sensor",t.sensors.length!==1?"en":""," gefunden"]})]})]}),i&&Object.keys(t.suggested_parameters).length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Wird erstellt als:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.suggested_parameters.bezeichnung||t.name})]})]})}function Gt({label:t,icon:r,suggestions:s,allSensors:n,showAll:a,value:i,onChange:b}){const g=a?n:s,l=g.length>0,h=s.length>0&&s[0].confidence>=70;return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50",children:[e.jsx("div",{className:"p-2 rounded-lg bg-white dark:bg-gray-700 shadow-sm",children:e.jsx(r,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),e.jsxs("select",{value:i||"",onChange:d=>b(d.target.value||null),className:`
            w-full px-3 py-2 text-sm rounded-lg border
            bg-white dark:bg-gray-800
            border-gray-300 dark:border-gray-600
            text-gray-900 dark:text-white
            focus:ring-2 focus:ring-amber-500 focus:border-amber-500
            ${l?"":"opacity-50"}
          `,disabled:!l,children:[e.jsx("option",{value:"",children:l?"-- Nicht zugeordnet --":"-- Kein Sensor gefunden --"}),g.map(d=>e.jsxs("option",{value:d.entity_id,children:[d.friendly_name||d.entity_id,d.confidence>=80&&" ★"]},d.entity_id))]}),!a&&h&&!i&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:["Empfehlung: ",s[0].friendly_name||s[0].entity_id]}),i&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:i})]})]})}function qn({suggestions:t,allEnergySensors:r,selectedMappings:s,onMappingChange:n,onApplyBest:a}){const[i,b]=c.useState(!1),g=t.pv_erzeugung.length+t.einspeisung.length+t.netzbezug.length+t.batterie_ladung.length+t.batterie_entladung.length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Sensor-Zuordnungen"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Für Monatsdaten-Import aus Home Assistant"})]}),e.jsx("div",{className:"flex items-center gap-2",children:g>0&&!i&&e.jsx("button",{onClick:a,className:"text-xs px-3 py-1.5 rounded-lg bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:hover:bg-amber-900/50 transition-colors",children:"Beste übernehmen"})})]}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1",children:[e.jsxs("button",{onClick:()=>b(!1),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${i?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm"}`,children:["Empfohlen (",g,")"]}),e.jsxs("button",{onClick:()=>b(!0),className:`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-colors ${i?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Alle (",r.length,")"]})]}),i&&e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg",children:"Zeigt alle Energy-Sensoren (kWh, total_increasing) für manuelle Zuordnung."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Gt,{label:"PV-Erzeugung",icon:ee,field:"pv_erzeugung",suggestions:t.pv_erzeugung,allSensors:r,showAll:i,value:s.pv_erzeugung,onChange:l=>n("pv_erzeugung",l)}),e.jsx(Gt,{label:"Einspeisung",icon:xr,field:"einspeisung",suggestions:t.einspeisung,allSensors:r,showAll:i,value:s.einspeisung,onChange:l=>n("einspeisung",l)}),e.jsx(Gt,{label:"Netzbezug",icon:Mr,field:"netzbezug",suggestions:t.netzbezug,allSensors:r,showAll:i,value:s.netzbezug,onChange:l=>n("netzbezug",l)}),e.jsx(Gt,{label:"Batterie Ladung",icon:Vr,field:"batterie_ladung",suggestions:t.batterie_ladung,allSensors:r,showAll:i,value:s.batterie_ladung,onChange:l=>n("batterie_ladung",l)}),e.jsx(Gt,{label:"Batterie Entladung",icon:je,field:"batterie_entladung",suggestions:t.batterie_entladung,allSensors:r,showAll:i,value:s.batterie_entladung,onChange:l=>n("batterie_entladung",l)})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 italic",children:"Hinweis: Sensor-Zuordnungen werden in der Add-on-Konfiguration gespeichert. Änderungen hier dienen nur zur Vorschau."})]})}const Zn={ev:Ne,wallbox:Vr,battery:me,inverter:ee},Un={"e-auto":"E-Auto",wallbox:"Wallbox",speicher:"Speicher",wechselrichter:"Wechselrichter"};function Yn({devicesToCreate:t,onConfirm:r,onBack:s,loading:n=!1}){return t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Me,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Geräte ausgewählt"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Bitte wähle mindestens ein Gerät aus, das als Investition angelegt werden soll."}),e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Zurück zur Auswahl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Zusammenfassung"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Folgende ",t.length," Investition",t.length!==1?"en":""," werden erstellt:"]})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:t.map(a=>{const i=Zn[a.device_type]||Ps,b=a.suggested_investition_typ?Un[a.suggested_investition_typ]||a.suggested_investition_typ:"Unbekannt";return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(i,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.suggested_parameters.bezeichnung||a.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:b}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700",children:a.integration.toUpperCase()})]})]})]},a.id)})}),e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{children:"Die Investitionen werden mit Standardwerten erstellt."}),e.jsx("p",{className:"mt-1",children:'Du kannst die Details später unter "Investitionen" anpassen.'})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:s,disabled:n,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:"Zurück"}),e.jsx("button",{onClick:r,disabled:n,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Erstelle..."})]}):e.jsx("span",{children:"Investitionen erstellen"})})]})]})}function Zs({isOpen:t,onClose:r,anlageId:s,onInvestitionenCreated:n}){const{step:a,discoveryResult:i,selectedDevices:b,selectedMappings:g,error:l,startDiscovery:h,toggleDevice:d,selectAllDevices:y,deselectAllDevices:u,setMapping:m,applyBestMappings:p,goToStep:k,reset:v,devicesToCreate:j}=Za();c.useEffect(()=>{t&&a==="idle"&&h(s)},[t,a,s,h]);const _=()=>{v(),r()},w=async()=>{k("creating");try{for(const x of j){const o={anlage_id:s,typ:x.suggested_investition_typ,bezeichnung:x.suggested_parameters.bezeichnung||x.name,hersteller:x.suggested_parameters.hersteller||x.manufacturer||void 0,kaufdatum:new Date().toISOString().split("T")[0],kaufpreis:0,aktiv:!0};x.suggested_investition_typ==="e-auto"&&(o.batterie_kwh=x.suggested_parameters.batterie_kwh||void 0),await Ee.create(o)}k("done"),n==null||n()}catch{k("error")}},f=()=>{switch(a){case"scanning":return"Home Assistant durchsuchen...";case"results":return"Gefundene Geräte";case"confirmation":return"Bestätigung";case"creating":return"Erstelle Investitionen...";case"done":return"Fertig!";case"error":return"Fehler";default:return"Auto-Discovery"}};return e.jsxs(Ze,{isOpen:t,onClose:_,title:f(),size:"lg",children:[a==="scanning"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(bt,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten..."})]}),a==="error"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Xt,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Verbindung fehlgeschlagen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:l||"Keine Verbindung zu Home Assistant möglich."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Schließen"}),e.jsx("button",{onClick:()=>h(s),className:"px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Erneut versuchen"})]})]}),a==="results"&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:i.ha_connected?e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Xt,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Nicht verbunden"})]})}),i.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:i.warnings.map((x,o)=>e.jsx("p",{children:x},o))})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["Gefundene Geräte (",i.devices.length,")"]}),i.devices.filter(x=>!x.already_configured&&x.suggested_investition_typ).length>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Keine"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:y,className:"text-xs text-amber-600 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",children:"Alle"})]})]}),i.devices.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Unterstützt: SMA, evcc, Smart, Wallbox"})]}):e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:i.devices.map(x=>e.jsx(Jn,{device:x,selected:b.has(x.id),onToggle:()=>d(x.id)},x.id))})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsx(qn,{suggestions:i.sensor_mappings,allEnergySensors:i.all_energy_sensors,selectedMappings:g,onMappingChange:m,onApplyBest:p})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Abbrechen"}),e.jsxs("button",{onClick:()=>k("confirmation"),disabled:b.size===0,className:"flex-1 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter (",b.size," ausgewählt)"]})]})]}),a==="confirmation"&&e.jsx(Yn,{devicesToCreate:j,onConfirm:w,onBack:()=>k("results")}),a==="creating"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 mb-6",children:e.jsxs("svg",{className:"animate-spin w-16 h-16 text-amber-500",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Erstelle ",j.length," Investition",j.length!==1?"en":"","..."]})]}),a==="done"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(Je,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Erfolgreich erstellt!"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:[j.length," Investition",j.length!==1?"en wurden":" wurde"," angelegt."]}),e.jsx("button",{onClick:_,className:"px-6 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors",children:"Fertig"})]})]})}function Qn(){const{anlagen:t,loading:r,error:s,createAnlage:n,updateAnlage:a,deleteAnlage:i}=Ce(),[b,g]=c.useState(!1),[l,h]=c.useState(null),[d,y]=c.useState(null),[u,m]=c.useState(null),p=async j=>{const _=await n(j);g(!1),m(_.id)},k=async j=>{l&&(await a(l.id,j),h(null))},v=async()=>{d&&(await i(d.id),y(null))};return r?e.jsx(xe,{text:"Lade Anlagen..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Anlagen"}),e.jsxs(X,{onClick:()=>g(!0),children:[e.jsx(xt,{className:"h-5 w-5 mr-2"}),"Neue Anlage"]})]}),s&&e.jsx(re,{type:"error",children:s}),t.length===0?e.jsx(S,{children:e.jsx(Ct,{icon:ee,title:"Keine Anlagen vorhanden",description:"Lege deine erste PV-Anlage an, um mit der Datenerfassung zu beginnen.",action:e.jsx(X,{onClick:()=>g(!0),children:"Erste Anlage anlegen"})})}):e.jsx(S,{padding:"none",children:e.jsxs(Tr,{children:[e.jsx(Rr,{children:e.jsxs(Mt,{children:[e.jsx(Pe,{children:"Name"}),e.jsx(Pe,{children:"Leistung"}),e.jsx(Pe,{children:"Standort"}),e.jsx(Pe,{children:"Ausrichtung"}),e.jsx(Pe,{children:"Installation"}),e.jsx(Pe,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Hr,{children:t.map(j=>e.jsxs(Mt,{children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-energy-solar"}),e.jsx("span",{className:"font-medium",children:j.anlagenname})]})}),e.jsxs(Ve,{children:[e.jsx("span",{className:"font-mono",children:j.leistung_kwp})," kWp"]}),e.jsx(Ve,{children:j.standort_ort?e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(pr,{className:"h-4 w-4"}),j.standort_plz," ",j.standort_ort]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsxs(Ve,{children:[j.ausrichtung||e.jsx("span",{className:"text-gray-400",children:"-"}),j.neigung_grad&&` / ${j.neigung_grad}°`]}),e.jsx(Ve,{children:j.installationsdatum?new Date(j.installationsdatum).toLocaleDateString("de-DE"):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(Ve,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>m(j.id),title:"HA-Geräte erkennen",children:e.jsx(bt,{className:"h-4 w-4 text-amber-500"})}),e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>{window.location.href=pt.getFullExportUrl(j.id)},title:"Export (JSON)",children:e.jsx(Ye,{className:"h-4 w-4 text-blue-500"})}),e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>h(j),children:e.jsx(Br,{className:"h-4 w-4"})}),e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>y(j),children:e.jsx(nt,{className:"h-4 w-4 text-red-500"})})]})})]},j.id))})]})}),e.jsx(Ze,{isOpen:b,onClose:()=>g(!1),title:"Neue Anlage erstellen",size:"lg",children:e.jsx(bs,{onSubmit:p,onCancel:()=>g(!1)})}),e.jsx(Ze,{isOpen:!!l,onClose:()=>h(null),title:"Anlage bearbeiten",size:"lg",children:l&&e.jsx(bs,{anlage:l,onSubmit:k,onCancel:()=>h(null)})}),e.jsx(Ze,{isOpen:!!d,onClose:()=>y(null),title:"Anlage löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Anlage ",e.jsxs("strong",{children:['"',d==null?void 0:d.anlagenname,'"']})," wirklich löschen?"]}),e.jsx(re,{type:"warning",children:"Alle zugehörigen Monatsdaten, Investitionen und Strompreise werden ebenfalls gelöscht."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{variant:"secondary",onClick:()=>y(null),children:"Abbrechen"}),e.jsx(X,{variant:"danger",onClick:v,children:"Löschen"})]})]})}),u&&e.jsx(Zs,{isOpen:!0,onClose:()=>m(null),anlageId:u})]})}function Xn(){var D;const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(null),a=s??((D=t[0])==null?void 0:D.id),{strompreise:i,loading:b,error:g,createStrompreis:l,updateStrompreis:h,deleteStrompreis:d}=qa(a),[y,u]=c.useState(!1),[m,p]=c.useState(null),[k,v]=c.useState(null),[j,_]=c.useState(null),w=async W=>{try{_(null),await l(W),u(!1)}catch(J){_(J instanceof Error?J.message:"Fehler beim Erstellen")}},f=async W=>{if(m)try{_(null),await h(m.id,W),p(null)}catch(J){_(J instanceof Error?J.message:"Fehler beim Aktualisieren")}},x=async()=>{if(k)try{await d(k.id),v(null)}catch(W){_(W instanceof Error?W.message:"Fehler beim Löschen")}},o=W=>{const J=new Date().toISOString().split("T")[0],K=W.gueltig_ab<=J,C=!W.gueltig_bis||W.gueltig_bis>=J;return K&&C};if(r||b)return e.jsx(xe,{text:"Lade Strompreise..."});if(t.length===0)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsx(re,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Strompreise zu verwalten."})]});const E=[...i].sort((W,J)=>{const K=o(W),C=o(J);return K!==C?K?-1:1:J.gueltig_ab.localeCompare(W.gueltig_ab)});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Strompreise"}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx("select",{value:a??"",onChange:W=>n(Number(W.target.value)),className:"input w-auto",children:t.map(W=>e.jsx("option",{value:W.id,children:W.anlagenname},W.id))}),e.jsxs(X,{onClick:()=>u(!0),children:[e.jsx(xt,{className:"h-5 w-5 mr-2"}),"Neuer Tarif"]})]})]}),g&&e.jsx(re,{type:"error",children:g}),E.length>0&&o(E[0])&&e.jsx(S,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100 dark:bg-green-800",children:e.jsx(rt,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-green-800 dark:text-green-200",children:["Aktueller Tarif: ",E[0].tarifname||"Standard"]}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300",children:["Netzbezug: ",e.jsxs("strong",{children:[E[0].netzbezug_arbeitspreis_cent_kwh.toFixed(2)," ct/kWh"]})," · ","Einspeisung: ",e.jsxs("strong",{children:[E[0].einspeiseverguetung_cent_kwh.toFixed(2)," ct/kWh"]}),E[0].grundpreis_euro_monat&&e.jsxs(e.Fragment,{children:[" · Grundpreis: ",e.jsxs("strong",{children:[E[0].grundpreis_euro_monat.toFixed(2)," €/Monat"]})]})]})]})]})}),i.length===0?e.jsx(S,{children:e.jsx(Ct,{icon:me,title:"Keine Strompreise vorhanden",description:"Lege deinen Stromtarif an, um Einsparungen und Kosten korrekt zu berechnen.",action:e.jsx(X,{onClick:()=>u(!0),children:"Ersten Tarif anlegen"})})}):e.jsx(S,{padding:"none",children:e.jsxs(Tr,{children:[e.jsx(Rr,{children:e.jsxs(Mt,{children:[e.jsx(Pe,{children:"Tarif"}),e.jsx(Pe,{children:"Netzbezug"}),e.jsx(Pe,{children:"Einspeisung"}),e.jsx(Pe,{children:"Grundpreis"}),e.jsx(Pe,{children:"Gültigkeit"}),e.jsx(Pe,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Hr,{children:E.map(W=>{const J=o(W);return e.jsxs(Mt,{className:J?"bg-green-50/50 dark:bg-green-900/10":"",children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:`h-5 w-5 ${J?"text-green-500":"text-gray-400"}`}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:W.tarifname||"Standard"}),J&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 rounded",children:"Aktuell"}),W.anbieter&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:W.anbieter})]})]})}),e.jsxs(Ve,{children:[e.jsx("span",{className:"font-mono text-red-600 dark:text-red-400",children:W.netzbezug_arbeitspreis_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsxs(Ve,{children:[e.jsx("span",{className:"font-mono text-green-600 dark:text-green-400",children:W.einspeiseverguetung_cent_kwh.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" ct/kWh"})]}),e.jsx(Ve,{children:W.grundpreis_euro_monat?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-mono",children:W.grundpreis_euro_monat.toFixed(2)}),e.jsx("span",{className:"text-gray-500 text-sm",children:" €/Mon"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(ht,{className:"h-4 w-4"}),new Date(W.gueltig_ab).toLocaleDateString("de-DE"),W.gueltig_bis&&e.jsxs(e.Fragment,{children:[" - ",new Date(W.gueltig_bis).toLocaleDateString("de-DE")]})]})}),e.jsx(Ve,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>p(W),children:e.jsx(Br,{className:"h-4 w-4"})}),e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>v(W),children:e.jsx(nt,{className:"h-4 w-4 text-red-500"})})]})})]},W.id)})})]})}),e.jsxs(S,{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Hinweise"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Der aktuell gültige Tarif wird automatisch für Berechnungen verwendet"}),e.jsx("li",{children:"Für historische Auswertungen werden die zum jeweiligen Zeitpunkt gültigen Preise herangezogen"}),e.jsx("li",{children:"Bei Tarifwechsel: Neuen Tarif anlegen und Gültigkeitszeitraum korrekt setzen"})]})]}),e.jsx(Ze,{isOpen:y,onClose:()=>{u(!1),_(null)},title:"Neuen Tarif anlegen",size:"lg",children:a&&e.jsx(ks,{anlageId:a,onCreate:w,onCancel:()=>{u(!1),_(null)},error:j})}),e.jsx(Ze,{isOpen:!!m,onClose:()=>{p(null),_(null)},title:"Tarif bearbeiten",size:"lg",children:m&&e.jsx(ks,{strompreis:m,anlageId:m.anlage_id,onUpdate:f,onCancel:()=>{p(null),_(null)},error:j})}),e.jsx(Ze,{isOpen:!!k,onClose:()=>v(null),title:"Tarif löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du den Tarif ",e.jsxs("strong",{children:['"',(k==null?void 0:k.tarifname)||"Standard",'"']})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{variant:"secondary",onClick:()=>v(null),children:"Abbrechen"}),e.jsx(X,{variant:"danger",onClick:x,children:"Löschen"})]})]})})]})}function ks({strompreis:t,anlageId:r,onCreate:s,onUpdate:n,onCancel:a,error:i}){var u,m,p;const[b,g]=c.useState(!1),[l,h]=c.useState({tarifname:(t==null?void 0:t.tarifname)||"",anbieter:(t==null?void 0:t.anbieter)||"",netzbezug_arbeitspreis_cent_kwh:((u=t==null?void 0:t.netzbezug_arbeitspreis_cent_kwh)==null?void 0:u.toString())||"30",einspeiseverguetung_cent_kwh:((m=t==null?void 0:t.einspeiseverguetung_cent_kwh)==null?void 0:m.toString())||"8.2",grundpreis_euro_monat:((p=t==null?void 0:t.grundpreis_euro_monat)==null?void 0:p.toString())||"",gueltig_ab:(t==null?void 0:t.gueltig_ab)||new Date().toISOString().split("T")[0],gueltig_bis:(t==null?void 0:t.gueltig_bis)||"",vertragsart:(t==null?void 0:t.vertragsart)||""}),d=k=>{const{name:v,value:j}=k.target;h(_=>({..._,[v]:j}))},y=async k=>{k.preventDefault(),g(!0);try{const v={netzbezug_arbeitspreis_cent_kwh:parseFloat(l.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(l.einspeiseverguetung_cent_kwh),grundpreis_euro_monat:l.grundpreis_euro_monat?parseFloat(l.grundpreis_euro_monat):void 0,gueltig_ab:l.gueltig_ab,gueltig_bis:l.gueltig_bis||void 0,tarifname:l.tarifname||void 0,anbieter:l.anbieter||void 0,vertragsart:l.vertragsart||void 0};t&&n?await n(v):s&&await s({...v,anlage_id:r})}finally{g(!1)}};return e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[i&&e.jsx(re,{type:"error",children:i}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Tarifname",name:"tarifname",value:l.tarifname,onChange:d,placeholder:"z.B. Grundversorgung, Öko-Strom"}),e.jsx(M,{label:"Anbieter",name:"anbieter",value:l.anbieter,onChange:d,placeholder:"z.B. Stadtwerke"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Preise"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(M,{label:"Netzbezug (ct/kWh)",name:"netzbezug_arbeitspreis_cent_kwh",type:"number",step:"0.01",min:"0",value:l.netzbezug_arbeitspreis_cent_kwh,onChange:d,required:!0,hint:"Arbeitspreis für Strombezug"}),e.jsx(M,{label:"Einspeisevergütung (ct/kWh)",name:"einspeiseverguetung_cent_kwh",type:"number",step:"0.01",min:"0",value:l.einspeiseverguetung_cent_kwh,onChange:d,required:!0,hint:"EEG-Vergütung oder PPA-Preis"}),e.jsx(M,{label:"Grundpreis (€/Monat)",name:"grundpreis_euro_monat",type:"number",step:"0.01",min:"0",value:l.grundpreis_euro_monat,onChange:d,hint:"Optional"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gültigkeit"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Gültig ab",name:"gueltig_ab",type:"date",min:"2000-01-01",max:"2099-12-31",value:l.gueltig_ab,onChange:d,required:!0}),e.jsx(M,{label:"Gültig bis",name:"gueltig_bis",type:"date",min:"2000-01-01",max:"2099-12-31",value:l.gueltig_bis,onChange:d,hint:"Leer lassen für unbefristet"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Vertragsart"}),e.jsxs("select",{name:"vertragsart",value:l.vertragsart,onChange:d,className:"input w-full",children:[e.jsx("option",{value:"",children:"Bitte wählen"}),e.jsx("option",{value:"grundversorgung",children:"Grundversorgung"}),e.jsx("option",{value:"sondervertrag",children:"Sondervertrag"}),e.jsx("option",{value:"dynamisch",children:"Dynamischer Tarif"}),e.jsx("option",{value:"oeko",children:"Ökostrom"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:a,children:"Abbrechen"}),e.jsx(X,{type:"submit",loading:b,children:t?"Speichern":"Anlegen"})]})]})}function ei({typ:t,paramData:r,onChange:s,anlage:n,hasParent:a}){const[i,b]=c.useState(!1),[g,l]=c.useState(!1),h=a,d="Wechselrichter";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Gerätedaten"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Hersteller",name:"param_stamm_hersteller",value:r.stamm_hersteller||"",onChange:s,placeholder:"z.B. Fronius, BYD, Longi"}),e.jsx(M,{label:"Modell",name:"param_stamm_modell",value:r.stamm_modell||"",onChange:s,placeholder:"z.B. Symo GEN24 10.0"}),e.jsx(M,{label:"Seriennummer",name:"param_stamm_seriennummer",value:r.stamm_seriennummer||"",onChange:s,placeholder:t==="pv-module"?"z.B. SN001-SN020":"z.B. ABC123456"}),e.jsx(M,{label:"Garantie bis",name:"param_stamm_garantie_bis",type:"date",value:r.stamm_garantie_bis||"",onChange:s}),t==="wechselrichter"&&e.jsxs("div",{children:[e.jsx(M,{label:"MaStR-ID",name:"param_stamm_mastr_id",value:r.stamm_mastr_id||"",onChange:s,placeholder:"z.B. SEE123456789",hint:"Marktstammdatenregister-ID des Wechselrichters"}),r.stamm_mastr_id&&e.jsxs("a",{href:`https://www.marktstammdatenregister.de/MaStR/Einheit/Detail/IndexOeffentlich/${r.stamm_mastr_id}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qt,{className:"w-3 h-3"}),"Im MaStR öffnen"]})]}),t==="speicher"&&e.jsx(M,{label:"Garantie-Zyklen",name:"param_stamm_garantie_zyklen",type:"number",value:r.stamm_garantie_zyklen||"",onChange:s,placeholder:"z.B. 6000",hint:"Garantierte Ladezyklen"}),t==="pv-module"&&e.jsx(M,{label:"Leistungsgarantie (%)",name:"param_stamm_garantie_leistung_prozent",type:"number",min:"0",max:"100",value:r.stamm_garantie_leistung_prozent||"",onChange:s,placeholder:"z.B. 80",hint:"Garantierte Mindestleistung nach 25 Jahren"}),t==="e-auto"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{label:"Kennzeichen",name:"param_stamm_kennzeichen",value:r.stamm_kennzeichen||"",onChange:s,placeholder:"z.B. M-EE 1234"}),e.jsx(M,{label:"Fahrgestellnummer (VIN)",name:"param_stamm_fahrgestellnummer",value:r.stamm_fahrgestellnummer||"",onChange:s,placeholder:"z.B. WVWZZZ..."}),e.jsx(M,{label:"Erstzulassung",name:"param_stamm_erstzulassung",type:"date",value:r.stamm_erstzulassung||"",onChange:s}),e.jsx(M,{label:"Garantie Batterie (km)",name:"param_stamm_garantie_batterie_km",type:"number",value:r.stamm_garantie_batterie_km||"",onChange:s,placeholder:"z.B. 160000"})]}),(t==="waermepumpe"||t==="e-auto")&&e.jsxs(e.Fragment,{children:[e.jsx(M,{label:"Förderung Aktenzeichen",name:"param_stamm_foerderung_aktenzeichen",value:r.stamm_foerderung_aktenzeichen||"",onChange:s,placeholder:"z.B. BAFA-2024-12345"}),e.jsx(M,{label:"Förderbetrag (€)",name:"param_stamm_foerderung_betrag_euro",type:"number",value:r.stamm_foerderung_betrag_euro||"",onChange:s,placeholder:"z.B. 5000"})]}),t==="balkonkraftwerk"&&e.jsxs(e.Fragment,{children:[e.jsx(M,{label:"Anmeldung Netzbetreiber",name:"param_stamm_anmeldung_netzbetreiber",type:"date",value:r.stamm_anmeldung_netzbetreiber||"",onChange:s}),e.jsx(M,{label:"Anmeldung MaStR",name:"param_stamm_anmeldung_marktstammdaten",type:"date",value:r.stamm_anmeldung_marktstammdaten||"",onChange:s})]})]}),e.jsx("div",{children:e.jsx(M,{label:"Notizen",name:"param_stamm_notizen",value:r.stamm_notizen||"",onChange:s,placeholder:"Optionale Anmerkungen zu diesem Gerät..."})})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>b(!i),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(gt,{className:"w-4 h-4 text-gray-500"}):e.jsx(yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Ansprechpartner"}),h&&!ti(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",d,")"]})]})}),i&&e.jsxs("div",{className:"p-4 space-y-4",children:[h&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder übernehmen automatisch die Werte von ",d,". Nur bei Abweichung ausfüllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Firma",name:"param_ansprechpartner_firma",value:r.ansprechpartner_firma||"",onChange:s,placeholder:n?`(${d})`:"z.B. Solar Mustermann GmbH"}),e.jsx(M,{label:"Name",name:"param_ansprechpartner_name",value:r.ansprechpartner_name||"",onChange:s,placeholder:"Kontaktperson"}),e.jsx(M,{label:"Telefon",name:"param_ansprechpartner_telefon",value:r.ansprechpartner_telefon||"",onChange:s,placeholder:"+49 123 456789"}),e.jsx(M,{label:"E-Mail",name:"param_ansprechpartner_email",type:"email",value:r.ansprechpartner_email||"",onChange:s,placeholder:"service@beispiel.de"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(M,{label:"Ticketsystem / Support-Portal",name:"param_ansprechpartner_ticketsystem",value:r.ansprechpartner_ticketsystem||"",onChange:s,placeholder:"https://support.beispiel.de"}),r.ansprechpartner_ticketsystem&&e.jsxs("a",{href:r.ansprechpartner_ticketsystem,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-1 text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400",children:[e.jsx(Qt,{className:"w-3 h-3"}),"Portal öffnen"]})]}),e.jsx(M,{label:"Kundennummer",name:"param_ansprechpartner_kundennummer",value:r.ansprechpartner_kundennummer||"",onChange:s,placeholder:"z.B. K-12345"}),e.jsx(M,{label:"Vertragsnummer",name:"param_ansprechpartner_vertragsnummer",value:r.ansprechpartner_vertragsnummer||"",onChange:s,placeholder:"z.B. V-2024-001"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(M,{label:"Notizen",name:"param_ansprechpartner_notizen",value:r.ansprechpartner_notizen||"",onChange:s,placeholder:"Optionale Anmerkungen..."})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>l(!g),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-750 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(gt,{className:"w-4 h-4 text-gray-500"}):e.jsx(yt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wartungsvertrag"}),h&&!ri(r)&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(erbt von ",d,")"]})]})}),g&&e.jsxs("div",{className:"p-4 space-y-4",children:[h&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Leere Felder übernehmen automatisch die Werte von ",d,". Nur bei Abweichung ausfüllen."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Vertragsnummer",name:"param_wartung_vertragsnummer",value:r.wartung_vertragsnummer||"",onChange:s,placeholder:"z.B. WV-2024-001"}),e.jsx(M,{label:"Anbieter",name:"param_wartung_anbieter",value:r.wartung_anbieter||"",onChange:s,placeholder:"z.B. Solar Mustermann GmbH"}),e.jsx(M,{label:"Gültig bis",name:"param_wartung_gueltig_bis",type:"date",value:r.wartung_gueltig_bis||"",onChange:s}),e.jsx(M,{label:"Kündigungsfrist",name:"param_wartung_kuendigungsfrist",value:r.wartung_kuendigungsfrist||"",onChange:s,placeholder:"z.B. 3 Monate zum Jahresende"}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(M,{label:"Leistungsumfang",name:"param_wartung_leistungsumfang",value:r.wartung_leistungsumfang||"",onChange:s,placeholder:"z.B. Jährliche Inspektion, Reinigung, Fernüberwachung"})})]})]})]})]})}function ti(t){return["ansprechpartner_firma","ansprechpartner_name","ansprechpartner_telefon","ansprechpartner_email","ansprechpartner_ticketsystem","ansprechpartner_kundennummer","ansprechpartner_vertragsnummer","ansprechpartner_notizen"].some(s=>t[s]&&String(t[s]).trim()!=="")}function ri(t){return["wartung_vertragsnummer","wartung_anbieter","wartung_gueltig_bis","wartung_kuendigungsfrist","wartung_leistungsumfang"].some(s=>t[s]&&String(t[s]).trim()!=="")}const si={"pv-module":"wechselrichter",speicher:"wechselrichter"},ai=["pv-module"],or={wechselrichter:"Wechselrichter"},_r={"e-auto":"E-Auto",waermepumpe:"Wärmepumpe",speicher:"Speicher",wallbox:"Wallbox",wechselrichter:"Wechselrichter","pv-module":"PV-Module",balkonkraftwerk:"Balkonkraftwerk",sonstiges:"Sonstiges"},ni={"e-auto":"Kosten eines vergleichbaren Verbrenners (für ROI-Berechnung)",waermepumpe:"Kosten einer neuen Gas-/Ölheizung (für ROI-Berechnung)",speicher:"Meist 0 - es gibt keine echte Alternative",wallbox:"Meist 0 - es gibt keine echte Alternative",wechselrichter:"Meist 0 - es gibt keine echte Alternative","pv-module":"Meist 0 - es gibt keine echte Alternative",balkonkraftwerk:"Meist 0 - es gibt keine echte Alternative",sonstiges:"Kosten einer Alternative (falls vorhanden)"};function ii({investition:t,anlageId:r,typ:s,anlage:n,onSubmit:a,onCancel:i}){var q,F,Q,A,ae,V;const[b,g]=c.useState(!1),[l,h]=c.useState(null),[d,y]=c.useState([]),[u,m]=c.useState(!1),[p,k]=c.useState([]),[v,j]=c.useState(!1),[_,w]=c.useState({bezeichnung:(t==null?void 0:t.bezeichnung)||`Mein ${_r[s]}`,anschaffungsdatum:(t==null?void 0:t.anschaffungsdatum)||"",anschaffungskosten_gesamt:((q=t==null?void 0:t.anschaffungskosten_gesamt)==null?void 0:q.toString())||"",anschaffungskosten_alternativ:((F=t==null?void 0:t.anschaffungskosten_alternativ)==null?void 0:F.toString())||"",betriebskosten_jahr:((Q=t==null?void 0:t.betriebskosten_jahr)==null?void 0:Q.toString())||"",aktiv:(t==null?void 0:t.aktiv)??!0,parent_investition_id:((A=t==null?void 0:t.parent_investition_id)==null?void 0:A.toString())||"",leistung_kwp:((ae=t==null?void 0:t.leistung_kwp)==null?void 0:ae.toString())||"",ausrichtung:(t==null?void 0:t.ausrichtung)||"Süd",neigung_grad:((V=t==null?void 0:t.neigung_grad)==null?void 0:V.toString())||"30",ha_entity_id:(t==null?void 0:t.ha_entity_id)||""}),f=si[s],x=ai.includes(s);c.useEffect(()=>{f&&(j(!0),Ee.list(r,f,!0).then(L=>k(L.filter(R=>R.id!==(t==null?void 0:t.id)))).catch(()=>k([])).finally(()=>j(!1)))},[f,r,t==null?void 0:t.id]),c.useEffect(()=>{s==="pv-module"&&(m(!0),Re.getStringSensors().then(y).catch(()=>y([])).finally(()=>m(!1)))},[s]);const o=(t==null?void 0:t.parameter)||{},E=()=>{var L,R,ne,oe,we,H,te,ce,he,ve,B,$,T,ke,_e,ye,z,I,Z,Le,ze,Dt,It,Pt,Vt,Kt,Bt,Ot,Tt;return{stamm_hersteller:((L=o.stamm_hersteller)==null?void 0:L.toString())||"",stamm_modell:((R=o.stamm_modell)==null?void 0:R.toString())||"",stamm_seriennummer:((ne=o.stamm_seriennummer)==null?void 0:ne.toString())||"",stamm_garantie_bis:((oe=o.stamm_garantie_bis)==null?void 0:oe.toString())||"",stamm_notizen:((we=o.stamm_notizen)==null?void 0:we.toString())||"",stamm_mastr_id:((H=o.stamm_mastr_id)==null?void 0:H.toString())||"",stamm_garantie_zyklen:((te=o.stamm_garantie_zyklen)==null?void 0:te.toString())||"",stamm_garantie_leistung_prozent:((ce=o.stamm_garantie_leistung_prozent)==null?void 0:ce.toString())||"",stamm_kennzeichen:((he=o.stamm_kennzeichen)==null?void 0:he.toString())||"",stamm_fahrgestellnummer:((ve=o.stamm_fahrgestellnummer)==null?void 0:ve.toString())||"",stamm_erstzulassung:((B=o.stamm_erstzulassung)==null?void 0:B.toString())||"",stamm_garantie_batterie_km:(($=o.stamm_garantie_batterie_km)==null?void 0:$.toString())||"",stamm_foerderung_aktenzeichen:((T=o.stamm_foerderung_aktenzeichen)==null?void 0:T.toString())||"",stamm_foerderung_betrag_euro:((ke=o.stamm_foerderung_betrag_euro)==null?void 0:ke.toString())||"",stamm_anmeldung_netzbetreiber:((_e=o.stamm_anmeldung_netzbetreiber)==null?void 0:_e.toString())||"",stamm_anmeldung_marktstammdaten:((ye=o.stamm_anmeldung_marktstammdaten)==null?void 0:ye.toString())||"",ansprechpartner_firma:((z=o.ansprechpartner_firma)==null?void 0:z.toString())||"",ansprechpartner_name:((I=o.ansprechpartner_name)==null?void 0:I.toString())||"",ansprechpartner_telefon:((Z=o.ansprechpartner_telefon)==null?void 0:Z.toString())||"",ansprechpartner_email:((Le=o.ansprechpartner_email)==null?void 0:Le.toString())||"",ansprechpartner_ticketsystem:((ze=o.ansprechpartner_ticketsystem)==null?void 0:ze.toString())||"",ansprechpartner_kundennummer:((Dt=o.ansprechpartner_kundennummer)==null?void 0:Dt.toString())||"",ansprechpartner_vertragsnummer:((It=o.ansprechpartner_vertragsnummer)==null?void 0:It.toString())||"",ansprechpartner_notizen:((Pt=o.ansprechpartner_notizen)==null?void 0:Pt.toString())||"",wartung_vertragsnummer:((Vt=o.wartung_vertragsnummer)==null?void 0:Vt.toString())||"",wartung_anbieter:((Kt=o.wartung_anbieter)==null?void 0:Kt.toString())||"",wartung_gueltig_bis:((Bt=o.wartung_gueltig_bis)==null?void 0:Bt.toString())||"",wartung_kuendigungsfrist:((Ot=o.wartung_kuendigungsfrist)==null?void 0:Ot.toString())||"",wartung_leistungsumfang:((Tt=o.wartung_leistungsumfang)==null?void 0:Tt.toString())||""}},D=()=>{var R,ne,oe,we,H,te,ce,he,ve,B,$,T,ke,_e,ye,z,I,Z,Le,ze,Dt,It,Pt,Vt,Kt,Bt,Ot,Tt,Yr,Qr,Xr,es,ts,rs,ss;const L=E();switch(s){case"e-auto":return{...L,batteriekapazitaet_kwh:((R=o.batteriekapazitaet_kwh)==null?void 0:R.toString())||"",verbrauch_kwh_100km:((ne=o.verbrauch_kwh_100km)==null?void 0:ne.toString())||"18",jahresfahrleistung_km:((oe=o.jahresfahrleistung_km)==null?void 0:oe.toString())||"15000",pv_ladeanteil_prozent:((we=o.pv_ladeanteil_prozent)==null?void 0:we.toString())||"60",vergleich_verbrauch_l_100km:((H=o.vergleich_verbrauch_l_100km)==null?void 0:H.toString())||"7.5",benzinpreis_euro:((te=o.benzinpreis_euro)==null?void 0:te.toString())||"1.65",v2h_faehig:o.v2h_faehig??!1,v2h_entladeleistung_kw:((ce=o.v2h_entladeleistung_kw)==null?void 0:ce.toString())||""};case"speicher":return{...L,kapazitaet_kwh:((he=o.kapazitaet_kwh)==null?void 0:he.toString())||"",nutzbare_kapazitaet_kwh:((ve=o.nutzbare_kapazitaet_kwh)==null?void 0:ve.toString())||"",max_ladeleistung_kw:((B=o.max_ladeleistung_kw)==null?void 0:B.toString())||"",max_entladeleistung_kw:(($=o.max_entladeleistung_kw)==null?void 0:$.toString())||"",wirkungsgrad_prozent:((T=o.wirkungsgrad_prozent)==null?void 0:T.toString())||"95",arbitrage_faehig:o.arbitrage_faehig??!1};case"waermepumpe":return{...L,leistung_kw:((ke=o.leistung_kw)==null?void 0:ke.toString())||"",effizienz_modus:((_e=o.effizienz_modus)==null?void 0:_e.toString())||"gesamt_jaz",jaz:((ye=o.jaz)==null?void 0:ye.toString())||"3.5",cop_heizung:((z=o.cop_heizung)==null?void 0:z.toString())||"3.9",cop_warmwasser:((I=o.cop_warmwasser)==null?void 0:I.toString())||"3.0",heizwaermebedarf_kwh:((Z=o.heizwaermebedarf_kwh)==null?void 0:Z.toString())||"12000",warmwasserbedarf_kwh:((Le=o.warmwasserbedarf_kwh)==null?void 0:Le.toString())||"3000",pv_anteil_prozent:((ze=o.pv_anteil_prozent)==null?void 0:ze.toString())||"30",alter_energietraeger:((Dt=o.alter_energietraeger)==null?void 0:Dt.toString())||"gas",alter_preis_cent_kwh:((It=o.alter_preis_cent_kwh)==null?void 0:It.toString())||"12",sg_ready:o.sg_ready??!1};case"wallbox":return{...L,max_ladeleistung_kw:((Pt=o.max_ladeleistung_kw)==null?void 0:Pt.toString())||"11",bidirektional:o.bidirektional??!1,pv_optimiert:o.pv_optimiert??!0};case"wechselrichter":return{...L,max_leistung_kw:((Vt=o.max_leistung_kw)==null?void 0:Vt.toString())||"",wirkungsgrad_prozent:((Kt=o.wirkungsgrad_prozent)==null?void 0:Kt.toString())||"97",hybrid:o.hybrid??!1};case"pv-module":return{...L,anzahl_module:((Bt=o.anzahl_module)==null?void 0:Bt.toString())||"",modul_leistung_wp:((Ot=o.modul_leistung_wp)==null?void 0:Ot.toString())||"",modul_typ:((Tt=o.modul_typ)==null?void 0:Tt.toString())||""};case"balkonkraftwerk":return{...L,leistung_wp:((Yr=o.leistung_wp)==null?void 0:Yr.toString())||"",anzahl:((Qr=o.anzahl)==null?void 0:Qr.toString())||"2",ausrichtung:((Xr=o.ausrichtung)==null?void 0:Xr.toString())||"Süd",neigung_grad:((es=o.neigung_grad)==null?void 0:es.toString())||"30",hat_speicher:o.hat_speicher??!1,speicher_kapazitaet_wh:((ts=o.speicher_kapazitaet_wh)==null?void 0:ts.toString())||""};case"sonstiges":return{...L,kategorie:((rs=o.kategorie)==null?void 0:rs.toString())||"erzeuger",beschreibung:((ss=o.beschreibung)==null?void 0:ss.toString())||""};default:return L}},[W,J]=c.useState(D),K=L=>{const{name:R,value:ne,type:oe,checked:we}=L.target;if(R.startsWith("param_")){const H=R.replace("param_","");J(te=>({...te,[H]:oe==="checkbox"?we:ne}))}else w(H=>({...H,[R]:oe==="checkbox"?we:ne}))},C=async L=>{if(L.preventDefault(),h(null),!_.bezeichnung.trim()){h("Bitte eine Bezeichnung eingeben");return}try{g(!0);const R=["stamm_garantie_bis","stamm_erstzulassung","wartung_gueltig_bis","stamm_anmeldung_netzbetreiber","stamm_anmeldung_marktstammdaten"],ne={};if(Object.entries(W).forEach(([ce,he])=>{if(typeof he=="boolean")ne[ce]=he;else if(he!=="")if(R.includes(ce))ne[ce]=he;else{const ve=parseFloat(he);ne[ce]=isNaN(ve)?he:ve}}),x&&p.length>0&&!_.parent_investition_id){h(`${_r[s]} müssen einem ${or[f]||f} zugeordnet werden`);return}let oe,we,H;if(s==="balkonkraftwerk"){const ce=parseInt(W.anzahl)||0,he=parseInt(W.leistung_wp)||0;ce>0&&he>0&&(oe=ce*he/1e3),we=W.ausrichtung||void 0,H=W.neigung_grad?parseFloat(W.neigung_grad):void 0}const te={...t?{}:{anlage_id:r,typ:s},bezeichnung:_.bezeichnung.trim(),anschaffungsdatum:_.anschaffungsdatum||void 0,anschaffungskosten_gesamt:_.anschaffungskosten_gesamt?parseFloat(_.anschaffungskosten_gesamt):void 0,anschaffungskosten_alternativ:_.anschaffungskosten_alternativ?parseFloat(_.anschaffungskosten_alternativ):void 0,betriebskosten_jahr:_.betriebskosten_jahr?parseFloat(_.betriebskosten_jahr):void 0,aktiv:_.aktiv,parameter:Object.keys(ne).length>0?ne:void 0,parent_investition_id:_.parent_investition_id?parseInt(_.parent_investition_id):void 0,...s==="pv-module"&&{leistung_kwp:_.leistung_kwp?parseFloat(_.leistung_kwp):void 0,ausrichtung:_.ausrichtung||void 0,neigung_grad:_.neigung_grad?parseFloat(_.neigung_grad):void 0,ha_entity_id:_.ha_entity_id||void 0},...s==="balkonkraftwerk"&&{leistung_kwp:oe,ausrichtung:we,neigung_grad:H}};await a(te)}catch(R){h(R instanceof Error?R.message:"Fehler beim Speichern")}finally{g(!1)}};return e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[l&&e.jsx(re,{type:"error",children:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allgemein"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Bezeichnung",name:"bezeichnung",value:_.bezeichnung,onChange:K,required:!0}),e.jsx(M,{label:"Anschaffungsdatum",name:"anschaffungsdatum",type:"date",min:"2000-01-01",max:"2099-12-31",value:_.anschaffungsdatum,onChange:K}),e.jsx(M,{label:"Anschaffungskosten (€)",name:"anschaffungskosten_gesamt",type:"number",step:"0.01",min:"0",value:_.anschaffungskosten_gesamt,onChange:K,hint:"Gesamtkosten inkl. Installation"}),e.jsx(M,{label:"Alternative Kosten (€)",name:"anschaffungskosten_alternativ",type:"number",step:"0.01",min:"0",value:_.anschaffungskosten_alternativ,onChange:K,hint:ni[s]}),e.jsx(M,{label:"Betriebskosten/Jahr (€)",name:"betriebskosten_jahr",type:"number",step:"0.01",min:"0",value:_.betriebskosten_jahr,onChange:K,hint:"Wartung, Versicherung, etc."})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"aktiv",checked:_.aktiv,onChange:K,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Aktiv (in Berechnungen berücksichtigen)"})]})]}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zuordnung"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",or[f]||f,")",x?" *":" (optional)",v&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),p.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{name:"parent_investition_id",value:_.parent_investition_id,onChange:L=>w(R=>({...R,parent_investition_id:L.target.value})),className:`input w-full ${x&&!_.parent_investition_id?"border-amber-500 dark:border-amber-500":""}`,required:x,children:[e.jsx("option",{value:"",children:x?"-- Bitte wählen --":"-- Keine Zuordnung --"}),p.map(L=>e.jsx("option",{value:L.id,children:L.bezeichnung},L.id))]}),x&&!_.parent_investition_id&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),s==="pv-module"?"PV-Module müssen einem Wechselrichter zugeordnet werden":"Pflichtfeld"]})]}):v?null:e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 flex-shrink-0"}),x?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:or[f]||f})," an, bevor Sie ",_r[s]," erstellen können."]}):e.jsxs("span",{children:["Kein ",or[f]||f," vorhanden. Zuordnung ist optional."]})]})})]})]}),s==="pv-module"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"PV-Modul Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Leistung (kWp)",name:"leistung_kwp",type:"number",step:"0.1",min:"0",value:_.leistung_kwp,onChange:K,required:!0,hint:"Gesamtleistung dieses PV-Moduls/Strings"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"ausrichtung",value:_.ausrichtung,onChange:L=>w(R=>({...R,ausrichtung:L.target.value})),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(M,{label:"Neigung (Grad)",name:"neigung_grad",type:"number",step:"1",min:"0",max:"90",value:_.neigung_grad,onChange:K,hint:"0° = flach, 90° = senkrecht"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Home Assistant Sensor",u&&e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:"(Laden...)"})]}),e.jsxs("select",{name:"ha_entity_id",value:_.ha_entity_id,onChange:L=>w(R=>({...R,ha_entity_id:L.target.value})),className:"input w-full",children:[e.jsx("option",{value:"",children:"Kein Sensor (manuell)"}),d.map(L=>e.jsxs("option",{value:L.entity_id,children:[L.friendly_name||L.entity_id,L.state&&` (${L.state} ${L.unit_of_measurement||""})`]},L.entity_id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Verknüpfe dieses PV-Modul mit einem String-Sensor für automatische IST-Daten"})]})]})]}),e.jsx(li,{typ:s,paramData:W,onChange:K}),e.jsx(ei,{typ:s,paramData:W,onChange:K,anlage:n,hasParent:!!_.parent_investition_id}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:i,children:"Abbrechen"}),e.jsx(X,{type:"submit",loading:b,children:t?"Speichern":"Erstellen"})]})]})}function li({typ:t,paramData:r,onChange:s}){switch(t){case"e-auto":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Batteriekapazität (kWh)",name:"param_batteriekapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.batteriekapazitaet_kwh,onChange:s}),e.jsx(M,{label:"Verbrauch (kWh/100km)",name:"param_verbrauch_kwh_100km",type:"number",step:"0.1",min:"0",value:r.verbrauch_kwh_100km,onChange:s}),e.jsx(M,{label:"Jahresfahrleistung (km)",name:"param_jahresfahrleistung_km",type:"number",step:"100",min:"0",value:r.jahresfahrleistung_km,onChange:s}),e.jsx(M,{label:"PV-Ladeanteil (%)",name:"param_pv_ladeanteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_ladeanteil_prozent,onChange:s,hint:"Anteil der Ladung aus PV-Strom"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4",children:"Vergleich mit Verbrenner"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Verbrenner-Verbrauch (L/100km)",name:"param_vergleich_verbrauch_l_100km",type:"number",step:"0.1",min:"0",value:r.vergleich_verbrauch_l_100km,onChange:s,hint:"Verbrauch des alternativen Verbrenners"}),e.jsx(M,{label:"Benzinpreis (€/L)",name:"param_benzinpreis_euro",type:"number",step:"0.01",min:"0",value:r.benzinpreis_euro,onChange:s,hint:"Aktueller Benzin/Diesel-Preis"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_v2h_faehig",checked:r.v2h_faehig,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"V2H-fähig (Vehicle-to-Home)"})]}),r.v2h_faehig&&e.jsx(M,{label:"V2H Entladeleistung (kW)",name:"param_v2h_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.v2h_entladeleistung_kw,onChange:s})]});case"speicher":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Kapazität (kWh)",name:"param_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.kapazitaet_kwh,onChange:s}),e.jsx(M,{label:"Nutzbare Kapazität (kWh)",name:"param_nutzbare_kapazitaet_kwh",type:"number",step:"0.1",min:"0",value:r.nutzbare_kapazitaet_kwh,onChange:s,hint:"Typisch 90-95% der Gesamtkapazität"}),e.jsx(M,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:s}),e.jsx(M,{label:"Max. Entladeleistung (kW)",name:"param_max_entladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_entladeleistung_kw,onChange:s}),e.jsx(M,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:s})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_arbitrage_faehig",checked:r.arbitrage_faehig,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Arbitrage-fähig (Netzladen bei Niedrigtarif)"})]})]});case"waermepumpe":{const a=r.effizienz_modus==="getrennte_cops";return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wärmepumpe Parameter"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Berechnungsmodus für Effizienz"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"gesamt_jaz",checked:!a,onChange:s,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Jahresarbeitszahl (JAZ) - Empfohlen"})]}),e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"param_effizienz_modus",value:"getrennte_cops",checked:a,onChange:s,className:"text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Getrennte COPs (Heizung/Warmwasser)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a?"Separate COPs für Heizung (~3,9) und Warmwasser (~3,0) - präziser bei unterschiedlichen Betriebspunkten":"Ein JAZ-Wert (~3,5) für den gesamten Wärmebedarf - einfacher und meist ausreichend"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Nennleistung (kW)",name:"param_leistung_kw",type:"number",step:"0.1",min:"0",value:r.leistung_kw,onChange:s,hint:"Thermische Leistung"}),!a&&e.jsx(M,{label:"Jahresarbeitszahl (JAZ)",name:"param_jaz",type:"number",step:"0.1",min:"1",max:"10",value:r.jaz,onChange:s,hint:"Typisch 3-4 für Luft-WP, 4-5 für Sole-WP",required:!0}),a&&e.jsxs(e.Fragment,{children:[e.jsx(M,{label:"COP Heizung",name:"param_cop_heizung",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_heizung,onChange:s,hint:"Typisch 3,5-4,5 (Vorlauf 35°C)",required:!0}),e.jsx(M,{label:"COP Warmwasser",name:"param_cop_warmwasser",type:"number",step:"0.1",min:"1",max:"10",value:r.cop_warmwasser,onChange:s,hint:"Typisch 2,5-3,5 (Vorlauf 55°C)",required:!0})]}),e.jsx(M,{label:"Heizwärmebedarf (kWh/Jahr)",name:"param_heizwaermebedarf_kwh",type:"number",step:"100",min:"0",value:r.heizwaermebedarf_kwh,onChange:s,hint:"Aus Energieausweis oder Schätzung"}),e.jsx(M,{label:"Warmwasserbedarf (kWh/Jahr)",name:"param_warmwasserbedarf_kwh",type:"number",step:"100",min:"0",value:r.warmwasserbedarf_kwh,onChange:s,hint:"~500 kWh/Person/Jahr typisch"})]}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Vergleich mit alter Heizung (für ROI-Berechnung)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Alter Energieträger"}),e.jsxs("select",{name:"param_alter_energietraeger",value:r.alter_energietraeger,onChange:i=>s({target:{name:"param_alter_energietraeger",value:i.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"gas",children:"Erdgas"}),e.jsx("option",{value:"oel",children:"Heizöl"}),e.jsx("option",{value:"strom",children:"Strom (Direktheizung)"})]})]}),e.jsx(M,{label:"Alter Preis (ct/kWh)",name:"param_alter_preis_cent_kwh",type:"number",step:"0.1",min:"0",value:r.alter_preis_cent_kwh,onChange:s,hint:"Gas ~12 ct, Öl ~10 ct"}),e.jsx(M,{label:"PV-Anteil (%)",name:"param_pv_anteil_prozent",type:"number",step:"1",min:"0",max:"100",value:r.pv_anteil_prozent,onChange:s,hint:"Anteil des WP-Stroms aus PV"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_sg_ready",checked:r.sg_ready,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"SG Ready (Smart Grid fähig)"})]})]})}case"wallbox":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wallbox Parameter"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(M,{label:"Max. Ladeleistung (kW)",name:"param_max_ladeleistung_kw",type:"number",step:"0.1",min:"0",value:r.max_ladeleistung_kw,onChange:s,hint:"Typisch 11 kW oder 22 kW"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_bidirektional",checked:r.bidirektional,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Bidirektional (V2H/V2G)"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_pv_optimiert",checked:r.pv_optimiert,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"PV-Überschussladen möglich"})]})]})]});case"wechselrichter":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Wechselrichter Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Max. Leistung (kW)",name:"param_max_leistung_kw",type:"number",step:"0.1",min:"0",value:r.max_leistung_kw,onChange:s}),e.jsx(M,{label:"Wirkungsgrad (%)",name:"param_wirkungsgrad_prozent",type:"number",step:"0.1",min:"0",max:"100",value:r.wirkungsgrad_prozent,onChange:s})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"param_hybrid",checked:r.hybrid,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Hybrid-Wechselrichter (mit Speicher-Anschluss)"})]})]});case"pv-module":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Modul-Details (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Anzahl Module",name:"param_anzahl_module",type:"number",step:"1",min:"1",value:r.anzahl_module,onChange:s,hint:"Anzahl der PV-Module in diesem String"}),e.jsx(M,{label:"Leistung pro Modul (Wp)",name:"param_modul_leistung_wp",type:"number",step:"1",min:"0",value:r.modul_leistung_wp,onChange:s,hint:"z.B. 400 Wp, 500 Wp"}),e.jsx(M,{label:"Modul-Typ",name:"param_modul_typ",type:"text",value:r.modul_typ,onChange:s,placeholder:"z.B. Longi Hi-MO 5",hint:"Hersteller und Modell"})]}),r.anzahl_module&&r.modul_leistung_wp&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Berechnete Leistung: ",((parseInt(r.anzahl_module)||0)*(parseInt(r.modul_leistung_wp)||0)/1e3).toFixed(2)," kWp"]})]});case"balkonkraftwerk":const n=(parseInt(r.anzahl)||0)*(parseInt(r.leistung_wp)||0)/1e3;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk Parameter"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Anzahl Module",name:"param_anzahl",type:"number",step:"1",min:"1",value:r.anzahl,onChange:s}),e.jsx(M,{label:"Leistung pro Modul (Wp)",name:"param_leistung_wp",type:"number",step:"1",min:"0",value:r.leistung_wp,onChange:s,hint:n>0?`= ${n.toFixed(2)} kWp`:void 0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{name:"param_ausrichtung",value:r.ausrichtung,onChange:a=>s({target:{name:"param_ausrichtung",value:a.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsx(M,{label:"Neigung (Grad)",name:"param_neigung_grad",type:"number",step:"1",min:"0",max:"90",value:r.neigung_grad,onChange:s,hint:"0° = flach, 90° = senkrecht"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-4",children:[e.jsx("input",{type:"checkbox",name:"param_hat_speicher",checked:r.hat_speicher,onChange:s,className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Mit Speicher (z.B. Anker SOLIX)"})]}),r.hat_speicher&&e.jsx(M,{label:"Speicher-Kapazität (Wh)",name:"param_speicher_kapazitaet_wh",type:"number",step:"1",min:"0",value:r.speicher_kapazitaet_wh,onChange:s,hint:"z.B. 1600 Wh für Anker SOLIX"})]});case"sonstiges":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstige Investition"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kategorie"}),e.jsxs("select",{name:"param_kategorie",value:r.kategorie,onChange:a=>s({target:{name:"param_kategorie",value:a.target.value,type:"text"}}),className:"input w-full",children:[e.jsx("option",{value:"erzeuger",children:"Erzeuger (z.B. Mini-BHKW, Mini-Wind)"}),e.jsx("option",{value:"verbraucher",children:"Verbraucher (z.B. Klimaanlage, Pool)"}),e.jsx("option",{value:"speicher",children:"Speicher (z.B. Wasserstoff)"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Bestimmt welche Monatsdaten erfasst werden"})]}),e.jsx(M,{label:"Beschreibung",name:"param_beschreibung",value:r.beschreibung,onChange:s,placeholder:"z.B. Mini-Blockheizkraftwerk Viessmann",hint:"Kurze Beschreibung der Investition"})]})]});default:return null}}const zr=[{typ:"e-auto",label:"E-Auto",icon:Ne,color:"text-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20"},{typ:"waermepumpe",label:"Wärmepumpe",icon:Se,color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20"},{typ:"speicher",label:"Speicher",icon:je,color:"text-green-500",bgColor:"bg-green-50 dark:bg-green-900/20"},{typ:"wallbox",label:"Wallbox",icon:at,color:"text-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20"},{typ:"wechselrichter",label:"Wechselrichter",icon:$t,color:"text-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20"},{typ:"pv-module",label:"PV-Module",icon:ee,color:"text-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20"},{typ:"balkonkraftwerk",label:"Balkonkraftwerk",icon:Ls,color:"text-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20"},{typ:"sonstiges",label:"Sonstiges",icon:$t,color:"text-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20"}];function di(){var K;const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(null),[a,i]=c.useState(!1),[b,g]=c.useState(null),[l,h]=c.useState(null),[d,y]=c.useState(null),[u,m]=c.useState(null),p=s??((K=t[0])==null?void 0:K.id),k=t.find(C=>C.id===p)??null,{investitionen:v,loading:j,createInvestition:_,updateInvestition:w,deleteInvestition:f}=rr(p),x=Ja(v),o=c.useMemo(()=>{const C={};return zr.forEach(q=>{var F;C[q.typ]=((F=x[q.typ])==null?void 0:F.length)||0}),C},[x]),E=C=>{h(C),g(null),i(!0)},D=C=>{g(C),h(C.typ),i(!0)},W=async C=>{try{b?await w(b.id,C):await _(C),i(!1),g(null),h(null)}catch(q){m(q instanceof Error?q.message:"Fehler beim Speichern")}},J=async()=>{if(d)try{await f(d.id),y(null)}catch(C){m(C instanceof Error?C.message:"Fehler beim Löschen")}};return r||j?e.jsx(xe,{text:"Lade Investitionen..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx(re,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, um Investitionen zu verwalten."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investitionen"}),e.jsx("div",{className:"flex items-center gap-3",children:t.length>1&&e.jsx("select",{value:p??"",onChange:C=>n(Number(C.target.value)),className:"input w-auto",children:t.map(C=>e.jsx("option",{value:C.id,children:C.anlagenname},C.id))})})]}),u&&e.jsx(re,{type:"error",onClose:()=>m(null),children:u}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:zr.map(C=>e.jsxs("button",{onClick:()=>E(C.typ),className:`card p-4 text-center hover:shadow-md transition-shadow ${C.bgColor}`,children:[e.jsx(C.icon,{className:`h-8 w-8 mx-auto ${C.color}`}),e.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:C.label}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o[C.typ]," vorhanden"]})]},C.typ))}),v.length===0?e.jsx(Ct,{icon:zt,title:"Keine Investitionen vorhanden",description:"Erfasse deine Investitionen (E-Auto, Wärmepumpe, Speicher, etc.) um deren Wirtschaftlichkeit zu analysieren.",action:e.jsxs(X,{onClick:()=>E("speicher"),children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Erste Investition anlegen"]})}):e.jsx("div",{className:"space-y-6",children:zr.map(C=>{const q=x[C.typ];return!q||q.length===0?null:e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${C.bgColor}`,children:e.jsx(C.icon,{className:`h-5 w-5 ${C.color}`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:C.label})]}),e.jsx(X,{variant:"secondary",size:"sm",onClick:()=>E(C.typ),children:e.jsx(xt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-3",children:q.map(F=>e.jsx(ci,{investition:F,onEdit:()=>D(F),onDelete:()=>y(F)},F.id))})]},C.typ)})}),e.jsx(Ze,{isOpen:a,onClose:()=>{i(!1),g(null),h(null)},title:b?"Investition bearbeiten":"Neue Investition",size:"lg",children:l&&p&&e.jsx(ii,{investition:b,anlageId:p,typ:l,anlage:k,onSubmit:W,onCancel:()=>{i(!1),g(null),h(null)}})}),e.jsxs(Ze,{isOpen:!!d,onClose:()=>y(null),title:"Investition löschen",size:"sm",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:['Möchtest du die Investition "',d==null?void 0:d.bezeichnung,'" wirklich löschen?']}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{variant:"secondary",onClick:()=>y(null),children:"Abbrechen"}),e.jsx(X,{variant:"danger",onClick:J,children:"Löschen"})]})]})]})}function ci({investition:t,onEdit:r,onDelete:s}){const n=t.parameter||{},i=(()=>{const g=[];switch(t.typ){case"e-auto":n.batteriekapazitaet_kwh&&g.push(`${n.batteriekapazitaet_kwh} kWh Batterie`),n.verbrauch_kwh_100km&&g.push(`${n.verbrauch_kwh_100km} kWh/100km`),n.v2h_faehig&&g.push("V2H fähig");break;case"speicher":n.kapazitaet_kwh&&g.push(`${n.kapazitaet_kwh} kWh`),n.nutzbare_kapazitaet_kwh&&g.push(`${n.nutzbare_kapazitaet_kwh} kWh nutzbar`),n.arbitrage_faehig&&g.push("Arbitrage");break;case"waermepumpe":n.leistung_kw&&g.push(`${n.leistung_kw} kW`),n.cop&&g.push(`COP ${n.cop}`);break;case"wallbox":n.max_ladeleistung_kw&&g.push(`${n.max_ladeleistung_kw} kW`),n.bidirektional&&g.push("Bidirektional");break;case"wechselrichter":n.max_leistung_kw&&g.push(`${n.max_leistung_kw} kW`);break;case"pv-module":case"balkonkraftwerk":n.leistung_wp&&g.push(`${n.leistung_wp} Wp`),n.anzahl&&g.push(`${n.anzahl} Module`);break}return g})(),b=t.anschaffungskosten_gesamt;return e.jsxs("div",{className:`
      flex items-center justify-between p-3 rounded-lg border
      ${t.aktiv?"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 opacity-60"}
    `,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung}),!t.aktiv&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-gray-600 dark:text-gray-400",children:"Inaktiv"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[i.length>0&&e.jsx("span",{children:i.join(" • ")}),b&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:[b.toLocaleString("de-DE")," €"]}),t.anschaffungsdatum&&e.jsxs("span",{children:["seit ",new Date(t.anschaffungsdatum).toLocaleDateString("de-DE")]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"Bearbeiten",children:e.jsx(Na,{className:"h-4 w-4"})}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Löschen",children:e.jsx(nt,{className:"h-4 w-4"})})]})]})}const oi=[{value:"1",label:"Januar"},{value:"2",label:"Februar"},{value:"3",label:"März"},{value:"4",label:"April"},{value:"5",label:"Mai"},{value:"6",label:"Juni"},{value:"7",label:"Juli"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Dezember"}];function ys({monatsdaten:t,anlageId:r,onSubmit:s,onCancel:n}){var R,ne,oe,we,H,te,ce,he,ve;const a=new Date().getFullYear(),i=new Date().getMonth()+1,[b,g]=c.useState(!1),[l,h]=c.useState(null),{investitionen:d,loading:y}=rr(r),u=c.useMemo(()=>d.filter(B=>B.aktiv),[d]),m=u.some(B=>B.typ==="speicher"),p=u.some(B=>B.typ==="e-auto"),k=u.some(B=>B.typ==="wallbox"),v=u.some(B=>B.typ==="waermepumpe"),j=u.some(B=>B.typ==="wechselrichter"),_=u.some(B=>B.typ==="pv-module"),w=u.some(B=>B.typ==="balkonkraftwerk"),f=u.some(B=>B.typ==="sonstiges"),[x,o]=c.useState({jahr:((R=t==null?void 0:t.jahr)==null?void 0:R.toString())||a.toString(),monat:((ne=t==null?void 0:t.monat)==null?void 0:ne.toString())||i.toString(),einspeisung_kwh:((oe=t==null?void 0:t.einspeisung_kwh)==null?void 0:oe.toString())||"",netzbezug_kwh:((we=t==null?void 0:t.netzbezug_kwh)==null?void 0:we.toString())||"",pv_erzeugung_kwh:((H=t==null?void 0:t.pv_erzeugung_kwh)==null?void 0:H.toString())||"",batterie_ladung_kwh:((te=t==null?void 0:t.batterie_ladung_kwh)==null?void 0:te.toString())||"",batterie_entladung_kwh:((ce=t==null?void 0:t.batterie_entladung_kwh)==null?void 0:ce.toString())||"",globalstrahlung_kwh_m2:((he=t==null?void 0:t.globalstrahlung_kwh_m2)==null?void 0:he.toString())||"",sonnenstunden:((ve=t==null?void 0:t.sonnenstunden)==null?void 0:ve.toString())||"",notizen:(t==null?void 0:t.notizen)||""}),[E,D]=c.useState(!1),[W,J]=c.useState(null),[K,C]=c.useState({}),[q,F]=c.useState(!1);c.useEffect(()=>{if(u.length===0)return;(async()=>{const $={};if(u.forEach(T=>{var ke,_e;if(T.typ==="e-auto")$[T.id]={km_gefahren:"",verbrauch_kwh:"",ladung_pv_kwh:"",ladung_netz_kwh:"",ladung_extern_kwh:"",ladung_extern_euro:"",entladung_v2h_kwh:""};else if(T.typ==="speicher")$[T.id]={ladung_kwh:"",entladung_kwh:"",speicher_ladung_netz_kwh:"",speicher_ladepreis_cent:""};else if(T.typ==="wallbox")$[T.id]={ladung_kwh:"",ladevorgaenge:""};else if(T.typ==="waermepumpe")$[T.id]={stromverbrauch_kwh:"",heizenergie_kwh:"",warmwasser_kwh:""};else if(T.typ==="wechselrichter")$[T.id]={pv_erzeugung_kwh:""};else if(T.typ==="pv-module")$[T.id]={pv_erzeugung_kwh:""};else if(T.typ==="balkonkraftwerk"){const ye=(ke=T.parameter)==null?void 0:ke.hat_speicher,z={pv_erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""};ye?$[T.id]={...z,speicher_ladung_kwh:"",speicher_entladung_kwh:""}:$[T.id]=z}else if(T.typ==="sonstiges"){const ye=((_e=T.parameter)==null?void 0:_e.kategorie)||"erzeuger";ye==="erzeuger"?$[T.id]={erzeugung_kwh:"",eigenverbrauch_kwh:"",einspeisung_kwh:""}:ye==="verbraucher"?$[T.id]={verbrauch_sonstig_kwh:"",bezug_pv_kwh:"",bezug_netz_kwh:""}:ye==="speicher"&&($[T.id]={ladung_kwh:"",entladung_kwh:""})}$[T.id]&&($[T.id].sonderkosten_euro="",$[T.id].sonderkosten_notiz="")}),t!=null&&t.jahr&&(t!=null&&t.monat)){F(!0);try{const T=await Ee.getMonatsdatenByMonth(r,t.jahr,t.monat);T.forEach(I=>{const Z=String(I.investition_id);$[Z]&&I.verbrauch_daten&&Object.entries(I.verbrauch_daten).forEach(([Le,ze])=>{$[Z][Le]!==void 0&&($[Z][Le]=(ze==null?void 0:ze.toString())||""),Le==="v2h_entladung_kwh"&&$[Z].entladung_v2h_kwh!==void 0&&($[Z].entladung_v2h_kwh=(ze==null?void 0:ze.toString())||""),Le==="erzeugung_kwh"&&$[Z].pv_erzeugung_kwh!==void 0&&($[Z].pv_erzeugung_kwh=(ze==null?void 0:ze.toString())||""),Le==="verbrauch_kwh"&&$[Z].verbrauch_sonstig_kwh!==void 0&&($[Z].verbrauch_sonstig_kwh=(ze==null?void 0:ze.toString())||"")})});const ke=u.filter(I=>I.typ==="speicher"),_e=new Set(T.filter(I=>ke.some(Z=>Z.id===I.investition_id)).map(I=>I.investition_id)),ye=(t==null?void 0:t.batterie_ladung_kwh)||0,z=(t==null?void 0:t.batterie_entladung_kwh)||0;if(ke.length>0&&(ye>0||z>0)){const I=ke.filter(Z=>!_e.has(Z.id));if(I.length>0){const Z=1/I.length;I.forEach(Le=>{const ze=String(Le.id);$[ze]&&($[ze].ladung_kwh=(ye*Z).toFixed(1),$[ze].entladung_kwh=(z*Z).toFixed(1))}),console.info(`Migration: Legacy-Speicherdaten (${ye}/${z} kWh) auf ${I.length} Speicher übertragen`)}}}catch(T){console.error("Fehler beim Laden der InvestitionMonatsdaten:",T)}finally{F(!1)}}C($)})()},[u,t==null?void 0:t.jahr,t==null?void 0:t.monat,r]);const Q=B=>{const{name:$,value:T}=B.target;o(ke=>({...ke,[$]:T}))},A=(B,$,T)=>{C(ke=>({...ke,[B]:{...ke[B],[$]:T}}))},ae=c.useMemo(()=>{let B=0,$=0,T=0;return u.forEach(ke=>{var ye,z;const _e=K[ke.id];_e&&(ke.typ==="speicher"?(B+=parseFloat(_e.ladung_kwh)||0,$+=parseFloat(_e.entladung_kwh)||0):ke.typ==="pv-module"||ke.typ==="wechselrichter"||ke.typ==="balkonkraftwerk"?(T+=parseFloat(_e.pv_erzeugung_kwh)||0,ke.typ==="balkonkraftwerk"&&((ye=ke.parameter)!=null&&ye.hat_speicher)&&(B+=parseFloat(_e.speicher_ladung_kwh)||0,$+=parseFloat(_e.speicher_entladung_kwh)||0)):ke.typ==="sonstiges"&&((z=ke.parameter)==null?void 0:z.kategorie)==="erzeuger"&&(T+=parseFloat(_e.erzeugung_kwh)||0))}),{batterieLadung:B,batterieEntladung:$,pvErzeugung:T}},[u,K]),V=async()=>{if(!x.jahr||!x.monat){h("Bitte zuerst Jahr und Monat auswählen");return}D(!0),J(null),h(null);try{const B=await Ga.getMonatsdaten(r,parseInt(x.jahr),parseInt(x.monat));o(T=>({...T,globalstrahlung_kwh_m2:B.globalstrahlung_kwh_m2.toString(),sonnenstunden:B.sonnenstunden.toString()}));const $=B.datenquelle==="open-meteo"?`Historische Daten von Open-Meteo${B.abdeckung_prozent?` (${B.abdeckung_prozent}% Abdeckung)`:""}`:B.datenquelle==="pvgis-tmy"?"Durchschnittswerte von PVGIS (TMY)":"Geschätzte Durchschnittswerte";J($)}catch(B){h(B instanceof Error?B.message:"Wetterdaten konnten nicht abgerufen werden")}finally{D(!1)}},L=async B=>{if(B.preventDefault(),h(null),!x.einspeisung_kwh||!x.netzbezug_kwh){h("Bitte Einspeisung und Netzbezug eingeben");return}try{g(!0);const $={};u.forEach(ye=>{const z=K[ye.id];if(!z)return;const I={};ye.typ==="e-auto"?(z.km_gefahren&&(I.km_gefahren=parseFloat(z.km_gefahren)),z.verbrauch_kwh&&(I.verbrauch_kwh=parseFloat(z.verbrauch_kwh)),z.ladung_pv_kwh&&(I.ladung_pv_kwh=parseFloat(z.ladung_pv_kwh)),z.ladung_netz_kwh&&(I.ladung_netz_kwh=parseFloat(z.ladung_netz_kwh)),z.ladung_extern_kwh&&(I.ladung_extern_kwh=parseFloat(z.ladung_extern_kwh)),z.ladung_extern_euro&&(I.ladung_extern_euro=parseFloat(z.ladung_extern_euro)),z.entladung_v2h_kwh&&(I.v2h_entladung_kwh=parseFloat(z.entladung_v2h_kwh))):ye.typ==="speicher"?(z.ladung_kwh&&(I.ladung_kwh=parseFloat(z.ladung_kwh)),z.entladung_kwh&&(I.entladung_kwh=parseFloat(z.entladung_kwh)),z.speicher_ladung_netz_kwh&&(I.speicher_ladung_netz_kwh=parseFloat(z.speicher_ladung_netz_kwh)),z.speicher_ladepreis_cent&&(I.speicher_ladepreis_cent=parseFloat(z.speicher_ladepreis_cent))):ye.typ==="wallbox"?(z.ladung_kwh&&(I.ladung_kwh=parseFloat(z.ladung_kwh)),z.ladevorgaenge&&(I.ladevorgaenge=parseInt(z.ladevorgaenge))):ye.typ==="waermepumpe"?(z.stromverbrauch_kwh&&(I.stromverbrauch_kwh=parseFloat(z.stromverbrauch_kwh)),z.heizenergie_kwh&&(I.heizenergie_kwh=parseFloat(z.heizenergie_kwh)),z.warmwasser_kwh&&(I.warmwasser_kwh=parseFloat(z.warmwasser_kwh))):ye.typ==="wechselrichter"||ye.typ==="pv-module"?z.pv_erzeugung_kwh&&(I.pv_erzeugung_kwh=parseFloat(z.pv_erzeugung_kwh)):ye.typ==="balkonkraftwerk"?(z.pv_erzeugung_kwh&&(I.erzeugung_kwh=parseFloat(z.pv_erzeugung_kwh)),z.eigenverbrauch_kwh&&(I.eigenverbrauch_kwh=parseFloat(z.eigenverbrauch_kwh)),z.einspeisung_kwh&&(I.einspeisung_kwh=parseFloat(z.einspeisung_kwh)),z.speicher_ladung_kwh&&(I.speicher_ladung_kwh=parseFloat(z.speicher_ladung_kwh)),z.speicher_entladung_kwh&&(I.speicher_entladung_kwh=parseFloat(z.speicher_entladung_kwh))):ye.typ==="sonstiges"&&(z.erzeugung_kwh&&(I.erzeugung_kwh=parseFloat(z.erzeugung_kwh)),z.eigenverbrauch_kwh&&(I.eigenverbrauch_kwh=parseFloat(z.eigenverbrauch_kwh)),z.einspeisung_kwh&&(I.einspeisung_kwh=parseFloat(z.einspeisung_kwh)),z.verbrauch_sonstig_kwh&&(I.verbrauch_kwh=parseFloat(z.verbrauch_sonstig_kwh)),z.bezug_pv_kwh&&(I.bezug_pv_kwh=parseFloat(z.bezug_pv_kwh)),z.bezug_netz_kwh&&(I.bezug_netz_kwh=parseFloat(z.bezug_netz_kwh)),z.ladung_kwh&&(I.ladung_kwh=parseFloat(z.ladung_kwh)),z.entladung_kwh&&(I.entladung_kwh=parseFloat(z.entladung_kwh))),z.sonderkosten_euro&&(I.sonderkosten_euro=parseFloat(z.sonderkosten_euro)),z.sonderkosten_notiz&&(I.sonderkosten_notiz=z.sonderkosten_notiz),Object.keys(I).length>0&&($[ye.id]=I)});const T=x.batterie_ladung_kwh?parseFloat(x.batterie_ladung_kwh):ae.batterieLadung||void 0,ke=x.batterie_entladung_kwh?parseFloat(x.batterie_entladung_kwh):ae.batterieEntladung||void 0,_e=x.pv_erzeugung_kwh?parseFloat(x.pv_erzeugung_kwh):ae.pvErzeugung||void 0;await s({anlage_id:r,jahr:parseInt(x.jahr),monat:parseInt(x.monat),einspeisung_kwh:parseFloat(x.einspeisung_kwh),netzbezug_kwh:parseFloat(x.netzbezug_kwh),pv_erzeugung_kwh:_e,batterie_ladung_kwh:T,batterie_entladung_kwh:ke,globalstrahlung_kwh_m2:x.globalstrahlung_kwh_m2?parseFloat(x.globalstrahlung_kwh_m2):void 0,sonnenstunden:x.sonnenstunden?parseFloat(x.sonnenstunden):void 0,notizen:x.notizen||void 0,investitionen_daten:Object.keys($).length>0?$:void 0})}catch($){h($ instanceof Error?$.message:"Fehler beim Speichern")}finally{g(!1)}};return y||q?e.jsx("div",{className:"text-center py-4 text-gray-500",children:q?"Lade Investitionsdaten...":"Lade Investitionen..."}):e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[l&&e.jsx(re,{type:"error",children:l}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Zeitraum"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(M,{label:"Jahr",name:"jahr",type:"number",min:"2000",max:"2100",value:x.jahr,onChange:Q,required:!0,disabled:!!t}),e.jsx(Ge,{label:"Monat",name:"monat",value:x.monat,onChange:Q,options:oi,required:!0,disabled:!!t})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Energie-Daten (kWh)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Einspeisung",name:"einspeisung_kwh",type:"number",step:"0.01",min:"0",value:x.einspeisung_kwh,onChange:Q,placeholder:"z.B. 450",required:!0}),e.jsx(M,{label:"Netzbezug",name:"netzbezug_kwh",type:"number",step:"0.01",min:"0",value:x.netzbezug_kwh,onChange:Q,placeholder:"z.B. 120",required:!0}),e.jsx(M,{label:_||j?"PV-Erzeugung (Summe oder manuell)":"PV-Erzeugung (optional)",name:"pv_erzeugung_kwh",type:"number",step:"0.01",min:"0",value:x.pv_erzeugung_kwh,onChange:Q,placeholder:ae.pvErzeugung>0?`Summe: ${ae.pvErzeugung.toFixed(1)}`:"z.B. 800",hint:ae.pvErzeugung>0?`Aus ${_?"PV-Modulen":"Wechselrichtern"}: ${ae.pvErzeugung.toFixed(1)} kWh`:"Wird berechnet wenn leer"})]})]}),_&&e.jsx(gr,{title:"PV-Module",icon:ee,iconColor:"text-yellow-500",investitionen:u.filter(B=>B.typ==="pv-module"),investitionsDaten:K,onInvChange:A,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),j&&!_&&e.jsx(gr,{title:"Wechselrichter",icon:ee,iconColor:"text-yellow-500",investitionen:u.filter(B=>B.typ==="wechselrichter"),investitionsDaten:K,onInvChange:A,felder:[{key:"pv_erzeugung_kwh",label:"PV-Erzeugung",unit:"kWh",placeholder:"z.B. 800"}]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(gi,{investitionen:u.filter(B=>B.typ==="speicher"),investitionsDaten:K,onInvChange:A}),(ae.batterieLadung>0||ae.batterieEntladung>0)&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 -mt-2 ml-7",children:["Summe: Ladung ",ae.batterieLadung.toFixed(1)," kWh | Entladung ",ae.batterieEntladung.toFixed(1)," kWh"]})]}),p&&e.jsx(xi,{investitionen:u.filter(B=>B.typ==="e-auto"),investitionsDaten:K,onInvChange:A}),k&&e.jsx(gr,{title:"Wallbox",icon:at,iconColor:"text-purple-500",investitionen:u.filter(B=>B.typ==="wallbox"),investitionsDaten:K,onInvChange:A,felder:[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 200"},{key:"ladevorgaenge",label:"Ladevorgänge",unit:"",placeholder:"z.B. 12"}]}),v&&e.jsx(gr,{title:"Wärmepumpe",icon:Se,iconColor:"text-orange-500",investitionen:u.filter(B=>B.typ==="waermepumpe"),investitionsDaten:K,onInvChange:A,felder:[{key:"stromverbrauch_kwh",label:"Stromverbrauch",unit:"kWh",placeholder:"z.B. 350"},{key:"heizenergie_kwh",label:"Heizenergie",unit:"kWh",placeholder:"z.B. 1200"},{key:"warmwasser_kwh",label:"Warmwasser",unit:"kWh",placeholder:"z.B. 150"}]}),w&&e.jsx(hi,{investitionen:u.filter(B=>B.typ==="balkonkraftwerk"),investitionsDaten:K,onInvChange:A}),f&&e.jsx(mi,{investitionen:u.filter(B=>B.typ==="sonstiges"),investitionsDaten:K,onInvChange:A}),!m&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Batterie (optional)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Batterie Ladung",name:"batterie_ladung_kwh",type:"number",step:"0.01",min:"0",value:x.batterie_ladung_kwh,onChange:Q,placeholder:"z.B. 150"}),e.jsx(M,{label:"Batterie Entladung",name:"batterie_entladung_kwh",type:"number",step:"0.01",min:"0",value:x.batterie_entladung_kwh,onChange:Q,placeholder:"z.B. 140"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ut,{className:"w-4 h-4"}),"Wetterdaten (optional)"]}),e.jsx(X,{type:"button",variant:"secondary",size:"sm",onClick:V,disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4 animate-spin mr-1"})," Lade..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"w-4 h-4 mr-1"})," Auto-Fill"]})})]}),W&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 px-3 py-2 rounded",children:W}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(M,{label:"Globalstrahlung",name:"globalstrahlung_kwh_m2",type:"number",step:"0.1",min:"0",value:x.globalstrahlung_kwh_m2,onChange:Q,placeholder:"z.B. 152",hint:"kWh/m²"}),e.jsx(M,{label:"Sonnenstunden",name:"sonnenstunden",type:"number",step:"1",min:"0",value:x.sonnenstunden,onChange:Q,placeholder:"z.B. 245",hint:"Stunden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Notizen"}),e.jsx("textarea",{name:"notizen",value:x.notizen,onChange:Q,rows:2,className:"input",placeholder:"Optionale Bemerkungen..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(X,{type:"button",variant:"secondary",onClick:n,children:"Abbrechen"}),e.jsx(X,{type:"submit",loading:b,children:t?"Speichern":"Monat erfassen"})]})]})}function gi({investitionen:t,investitionsDaten:r,onInvChange:s}){if(t.length===0)return null;const n=[{key:"ladung_kwh",label:"Ladung",unit:"kWh",placeholder:"z.B. 150"},{key:"entladung_kwh",label:"Entladung",unit:"kWh",placeholder:"z.B. 140"}],a=[{key:"speicher_ladung_netz_kwh",label:"Netzladung",unit:"kWh",placeholder:"z.B. 50",hint:"Arbitrage: Laden aus Netz"},{key:"speicher_ladepreis_cent",label:"Ø Ladepreis",unit:"ct/kWh",placeholder:"z.B. 15",hint:"Durchschnittl. Strompreis beim Netzladen"}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Speicher"})]}),t.map(i=>{var l;const g=((l=i.parameter)==null?void 0:l.arbitrage_faehig)?[...n,...a]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:g.map(h=>{var d;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[h.label," ",h.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",h.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=r[i.id])==null?void 0:d[h.key])||"",onChange:y=>s(i.id,h.key,y.target.value),placeholder:h.placeholder,className:"input text-sm py-1.5",title:h.hint}),h.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:h.hint,children:h.hint})]},h.key)})}),e.jsx(ar,{invId:i.id,investitionsDaten:r,onInvChange:s})]},i.id)})]})}function xi({investitionen:t,investitionsDaten:r,onInvChange:s}){if(t.length===0)return null;const n=[{key:"km_gefahren",label:"km gefahren",unit:"km",placeholder:"z.B. 1200"},{key:"verbrauch_kwh",label:"Verbrauch gesamt",unit:"kWh",placeholder:"z.B. 216"},{key:"ladung_pv_kwh",label:"Heim: PV",unit:"kWh",placeholder:"z.B. 130",hint:"Wallbox mit PV-Strom"},{key:"ladung_netz_kwh",label:"Heim: Netz",unit:"kWh",placeholder:"z.B. 50",hint:"Wallbox mit Netzstrom"},{key:"ladung_extern_kwh",label:"Extern",unit:"kWh",placeholder:"z.B. 36",hint:"Autobahn, Arbeit, etc."},{key:"ladung_extern_euro",label:"Extern Kosten",unit:"€",placeholder:"z.B. 18.00"}],a={key:"entladung_v2h_kwh",label:"V2H Entladung",unit:"kWh",placeholder:"z.B. 25"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"E-Auto"})]}),t.map(i=>{var l,h;const g=((l=i.parameter)==null?void 0:l.v2h_faehig)||((h=i.parameter)==null?void 0:h.nutzt_v2h)?[...n,a]:n;return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:i.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:g.map(d=>{var y;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[d.label," ",d.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",d.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((y=r[i.id])==null?void 0:y[d.key])||"",onChange:u=>s(i.id,d.key,u.target.value),placeholder:d.placeholder,className:"input text-sm py-1.5",title:d.hint}),d.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:d.hint,children:d.hint})]},d.key)})}),e.jsx(ar,{invId:i.id,investitionsDaten:r,onInvChange:s})]},i.id)})]})}function gr({title:t,icon:r,iconColor:s,investitionen:n,investitionsDaten:a,onInvChange:i,felder:b}){return n.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`h-5 w-5 ${s}`}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t})]}),n.map(g=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:g.bezeichnung}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:b.map(l=>{var h;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:[l.label," ",l.unit&&e.jsxs("span",{className:"text-gray-400",children:["(",l.unit,")"]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=a[g.id])==null?void 0:h[l.key])||"",onChange:d=>i(g.id,l.key,d.target.value),placeholder:l.placeholder,className:"input text-sm py-1.5",title:l.hint}),l.hint&&e.jsx("p",{className:"text-[10px] text-gray-400 dark:text-gray-500 mt-0.5 truncate",title:l.hint,children:l.hint})]},l.key)})}),e.jsx(ar,{invId:g.id,investitionsDaten:a,onInvChange:i})]},g.id))]})}function hi({investitionen:t,investitionsDaten:r,onInvChange:s}){return t.length===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Balkonkraftwerk"})]}),t.map(n=>{var i,b,g,l,h;const a=!!((i=n.parameter)!=null&&i.hat_speicher);return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n.bezeichnung,n.leistung_kwp&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",n.leistung_kwp," kWp)"]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:a?"Mit Speicher: Bei Nulleinspeisung entspricht Eigenverbrauch meist der Erzeugung.":"Ohne Speicher: Eigenverbrauch ist der direkt genutzte Anteil (typisch 30-40% der Erzeugung)."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((b=r[n.id])==null?void 0:b.pv_erzeugung_kwh)||"",onChange:d=>s(n.id,"pv_erzeugung_kwh",d.target.value),placeholder:"z.B. 45",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((g=r[n.id])==null?void 0:g.eigenverbrauch_kwh)||"",onChange:d=>s(n.id,"eigenverbrauch_kwh",d.target.value),placeholder:a?"z.B. 43 (≈Erzeugung)":"z.B. 15 (30-40%)",className:"input text-sm py-1.5"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[n.id])==null?void 0:l.speicher_ladung_kwh)||"",onChange:d=>s(n.id,"speicher_ladung_kwh",d.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Speicher Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[n.id])==null?void 0:h.speicher_entladung_kwh)||"",onChange:d=>s(n.id,"speicher_entladung_kwh",d.target.value),placeholder:"z.B. 28",className:"input text-sm py-1.5"})]})]})]}),e.jsx(ar,{invId:n.id,investitionsDaten:r,onInvChange:s})]},n.id)})]})}function mi({investitionen:t,investitionsDaten:r,onInvChange:s}){if(t.length===0)return null;const n={erzeuger:"Erzeuger",verbraucher:"Verbraucher",speicher:"Speicher"};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fa,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Sonstiges"})]}),t.map(a=>{var b,g,l,h,d,y,u,m,p,k;const i=((b=a.parameter)==null?void 0:b.kategorie)||"erzeuger";return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:a.bezeichnung}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:[n[i]||i,(g=a.parameter)!=null&&g.beschreibung?` - ${String(a.parameter.beschreibung)}`:""]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[i==="erzeuger"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Erzeugung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[a.id])==null?void 0:l.erzeugung_kwh)||"",onChange:v=>s(a.id,"erzeugung_kwh",v.target.value),placeholder:"z.B. 100",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Eigenverbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((h=r[a.id])==null?void 0:h.eigenverbrauch_kwh)||"",onChange:v=>s(a.id,"eigenverbrauch_kwh",v.target.value),placeholder:"z.B. 85",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Einspeisung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((d=r[a.id])==null?void 0:d.einspeisung_kwh)||"",onChange:v=>s(a.id,"einspeisung_kwh",v.target.value),placeholder:"z.B. 15",className:"input text-sm py-1.5"})]})]}),i==="verbraucher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Verbrauch ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((y=r[a.id])==null?void 0:y.verbrauch_sonstig_kwh)||"",onChange:v=>s(a.id,"verbrauch_sonstig_kwh",v.target.value),placeholder:"z.B. 50",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon PV ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((u=r[a.id])==null?void 0:u.bezug_pv_kwh)||"",onChange:v=>s(a.id,"bezug_pv_kwh",v.target.value),placeholder:"z.B. 30",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["davon Netz ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((m=r[a.id])==null?void 0:m.bezug_netz_kwh)||"",onChange:v=>s(a.id,"bezug_netz_kwh",v.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]})]}),i==="speicher"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Ladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((p=r[a.id])==null?void 0:p.ladung_kwh)||"",onChange:v=>s(a.id,"ladung_kwh",v.target.value),placeholder:"z.B. 20",className:"input text-sm py-1.5"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Entladung ",e.jsx("span",{className:"text-gray-400",children:"(kWh)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((k=r[a.id])==null?void 0:k.entladung_kwh)||"",onChange:v=>s(a.id,"entladung_kwh",v.target.value),placeholder:"z.B. 18",className:"input text-sm py-1.5"})]})]})]}),e.jsx(ar,{invId:a.id,investitionsDaten:r,onInvChange:s})]},a.id)})]})}function ar({invId:t,investitionsDaten:r,onInvChange:s}){var b,g,l,h;const n=((b=r[t])==null?void 0:b.sonderkosten_euro)||((g=r[t])==null?void 0:g.sonderkosten_notiz),[a,i]=c.useState(!!n);return e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:a?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Sonderkosten ",e.jsx("span",{className:"text-gray-400",children:"(€)"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:((l=r[t])==null?void 0:l.sonderkosten_euro)||"",onChange:d=>s(t,"sonderkosten_euro",d.target.value),placeholder:"z.B. 150",className:"input text-sm py-1.5"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Beschreibung"}),e.jsx("input",{type:"text",value:((h=r[t])==null?void 0:h.sonderkosten_notiz)||"",onChange:d=>s(t,"sonderkosten_notiz",d.target.value),placeholder:"z.B. Wechselrichter-Reparatur",className:"input text-sm py-1.5"})]})]}):e.jsx("button",{type:"button",onClick:()=>i(!0),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"+ Sonderkosten erfassen (Reparatur, Wartung, etc.)"})})}const js=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],fs={zaehler:{label:"Zählerwerte",color:"bg-blue-500"},komponenten:{label:"Komponenten",color:"bg-amber-500"},berechnet:{label:"Berechnungen",color:"bg-green-500"}},Jt=[{key:"einspeisung",label:"Einspeisung",shortLabel:"Einsp.",group:"zaehler",getValue:t=>t.einspeisung_kwh,format:"kwh",defaultVisible:!0},{key:"netzbezug",label:"Netzbezug",shortLabel:"Netz",group:"zaehler",getValue:t=>t.netzbezug_kwh,format:"kwh",defaultVisible:!0},{key:"pv_erzeugung",label:"PV-Erzeugung",shortLabel:"PV",group:"komponenten",getValue:t=>t.pv_erzeugung_kwh,format:"kwh",defaultVisible:!0},{key:"speicher_ladung",label:"Speicher Ladung",shortLabel:"Sp.Lad",group:"komponenten",getValue:t=>t.speicher_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"speicher_entladung",label:"Speicher Entladung",shortLabel:"Sp.Entl",group:"komponenten",getValue:t=>t.speicher_entladung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_strom",label:"WP Strom",shortLabel:"WP",group:"komponenten",getValue:t=>t.wp_strom_kwh,format:"kwh",defaultVisible:!1},{key:"wp_heizung",label:"WP Heizung",shortLabel:"WP Hz",group:"komponenten",getValue:t=>t.wp_heizung_kwh,format:"kwh",defaultVisible:!1},{key:"wp_warmwasser",label:"WP Warmwasser",shortLabel:"WP WW",group:"komponenten",getValue:t=>t.wp_warmwasser_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_ladung",label:"E-Auto Ladung",shortLabel:"E-Auto",group:"komponenten",getValue:t=>t.eauto_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"eauto_km",label:"E-Auto km",shortLabel:"km",group:"komponenten",getValue:t=>t.eauto_km,defaultVisible:!1},{key:"wallbox_ladung",label:"Wallbox Ladung",shortLabel:"WB",group:"komponenten",getValue:t=>t.wallbox_ladung_kwh,format:"kwh",defaultVisible:!1},{key:"direktverbrauch",label:"Direktverbrauch",shortLabel:"Direkt",group:"berechnet",getValue:t=>t.direktverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"eigenverbrauch",label:"Eigenverbrauch",shortLabel:"Eigen",group:"berechnet",getValue:t=>t.eigenverbrauch_kwh,format:"kwh",defaultVisible:!0},{key:"gesamtverbrauch",label:"Gesamtverbrauch",shortLabel:"Gesamt",group:"berechnet",getValue:t=>t.gesamtverbrauch_kwh,format:"kwh",defaultVisible:!1},{key:"autarkie",label:"Autarkie",shortLabel:"Aut.",group:"berechnet",getValue:t=>t.autarkie_prozent,format:"percent",className:"text-green-600 dark:text-green-400",defaultVisible:!0},{key:"eigenverbrauchsquote",label:"EV-Quote",shortLabel:"EVQ",group:"berechnet",getValue:t=>t.eigenverbrauchsquote_prozent,format:"percent",defaultVisible:!1}],ws="eedc-monatsdaten-columns-v3";function ui(){const t=er(),{anlagen:r,loading:s}=Ce(),[n,a]=c.useState(void 0),{monatsdaten:i,loading:b,error:g,createMonatsdaten:l,updateMonatsdaten:h,deleteMonatsdaten:d}=Gr(n);rr(n);const[y,u]=c.useState([]),[m,p]=c.useState(!1),[k,v]=c.useState(!1),[j,_]=c.useState(null),[w,f]=c.useState(null),[x,o]=c.useState(!1),[E,D]=c.useState(()=>{try{const V=localStorage.getItem(ws);if(V)return new Set(JSON.parse(V))}catch{}return new Set(Jt.filter(V=>V.defaultVisible).map(V=>V.key))});c.useEffect(()=>{localStorage.setItem(ws,JSON.stringify([...E]))},[E]),c.useEffect(()=>{if(!n)return;(async()=>{p(!0);try{const L=await Ft.listAggregiert(n);u(L)}catch(L){console.error("Fehler beim Laden der aggregierten Daten:",L)}finally{p(!1)}})()},[n,i]);const W=V=>{D(L=>{const R=new Set(L);return R.has(V)?R.delete(V):R.add(V),R})},J=V=>{const L=Jt.filter(ne=>ne.group===V),R=L.every(ne=>E.has(ne.key));D(ne=>{const oe=new Set(ne);return L.forEach(we=>{R?oe.delete(we.key):oe.add(we.key)}),oe})},K=Jt.filter(V=>E.has(V.key));!n&&r.length>0&&!s&&a(r[0].id);const C=c.useMemo(()=>y.filter(V=>V.hat_legacy_daten).length,[y]),q=async V=>{await l(V),v(!1)},F=async V=>{j&&(await h(j.id,V),_(null))},Q=async()=>{w&&(await d(w.id),f(null))},A=V=>i.find(L=>L.id===V.id),ae=(V,L)=>{if(V==null||isNaN(V))return"-";switch(L){case"kwh":return V.toLocaleString("de-DE",{maximumFractionDigits:1});case"percent":return`${V.toFixed(1)}%`;default:return V.toLocaleString("de-DE",{maximumFractionDigits:1})}};return s||b?e.jsx(xe,{text:"Lade Daten..."}):r.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsx(S,{children:e.jsx(Ct,{icon:Me,title:"Keine Anlage vorhanden",description:"Bitte lege zuerst eine Anlage an, bevor du Monatsdaten erfassen kannst.",action:e.jsx(X,{onClick:()=>t("/anlagen"),children:"Zur Anlagen-Verwaltung"})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Monatsdaten"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ge,{value:(n==null?void 0:n.toString())||"",onChange:V=>a(parseInt(V.target.value)),options:r.map(V=>({value:V.id.toString(),label:V.anlagenname}))}),e.jsxs(X,{onClick:()=>v(!0),children:[e.jsx(xt,{className:"h-5 w-5 mr-2"}),"Neuer Monat"]})]})]}),g&&e.jsx(re,{type:"error",children:g}),C>0&&e.jsxs(re,{type:"warning",className:"flex items-start gap-3",children:[e.jsx(Ie,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Legacy-Daten gefunden"}),e.jsxs("p",{className:"text-sm mt-1",children:[C," Monat",C>1?"e":""," enthält",C>1?"en":""," Daten im alten Format (PV-Erzeugung/Speicher in Monatsdaten statt InvestitionMonatsdaten). Bitte jeden betroffenen Monat einmal öffnen und speichern."]})]})]}),m?e.jsx(xe,{text:"Lade aggregierte Daten..."}):y.length===0?e.jsx(S,{children:e.jsx(Ct,{icon:ht,title:"Keine Monatsdaten vorhanden",description:"Erfasse deine ersten Monatsdaten manuell oder importiere eine CSV-Datei.",action:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(X,{onClick:()=>v(!0),children:"Manuell erfassen"}),e.jsx(X,{variant:"secondary",onClick:()=>t("/import"),children:"CSV importieren"})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(X,{variant:"secondary",size:"sm",onClick:()=>o(!x),children:[e.jsx(ba,{className:"h-4 w-4 mr-2"}),"Spalten (",K.length,"/",Jt.length,")"]})}),x&&e.jsxs(S,{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"space-y-4",children:Object.keys(fs).map(V=>{const L=fs[V],R=Jt.filter(oe=>oe.group===V),ne=R.filter(oe=>E.has(oe.key)).length;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${L.color}`}),e.jsxs("button",{onClick:()=>J(V),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600",children:[L.label," (",ne,"/",R.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-5",children:R.map(oe=>e.jsx("button",{onClick:()=>W(oe.key),className:`px-3 py-1.5 text-xs font-medium rounded-full transition-colors ${E.has(oe.key)?"bg-primary-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:oe.label},oe.key))})]},V)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4",children:"Klicke auf Gruppen-Namen um alle Spalten ein-/auszublenden, oder auf einzelne Spalten."})]}),e.jsx(S,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Tr,{children:[e.jsx(Rr,{children:e.jsxs(Mt,{children:[e.jsx(Pe,{children:"Monat"}),K.map(V=>e.jsxs(Pe,{className:"text-right",children:[e.jsx("span",{className:"hidden sm:inline",children:V.label}),e.jsx("span",{className:"sm:hidden",children:V.shortLabel||V.label})]},V.key)),e.jsx(Pe,{className:"text-right",children:"Aktionen"})]})}),e.jsx(Hr,{children:y.map(V=>e.jsxs(Mt,{className:V.hat_legacy_daten?"bg-amber-50 dark:bg-amber-900/10":"",children:[e.jsxs(Ve,{children:[e.jsxs("span",{className:"font-medium",children:[js[V.monat]," ",V.jahr]}),V.hat_legacy_daten&&e.jsx("span",{title:"Legacy-Daten",children:e.jsx(Ie,{className:"h-3 w-3 text-amber-500 inline ml-1"})})]}),K.map(L=>{const R=L.getValue(V);return e.jsx(Ve,{className:`text-right font-mono ${L.className||""}`,children:ae(R,L.format)},L.key)}),e.jsx(Ve,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>{const L=A(V);L&&_(L)},children:e.jsx(Br,{className:"h-4 w-4"})}),e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>{const L=A(V);L&&f(L)},children:e.jsx(nt,{className:"h-4 w-4 text-red-500"})})]})})]},V.id))})]})})})]}),e.jsx(Ze,{isOpen:k,onClose:()=>v(!1),title:"Monatsdaten erfassen",size:"lg",children:n&&e.jsx(ys,{anlageId:n,onSubmit:q,onCancel:()=>v(!1)})}),e.jsx(Ze,{isOpen:!!j,onClose:()=>_(null),title:"Monatsdaten bearbeiten",size:"lg",children:j&&n&&e.jsx(ys,{monatsdaten:j,anlageId:n,onSubmit:F,onCancel:()=>_(null)})}),e.jsx(Ze,{isOpen:!!w,onClose:()=>f(null),title:"Monatsdaten löschen",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Möchtest du die Daten für ",e.jsxs("strong",{children:[js[(w==null?void 0:w.monat)||0]," ",w==null?void 0:w.jahr]})," wirklich löschen?"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{variant:"secondary",onClick:()=>f(null),children:"Abbrechen"}),e.jsx(X,{variant:"danger",onClick:Q,children:"Löschen"})]})]})})]})}function Ns(){var B;const{anlagen:t,loading:r,refresh:s}=Ce(),[n,a]=c.useState(null),[i,b]=c.useState(!1),[g,l]=c.useState(!1),[h,d]=c.useState(null),[y,u]=c.useState(null),[m,p]=c.useState(!1),[k,v]=c.useState(!1),[j,_]=c.useState(null),w=c.useRef(null),[f,x]=c.useState(!1),[o,E]=c.useState(!1),[D,W]=c.useState(null),[J,K]=c.useState(!1),C=c.useRef(null),q=t.some($=>$.anlagenname==="Demo-Anlage"),F=n??((B=t[0])==null?void 0:B.id),Q=$=>{$.preventDefault(),b(!0)},A=$=>{$.preventDefault(),b(!1)},ae=async $=>{$.preventDefault(),b(!1);const T=$.dataTransfer.files;T.length>0&&await L(T[0])},V=async $=>{const T=$.target.files;T&&T.length>0&&await L(T[0]),w.current&&(w.current.value="")},L=async $=>{if(!F){u("Bitte zuerst eine Anlage auswählen");return}if(!$.name.endsWith(".csv")){u("Bitte eine CSV-Datei auswählen");return}u(null),d(null),l(!0);try{const T=await pt.importCSV(F,$,m);d(T)}catch(T){u(T instanceof Error?T.message:"Import fehlgeschlagen")}finally{l(!1)}},R=()=>{if(!F){u("Bitte zuerst eine Anlage auswählen");return}window.location.href=pt.getTemplateDownloadUrl(F)},ne=()=>{if(!F){u("Bitte zuerst eine Anlage auswählen");return}window.location.href=pt.getExportUrl(F)},oe=async()=>{u(null),_(null),v(!0);try{const $=await pt.createDemoData();_($),s()}catch($){u($ instanceof Error?$.message:"Fehler beim Erstellen der Demo-Daten")}finally{v(!1)}},we=async()=>{u(null),_(null),v(!0);try{await pt.deleteDemoData(),s()}catch($){u($ instanceof Error?$.message:"Fehler beim Löschen der Demo-Daten")}finally{v(!1)}},H=$=>{$.preventDefault(),x(!0)},te=$=>{$.preventDefault(),x(!1)},ce=async $=>{$.preventDefault(),x(!1);const T=$.dataTransfer.files;T.length>0&&await ve(T[0])},he=async $=>{const T=$.target.files;T&&T.length>0&&await ve(T[0]),C.current&&(C.current.value="")},ve=async $=>{if(!$.name.endsWith(".json")){u("Bitte eine JSON-Datei auswählen");return}u(null),W(null),E(!0);try{const T=await pt.importJSON($,J);W(T),T.erfolg&&s()}catch(T){u(T instanceof Error?T.message:"JSON-Import fehlgeschlagen")}finally{E(!1)}};return r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),e.jsx(re,{type:"warning",children:"Bitte lege zuerst eine PV-Anlage an, bevor du Daten importierst."}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(Zt,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Starte mit einer kompletten Demo-Anlage inkl. PV-System, Speicher, E-Auto, Wärmepumpe, Balkonkraftwerk, Mini-BHKW und 31 Monaten Testdaten."}),e.jsxs(X,{onClick:oe,loading:k,className:"w-full",children:[e.jsx(Zt,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(rt,{className:"inline h-4 w-4 mr-1"}),j.message]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Daten Import"}),t.length>1&&e.jsx("select",{value:F??"",onChange:$=>a(Number($.target.value)),className:"input w-auto",children:t.map($=>e.jsx("option",{value:$.id,children:$.anlagenname},$.id))})]}),y&&e.jsx(re,{type:"error",onClose:()=>u(null),children:y}),h&&e.jsx(bi,{result:h,onClose:()=>d(null)}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:e.jsx(Lr,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV Import"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere Monatsdaten aus einer CSV-Datei. Das Template enthält alle verfügbaren Spalten."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(X,{variant:"secondary",className:"w-full",onClick:R,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Template herunterladen"]}),e.jsx("div",{onDragOver:Q,onDragLeave:A,onDrop:ae,onClick:()=>{var $;return($=w.current)==null?void 0:$.click()},className:`
                border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
                ${i?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-300 dark:border-gray-600 hover:border-primary-500"}
                ${g?"opacity-50 pointer-events-none":""}
              `,children:g?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(xe,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(hr,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"CSV-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:w,type:"file",accept:".csv",onChange:V,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:$=>p($.target.checked),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),"Bestehende Daten überschreiben"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(X,{variant:"secondary",size:"sm",onClick:ne,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Daten exportieren"]})})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20",children:e.jsx(Zt,{className:"h-6 w-6 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Demo-Daten"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:q?"Demo-Anlage ist bereits vorhanden. Du kannst sie löschen, um sie neu zu erstellen.":"Erstelle eine komplette Demo-Anlage mit allen Investitionstypen und 31 Monaten Testdaten."}),q?e.jsxs(X,{variant:"danger",onClick:we,loading:k,className:"w-full",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Demo-Anlage löschen"]}):e.jsxs(X,{onClick:oe,loading:k,className:"w-full",children:[e.jsx(Zt,{className:"h-4 w-4 mr-2"}),"Demo-Daten erstellen"]}),j&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg text-sm text-green-700 dark:text-green-300",children:[e.jsx(rt,{className:"inline h-4 w-4 mr-1"}),j.message]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Enthält:"})," 20 kWp PV-Anlage (3 Strings), 15 kWh Speicher, Tesla Model 3 mit V2H, Wärmepumpe, Wallbox, Balkonkraftwerk mit Speicher, Mini-BHKW, Strompreise 2023-2025"]})]})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20",children:e.jsx(is,{className:"h-6 w-6 text-purple-500"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"JSON Import (Anlage wiederherstellen)"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Importiere eine komplette Anlage aus einer JSON-Export-Datei. Alle Investitionen, Monatsdaten, Strompreise und PVGIS-Prognosen werden importiert."}),D&&e.jsx(pi,{result:D,onClose:()=>W(null)}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:H,onDragLeave:te,onDrop:ce,onClick:()=>{var $;return($=C.current)==null?void 0:$.click()},className:`
              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
              ${f?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600 hover:border-purple-500"}
              ${o?"opacity-50 pointer-events-none":""}
            `,children:o?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(xe,{size:"sm"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"Importiere..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"h-8 w-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"JSON-Datei hierher ziehen oder klicken zum Auswählen"})]})}),e.jsx("input",{ref:C,type:"file",accept:".json",onChange:he,className:"hidden"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:J,onChange:$=>K($.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),"Existierende Anlage mit gleichem Namen überschreiben"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("strong",{children:"Hinweis:"}),' JSON-Dateien können über den "Export (JSON)"-Button in der Anlagen-Übersicht erstellt werden. Bei Namenskonflikt wird automatisch ein Suffix hinzugefügt, es sei denn "Überschreiben" ist aktiviert.']})]}),e.jsxs(S,{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"CSV-Format"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("p",{className:"font-medium text-blue-800 dark:text-blue-200 mb-1",children:"💡 Tipp: Template herunterladen"}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300",children:["Das Template enthält automatisch alle Spalten passend zu deinen angelegten Investitionen (z.B. ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"Sueddach_kWh"}),","," ",e.jsx("code",{className:"text-xs bg-blue-100 dark:bg-blue-800 px-1 rounded",children:"BYD_HVS_Ladung_kWh"}),")."]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Pflichtspalten:"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Jahr"})," - Jahr (z.B. 2024)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Monat"})," - Monat (1-12)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Einspeisung_kWh"})," - Einspeisung ins Netz"]}),e.jsxs("li",{children:[e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"Netzbezug_kWh"})," - Bezug aus dem Netz"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Investitions-Spalten (automatisch im Template):"})}),e.jsxs("ul",{className:"list-disc list-inside ml-2 space-y-1",children:[e.jsxs("li",{children:["PV-Module: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_kWh"})]}),e.jsxs("li",{children:["Speicher: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Ladung_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Entladung_kWh"})]}),e.jsxs("li",{children:["E-Auto: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_km"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Verbrauch_kWh"}),", etc."]}),e.jsxs("li",{children:["Wärmepumpe: ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Strom_kWh"}),", ",e.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-1 rounded",children:"[Name]_Heizung_kWh"})]})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg mt-2",children:[e.jsx("p",{className:"font-medium text-amber-800 dark:text-amber-200 mb-1",children:"⚠️ Hinweis zu Legacy-Spalten"}),e.jsxs("p",{className:"text-amber-700 dark:text-amber-300 text-xs",children:["Die Spalten ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"PV_Erzeugung_kWh"})," und"," ",e.jsx("code",{className:"bg-amber-100 dark:bg-amber-800 px-1 rounded",children:"Batterie_*_kWh"})," werden nicht mehr unterstützt, wenn PV-Module/Speicher als Investitionen angelegt sind. Verwende stattdessen die individuellen Investitions-Spalten."]})]})]})]})]})}function pi({result:t,onClose:r}){const s=t.fehler.length>0,n=t.warnungen.length>0,a=()=>s?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":n?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>s?"text-red-800 dark:text-red-200":n?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",b=()=>s?"text-red-700 dark:text-red-300":n?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300",g=Object.values(t.importiert).reduce((h,d)=>h+d,0),l={strompreise:"Strompreise",investitionen:"Investitionen",investition_monatsdaten:"Investition-Monatsdaten",monatsdaten:"Monatsdaten",pvgis_prognosen:"PVGIS-Prognosen",pvgis_monatsprognosen:"PVGIS-Monatsprognosen"};return e.jsxs("div",{className:`relative p-4 rounded-lg border mb-4 ${a()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(At,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[s?e.jsx(At,{className:"h-5 w-5 text-red-500 mt-0.5"}):n?e.jsx(Ie,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(rt,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:s?"Import fehlgeschlagen":n?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[t.erfolg&&t.anlage_name&&e.jsxs("p",{className:b(),children:[e.jsx("strong",{children:"Anlage:"})," ",t.anlage_name]}),g>0&&e.jsxs("div",{className:b(),children:[e.jsx("p",{className:"font-medium",children:"Importierte Datensätze:"}),e.jsx("ul",{className:"list-disc list-inside ml-2",children:Object.entries(t.importiert).filter(([,h])=>h>0).map(([h,d])=>e.jsxs("li",{children:[l[h]||h,": ",d]},h))})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((h,d)=>e.jsx("li",{children:h},d)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((h,d)=>e.jsx("li",{children:h},d)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function bi({result:t,onClose:r}){const s=t.fehler.length>0,n=t.warnungen&&t.warnungen.length>0,a=()=>s?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":n?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",i=()=>s?"text-red-800 dark:text-red-200":n?"text-yellow-800 dark:text-yellow-200":"text-green-800 dark:text-green-200",b=()=>s?"text-red-700 dark:text-red-300":n?"text-yellow-700 dark:text-yellow-300":"text-green-700 dark:text-green-300";return e.jsxs("div",{className:`relative p-4 rounded-lg border ${a()}`,children:[e.jsx("button",{onClick:r,className:"absolute top-2 right-2 p-1 text-gray-400 hover:text-gray-600",children:e.jsx(At,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-start gap-3",children:[s?e.jsx(At,{className:"h-5 w-5 text-red-500 mt-0.5"}):n?e.jsx(Ie,{className:"h-5 w-5 text-yellow-500 mt-0.5"}):e.jsx(rt,{className:"h-5 w-5 text-green-500 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-medium ${i()}`,children:s?"Import mit Fehlern":n?"Import erfolgreich (mit Hinweisen)":"Import erfolgreich"}),e.jsxs("div",{className:"text-sm mt-1 space-y-2",children:[e.jsxs("p",{className:b(),children:[t.importiert," Datensätze importiert",t.uebersprungen>0&&`, ${t.uebersprungen} übersprungen`]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700 dark:text-red-300 mt-2",children:"Fehler:"}),e.jsxs("ul",{className:"list-disc list-inside text-red-700 dark:text-red-300 ml-2",children:[t.fehler.slice(0,5).map((g,l)=>e.jsx("li",{children:g},l)),t.fehler.length>5&&e.jsxs("li",{children:["... und ",t.fehler.length-5," weitere Fehler"]})]})]}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-700 dark:text-amber-300 mt-2",children:"Hinweise:"}),e.jsxs("ul",{className:"list-disc list-inside text-amber-700 dark:text-amber-300 ml-2",children:[t.warnungen.slice(0,5).map((g,l)=>e.jsx("li",{children:g},l)),t.warnungen.length>5&&e.jsxs("li",{children:["... und ",t.warnungen.length-5," weitere Hinweise"]})]})]})]})]})]})]})}function ki(){const{theme:t,setTheme:r}=Ts(),[s,n]=c.useState(null),[a,i]=c.useState(null),[b,g]=c.useState([]),[l,h]=c.useState([]),[d,y]=c.useState(!0),[u,m]=c.useState(null),[p,k]=c.useState(!1),[v,j]=c.useState(null),_=async()=>{try{y(!0),m(null);const[w,f,x]=await Promise.all([ds.getStats(),ds.getSettings(),tt.list()]);if(n(w),i(f),h(x),x.length>0&&!v&&j(x[0].id),f.ha_integration_enabled)try{const o=await Re.getSensors();g(o)}catch{}}catch(w){m(w instanceof Error?w.message:"Fehler beim Laden der Einstellungen")}finally{y(!1)}};return c.useEffect(()=>{_()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Einstellungen"}),e.jsx("button",{onClick:_,disabled:d,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(qe,{className:`h-5 w-5 ${d?"animate-spin":""}`})})]}),u&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:u})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Erscheinungsbild"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"label",children:"Theme"}),e.jsx("div",{className:"flex gap-3",children:[{value:"light",label:"Hell",icon:ee},{value:"dark",label:"Dunkel",icon:Is},{value:"system",label:"System",icon:Ds}].map(w=>e.jsxs("button",{onClick:()=>r(w.value),className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border-2 transition-colors ${t===w.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx(w.icon,{className:"h-5 w-5"}),w.label]},w.value))})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(st,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Home Assistant Integration"})]}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg mb-4",children:e.jsx("div",{className:"flex items-center gap-2 text-sm",children:a!=null&&a.ha_integration_enabled?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Verbunden"}),b.length>0&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400 ml-2",children:["(",b.length," Energy-Sensoren verfügbar)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(br,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Nicht verbunden"})]})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Datenerfassung"}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Monatsdaten via CSV-Import"}),e.jsxs("p",{children:["Die Erfassung der Monatsdaten erfolgt über ",e.jsx("strong",{children:"CSV-Import"})," oder ",e.jsx("strong",{children:"manuelle Eingabe"}),". Gehe zu ",e.jsx("strong",{children:"Einstellungen → Import/Export"})," um deine Daten zu importieren."]})]})]}),(a==null?void 0:a.ha_integration_enabled)&&l.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Auto-Discovery"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Durchsuche Home Assistant nach Geräten (SMA, evcc, Smart, Wallbox) und erstelle Investitionen."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.length>1&&e.jsx("select",{value:v||"",onChange:w=>j(Number(w.target.value)),className:"text-sm px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:l.map(w=>e.jsx("option",{value:w.id,children:w.anlagenname},w.id))}),e.jsxs("button",{onClick:()=>k(!0),disabled:!v,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500 text-white hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(bt,{className:"w-4 h-4"}),"Geräte erkennen"]})]})]})}),b.length>0&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer hover:text-primary-600",children:"Verfügbare Energy-Sensoren anzeigen"}),e.jsx("div",{className:"mt-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium",children:"Entity ID"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Name"}),e.jsx("th",{className:"text-left p-2 font-medium",children:"Einheit"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:b.map(w=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"p-2 font-mono text-gray-600 dark:text-gray-400",children:w.entity_id}),e.jsx("td",{className:"p-2 text-gray-700 dark:text-gray-300",children:w.friendly_name||"-"}),e.jsx("td",{className:"p-2 text-gray-500",children:w.unit_of_measurement||"-"})]},w.entity_id))})]})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ms,{className:"h-6 w-6 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Datenbank"})]}),d?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(ct,{className:"h-6 w-6 animate-spin text-gray-400"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.anlagen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Anlagen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.monatsdaten}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Monatsdaten"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.investitionen}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Investitionen"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.strompreise}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Stromtarife"})]})]}),s.gesamt_erzeugung_kwh>0&&e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-700 dark:text-yellow-300",children:[(s.gesamt_erzeugung_kwh/1e3).toLocaleString("de-DE",{maximumFractionDigits:1})," MWh"]}),e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:["Gesamte PV-Erzeugung",s.daten_zeitraum&&e.jsxs("span",{children:[" (",s.daten_zeitraum.von," - ",s.daten_zeitraum.bis,")"]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pfad:"})," ",s.database_path]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Version:"})," ",(a==null?void 0:a.version)||"0.1.0"]})]})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Keine Daten verfügbar"}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("a",{href:"./api/docs",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary text-sm",children:"API-Dokumentation"})})]}),p&&v&&e.jsx(Zs,{isOpen:!0,onClose:()=>k(!1),anlageId:v,onInvestitionenCreated:_})]})}const vs=["","Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];function yi(){const{anlagen:t,loading:r}=Ce(),[s,n]=c.useState(),[a,i]=c.useState(null),[b,g]=c.useState([]),[l,h]=c.useState(null),[d,y]=c.useState(null),[u,m]=c.useState(!1),[p,k]=c.useState(!1),[v,j]=c.useState(!1),[_,w]=c.useState(null),[f,x]=c.useState(null),[o,E]=c.useState(14);c.useEffect(()=>{t.length>0&&!s&&n(t[0].id)},[t,s]),c.useEffect(()=>{s&&D()},[s]);const D=async()=>{if(s){m(!0),w(null),x(null);try{const[A,ae]=await Promise.all([Qe.getAktivePrognose(s),Qe.listeGespeichertePrognosen(s)]);i(A),g(ae)}catch(A){w(A instanceof Error?A.message:"Fehler beim Laden")}finally{m(!1)}}},W=async()=>{if(s){k(!0),w(null);try{const A=await Qe.getPrognose(s,{system_losses:o});h(A)}catch(A){w(A instanceof Error?A.message:"Fehler beim Abrufen der PVGIS Prognose")}finally{k(!1)}}},J=async()=>{if(s){j(!0),w(null);try{const A=await Qe.getOptimum(s);y(A)}catch(A){w(A instanceof Error?A.message:"Fehler beim Ermitteln des Optimums")}finally{j(!1)}}},K=async()=>{if(s){m(!0),w(null);try{await Qe.speicherePrognose(s,{system_losses:o}),x("Prognose erfolgreich gespeichert"),h(null),await D()}catch(A){w(A instanceof Error?A.message:"Fehler beim Speichern")}finally{m(!1)}}},C=async A=>{try{await Qe.aktivierePrognose(A),x("Prognose aktiviert"),await D()}catch(ae){w(ae instanceof Error?ae.message:"Fehler beim Aktivieren")}},q=async A=>{if(confirm("Prognose wirklich löschen?"))try{await Qe.loeschePrognose(A),x("Prognose gelöscht"),await D()}catch(ae){w(ae instanceof Error?ae.message:"Fehler beim Löschen")}},F=t.find(A=>A.id===s),Q=(F==null?void 0:F.latitude)&&(F==null?void 0:F.longitude);return r?e.jsx(xe,{text:"Lade..."}):t.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"}),e.jsx(re,{type:"warning",children:"Bitte zuerst eine Anlage anlegen."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-8 w-8 text-yellow-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"PVGIS Prognose"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&e.jsx(Ge,{value:(s==null?void 0:s.toString())||"",onChange:A=>n(parseInt(A.target.value)),options:t.map(A=>({value:A.id.toString(),label:A.anlagenname}))}),e.jsx("button",{onClick:D,disabled:u,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(qe,{className:`h-5 w-5 ${u?"animate-spin":""}`})})]})]}),_&&e.jsx(re,{type:"error",children:_}),f&&e.jsx(re,{type:"success",children:f}),!Q&&e.jsx(re,{type:"warning",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(pr,{className:"h-5 w-5 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Keine Geokoordinaten hinterlegt"}),e.jsx("p",{className:"text-sm mt-1",children:"Bitte ergänze Latitude und Longitude in den Anlagen-Stammdaten, um PVGIS Prognosen abrufen zu können."})]})]})}),Q&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aktive Prognose"}),u?e.jsx(xe,{}):a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Jahresertrag"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:[a.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Spezifisch"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:[a.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Neigung"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:[a.neigung_grad,"°"]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:a.ausrichtung_richtung})]})]}),a.monatswerte&&a.monatswerte.length>0&&e.jsx("div",{className:"h-64",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:a.monatswerte.map(A=>({name:vs[A.monat],prognose:A.e_m})),children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name"}),e.jsx(se,{tickFormatter:A=>`${A} kWh`}),e.jsx(Y,{formatter:A=>`${A.toFixed(0)} kWh`}),e.jsx(G,{dataKey:"prognose",fill:"#f59e0b",name:"Prognose"})]})})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Abgerufen am: ",new Date(a.abgerufen_am).toLocaleDateString("de-DE")," • ","Koordinaten: ",a.latitude.toFixed(4),"°N, ",a.longitude.toFixed(4),"°E"]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Noch keine Prognose gespeichert"}),e.jsx("p",{className:"text-sm mt-2",children:"Rufe eine PVGIS Prognose ab und speichere sie."})]})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Neue Prognose abrufen"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Systemverluste (%)"}),e.jsx("input",{type:"number",value:o,onChange:A=>E(parseFloat(A.target.value)||14),min:0,max:50,step:1,className:"input w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Typisch: 14% (Kabel, Wechselrichter, etc.)"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(X,{onClick:W,disabled:p,className:"w-full",children:[p?e.jsx(qe,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Von PVGIS abrufen"]})})]}),l&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Vorschau"}),e.jsxs(X,{onClick:K,disabled:u,children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),"Speichern & Aktivieren"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jahresertrag"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Spezifisch"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Gesamt-Leistung"}),e.jsxs("p",{className:"text-xl font-bold",children:[l.gesamt_leistung_kwp.toFixed(1)," kWp"]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"PV-Module"}),e.jsx("p",{className:"text-xl font-bold",children:l.module.length})]})]}),l.module.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Module im Detail:"}),e.jsx("div",{className:"grid gap-2",children:l.module.map(A=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:A.bezeichnung}),e.jsxs("span",{className:"text-gray-500",children:[A.leistung_kwp," kWp • ",A.ausrichtung," • ",A.neigung_grad,"° • ",A.jahresertrag_kwh.toLocaleString("de-DE")," kWh/a"]})]},A.investition_id))})]}),e.jsx("div",{className:"h-48",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:l.monatsdaten.map(A=>({name:vs[A.monat],ertrag:A.e_m})),children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"name",fontSize:10}),e.jsx(se,{tickFormatter:A=>`${A}`}),e.jsx(Y,{formatter:A=>`${A.toFixed(0)} kWh`}),e.jsx(G,{dataKey:"ertrag",fill:"#22c55e",name:"Ertrag"})]})})})]})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ka,{className:"h-5 w-5"}),"Optimale Ausrichtung"]}),e.jsxs(X,{onClick:J,disabled:v,variant:"secondary",children:[v?e.jsx(qe,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(be,{className:"h-4 w-4 mr-2"}),"Berechnen"]})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-600 dark:text-green-400 mb-2",children:"Optimale Parameter für Standort"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Neigung"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[d.optimal.neigung_grad,"°"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Ausrichtung"}),e.jsx("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:d.optimal.azimut_richtung})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Spez. Ertrag"}),e.jsxs("p",{className:"text-xl font-bold text-green-700 dark:text-green-300",children:[d.optimal.spezifischer_ertrag_kwh_kwp.toFixed(0)," kWh/kWp"]})]})]})]}),d.hinweis&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d.hinweis})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:'Klicke auf "Berechnen" um die optimale Ausrichtung für deinen Standort zu ermitteln.'})]}),b.length>0&&e.jsxs(S,{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Gespeicherte Prognosen"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Datum"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Jahresertrag"}),e.jsx("th",{className:"text-right py-2 px-2",children:"kWh/kWp"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Neigung"}),e.jsx("th",{className:"text-center py-2 px-2",children:"Status"}),e.jsx("th",{className:"text-right py-2 px-2",children:"Aktionen"})]})}),e.jsx("tbody",{children:b.map(A=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 px-2",children:new Date(A.abgerufen_am).toLocaleDateString("de-DE")}),e.jsxs("td",{className:"text-right py-2 px-2",children:[A.jahresertrag_kwh.toLocaleString("de-DE")," kWh"]}),e.jsx("td",{className:"text-right py-2 px-2",children:A.spezifischer_ertrag_kwh_kwp.toFixed(0)}),e.jsxs("td",{className:"text-right py-2 px-2",children:[A.neigung_grad,"°"]}),e.jsx("td",{className:"text-center py-2 px-2",children:A.ist_aktiv?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(rt,{className:"h-4 w-4"}),"Aktiv"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"text-right py-2 px-2",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!A.ist_aktiv&&e.jsx("button",{onClick:()=>C(A.id),className:"p-1 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"Aktivieren",children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>q(A.id),className:"p-1 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:"Löschen",children:e.jsx(nt,{className:"h-4 w-4"})})]})})]},A.id))})]})})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Me,{className:"h-5 w-5 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Über PVGIS"}),e.jsx("p",{children:"PVGIS (Photovoltaic Geographical Information System) ist ein Tool der EU-Kommission, das PV-Ertragsprognosen basierend auf Satellitendaten und Klimamodellen berechnet. Die Prognosen berücksichtigen Standort, Modulneigung, Ausrichtung und Systemverluste."}),e.jsx("a",{href:"https://re.jrc.ec.europa.eu/pvg_tools/en/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline mt-2 inline-block",children:"Mehr erfahren →"})]})]})})]})]})}const _s=`# Utility Meter für monatliche Aggregation
# Füge dies in deine configuration.yaml ein

utility_meter:
  # PV-Erzeugung (von deinem Wechselrichter)
  pv_erzeugung_monatlich:
    source: sensor.DEIN_WR_total_yield  # <- Anpassen!
    cycle: monthly

  # Einspeisung ins Netz
  einspeisung_monatlich:
    source: sensor.DEIN_ZAEHLER_export  # <- Anpassen!
    cycle: monthly

  # Netzbezug
  netzbezug_monatlich:
    source: sensor.DEIN_ZAEHLER_import  # <- Anpassen!
    cycle: monthly

  # Speicher Ladung (optional)
  speicher_ladung_monatlich:
    source: sensor.DEIN_SPEICHER_charge_total  # <- Anpassen!
    cycle: monthly

  # Speicher Entladung (optional)
  speicher_entladung_monatlich:
    source: sensor.DEIN_SPEICHER_discharge_total  # <- Anpassen!
    cycle: monthly

  # E-Auto Ladung (optional, z.B. von evcc)
  eauto_ladung_monatlich:
    source: sensor.evcc_loadpoint_charge_total_import  # <- Anpassen!
    cycle: monthly`,zs=`# Automation: Monatliche CSV-Export Datei erstellen
# Voraussetzung: File Integration muss eingerichtet sein

automation:
  - alias: "EEDC Monatsdaten Export"
    trigger:
      - platform: time
        at: "00:05:00"  # Am 1. des Monats um 00:05
    condition:
      - condition: template
        value_template: "{{ now().day == 1 }}"
    action:
      - service: notify.file_export  # <- Anpassen an deinen File Notifier
        data:
          message: >
            {{ (now() - timedelta(days=1)).year }},{{ (now() - timedelta(days=1)).month }},{{ states('sensor.einspeisung_monatlich') }},{{ states('sensor.netzbezug_monatlich') }},{{ states('sensor.pv_erzeugung_monatlich') }}

# Hinweis: Die CSV muss dann manuell in EEDC importiert werden
# oder du erweiterst die Automation um einen REST-Call zu EEDC`;function ji(){const[t,r]=c.useState(!1),[s,n]=c.useState(null),a=(i,b)=>{navigator.clipboard.writeText(i),n(b),setTimeout(()=>n(null),2e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Lr,{className:"w-6 h-6"}),"Datenerfassung"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"So erfassen Sie Ihre monatlichen Energiedaten in EEDC"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(ls,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Manuelles Formular"}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-2 py-0.5 rounded",children:"Empfohlen für Einsteiger"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Geben Sie Ihre Monatsdaten direkt im Formular ein. Ideal für gelegentliche Erfassung oder wenn Sie nur wenige Werte haben."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-blue-500"}),"Einstellungen → Monatsdaten → Neu"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-blue-500"}),"Wetterdaten können automatisch geladen werden"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-blue-500"}),"Investitions-Daten pro Komponente erfassen"]})]}),e.jsxs("a",{href:"#/einstellungen/monatsdaten",className:"btn btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4"}),"Zur Monatsdaten-Erfassung"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 border-2 border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx(hr,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"CSV-Import"}),e.jsx("span",{className:"text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 px-2 py-0.5 rounded",children:"Empfohlen für regelmäßige Erfassung"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Laden Sie Monatsdaten per CSV-Datei hoch. Perfekt für größere Datenmengen oder historische Daten."}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-green-500"}),"Einstellungen → Import/Export"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-green-500"}),"Vorlage herunterladen (passt zu Ihren Investitionen)"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-green-500"}),"Wetterdaten werden automatisch ergänzt"]})]}),e.jsxs("a",{href:"#/einstellungen/import",className:"btn btn-primary w-full flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(hr,{className:"w-4 h-4"}),"Zum CSV-Import"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Oe,{className:"w-6 h-6 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Hinweis für Home Assistant Benutzer"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:"EEDC ist als Standalone-Anwendung konzipiert und benötigt keine Home Assistant Integration für die Datenerfassung. Sie können Ihre Daten aus HA manuell in eine CSV-Datei exportieren und in EEDC importieren."}),e.jsxs("p",{className:"text-blue-700 dark:text-blue-300 text-sm mb-3",children:[e.jsx("strong",{children:"Optional:"})," Unter Einstellungen → HA-Export können Sie berechnete KPIs (Autarkie, Eigenverbrauch, etc.) per MQTT zurück an Home Assistant senden."]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:e.jsxs("a",{href:"#/einstellungen/ha-export",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1",children:[e.jsx(Qt,{className:"w-3 h-3"}),"HA-Export Einstellungen"]})})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>r(!t),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg",children:e.jsx(Lr,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Anleitung: CSV aus Home Assistant erstellen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"So richten Sie Utility Meter ein, um monatliche Werte für EEDC zu exportieren"})]})]}),t?e.jsx(ha,{className:"w-5 h-5 text-gray-400"}):e.jsx(gt,{className:"w-5 h-5 text-gray-400"})]}),t&&e.jsxs("div",{className:"px-4 pb-4 space-y-6 border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"1"}),"Utility Meter einrichten"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:["Utility Meter aggregieren Ihre Sensordaten monatlich. Fügen Sie folgendes in Ihre"," ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"configuration.yaml"})," ein und passen Sie die Sensor-IDs an:"]}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-64",children:_s}),e.jsx("button",{onClick:()=>a(_s,"utility"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:s==="utility"?e.jsx(rt,{className:"w-4 h-4 text-green-400"}):e.jsx(Cr,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"2"}),"Ihre Sensoren finden"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"So finden Sie die richtigen Sensor-IDs in Home Assistant:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 ml-4",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Entwicklerwerkzeuge → Zustände"})," in HA öffnen"]}),e.jsx("li",{children:'• Nach "total" oder "energy" filtern'}),e.jsxs("li",{children:["• Sensoren mit ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"state_class: total_increasing"})," sind ideal"]}),e.jsxs("li",{children:["• Typische Namen: ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_total_yield"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_energy"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_import"}),", ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:"*_export"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-orange-500 text-white text-sm flex items-center justify-center",children:"3"}),"CSV-Datei erstellen"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Am Monatsende die Utility Meter Werte ablesen und in eine CSV eintragen:"}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs font-mono overflow-x-auto",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"// Pflicht-Spalten:"}),e.jsx("div",{children:"Jahr,Monat,Einspeisung_kWh,Netzbezug_kWh"}),e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"// Beispiel:"}),e.jsx("div",{children:"2025,12,125.9,405.5"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[e.jsx("strong",{children:"Tipp:"})," Laden Sie unter Import/Export eine Vorlage herunter - sie enthält alle Spalten passend zu Ihren angelegten Investitionen!"]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-gray-400 text-white text-sm flex items-center justify-center",children:"4"}),e.jsx("span",{className:"text-gray-500",children:"(Optional)"})," Automatischer Export"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Für Fortgeschrittene: Mit der File-Integration und einer Automation können Sie die CSV automatisch erstellen lassen:"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg text-xs overflow-x-auto max-h-48",children:zs}),e.jsx("button",{onClick:()=>a(zs,"file"),className:"absolute top-2 right-2 p-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-300",title:"In Zwischenablage kopieren",children:s==="file"?e.jsx(rt,{className:"w-4 h-4 text-green-400"}):e.jsx(Cr,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Wichtig:"}),' Utility Meter werden bei HA-Neustart zurückgesetzt, es sei denn, Sie haben den Recorder korrekt konfiguriert. Alternativ können Sie auch die "Statistik"-Werte aus dem HA Energy Dashboard verwenden.']})})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"💡 Tipps für die Datenerfassung"}),e.jsxs("ul",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"📅"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Regelmäßigkeit:"})," Erfassen Sie Ihre Daten am besten immer am gleichen Tag im Monat (z.B. am 1. oder letzten Tag)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"📊"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Zählerstände:"})," Notieren Sie die Zählerstände Ihrer Wechselrichter, Speicher und Wallbox. EEDC erwartet Monatswerte (Differenz zum Vormonat)."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"☀️"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Wetterdaten:"})," Globalstrahlung und Sonnenstunden werden automatisch aus Open-Meteo geladen, wenn Ihre Anlage Koordinaten hat."]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"🚗"}),e.jsxs("span",{children:[e.jsx("strong",{children:"E-Auto:"})," Bei externem Laden (öffentliche Säulen) können Sie Ladung und Kosten separat erfassen."]})]})]})]})]})}function fi(){const[t,r]=c.useState([]),[s,n]=c.useState(null),[a,i]=c.useState(null),[b,g]=c.useState(null),[l,h]=c.useState(null),[d,y]=c.useState(!0),[u,m]=c.useState(null),[p,k]=c.useState(null),[v,j]=c.useState("core-mosquitto"),[_,w]=c.useState(1883),[f,x]=c.useState(""),[o,E]=c.useState(""),[D,W]=c.useState(null),[J,K]=c.useState(null),[C,q]=c.useState(!1),[F,Q]=c.useState(!1),[A,ae]=c.useState(!1),[V,L]=c.useState("mqtt"),[R,ne]=c.useState(new Set(["energie","finanzen"])),[oe,we]=c.useState(!1),H=async()=>{try{y(!0),m(null);const[z,I,Z]=await Promise.all([tt.list(),Re.getExportSensors(),Re.getMqttConfig().catch(()=>null)]);r(z),i(I),Z&&(k(Z),j(Z.host),w(Z.port),x(Z.username)),z.length>0&&!s&&n(z[0].id)}catch(z){m(z instanceof Error?z.message:"Fehler beim Laden")}finally{y(!1)}},te=async z=>{try{const[I,Z]=await Promise.all([Re.getAnlageSensors(z),Re.getYamlSnippet(z)]);g(I),h(Z)}catch(I){console.error("Fehler beim Laden der Anlage-Daten:",I)}};c.useEffect(()=>{H()},[]),c.useEffect(()=>{s&&te(s)},[s]);const ce=async()=>{q(!0),W(null);try{const z=await Re.testMqtt({host:v,port:_,username:f||void 0,password:o||void 0});W(z)}catch(z){W({connected:!1,error:z instanceof Error?z.message:"Verbindungsfehler"})}finally{q(!1)}},he=async()=>{if(s){Q(!0),K(null);try{const z=await Re.publishMqtt(s,{host:v,port:_,username:f||void 0,password:o||void 0});K(z)}catch(z){K({message:z instanceof Error?z.message:"Fehler beim Publizieren",anlage_id:s,total:0,success:0,failed:0})}finally{Q(!1)}}},ve=async()=>{if(s&&confirm("Alle EEDC-Sensoren für diese Anlage aus Home Assistant entfernen?")){ae(!0);try{await Re.removeMqtt(s,{host:v,port:_,username:f||void 0,password:o||void 0}),K(null)}catch(z){m(z instanceof Error?z.message:"Fehler beim Entfernen")}finally{ae(!1)}}},B=async()=>{if(l)try{await navigator.clipboard.writeText(l.yaml),we(!0),setTimeout(()=>we(!1),2e3)}catch{const z=document.createElement("textarea");z.value=l.yaml,document.body.appendChild(z),z.select(),document.execCommand("copy"),document.body.removeChild(z),we(!0),setTimeout(()=>we(!1),2e3)}},$=()=>{if(!l||!b)return;const z=new Blob([l.yaml],{type:"text/yaml"}),I=URL.createObjectURL(z),Z=document.createElement("a");Z.href=I,Z.download=`eedc_sensors_${b.anlage_name.toLowerCase().replace(/\s+/g,"_")}.yaml`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(I)},T=z=>{ne(I=>{const Z=new Set(I);return Z.has(z)?Z.delete(z):Z.add(z),Z})},ke=z=>{const I={};return z.forEach(Z=>{const Le=Z.category||"sonstige";I[Le]||(I[Le]=[]),I[Le].push(Z)}),I},_e={energie:"Energie",finanzen:"Finanzen",autarkie:"Autarkie & Eigenverbrauch",umwelt:"Umwelt",performance:"Performance",sonstige:"Sonstige"},ye={energie:"⚡",finanzen:"💰",autarkie:"🏠",umwelt:"🌱",performance:"📊",sonstige:"📌"};return d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ct,{className:"h-8 w-8 animate-spin text-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"h-6 w-6 text-cyan-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"HA-Sensor-Export"})]}),e.jsx("button",{onClick:H,disabled:d,className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Aktualisieren",children:e.jsx(qe,{className:`h-5 w-5 ${d?"animate-spin":""}`})})]}),u&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:u})}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Berechnete KPIs nach Home Assistant exportieren"}),e.jsx("p",{children:"EEDC kann berechnete Kennzahlen (Autarkie, Ersparnis, CO₂, ROI) als Sensoren an Home Assistant zurückgeben. Wähle zwischen REST API (YAML-Konfiguration) oder MQTT Discovery (native Entitäten)."})]})]}),t.length>1&&e.jsxs("div",{className:"card p-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Anlage auswählen"}),e.jsx("select",{value:s||"",onChange:z=>n(Number(z.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300",children:t.map(z=>e.jsx("option",{value:z.id,children:z.anlagenname},z.id))})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>L("mqtt"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${V==="mqtt"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"MQTT Discovery (empfohlen)"}),e.jsx("button",{onClick:()=>L("rest"),className:`pb-3 text-sm font-medium border-b-2 transition-colors ${V==="rest"?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"REST API (YAML)"})]})}),V==="mqtt"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"MQTT-Broker Konfiguration"}),p&&e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30 px-2 py-1 rounded",children:"Aus Add-on Optionen geladen"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Host"}),e.jsx("input",{type:"text",value:v,onChange:z=>j(z.target.value),placeholder:"core-mosquitto",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Bei HA Add-on: core-mosquitto"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Port"}),e.jsx("input",{type:"number",value:_,onChange:z=>w(Number(z.target.value)),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Benutzername (optional)"}),e.jsx("input",{type:"text",value:f,onChange:z=>x(z.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Passwort (optional)"}),e.jsx("input",{type:"password",value:o,onChange:z=>E(z.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"})]})]}),D&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${D.connected?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:D.connected?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-green-700 dark:text-green-300 text-sm",children:["Verbunden mit ",D.broker]})]}):e.jsxs(e.Fragment,{children:[e.jsx(br,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-700 dark:text-red-300 text-sm",children:D.error})]})}),D.hint&&e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-400",children:D.hint})]}),J&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg ${J.success>0?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:[J.success," von ",J.total," Sensoren publiziert"]})]}),J.failed>0&&e.jsxs("p",{className:"mt-1 text-xs text-yellow-600 dark:text-yellow-400",children:[J.failed," Sensoren konnten nicht publiziert werden"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:ce,disabled:C,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[C?e.jsx(ct,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"}),"Verbindung testen"]}),e.jsxs("button",{onClick:he,disabled:F||!s,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition-colors disabled:opacity-50",children:[F?e.jsx(ct,{className:"w-4 h-4 animate-spin"}):e.jsx(Sa,{className:"w-4 h-4"}),"Sensoren publizieren"]}),e.jsxs("button",{onClick:ve,disabled:A||!s,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800/30 transition-colors disabled:opacity-50",children:[A?e.jsx(ct,{className:"w-4 h-4 animate-spin"}):e.jsx(nt,{className:"w-4 h-4"}),"Sensoren entfernen"]})]})]}),e.jsxs("div",{className:`p-4 rounded-lg flex gap-3 ${p!=null&&p.auto_publish?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800"}`,children:[p!=null&&p.auto_publish?e.jsx(et,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(Ie,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:`text-sm ${p!=null&&p.auto_publish?"text-green-700 dark:text-green-300":"text-amber-700 dark:text-amber-300"}`,children:[e.jsx("p",{className:"font-medium mb-1",children:"MQTT Discovery"}),e.jsxs("p",{children:["Die Sensoren erscheinen automatisch in Home Assistant unter ",e.jsx("strong",{children:"Einstellungen → Geräte & Dienste → MQTT"}),".",p!=null&&p.auto_publish?e.jsxs(e.Fragment,{children:[" Die automatische Publizierung ist aktiviert (alle ",p.publish_interval_minutes," Minuten)."]}):e.jsxs(e.Fragment,{children:[" Um die Werte aktuell zu halten, muss die Publizierung regelmäßig erfolgen (manuell oder via Automatisierung). Aktiviere ",e.jsx("strong",{children:"auto_publish"})," in den Add-on Optionen für automatische Updates."]})]})]})]})]}),V==="rest"&&l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"YAML für configuration.yaml"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:B,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:oe?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 text-green-500"}),"Kopiert!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Cr,{className:"w-4 h-4"}),"Kopieren"]})}),e.jsxs("button",{onClick:$,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Download"]})]})]}),e.jsx("pre",{className:"bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono max-h-96",children:l.yaml}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 dark:text-gray-400",children:l.hinweis})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"REST Sensor Konfiguration"}),e.jsxs("p",{children:["Füge diesen YAML-Block in deine ",e.jsx("code",{className:"px-1 bg-blue-100 dark:bg-blue-800 rounded",children:"configuration.yaml"})," ein. Die Sensoren werden alle ",l.sensor_count>0?"60 Sekunden":""," aktualisiert. Nach Änderungen muss Home Assistant neu gestartet werden."]})]})]})]}),b&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Verfügbare Sensoren (",b.sensors.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(ke(b.sensors)).map(([z,I])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>T(z),className:"w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:ye[z]||"📌"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:_e[z]||z}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",I.length,")"]})]}),R.has(z)?e.jsx(gt,{className:"w-5 h-5 text-gray-400"}):e.jsx(yt,{className:"w-5 h-5 text-gray-400"})]}),R.has(z)&&e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:I.map(Z=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:Z.icon}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:Z.name})]}),e.jsx("code",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:Z.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:Z.value!==null?typeof Z.value=="number"?Z.value.toLocaleString("de-DE",{maximumFractionDigits:2}):Z.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:Z.unit})]})]}),Z.formel&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-800 rounded text-xs text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:"Formel:"})," ",Z.formel,Z.berechnung&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["= ",Z.berechnung]})]})]},Z.key))})]},z))})]}),a&&a.investitionen.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Investitions-Sensoren"}),e.jsx("div",{className:"space-y-4",children:a.investitionen.map(z=>e.jsxs("details",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("summary",{className:"p-3 bg-gray-50 dark:bg-gray-800 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:z.bezeichnung}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",z.typ," - ",z.sensors.length," Sensoren)"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:z.sensors.map(I=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:I.name}),e.jsx("code",{className:"ml-2 text-xs text-gray-500",children:I.key})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-medium",children:I.value!==null?typeof I.value=="number"?I.value.toLocaleString("de-DE",{maximumFractionDigits:2}):I.value:"-"}),e.jsx("span",{className:"ml-1 text-sm text-gray-500",children:I.unit})]})]},I.key))})]},z.investition_id))})]})]})}function wi(){return e.jsx(ea,{children:e.jsx(ta,{children:e.jsxs(ge,{path:"/",element:e.jsx(Oa,{}),children:[e.jsx(ge,{index:!0,element:e.jsx(De,{to:"/cockpit",replace:!0})}),e.jsx(ge,{path:"cockpit",element:e.jsx(Xa,{})}),e.jsx(ge,{path:"cockpit/pv-anlage",element:e.jsx(sn,{})}),e.jsx(ge,{path:"cockpit/e-auto",element:e.jsx(an,{})}),e.jsx(ge,{path:"cockpit/waermepumpe",element:e.jsx(ln,{})}),e.jsx(ge,{path:"cockpit/speicher",element:e.jsx(on,{})}),e.jsx(ge,{path:"cockpit/wallbox",element:e.jsx(xn,{})}),e.jsx(ge,{path:"cockpit/balkonkraftwerk",element:e.jsx(un,{})}),e.jsx(ge,{path:"cockpit/sonstiges",element:e.jsx(bn,{})}),e.jsx(ge,{path:"auswertungen",element:e.jsx(hs,{})}),e.jsx(ge,{path:"auswertungen/roi",element:e.jsx($n,{})}),e.jsx(ge,{path:"auswertungen/prognose",element:e.jsx(Mn,{})}),e.jsx(ge,{path:"auswertungen/export",element:e.jsx(hs,{})})," ",e.jsx(ge,{path:"aussichten",element:e.jsx(Bn,{})}),e.jsx(ge,{path:"einstellungen/anlage",element:e.jsx(Qn,{})}),e.jsx(ge,{path:"einstellungen/strompreise",element:e.jsx(Xn,{})}),e.jsx(ge,{path:"einstellungen/investitionen",element:e.jsx(di,{})}),e.jsx(ge,{path:"einstellungen/monatsdaten",element:e.jsx(ui,{})}),e.jsx(ge,{path:"einstellungen/import",element:e.jsx(Ns,{})}),e.jsx(ge,{path:"einstellungen/demo",element:e.jsx(Ns,{})})," ",e.jsx(ge,{path:"einstellungen/pvgis",element:e.jsx(yi,{})}),e.jsx(ge,{path:"einstellungen/ha-import",element:e.jsx(ji,{})}),e.jsx(ge,{path:"einstellungen/ha-export",element:e.jsx(fi,{})}),e.jsx(ge,{path:"einstellungen/allgemein",element:e.jsx(ki,{})}),e.jsx(ge,{path:"dashboard",element:e.jsx(De,{to:"/cockpit",replace:!0})}),e.jsx(ge,{path:"anlagen",element:e.jsx(De,{to:"/einstellungen/anlage",replace:!0})}),e.jsx(ge,{path:"monatsdaten",element:e.jsx(De,{to:"/einstellungen/monatsdaten",replace:!0})}),e.jsx(ge,{path:"strompreise",element:e.jsx(De,{to:"/einstellungen/strompreise",replace:!0})}),e.jsx(ge,{path:"investitionen",element:e.jsx(De,{to:"/einstellungen/investitionen",replace:!0})}),e.jsx(ge,{path:"auswertung",element:e.jsx(De,{to:"/auswertungen",replace:!0})}),e.jsx(ge,{path:"roi",element:e.jsx(De,{to:"/auswertungen/roi",replace:!0})}),e.jsx(ge,{path:"e-auto",element:e.jsx(De,{to:"/cockpit/e-auto",replace:!0})}),e.jsx(ge,{path:"waermepumpe",element:e.jsx(De,{to:"/cockpit/waermepumpe",replace:!0})}),e.jsx(ge,{path:"speicher",element:e.jsx(De,{to:"/cockpit/speicher",replace:!0})}),e.jsx(ge,{path:"wallbox",element:e.jsx(De,{to:"/cockpit/wallbox",replace:!0})}),e.jsx(ge,{path:"balkonkraftwerk",element:e.jsx(De,{to:"/cockpit/balkonkraftwerk",replace:!0})}),e.jsx(ge,{path:"sonstiges",element:e.jsx(De,{to:"/cockpit/sonstiges",replace:!0})}),e.jsx(ge,{path:"import",element:e.jsx(De,{to:"/einstellungen/import",replace:!0})}),e.jsx(ge,{path:"settings",element:e.jsx(De,{to:"/einstellungen/allgemein",replace:!0})})]})})})}function Ni({onNext:t,onLoadDemo:r}){const[s,n]=c.useState(!1),[a,i]=c.useState(null),b=async()=>{if(r){n(!0),i(null);try{await r()}catch(g){i(g instanceof Error?g.message:"Fehler beim Laden der Demo-Daten"),n(!1)}}};return e.jsxs("div",{className:"p-8 md:p-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl mb-6",children:e.jsx(ee,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Willkommen bei eedc"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto",children:"Ihr persönliches Energie Effizienz Data Center für die Analyse und Optimierung Ihrer PV-Anlage."})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[e.jsx(Sr,{icon:e.jsx(Pr,{className:"w-6 h-6"}),title:"Auswertungen",description:"Detaillierte Analysen zu Erzeugung, Verbrauch und Autarkie"}),e.jsx(Sr,{icon:e.jsx(zt,{className:"w-6 h-6"}),title:"Wirtschaftlichkeit",description:"ROI-Berechnungen für alle Ihre Energie-Investitionen"}),e.jsx(Sr,{icon:e.jsx(me,{className:"w-6 h-6"}),title:"Home Assistant",description:"Automatischer Datenimport direkt aus Ihrem Smart Home"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"In wenigen Schritten eingerichtet:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(qt,{number:1,text:"PV-Anlage mit Leistung und Standort anlegen"}),e.jsx(qt,{number:2,text:"Home Assistant Verbindung prüfen"}),e.jsx(qt,{number:3,text:"Stromtarif konfigurieren (mit Vorschlägen)"}),e.jsx(qt,{number:4,text:"Geräte automatisch aus HA erkennen"}),e.jsx(qt,{number:5,text:"Investitionen vervollständigen"})]})]}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Einrichtung starten",e.jsx($e,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Die Einrichtung dauert etwa 2-3 Minuten"}),r&&e.jsxs("div",{className:"pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Oder erkunden Sie die App mit vorbereiteten Demo-Daten:"}),e.jsx("button",{onClick:b,disabled:s,className:"inline-flex items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-all disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-5 h-5 animate-spin"}),"Demo wird geladen..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_a,{className:"w-5 h-5"}),"Demo-Anlage laden"]})}),a&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:a}),e.jsx("p",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500",children:"Enthält 31 Monate Beispieldaten, 9 Investitionen inkl. E-Auto, Speicher, Wärmepumpe u.v.m."})]})]})]})}function Sr({icon:t,title:r,description:s}){return e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl mb-4",children:t}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:r}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s})]})}function qt({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}const vi=[{value:"",label:"-- Auswählen --"},{value:"Süd",label:"Süd (optimal)"},{value:"Südost",label:"Südost"},{value:"Südwest",label:"Südwest"},{value:"Ost",label:"Ost"},{value:"West",label:"West"},{value:"Ost-West",label:"Ost-West"}],_i=[{value:"",label:"-- Unbekannt / Andere --"},{value:"sma",label:"SMA"},{value:"fronius",label:"Fronius"},{value:"kostal",label:"Kostal"},{value:"huawei",label:"Huawei / FusionSolar"},{value:"growatt",label:"Growatt"},{value:"solax",label:"SolaX"},{value:"sungrow",label:"Sungrow"},{value:"goodwe",label:"GoodWe"},{value:"enphase",label:"Enphase"}];function zi({isLoading:t,error:r,onSubmit:s,onGeocode:n,onBack:a}){const[i,b]=c.useState({anlagenname:"",leistung_kwp:"",installationsdatum:"",standort_plz:"",standort_ort:"",latitude:"",longitude:"",ausrichtung:"",neigung_grad:"",wechselrichter_hersteller:""}),[g,l]=c.useState(null),[h,d]=c.useState(!1),[y,u]=c.useState(!1),m=j=>{const{name:_,value:w}=j.target;b(f=>({...f,[_]:w})),l(null),(_==="standort_plz"||_==="standort_ort")&&u(!1)},p=async()=>{if(!i.standort_plz){l("Bitte geben Sie eine PLZ ein");return}d(!0),l(null),u(!1);try{const j=await n(i.standort_plz,i.standort_ort||void 0);j?(b(_=>({..._,latitude:j.latitude.toFixed(6),longitude:j.longitude.toFixed(6)})),u(!0)):l("Koordinaten konnten nicht ermittelt werden. Bitte prüfen Sie PLZ/Ort.")}catch{l("Fehler beim Ermitteln der Koordinaten")}finally{d(!1)}},k=async j=>{if(j.preventDefault(),l(null),!i.anlagenname.trim()){l("Bitte geben Sie einen Namen für Ihre Anlage ein");return}if(!i.leistung_kwp||parseFloat(i.leistung_kwp)<=0){l("Bitte geben Sie die Anlagenleistung in kWp ein");return}await s({anlagenname:i.anlagenname.trim(),leistung_kwp:parseFloat(i.leistung_kwp),installationsdatum:i.installationsdatum||void 0,standort_plz:i.standort_plz||void 0,standort_ort:i.standort_ort||void 0,latitude:i.latitude?parseFloat(i.latitude):void 0,longitude:i.longitude?parseFloat(i.longitude):void 0,ausrichtung:i.ausrichtung||void 0,neigung_grad:i.neigung_grad?parseFloat(i.neigung_grad):void 0,wechselrichter_hersteller:i.wechselrichter_hersteller||void 0})},v=g||r;return e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"PV-Anlage anlegen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Grunddaten Ihrer Photovoltaikanlage"})]})]}),v&&e.jsx(re,{type:"error",className:"mb-6",children:v}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Anlagenname ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"anlagenname",value:i.anlagenname,onChange:m,placeholder:"z.B. Meine PV-Anlage",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Leistung (kWp) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"leistung_kwp",value:i.leistung_kwp,onChange:m,placeholder:"z.B. 10.5",step:"0.01",min:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Gesamtleistung aller Module in Kilowatt-Peak"})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(ht,{className:"w-4 h-4 inline mr-1"}),"Installationsdatum"]}),e.jsx("input",{type:"date",name:"installationsdatum",min:"2000-01-01",max:"2099-12-31",value:i.installationsdatum,onChange:m,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Für korrekten Start der Stromtarif-Gültigkeit"})]})}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900 dark:text-white mb-4",children:[e.jsx(pr,{className:"w-4 h-4 text-gray-500"}),"Standort (für PVGIS-Prognose)"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"PLZ"}),e.jsx("input",{type:"text",name:"standort_plz",value:i.standort_plz,onChange:m,placeholder:"z.B. 12345",maxLength:5,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ort"}),e.jsx("input",{type:"text",name:"standort_ort",value:i.standort_ort,onChange:m,placeholder:"z.B. Berlin",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",onClick:p,disabled:h||!i.standort_plz,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"}),"Ermittle Koordinaten..."]}):y?e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 text-green-500"}),"Koordinaten ermittelt"]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"w-4 h-4"}),"Koordinaten aus PLZ ermitteln"]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Breitengrad (Latitude)"}),e.jsx("input",{type:"number",name:"latitude",value:i.latitude,onChange:m,placeholder:"z.B. 52.520008",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Längengrad (Longitude)"}),e.jsx("input",{type:"number",name:"longitude",value:i.longitude,onChange:m,placeholder:"z.B. 13.404954",step:"0.000001",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:'Die Koordinaten werden für die PVGIS-Ertragsprognose benötigt. Klicken Sie auf "Koordinaten aus PLZ ermitteln" oder geben Sie sie manuell ein.'})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Technische Daten (optional)"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsx("select",{name:"ausrichtung",value:i.ausrichtung,onChange:m,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:vi.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",name:"neigung_grad",value:i.neigung_grad,onChange:m,placeholder:"z.B. 30",min:"0",max:"90",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Typisch: 30-35° (Süd), 10-15° (Ost-West)"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-4",children:"Wechselrichter-Hersteller (optional)"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hersteller"}),e.jsx("select",{name:"wechselrichter_hersteller",value:i.wechselrichter_hersteller,onChange:m,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:_i.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Hilft bei der automatischen Erkennung von Home Assistant Sensoren"})]})})]})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:a,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx($e,{className:"w-4 h-4"})]})})]})]})}function Si({isLoading:t,error:r,haConnected:s,haVersion:n,onRetry:a,onNext:i,onSkip:b,onBack:g}){return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${s?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-700"}`,children:s?e.jsx(Or,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):e.jsx(Xt,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Home Assistant Verbindung"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatischer Datenimport aus Ihrem Smart Home"})]})]}),e.jsxs("div",{className:"space-y-6",children:[t?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 mb-4",children:e.jsx(qe,{className:"w-8 h-8 text-amber-500 animate-spin"})}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Verbindung wird geprüft..."})]}):s?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(Je,{className:"w-10 h-10 text-green-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Verbindung erfolgreich!"}),n&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Home Assistant Version: ",n]}),e.jsxs("div",{className:"max-w-md mx-auto bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-medium text-green-800 dark:text-green-300 mb-2",children:"Folgende Funktionen sind verfügbar:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-green-700 dark:text-green-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Automatische Geräte-Erkennung"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Sensor-Zuordnung für Energy-Daten"]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-4",children:e.jsx(Xt,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Keine Verbindung zu Home Assistant"}),r&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:r}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4 text-left mb-6",children:[e.jsxs("h4",{className:"font-medium text-amber-800 dark:text-amber-300 mb-2 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Mögliche Ursachen:"]}),e.jsxs("ul",{className:"space-y-1 text-sm text-amber-700 dark:text-amber-400",children:[e.jsx("li",{children:"• EEDC läuft nicht als Home Assistant Add-on"}),e.jsx("li",{children:"• Home Assistant API nicht erreichbar"}),e.jsx("li",{children:"• Supervisor Token fehlt"})]})]}),e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"Erneut prüfen"]})]})]}),!t&&!s&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Sie können EEDC auch ohne Home Assistant nutzen. Investitionen und Daten können manuell oder per CSV-Import erfasst werden. Die HA-Integration kann jederzeit später aktiviert werden."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!s&&e.jsxs("button",{type:"button",onClick:b,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(Ks,{className:"w-4 h-4"}),"Überspringen"]}),e.jsxs("button",{type:"button",onClick:i,disabled:t,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx($e,{className:"w-4 h-4"})]})]})]})]})}function Ei({anlage:t,isLoading:r,error:s,onSubmit:n,onUseDefaults:a,onBack:i}){const b=t?Gs(t.leistung_kwp):vt.einspeiseverguetung_cent_kwh,[g,l]=c.useState({netzbezug_arbeitspreis_cent_kwh:vt.netzbezug_arbeitspreis_cent_kwh.toString(),einspeiseverguetung_cent_kwh:b.toString(),grundpreis_euro_monat:vt.grundpreis_euro_monat.toString(),gueltig_ab:(t==null?void 0:t.installationsdatum)||new Date().toISOString().split("T")[0],tarifname:"",anbieter:""}),[h,d]=c.useState(null),y=p=>{const{name:k,value:v}=p.target;l(j=>({...j,[k]:v})),d(null)},u=async p=>{if(p.preventDefault(),d(null),!g.netzbezug_arbeitspreis_cent_kwh||parseFloat(g.netzbezug_arbeitspreis_cent_kwh)<0){d("Bitte geben Sie einen gültigen Netzbezugspreis ein");return}if(!g.gueltig_ab){d("Bitte geben Sie ein Gültigkeitsdatum ein");return}await n({netzbezug_arbeitspreis_cent_kwh:parseFloat(g.netzbezug_arbeitspreis_cent_kwh),einspeiseverguetung_cent_kwh:parseFloat(g.einspeiseverguetung_cent_kwh)||0,grundpreis_euro_monat:g.grundpreis_euro_monat?parseFloat(g.grundpreis_euro_monat):void 0,gueltig_ab:g.gueltig_ab,tarifname:g.tarifname||void 0,anbieter:g.anbieter||void 0})},m=h||s;return e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Stromtarif konfigurieren"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Für korrekte Wirtschaftlichkeitsberechnungen"})]})]}),m&&e.jsx(re,{type:"error",className:"mb-6",children:m}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:a,disabled:r,className:"w-full p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-2 border-dashed border-amber-300 dark:border-amber-700 rounded-xl hover:border-amber-400 dark:hover:border-amber-600 transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(Zt,{className:"w-5 h-5 text-amber-500 group-hover:text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Deutsche Standardwerte verwenden"})]}),e.jsxs("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-1",children:[vt.netzbezug_arbeitspreis_cent_kwh," ct Netzbezug |"," ",b," ct Einspeisung |"," ",vt.grundpreis_euro_monat," € Grundpreis"]})]})}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-3 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"oder anpassen"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Netzbezugspreis (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"netzbezug_arbeitspreis_cent_kwh",value:g.netzbezug_arbeitspreis_cent_kwh,onChange:y,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Aktueller Durchschnitt: ~30 ct/kWh"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Einspeisevergütung (ct/kWh) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"einspeiseverguetung_cent_kwh",value:g.einspeiseverguetung_cent_kwh,onChange:y,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t&&t.leistung_kwp<=10?"≤10 kWp: 8,2 ct":t&&t.leistung_kwp<=40?"10-40 kWp: 7,1 ct":">40 kWp: 5,8 ct"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Grundpreis (€/Monat)"}),e.jsx("input",{type:"number",name:"grundpreis_euro_monat",value:g.grundpreis_euro_monat,onChange:y,step:"0.01",min:"0",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gültig ab ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"gueltig_ab",min:"2000-01-01",max:"2099-12-31",value:g.gueltig_ab,onChange:y,className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tarifname"}),e.jsx("input",{type:"text",name:"tarifname",value:g.tarifname,onChange:y,placeholder:"z.B. Ökostrom Flex",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anbieter"}),e.jsx("input",{type:"text",name:"anbieter",value:g.anbieter,onChange:y,placeholder:"z.B. Stadtwerke",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Sie können später weitere Stromtarife mit unterschiedlichen Gültigkeitszeiträumen hinzufügen, z.B. bei Tarifwechsel oder Preisänderungen."})]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsx("button",{type:"submit",disabled:r,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Speichern..."]}):e.jsxs(e.Fragment,{children:["Weiter",e.jsx($e,{className:"w-4 h-4"})]})})]})]})}function Fi(t){switch(t.suggested_investition_typ){case"e-auto":return e.jsx(Ne,{className:"w-5 h-5"});case"speicher":return e.jsx(je,{className:"w-5 h-5"});case"wallbox":return e.jsx(at,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(Yt,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(Se,{className:"w-5 h-5"});case"balkonkraftwerk":return e.jsx(ee,{className:"w-5 h-5"});default:return e.jsx(Yt,{className:"w-5 h-5"})}}function Wi(t){switch(t){case"e-auto":return"E-Auto";case"speicher":return"Speicher";case"wallbox":return"Wallbox";case"wechselrichter":return"Wechselrichter";case"pv-module":return"PV-Module";case"waermepumpe":return"Wärmepumpe";case"balkonkraftwerk":return"Balkonkraftwerk";default:return"Unbekannt"}}function $i({isLoading:t,error:r,haConnected:s,discoveryResult:n,onRunDiscovery:a,onSkip:i,onBack:b}){const g=(n==null?void 0:n.devices.filter(h=>!h.already_configured&&h.suggested_investition_typ))??[],l=(n==null?void 0:n.devices.filter(h=>h.already_configured))??[];return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(bt,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Geräte erkennen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Automatische Erkennung aus Home Assistant"})]})]}),!t&&!n&&!r&&s&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-amber-100 dark:bg-amber-900/30 rounded-full mb-6",children:e.jsx(bt,{className:"w-10 h-10 text-amber-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Geräte automatisch erkennen?"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"EEDC durchsucht Home Assistant nach Wechselrichtern, Speichern, Wallboxen, E-Autos, Wärmepumpen und Balkonkraftwerken."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-8",children:"Erkannte Geräte werden als Investitionen angelegt und können im nächsten Schritt vervollständigt werden."}),e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-6 py-3 bg-amber-500 text-white font-medium rounded-xl hover:bg-amber-600 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(bt,{className:"w-5 h-5"}),"Discovery starten"]})]}),t&&e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("div",{className:"relative mx-auto w-16 h-16 mb-6",children:[e.jsx(bt,{className:"w-16 h-16 text-amber-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 border-4 border-amber-500/30 rounded-full animate-ping"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Durchsuche Home Assistant nach Geräten..."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Erkannte Geräte werden automatisch als Investitionen angelegt."})]}),!t&&!s&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(Xt,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Keine Home Assistant Verbindung"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"Die automatische Geräteerkennung ist ohne HA-Verbindung nicht möglich."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-6",children:"Sie können Investitionen im nächsten Schritt manuell anlegen."}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg text-sm",children:[e.jsx(xt,{className:"w-4 h-4"}),"Manuelles Anlegen möglich im nächsten Schritt"]})]}),!t&&r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full mb-4",children:e.jsx(Ie,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Fehler bei der Erkennung"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-6",children:r}),e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"Erneut versuchen"]})]}),!t&&n&&!r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Or,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:"Home Assistant verbunden"}),n.devices.length>0&&e.jsxs("span",{className:"text-gray-400 dark:text-gray-500",children:["• ",n.devices.length," Gerät(e) gefunden"]})]}),n.warnings.length>0&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm text-amber-700 dark:text-amber-300",children:n.warnings.map((h,d)=>e.jsx("p",{children:h},d))})]})}),n.devices.length===0&&e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700/50 rounded-xl",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"Keine unterstützten Geräte gefunden."}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mb-4",children:"Unterstützt: SMA, evcc, Smart, Wallbox, Wärmepumpen-Integrationen"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-amber-600 dark:text-amber-400 hover:text-amber-700 dark:hover:text-amber-300",children:[e.jsx(qe,{className:"w-4 h-4"}),"Erneut suchen"]}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manuelles Anlegen im nächsten Schritt möglich"})]})]}),g.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Je,{className:"w-5 h-5 text-green-500"}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[g.length," Investition",g.length!==1?"en":""," angelegt"]})]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:g.map(h=>e.jsx("div",{className:"p-4 rounded-xl border-2 border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",children:Fi(h)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:h.name}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[h.manufacturer&&`${h.manufacturer} • `,Wi(h.suggested_investition_typ)]}),e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:h.integration})]}),e.jsx(Je,{className:"w-5 h-5 text-green-500 flex-shrink-0"})]})},h.id))}),e.jsx("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"Diese Investitionen können im nächsten Schritt vervollständigt werden (Kaufdatum, Kaufpreis, etc.)."})]}),l.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-gray-400"}),l.length," Gerät(e) bereits konfiguriert (übersprungen)"]}),n.devices.length>0&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Hinweis:"})," Im nächsten Schritt können Sie weitere Investitionen manuell hinzufügen (z.B. PV-Module) und alle Details vervollständigen."]})})]})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:b,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("div",{className:"flex gap-3",children:[!n&&!t&&e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:[e.jsx(Ks,{className:"w-4 h-4"}),"Überspringen"]}),n&&!t&&e.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter",e.jsx($e,{className:"w-4 h-4"})]})]})]})]})}function Ur(t){switch(t){case"e-auto":return e.jsx(Ne,{className:"w-5 h-5"});case"speicher":return e.jsx(je,{className:"w-5 h-5"});case"wallbox":return e.jsx(at,{className:"w-5 h-5"});case"wechselrichter":return e.jsx(Yt,{className:"w-5 h-5"});case"waermepumpe":return e.jsx(Se,{className:"w-5 h-5"});case"balkonkraftwerk":case"pv-module":return e.jsx(ee,{className:"w-5 h-5"});default:return e.jsx(Kr,{className:"w-5 h-5"})}}function Ai({investition:t,allInvestitionen:r,anlage:s,onUpdate:n,onDelete:a,isNew:i=!1}){const[b,g]=c.useState(!0);c.useEffect(()=>{i&&g(!0)},[i]);const[l,h]=c.useState(!1),d=Ua[t.typ],y=d?r.filter(p=>p.typ===d&&p.id!==t.id):[],u=p=>{var k;return(k=t.parameter)==null?void 0:k[p]},m=(p,k)=>{n({parameter:{...t.parameter,[p]:k}})};return e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[e.jsxs("button",{type:"button",onClick:()=>g(!b),className:"w-full flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-600 dark:text-amber-400 flex-shrink-0",children:Ur(t.typ)}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:t.bezeichnung||ot[t.typ]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[ot[t.typ],t.anschaffungskosten_gesamt?e.jsxs("span",{className:"ml-2",children:["• ",t.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]})]}),b?e.jsx(gt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(yt,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]}),b&&e.jsxs("div",{className:"p-4 pt-0 space-y-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bezeichnung *"}),e.jsx("input",{type:"text",value:t.bezeichnung,onChange:p=>n({bezeichnung:p.target.value}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",placeholder:"z.B. SMA Sunny Tripower"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anschaffungsdatum *"}),e.jsx("input",{type:"date",min:"2000-01-01",max:"2099-12-31",value:t.anschaffungsdatum||"",onChange:p=>n({anschaffungsdatum:p.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kaufpreis (€) *"}),e.jsx("input",{type:"number",value:t.anschaffungskosten_gesamt??"",onChange:p=>n({anschaffungskosten_gesamt:parseFloat(p.target.value)||0}),placeholder:"z.B. 5000",min:"0",step:"100",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),d&&e.jsx("div",{children:(()=>{const p=Ya.includes(t.typ),k=y.length>0,v=p&&!t.parent_investition_id&&k;return e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Gehört zu (",ot[d],")",p?" *":" (optional)"]}),k?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:t.parent_investition_id||"",onChange:j=>n({parent_investition_id:j.target.value?parseInt(j.target.value):void 0}),className:`w-full px-4 py-2.5 rounded-lg border bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent ${v?"border-amber-500 dark:border-amber-500":"border-gray-300 dark:border-gray-600"}`,children:[e.jsx("option",{value:"",children:p?"-- Bitte wählen --":"-- Keine Zuordnung --"}),y.map(j=>e.jsx("option",{value:j.id,children:j.bezeichnung},j.id))]}),v&&e.jsxs("p",{className:"mt-1 text-sm text-amber-600 dark:text-amber-400 flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"PV-Module müssen einem Wechselrichter zugeordnet werden"]})]}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 flex-shrink-0"}),p?e.jsxs("span",{children:["Bitte legen Sie zuerst einen ",e.jsx("strong",{children:"Wechselrichter"})," an, bevor Sie PV-Module zuordnen können."]}):e.jsxs("span",{children:["Kein ",ot[d]," vorhanden. Zuordnung ist optional."]})]})})]})})()}),t.typ==="wechselrichter"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Leistung (kW)"}),e.jsx("input",{type:"number",value:u("leistung_kw")??"",onChange:p=>m("leistung_kw",parseFloat(p.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="pv-module"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (kWp) *"}),e.jsx("input",{type:"number",value:t.leistung_kwp??"",onChange:p=>n({leistung_kwp:parseFloat(p.target.value)||void 0}),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ausrichtung"}),e.jsxs("select",{value:t.ausrichtung||(s==null?void 0:s.ausrichtung)||"",onChange:p=>n({ausrichtung:p.target.value||void 0}),className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Wählen --"}),e.jsx("option",{value:"Süd",children:"Süd (0°)"}),e.jsx("option",{value:"Südost",children:"Südost (-45°)"}),e.jsx("option",{value:"Ost",children:"Ost (-90°)"}),e.jsx("option",{value:"Nordost",children:"Nordost (-135°)"}),e.jsx("option",{value:"Nord",children:"Nord (180°)"}),e.jsx("option",{value:"Nordwest",children:"Nordwest (135°)"}),e.jsx("option",{value:"West",children:"West (90°)"}),e.jsx("option",{value:"Südwest",children:"Südwest (45°)"}),e.jsx("option",{value:"Ost-West",children:"Ost-West (gemischt)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Neigung (Grad)"}),e.jsx("input",{type:"number",value:t.neigung_grad??(s==null?void 0:s.neigung_grad)??"",onChange:p=>n({neigung_grad:parseFloat(p.target.value)||void 0}),placeholder:"z.B. 35",min:"0",max:"90",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="speicher"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Kapazität (kWh)"}),e.jsx("input",{type:"number",value:u("kapazitaet_kwh")??"",onChange:p=>m("kapazitaet_kwh",parseFloat(p.target.value)||void 0),placeholder:"z.B. 10",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="wallbox"&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max. Ladeleistung (kW)"}),e.jsx("input",{type:"number",value:u("leistung_kw")??"",onChange:p=>m("leistung_kw",parseFloat(p.target.value)||void 0),placeholder:"z.B. 11",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})}),t.typ==="e-auto"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Batteriekapazität (kWh)"}),e.jsx("input",{type:"number",value:u("batterie_kwh")??"",onChange:p=>m("batterie_kwh",parseFloat(p.target.value)||void 0),placeholder:"z.B. 66",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Verbrauch (kWh/100km)"}),e.jsx("input",{type:"number",value:u("verbrauch_kwh_100km")??"",onChange:p=>m("verbrauch_kwh_100km",parseFloat(p.target.value)||void 0),placeholder:"z.B. 15",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="waermepumpe"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nennleistung (kW)"}),e.jsx("input",{type:"number",value:u("leistung_kw")??"",onChange:p=>m("leistung_kw",parseFloat(p.target.value)||void 0),placeholder:"z.B. 9",min:"0",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"COP (Leistungszahl)"}),e.jsx("input",{type:"number",value:u("cop")??"3.5",onChange:p=>m("cop",parseFloat(p.target.value)||void 0),placeholder:"z.B. 3.5",min:"1",max:"10",step:"0.1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),t.typ==="balkonkraftwerk"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Leistung (Wp)"}),e.jsx("input",{type:"number",value:u("leistung_wp")??"",onChange:p=>m("leistung_wp",parseFloat(p.target.value)||void 0),placeholder:"z.B. 800",min:"0",step:"10",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Anzahl Module"}),e.jsx("input",{type:"number",value:u("anzahl")??"",onChange:p=>m("anzahl",parseInt(p.target.value)||void 0),placeholder:"z.B. 2",min:"1",step:"1",className:"w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]})]}),e.jsx("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700",children:l?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-red-600 dark:text-red-400",children:"Wirklich löschen?"}),e.jsx("button",{type:"button",onClick:()=>{a(),h(!1)},className:"px-3 py-1.5 text-sm text-white bg-red-500 rounded-lg hover:bg-red-600 transition-colors",children:"Ja, löschen"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Abbrechen"})]}):e.jsxs("button",{type:"button",onClick:()=>h(!0),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(nt,{className:"w-4 h-4"}),"Investition löschen"]})})]})]})}function Ss({onAdd:t}){const[r,s]=c.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>s(!r),className:"inline-flex items-center gap-2 px-4 py-2.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 font-medium rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors",children:[e.jsx(xt,{className:"w-5 h-5"}),"Investition hinzufügen"]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>s(!1)}),e.jsx("div",{className:"absolute left-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-20 py-2",children:Js.map(n=>e.jsxs("button",{type:"button",onClick:()=>{t(n),s(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Ur(n)}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:ot[n]})]},n))})]})]})}function Mi({investitionen:t,anlage:r,isLoading:s,error:n,onUpdateInvestition:a,onDeleteInvestition:i,onAddInvestition:b,onNext:g,onBack:l}){const[h,d]=c.useState(null),[y,u]=c.useState(null),m=c.useRef(null);c.useEffect(()=>{if(y&&m.current){m.current.scrollIntoView({behavior:"smooth",block:"center"});const v=setTimeout(()=>u(null),2e3);return()=>clearTimeout(v)}},[y]);const p=Js.reduce((v,j)=>{const _=t.filter(w=>w.typ===j);return _.length>0&&v.push({typ:j,items:_}),v},[]),k=async v=>{d(v);try{const j=await b(v);j!=null&&j.id&&u(j.id)}finally{d(null)}};return t.length===0&&!s?e.jsxs("div",{children:[e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full mb-4",children:e.jsx(Kr,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Keine Investitionen vorhanden"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6",children:"Sie können jetzt manuell Investitionen anlegen oder diesen Schritt überspringen und später unter Einstellungen → Investitionen ergänzen."}),e.jsx(Ss,{onAdd:k}),h&&e.jsxs("p",{className:"mt-4 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",ot[h]," hinzu..."]})]})}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors",children:["Weiter ohne Investitionen",e.jsx($e,{className:"w-4 h-4"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:"Investitionen vervollständigen"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ergänzen Sie Kaufdatum, Kaufpreis und technische Details. Diese Angaben werden für die ROI-Berechnung benötigt."})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length," Investition",t.length!==1?"en":""]})]}),n&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-start gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-red-700 dark:text-red-300",children:n})]}),s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade Investitionen..."})]}),!s&&e.jsxs("div",{className:"space-y-6",children:[p.map(({typ:v,items:j})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-amber-600 dark:text-amber-400",children:Ur(v)}),e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[ot[v]," (",j.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:j.map(_=>e.jsx("div",{ref:_.id===y?m:void 0,className:`transition-all duration-500 ${_.id===y?"ring-2 ring-amber-500 ring-offset-2 dark:ring-offset-gray-900 rounded-xl":""}`,children:e.jsx(Ai,{investition:_,allInvestitionen:t,anlage:r,onUpdate:w=>a(_.id,w),onDelete:()=>i(_.id),isNew:_.id===y})},_.id))})]},v)),e.jsxs("div",{className:"pt-4",children:[e.jsx(Ss,{onAdd:k}),h&&e.jsxs("span",{className:"ml-3 text-sm text-amber-600 dark:text-amber-400",children:["Füge ",ot[h]," hinzu..."]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 flex items-start gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Pflichtfelder"})," sind mit * markiert. Der Kaufpreis ist besonders wichtig für die Amortisationsberechnung. Sie können alle Angaben später jederzeit unter Einstellungen → Investitionen ändern."]})]})})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:l,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:g,disabled:s,className:"inline-flex items-center gap-2 px-6 py-2.5 bg-amber-500 text-white font-medium rounded-lg hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Weiter",e.jsx($e,{className:"w-4 h-4"})]})]})]})}function Ci(t){switch(t){case"e-auto":return e.jsx(Ne,{className:"w-4 h-4"});case"speicher":return e.jsx(je,{className:"w-4 h-4"});case"wallbox":return e.jsx(at,{className:"w-4 h-4"});case"wechselrichter":return e.jsx(Yt,{className:"w-4 h-4"});case"waermepumpe":return e.jsx(Se,{className:"w-4 h-4"});case"pv-module":case"balkonkraftwerk":return e.jsx(ee,{className:"w-4 h-4"});default:return e.jsx(Kr,{className:"w-4 h-4"})}}function Li({anlage:t,strompreis:r,investitionen:s,onComplete:n,onBack:a}){const i=!!t,b=!!r,g=s.length>0,l=s.reduce((h,d)=>h+(d.anschaffungskosten_gesamt||0),0);return e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(Je,{className:"w-8 h-8 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Einrichtung abschließen"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Überprüfen Sie Ihre Konfiguration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Er,{icon:e.jsx(ee,{className:"w-5 h-5"}),title:"PV-Anlage",status:i?"success":"warning",children:i?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.anlagenname}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.leistung_kwp," kWp",t.standort_ort&&` • ${t.standort_ort}`,t.latitude&&t.longitude&&e.jsx("span",{className:"text-green-600 dark:text-green-400 ml-2",children:"(Koordinaten gesetzt)"})]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Keine Anlage konfiguriert"})}),e.jsx(Er,{icon:e.jsx(me,{className:"w-5 h-5"}),title:"Stromtarif",status:b?"success":"warning",children:b?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:r.netzbezug_arbeitspreis_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Netzbezug"}),e.jsx("span",{className:"mx-2 text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("span",{className:"font-medium",children:r.einspeiseverguetung_cent_kwh}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:" ct/kWh Einspeisung"})]}),r.tarifname&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.tarifname,r.anbieter&&` (${r.anbieter})`]})]}):e.jsx("div",{className:"text-amber-600 dark:text-amber-400",children:"Kein Stromtarif konfiguriert - Berechnungen sind unvollständig"})}),e.jsx(Er,{icon:e.jsx(Yt,{className:"w-5 h-5"}),title:"Investitionen",status:g?"success":"neutral",children:g?e.jsxs("div",{className:"space-y-2",children:[s.slice(0,5).map(h=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:Ci(h.typ)}),e.jsx("span",{className:"truncate",children:h.bezeichnung}),h.anschaffungskosten_gesamt?e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-auto flex-shrink-0",children:[h.anschaffungskosten_gesamt.toLocaleString("de-DE")," €"]}):null]},h.id)),s.length>5&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["... und ",s.length-5," weitere"]}),l>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Gesamt: ",l.toLocaleString("de-DE")," €"]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Keine Investitionen erstellt - können später hinzugefügt werden"})})]}),e.jsx(Di,{hasAnlage:i,investitionen:s})]}),e.jsxs("div",{className:"px-6 md:px-8 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsxs("button",{type:"button",onClick:a,className:"inline-flex items-center gap-2 px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"}),"Zurück"]}),e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-600 hover:to-emerald-600 transition-all",children:["Einrichtung abschließen",e.jsx(Je,{className:"w-5 h-5"})]})]})]})}function Er({icon:t,title:r,status:s,children:n}){const a={success:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",warning:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20",neutral:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50"},i={success:"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400",warning:"bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400",neutral:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400"};return e.jsx("div",{className:`p-4 rounded-xl border ${a[s]}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${i[s]}`,children:t}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:r}),s==="success"&&e.jsx(Je,{className:"w-4 h-4 text-green-500"}),s==="warning"&&e.jsx(Me,{className:"w-4 h-4 text-amber-500"})]}),n]})]})})}function Di({hasAnlage:t,investitionen:r}){const s=r.some(b=>b.typ==="wechselrichter"),n=r.some(b=>b.typ==="pv-module"),a=[];n||a.push({text:"PV-Module unter Einstellungen → Investitionen anlegen (wichtig für PVGIS-Prognose)",priority:"high"}),!s&&t&&a.push({text:"Wechselrichter unter Einstellungen → Investitionen ergänzen",priority:"high"}),a.push({text:"Monatsdaten unter Einstellungen → Monatsdaten erfassen oder CSV importieren",priority:"medium"}),n&&a.push({text:"PVGIS-Prognose unter Auswertungen → Prognose abrufen",priority:"medium"}),a.push({text:"Dashboard und Auswertungen erkunden",priority:"low"});const i=a.sort((b,g)=>{const l={high:0,medium:1,low:2};return l[b.priority]-l[g.priority]});return e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-amber-500"}),"Empfohlene nächste Schritte:"]}),e.jsx("ul",{className:"space-y-2 text-sm",children:i.map((b,g)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx($e,{className:`w-4 h-4 flex-shrink-0 mt-0.5 ${b.priority==="high"?"text-amber-500":b.priority==="medium"?"text-blue-500":"text-green-500"}`}),e.jsx("span",{className:`${b.priority==="high"?"text-gray-900 dark:text-white font-medium":"text-gray-600 dark:text-gray-400"}`,children:b.text})]},g))}),(!n||!s)&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:[e.jsx("strong",{children:"Hinweis:"})," PV-Module werden nicht automatisch erkannt und müssen manuell angelegt werden. Die Angaben zu Ausrichtung und Neigung sind wichtig für die PVGIS-Ertragsprognose."]})})]})}function Ii({anlage:t,onGoToDashboard:r}){return e.jsxs("div",{className:"p-8 md:p-12 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-8",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl shadow-xl flex items-center justify-center animate-bounce",children:e.jsx(ee,{className:"w-12 h-12 text-white"})}),e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(wa,{className:"w-8 h-8 text-amber-500"})})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4",children:"Einrichtung abgeschlossen!"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-lg mx-auto",children:t?e.jsxs(e.Fragment,{children:["Ihre Anlage ",e.jsxs("span",{className:"font-semibold text-amber-600 dark:text-amber-400",children:['"',t.anlagenname,'"']})," ist bereit zur Nutzung."]}):"EEDC ist bereit zur Nutzung."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 mb-8 max-w-md mx-auto text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Erste Schritte:"}),e.jsxs("ul",{className:"space-y-3",children:[e.jsx(Fr,{number:1,text:"Fehlende Investitionen unter Einstellungen ergänzen"}),e.jsx(Fr,{number:2,text:"Monatsdaten erfassen oder CSV importieren"}),e.jsx(Fr,{number:3,text:"Dashboard und ROI-Berechnungen erkunden"})]})]}),e.jsxs("button",{onClick:r,className:"inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-lg rounded-xl shadow-lg hover:shadow-xl hover:from-amber-600 hover:to-orange-600 transition-all",children:["Zum Dashboard",e.jsx($e,{className:"w-5 h-5"})]})]})}function Fr({number:t,text:r}){return e.jsxs("li",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-amber-500 text-white text-sm font-medium rounded-full flex items-center justify-center",children:t}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r})]})}const Et=[{key:"welcome",label:"Willkommen",shortLabel:"Start"},{key:"anlage",label:"Anlage erstellen",shortLabel:"Anlage"},{key:"ha-connection",label:"Home Assistant",shortLabel:"HA"},{key:"strompreise",label:"Strompreise",shortLabel:"Preise"},{key:"discovery",label:"Geräte erkennen",shortLabel:"Geräte"},{key:"investitionen",label:"Investitionen",shortLabel:"Invest."},{key:"summary",label:"Zusammenfassung",shortLabel:"Fertig"}];function Pi({onComplete:t}){var i;const r=Qa(),s=async()=>{await pt.createDemoData(),t()};c.useEffect(()=>{r.step==="ha-connection"&&!r.haConnected&&r.checkHAConnection()},[r.step]),c.useEffect(()=>{if(r.step==="complete"){const b=setTimeout(t,100);return()=>clearTimeout(b)}},[r.step,t]);const n=Et.findIndex(b=>b.key===r.step),a=r.step!=="welcome"&&r.step!=="complete";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[e.jsx("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(ee,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"eedc Einrichtung"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Energie Effizienz Data Center"})]})]}),a&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Schritt ",n+1," von ",Et.length]})]})})}),a&&e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsx("div",{className:"hidden md:flex items-center py-4",children:Et.map((b,g)=>{const l=g<n,h=g===n;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                          w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium
                          transition-all duration-300
                          ${l?"bg-green-500 text-white":h?"bg-amber-500 text-white ring-4 ring-amber-500/30":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}
                        `,children:l?e.jsx(Je,{className:"w-5 h-5"}):g+1}),e.jsx("span",{className:`
                          ml-2 text-sm whitespace-nowrap
                          ${h?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"}
                        `,children:b.label})]}),g<Et.length-1&&e.jsx("div",{className:`
                          flex-1 h-0.5 mx-4
                          ${l?"bg-green-500":"bg-gray-200 dark:bg-gray-700"}
                        `})]},b.key)})}),e.jsxs("div",{className:"md:hidden py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:(i=Et[n])==null?void 0:i.label}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n+1,"/",Et.length]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500",style:{width:`${r.progress}%`}})})]})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[r.step==="welcome"&&e.jsx(Ni,{onNext:r.nextStep,onLoadDemo:s}),r.step==="anlage"&&e.jsx(zi,{isLoading:r.isLoading,error:r.error,onSubmit:r.createAnlage,onGeocode:r.geocodeAddress,onBack:r.prevStep}),r.step==="ha-connection"&&e.jsx(Si,{isLoading:r.isLoading,error:r.error,haConnected:r.haConnected,haVersion:r.haVersion,onRetry:r.checkHAConnection,onNext:r.nextStep,onSkip:r.skipStep,onBack:r.prevStep}),r.step==="strompreise"&&e.jsx(Ei,{anlage:r.anlage,isLoading:r.isLoading,error:r.error,onSubmit:r.createStrompreis,onUseDefaults:r.useDefaultStrompreise,onBack:r.prevStep}),r.step==="discovery"&&e.jsx($i,{isLoading:r.isLoading,error:r.error,haConnected:r.haConnected,discoveryResult:r.discoveryResult,onRunDiscovery:r.runDiscoveryAndCreateInvestitionen,onSkip:r.nextStep,onBack:r.prevStep}),r.step==="investitionen"&&e.jsx(Mi,{investitionen:r.investitionen,anlage:r.anlage,isLoading:r.isLoading,error:r.error,onUpdateInvestition:r.updateInvestition,onDeleteInvestition:r.deleteInvestition,onAddInvestition:r.addInvestition,onNext:r.nextStep,onBack:r.prevStep}),r.step==="summary"&&e.jsx(Li,{anlage:r.anlage,strompreis:r.strompreis,investitionen:r.investitionen,onComplete:r.completeWizard,onBack:r.prevStep}),r.step==="complete"&&e.jsx(Ii,{anlage:r.anlage,onGoToDashboard:t})]})}),e.jsx("footer",{className:"text-center py-6 text-sm text-gray-400 dark:text-gray-500",children:"eedc – Energie Effizienz Data Center"})]})}const Wr="eedc_setup_wizard_completed";function Vi({children:t}){const[r,s]=c.useState(!0),[n,a]=c.useState(!1);c.useEffect(()=>{i()},[]);const i=async()=>{try{(await tt.list()).length===0?(localStorage.removeItem(Wr),localStorage.removeItem("eedc_setup_wizard_state"),a(!0)):(localStorage.setItem(Wr,"true"),a(!1))}catch(g){console.error("Fehler beim Prüfen des Setup-Status:",g),a(!1)}finally{s(!1)}},b=()=>{localStorage.setItem(Wr,"true"),a(!1)};return r?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Lade eedc..."})]})}):n?e.jsx(Pi,{onComplete:b}):e.jsx(e.Fragment,{children:t})}Ar.createRoot(document.getElementById("root")).render(e.jsx(ra.StrictMode,{children:e.jsx(Wa,{children:e.jsx(Vi,{children:e.jsx(wi,{})})})}));
